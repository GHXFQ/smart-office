(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c63176c","chunk-2d0e4842"],{"1e5a":function(e,t,a){"use strict";var c=a("23e7"),r=a("9961"),o=a("dad2");c({target:"Set",proto:!0,real:!0,forced:!o("symmetricDifference")},{symmetricDifference:r})},"1e70":function(e,t,a){"use strict";var c=a("23e7"),r=a("a5f7"),o=a("dad2"),l=!o("difference",(function(e){return 0===e.size}));c({target:"Set",proto:!0,real:!0,forced:l},{difference:r})},3123:function(e,t,a){"use strict";a("512b")},"35ad":function(e,t,a){"use strict";a.d(t,"h",(function(){return o})),a.d(t,"g",(function(){return l})),a.d(t,"c",(function(){return n})),a.d(t,"j",(function(){return i})),a.d(t,"e",(function(){return d})),a.d(t,"i",(function(){return u})),a.d(t,"d",(function(){return s})),a.d(t,"b",(function(){return b})),a.d(t,"a",(function(){return m})),a.d(t,"f",(function(){return p}));a("d9e2");var c=a("b775"),r=a("c24f");function o(e){return Object(c["a"])({url:"/api/contract/contracts/",method:"get",params:e})}function l(e){return Object(c["a"])({url:`/api/contract/contracts/${e}/`,method:"get"})}function n(e){return Object(c["a"])({url:"/api/contract/contracts/",method:"post",data:e})}function i(e,t){return Object(c["a"])({url:`/api/contract/contracts/${e}/`,method:"put",data:t})}function d(e){return Object(c["a"])({url:`/api/contract/contracts/${e}/`,method:"delete"})}function u(e){return Object(c["a"])({url:"/api/contract/contracts/template_suggestions/",method:"get",params:e})}function s(e,t){return Object(c["a"])({url:`/api/contract/templates/${e}/use_template/`,method:"post",data:t})}function b(e,t){if(!e||isNaN(Number(e)))return console.error("无效的合同ID:",e),Promise.reject(new Error("无效的合同ID"));if(!t||!t.content)return console.error("无效的合同内容:",t),Promise.reject(new Error("合同内容不能为空"));const a=t&&t.content?t.content.length:0;return console.log(`调用checkContract API - ID: ${e}, 内容长度: ${a}`),Object(c["a"])({url:`/api/contract/contracts/${e}/check_contract/`,method:"post",data:t,timeout:18e4}).catch(e=>{throw console.error("合同检查API错误:",e),e})}function m(e,t,a){if(!t||!t.content)return console.error("无效的合同内容:",t),Promise.reject(new Error("合同内容不能为空"));const r=t&&t.content?t.content.length:0;return console.log(`调用aiPolishContract API - ID: ${e}, 内容长度: ${r}`),Object(c["a"])({url:`/api/contract/contracts/${e}/ai_polish/`,method:"post",data:t,signal:a}).then(e=>(console.log("AI润色返回数据:",e),e)).catch(e=>{throw console.error("AI润色API错误:",e),e})}const{getCompanyUsers:p}=r["a"]},"384f":function(e,t,a){"use strict";var c=a("e330"),r=a("5388"),o=a("cb27"),l=o.Set,n=o.proto,i=c(n.forEach),d=c(n.keys),u=d(new l).next;e.exports=function(e,t,a){return a?r({iterator:d(e),next:u},t):i(e,t)}},"395e":function(e,t,a){"use strict";var c=a("dc19"),r=a("cb27").has,o=a("8e16"),l=a("7f65"),n=a("5388"),i=a("2a62");e.exports=function(e){var t=c(this),a=l(e);if(o(t)<a.size)return!1;var d=a.getIterator();return!1!==n(d,(function(e){if(!r(t,e))return i(d,"normal",!1)}))}},"512b":function(e,t,a){},5388:function(e,t,a){"use strict";var c=a("c65b");e.exports=function(e,t,a){var r,o,l=a?e:e.iterator,n=e.next;while(!(r=c(n,l)).done)if(o=t(r.value),void 0!==o)return o}},"68df":function(e,t,a){"use strict";var c=a("dc19"),r=a("8e16"),o=a("384f"),l=a("7f65");e.exports=function(e){var t=c(this),a=l(e);return!(r(t)>a.size)&&!1!==o(t,(function(e){if(!a.includes(e))return!1}),!0)}},"72c3":function(e,t,a){"use strict";var c=a("23e7"),r=a("e9bc"),o=a("dad2");c({target:"Set",proto:!0,real:!0,forced:!o("union")},{union:r})},"79a4":function(e,t,a){"use strict";var c=a("23e7"),r=a("d039"),o=a("953b"),l=a("dad2"),n=!l("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||r((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));c({target:"Set",proto:!0,real:!0,forced:n},{intersection:o})},"7f65":function(e,t,a){"use strict";var c=a("59ed"),r=a("825a"),o=a("c65b"),l=a("5926"),n=a("46c4"),i="Invalid size",d=RangeError,u=TypeError,s=Math.max,b=function(e,t){this.set=e,this.size=s(t,0),this.has=c(e.has),this.keys=c(e.keys)};b.prototype={getIterator:function(){return n(r(o(this.keys,this.set)))},includes:function(e){return o(this.has,this.set,e)}},e.exports=function(e){r(e);var t=+e.size;if(t!==t)throw new u(i);var a=l(t);if(a<0)throw new d(i);return new b(e,a)}},"83b9":function(e,t,a){"use strict";var c=a("cb27"),r=a("384f"),o=c.Set,l=c.add;e.exports=function(e){var t=new o;return r(e,(function(e){l(t,e)})),t}},"8b00":function(e,t,a){"use strict";var c=a("23e7"),r=a("68df"),o=a("dad2"),l=!o("isSubsetOf",(function(e){return e}));c({target:"Set",proto:!0,real:!0,forced:l},{isSubsetOf:r})},"8e16":function(e,t,a){"use strict";var c=a("7282"),r=a("cb27");e.exports=c(r.proto,"size","get")||function(e){return e.size}},"910d":function(e,t,a){"use strict";var c=a("23e7"),r=a("c65b"),o=a("59ed"),l=a("825a"),n=a("46c4"),i=a("c5cc"),d=a("9bdd"),u=a("c430"),s=a("2a62"),b=a("f99f"),m=!u&&b("filter",TypeError),p=i((function(){var e,t,a,c=this.iterator,o=this.predicate,n=this.next;while(1){if(e=l(r(n,c)),t=this.done=!!e.done,t)return;if(a=e.value,d(c,o,[a,this.counter++],!0))return a}}));c({target:"Iterator",proto:!0,real:!0,forced:u||m},{filter:function(e){l(this);try{o(e)}catch(t){s(this,"throw",t)}return m?r(m,this,e):new p(n(this),{predicate:e})}})},"953b":function(e,t,a){"use strict";var c=a("dc19"),r=a("cb27"),o=a("8e16"),l=a("7f65"),n=a("384f"),i=a("5388"),d=r.Set,u=r.add,s=r.has;e.exports=function(e){var t=c(this),a=l(e),r=new d;return o(t)>a.size?i(a.getIterator(),(function(e){s(t,e)&&u(r,e)})):n(t,(function(e){a.includes(e)&&u(r,e)})),r}},9961:function(e,t,a){"use strict";var c=a("dc19"),r=a("cb27"),o=a("83b9"),l=a("7f65"),n=a("5388"),i=r.add,d=r.has,u=r.remove;e.exports=function(e){var t=c(this),a=l(e).getIterator(),r=o(t);return n(a,(function(e){d(t,e)?u(r,e):i(r,e)})),r}},a4e7:function(e,t,a){"use strict";var c=a("23e7"),r=a("395e"),o=a("dad2"),l=!o("isSupersetOf",(function(e){return!e}));c({target:"Set",proto:!0,real:!0,forced:l},{isSupersetOf:r})},a5f7:function(e,t,a){"use strict";var c=a("dc19"),r=a("cb27"),o=a("83b9"),l=a("8e16"),n=a("7f65"),i=a("384f"),d=a("5388"),u=r.has,s=r.remove;e.exports=function(e){var t=c(this),a=n(e),r=o(t);return l(t)<=a.size?i(t,(function(e){a.includes(e)&&s(r,e)})):d(a.getIterator(),(function(e){u(t,e)&&s(r,e)})),r}},b4bc:function(e,t,a){"use strict";var c=a("dc19"),r=a("cb27").has,o=a("8e16"),l=a("7f65"),n=a("384f"),i=a("5388"),d=a("2a62");e.exports=function(e){var t=c(this),a=l(e);if(o(t)<=a.size)return!1!==n(t,(function(e){if(a.includes(e))return!1}),!0);var u=a.getIterator();return!1!==i(u,(function(e){if(r(t,e))return d(u,"normal",!1)}))}},c1a1:function(e,t,a){"use strict";var c=a("23e7"),r=a("b4bc"),o=a("dad2"),l=!o("isDisjointFrom",(function(e){return!e}));c({target:"Set",proto:!0,real:!0,forced:l},{isDisjointFrom:r})},cb27:function(e,t,a){"use strict";var c=a("e330"),r=Set.prototype;e.exports={Set:Set,add:c(r.add),has:c(r.has),remove:c(r["delete"]),proto:r}},d800:function(e,t,a){"use strict";a.d(t,"h",(function(){return r})),a.d(t,"g",(function(){return o})),a.d(t,"c",(function(){return l})),a.d(t,"l",(function(){return n})),a.d(t,"i",(function(){return i})),a.d(t,"j",(function(){return d})),a.d(t,"k",(function(){return u})),a.d(t,"d",(function(){return s})),a.d(t,"e",(function(){return b})),a.d(t,"f",(function(){return m})),a.d(t,"m",(function(){return p})),a.d(t,"a",(function(){return j})),a.d(t,"b",(function(){return O}));a("d9e2");var c=a("b775");function r(){return Object(c["a"])({url:"/api/chat/sessions/",method:"get"})}function o(e){return Object(c["a"])({url:`/api/chat/sessions/${e}/`,method:"get"})}function l(e){return Object(c["a"])({url:"/api/chat/sessions/",method:"post",data:e})}function n(e){return Object(c["a"])({url:"/api/chat/messages/",method:"post",data:{...e,message_type:"text"}})}function i(e,t,a){const r=new FormData;return r.append("chat",e),r.append("message_type","file"),r.append("content",t),r.append("file",a),Object(c["a"])({url:"/api/chat/messages/",method:"post",data:r})}function d(e,t,a){const r=new FormData;return r.append("chat",e),r.append("message_type","image"),r.append("content",t),r.append("file",a),Object(c["a"])({url:"/api/chat/messages/",method:"post",data:r})}function u(e){return Object(c["a"])({url:"/api/chat/messages/",method:"post",data:{...e,message_type:"knowledge",content:"分享了一个知识库文件"}})}function s(e){return Object(c["a"])({url:`/api/chat/messages/${e}/download/`,method:"get",responseType:"blob"})}function b(e){return Object(c["a"])({url:"/api/chat/find-or-create/",method:"post",data:{user_id:e}})}async function m(e){if(!e||0===e.length)throw new Error("No user IDs provided");return 1===e.length?b(e[0]):l({participants:e})}function p(e,t,a){return Object(c["a"])({url:`/api/chat/sessions/${e}/summarize/`,method:"post",data:{start_date:t,end_date:a}})}function j(e){return Object(c["a"])({url:"/api/chat/analyze-for-calendar/",method:"post",data:{content:e}})}function O(e){return Object(c["a"])({url:"/api/calendar/events/",method:"post",data:e})}},dad2:function(e,t,a){"use strict";var c=a("d066"),r=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},o=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var a=c("Set");try{(new a)[e](r(0));try{return(new a)[e](r(-1)),!1}catch(n){if(!t)return!0;try{return(new a)[e](o(-1/0)),!1}catch(i){var l=new a;return l.add(1),l.add(2),t(l[e](o(1/0)))}}}catch(i){return!1}}},dc19:function(e,t,a){"use strict";var c=a("cb27").has;e.exports=function(e){return c(e),e}},e1e7:function(e,t,a){"use strict";a.r(t);var c=a("7a23");const r={class:"contract-container"},o={class:"row"},l={class:"col-lg-12"},n={class:"card-header-flex"},i={class:"d-flex align-items-center ms-auto me-3"},d={class:"contract-list"},u=["onClick"],s={class:"contract-title"},b={class:"contract-info"},m={class:"contract-info mt-1"},p={class:"contract-actions"},j={class:"pagination-container"},O={class:"mb-4"},f={key:1},h={class:"mb-4"},V={class:"template-list"},v=["onClick"],w={class:"template-name"},C={class:"template-info"},y={class:"template-type"},g={key:0,class:"template-industry"},N={key:0,class:"template-desc"},x={class:"dialog-footer"},k={class:"row"},_={class:"col-md-6"},E={class:"col-md-6"};function F(e,t,a,F,D,B){const S=Object(c["resolveComponent"])("el-input"),T=Object(c["resolveComponent"])("el-option"),U=Object(c["resolveComponent"])("el-select"),I=Object(c["resolveComponent"])("Plus"),z=Object(c["resolveComponent"])("el-icon"),A=Object(c["resolveComponent"])("el-button"),$=Object(c["resolveComponent"])("el-dropdown-item"),P=Object(c["resolveComponent"])("el-dropdown-menu"),L=Object(c["resolveComponent"])("el-dropdown"),M=Object(c["resolveComponent"])("el-empty"),q=Object(c["resolveComponent"])("el-pagination"),J=Object(c["resolveComponent"])("el-card"),Q=Object(c["resolveComponent"])("el-radio-button"),W=Object(c["resolveComponent"])("el-radio-group"),G=Object(c["resolveComponent"])("el-form-item"),R=Object(c["resolveComponent"])("el-col"),Y=Object(c["resolveComponent"])("el-row"),H=Object(c["resolveComponent"])("el-date-picker"),K=Object(c["resolveComponent"])("el-form"),X=Object(c["resolveComponent"])("el-dialog"),Z=Object(c["resolveDirective"])("loading");return Object(c["openBlock"])(),Object(c["createElementBlock"])("div",r,[Object(c["createElementVNode"])("div",o,[Object(c["createElementVNode"])("div",l,[Object(c["withDirectives"])((Object(c["openBlock"])(),Object(c["createBlock"])(J,{class:"contract-list-card"},{header:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",n,[t[38]||(t[38]=Object(c["createElementVNode"])("span",null,"合同列表",-1)),Object(c["createElementVNode"])("div",i,[Object(c["createVNode"])(S,{modelValue:F.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=e=>F.searchQuery=e),placeholder:"搜索标题或编号...",clearable:"","prefix-icon":F.Search,class:"me-2",style:{width:"200px"},onClear:F.handleFilterChange},null,8,["modelValue","prefix-icon","onClear"]),Object(c["createVNode"])(U,{modelValue:F.sortBy,"onUpdate:modelValue":t[1]||(t[1]=e=>F.sortBy=e),placeholder:"默认排序",class:"me-2",style:{width:"150px"},onChange:F.handleFilterChange},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(T,{label:"默认排序",value:"default"}),Object(c["createVNode"])(T,{label:"合同标题",value:"title"}),Object(c["createVNode"])(T,{label:"创建时间",value:"created_at"}),Object(c["createVNode"])(T,{label:"合同金额",value:"amount"})]),_:1},8,["modelValue","onChange"]),Object(c["createVNode"])(U,{modelValue:F.sortOrder,"onUpdate:modelValue":t[2]||(t[2]=e=>F.sortOrder=e),style:{width:"100px"},onChange:F.handleFilterChange},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(T,{label:"升序",value:"asc"}),Object(c["createVNode"])(T,{label:"降序",value:"desc"})]),_:1},8,["modelValue","onChange"])]),Object(c["createVNode"])(A,{type:"primary",size:"small",onClick:F.openContractDialog},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(z,{class:"mr-1"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(I)]),_:1}),t[37]||(t[37]=Object(c["createTextVNode"])(" 新建合同 "))]),_:1},8,["onClick"])])]),default:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",d,[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(F.filteredContracts,e=>(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",{key:e.id,class:Object(c["normalizeClass"])(["contract-item",{active:F.selectedContract&&F.selectedContract.id===e.id}])},[Object(c["createElementVNode"])("div",{class:"contract-main-info",onClick:t=>F.viewContractDetail(e)},[Object(c["createElementVNode"])("div",s,Object(c["toDisplayString"])(e.title),1),Object(c["createElementVNode"])("div",b,[Object(c["createElementVNode"])("span",null,"合同编号: "+Object(c["toDisplayString"])(e.number),1),Object(c["createElementVNode"])("span",null,"创建时间: "+Object(c["toDisplayString"])(e.createdAt),1)]),Object(c["createElementVNode"])("div",m,[Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(e.company),1),Object(c["createElementVNode"])("span",null,"金额: "+Object(c["toDisplayString"])(e.displayAmount),1)])],8,u),Object(c["createElementVNode"])("div",p,[Object(c["createVNode"])(L,{trigger:"click",onClick:t[3]||(t[3]=Object(c["withModifiers"])(()=>{},["stop"]))},{dropdown:Object(c["withCtx"])(()=>[Object(c["createVNode"])(P,null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])($,{icon:F.Edit,onClick:t=>F.handleEdit(e)},{default:Object(c["withCtx"])(()=>t[39]||(t[39]=[Object(c["createTextVNode"])("编辑")])),_:2},1032,["icon","onClick"]),Object(c["createVNode"])($,{icon:F.Share,onClick:t=>F.handleShare(e)},{default:Object(c["withCtx"])(()=>t[40]||(t[40]=[Object(c["createTextVNode"])("分享")])),_:2},1032,["icon","onClick"]),Object(c["createVNode"])($,{icon:F.Delete,divided:"",class:"text-danger",onClick:t=>F.handleDelete(e)},{default:Object(c["withCtx"])(()=>t[41]||(t[41]=[Object(c["createTextVNode"])("删除")])),_:2},1032,["icon","onClick"])]),_:2},1024)]),default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(A,{icon:F.MoreFilled,class:"more-button",text:"",circle:""},null,8,["icon"])]),_:2},1024)])],2))),128)),0===F.filteredContracts.length?(Object(c["openBlock"])(),Object(c["createBlock"])(M,{key:0,description:"没有找到匹配的合同"})):Object(c["createCommentVNode"])("",!0)]),Object(c["createElementVNode"])("div",j,[Object(c["createVNode"])(q,{"current-page":F.currentPage,"onUpdate:currentPage":t[4]||(t[4]=e=>F.currentPage=e),"page-size":10,layout:"total, prev, pager, next, jumper",total:F.totalItems,onCurrentChange:F.handleCurrentChange},null,8,["current-page","total","onCurrentChange"])])]),_:1})),[[Z,F.isLoading]])])]),Object(c["createVNode"])(X,{modelValue:F.showNewContractDialog,"onUpdate:modelValue":t[23]||(t[23]=e=>F.showNewContractDialog=e),title:"新建合同",width:"60%",center:"",class:"new-contract-dialog"},{footer:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("span",x,[Object(c["createVNode"])(A,{onClick:t[22]||(t[22]=e=>F.showNewContractDialog=!1)},{default:Object(c["withCtx"])(()=>t[48]||(t[48]=[Object(c["createTextVNode"])("取消")])),_:1}),Object(c["createVNode"])(A,{type:"primary",onClick:F.submitContract},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])(Object(c["toDisplayString"])(F.getSubmitButtonText()),1)]),_:1},8,["onClick"])])]),default:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",O,[Object(c["createVNode"])(W,{modelValue:F.creationMode,"onUpdate:modelValue":t[5]||(t[5]=e=>F.creationMode=e),size:"large"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Q,{label:"manual"},{default:Object(c["withCtx"])(()=>t[42]||(t[42]=[Object(c["createTextVNode"])("手动创建")])),_:1}),Object(c["createVNode"])(Q,{label:"template"},{default:Object(c["withCtx"])(()=>t[43]||(t[43]=[Object(c["createTextVNode"])("使用模板")])),_:1}),Object(c["createVNode"])(Q,{label:"ai"},{default:Object(c["withCtx"])(()=>t[44]||(t[44]=[Object(c["createTextVNode"])("AI 生成")])),_:1})]),_:1},8,["modelValue"])]),"manual"===F.creationMode?(Object(c["openBlock"])(),Object(c["createBlock"])(K,{key:0,model:F.newContract,"label-width":"100px"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Y,{gutter:20},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(R,{span:12},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(G,{label:"合同名称",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(S,{modelValue:F.newContract.title,"onUpdate:modelValue":t[6]||(t[6]=e=>F.newContract.title=e)},null,8,["modelValue"])]),_:1})]),_:1}),Object(c["createVNode"])(R,{span:12},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(G,{label:"合同类型",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(U,{modelValue:F.newContract.type,"onUpdate:modelValue":t[7]||(t[7]=e=>F.newContract.type=e),placeholder:"请选择或输入",filterable:"","allow-create":"","default-first-option":"",style:{width:"100%"}},{default:Object(c["withCtx"])(()=>[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(F.contractTypes,e=>(Object(c["openBlock"])(),Object(c["createBlock"])(T,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),Object(c["createVNode"])(Y,{gutter:20},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(R,{span:12},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(G,{label:"签约对方",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(S,{modelValue:F.newContract.company,"onUpdate:modelValue":t[8]||(t[8]=e=>F.newContract.company=e)},null,8,["modelValue"])]),_:1})]),_:1}),Object(c["createVNode"])(R,{span:12},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(G,{label:"合同金额"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(S,{modelValue:F.newContract.amount,"onUpdate:modelValue":t[9]||(t[9]=e=>F.newContract.amount=e),placeholder:"请输入金额"},{prepend:Object(c["withCtx"])(()=>t[45]||(t[45]=[Object(c["createTextVNode"])("¥")])),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),Object(c["createVNode"])(Y,{gutter:20},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(R,{span:8},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(G,{label:"签约日期"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(H,{modelValue:F.newContract.signDate,"onUpdate:modelValue":t[10]||(t[10]=e=>F.newContract.signDate=e),type:"date",placeholder:"选择日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),Object(c["createVNode"])(R,{span:8},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(G,{label:"生效日期"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(H,{modelValue:F.newContract.startDate,"onUpdate:modelValue":t[11]||(t[11]=e=>F.newContract.startDate=e),type:"date",placeholder:"选择日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),Object(c["createVNode"])(R,{span:8},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(G,{label:"到期日期"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(H,{modelValue:F.newContract.expireDate,"onUpdate:modelValue":t[12]||(t[12]=e=>F.newContract.expireDate=e),type:"date",placeholder:"选择日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Object(c["createVNode"])(G,{label:"备注"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(S,{modelValue:F.newContract.remark,"onUpdate:modelValue":t[13]||(t[13]=e=>F.newContract.remark=e),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):Object(c["createCommentVNode"])("",!0),"template"===F.creationMode?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",f,[Object(c["createVNode"])(Y,{gutter:20,class:"mb-4"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(R,{span:8},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(U,{modelValue:F.templateForm.contractType,"onUpdate:modelValue":t[14]||(t[14]=e=>F.templateForm.contractType=e),placeholder:"合同类型",filterable:"",style:{width:"100%"}},{default:Object(c["withCtx"])(()=>[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(F.contractTypes,e=>(Object(c["openBlock"])(),Object(c["createBlock"])(T,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Object(c["createVNode"])(R,{span:8},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(U,{modelValue:F.templateForm.industry,"onUpdate:modelValue":t[15]||(t[15]=e=>F.templateForm.industry=e),placeholder:"行业领域",filterable:"",style:{width:"100%"}},{default:Object(c["withCtx"])(()=>[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(F.industries,e=>(Object(c["openBlock"])(),Object(c["createBlock"])(T,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Object(c["createVNode"])(R,{span:8},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(U,{modelValue:F.templateForm.scene,"onUpdate:modelValue":t[16]||(t[16]=e=>F.templateForm.scene=e),placeholder:"交易场景",filterable:"",style:{width:"100%"}},{default:Object(c["withCtx"])(()=>[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(F.scenes,e=>(Object(c["openBlock"])(),Object(c["createBlock"])(T,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),Object(c["createElementVNode"])("div",h,[t[46]||(t[46]=Object(c["createElementVNode"])("p",{class:"form-label small text-muted"},"推荐模板",-1)),Object(c["withDirectives"])((Object(c["openBlock"])(),Object(c["createElementBlock"])("div",V,[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(F.availableTemplates,(e,t)=>(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",{key:t,class:Object(c["normalizeClass"])(["template-item",{active:F.selectedTemplate===t}]),onClick:a=>F.handleTemplateSelect(e,t)},[Object(c["createElementVNode"])("div",w,Object(c["toDisplayString"])(e.name),1),Object(c["createElementVNode"])("div",C,[Object(c["createElementVNode"])("span",y,Object(c["toDisplayString"])(e.contract_type),1),e.industry?(Object(c["openBlock"])(),Object(c["createElementBlock"])("span",g,Object(c["toDisplayString"])(e.industry),1)):Object(c["createCommentVNode"])("",!0)]),e.description?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",N,Object(c["toDisplayString"])(e.description),1)):Object(c["createCommentVNode"])("",!0)],10,v))),128)),!F.isLoadingTemplates&&0===F.availableTemplates.length&&(F.templateForm.contractType||F.templateForm.industry||F.templateForm.scene)?(Object(c["openBlock"])(),Object(c["createBlock"])(M,{key:0,description:"没有找到匹配的模板","image-size":80})):Object(c["createCommentVNode"])("",!0)])),[[Z,F.isLoadingTemplates]])]),Object(c["createVNode"])(K,{model:F.templateForm,"label-width":"100px"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Y,{gutter:20},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(R,{span:12},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(G,{label:"合同名称",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(S,{modelValue:F.templateForm.title,"onUpdate:modelValue":t[17]||(t[17]=e=>F.templateForm.title=e),placeholder:"请选择模板后自动生成"},null,8,["modelValue"])]),_:1})]),_:1}),Object(c["createVNode"])(R,{span:12},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(G,{label:"签约对方",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(S,{modelValue:F.templateForm.company,"onUpdate:modelValue":t[18]||(t[18]=e=>F.templateForm.company=e),placeholder:"请输入签约对方名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Object(c["createVNode"])(Y,{gutter:20},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(R,{span:12},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(G,{label:"合同金额"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(S,{modelValue:F.templateForm.amount,"onUpdate:modelValue":t[19]||(t[19]=e=>F.templateForm.amount=e),placeholder:"请输入金额"},{prepend:Object(c["withCtx"])(()=>t[47]||(t[47]=[Object(c["createTextVNode"])("¥")])),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),Object(c["createVNode"])(G,{label:"备注"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(S,{modelValue:F.templateForm.remark,"onUpdate:modelValue":t[20]||(t[20]=e=>F.templateForm.remark=e),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):Object(c["createCommentVNode"])("",!0),"ai"===F.creationMode?(Object(c["openBlock"])(),Object(c["createBlock"])(K,{key:2,model:F.aiForm,"label-position":"top"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(G,{label:"请详细描述您的合同需求",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(S,{modelValue:F.aiForm.coreElements,"onUpdate:modelValue":t[21]||(t[21]=e=>F.aiForm.coreElements=e),type:"textarea",rows:5,placeholder:"例如：请帮我起草一份软件开发服务合同。甲方是'未来科技有限公司'，乙方是'创新软件工作室'。合同需要明确开发周期为3个月，总费用为50万元人民币，分三次支付。第一次支付30%作为启动资金，第二次在完成中期里程碑后支付40%，剩余30%在项目验收通过后支付。还需要包括双方的权利义务、保密条款和违约责任等。"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):Object(c["createCommentVNode"])("",!0)]),_:1},8,["modelValue"]),Object(c["createVNode"])(X,{modelValue:F.showEditDialog,"onUpdate:modelValue":t[33]||(t[33]=e=>F.showEditDialog=e),title:"编辑合同",width:"70%"},{footer:Object(c["withCtx"])(()=>[Object(c["createVNode"])(A,{onClick:t[32]||(t[32]=e=>F.showEditDialog=!1)},{default:Object(c["withCtx"])(()=>t[49]||(t[49]=[Object(c["createTextVNode"])("取消")])),_:1}),Object(c["createVNode"])(A,{type:"primary",onClick:F.submitUpdate},{default:Object(c["withCtx"])(()=>t[50]||(t[50]=[Object(c["createTextVNode"])("保存")])),_:1},8,["onClick"])]),default:Object(c["withCtx"])(()=>[F.editForm?(Object(c["openBlock"])(),Object(c["createBlock"])(K,{key:0,model:F.editForm,"label-width":"100px"},{default:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",k,[Object(c["createElementVNode"])("div",_,[Object(c["createVNode"])(G,{label:"合同名称",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(S,{modelValue:F.editForm.title,"onUpdate:modelValue":t[24]||(t[24]=e=>F.editForm.title=e)},null,8,["modelValue"])]),_:1}),Object(c["createVNode"])(G,{label:"合同类型",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(U,{modelValue:F.editForm.type,"onUpdate:modelValue":t[25]||(t[25]=e=>F.editForm.type=e),placeholder:"请选择...",style:{width:"100%"}},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(T,{label:"采购合同",value:"采购合同"}),Object(c["createVNode"])(T,{label:"销售合同",value:"销售合同"}),Object(c["createVNode"])(T,{label:"服务合同",value:"服务合同"}),Object(c["createVNode"])(T,{label:"合作协议",value:"合作协议"}),Object(c["createVNode"])(T,{label:"租赁合同",value:"租赁合同"}),Object(c["createVNode"])(T,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),Object(c["createVNode"])(G,{label:"签约对方",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(S,{modelValue:F.editForm.company,"onUpdate:modelValue":t[26]||(t[26]=e=>F.editForm.company=e)},null,8,["modelValue"])]),_:1}),Object(c["createVNode"])(G,{label:"合同金额",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(S,{modelValue:F.editForm.amount,"onUpdate:modelValue":t[27]||(t[27]=e=>F.editForm.amount=e)},null,8,["modelValue"])]),_:1})]),Object(c["createElementVNode"])("div",E,[Object(c["createVNode"])(G,{label:"签约日期"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(H,{modelValue:F.editForm.sign_date,"onUpdate:modelValue":t[28]||(t[28]=e=>F.editForm.sign_date=e),type:"date",placeholder:"选择日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),Object(c["createVNode"])(G,{label:"生效日期"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(H,{modelValue:F.editForm.start_date,"onUpdate:modelValue":t[29]||(t[29]=e=>F.editForm.start_date=e),type:"date",placeholder:"选择日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),Object(c["createVNode"])(G,{label:"到期日期"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(H,{modelValue:F.editForm.expire_date,"onUpdate:modelValue":t[30]||(t[30]=e=>F.editForm.expire_date=e),type:"date",placeholder:"选择日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])]),Object(c["createVNode"])(G,{label:"备注"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(S,{modelValue:F.editForm.remark,"onUpdate:modelValue":t[31]||(t[31]=e=>F.editForm.remark=e),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):Object(c["createCommentVNode"])("",!0)]),_:1},8,["modelValue"]),Object(c["createVNode"])(X,{modelValue:F.showShareDialog,"onUpdate:modelValue":t[36]||(t[36]=e=>F.showShareDialog=e),title:"分享合同",width:"400px"},{footer:Object(c["withCtx"])(()=>[Object(c["createVNode"])(A,{onClick:t[35]||(t[35]=e=>F.showShareDialog=!1)},{default:Object(c["withCtx"])(()=>t[51]||(t[51]=[Object(c["createTextVNode"])("取消")])),_:1}),Object(c["createVNode"])(A,{type:"primary",onClick:F.submitShare},{default:Object(c["withCtx"])(()=>t[52]||(t[52]=[Object(c["createTextVNode"])("分享")])),_:1},8,["onClick"])]),default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(K,null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(G,{label:"分享给"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(U,{modelValue:F.shareTargetUsers,"onUpdate:modelValue":t[34]||(t[34]=e=>F.shareTargetUsers=e),multiple:"",filterable:"",placeholder:"请选择用户",style:{width:"100%"}},{default:Object(c["withCtx"])(()=>[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(F.availableUsers,e=>(Object(c["openBlock"])(),Object(c["createBlock"])(T,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}a("d9e2"),a("14d9"),a("e9f5"),a("910d"),a("7d54"),a("ab43"),a("1e70"),a("79a4"),a("c1a1"),a("8b00"),a("a4e7"),a("1e5a"),a("72c3");var D=a("f6f2"),B=a("3ef4"),S=a("c9a1"),T=a("90b1"),U=a("6605"),I=a("35ad"),z=a("d800"),A=a("4360"),$=a("b775");function P(e){return e?"string"===typeof e?e:e.toISOString().split("T")[0]:null}var L={name:"Contract",setup(){const e=Object(U["d"])(),t=Object(c["ref"])(""),a=Object(c["ref"])("default"),r=Object(c["ref"])("desc"),o=Object(c["ref"])(null),l=Object(c["ref"])(!1),n=Object(c["ref"])("template"),i=Object(c["ref"])(null),d=Object(c["ref"])(!1),u=Object(c["ref"])(!1),s=Object(c["ref"])(!1),b=Object(c["ref"])(null),m=Object(c["ref"])([]),p=Object(c["ref"])([]);let j=null;const O=Object(c["ref"])(1),f=Object(c["ref"])(0),h=Object(c["reactive"])({title:"",type:"",company:"",amount:"",signDate:"",startDate:"",expireDate:"",remark:""}),V=Object(c["reactive"])({contractType:"",industry:"",scene:"",title:"",company:"",amount:"",remark:""}),v=Object(c["reactive"])({coreElements:""}),w=Object(c["ref"])([]),C=Object(c["ref"])(!1),y=Object(c["ref"])([]),g=Object(c["ref"])([]),N=Object(c["ref"])([]),x=Object(c["ref"])([]),k=Object(c["ref"])([]),_=()=>{if(0===y.value.length)return void(w.value=[]);let e=y.value;const t=V.contractType||V.industry||V.scene;t?(V.contractType&&(e=e.filter(e=>e.contract_type===V.contractType)),V.industry&&(e=e.filter(e=>e.industry===V.industry)),V.scene&&(e=e.filter(e=>e.scene===V.scene)),w.value=e):w.value=y.value};Object(c["watch"])(()=>[V.contractType,V.industry,V.scene],_,{deep:!0});const E=async()=>{if(y.value.length>0)_();else{C.value=!0;try{const e=await Object(I["i"])({}),t=e.data.results||e.data||[],a=t.filter(e=>e.is_active);y.value=a;const c=new Set(a.map(e=>e.contract_type).filter(Boolean)),r=new Set(a.map(e=>e.industry).filter(Boolean)),o=new Set(a.map(e=>e.scene).filter(Boolean));N.value=Array.from(c).map(e=>({label:e,value:e})),x.value=Array.from(r).map(e=>({label:e,value:e})),k.value=Array.from(o).map(e=>({label:e,value:e})),_()}catch(e){console.error("获取合同模板失败:",e),B["a"].error("获取合同模板列表失败"),y.value=[],w.value=[]}finally{C.value=!1}}},F=async()=>{try{const[e,t,a]=await Promise.all([Object($["a"])({url:"/api/contract/types/",method:"get"}),Object($["a"])({url:"/api/contract/industries/",method:"get"}),Object($["a"])({url:"/api/contract/scenes/",method:"get"})]);N.value=e.data.map(e=>({label:e.name,value:e.name})),x.value=t.data.map(e=>({label:e.name,value:e.name})),k.value=a.data.map(e=>({label:e.name,value:e.name}))}catch(e){console.error("加载筛选选项失败:",e),B["a"].error("加载筛选选项失败，将使用默认值"),N.value=[{label:"采购合同",value:"采购合同"},{label:"销售合同",value:"销售合同"}],x.value=[{label:"信息技术",value:"信息技术"}],k.value=[{label:"国内贸易",value:"国内贸易"}]}},L=async()=>{try{d.value=!0;const e={search:t.value,page:O.value,page_size:10};"default"!==a.value&&(e.ordering=("desc"===r.value?"-":"")+a.value);const c=await Object(I["h"])(e),o=c.results.map(e=>({...e,createdAt:e.created_at?new Date(e.created_at).toLocaleString("zh-CN"):"",displayAmount:"￥"+Number(e.amount||0).toFixed(2)}));g.value=o,f.value=c.count}catch(e){console.error("加载合同列表失败:",e),B["a"].error("加载合同列表失败，请稍后重试")}finally{d.value=!1}},M=Object(c["computed"])(()=>g.value),q=()=>{J(),l.value=!0,E()},J=()=>{Object.keys(h).forEach(e=>{h[e]=""}),Object.keys(V).forEach(e=>{V[e]=""}),v.coreElements="",n.value="template",i.value=null},Q=()=>{switch(n.value){case"template":return"使用模板创建";case"ai":return"AI 生成合同";default:return"創建合同"}},W=t=>{t&&t.id&&(o.value=t,e.push({name:"ContractDetail",params:{id:t.id}}))},G=()=>{O.value=1,L()},R=e=>{"其他"===e&&(h.type="")},Y=(e,t)=>{i.value=t;const a=new Date,c=`${a.getFullYear()}/${a.getMonth()+1}/${a.getDate()}`;V.title=`${e.name}(${c})`},H=e=>{O.value=e,L()},K=e=>{b.value={...e},u.value=!0},X=async e=>{o.value=e,s.value=!0,m.value=[];try{var t;const e=null===(t=A["a"].getters.user)||void 0===t?void 0:t.company;if(!e)return void B["a"].error("无法获取公司信息，请重新登录");const a=await Object(I["f"])(e);p.value=a.data.filter(e=>{var t;return e.id!==(null===(t=A["a"].getters.user)||void 0===t?void 0:t.id)})}catch(a){B["a"].error("获取用户列表失败"),console.error("get user list error",a)}},Z=e=>{S["a"].confirm(`确定要删除合同 "${e.title}" 吗？此操作不可逆。`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Object(I["e"])(e.id),B["a"].success("合同已删除"),await L()}catch(t){B["a"].error("删除合同失败"),console.error(`delete contract ${e.id} failed`,t)}}).catch(()=>{})},ee=async()=>{if(b.value)try{const{id:e,title:t,type:a,company:c,amount:r,sign_date:o,start_date:l,expire_date:n,remark:i}=b.value,d={title:t,type:a,company:c,amount:Number(String(r).replace(/[^\d.]/g,""))||0,sign_date:P(o),start_date:P(l),expire_date:P(n),remark:i||""};await Object(I["j"])(e,d),B["a"].success("合同更新成功"),u.value=!1,await L()}catch(e){B["a"].error("更新失败"),console.error("update contract failed",e)}},te=async()=>{if(0===m.value.length)return void B["a"].warning("请选择要分享的用户");const e=T["a"].service({lock:!0,text:"正在分享...",background:"rgba(0, 0, 0, 0.7)"});try{var t;e.text="正在准备聊天...";const c=await Object(z["f"])(m.value),r=null===(t=c.data)||void 0===t?void 0:t.chat_id;if(!r)throw console.error("获取聊天会话ID失败，API响应:",c),new Error("无法获取聊天会话");e.text="正在生成合同文件...";const l=o.value;let n=null,i="";try{console.log("开始获取合同详情，ID:",l.id);const e=`/api/contract/contracts/${l.id}/download-docx/`;console.log("使用下载API获取Word文档:",e);const t=localStorage.getItem("token"),a=await Object($["a"])({url:e,method:"GET",responseType:"blob",headers:{Authorization:t?"Bearer "+t:""}});if(console.log("下载API响应:",a),!a||!a.data)throw new Error("下载API未返回有效数据");{n=new Blob([a.data],{type:a.headers["content-type"]||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"});const e=l.title||"未命名合同",t=a.headers["content-disposition"];if(t&&t.includes("filename=")){const a=t.match(/filename="?([^"]+)"?/);i=a&&a[1]?a[1]:e+".docx"}else i=e+".docx";console.log("成功获取Word文档，大小:",n.size,"字节","文件名:",i)}}catch(a){return console.error("获取合同文件失败:",a),B["a"].error("生成合同文件失败，无法获取合同内容"),void e.close()}if(!n||0===n.size)return console.error("生成Word文档失败：blob为空或大小为0"),B["a"].error("生成合同文件失败"),void e.close();e.text="正在发送文件...";const d=new FormData;d.append("file",n,i),d.append("chat",r),d.append("content","分享了合同: "+i),d.append("message_type","file"),await Object(z["i"])(d),B["a"].success("合同已成功分享"),s.value=!1}catch(a){console.error("分享合同失败:",a),B["a"].error("分享失败，请重试")}finally{e.close()}},ae=async()=>{if("template"===n.value&&null===i.value)return void B["a"].error("请选择一个模板");const e=T["a"].service({lock:!0,text:"提交中...",background:"rgba(0, 0, 0, 0.7)"});try{let a={};if("manual"===n.value){if(!h.title||!h.type||!h.company)return B["a"].error("请填写必填字段：合同名称、合同类型和签约对方"),void e.close();a={title:h.title,type:h.type,company:h.company,amount:h.amount?Number(h.amount.replace(/[^\d.]/g,"")):0,sign_date:P(h.signDate),start_date:P(h.startDate),expire_date:P(h.expireDate),remark:h.remark||"",status:"pending"}}else if("template"===n.value){if(null===i.value)return B["a"].error("请选择一个模板"),void e.close();if(!V.title)return B["a"].error("请填写合同标题"),void e.close();if(!V.company)return B["a"].error("请填写签约对方"),void e.close();const a=w.value[i.value];try{return await Object(I["d"])(a.id,{title:V.title,company:V.company,type:a.contract_type,amount:V.amount||0,remark:V.remark}),B["a"].success("合同已成功创建，请在列表中查看。"),l.value=!1,await L(),void e.close()}catch(t){throw console.error("使用模板创建合同失败:",t),t}}else if("ai"===n.value){if(!v.coreElements)return B["a"].error("请填写合同需求描述"),void e.close();a={description:v.coreElements,use_ai_agent:!0,status:"pending"}}console.log("提交合同数据:",JSON.stringify(a));let c=0;const r=3;while(c<r)try{const t="ai"===n.value?18e4:6e4;e.text="ai"===n.value?"正在使用AI生成合同，这可能需要一些时间...":"正在提交...";const c=new AbortController,r=setTimeout(()=>{c.abort()},t);await Object(I["c"])({...a,signal:c.signal}),clearTimeout(r);break}catch(t){if(console.error(`合同创建尝试 ${c+1} 失败:`,t),c++,c>=r)throw e.close(),new Error("合同创建失败，已达到最大重试次数: "+t.message);e.text=`尝试失败，正在重试 (${c}/${r})...`,await new Promise(e=>setTimeout(e,2e3))}"ai"===n.value?B["a"].success("AI生成合同任务已提交，请稍后在列表刷新查看。"):B["a"].success("合同已成功创建，请在列表中查看。"),await L(),l.value=!1}catch(t){console.error("提交合同失败:",t);let e="提交合同失败，请检查输入内容";if(t.response&&t.response.data){const c=t.response.data;if("string"===typeof c)e=c;else if("object"===typeof c)try{const t=Object.entries(c).map(([e,t])=>`${e}: ${Array.isArray(t)?t.join(", "):t}`).join("; ");e="提交失败: "+t}catch(a){console.error("解析错误详情失败:",a)}}else t.message&&(e=t.message);B["a"].error(e)}finally{e&&e.visible&&e.close()}};return Object(c["onMounted"])(()=>{L(),F()}),Object(c["watch"])(t,()=>{j&&clearTimeout(j),j=setTimeout(()=>{G()},500)}),{searchQuery:t,sortBy:a,sortOrder:r,selectedContract:o,contracts:g,filteredContracts:M,showNewContractDialog:l,creationMode:n,newContract:h,templateForm:V,aiForm:v,selectedTemplate:i,availableTemplates:w,isLoading:d,isLoadingTemplates:C,currentPage:O,totalItems:f,Plus:D["Plus"],Search:D["Search"],InfoFilled:D["InfoFilled"],MoreFilled:D["MoreFilled"],Edit:D["Edit"],Share:D["Share"],Delete:D["Delete"],openContractDialog:q,getSubmitButtonText:Q,submitContract:ae,viewContractDetail:W,handleFilterChange:G,handleContractTypeChange:R,handleTemplateSelect:Y,handleCurrentChange:H,handleEdit:K,handleShare:X,handleDelete:Z,submitUpdate:ee,submitShare:te,editForm:b,showEditDialog:u,showShareDialog:s,shareTargetUsers:m,availableUsers:p,contractTypes:N,industries:x,scenes:k}}},M=(a("3123"),a("6b0d")),q=a.n(M);const J=q()(L,[["render",F],["__scopeId","data-v-5cb79bf6"]]);t["default"]=J},e9bc:function(e,t,a){"use strict";var c=a("dc19"),r=a("cb27").add,o=a("83b9"),l=a("7f65"),n=a("5388");e.exports=function(e){var t=c(this),a=l(e).getIterator(),i=o(t);return n(a,(function(e){r(i,e)})),i}}}]);
//# sourceMappingURL=chunk-5c63176c.65f09c12.js.map