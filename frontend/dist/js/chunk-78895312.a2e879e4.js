(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-78895312","chunk-2d0e4842"],{"1f3f":function(e,t,a){"use strict";a.d(t,"e",(function(){return n})),a.d(t,"f",(function(){return o})),a.d(t,"d",(function(){return r})),a.d(t,"a",(function(){return c})),a.d(t,"g",(function(){return i})),a.d(t,"b",(function(){return d})),a.d(t,"c",(function(){return s}));var l=a("b775");function n(e,t){return Object(l["a"])({url:"/api/calendar/events/monthly/",method:"get",params:{year:e,month:t}})}function o(e){return Object(l["a"])({url:"/api/calendar/events/weekly/",method:"get",params:{date:e}})}function r(e){return Object(l["a"])({url:"/api/calendar/events/daily/",method:"get",params:{date:e}})}function c(e){const{title:t,start:a,end:n,location:o,description:r,type:c,reminder:i,participants:d}=e;return Object(l["a"])({url:"/api/calendar/events/",method:"post",data:{title:t,start:a,end:n,location:o,description:r,type:c,reminder:i,participants:d}})}function i(e,t){const{title:a,start:n,end:o,location:r,description:c,type:i,reminder:d,participants:s}=t;return Object(l["a"])({url:`/api/calendar/events/${e}/`,method:"put",data:{title:a,start:n,end:o,location:r,description:c,type:i,reminder:d,participants:s}})}function d(e){return Object(l["a"])({url:`/api/calendar/events/${e}/`,method:"delete"})}function s(e){return Object(l["a"])({url:`/api/calendar/events/${e}/`,method:"get"})}},"50fe":function(e,t,a){},"7e6b":function(e,t,a){"use strict";a.r(t);var l=a("7a23");const n={class:"calendar-header"},o={class:"date-controls"},r={class:"date-nav"},c={class:"current-date"},i={class:"view-controls"},d={class:"action-controls"},s={key:0,class:"calendar-main"},u={class:"calendar-weekdays"},v={class:"calendar-days"},b=["onClick"],m={class:"day-number"},p={class:"event-container"},O=["onMouseenter","onClick"],j=["onClick"],g={class:"event-preview-title"},y={class:"event-preview-time"},h={key:0,class:"event-preview-location"},w={key:1,class:"event-preview-desc"},E={key:0},V={class:"all-event-title"},f={class:"all-event-time"},k={key:0,class:"all-event-location"},D={key:1,class:"all-event-desc"},N={key:1,class:"calendar-week"},C={class:"week-header"},S={class:"week-day-name"},x={class:"week-day-date"},B={class:"week-body"},T={class:"week-time-scale"},M={class:"week-events-container"},Y={class:"week-all-day-events"},_=["onClick","onMouseenter"],$={class:"all-day-event-title"},F=["onClick","onMouseenter","onDragstart"],L={class:"week-event-title"},P={class:"week-event-time"},q=["onMousedown"],z={key:2,class:"calendar-day-view"},H={class:"day-header"},A={class:"day-date"},U={class:"day-body"},R={class:"day-time-scale"},I={class:"day-events-container"},G={class:"day-all-day-events"},J=["onClick","onMouseenter"],K={class:"all-day-event-title"},X=["onClick","onMouseenter","onDragstart"],Q={class:"day-event-title"},W={class:"day-event-time"},Z={key:0,class:"day-event-location"},ee=["onMousedown"],te={class:"dialog-footer"},ae={class:"event-details"},le={class:"event-detail-item"},ne={key:0,class:"event-detail-item"},oe={key:1,class:"event-detail-item"},re={class:"event-description"},ce={class:"event-detail-item"},ie={class:"dialog-footer"},de={class:"dialog-footer"};function se(e,t,a,se,ue,ve){const be=Object(l["resolveComponent"])("el-button"),me=Object(l["resolveComponent"])("el-radio-button"),pe=Object(l["resolveComponent"])("el-radio-group"),Oe=Object(l["resolveComponent"])("Plus"),je=Object(l["resolveComponent"])("el-icon"),ge=Object(l["resolveComponent"])("el-timeline-item"),ye=Object(l["resolveComponent"])("el-timeline"),he=Object(l["resolveComponent"])("el-dialog"),we=Object(l["resolveComponent"])("el-input"),Ee=Object(l["resolveComponent"])("el-form-item"),Ve=Object(l["resolveComponent"])("el-date-picker"),fe=Object(l["resolveComponent"])("el-option"),ke=Object(l["resolveComponent"])("el-select"),De=Object(l["resolveComponent"])("el-form");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{class:"calendar-container",key:se.internalRefreshKey},[Object(l["createElementVNode"])("div",n,[Object(l["createElementVNode"])("div",o,[Object(l["createVNode"])(be,{type:"primary",onClick:se.today},{default:Object(l["withCtx"])(()=>t[33]||(t[33]=[Object(l["createTextVNode"])("今天")])),_:1},8,["onClick"]),Object(l["createElementVNode"])("div",r,[Object(l["createVNode"])(be,{icon:se.ArrowLeft,plain:"",onClick:se.prev},null,8,["icon","onClick"]),Object(l["createElementVNode"])("span",c,Object(l["toDisplayString"])(se.currentDateLabel),1),Object(l["createVNode"])(be,{icon:se.ArrowRight,plain:"",onClick:se.next},null,8,["icon","onClick"])])]),Object(l["createElementVNode"])("div",i,[Object(l["createVNode"])(pe,{modelValue:se.calendarView,"onUpdate:modelValue":t[0]||(t[0]=e=>se.calendarView=e),size:"small"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(me,{value:"month"},{default:Object(l["withCtx"])(()=>t[34]||(t[34]=[Object(l["createTextVNode"])("月")])),_:1}),Object(l["createVNode"])(me,{value:"week"},{default:Object(l["withCtx"])(()=>t[35]||(t[35]=[Object(l["createTextVNode"])("周")])),_:1}),Object(l["createVNode"])(me,{value:"day"},{default:Object(l["withCtx"])(()=>t[36]||(t[36]=[Object(l["createTextVNode"])("日")])),_:1})]),_:1},8,["modelValue"])]),Object(l["createElementVNode"])("div",d,[Object(l["createVNode"])(be,{type:"primary",onClick:t[1]||(t[1]=e=>se.showAddEventDialog(e))},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(je,null,{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(Oe)]),_:1}),t[37]||(t[37]=Object(l["createTextVNode"])(" 新建日程 "))]),_:1})])]),"month"===se.calendarView?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",s,[Object(l["createElementVNode"])("div",u,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(se.weekDays,(e,t)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{class:"weekday",key:t},Object(l["toDisplayString"])(e),1))),128))]),Object(l["createElementVNode"])("div",v,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(se.days,(e,a)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:a,class:Object(l["normalizeClass"])(["calendar-day",{today:e.isToday,"other-month":!e.isCurrentMonth,"has-events":e.events&&e.events.length>0}]),onClick:t=>se.selectDay(e)},[Object(l["createElementVNode"])("div",m,Object(l["toDisplayString"])(e.date),1),Object(l["createElementVNode"])("div",p,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.events.slice(0,3),(e,a)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:a,class:Object(l["normalizeClass"])(["event-item","event-"+e.type]),onMouseenter:t=>se.showEventPreview(e,t),onMouseleave:t[2]||(t[2]=(...e)=>se.hideEventPreview&&se.hideEventPreview(...e)),onClick:Object(l["withModifiers"])(t=>se.showEventDetails(e),["stop"])},[Object(l["createElementVNode"])("span",{class:"event-color",style:Object(l["normalizeStyle"])({background:se.eventTypeColor(e.type)})},null,4),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.title),1)],42,O))),128)),e.events&&e.events.length>3?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:0,class:"more-events-indicator",onClick:Object(l["withModifiers"])(t=>se.showAllEvents(e),["stop"])}," 查看全部 "+Object(l["toDisplayString"])(e.events.length)+" 个日程 ",9,j)):Object(l["createCommentVNode"])("",!0)])],10,b))),128))]),se.eventPreview.visible?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:0,class:"event-preview-pop",style:Object(l["normalizeStyle"])(se.eventPreview.style)},[Object(l["createElementVNode"])("div",g,Object(l["toDisplayString"])(se.eventPreview.event.title),1),Object(l["createElementVNode"])("div",y,Object(l["toDisplayString"])(se.formatEventTime(se.eventPreview.event)),1),se.eventPreview.event.location?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",h,[t[38]||(t[38]=Object(l["createElementVNode"])("i",{class:"bi bi-geo-alt"},null,-1)),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(se.eventPreview.event.location),1)])):Object(l["createCommentVNode"])("",!0),se.eventPreview.event.description?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",w,Object(l["toDisplayString"])(se.eventPreview.event.description),1)):Object(l["createCommentVNode"])("",!0)],4)):Object(l["createCommentVNode"])("",!0),Object(l["createVNode"])(he,{modelValue:se.allEventsDialog.visible,"onUpdate:modelValue":t[3]||(t[3]=e=>se.allEventsDialog.visible=e),title:se.allEventsDialog.title,width:"400px",onClose:t[4]||(t[4]=e=>se.allEventsDialog.date=null)},{default:Object(l["withCtx"])(()=>[0===se.allEventsForDialog.length?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",E,"暂无日程")):(Object(l["openBlock"])(),Object(l["createBlock"])(ye,{key:1},{default:Object(l["withCtx"])(()=>[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(se.allEventsForDialog,(e,a)=>(Object(l["openBlock"])(),Object(l["createBlock"])(ge,{key:a,color:se.eventTypeColor(e.type)},{default:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",V,Object(l["toDisplayString"])(e.title),1),Object(l["createElementVNode"])("div",f,Object(l["toDisplayString"])(se.formatEventTime(e)),1),e.location?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",k,[t[39]||(t[39]=Object(l["createElementVNode"])("i",{class:"bi bi-geo-alt"},null,-1)),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.location),1)])):Object(l["createCommentVNode"])("",!0),e.description?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",D,Object(l["toDisplayString"])(e.description),1)):Object(l["createCommentVNode"])("",!0),Object(l["createVNode"])(be,{size:"mini",type:"link",onClick:t=>se.showEventDetails(e)},{default:Object(l["withCtx"])(()=>t[40]||(t[40]=[Object(l["createTextVNode"])("详情")])),_:2},1032,["onClick"])]),_:2},1032,["color"]))),128))]),_:1}))]),_:1},8,["modelValue","title"])])):Object(l["createCommentVNode"])("",!0),"week"===se.calendarView?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",N,[Object(l["createElementVNode"])("div",C,[t[41]||(t[41]=Object(l["createElementVNode"])("div",{class:"week-time-col"},null,-1)),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(se.weekDates,(e,t)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:t,class:Object(l["normalizeClass"])(["week-day-col",{today:e.isToday}])},[Object(l["createElementVNode"])("div",S,Object(l["toDisplayString"])(e.dayName),1),Object(l["createElementVNode"])("div",x,Object(l["toDisplayString"])(e.date),1)],2))),128))]),Object(l["createElementVNode"])("div",B,[Object(l["createElementVNode"])("div",T,[(Object(l["openBlock"])(),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(24,e=>Object(l["createElementVNode"])("div",{key:e,class:"time-slot"},Object(l["toDisplayString"])(e-1)+":00 ",1)),64))]),Object(l["createElementVNode"])("div",M,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(se.weekDates,(e,a)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:a,class:"week-day-events"},[Object(l["createElementVNode"])("div",Y,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.allDayEvents,(e,a)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:"all-day-"+a,class:Object(l["normalizeClass"])(["week-all-day-event","event-"+e.type]),onClick:t=>se.showEventDetails(e),onMouseenter:t=>se.showEventPreview(e,t),onMouseleave:t[5]||(t[5]=(...e)=>se.hideEventPreview&&se.hideEventPreview(...e))},[Object(l["createElementVNode"])("span",{class:"event-color",style:Object(l["normalizeStyle"])({background:se.eventTypeColor(e.type)})},null,4),Object(l["createElementVNode"])("span",$,Object(l["toDisplayString"])(e.title),1)],42,_))),128))]),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e.eventGroups,(a,n)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:"group-"+n,class:"week-event-group",style:Object(l["normalizeStyle"])({left:n*(100/e.eventGroups.length)+"%",width:100/e.eventGroups.length+"%"})},[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(a,(e,a)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:a,class:Object(l["normalizeClass"])(["week-event","event-"+e.type]),style:Object(l["normalizeStyle"])({top:se.calcEventTop(e)+"px",height:se.calcEventHeight(e)+"px"}),onClick:t=>se.showEventDetails(e),onMouseenter:t=>se.showEventPreview(e,t),onMouseleave:t[6]||(t[6]=(...e)=>se.hideEventPreview&&se.hideEventPreview(...e)),draggable:"true",onDragstart:t=>se.dragStart(t,e),onDragend:t[7]||(t[7]=(...e)=>se.dragEnd&&se.dragEnd(...e))},[Object(l["createElementVNode"])("span",{class:"event-color",style:Object(l["normalizeStyle"])({background:se.eventTypeColor(e.type)})},null,4),Object(l["createElementVNode"])("div",L,Object(l["toDisplayString"])(e.title),1),Object(l["createElementVNode"])("div",P,Object(l["toDisplayString"])(se.formatEventTime(e)),1),Object(l["createElementVNode"])("div",{class:"resize-handle bottom",onMousedown:t=>se.startResize(t,e)},null,40,q)],46,F))),128))],4))),128))]))),128))])])])):Object(l["createCommentVNode"])("",!0),"day"===se.calendarView?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",z,[Object(l["createElementVNode"])("div",H,[Object(l["createElementVNode"])("div",A,Object(l["toDisplayString"])(se.currentDate.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",weekday:"long"})),1)]),Object(l["createElementVNode"])("div",U,[Object(l["createElementVNode"])("div",R,[(Object(l["openBlock"])(),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(24,e=>Object(l["createElementVNode"])("div",{key:e,class:"time-slot"},Object(l["toDisplayString"])(e-1)+":00 ",1)),64))]),Object(l["createElementVNode"])("div",I,[Object(l["createElementVNode"])("div",G,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(se.allDayEvents,(e,a)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:"all-day-"+a,class:Object(l["normalizeClass"])(["day-all-day-event","event-"+e.type]),onClick:t=>se.showEventDetails(e),onMouseenter:t=>se.showEventPreview(e,t),onMouseleave:t[8]||(t[8]=(...e)=>se.hideEventPreview&&se.hideEventPreview(...e))},[Object(l["createElementVNode"])("span",{class:"event-color",style:Object(l["normalizeStyle"])({background:se.eventTypeColor(e.type)})},null,4),Object(l["createElementVNode"])("span",K,Object(l["toDisplayString"])(e.title),1)],42,J))),128))]),(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(se.dayEventGroups,(e,a)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:"group-"+a,class:"day-event-group",style:Object(l["normalizeStyle"])({left:a*(100/se.dayEventGroups.length)+"%",width:100/se.dayEventGroups.length+"%"})},[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(e,(e,a)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:a,class:Object(l["normalizeClass"])(["day-event","event-"+e.type]),style:Object(l["normalizeStyle"])({top:se.calcEventTop(e)+"px",height:se.calcEventHeight(e)+"px"}),onClick:t=>se.showEventDetails(e),onMouseenter:t=>se.showEventPreview(e,t),onMouseleave:t[9]||(t[9]=(...e)=>se.hideEventPreview&&se.hideEventPreview(...e)),draggable:"true",onDragstart:t=>se.dragStart(t,e),onDragend:t[10]||(t[10]=(...e)=>se.dragEnd&&se.dragEnd(...e))},[Object(l["createElementVNode"])("span",{class:"event-color",style:Object(l["normalizeStyle"])({background:se.eventTypeColor(e.type)})},null,4),Object(l["createElementVNode"])("div",Q,Object(l["toDisplayString"])(e.title),1),Object(l["createElementVNode"])("div",W,Object(l["toDisplayString"])(se.formatEventTime(e)),1),e.location?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",Z,[t[42]||(t[42]=Object(l["createElementVNode"])("i",{class:"bi bi-geo-alt"},null,-1)),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(e.location),1)])):Object(l["createCommentVNode"])("",!0),Object(l["createElementVNode"])("div",{class:"resize-handle bottom",onMousedown:t=>se.startResize(t,e)},null,40,ee)],46,X))),128))],4))),128))])])])):Object(l["createCommentVNode"])("",!0),Object(l["createVNode"])(he,{modelValue:se.addEventDialogVisible,"onUpdate:modelValue":t[20]||(t[20]=e=>se.addEventDialogVisible=e),title:"新建日程",width:"500px",class:"calendar-dialog","append-to-body":!0,"destroy-on-close":!1,"close-on-click-modal":!1},{footer:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",te,[Object(l["createVNode"])(be,{onClick:t[19]||(t[19]=e=>se.addEventDialogVisible=!1)},{default:Object(l["withCtx"])(()=>t[43]||(t[43]=[Object(l["createTextVNode"])("取消")])),_:1}),Object(l["createVNode"])(be,{type:"primary",onClick:se.addEvent},{default:Object(l["withCtx"])(()=>t[44]||(t[44]=[Object(l["createTextVNode"])("确定")])),_:1},8,["onClick"])])]),default:Object(l["withCtx"])(()=>[se.addEventDialogVisible?(Object(l["openBlock"])(),Object(l["createBlock"])(De,{key:0,model:se.newEvent,"label-width":"80px",rules:se.rules,ref:"addEventFormRef"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(Ee,{label:"标题",prop:"title",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(we,{modelValue:se.newEvent.title,"onUpdate:modelValue":t[11]||(t[11]=e=>se.newEvent.title=e),placeholder:"请输入日程标题"},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(Ee,{label:"开始时间",prop:"start",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(Ve,{modelValue:se.newEvent.start,"onUpdate:modelValue":t[12]||(t[12]=e=>se.newEvent.start=e),type:"datetime",placeholder:"选择开始时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm",onChange:t[13]||(t[13]=e=>se.handleStartTimeChange(se.newEvent))},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(Ee,{label:"结束时间",prop:"end",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(Ve,{modelValue:se.newEvent.end,"onUpdate:modelValue":t[14]||(t[14]=e=>se.newEvent.end=e),type:"datetime",placeholder:"选择结束时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm"},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(Ee,{label:"地点",prop:"location",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(we,{modelValue:se.newEvent.location,"onUpdate:modelValue":t[15]||(t[15]=e=>se.newEvent.location=e),placeholder:"请输入地点"},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(Ee,{label:"类型",prop:"type",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(ke,{modelValue:se.newEvent.type,"onUpdate:modelValue":t[16]||(t[16]=e=>se.newEvent.type=e),placeholder:"请选择日程类型"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(fe,{label:"会议",value:"blue"}),Object(l["createVNode"])(fe,{label:"出差",value:"orange"}),Object(l["createVNode"])(fe,{label:"假期",value:"green"}),Object(l["createVNode"])(fe,{label:"截止日期",value:"red"}),Object(l["createVNode"])(fe,{label:"其他",value:"purple"})]),_:1},8,["modelValue"])]),_:1}),Object(l["createVNode"])(Ee,{label:"提醒",prop:"reminder",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(ke,{modelValue:se.newEvent.reminder,"onUpdate:modelValue":t[17]||(t[17]=e=>se.newEvent.reminder=e),placeholder:"请选择提醒时间"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(fe,{label:"不提醒",value:"none"}),Object(l["createVNode"])(fe,{label:"10分钟前",value:"10min"}),Object(l["createVNode"])(fe,{label:"30分钟前",value:"30min"}),Object(l["createVNode"])(fe,{label:"1小时前",value:"1hour"}),Object(l["createVNode"])(fe,{label:"1天前",value:"1day"})]),_:1},8,["modelValue"])]),_:1}),Object(l["createVNode"])(Ee,{label:"备注",prop:"description",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(we,{modelValue:se.newEvent.description,"onUpdate:modelValue":t[18]||(t[18]=e=>se.newEvent.description=e),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])):Object(l["createCommentVNode"])("",!0)]),_:1},8,["modelValue"]),Object(l["createVNode"])(he,{modelValue:se.eventDetailsDialogVisible,"onUpdate:modelValue":t[22]||(t[22]=e=>se.eventDetailsDialogVisible=e),title:se.selectedEvent.title,width:"500px",class:"calendar-dialog"},{footer:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",ie,[Object(l["createVNode"])(be,{onClick:t[21]||(t[21]=e=>se.eventDetailsDialogVisible=!1)},{default:Object(l["withCtx"])(()=>t[49]||(t[49]=[Object(l["createTextVNode"])("关闭")])),_:1}),Object(l["createVNode"])(be,{type:"primary",onClick:se.showEditEventDialog},{default:Object(l["withCtx"])(()=>t[50]||(t[50]=[Object(l["createTextVNode"])("编辑")])),_:1},8,["onClick"]),Object(l["createVNode"])(be,{type:"danger",onClick:se.deleteEvent},{default:Object(l["withCtx"])(()=>t[51]||(t[51]=[Object(l["createTextVNode"])("删除")])),_:1},8,["onClick"])])]),default:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",ae,[Object(l["createElementVNode"])("div",le,[t[45]||(t[45]=Object(l["createElementVNode"])("i",{class:"bi bi-clock"},null,-1)),Object(l["createElementVNode"])("span",null,Object(l["toDisplayString"])(se.formatEventDateTime(se.selectedEvent)),1)]),se.selectedEvent.location?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",ne,[t[46]||(t[46]=Object(l["createElementVNode"])("i",{class:"bi bi-geo-alt"},null,-1)),Object(l["createElementVNode"])("span",null,Object(l["toDisplayString"])(se.selectedEvent.location),1)])):Object(l["createCommentVNode"])("",!0),se.selectedEvent.description?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",oe,[t[47]||(t[47]=Object(l["createElementVNode"])("i",{class:"bi bi-card-text"},null,-1)),Object(l["createElementVNode"])("div",re,Object(l["toDisplayString"])(se.selectedEvent.description),1)])):Object(l["createCommentVNode"])("",!0),Object(l["createElementVNode"])("div",ce,[t[48]||(t[48]=Object(l["createElementVNode"])("i",{class:"bi bi-bell"},null,-1)),Object(l["createElementVNode"])("span",null,Object(l["toDisplayString"])(se.formatReminder(se.selectedEvent.reminder)),1)])])]),_:1},8,["modelValue","title"]),Object(l["createVNode"])(he,{modelValue:se.editEventDialogVisible,"onUpdate:modelValue":t[32]||(t[32]=e=>se.editEventDialogVisible=e),title:"编辑日程",width:"500px",class:"calendar-dialog"},{footer:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",de,[Object(l["createVNode"])(be,{onClick:t[31]||(t[31]=e=>se.editEventDialogVisible=!1)},{default:Object(l["withCtx"])(()=>t[52]||(t[52]=[Object(l["createTextVNode"])("取消")])),_:1}),Object(l["createVNode"])(be,{type:"primary",onClick:se.saveEditEvent},{default:Object(l["withCtx"])(()=>t[53]||(t[53]=[Object(l["createTextVNode"])("保存")])),_:1},8,["onClick"])])]),default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(De,{model:se.editingEvent,"label-width":"80px",rules:se.rules,ref:"editEventFormRef"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(Ee,{label:"标题",prop:"title",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(we,{modelValue:se.editingEvent.title,"onUpdate:modelValue":t[23]||(t[23]=e=>se.editingEvent.title=e),placeholder:"请输入日程标题"},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(Ee,{label:"开始时间",prop:"start",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(Ve,{modelValue:se.editingEvent.start,"onUpdate:modelValue":t[24]||(t[24]=e=>se.editingEvent.start=e),type:"datetime",placeholder:"选择开始时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm",onChange:t[25]||(t[25]=e=>se.handleStartTimeChange(se.editingEvent))},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(Ee,{label:"结束时间",prop:"end",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(Ve,{modelValue:se.editingEvent.end,"onUpdate:modelValue":t[26]||(t[26]=e=>se.editingEvent.end=e),type:"datetime",placeholder:"选择结束时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm"},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(Ee,{label:"地点",prop:"location",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(we,{modelValue:se.editingEvent.location,"onUpdate:modelValue":t[27]||(t[27]=e=>se.editingEvent.location=e),placeholder:"请输入地点"},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(Ee,{label:"类型",prop:"type",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(ke,{modelValue:se.editingEvent.type,"onUpdate:modelValue":t[28]||(t[28]=e=>se.editingEvent.type=e),placeholder:"请选择日程类型"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(fe,{label:"会议",value:"blue"}),Object(l["createVNode"])(fe,{label:"出差",value:"orange"}),Object(l["createVNode"])(fe,{label:"假期",value:"green"}),Object(l["createVNode"])(fe,{label:"截止日期",value:"red"}),Object(l["createVNode"])(fe,{label:"其他",value:"purple"})]),_:1},8,["modelValue"])]),_:1}),Object(l["createVNode"])(Ee,{label:"提醒",prop:"reminder",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(ke,{modelValue:se.editingEvent.reminder,"onUpdate:modelValue":t[29]||(t[29]=e=>se.editingEvent.reminder=e),placeholder:"请选择提醒时间"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(fe,{label:"不提醒",value:"none"}),Object(l["createVNode"])(fe,{label:"10分钟前",value:"10min"}),Object(l["createVNode"])(fe,{label:"30分钟前",value:"30min"}),Object(l["createVNode"])(fe,{label:"1小时前",value:"1hour"}),Object(l["createVNode"])(fe,{label:"1天前",value:"1day"})]),_:1},8,["modelValue"])]),_:1}),Object(l["createVNode"])(Ee,{label:"备注",prop:"description",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(we,{modelValue:se.editingEvent.description,"onUpdate:modelValue":t[30]||(t[30]=e=>se.editingEvent.description=e),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}a("d9e2"),a("14d9"),a("e9f5"),a("910d"),a("7d54"),a("ab43");var ue=a("6605"),ve=a("3ef4"),be=a("c9a1"),me=a("f6f2"),pe=a("1f3f"),Oe={name:"Calendar",setup(){const e=Object(ue["c"])(),t=Object(l["ref"])("month"),a=Object(l["ref"])(new Date),n=Object(l["ref"])([]),o=Object(l["ref"])(null),r=Object(l["ref"])(null),c={title:[{required:!0,message:"请输入日程标题",trigger:"blur"}],start:[{required:!0,message:"请选择开始时间",trigger:"change"}],end:[{required:!0,message:"请选择结束时间",trigger:"change"}],location:[{required:!0,message:"请输入地点",trigger:"blur"}],type:[{required:!0,message:"请选择日程类型",trigger:"change"}],reminder:[{required:!0,message:"请选择提醒时间",trigger:"change"}],description:[{required:!0,message:"请输入备注信息",trigger:"blur"}]},i=Object(l["computed"])(()=>{const e={year:"numeric",month:"long"};return"week"===t.value?`${a.value.getFullYear()}年${a.value.getMonth()+1}月第${Math.ceil((a.value.getDate()+R(a.value).getDay())/7)}周`:"day"===t.value?a.value.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}):a.value.toLocaleDateString("zh-CN",e)}),d=Object(l["ref"])(["日","一","二","三","四","五","六"]),s=Object(l["ref"])(!1),u=Object(l["ref"])(!1),v=Object(l["ref"])(!1),b=Object(l["ref"])({title:"",start:"",end:"",location:"",type:"blue",reminder:"30min",description:""}),m=Object(l["ref"])({}),p=Object(l["ref"])({id:"",title:"",start:"",end:"",location:"",type:"blue",reminder:"30min",description:""}),O=Object(l["computed"])(()=>{const e=[],t=new Date,l=R(a.value).getDay(),n=I(a.value),o=I(new Date(a.value.getFullYear(),a.value.getMonth()-1));for(let c=l-1;c>=0;c--){const l=o-c,n=new Date(a.value.getFullYear(),a.value.getMonth()-1,l);e.push({date:l,isCurrentMonth:!1,isToday:U(n,t),events:A(n)})}for(let c=1;c<=n;c++){const l=new Date(a.value.getFullYear(),a.value.getMonth(),c);e.push({date:c,isCurrentMonth:!0,isToday:U(l,t),events:A(l)})}const r=42-e.length;for(let c=1;c<=r;c++){const l=new Date(a.value.getFullYear(),a.value.getMonth()+1,c);e.push({date:c,isCurrentMonth:!1,isToday:U(l,t),events:A(l)})}return e}),j=Object(l["computed"])(()=>{const e=[],t=new Date(a.value),l=t.getDay();t.setDate(t.getDate()-l);for(let a=0;a<7;a++){const l=new Date(t);l.setDate(t.getDate()+a);const n=A(l),o=w(n);e.push({date:l.getDate(),dayName:d.value[a],isToday:U(l,new Date),fullDate:l,events:n,allDayEvents:[],eventGroups:o})}return e}),g=Object(l["computed"])(()=>A(a.value)),y=Object(l["computed"])(()=>[]),h=Object(l["computed"])(()=>w(g.value)),w=e=>{if(!e.length)return[[]];const t=[...e].sort((e,t)=>e.start.getTime()-t.start.getTime()),a=[];return t.forEach(e=>{let t=!1;for(let l=0;l<a.length;l++){const n=a[l],o=n[n.length-1];if(o&&e.start.getTime()>=o.end.getTime()){n.push(e),t=!0;break}}t||a.push([e])}),a.length?a:[[]]},E=Object(l["computed"])(()=>ne.value.date?n.value.filter(e=>U(new Date(e.start),ne.value.date)).sort((e,t)=>e.start-t.start):[]),V=Object(l["ref"])(!1),f=Object(l["ref"])(0),k=Object(l["ref"])(0),D=3,N=async()=>{if(!Ee.value)return;const e=Date.now();if(e-f.value<300)console.log("请求频率过高，跳过此次加载");else{f.value=e,V.value=!0,console.log("正在加载日程数据...");try{"month"===t.value?await C():"week"===t.value?await S():"day"===t.value&&await x(),k.value=0}catch(a){console.error("加载日程失败:",a),k.value<D?(k.value++,console.log(`正在重试加载日程 (${k.value}/${D})...`),setTimeout(N,500)):(ve["a"].error("加载日程失败，请刷新页面重试"),k.value=0)}finally{V.value=!1}}},C=async()=>{const e=a.value.getFullYear(),t=a.value.getMonth()+1;console.log(`正在加载${e}年${t}月的日程数据...`);try{const a=await Object(pe["e"])(e,t);if(a&&(a.success||a.data)){const e=a.data||[];return n.value=B(e),console.log(`成功加载${n.value.length}个月视图日程`),a}throw new Error("返回数据格式不正确")}catch(l){throw console.error("加载月视图日程失败:",l),l}},S=async()=>{const e=T(a.value);console.log(`正在加载${e}所在周的日程数据...`);try{const t=await Object(pe["f"])(e);if(t&&(t.success||t.data)){const e=t.data||[];return n.value=B(e),console.log(`成功加载${n.value.length}个周视图日程`),t}throw new Error("返回数据格式不正确")}catch(t){throw console.error("加载周视图日程失败:",t),t}},x=async()=>{const e=T(a.value);console.log(`正在加载${e}的日程数据...`);try{const t=await Object(pe["d"])(e);if(t&&(t.success||t.data)){const e=t.data||[];return n.value=B(e),console.log(`成功加载${n.value.length}个日视图日程`),t}throw new Error("返回数据格式不正确")}catch(t){throw console.error("加载日视图日程失败:",t),t}},B=e=>e.map(e=>({id:e.id,title:e.title,start:new Date(e.start),end:new Date(e.end),location:e.location,type:e.type,reminder:e.reminder,description:e.description,creator:e.creator,creator_name:e.creator_name,participants:e.participants,participants_info:e.participants_info})),T=e=>{const t=e.getFullYear(),a=(e.getMonth()+1).toString().padStart(2,"0"),l=e.getDate().toString().padStart(2,"0");return`${t}-${a}-${l}`},M=e=>{e.isCurrentMonth||(e.date>15?_():$())},Y=()=>{a.value=new Date},_=()=>{const e=new Date(a.value);"month"===t.value?e.setMonth(e.getMonth()-1):"week"===t.value?e.setDate(e.getDate()-7):"day"===t.value&&e.setDate(e.getDate()-1),a.value=e},$=()=>{const e=new Date(a.value);"month"===t.value?e.setMonth(e.getMonth()+1):"week"===t.value?e.setDate(e.getDate()+7):"day"===t.value&&e.setDate(e.getDate()+1),a.value=e},F=e=>{e&&(e.preventDefault(),e.stopPropagation()),console.log("打开新建日程对话框",(new Date).toISOString());try{const e=new Date,t=new Date(e.getTime()+36e5);s.value=!0,b.value={title:"",start:W(e),end:W(t),location:"",type:"blue",reminder:"30min",description:""},console.log("已打开对话框",s.value)}catch(t){console.error("打开新建日程对话框失败:",t),s.value=!1,setTimeout(()=>{s.value=!0,console.log("对话框重试打开")},100)}},L=async()=>{console.log("提交日程表单数据:",b.value),o.value?o.value.validate(async e=>{if(e)try{const e=new Date(b.value.start).getTime(),t=new Date(b.value.end).getTime();if(isNaN(e)||isNaN(t)){console.error("日期转换失败，尝试修复",{start:b.value.start,end:b.value.end});const e=new Date,t=new Date(e.getTime()+36e5);return b.value.start=W(e),b.value.end=W(t),void ve["a"].warning("日期格式有误，已重置为当前时间")}if(e>t)return void ve["a"].warning("结束时间不能早于开始时间");const a=new Date(b.value.start).toDateString(),l=new Date(b.value.end).toDateString();if(a!==l)return void ve["a"].warning("开始和结束时间必须在同一天");const n=Number(localStorage.getItem("user_id")||0);console.log("当前用户ID:",n);const o={title:b.value.title.trim(),start:b.value.start,end:b.value.end,location:(b.value.location||"").trim(),type:b.value.type||"blue",reminder:b.value.reminder||"30min",description:(b.value.description||"").trim(),participants:n?[n]:[]};console.log("正在提交日程数据:",o),s.value=!1,ve["a"].info("正在创建日程...");const r=await Object(pe["a"])(o);console.log("服务器响应:",r),r.success||r.data&&!r.message?(ve["a"].success("日程添加成功"),await N()):(ve["a"].error(r.message||"日程添加失败"),console.error("添加失败详情:",r))}catch(t){console.error("添加日程失败:",t),ve["a"].error("日程添加失败："+(t.message||"未知错误"))}else ve["a"].error("请填写所有必填项")}):console.error("表单引用不存在")},P=e=>{m.value=e,u.value=!0},q=()=>{p.value={id:m.value.id,title:m.value.title,start:W(m.value.start),end:W(m.value.end),location:m.value.location||"",type:m.value.type,reminder:m.value.reminder,description:m.value.description||""},u.value=!1,v.value=!0},z=async()=>{r.value?r.value.validate(async e=>{if(!e)return void ve["a"].error("请填写所有必填项");const t=new Date(p.value.start).getTime(),a=new Date(p.value.end).getTime();if(t>a)return void ve["a"].warning("结束时间不能早于开始时间");const l=new Date(p.value.start).toDateString(),n=new Date(p.value.end).toDateString();if(l===n)try{const e=Number(localStorage.getItem("user_id")||0),t={title:p.value.title,start:p.value.start,end:p.value.end,location:p.value.location,type:p.value.type,reminder:p.value.reminder,description:p.value.description,participants:e?[e]:[]};console.log("更新日程数据:",t);const a=await Object(pe["g"])(p.value.id,t);a.success?(ve["a"].success("日程更新成功"),v.value=!1,N()):ve["a"].error(a.message||"日程更新失败")}catch(o){console.error("更新日程失败:",o),ve["a"].error("日程更新失败")}else ve["a"].warning("开始和结束时间必须在同一天")}):console.error("表单引用不存在")},H=async()=>{if(m.value.id&&!isNaN(m.value.id)){console.log("尝试删除日程，id=",m.value.id);try{var e;await be["a"].confirm("确定要删除该日程吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=await Object(pe["b"])(m.value.id);var t;if(204===a.status||null!==(e=a.data)&&void 0!==e&&e.success)ve["a"].success("日程删除成功"),u.value=!1,N();else ve["a"].error((null===(t=a.data)||void 0===t?void 0:t.message)||"日程删除失败"),console.error("删除失败详细信息:",a.data)}catch(n){if("cancel"!==n){var a,l;const e=(null===(a=n.response)||void 0===a||null===(l=a.data)||void 0===l?void 0:l.message)||n.message||"未知错误";console.error("删除日程失败:",n.response||n),ve["a"].error("日程删除失败: "+e)}}}else ve["a"].error("日程ID无效，无法删除")},A=e=>n.value.filter(t=>U(new Date(t.start),e)),U=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),R=e=>new Date(e.getFullYear(),e.getMonth(),1),I=e=>new Date(e.getFullYear(),e.getMonth()+1,0).getDate(),G=e=>{if(!e||!e.start)return 0;try{const t=e.start.getHours(),a=e.start.getMinutes();return(60*t+a)/15*15}catch(t){return console.error("计算事件位置错误:",t),0}},J=e=>{if(!e||!e.start||!e.end)return 60;try{const t=e.start.getTime(),a=e.end.getTime(),l=(a-t)/6e4;return Math.max(l/15*15,30)}catch(t){return console.error("计算事件高度错误:",t),60}},K=e=>{const t=e.start,a=e.end;return`${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")} - ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`},X=e=>{if(!e.start||!e.end)return"";const t={year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"};return`${e.start.toLocaleDateString("zh-CN",t)} - ${e.end.toLocaleDateString("zh-CN",t)}`},Q=e=>{switch(e){case"none":return"不提醒";case"10min":return"10分钟前";case"30min":return"30分钟前";case"1hour":return"1小时前";case"1day":return"1天前";default:return"未设置"}},W=e=>{if(!e)return"";try{let t;e instanceof Date?isNaN(e.getTime())?(console.error("无效日期对象",e),t=new Date):t=e:(t=new Date(e),isNaN(t.getTime())&&(console.error("无效日期字符串",e),t=new Date));const a=t.getFullYear(),l=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0"),o=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0"),c=`${a}-${l}-${n} ${o}:${r}`;return console.log(`格式化日期: ${t} => ${c}`),c}catch(t){console.error("日期格式化错误:",t);const e=new Date;return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}},Z=e=>{if(e.start)try{const t=new Date(e.start),a=new Date(t.getTime()+36e5);(!e.end||new Date(e.end)<t||new Date(e.end).toDateString()!==t.toDateString())&&(e.end=W(a))}catch(t){console.error("处理开始时间变化错误:",t)}},ee=e=>{const t={blue:"#409EFF",orange:"#E6A23C",green:"#67C23A",red:"#F56C6C",purple:"#909399",default:"#606266"};return t[e]||t.default},te=Object(l["ref"])({visible:!1,event:{},style:{}}),ae=(e,t)=>{te.value={visible:!0,event:e,style:{position:"fixed",left:t.clientX+10+"px",top:t.clientY+10+"px",zIndex:9999}}},le=()=>{te.value.visible=!1},ne=Object(l["ref"])({visible:!1,date:null,title:""}),oe=e=>{const t=a.value.getFullYear();let l=a.value.getMonth();e.isCurrentMonth||(l=e.date>15?l-1:l+1);const n=new Date(t,l,e.date);ne.value={visible:!0,date:n,title:`${n.getFullYear()}年${n.getMonth()+1}月${e.date}日全部日程`}},re=Object(l["ref"])(null),ce=Object(l["ref"])(null),ie=Object(l["ref"])(0),de=Object(l["ref"])(0),se=(e,t)=>{re.value=t;const a=document.createElement("div");a.textContent=t.title,a.className="drag-image",document.body.appendChild(a),e.dataTransfer.setDragImage(a,0,0),e.dataTransfer.setData("text/plain",JSON.stringify({id:t.id,startTime:t.start.getTime(),endTime:t.end.getTime()})),setTimeout(()=>{document.querySelectorAll(".week-day-events, .day-events-container").forEach(e=>{e.addEventListener("dragover",Oe),e.addEventListener("drop",je)}),document.body.removeChild(a)},0)},Oe=e=>{if(e.preventDefault(),!re.value)return;const t=e.currentTarget,a=t.getBoundingClientRect(),l=e.clientY-a.top,n=Math.floor(l/15),o=Math.floor(n/4),r=n%4*15,c=document.querySelector(".drag-preview")||document.createElement("div");c.classList.contains("drag-preview")||(c.className="drag-preview",t.appendChild(c)),c.style.top=15*n+"px",c.style.height=J(re.value)+"px",c.innerHTML=`${o}:${r.toString().padStart(2,"0")}`},je=async e=>{if(e.preventDefault(),!re.value)return;document.querySelectorAll(".drag-preview").forEach(e=>e.remove());const t=e.currentTarget,a=t.getBoundingClientRect(),l=e.clientY-a.top,n=Math.floor(l/15),o=Math.floor(n/4),r=n%4*15,c=new Date(re.value.start);c.setHours(o,r,0,0);const i=c.getTime()-re.value.start.getTime(),d=new Date(re.value.end.getTime()+i);try{const e={title:re.value.title,start:W(c),end:W(d),location:re.value.location,type:re.value.type,reminder:re.value.reminder,description:re.value.description,participants:re.value.participants||[]},t=await Object(pe["g"])(re.value.id,e);t.success?(ve["a"].success("日程时间已更新"),N()):ve["a"].error(t.message||"更新日程时间失败")}catch(s){console.error("更新日程失败:",s),ve["a"].error("更新日程时间失败")}},ge=()=>{re.value=null,document.querySelectorAll(".week-day-events, .day-events-container").forEach(e=>{e.removeEventListener("dragover",Oe),e.removeEventListener("drop",je)}),document.querySelectorAll(".drag-preview").forEach(e=>e.remove())},ye=(e,t)=>{e.stopPropagation(),ce.value=t,ie.value=e.clientY,de.value=J(t),document.addEventListener("mousemove",he),document.addEventListener("mouseup",we)},he=e=>{if(!ce.value)return;const t=e.clientY-ie.value,a=Math.max(30,de.value+t),l=15*Math.floor(a/15),n=new Date(ce.value.start.getTime()+60*l*1e3),o=e.target.closest(".week-event, .day-event");if(o){o.style.height=a+"px";const e=o.querySelector(".week-event-time, .day-event-time");if(e){const t=`${ce.value.start.getHours().toString().padStart(2,"0")}:${ce.value.start.getMinutes().toString().padStart(2,"0")}`,a=`${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`;e.textContent=`${t} - ${a}`}}},we=async e=>{if(!ce.value)return;document.removeEventListener("mousemove",he),document.removeEventListener("mouseup",we);const t=e.clientY-ie.value,a=Math.max(30,de.value+t),l=15*Math.floor(a/15),n=new Date(ce.value.start.getTime()+60*l*1e3);try{const e={title:ce.value.title,start:W(ce.value.start),end:W(n),location:ce.value.location,type:ce.value.type,reminder:ce.value.reminder,description:ce.value.description,participants:ce.value.participants||[]},t=await Object(pe["g"])(ce.value.id,e);t.success?(ve["a"].success("日程时长已更新"),N()):ve["a"].error(t.message||"更新日程时长失败")}catch(o){console.error("更新日程失败:",o),ve["a"].error("更新日程时长失败")}ce.value=null},Ee=Object(l["ref"])(!1),Ve=Object(l["ref"])(Date.now()),fe=async()=>{console.log("强制刷新日历组件"),Ve.value=Date.now();try{const e=document.querySelectorAll(".el-overlay, .el-overlay-dialog, .el-overlay-message-box, .el-popup-parent--hidden");e.forEach(e=>{if(e&&e.parentNode)try{e.parentNode.removeChild(e)}catch(t){console.error("清理浮层元素失败:",t)}}),document&&document.body&&(document.body.style.overflow="",document.body.classList.remove("el-popup-parent--hidden"),document.body.style.pointerEvents="auto");const t=document.querySelectorAll(".el-dropdown-menu, .el-select-dropdown");t.forEach(e=>{if(e&&e.parentNode)try{e.parentNode.removeChild(e)}catch(t){console.error("清理下拉菜单失败:",t)}})}catch(e){console.error("清理DOM元素失败:",e)}await Object(l["nextTick"])();try{const e=document.querySelectorAll(".calendar-container button, .el-dropdown-menu__item, .event-item, .calendar-day, .el-dropdown, .week-event, .day-event");e.forEach(e=>{if(e){e.style.pointerEvents="auto",e.hasAttribute("disabled")&&!e.classList.contains("is-disabled")&&e.removeAttribute("disabled");try{e.style.opacity="1",e.style.visibility="visible",e.style.display=""}catch(t){console.error("重置元素样式失败:",t)}}});const t=document.querySelector(".action-controls .el-button");t&&(console.log("重新绑定添加按钮事件"),t.addEventListener("click",e=>{e.stopPropagation(),F(e)}))}catch(e){console.error("重置交互元素失败:",e)}try{console.log("重新加载日历数据..."),await N().catch(e=>(console.error("强制刷新日历数据失败:",e),[])),console.log("日历数据刷新完成")}catch(e){console.error("强制刷新数据失败:",e)}};Object(l["watch"])(()=>e.fullPath,e=>{"/calendar"===e&&(console.log("检测到路由变化到日历页面，强制刷新"),setTimeout(()=>{fe()},100))}),Object(l["watch"])(()=>t.value,e=>{console.log("日历视图变更为:",e),Object(l["nextTick"])(()=>N())}),Object(l["watch"])(()=>a.value,e=>{console.log("当前日期变更为:",e.toLocaleDateString()),Object(l["nextTick"])(()=>N())});const{proxy:ke}=Object(l["getCurrentInstance"])(),De=ke.emitter;return Object(l["onMounted"])(()=>{console.log("Calendar组件挂载"),Ee.value=!0,setTimeout(()=>{N(),console.log("延迟初始化完成")},50);const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(console.log("Calendar组件进入可视区域，检查初始化状态"),0===n.value.length&&(console.log("日程数据为空，尝试重新加载"),N()))})}),t=document.querySelector(".calendar-container");t&&e.observe(t);const a=document.querySelector(".action-controls .el-button");a&&(console.log("找到添加按钮，增强点击处理"),a.addEventListener("click",e=>{e.stopPropagation(),F(e)})),console.log("日历组件已挂载，开始监听刷新事件"),De.on("refreshCalendar",N)}),Object(l["onUnmounted"])(()=>{console.log("日历组件将卸载，移除刷新事件监听器"),De.off("refreshCalendar",N)}),Object(l["onActivated"])(()=>{console.log("Calendar组件被激活"),fe()}),Object(l["onBeforeUnmount"])(()=>{}),{calendarView:t,currentDate:a,currentDateLabel:i,weekDays:d,days:O,weekDates:j,dayEvents:g,addEventDialogVisible:s,eventDetailsDialogVisible:u,editEventDialogVisible:v,newEvent:b,selectedEvent:m,editingEvent:p,addEventFormRef:o,editEventFormRef:r,rules:c,today:Y,prev:_,next:$,selectDay:M,showAddEventDialog:F,addEvent:L,showEventDetails:P,showEditEventDialog:q,saveEditEvent:z,deleteEvent:H,calcEventTop:G,calcEventHeight:J,formatEventTime:K,formatEventDateTime:X,formatReminder:Q,ArrowLeft:me["ArrowLeft"],ArrowRight:me["ArrowRight"],Plus:me["Plus"],handleStartTimeChange:Z,eventTypeColor:ee,eventPreview:te,showEventPreview:ae,hideEventPreview:le,allEventsDialog:ne,showAllEvents:oe,allDayEvents:y,dayEventGroups:h,organizeOverlappingEvents:w,dragStart:se,dragEnd:ge,startResize:ye,allEventsForDialog:E,internalRefreshKey:Ve,forceRefresh:fe}}},je=(a("dac4"),a("6b0d")),ge=a.n(je);const ye=ge()(Oe,[["render",se],["__scopeId","data-v-44868fbc"]]);t["default"]=ye},"910d":function(e,t,a){"use strict";var l=a("23e7"),n=a("c65b"),o=a("59ed"),r=a("825a"),c=a("46c4"),i=a("c5cc"),d=a("9bdd"),s=a("c430"),u=a("2a62"),v=a("f99f"),b=!s&&v("filter",TypeError),m=i((function(){var e,t,a,l=this.iterator,o=this.predicate,c=this.next;while(1){if(e=r(n(c,l)),t=this.done=!!e.done,t)return;if(a=e.value,d(l,o,[a,this.counter++],!0))return a}}));l({target:"Iterator",proto:!0,real:!0,forced:s||b},{filter:function(e){r(this);try{o(e)}catch(t){u(this,"throw",t)}return b?n(b,this,e):new m(c(this),{predicate:e})}})},dac4:function(e,t,a){"use strict";a("50fe")}}]);
//# sourceMappingURL=chunk-78895312.a2e879e4.js.map