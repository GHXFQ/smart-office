(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7bb95057"],{"1b67":function(e,t,a){"use strict";a("24f2")},"1e5a":function(e,t,a){"use strict";var c=a("23e7"),r=a("9961"),n=a("dad2");c({target:"Set",proto:!0,real:!0,forced:!n("symmetricDifference")},{symmetricDifference:r})},"1e70":function(e,t,a){"use strict";var c=a("23e7"),r=a("a5f7"),n=a("dad2"),o=!n("difference",(function(e){return 0===e.size}));c({target:"Set",proto:!0,real:!0,forced:o},{difference:r})},"24f2":function(e,t,a){},"2eaa":function(e,t,a){},"384f":function(e,t,a){"use strict";var c=a("e330"),r=a("5388"),n=a("cb27"),o=n.Set,l=n.proto,i=c(l.forEach),u=c(l.keys),d=u(new o).next;e.exports=function(e,t,a){return a?r({iterator:u(e),next:d},t):i(e,t)}},"395e":function(e,t,a){"use strict";var c=a("dc19"),r=a("cb27").has,n=a("8e16"),o=a("7f65"),l=a("5388"),i=a("2a62");e.exports=function(e){var t=c(this),a=o(e);if(n(t)<a.size)return!1;var u=a.getIterator();return!1!==l(u,(function(e){if(!r(t,e))return i(u,"normal",!1)}))}},"3e4b":function(e,t,a){"use strict";a.r(t);a("e9f5"),a("d866"),a("f665"),a("7d54"),a("ab43"),a("a732"),a("1e70"),a("79a4"),a("c1a1"),a("8b00"),a("a4e7"),a("1e5a"),a("72c3");var c=a("7a23"),r=a("50fc"),n=a("3ef4"),o=a("c9a1"),l=a("4c02"),i=a("54bb"),u=a("c349"),d=a("cf2e"),s=a("1e49"),b=a("7faf"),f=a("db9d"),O=a("d09f"),j=a("d8e8"),p=a("91c0"),m=a("cf53"),v=a("727a"),g=a("f80f"),h=a("f6f2");const w={class:"management-container"},y={class:"card-header"},V={class:"header-left"},C={class:"header-right"},N={class:"category-dialog-content"},k={class:"category-list-section"},x={class:"section-header"},_={key:0,class:"category-items"},B={key:1,class:"category-items"},S=["onClick"],D={class:"category-info"},E={class:"category-name-section"},T={class:"category-actions"},z={class:"category-form-section"},K={class:"section-header"},F={style:{display:"flex","align-items":"center"}},U={key:0},$={class:"file-info"},I={style:{display:"inline-block"}},R={class:"build-footer"};var L={__name:"KnowledgeManagement",setup(e){const t=Object(c["ref"])([]),a=Object(c["ref"])([]),L=Object(c["ref"])([]),M=Object(c["ref"])(!0),A=Object(c["ref"])(""),q=Object(c["ref"])(0),P=Object(c["reactive"])({page:1,pageSize:10}),J=Object(c["ref"])(!1),G=Object(c["ref"])(!1),H=Object(c["ref"])({}),Q=Object(c["ref"])(null),W=Object(c["computed"])(()=>!!H.value.id),X=[{name:"Document",label:"文档",component:h["Document"]},{name:"Folder",label:"文件夹",component:h["Folder"]},{name:"DataAnalysis",label:"数据分析",component:h["DataAnalysis"]},{name:"TrendCharts",label:"趋势图",component:h["TrendCharts"]},{name:"Reading",label:"阅读",component:h["Reading"]},{name:"MagicStick",label:"魔术棒",component:h["MagicStick"]}],Y=Object(c["ref"])(!1),Z=Object(c["ref"])({}),ee=Object(c["ref"])(null),te=Object(c["ref"])([]),ae=Object(c["ref"])(null),ce=Object(c["ref"])(!1),re=Object(c["ref"])(!1),ne=Object(c["ref"])([]),oe=Object(c["ref"])(!1),le=Object(c["ref"])([]),ie=Object(c["ref"])(new Set);let ue=null,de=null;const se=async()=>{try{const e=await r["a"].getKnowledgeCategories({all:"true"});a.value=e.data}catch(e){n["a"].error("获取分类列表失败")}},be=async()=>{try{const e=await r["a"].getCompanies({all:"true"});L.value=e.data}catch(e){n["a"].error("获取公司列表失败")}},fe=async()=>{await be(),await se(),je(),J.value=!0},Oe=()=>{var e;G.value=!1,H.value={},null===(e=Q.value)||void 0===e||e.resetFields()},je=()=>{var e;H.value={id:null,name:"",description:"",icon:"Document",color:"#409EFF",company:null},null===(e=Q.value)||void 0===e||e.resetFields()},pe=e=>{H.value={...e}},me=async()=>{try{H.value.id?await r["a"].updateKnowledgeCategory(H.value.id,H.value):await r["a"].createKnowledgeCategory(H.value),n["a"].success("分类保存成功"),Oe(),se()}catch(e){n["a"].error("保存分类失败")}},ve=e=>{o["a"].confirm(`确定要删除分类 "${e.name}" 吗?`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await r["a"].deleteKnowledgeCategory(e.id),n["a"].success("分类删除成功"),se()}catch(t){n["a"].error("删除分类失败")}})},ge=()=>{clearTimeout(de),de=setTimeout(()=>{P.page=1,he()},300)},he=async()=>{M.value=!0;try{const e={page:P.page,size:P.pageSize,search:A.value},a=await r["a"].getKnowledgeBases(e);t.value=a.data.results,q.value=a.data.count}catch(e){n["a"].error("获取文章列表失败"),t.value=[],q.value=0}finally{M.value=!1}},we=async(e={})=>{await be(),Z.value={...e},e.id?ce.value=!1:ce.value=!0,Z.value.company?await xe(Z.value.company):te.value=[],Y.value=!0},ye=()=>{var e,t;Y.value=!1,Z.value={},te.value=[],null===(e=ae.value)||void 0===e||e.clearFiles(),null===(t=ee.value)||void 0===t||t.resetFields()},Ve=async()=>{try{const e={...Z.value};if(!e.id&&!e.original_file)return void n["a"].error("请选择一个文件上传");e.id?await r["a"].updateKnowledgeBase(e.id,e):await r["a"].createKnowledgeBase(e),n["a"].success("文件信息保存成功"),ye(),he()}catch(t){var e;const a=null!==(e=t.response)&&void 0!==e&&e.data?JSON.stringify(t.response.data):"保存文件信息失败";n["a"].error(a)}},Ce=e=>{o["a"].confirm(`确定要删除文件 "${e.title}" 吗? 这将一并删除关联的文件和数据。`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await r["a"].deleteKnowledgeBase(e.id),n["a"].success("文件删除成功"),he()}catch(t){n["a"].error("删除文件失败")}})},Ne=e=>{P.page=e,he()},ke=async e=>{Z.value.category=null,te.value=[],e&&await xe(e)},xe=async e=>{try{const t=await r["a"].getKnowledgeCategories({all:"true",company_id:e});te.value=t.data}catch(t){n["a"].error("获取该公司下的分类失败")}},_e=e=>{Z.value.original_file=e.raw},Be=()=>{Z.value.original_file=null},Se=()=>{re.value=!0,De()},De=async()=>{oe.value=!0;try{const e=await r["a"].getKnowledgeBuildStatus();ne.value=e.data}catch(e){n["a"].error("获取构建状态失败")}finally{oe.value=!1}},Ee=e=>{le.value=e.map(e=>e.company_id)},Te=async e=>{if(0!==e.length)try{const t=await r["a"].buildKnowledgeForCompanies(e);n["a"].success(t.data.message||"构建任务已启动"),e.forEach(e=>ie.value.add(e)),De(),ze()}catch(t){n["a"].error("启动构建任务失败")}},ze=()=>{ue||(ue=setInterval(async()=>{await De();const e=ne.value.some(e=>"processing"===e.status||"pending"===e.status);e||(Ke(),ie.value.clear(),n["a"].info("所有构建任务已完成。"))},5e3))},Ke=()=>{ue&&(clearInterval(ue),ue=null)},Fe=e=>{switch(e){case"completed":return"success";case"processing":return"primary";case"pending":return"warning";case"failed":return"danger";default:return"info"}},Ue=e=>{const t={completed:"成功",processing:"构建中",pending:"等待中",failed:"失败",not_built:"未构建"};return t[e]||"未知"},$e=e=>{var t;const a=null===(t=ne.value.find(t=>t.company_id===e))||void 0===t?void 0:t.status;return"processing"===a||"pending"===a},Ie=e=>{const t=e.every(e=>{const t=ne.value.find(t=>t.company_id===e);return t&&t.file_count>0});return!t||e.some(e=>$e(e))},Re=e=>e.file_count>0;return Object(c["onMounted"])(()=>{he()}),(e,r)=>{const n=Object(c["resolveComponent"])("el-tag"),o=Object(c["resolveDirective"])("loading");return Object(c["openBlock"])(),Object(c["createElementBlock"])("div",w,[Object(c["createVNode"])(Object(c["unref"])(l["a"]),{class:"box-card"},{header:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",y,[Object(c["createElementVNode"])("div",V,[Object(c["createVNode"])(Object(c["unref"])(i["a"]),{class:"header-icon"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(h["Collection"]))]),_:1}),r[17]||(r[17]=Object(c["createElementVNode"])("span",null,"知识库管理",-1))]),Object(c["createElementVNode"])("div",C,[Object(c["createVNode"])(Object(c["unref"])(u["a"]),{modelValue:A.value,"onUpdate:modelValue":r[0]||(r[0]=e=>A.value=e),placeholder:"搜索知识库文章...",clearable:"",onClear:he,onInput:ge,class:"search-input"},{append:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(d["a"]),{icon:Object(c["unref"])(h["Search"])},null,8,["icon"])]),_:1},8,["modelValue"]),Object(c["createVNode"])(Object(c["unref"])(d["a"]),{type:"success",onClick:Se},{default:Object(c["withCtx"])(()=>r[18]||(r[18]=[Object(c["createTextVNode"])("构建知识库")])),_:1}),Object(c["createVNode"])(Object(c["unref"])(d["a"]),{type:"info",onClick:r[1]||(r[1]=e=>fe())},{default:Object(c["withCtx"])(()=>r[19]||(r[19]=[Object(c["createTextVNode"])("管理分类")])),_:1}),Object(c["createVNode"])(Object(c["unref"])(d["a"]),{type:"primary",icon:Object(c["unref"])(h["Upload"]),onClick:r[2]||(r[2]=e=>we())},{default:Object(c["withCtx"])(()=>r[20]||(r[20]=[Object(c["createTextVNode"])("上传文件")])),_:1},8,["icon"])])])]),default:Object(c["withCtx"])(()=>[Object(c["withDirectives"])((Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["unref"])(s["a"]),{data:t.value,border:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(s["b"]),{prop:"title",label:"标题","min-width":"200"}),Object(c["createVNode"])(Object(c["unref"])(s["b"]),{prop:"original_filename",label:"文件名","min-width":"200"}),Object(c["createVNode"])(Object(c["unref"])(s["b"]),{prop:"category_name",label:"分类",width:"120"}),Object(c["createVNode"])(Object(c["unref"])(s["b"]),{prop:"company_name",label:"所属公司",width:"150"}),Object(c["createVNode"])(Object(c["unref"])(s["b"]),{prop:"creator_name",label:"上传者",width:"120"}),Object(c["createVNode"])(Object(c["unref"])(s["b"]),{prop:"created_at",label:"上传时间",width:"180"},{default:Object(c["withCtx"])(e=>[Object(c["createTextVNode"])(Object(c["toDisplayString"])(new Date(e.row.created_at).toLocaleString()),1)]),_:1}),Object(c["createVNode"])(Object(c["unref"])(s["b"]),{label:"操作",width:"150",fixed:"right"},{default:Object(c["withCtx"])(e=>[Object(c["createVNode"])(Object(c["unref"])(d["a"]),{size:"small",icon:Object(c["unref"])(h["Edit"]),onClick:t=>we(e.row)},null,8,["icon","onClick"]),Object(c["createVNode"])(Object(c["unref"])(d["a"]),{size:"small",type:"danger",icon:Object(c["unref"])(h["Delete"]),onClick:t=>Ce(e.row)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[o,M.value]]),Object(c["createVNode"])(Object(c["unref"])(b["a"]),{background:"",layout:"prev, pager, next, total",total:q.value,"page-size":P.pageSize,"current-page":P.page,onCurrentChange:Ne,style:{"margin-top":"20px","text-align":"right"}},null,8,["total","page-size","current-page"])]),_:1}),Object(c["createVNode"])(Object(c["unref"])(f["a"]),{modelValue:J.value,"onUpdate:modelValue":r[8]||(r[8]=e=>J.value=e),title:"管理分类",width:"60%"},{default:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",N,[Object(c["createElementVNode"])("div",k,[Object(c["createElementVNode"])("div",x,[r[22]||(r[22]=Object(c["createElementVNode"])("h5",null,"已有分类",-1)),Object(c["createVNode"])(Object(c["unref"])(d["a"]),{type:"primary",size:"small",onClick:je},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(i["a"]),null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(h["Plus"]))]),_:1}),r[21]||(r[21]=Object(c["createTextVNode"])(" 新增分类 "))]),_:1})]),a.value.length?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",B,[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(a.value,e=>(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",{key:e.id,class:Object(c["normalizeClass"])(["category-list-item",{selected:H.value.id===e.id}]),onClick:t=>pe(e)},[Object(c["createElementVNode"])("div",D,[Object(c["createElementVNode"])("div",{class:"category-icon",style:Object(c["normalizeStyle"])({"background-color":e.color})},[Object(c["createVNode"])(Object(c["unref"])(i["a"]),null,{default:Object(c["withCtx"])(()=>[(Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["resolveDynamicComponent"])(e.icon||"Document")))]),_:2},1024)],4),Object(c["createElementVNode"])("span",E,Object(c["toDisplayString"])(e.name),1)]),Object(c["createElementVNode"])("div",T,[Object(c["createVNode"])(Object(c["unref"])(d["a"]),{type:"primary",size:"small",plain:"",icon:Object(c["unref"])(h["Edit"]),onClick:Object(c["withModifiers"])(t=>pe(e),["stop"])},null,8,["icon","onClick"]),Object(c["createVNode"])(Object(c["unref"])(d["a"]),{type:"danger",size:"small",plain:"",icon:Object(c["unref"])(h["Delete"]),onClick:Object(c["withModifiers"])(t=>ve(e),["stop"])},null,8,["icon","onClick"])])],10,S))),128))])):(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",_,[Object(c["createVNode"])(Object(c["unref"])(O["a"]),{description:"暂无分类"})]))]),Object(c["createElementVNode"])("div",z,[Object(c["createElementVNode"])("div",K,[Object(c["createElementVNode"])("h5",null,Object(c["toDisplayString"])(W.value?"编辑分类":"新增分类"),1),W.value?(Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["unref"])(d["a"]),{key:0,text:"",onClick:je},{default:Object(c["withCtx"])(()=>r[23]||(r[23]=[Object(c["createTextVNode"])("取消")])),_:1})):Object(c["createCommentVNode"])("",!0)]),Object(c["createVNode"])(Object(c["unref"])(j["a"]),{model:H.value,ref_key:"categoryForm",ref:Q,"label-position":"top"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(j["b"]),{label:"分类名称",prop:"name",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(u["a"]),{modelValue:H.value.name,"onUpdate:modelValue":r[3]||(r[3]=e=>H.value.name=e)},null,8,["modelValue"])]),_:1}),Object(c["createVNode"])(Object(c["unref"])(j["b"]),{label:"所属公司",prop:"company",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(p["c"]),{modelValue:H.value.company,"onUpdate:modelValue":r[4]||(r[4]=e=>H.value.company=e),placeholder:"请选择公司",style:{width:"100%"}},{default:Object(c["withCtx"])(()=>[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(L.value,e=>(Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["unref"])(p["a"]),{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Object(c["createVNode"])(Object(c["unref"])(j["b"]),{label:"分类描述",prop:"description"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(u["a"]),{modelValue:H.value.description,"onUpdate:modelValue":r[5]||(r[5]=e=>H.value.description=e),type:"textarea"},null,8,["modelValue"])]),_:1}),Object(c["createVNode"])(Object(c["unref"])(j["b"]),{label:"图标",prop:"icon"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(p["c"]),{modelValue:H.value.icon,"onUpdate:modelValue":r[6]||(r[6]=e=>H.value.icon=e),placeholder:"选择一个图标",style:{width:"100%"}},{default:Object(c["withCtx"])(()=>[(Object(c["openBlock"])(),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(X,e=>Object(c["createVNode"])(Object(c["unref"])(p["a"]),{key:e.name,label:e.label,value:e.name},{default:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",F,[Object(c["createVNode"])(Object(c["unref"])(i["a"]),{style:{"margin-right":"8px"}},{default:Object(c["withCtx"])(()=>[(Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["resolveDynamicComponent"])(e.component)))]),_:2},1024),Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(e.label),1)])]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),Object(c["createVNode"])(Object(c["unref"])(j["b"]),{label:"颜色",prop:"color"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(m["a"]),{modelValue:H.value.color,"onUpdate:modelValue":r[7]||(r[7]=e=>H.value.color=e)},null,8,["modelValue"])]),_:1}),Object(c["createVNode"])(Object(c["unref"])(j["b"]),null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(d["a"]),{type:"primary",onClick:me},{default:Object(c["withCtx"])(()=>r[24]||(r[24]=[Object(c["createTextVNode"])("保存")])),_:1}),W.value?Object(c["createCommentVNode"])("",!0):(Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["unref"])(d["a"]),{key:0,onClick:je},{default:Object(c["withCtx"])(()=>r[25]||(r[25]=[Object(c["createTextVNode"])("重置")])),_:1}))]),_:1})]),_:1},8,["model"])])])]),_:1},8,["modelValue"]),Object(c["createVNode"])(Object(c["unref"])(f["a"]),{modelValue:Y.value,"onUpdate:modelValue":r[14]||(r[14]=e=>Y.value=e),title:Z.value.id?"编辑文件信息":"上传新文件",width:"50%"},{footer:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(d["a"]),{onClick:ye},{default:Object(c["withCtx"])(()=>r[29]||(r[29]=[Object(c["createTextVNode"])("取消")])),_:1}),Object(c["createVNode"])(Object(c["unref"])(d["a"]),{type:"primary",onClick:Ve},{default:Object(c["withCtx"])(()=>r[30]||(r[30]=[Object(c["createTextVNode"])("保存")])),_:1})]),default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(j["a"]),{model:Z.value,ref_key:"articleForm",ref:ee,"label-width":"80px"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(j["b"]),{label:"标题",prop:"title",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(u["a"]),{modelValue:Z.value.title,"onUpdate:modelValue":r[9]||(r[9]=e=>Z.value.title=e)},null,8,["modelValue"])]),_:1}),Object(c["createVNode"])(Object(c["unref"])(j["b"]),{label:"公司",prop:"company",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(p["c"]),{modelValue:Z.value.company,"onUpdate:modelValue":r[10]||(r[10]=e=>Z.value.company=e),placeholder:"请选择公司",style:{width:"100%"},onChange:ke},{default:Object(c["withCtx"])(()=>[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(L.value,e=>(Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["unref"])(p["a"]),{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Object(c["createVNode"])(Object(c["unref"])(j["b"]),{label:"分类",prop:"category"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(p["c"]),{modelValue:Z.value.category,"onUpdate:modelValue":r[11]||(r[11]=e=>Z.value.category=e),placeholder:"可选，请先选择公司",style:{width:"100%"},disabled:!Z.value.company,clearable:""},{default:Object(c["withCtx"])(()=>[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(te.value,e=>(Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["unref"])(p["a"]),{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),Object(c["createVNode"])(Object(c["unref"])(j["b"]),{label:"描述",prop:"description"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(u["a"]),{modelValue:Z.value.description,"onUpdate:modelValue":r[12]||(r[12]=e=>Z.value.description=e),type:"textarea"},null,8,["modelValue"])]),_:1}),Object(c["createVNode"])(Object(c["unref"])(j["b"]),{label:"文件",prop:"original_file"},{default:Object(c["withCtx"])(()=>[Z.value.id&&Z.value.original_filename&&!ce.value?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",U,[Object(c["createElementVNode"])("span",$,"当前文件: "+Object(c["toDisplayString"])(Z.value.original_filename)+" ("+Object(c["toDisplayString"])(Z.value.file_size)+" KB)",1),Object(c["createVNode"])(Object(c["unref"])(d["a"]),{onClick:r[13]||(r[13]=e=>ce.value=!0),type:"primary",link:"",style:{"margin-left":"10px"}},{default:Object(c["withCtx"])(()=>r[26]||(r[26]=[Object(c["createTextVNode"])("替换文件")])),_:1})])):(Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["unref"])(v["a"]),{key:1,ref_key:"upload",ref:ae,action:"#","auto-upload":!1,"on-change":_e,"on-remove":Be,limit:1,class:"upload-component"},{trigger:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(d["a"]),{type:"primary"},{default:Object(c["withCtx"])(()=>r[27]||(r[27]=[Object(c["createTextVNode"])("选择文件")])),_:1})]),tip:Object(c["withCtx"])(()=>r[28]||(r[28]=[Object(c["createElementVNode"])("div",{class:"el-upload__tip"}," 只能上传单个文件，文件大小不应超过系统限制。 ",-1)])),_:1},512))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),Object(c["createVNode"])(Object(c["unref"])(f["a"]),{modelValue:re.value,"onUpdate:modelValue":r[16]||(r[16]=e=>re.value=e),title:"构建公司知识库",width:"70%",onClose:Ke},{footer:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",R,[Object(c["createVNode"])(Object(c["unref"])(d["a"]),{type:"primary",onClick:r[15]||(r[15]=e=>Te(le.value)),disabled:0===le.value.length||Ie(le.value)},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])(" 构建选中 ("+Object(c["toDisplayString"])(le.value.length)+") ",1)]),_:1},8,["disabled"]),Object(c["createVNode"])(Object(c["unref"])(d["a"]),{onClick:De,icon:Object(c["unref"])(h["Refresh"])},{default:Object(c["withCtx"])(()=>r[33]||(r[33]=[Object(c["createTextVNode"])("刷新状态")])),_:1},8,["icon"])])]),default:Object(c["withCtx"])(()=>[Object(c["withDirectives"])((Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["unref"])(s["a"]),{data:ne.value,onSelectionChange:Ee,border:"","row-key":"company_id"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(s["b"]),{type:"selection",width:"55",selectable:Re}),Object(c["createVNode"])(Object(c["unref"])(s["b"]),{prop:"company_name",label:"公司名称"}),Object(c["createVNode"])(Object(c["unref"])(s["b"]),{prop:"file_count",label:"文件数",width:"80"}),Object(c["createVNode"])(Object(c["unref"])(s["b"]),{prop:"status",label:"构建状态"},{default:Object(c["withCtx"])(e=>[0===e.row.file_count?(Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["unref"])(g["a"]),{key:0,content:"没有文件，无法构建",placement:"top"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(n,{type:"info"},{default:Object(c["withCtx"])(()=>r[31]||(r[31]=[Object(c["createTextVNode"])(" 无法构建 ")])),_:1})]),_:1})):(Object(c["openBlock"])(),Object(c["createBlock"])(n,{key:1,type:Fe(e.row.status)},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])(Object(c["toDisplayString"])(Ue(e.row.status))+" ",1),"processing"===e.row.status?(Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["unref"])(i["a"]),{key:0,class:"is-loading"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(h["Loading"]))]),_:1})):Object(c["createCommentVNode"])("",!0)]),_:2},1032,["type"]))]),_:1}),Object(c["createVNode"])(Object(c["unref"])(s["b"]),{prop:"last_built_at",label:"上次构建时间"},{default:Object(c["withCtx"])(e=>[Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.row.last_built_at?new Date(e.row.last_built_at).toLocaleString():"N/A"),1)]),_:1}),Object(c["createVNode"])(Object(c["unref"])(s["b"]),{prop:"processing_message",label:"消息","show-overflow-tooltip":""}),Object(c["createVNode"])(Object(c["unref"])(s["b"]),{label:"操作",width:"120"},{default:Object(c["withCtx"])(e=>[Object(c["createVNode"])(Object(c["unref"])(g["a"]),{content:"没有文件，无法构建",disabled:e.row.file_count>0},{default:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",I,[Object(c["createVNode"])(Object(c["unref"])(d["a"]),{type:"primary",size:"small",onClick:t=>Te([e.row.company_id]),disabled:$e(e.row.company_id)||0===e.row.file_count},{default:Object(c["withCtx"])(()=>r[32]||(r[32]=[Object(c["createTextVNode"])(" 构建 ")])),_:2},1032,["onClick","disabled"])])]),_:2},1032,["disabled"])]),_:1})]),_:1},8,["data"])),[[o,oe.value]])]),_:1},8,["modelValue"])])}}},M=(a("1b67"),a("deb8"),a("6b0d")),A=a.n(M);const q=A()(L,[["__scopeId","data-v-3a984224"]]);t["default"]=q},"50fc":function(e,t,a){"use strict";var c=a("cee4");const r=c["a"].create({baseURL:"http://localhost:8000/api/admin",timeout:1e4,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer "+t),e},e=>Promise.reject(e)),t["a"]={getDashboardData(){return r.get("/dashboard/")},getDashboardAnalysis(e,t){return r.post("/dashboard/analysis/",{chart_title:e,chart_data:t})},getUsers(e){return r.get("/users/",{params:e})},createUser(e){return r.post("/users/",e)},updateUser(e,t){return r.patch(`/users/${e}/`,t)},deleteUser(e){return r.delete(`/users/${e}/`)},getCompanies(e){return r.get("/companies/",{params:e})},createCompany(e){return r.post("/companies/",e)},updateCompany(e,t){return r.patch(`/companies/${e}/`,t)},deleteCompany(e){return r.delete(`/companies/${e}/`)},getDepartments(e){return r.get("/departments/",{params:e})},createDepartment(e){return r.post("/departments/",e)},updateDepartment(e,t){return r.patch(`/departments/${e}/`,t)},deleteDepartment(e){return r.delete(`/departments/${e}/`)},getSmartDocs(e){return r.get("/smart-docs/",{params:e})},getSmartDocDetail(e){return r.get(`/smart-docs/${e}/`)},deleteSmartDoc(e){return r.delete(`/smart-docs/${e}/`)},getContracts(e){return r.get("/contracts/",{params:e})},getContractDetail(e){return r.get(`/contracts/${e}/`)},deleteContract(e){return r.delete(`/contracts/${e}/`)},getContractTemplates(){return r.get("/contract-templates/")},getContractTemplate(e){return r.get(`/contract-templates/${e}/`)},createContractTemplate(e){return r.post("/contract-templates/",e)},updateContractTemplate(e,t){return r.patch(`/contract-templates/${e}/`,t)},deleteContractTemplate(e){return r.delete(`/contract-templates/${e}/`)},getKnowledgeCategories(e){return r.get("/knowledge-categories/",{params:e})},createKnowledgeCategory(e){return r.post("/knowledge-categories/",e)},updateKnowledgeCategory(e,t){return r.patch(`/knowledge-categories/${e}/`,t)},deleteKnowledgeCategory(e){return r.delete(`/knowledge-categories/${e}/`)},getKnowledgeBases(e){return r.get("/knowledge-bases/",{params:e})},getKnowledgeBaseDetail(e){return r.get(`/knowledge-bases/${e}/`)},createKnowledgeBase(e){const t=new FormData;for(const a in e)null!==e[a]&&void 0!==e[a]&&t.append(a,e[a]);return r.post("/knowledge-bases/",t,{headers:{"Content-Type":"multipart/form-data"}})},updateKnowledgeBase(e,t){const a=new FormData;for(const c in t)"original_file"!==c&&null!==t[c]&&void 0!==t[c]&&a.append(c,t[c]);return t.original_file instanceof File&&a.append("original_file",t.original_file),r.patch(`/knowledge-bases/${e}/`,a,{headers:{"Content-Type":"multipart/form-data"}})},deleteKnowledgeBase(e){return r.delete(`/knowledge-bases/${e}/`)},getKnowledgeBuildStatus(){return r.get("/knowledge/build/")},buildKnowledgeForCompanies(e){return r.post("/knowledge/build/",{company_ids:e})}}},5388:function(e,t,a){"use strict";var c=a("c65b");e.exports=function(e,t,a){var r,n,o=a?e:e.iterator,l=e.next;while(!(r=c(l,o)).done)if(n=t(r.value),void 0!==n)return n}},"68df":function(e,t,a){"use strict";var c=a("dc19"),r=a("8e16"),n=a("384f"),o=a("7f65");e.exports=function(e){var t=c(this),a=o(e);return!(r(t)>a.size)&&!1!==n(t,(function(e){if(!a.includes(e))return!1}),!0)}},"72c3":function(e,t,a){"use strict";var c=a("23e7"),r=a("e9bc"),n=a("dad2");c({target:"Set",proto:!0,real:!0,forced:!n("union")},{union:r})},"79a4":function(e,t,a){"use strict";var c=a("23e7"),r=a("d039"),n=a("953b"),o=a("dad2"),l=!o("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||r((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));c({target:"Set",proto:!0,real:!0,forced:l},{intersection:n})},"7f65":function(e,t,a){"use strict";var c=a("59ed"),r=a("825a"),n=a("c65b"),o=a("5926"),l=a("46c4"),i="Invalid size",u=RangeError,d=TypeError,s=Math.max,b=function(e,t){this.set=e,this.size=s(t,0),this.has=c(e.has),this.keys=c(e.keys)};b.prototype={getIterator:function(){return l(r(n(this.keys,this.set)))},includes:function(e){return n(this.has,this.set,e)}},e.exports=function(e){r(e);var t=+e.size;if(t!==t)throw new d(i);var a=o(t);if(a<0)throw new u(i);return new b(e,a)}},"83b9":function(e,t,a){"use strict";var c=a("cb27"),r=a("384f"),n=c.Set,o=c.add;e.exports=function(e){var t=new n;return r(e,(function(e){o(t,e)})),t}},"8b00":function(e,t,a){"use strict";var c=a("23e7"),r=a("68df"),n=a("dad2"),o=!n("isSubsetOf",(function(e){return e}));c({target:"Set",proto:!0,real:!0,forced:o},{isSubsetOf:r})},"8e16":function(e,t,a){"use strict";var c=a("7282"),r=a("cb27");e.exports=c(r.proto,"size","get")||function(e){return e.size}},"953b":function(e,t,a){"use strict";var c=a("dc19"),r=a("cb27"),n=a("8e16"),o=a("7f65"),l=a("384f"),i=a("5388"),u=r.Set,d=r.add,s=r.has;e.exports=function(e){var t=c(this),a=o(e),r=new u;return n(t)>a.size?i(a.getIterator(),(function(e){s(t,e)&&d(r,e)})):l(t,(function(e){a.includes(e)&&d(r,e)})),r}},9961:function(e,t,a){"use strict";var c=a("dc19"),r=a("cb27"),n=a("83b9"),o=a("7f65"),l=a("5388"),i=r.add,u=r.has,d=r.remove;e.exports=function(e){var t=c(this),a=o(e).getIterator(),r=n(t);return l(a,(function(e){u(t,e)?d(r,e):i(r,e)})),r}},a4e7:function(e,t,a){"use strict";var c=a("23e7"),r=a("395e"),n=a("dad2"),o=!n("isSupersetOf",(function(e){return!e}));c({target:"Set",proto:!0,real:!0,forced:o},{isSupersetOf:r})},a5f7:function(e,t,a){"use strict";var c=a("dc19"),r=a("cb27"),n=a("83b9"),o=a("8e16"),l=a("7f65"),i=a("384f"),u=a("5388"),d=r.has,s=r.remove;e.exports=function(e){var t=c(this),a=l(e),r=n(t);return o(t)<=a.size?i(t,(function(e){a.includes(e)&&s(r,e)})):u(a.getIterator(),(function(e){d(t,e)&&s(r,e)})),r}},b4bc:function(e,t,a){"use strict";var c=a("dc19"),r=a("cb27").has,n=a("8e16"),o=a("7f65"),l=a("384f"),i=a("5388"),u=a("2a62");e.exports=function(e){var t=c(this),a=o(e);if(n(t)<=a.size)return!1!==l(t,(function(e){if(a.includes(e))return!1}),!0);var d=a.getIterator();return!1!==i(d,(function(e){if(r(t,e))return u(d,"normal",!1)}))}},c1a1:function(e,t,a){"use strict";var c=a("23e7"),r=a("b4bc"),n=a("dad2"),o=!n("isDisjointFrom",(function(e){return!e}));c({target:"Set",proto:!0,real:!0,forced:o},{isDisjointFrom:r})},cb27:function(e,t,a){"use strict";var c=a("e330"),r=Set.prototype;e.exports={Set:Set,add:c(r.add),has:c(r.has),remove:c(r["delete"]),proto:r}},d866:function(e,t,a){"use strict";var c=a("23e7"),r=a("c65b"),n=a("2266"),o=a("59ed"),l=a("825a"),i=a("46c4"),u=a("2a62"),d=a("f99f"),s=d("every",TypeError);c({target:"Iterator",proto:!0,real:!0,forced:s},{every:function(e){l(this);try{o(e)}catch(c){u(this,"throw",c)}if(s)return r(s,this,e);var t=i(this),a=0;return!n(t,(function(t,c){if(!e(t,a++))return c()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},dad2:function(e,t,a){"use strict";var c=a("d066"),r=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},n=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var a=c("Set");try{(new a)[e](r(0));try{return(new a)[e](r(-1)),!1}catch(l){if(!t)return!0;try{return(new a)[e](n(-1/0)),!1}catch(i){var o=new a;return o.add(1),o.add(2),t(o[e](n(1/0)))}}}catch(i){return!1}}},dc19:function(e,t,a){"use strict";var c=a("cb27").has;e.exports=function(e){return c(e),e}},deb8:function(e,t,a){"use strict";a("2eaa")},e9bc:function(e,t,a){"use strict";var c=a("dc19"),r=a("cb27").add,n=a("83b9"),o=a("7f65"),l=a("5388");e.exports=function(e){var t=c(this),a=o(e).getIterator(),i=n(t);return l(a,(function(e){r(i,e)})),i}},f665:function(e,t,a){"use strict";var c=a("23e7"),r=a("c65b"),n=a("2266"),o=a("59ed"),l=a("825a"),i=a("46c4"),u=a("2a62"),d=a("f99f"),s=d("find",TypeError);c({target:"Iterator",proto:!0,real:!0,forced:s},{find:function(e){l(this);try{o(e)}catch(c){u(this,"throw",c)}if(s)return r(s,this,e);var t=i(this),a=0;return n(t,(function(t,c){if(e(t,a++))return c(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})}}]);
//# sourceMappingURL=chunk-7bb95057.f3dde87a.js.map