(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7ca9e3e2"],{"50fc":function(e,t,a){"use strict";var r=a("cee4");const c=r["a"].create({baseURL:"http://localhost:8000/api/admin",timeout:1e4,headers:{"Content-Type":"application/json"}});c.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer "+t),e},e=>Promise.reject(e)),t["a"]={getDashboardData(){return c.get("/dashboard/")},getDashboardAnalysis(e,t){return c.post("/dashboard/analysis/",{chart_title:e,chart_data:t})},getUsers(e){return c.get("/users/",{params:e})},createUser(e){return c.post("/users/",e)},updateUser(e,t){return c.patch(`/users/${e}/`,t)},deleteUser(e){return c.delete(`/users/${e}/`)},getCompanies(e){return c.get("/companies/",{params:e})},createCompany(e){return c.post("/companies/",e)},updateCompany(e,t){return c.patch(`/companies/${e}/`,t)},deleteCompany(e){return c.delete(`/companies/${e}/`)},getDepartments(e){return c.get("/departments/",{params:e})},createDepartment(e){return c.post("/departments/",e)},updateDepartment(e,t){return c.patch(`/departments/${e}/`,t)},deleteDepartment(e){return c.delete(`/departments/${e}/`)},getSmartDocs(e){return c.get("/smart-docs/",{params:e})},getSmartDocDetail(e){return c.get(`/smart-docs/${e}/`)},deleteSmartDoc(e){return c.delete(`/smart-docs/${e}/`)},getContracts(e){return c.get("/contracts/",{params:e})},getContractDetail(e){return c.get(`/contracts/${e}/`)},deleteContract(e){return c.delete(`/contracts/${e}/`)},getContractTemplates(){return c.get("/contract-templates/")},getContractTemplate(e){return c.get(`/contract-templates/${e}/`)},createContractTemplate(e){return c.post("/contract-templates/",e)},updateContractTemplate(e,t){return c.patch(`/contract-templates/${e}/`,t)},deleteContractTemplate(e){return c.delete(`/contract-templates/${e}/`)},getKnowledgeCategories(e){return c.get("/knowledge-categories/",{params:e})},createKnowledgeCategory(e){return c.post("/knowledge-categories/",e)},updateKnowledgeCategory(e,t){return c.patch(`/knowledge-categories/${e}/`,t)},deleteKnowledgeCategory(e){return c.delete(`/knowledge-categories/${e}/`)},getKnowledgeBases(e){return c.get("/knowledge-bases/",{params:e})},getKnowledgeBaseDetail(e){return c.get(`/knowledge-bases/${e}/`)},createKnowledgeBase(e){const t=new FormData;for(const a in e)null!==e[a]&&void 0!==e[a]&&t.append(a,e[a]);return c.post("/knowledge-bases/",t,{headers:{"Content-Type":"multipart/form-data"}})},updateKnowledgeBase(e,t){const a=new FormData;for(const r in t)"original_file"!==r&&null!==t[r]&&void 0!==t[r]&&a.append(r,t[r]);return t.original_file instanceof File&&a.append("original_file",t.original_file),c.patch(`/knowledge-bases/${e}/`,a,{headers:{"Content-Type":"multipart/form-data"}})},deleteKnowledgeBase(e){return c.delete(`/knowledge-bases/${e}/`)},getKnowledgeBuildStatus(){return c.get("/knowledge/build/")},buildKnowledgeForCompanies(e){return c.post("/knowledge/build/",{company_ids:e})}}},"83e5":function(e,t,a){},8598:function(e,t,a){"use strict";a("83e5")},e544:function(e,t,a){"use strict";a.r(t);a("e9f5"),a("a732");var r=a("7a23"),c=a("50fc"),n=a("3ef4"),l=a("c9a1"),o=a("4c02"),u=a("54bb"),d=a("c349"),s=a("cf2e"),i=a("1e49"),b=a("7faf"),p=a("db9d"),m=a("d8e8"),j=a("91c0"),O=a("f6f2");const g={class:"management-container"},f={class:"card-header"},w={class:"header-left"},h={class:"header-right"},v={class:"table-container"},V={class:"pagination-container"},C={class:"dialog-footer"};var y={__name:"DepartmentManagement",setup(e){const t=Object(r["ref"])([]),a=Object(r["ref"])([]),y=Object(r["ref"])([]),k=Object(r["ref"])(!0),N=Object(r["ref"])(""),x=Object(r["ref"])(0),_=Object(r["reactive"])({page:1,pageSize:10}),B=Object(r["ref"])(!1),D=Object(r["ref"])({}),$=Object(r["ref"])(null);let T=null;const z=async()=>{k.value=!0;try{const e={search:N.value,page:_.page,page_size:_.pageSize},a=await c["a"].getDepartments(e);t.value=a.data.results,x.value=a.data.count}catch(e){console.error("获取部门列表失败:",e),n["a"].error("获取部门列表失败")}finally{k.value=!1}},S=()=>{clearTimeout(T),T=setTimeout(()=>{_.page=1,z()},300)},U=async()=>{try{const e=await c["a"].getCompanies({all:"true"});a.value=e.data}catch(e){console.error("获取公司列表失败:",e)}},K=async e=>{if(e)try{const t=await c["a"].getUsers({all:"true",company_id:e});y.value=t.data}catch(t){console.error(`获取公司 ${e} 的用户列表失败:`,t),y.value=[]}else y.value=[]},E=async e=>{D.value.manager=null,await K(e)},F=async(e={})=>{if(await U(),y.value=[],e&&e.id){if(D.value={...e},e.company){await K(e.company);const t=D.value.manager;t&&!y.value.some(e=>e.id===t)&&(D.value.manager=null)}}else D.value={name:"",description:"",company:null,manager:null};B.value=!0},q=()=>{var e;B.value=!1,null===(e=$.value)||void 0===e||e.resetFields(),y.value=[]},I=async()=>{$.value&&await $.value.validate(async e=>{if(e)try{const e={...D.value};""===e.manager&&(e.manager=null),e.id?await c["a"].updateDepartment(e.id,e):await c["a"].createDepartment(e),q(),z(),n["a"].success("部门信息保存成功！")}catch(t){console.error("保存部门失败:",t),n["a"].error("保存部门失败，请稍后重试")}})},L=e=>{l["a"].confirm(`确定要删除部门【${e.name}】吗？这会将部门内的所有员工的部门重置为空。`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await c["a"].deleteDepartment(e.id),n["a"].success("部门删除成功"),z()}catch(t){n["a"].error("删除失败，请稍后重试"),console.error("删除部门失败:",t)}}).catch(()=>{n["a"].info("已取消删除")})},P=e=>{_.pageSize=e,z()},A=e=>{_.page=e,z()};return Object(r["onMounted"])(z),(e,c)=>{const n=Object(r["resolveDirective"])("loading");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",g,[Object(r["createVNode"])(Object(r["unref"])(o["a"]),{class:"box-card"},{header:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("div",f,[Object(r["createElementVNode"])("div",w,[Object(r["createVNode"])(Object(r["unref"])(u["a"]),{class:"header-icon"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(O["Tickets"]))]),_:1}),c[9]||(c[9]=Object(r["createElementVNode"])("span",null,"部门管理",-1))]),Object(r["createElementVNode"])("div",h,[Object(r["createVNode"])(Object(r["unref"])(d["a"]),{modelValue:N.value,"onUpdate:modelValue":c[0]||(c[0]=e=>N.value=e),placeholder:"搜索部门...",clearable:"",onClear:z,onInput:S,class:"search-input"},{append:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(s["a"]),{icon:Object(r["unref"])(O["Search"])},null,8,["icon"])]),_:1},8,["modelValue"]),Object(r["createVNode"])(Object(r["unref"])(s["a"]),{type:"primary",icon:Object(r["unref"])(O["Plus"]),onClick:c[1]||(c[1]=e=>F())},{default:Object(r["withCtx"])(()=>c[10]||(c[10]=[Object(r["createTextVNode"])("添加部门")])),_:1},8,["icon"])])])]),default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("div",v,[Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["unref"])(i["a"]),{data:t.value,style:{width:"100%"}},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(i["b"]),{type:"index",label:"序号",width:"60"}),Object(r["createVNode"])(Object(r["unref"])(i["b"]),{prop:"name",label:"部门名称",sortable:""}),Object(r["createVNode"])(Object(r["unref"])(i["b"]),{prop:"company_name",label:"所属公司",sortable:""}),Object(r["createVNode"])(Object(r["unref"])(i["b"]),{prop:"manager_name",label:"部门主管",sortable:""},{default:Object(r["withCtx"])(e=>[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.row.manager_name||"无"),1)]),_:1}),Object(r["createVNode"])(Object(r["unref"])(i["b"]),{prop:"description",label:"描述"}),Object(r["createVNode"])(Object(r["unref"])(i["b"]),{label:"操作",width:"120"},{default:Object(r["withCtx"])(e=>[Object(r["createVNode"])(Object(r["unref"])(s["a"]),{text:"",type:"primary",size:"small",onClick:t=>F(e.row)},{default:Object(r["withCtx"])(()=>c[11]||(c[11]=[Object(r["createTextVNode"])("编辑")])),_:2},1032,["onClick"]),Object(r["createVNode"])(Object(r["unref"])(s["a"]),{text:"",type:"danger",size:"small",onClick:t=>L(e.row)},{default:Object(r["withCtx"])(()=>c[12]||(c[12]=[Object(r["createTextVNode"])("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[n,k.value]])]),Object(r["createElementVNode"])("div",V,[Object(r["createVNode"])(Object(r["unref"])(b["a"]),{"current-page":_.page,"onUpdate:currentPage":c[2]||(c[2]=e=>_.page=e),"page-size":_.pageSize,"onUpdate:pageSize":c[3]||(c[3]=e=>_.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:x.value,onSizeChange:P,onCurrentChange:A},null,8,["current-page","page-size","total"])]),Object(r["createVNode"])(Object(r["unref"])(p["a"]),{modelValue:B.value,"onUpdate:modelValue":c[8]||(c[8]=e=>B.value=e),title:D.value.id?"编辑部门":"添加部门",width:"500px"},{footer:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("span",C,[Object(r["createVNode"])(Object(r["unref"])(s["a"]),{onClick:q},{default:Object(r["withCtx"])(()=>c[13]||(c[13]=[Object(r["createTextVNode"])("取消")])),_:1}),Object(r["createVNode"])(Object(r["unref"])(s["a"]),{type:"primary",onClick:I},{default:Object(r["withCtx"])(()=>c[14]||(c[14]=[Object(r["createTextVNode"])("保存")])),_:1})])]),default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(m["a"]),{model:D.value,ref_key:"itemForm",ref:$,"label-width":"80px"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(m["b"]),{label:"部门名称",prop:"name",rules:[{required:!0,message:"请输入部门名称"}]},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(d["a"]),{modelValue:D.value.name,"onUpdate:modelValue":c[4]||(c[4]=e=>D.value.name=e)},null,8,["modelValue"])]),_:1}),Object(r["createVNode"])(Object(r["unref"])(m["b"]),{label:"所属公司",prop:"company",rules:[{required:!0,message:"请选择公司"}]},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(j["c"]),{modelValue:D.value.company,"onUpdate:modelValue":c[5]||(c[5]=e=>D.value.company=e),placeholder:"请选择",onChange:E},{default:Object(r["withCtx"])(()=>[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(a.value,e=>(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["unref"])(j["a"]),{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),D.value.company?(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["unref"])(m["b"]),{key:0,label:"部门主管",prop:"manager"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(j["c"]),{modelValue:D.value.manager,"onUpdate:modelValue":c[6]||(c[6]=e=>D.value.manager=e),placeholder:"请选择",disabled:!D.value.company,clearable:""},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(j["a"]),{label:"-- 不指定 --",value:null}),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(y.value,e=>(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["unref"])(j["a"]),{key:e.id,label:e.name||e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})):Object(r["createCommentVNode"])("",!0),Object(r["createVNode"])(Object(r["unref"])(m["b"]),{label:"描述",prop:"description"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(d["a"]),{modelValue:D.value.description,"onUpdate:modelValue":c[7]||(c[7]=e=>D.value.description=e),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})])}}},k=(a("8598"),a("6b0d")),N=a.n(k);const x=N()(y,[["__scopeId","data-v-09b89ca8"]]);t["default"]=x}}]);
//# sourceMappingURL=chunk-7ca9e3e2.b6115a09.js.map