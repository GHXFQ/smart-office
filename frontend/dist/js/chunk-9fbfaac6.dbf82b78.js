(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9fbfaac6","chunk-2d0e4842"],{"385a":function(e,t,r){"use strict";r.r(t);var a=r("7a23");const o={class:"profile-page"},s={class:"card-header"},c={class:"header-title"};function l(e,t,r,l,d,n){const i=Object(a["resolveComponent"])("User"),p=Object(a["resolveComponent"])("el-icon"),b=Object(a["resolveComponent"])("profile-card"),u=Object(a["resolveComponent"])("el-card");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",o,[Object(a["createVNode"])(u,{class:"profile-card",shadow:"hover"},{header:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("div",s,[Object(a["createElementVNode"])("div",c,[Object(a["createVNode"])(p,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i)]),_:1}),t[0]||(t[0]=Object(a["createElementVNode"])("h3",null,"个人中心",-1))]),t[1]||(t[1]=Object(a["createElementVNode"])("span",{class:"sub-title"},"查看和管理您的个人信息",-1))])]),default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(b)]),_:1})])}var d=r("f6f2");const n={class:"profile-container"},i={class:"profile-content"},p={class:"profile-tabs-container"},b={class:"profile-left"},u={class:"avatar-container"},m={class:"avatar-edit-overlay"},j={class:"user-name"},O={class:"user-title"},f={class:"profile-right"},w={key:0},h={key:1},V={class:"security-section"},_={class:"security-header"};function g(e,t,r,o,s,c){const l=Object(a["resolveComponent"])("el-alert"),d=Object(a["resolveComponent"])("el-tab-pane"),g=Object(a["resolveComponent"])("el-tabs"),C=Object(a["resolveComponent"])("el-avatar"),v=Object(a["resolveComponent"])("Edit"),N=Object(a["resolveComponent"])("el-icon"),x=Object(a["resolveComponent"])("User"),y=Object(a["resolveComponent"])("el-input"),E=Object(a["resolveComponent"])("el-form-item"),k=Object(a["resolveComponent"])("el-col"),D=Object(a["resolveComponent"])("Ticket"),U=Object(a["resolveComponent"])("el-row"),F=Object(a["resolveComponent"])("OfficeBuilding"),B=Object(a["resolveComponent"])("Briefcase"),A=Object(a["resolveComponent"])("Message"),T=Object(a["resolveComponent"])("Phone"),I=Object(a["resolveComponent"])("Location"),P=Object(a["resolveComponent"])("UserFilled"),L=Object(a["resolveComponent"])("Check"),S=Object(a["resolveComponent"])("el-button"),q=Object(a["resolveComponent"])("Refresh"),R=Object(a["resolveComponent"])("el-form"),M=Object(a["resolveComponent"])("Lock"),z=Object(a["resolveComponent"])("el-divider"),$=Object(a["resolveComponent"])("Key"),J=Object(a["resolveDirective"])("loading");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",n,[o.alert.show?(Object(a["openBlock"])(),Object(a["createBlock"])(l,{key:0,type:o.alert.type,title:o.alert.message,closable:!0,"show-icon":"",onClose:o.closeAlert,class:"profile-alert"},null,8,["type","title","onClose"])):Object(a["createCommentVNode"])("",!0),Object(a["createElementVNode"])("div",i,[Object(a["createElementVNode"])("div",p,[Object(a["createVNode"])(g,{modelValue:o.activeTab,"onUpdate:modelValue":t[0]||(t[0]=e=>o.activeTab=e),class:"profile-tabs"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(d,{label:"基本信息",name:"basic"}),Object(a["createVNode"])(d,{label:"账户安全",name:"security"})]),_:1},8,["modelValue"])]),Object(a["createElementVNode"])("div",b,[Object(a["createElementVNode"])("div",u,[Object(a["createElementVNode"])("div",{class:"avatar-wrapper",onClick:t[1]||(t[1]=(...e)=>o.triggerFileInput&&o.triggerFileInput(...e))},[Object(a["createVNode"])(C,{size:120,src:o.avatarUrl,class:"user-avatar"},{default:Object(a["withCtx"])(()=>[Object(a["createElementVNode"])("span",null,Object(a["toDisplayString"])(o.userInitial),1)]),_:1},8,["src"]),Object(a["createElementVNode"])("div",m,[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(v)]),_:1})])]),Object(a["createElementVNode"])("input",{type:"file",ref:"avatarInput",accept:"image/*",style:{display:"none"},onChange:t[2]||(t[2]=(...e)=>o.handleAvatarChange&&o.handleAvatarChange(...e))},null,544)]),Object(a["createElementVNode"])("h3",j,Object(a["toDisplayString"])(o.userData.name||o.userData.username),1),Object(a["createElementVNode"])("p",O,Object(a["toDisplayString"])(o.userTitle),1)]),Object(a["createElementVNode"])("div",f,["basic"===o.activeTab?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",w,[Object(a["withDirectives"])((Object(a["openBlock"])(),Object(a["createBlock"])(R,{ref:"profileForm",model:o.userData,rules:o.rules,"label-width":"100px",class:"profile-form"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(U,{gutter:20},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(k,{span:12},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(E,{label:"姓名",prop:"name"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(y,{modelValue:o.userData.name,"onUpdate:modelValue":t[3]||(t[3]=e=>o.userData.name=e),placeholder:"请输入姓名"},{prefix:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(x)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),Object(a["createVNode"])(k,{span:12},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(E,{label:"工号",prop:"employee_id"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(y,{modelValue:o.userData.employee_id,"onUpdate:modelValue":t[4]||(t[4]=e=>o.userData.employee_id=e),placeholder:"公司内员工序号",disabled:!0},{prefix:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(D)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),Object(a["withDirectives"])(Object(a["createElementVNode"])("input",{type:"hidden","onUpdate:modelValue":t[5]||(t[5]=e=>o.userData.username=e)},null,512),[[a["vModelText"],o.userData.username]]),Object(a["createVNode"])(U,{gutter:20},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(k,{span:12},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(E,{label:"部门",prop:"department"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(y,{modelValue:o.userData.department_name,"onUpdate:modelValue":t[6]||(t[6]=e=>o.userData.department_name=e),placeholder:"用户所在部门",disabled:!0},{prefix:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(F)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),Object(a["createVNode"])(k,{span:12},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(E,{label:"职位",prop:"position"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(y,{modelValue:o.userData.position,"onUpdate:modelValue":t[7]||(t[7]=e=>o.userData.position=e),placeholder:"用户当前职位",disabled:!0},{prefix:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(B)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),Object(a["createVNode"])(U,{gutter:20},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(k,{span:12},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(E,{label:"电子邮箱",prop:"email"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(y,{modelValue:o.userData.email,"onUpdate:modelValue":t[8]||(t[8]=e=>o.userData.email=e),placeholder:"请输入电子邮箱"},{prefix:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(A)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),Object(a["createVNode"])(k,{span:12},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(E,{label:"手机号码",prop:"phone"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(y,{modelValue:o.userData.phone,"onUpdate:modelValue":t[9]||(t[9]=e=>o.userData.phone=e),placeholder:"请输入手机号码"},{prefix:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(T)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),Object(a["createVNode"])(U,{gutter:20},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(k,{span:12},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(E,{label:"办公地点",prop:"office"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(y,{modelValue:o.userData.company_name,"onUpdate:modelValue":t[10]||(t[10]=e=>o.userData.company_name=e),placeholder:"用户所在公司",disabled:!0},{prefix:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(I)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),Object(a["createVNode"])(k,{span:12},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(E,{label:"直系领导",prop:"manager"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(y,{modelValue:o.userData.department_manager_name,"onUpdate:modelValue":t[11]||(t[11]=e=>o.userData.department_manager_name=e),placeholder:"部门主管",disabled:!0},{prefix:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(P)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),Object(a["createVNode"])(E,{label:"个人简介",prop:"bio"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(y,{modelValue:o.userData.bio,"onUpdate:modelValue":t[12]||(t[12]=e=>o.userData.bio=e),type:"textarea",rows:3,placeholder:"请输入您的个人简介"},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(E,{class:"form-actions"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(S,{type:"primary",onClick:o.submitForm},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(L)]),_:1}),t[19]||(t[19]=Object(a["createElementVNode"])("span",null,"保存更改",-1))]),_:1},8,["onClick"]),Object(a["createVNode"])(S,{onClick:o.resetForm},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(q)]),_:1}),t[20]||(t[20]=Object(a["createElementVNode"])("span",null,"重置",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])),[[J,o.loading]])])):Object(a["createCommentVNode"])("",!0),"security"===o.activeTab?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",h,[Object(a["createElementVNode"])("div",V,[Object(a["createElementVNode"])("div",_,[Object(a["createElementVNode"])("h4",null,[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(M)]),_:1}),t[21]||(t[21]=Object(a["createTextVNode"])(" 密码管理"))]),t[22]||(t[22]=Object(a["createElementVNode"])("p",{class:"security-tip"},"定期更改密码可以提高账户安全性",-1))]),Object(a["createVNode"])(z),Object(a["withDirectives"])((Object(a["openBlock"])(),Object(a["createBlock"])(R,{ref:"passwordForm",model:o.passwordData,rules:o.passwordRules,"label-width":"120px","status-icon":!0,class:"password-form"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(E,{label:"当前密码",prop:"old_password",error:o.fieldErrors.old_password,class:Object(a["normalizeClass"])({"has-error":o.fieldErrors.old_password})},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(y,{modelValue:o.passwordData.old_password,"onUpdate:modelValue":t[13]||(t[13]=e=>o.passwordData.old_password=e),type:"password",placeholder:"请输入当前密码","show-password":"",onFocus:t[14]||(t[14]=e=>o.clearFieldError("old_password"))},{prefix:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])($)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["error","class"]),Object(a["createVNode"])(E,{label:"新密码",prop:"new_password",error:o.fieldErrors.new_password,class:Object(a["normalizeClass"])({"has-error":o.fieldErrors.new_password})},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(y,{modelValue:o.passwordData.new_password,"onUpdate:modelValue":t[15]||(t[15]=e=>o.passwordData.new_password=e),type:"password",placeholder:"请输入新密码","show-password":"",onFocus:t[16]||(t[16]=e=>o.clearFieldError("new_password"))},{prefix:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(M)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["error","class"]),Object(a["createVNode"])(E,{label:"确认新密码",prop:"confirm_password",error:o.fieldErrors.confirm_password,class:Object(a["normalizeClass"])({"has-error":o.fieldErrors.confirm_password})},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(y,{modelValue:o.passwordData.confirm_password,"onUpdate:modelValue":t[17]||(t[17]=e=>o.passwordData.confirm_password=e),type:"password",placeholder:"请再次输入新密码","show-password":"",onFocus:t[18]||(t[18]=e=>o.clearFieldError("confirm_password"))},{prefix:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(L)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["error","class"]),Object(a["createVNode"])(E,{class:"form-actions"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(S,{type:"primary",onClick:o.changePassword},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])($)]),_:1}),t[23]||(t[23]=Object(a["createElementVNode"])("span",null,"修改密码",-1))]),_:1},8,["onClick"]),Object(a["createVNode"])(S,{onClick:o.resetPasswordForm},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(N,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(q)]),_:1}),t[24]||(t[24]=Object(a["createElementVNode"])("span",null,"重置",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])),[[J,o.passwordLoading]])])])):Object(a["createCommentVNode"])("",!0)])])])}r("d9e2"),r("14d9"),r("e9f5"),r("910d"),r("7d54"),r("ab43");var C=r("5502"),v=r("3ef4"),N={name:"ProfileCard",components:{Edit:d["Edit"],User:d["User"],Ticket:d["Ticket"],OfficeBuilding:d["OfficeBuilding"],Briefcase:d["Briefcase"],Message:d["Message"],Phone:d["Phone"],Location:d["Location"],UserFilled:d["UserFilled"],Lock:d["Lock"],Key:d["Key"],Check:d["Check"],Refresh:d["Refresh"]},setup(){const e=Object(C["b"])(),t=Object(a["ref"])(null),r=Object(a["ref"])(null),o=Object(a["ref"])(null),s=Object(a["ref"])(!1),c=Object(a["ref"])(!1),l=Object(a["ref"])("basic"),d=Object(a["reactive"])({show:!1,type:"success",message:""}),n=Object(a["reactive"])({id:"",username:"",name:"",email:"",phone:"",avatar:"",position:"",department:"",company_name:"",department_manager_name:"",office:"",employee_id:"",manager:"",bio:"",join_date:"",department_name:""}),i=Object(a["reactive"])({old_password:"",new_password:"",confirm_password:""}),p=Object(a["reactive"])({old_password:"",new_password:"",confirm_password:""}),b=e=>{p[e]&&(p[e]="")},u=()=>{Object.keys(p).forEach(e=>{p[e]=""})},m={username:[{required:!0,message:"用户名不能为空",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入电子邮箱",trigger:"blur"},{type:"email",message:"请输入正确的电子邮箱格式",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}]},j={old_password:[{required:!0,message:"请输入当前密码",trigger:"blur"}],new_password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6个字符",trigger:"blur"}],confirm_password:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(e,t,r)=>{t!==i.new_password?r(new Error("两次输入密码不一致")):r()},trigger:"blur"}]},O=Object(a["computed"])(()=>n.avatar||""),f=Object(a["computed"])(()=>n.name?n.name.charAt(0):n.username?n.username.charAt(0):"用"),w=Object(a["computed"])(()=>{const e=[];return n.department_name&&e.push(n.department_name),n.position&&e.push(n.position),e.join(" / ")||"暂无职位信息"}),h=async()=>{s.value=!0;try{const r=e.getters["user/currentUser"];if(console.log("本地存储的用户数据:",r),r&&(r.username&&(n.username=r.username),Object.keys(n).forEach(e=>{r[e]&&(n[e]=r[e])})),!n.username){const e=localStorage.getItem("user");if(e)try{const t=JSON.parse(e);t&&t.username&&(n.username=t.username)}catch(t){console.error("解析本地存储的用户数据失败:",t)}}console.log("正在从服务器请求用户数据..."),await e.dispatch("user/getUserProfile");const a=e.getters["user/currentUser"];if(console.log("从服务器获取的用户数据:",a),a){const e=n.username;Object.keys(n).forEach(e=>{void 0!==a[e]&&(n[e]=a[e])}),!n.username&&e&&(n.username=e),n.join_date||(n.join_date=(new Date).toISOString().split("T")[0])}console.log("最终用户数据:",n)}catch(r){E("获取用户信息失败，请刷新重试","error"),console.error("获取用户信息失败:",r),r.response&&(console.error("响应状态:",r.response.status),console.error("响应数据:",r.response.data))}finally{s.value=!1}},V=async()=>{t.value&&await t.value.validate(async t=>{if(!t)return!1;s.value=!0;try{if(!n.id){const t=e.getters["user/currentUser"];t&&t.id&&(n.id=t.id)}console.log("正在发送用户数据:",JSON.stringify(n));const t=await e.dispatch("user/updateUserProfile",n);t.success?E("个人信息更新成功","success"):E(t.message||"更新失败，请重试","error")}catch(r){console.error("更新用户信息失败:",r);let e="更新失败，请重试";if("string"===typeof r)e=r;else if(r&&"object"===typeof r)if(r.message&&(e=r.message),r.response&&"object"===typeof r.response)console.log("自定义错误响应对象:",r.response),r.response.message?e=r.response.message:r.response.data&&("string"===typeof r.response.data?e=r.response.data:r.response.data.message?e=r.response.data.message:r.response.data.error?e=r.response.data.error:r.response.data.detail&&(e=r.response.data.detail));else if(r.response&&r.response.status&&(console.error("响应状态:",r.response.status),r.response.data))if(console.error("响应数据:",r.response.data),"string"===typeof r.response.data)e=r.response.data;else if(r.response.data.message)e=r.response.data.message;else if(r.response.data.error)e=r.response.data.error;else if(r.response.data.detail)e=r.response.data.detail;else{const t=Object.entries(r.response.data||{}).filter(([,e])=>Array.isArray(e)&&e.length>0).map(([e,t])=>`${e}: ${t.join(", ")}`);t.length>0&&(e=t.join("; "))}E(e,"error")}finally{s.value=!1}})},_=()=>{var e;null===(e=t.value)||void 0===e||e.clearValidate(),h()},g=async()=>{r.value&&(u(),await r.value.validate(async t=>{if(!t)return console.log("密码表单验证未通过"),!1;c.value=!0;try{const{old_password:t,new_password:r,confirm_password:a}=i;console.log("发送密码修改请求");const o=await e.dispatch("user/changePassword",{old_password:t,new_password:r,confirm_password:a});if(o.success)E("密码修改成功","success"),N();else{o.isValidationResult?console.log("验证结果：当前密码不正确"):console.log("密码修改失败");let e=!1;o&&o.fieldErrors&&o.fieldErrors.old_password&&Array.isArray(o.fieldErrors.old_password)&&o.fieldErrors.old_password.includes("Incorrect password.")&&(e=!0);let t="密码修改失败，请重试";o&&o.message&&(t=o.message),o&&o.fieldErrors&&Object.entries(o.fieldErrors).forEach(([t,r])=>{if(Object.prototype.hasOwnProperty.call(p,t)&&Array.isArray(r)&&r.length>0){let a=r.join(", ");if("old_password"===t&&r.includes("Incorrect password.")){a="当前密码不正确，请重新输入",e=!0;const r=document.querySelector(`.password-form .el-form-item[prop="${t}"] .el-input__wrapper`);r&&(r.classList.add("shake-error"),setTimeout(()=>{r.classList.remove("shake-error")},600))}p[t]=a}}),e||E(t,"error",5e3)}}catch(r){r.isValidationResult?console.log("验证结果：当前密码不正确"):console.log("密码修改失败");let e=!1;r&&r.fieldErrors&&r.fieldErrors.old_password&&Array.isArray(r.fieldErrors.old_password)&&r.fieldErrors.old_password.includes("Incorrect password.")&&(e=!0);let t="密码修改失败，请重试";r&&r.message&&(t=r.message),r&&r.fieldErrors&&Object.entries(r.fieldErrors).forEach(([t,r])=>{if(Object.prototype.hasOwnProperty.call(p,t)&&Array.isArray(r)&&r.length>0){let a=r.join(", ");if("old_password"===t&&r.includes("Incorrect password.")){a="当前密码不正确，请重新输入",e=!0;const r=document.querySelector(`.password-form .el-form-item[prop="${t}"] .el-input__wrapper`);r&&(r.classList.add("shake-error"),setTimeout(()=>{r.classList.remove("shake-error")},600))}p[t]=a}}),e||E(t,"error",5e3)}finally{c.value=!1}}))},N=()=>{var e;null===(e=r.value)||void 0===e||e.resetFields(),u()},x=()=>{o.value.click()},y=async t=>{const r=t.target.files[0];if(!r)return;if(!r.type.startsWith("image/"))return void v["a"].error("请选择图片文件");if(r.size>3145728)return void v["a"].error("图片大小不能超过3MB");const a=new FormData;a.append("avatar",r),s.value=!0;try{const r=await e.dispatch("user/updateUserAvatar",a);r.success?(E("头像更新成功","success"),n.avatar=r.data.avatar):E(r.message||"头像更新失败，请重试","error")}catch(o){E(o.message||"头像更新失败，请重试","error"),console.error("更新头像失败:",o)}finally{s.value=!1,t.target.value=""}},E=(e,t="success",r=3e3)=>{d.show=!0,d.type=t,d.message=e,setTimeout(()=>{k()},r)},k=()=>{d.show=!1};return Object(a["onMounted"])(()=>{h()}),{profileForm:t,passwordForm:r,avatarInput:o,userData:n,passwordData:i,loading:s,passwordLoading:c,activeTab:l,alert:d,rules:m,passwordRules:j,avatarUrl:O,userInitial:f,userTitle:w,submitForm:V,resetForm:_,changePassword:g,resetPasswordForm:N,triggerFileInput:x,handleAvatarChange:y,showAlert:E,closeAlert:k,fieldErrors:p,clearFieldError:b,clearAllFieldErrors:u}}},x=(r("7bbf"),r("6b0d")),y=r.n(x);const E=y()(N,[["render",g],["__scopeId","data-v-7d714653"]]);var k=E,D={name:"ProfilePage",components:{User:d["User"],ProfileCard:k}};r("b27d");const U=y()(D,[["render",l],["__scopeId","data-v-7120f64c"]]);t["default"]=U},"6fb2":function(e,t,r){},"7bbf":function(e,t,r){"use strict";r("bac9")},"910d":function(e,t,r){"use strict";var a=r("23e7"),o=r("c65b"),s=r("59ed"),c=r("825a"),l=r("46c4"),d=r("c5cc"),n=r("9bdd"),i=r("c430"),p=r("2a62"),b=r("f99f"),u=!i&&b("filter",TypeError),m=d((function(){var e,t,r,a=this.iterator,s=this.predicate,l=this.next;while(1){if(e=c(o(l,a)),t=this.done=!!e.done,t)return;if(r=e.value,n(a,s,[r,this.counter++],!0))return r}}));a({target:"Iterator",proto:!0,real:!0,forced:i||u},{filter:function(e){c(this);try{s(e)}catch(t){p(this,"throw",t)}return u?o(u,this,e):new m(l(this),{predicate:e})}})},b27d:function(e,t,r){"use strict";r("6fb2")},bac9:function(e,t,r){}}]);
//# sourceMappingURL=chunk-9fbfaac6.dbf82b78.js.map