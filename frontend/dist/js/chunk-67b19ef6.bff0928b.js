(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-67b19ef6","chunk-2d0e4842"],{"066b":function(e,t,o){"use strict";o("5acf")},"1e5a":function(e,t,o){"use strict";var l=o("23e7"),a=o("9961"),c=o("dad2");l({target:"Set",proto:!0,real:!0,forced:!c("symmetricDifference")},{symmetricDifference:a})},"1e70":function(e,t,o){"use strict";var l=o("23e7"),a=o("a5f7"),c=o("dad2"),r=!c("difference",(function(e){return 0===e.size}));l({target:"Set",proto:!0,real:!0,forced:r},{difference:a})},"271a":function(e,t,o){"use strict";var l=o("cb2d"),a=o("e330"),c=o("577e"),r=o("d6d6"),n=URLSearchParams,i=n.prototype,s=a(i.getAll),d=a(i.has),u=new n("a=1");!u.has("a",2)&&u.has("a",void 0)||l(i,"has",(function(e){var t=arguments.length,o=t<2?void 0:arguments[1];if(t&&void 0===o)return d(this,e);var l=s(this,e);r(t,1);var a=c(o),n=0;while(n<l.length)if(l[n++]===a)return!0;return!1}),{enumerable:!0,unsafe:!0})},"384f":function(e,t,o){"use strict";var l=o("e330"),a=o("5388"),c=o("cb27"),r=c.Set,n=c.proto,i=l(n.forEach),s=l(n.keys),d=s(new r).next;e.exports=function(e,t,o){return o?a({iterator:s(e),next:d},t):i(e,t)}},"395e":function(e,t,o){"use strict";var l=o("dc19"),a=o("cb27").has,c=o("8e16"),r=o("7f65"),n=o("5388"),i=o("2a62");e.exports=function(e){var t=l(this),o=r(e);if(c(t)<o.size)return!1;var s=o.getIterator();return!1!==n(s,(function(e){if(!a(t,e))return i(s,"normal",!1)}))}},"3c26":function(e,t,o){"use strict";o.r(t);o("e9f5"),o("910d");var l=o("7a23");const a={class:"row"},c={class:"col-lg-3"},r={class:"search-box"},n={class:"category-list"},i=["onClick"],s={class:"category-name"},d={class:"category-count"},u={class:"filter-section"},b={class:"filter-group"},p={class:"filter-options"},m={class:"col-lg-9"},f={class:"page-header"},g={class:"page-title"},j={class:"header-actions"},O={key:0,class:"empty-state"},h={class:"empty-icon"},v={key:1,class:"document-grid"},y={class:"card-header"},w={class:"document-title-block"},V=["title"],C={key:0,class:"file-extension"},N={class:"card-body"},k={class:"document-description"},x={class:"card-footer"},_={class:"document-meta"},E={class:"card-actions"},F={key:2,class:"pagination-wrapper"},D={class:"dialog-footer"},B={class:"category-dialog-content"},S={class:"category-list-section"},U={key:0,class:"text-center p-4"},$={key:1,class:"empty-categories"},T={key:2,class:"category-items"},A={class:"category-info"},R={class:"category-name-section"},L=["title"],z=["title"],I={class:"category-details"},P={class:"category-count"},M={class:"category-actions"},K={key:0,class:"category-form-section"},q={class:"section-header"},J={class:"d-flex align-items-center"},Y={class:"d-flex align-items-center"},H={class:"d-flex align-items-center"},Q={class:"d-flex align-items-center"},G={class:"d-flex align-items-center"},W={class:"ml-2"},X={class:"dialog-footer"};function Z(e,t,o,Z,ee,te){const oe=Object(l["resolveComponent"])("el-alert"),le=Object(l["resolveComponent"])("el-input"),ae=Object(l["resolveComponent"])("el-icon"),ce=Object(l["resolveComponent"])("el-checkbox"),re=Object(l["resolveComponent"])("el-card"),ne=Object(l["resolveComponent"])("Refresh"),ie=Object(l["resolveComponent"])("el-button"),se=Object(l["resolveComponent"])("InfoFilled"),de=Object(l["resolveComponent"])("Clock"),ue=Object(l["resolveComponent"])("el-pagination"),be=Object(l["resolveComponent"])("el-form-item"),pe=Object(l["resolveComponent"])("el-option"),me=Object(l["resolveComponent"])("el-select"),fe=Object(l["resolveComponent"])("upload-filled"),ge=Object(l["resolveComponent"])("el-upload"),je=Object(l["resolveComponent"])("el-form"),Oe=Object(l["resolveComponent"])("el-dialog"),he=Object(l["resolveComponent"])("Loading"),ve=Object(l["resolveComponent"])("el-empty"),ye=Object(l["resolveComponent"])("Edit"),we=Object(l["resolveComponent"])("Delete"),Ve=Object(l["resolveComponent"])("Document"),Ce=Object(l["resolveComponent"])("Files"),Ne=Object(l["resolveComponent"])("Tickets"),ke=Object(l["resolveComponent"])("DataAnalysis"),xe=Object(l["resolveComponent"])("PictureFilled"),_e=Object(l["resolveComponent"])("el-color-picker"),Ee=Object(l["resolveComponent"])("KnowledgeBuilder");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{class:"knowledge-container",key:Z.internalRefreshKey},[Object(l["createVNode"])(oe,{title:"知识库使用说明",type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},{default:Object(l["withCtx"])(()=>t[22]||(t[22]=[Object(l["createElementVNode"])("div",null,[Object(l["createTextVNode"])(" 知识库的"),Object(l["createElementVNode"])("b",null,"【上传文档】"),Object(l["createTextVNode"])("、"),Object(l["createElementVNode"])("b",null,"【构建知识库】"),Object(l["createTextVNode"])("及"),Object(l["createElementVNode"])("b",null,"【分类管理】"),Object(l["createTextVNode"])("等核心功能，主要由企业所有者（老板角色）在后台进行统一管理和构建。 "),Object(l["createElementVNode"])("br"),Object(l["createTextVNode"])(" 普通员工此页面进行已有知识的"),Object(l["createElementVNode"])("b",null,"查阅和检索"),Object(l["createTextVNode"])("。 ")],-1)])),_:1}),Object(l["createElementVNode"])("div",a,[Object(l["createElementVNode"])("div",c,[Object(l["createVNode"])(re,{class:"category-card"},{default:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",r,[Object(l["createVNode"])(le,{modelValue:Z.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=e=>Z.searchQuery=e),placeholder:"搜索文档...",clearable:"","prefix-icon":Z.Search,onInput:Z.handleSearch},null,8,["modelValue","prefix-icon","onInput"])]),Object(l["createElementVNode"])("div",n,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(Z.categories,(e,t)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:e.id||t,class:Object(l["normalizeClass"])(["category-item",{active:Z.selectedCategory===(e.id||t)}]),onClick:o=>Z.selectCategory(e.id||t)},[Object(l["createElementVNode"])("div",{class:"category-icon",style:Object(l["normalizeStyle"])({"background-color":e.color})},[Object(l["createVNode"])(ae,{size:20,color:"white"},{default:Object(l["withCtx"])(()=>[(Object(l["openBlock"])(),Object(l["createBlock"])(Object(l["resolveDynamicComponent"])(e.icon)))]),_:2},1024)],4),Object(l["createElementVNode"])("span",s,Object(l["toDisplayString"])(e.name),1),Object(l["createElementVNode"])("span",d,Object(l["toDisplayString"])(e.document_count||0),1)],10,i))),128))]),Object(l["createElementVNode"])("div",u,[t[31]||(t[31]=Object(l["createElementVNode"])("h6",null,"筛选条件",-1)),Object(l["createElementVNode"])("div",b,[t[30]||(t[30]=Object(l["createElementVNode"])("h6",null,"文件类型",-1)),Object(l["createElementVNode"])("div",p,[Object(l["createVNode"])(ce,{modelValue:Z.filters.types.pdf,"onUpdate:modelValue":t[1]||(t[1]=e=>Z.filters.types.pdf=e),onChange:Z.applyFilters},{default:Object(l["withCtx"])(()=>t[23]||(t[23]=[Object(l["createTextVNode"])("PDF文档")])),_:1},8,["modelValue","onChange"]),Object(l["createVNode"])(ce,{modelValue:Z.filters.types.doc,"onUpdate:modelValue":t[2]||(t[2]=e=>Z.filters.types.doc=e),onChange:Z.applyFilters},{default:Object(l["withCtx"])(()=>t[24]||(t[24]=[Object(l["createTextVNode"])("Word文档")])),_:1},8,["modelValue","onChange"]),Object(l["createVNode"])(ce,{modelValue:Z.filters.types.xls,"onUpdate:modelValue":t[3]||(t[3]=e=>Z.filters.types.xls=e),onChange:Z.applyFilters},{default:Object(l["withCtx"])(()=>t[25]||(t[25]=[Object(l["createTextVNode"])("Excel表格")])),_:1},8,["modelValue","onChange"]),Object(l["createVNode"])(ce,{modelValue:Z.filters.types.ppt,"onUpdate:modelValue":t[4]||(t[4]=e=>Z.filters.types.ppt=e),onChange:Z.applyFilters},{default:Object(l["withCtx"])(()=>t[26]||(t[26]=[Object(l["createTextVNode"])("PPT演示文稿")])),_:1},8,["modelValue","onChange"]),Object(l["createVNode"])(ce,{modelValue:Z.filters.types.img,"onUpdate:modelValue":t[5]||(t[5]=e=>Z.filters.types.img=e),onChange:Z.applyFilters},{default:Object(l["withCtx"])(()=>t[27]||(t[27]=[Object(l["createTextVNode"])("图片")])),_:1},8,["modelValue","onChange"]),Object(l["createVNode"])(ce,{modelValue:Z.filters.types.txt,"onUpdate:modelValue":t[6]||(t[6]=e=>Z.filters.types.txt=e),onChange:Z.applyFilters},{default:Object(l["withCtx"])(()=>t[28]||(t[28]=[Object(l["createTextVNode"])("文本文件")])),_:1},8,["modelValue","onChange"]),Object(l["createVNode"])(ce,{modelValue:Z.filters.types.md,"onUpdate:modelValue":t[7]||(t[7]=e=>Z.filters.types.md=e),onChange:Z.applyFilters},{default:Object(l["withCtx"])(()=>t[29]||(t[29]=[Object(l["createTextVNode"])("Markdown文件")])),_:1},8,["modelValue","onChange"])])])])]),_:1})]),Object(l["createElementVNode"])("div",m,[Object(l["createElementVNode"])("div",f,[Object(l["createElementVNode"])("h2",g,Object(l["toDisplayString"])(Z.currentCategoryName),1),Object(l["createElementVNode"])("div",j,[Object(l["createVNode"])(ie,{text:"",bg:"",size:"large",onClick:Z.forceRefresh},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(ae,{class:"el-icon--left"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(ne)]),_:1}),t[32]||(t[32]=Object(l["createTextVNode"])(" 刷新 "))]),_:1},8,["onClick"])])]),Object(l["createVNode"])(re,{class:"document-container-card",shadow:"never"},{default:Object(l["withCtx"])(()=>[0===Z.documents.length?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",O,[Object(l["createElementVNode"])("div",h,[Object(l["createVNode"])(ae,null,{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(se)]),_:1})]),t[33]||(t[33]=Object(l["createElementVNode"])("h3",{class:"empty-title"},"当前分类下暂无文档",-1))])):(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",v,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(Z.documents,e=>(Object(l["openBlock"])(),Object(l["createBlock"])(re,{key:e.id,class:"document-item-card",shadow:"hover","body-style":"padding: 0; height: 100%; display: flex; flex-direction: column;"},{default:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",y,[Object(l["createElementVNode"])("div",{class:Object(l["normalizeClass"])(["file-icon","file-icon-"+e.file_type])},[(Object(l["openBlock"])(),Object(l["createBlock"])(Object(l["resolveDynamicComponent"])(Z.getFileIcon(e.file_type))))],2),Object(l["createElementVNode"])("div",w,[Object(l["createElementVNode"])("h5",{class:"document-title",title:e.title},[Object(l["createTextVNode"])(Object(l["toDisplayString"])(e.title)+" ",1),e.file_type?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",C,"."+Object(l["toDisplayString"])(e.file_type),1)):Object(l["createCommentVNode"])("",!0)],8,V)])]),Object(l["createElementVNode"])("div",N,[Object(l["createElementVNode"])("p",k,Object(l["toDisplayString"])(e.description||"暂无描述信息"),1)]),Object(l["createElementVNode"])("div",x,[Object(l["createElementVNode"])("div",_,[Object(l["createVNode"])(ae,null,{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(de)]),_:1}),Object(l["createElementVNode"])("span",null,Object(l["toDisplayString"])(Z.formatDate(e.date)),1)]),Object(l["createElementVNode"])("div",E,[Object(l["createVNode"])(ie,{type:"primary",text:"",bg:"",icon:Z.Download,onClick:Object(l["withModifiers"])(t=>Z.downloadDocument(e),["stop"])},{default:Object(l["withCtx"])(()=>t[34]||(t[34]=[Object(l["createTextVNode"])("下载")])),_:2},1032,["icon","onClick"])])])]),_:2},1024))),128))])),Z.documents.length>0?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",F,[Object(l["createVNode"])(ue,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:Z.totalDocs,"page-size":Z.pageSize,"page-sizes":[12,24,48,96],"current-page":Z.currentPage,onCurrentChange:Z.handlePageChange,onSizeChange:Z.handleSizeChange},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"])])):Object(l["createCommentVNode"])("",!0)]),_:1})])]),Object(l["createVNode"])(Oe,{modelValue:Z.uploadVisible,"onUpdate:modelValue":t[11]||(t[11]=e=>Z.uploadVisible=e),title:"上传文档",width:"500px","before-close":Z.handleCloseUploadDialog},{footer:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("span",D,[Object(l["createVNode"])(ie,{onClick:Z.handleCancelUpload},{default:Object(l["withCtx"])(()=>t[37]||(t[37]=[Object(l["createTextVNode"])("取消")])),_:1},8,["onClick"]),Object(l["createVNode"])(ie,{type:"primary",onClick:Z.submitUpload,loading:Z.uploading},{default:Object(l["withCtx"])(()=>t[38]||(t[38]=[Object(l["createTextVNode"])("上传")])),_:1},8,["onClick","loading"])])]),default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(je,{ref:"uploadFormRef",model:Z.uploadForm,rules:Z.uploadRules},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(be,{label:"文档标题",prop:"title"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(le,{modelValue:Z.uploadForm.title,"onUpdate:modelValue":t[8]||(t[8]=e=>Z.uploadForm.title=e),placeholder:"请输入文档标题"},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(be,{label:"文档描述"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(le,{modelValue:Z.uploadForm.description,"onUpdate:modelValue":t[9]||(t[9]=e=>Z.uploadForm.description=e),type:"textarea",rows:3,placeholder:"请输入文档描述"},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(be,{label:"选择分类"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(me,{modelValue:Z.uploadForm.category,"onUpdate:modelValue":t[10]||(t[10]=e=>Z.uploadForm.category=e),placeholder:"请选择分类",style:{width:"100%"}},{default:Object(l["withCtx"])(()=>[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(Z.categories.filter(e=>"all"!==e.id),(e,t)=>(Object(l["openBlock"])(),Object(l["createBlock"])(pe,{key:t,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Object(l["createVNode"])(be,{label:"文档文件",prop:"file"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(ge,{class:"upload-demo",drag:"",action:"javascript:void(0);","auto-upload":!1,"on-change":Z.handleFileChange,"on-remove":Z.handleRemove,limit:1,"before-upload":Z.beforeUpload,"on-error":Z.handleUploadError,ref:"uploadRef"},{tip:Object(l["withCtx"])(()=>t[35]||(t[35]=[Object(l["createElementVNode"])("div",{class:"el-upload__tip"},[Object(l["createElementVNode"])("strong",null,"仅支持"),Object(l["createTextVNode"])("上传 txt, pdf, doc, docx, md, ppt, pptx, xls, xlsx 格式文件，单个文件不超过10MB ")],-1)])),default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(ae,{class:"el-icon--upload"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(fe)]),_:1}),t[36]||(t[36]=Object(l["createElementVNode"])("div",{class:"el-upload__text"},[Object(l["createTextVNode"])(" 拖拽文件到此处或"),Object(l["createElementVNode"])("em",null,"点击上传")],-1))]),_:1},8,["on-change","on-remove","before-upload","on-error"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","before-close"]),Object(l["createVNode"])(Oe,{modelValue:Z.showCategoryDialog,"onUpdate:modelValue":t[16]||(t[16]=e=>Z.showCategoryDialog=e),title:"分类管理",width:"850px"},{default:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",B,[Object(l["createElementVNode"])("div",S,[t[40]||(t[40]=Object(l["createElementVNode"])("div",{class:"section-header"},[Object(l["createElementVNode"])("h5",null,"已有分类")],-1)),Z.categoryLoading?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",U,[Object(l["createVNode"])(ae,{class:"is-loading"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(he)]),_:1}),t[39]||(t[39]=Object(l["createTextVNode"])(" 加载中... "))])):Z.categories.length<=1?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",$,[Object(l["createVNode"])(ve,{description:""})])):(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",T,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(Z.categories.filter(e=>"all"!==e.id),(e,t)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{key:t,class:"category-list-item"},[Object(l["createElementVNode"])("div",A,[Object(l["createElementVNode"])("div",{class:"category-color",style:Object(l["normalizeStyle"])({backgroundColor:e.color})},null,4),Object(l["createElementVNode"])("div",R,[Object(l["createElementVNode"])("div",{class:"category-name",title:e.name},Object(l["toDisplayString"])(e.name),9,L),Object(l["createElementVNode"])("div",{class:"category-desc",title:e.description},Object(l["toDisplayString"])(e.description||"无描述"),9,z)])]),Object(l["createElementVNode"])("div",I,[Object(l["createElementVNode"])("span",P,Object(l["toDisplayString"])(e.document_count||0)+"个文档",1),Object(l["createElementVNode"])("div",M,[Object(l["createVNode"])(ie,{type:"primary",size:"small",plain:"",onClick:t=>Z.editCategory(e)},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(ae,null,{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(ye)]),_:1})]),_:2},1032,["onClick"]),Object(l["createVNode"])(ie,{type:"danger",size:"small",plain:"",onClick:t=>Z.handleDeleteCategory(e)},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(ae,null,{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(we)]),_:1})]),_:2},1032,["onClick"])])])]))),128))]))]),Z.showAddCategoryForm?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",K,[Object(l["createElementVNode"])("div",q,[Object(l["createElementVNode"])("h5",null,Object(l["toDisplayString"])(Z.editingCategory?"编辑分类":"新增分类"),1),Object(l["createVNode"])(ie,{size:"small",onClick:Z.cancelCategoryForm},{default:Object(l["withCtx"])(()=>t[41]||(t[41]=[Object(l["createTextVNode"])(" 取消 ")])),_:1},8,["onClick"])]),Object(l["createVNode"])(je,{model:Z.categoryForm,"label-width":"80px"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(be,{label:"分类名称",required:""},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(le,{modelValue:Z.categoryForm.name,"onUpdate:modelValue":t[12]||(t[12]=e=>Z.categoryForm.name=e),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(be,{label:"分类描述"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(le,{type:"textarea",modelValue:Z.categoryForm.description,"onUpdate:modelValue":t[13]||(t[13]=e=>Z.categoryForm.description=e),rows:2,placeholder:"请输入分类描述"},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(be,{label:"图标"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(me,{modelValue:Z.categoryForm.icon,"onUpdate:modelValue":t[14]||(t[14]=e=>Z.categoryForm.icon=e),placeholder:"选择图标",style:{width:"100%"}},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(pe,{value:"Document",label:"文档"},{default:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",J,[Object(l["createVNode"])(ae,null,{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(Ve)]),_:1}),t[42]||(t[42]=Object(l["createTextVNode"])()),t[43]||(t[43]=Object(l["createElementVNode"])("span",{class:"ml-2"},"文档",-1))])]),_:1}),Object(l["createVNode"])(pe,{value:"Files",label:"文件夹"},{default:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",Y,[Object(l["createVNode"])(ae,null,{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(Ce)]),_:1}),t[44]||(t[44]=Object(l["createTextVNode"])()),t[45]||(t[45]=Object(l["createElementVNode"])("span",{class:"ml-2"},"文件夹",-1))])]),_:1}),Object(l["createVNode"])(pe,{value:"Tickets",label:"票据"},{default:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",H,[Object(l["createVNode"])(ae,null,{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(Ne)]),_:1}),t[46]||(t[46]=Object(l["createTextVNode"])()),t[47]||(t[47]=Object(l["createElementVNode"])("span",{class:"ml-2"},"票据",-1))])]),_:1}),Object(l["createVNode"])(pe,{value:"DataAnalysis",label:"数据分析"},{default:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",Q,[Object(l["createVNode"])(ae,null,{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(ke)]),_:1}),t[48]||(t[48]=Object(l["createTextVNode"])()),t[49]||(t[49]=Object(l["createElementVNode"])("span",{class:"ml-2"},"数据分析",-1))])]),_:1}),Object(l["createVNode"])(pe,{value:"PictureFilled",label:"图片"},{default:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("div",G,[Object(l["createVNode"])(ae,null,{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(xe)]),_:1}),t[50]||(t[50]=Object(l["createTextVNode"])()),t[51]||(t[51]=Object(l["createElementVNode"])("span",{class:"ml-2"},"图片",-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1}),Object(l["createVNode"])(be,{label:"颜色"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(_e,{modelValue:Z.categoryForm.color,"onUpdate:modelValue":t[15]||(t[15]=e=>Z.categoryForm.color=e),"show-alpha":"",onChange:Z.formatColorValue},null,8,["modelValue","onChange"]),Object(l["createElementVNode"])("span",W,Object(l["toDisplayString"])(Z.categoryForm.color),1)]),_:1}),Object(l["createVNode"])(be,null,{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(ie,{type:"primary",onClick:Z.saveCategoryForm},{default:Object(l["withCtx"])(()=>t[52]||(t[52]=[Object(l["createTextVNode"])("保存")])),_:1},8,["onClick"]),Object(l["createVNode"])(ie,{onClick:Z.cancelCategoryForm},{default:Object(l["withCtx"])(()=>t[53]||(t[53]=[Object(l["createTextVNode"])("取消")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model"])])):Object(l["createCommentVNode"])("",!0)])]),_:1},8,["modelValue"]),Object(l["createVNode"])(Ee,{modelValue:Z.buildingVisible,"onUpdate:modelValue":t[17]||(t[17]=e=>Z.buildingVisible=e),onBuildCompleted:Z.handleBuildCompleted,onBuildFailed:Z.handleBuildFailed},null,8,["modelValue","onBuildCompleted","onBuildFailed"]),Object(l["createVNode"])(Oe,{modelValue:Z.editDialogVisible,"onUpdate:modelValue":t[21]||(t[21]=e=>Z.editDialogVisible=e),title:"编辑文档",width:"500px","before-close":Z.handleCloseEditDialog},{footer:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("span",X,[Object(l["createVNode"])(ie,{onClick:Z.handleCancelEditDialog},{default:Object(l["withCtx"])(()=>t[54]||(t[54]=[Object(l["createTextVNode"])("取消")])),_:1},8,["onClick"]),Object(l["createVNode"])(ie,{type:"primary",onClick:Z.handleUpdateDocument},{default:Object(l["withCtx"])(()=>t[55]||(t[55]=[Object(l["createTextVNode"])("保存")])),_:1},8,["onClick"])])]),default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(je,{model:Z.editForm,"label-width":"80px"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(be,{label:"文档标题"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(le,{modelValue:Z.editForm.title,"onUpdate:modelValue":t[18]||(t[18]=e=>Z.editForm.title=e),placeholder:"请输入文档标题"},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(be,{label:"文档描述"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(le,{modelValue:Z.editForm.description,"onUpdate:modelValue":t[19]||(t[19]=e=>Z.editForm.description=e),type:"textarea",rows:3,placeholder:"请输入文档描述"},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(be,{label:"选择分类"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(me,{modelValue:Z.editForm.category,"onUpdate:modelValue":t[20]||(t[20]=e=>Z.editForm.category=e),placeholder:"请选择分类",style:{width:"100%"}},{default:Object(l["withCtx"])(()=>[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(Z.categories.filter(e=>"all"!==e.id),(e,t)=>(Object(l["openBlock"])(),Object(l["createBlock"])(pe,{key:t,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","before-close"])])}o("d9e2"),o("14d9"),o("f665"),o("7d54"),o("ab43"),o("1e70"),o("79a4"),o("c1a1"),o("8b00"),o("a4e7"),o("1e5a"),o("72c3"),o("88a7"),o("271a"),o("5494");var ee=o("6605"),te=o("3ef4"),oe=o("c9a1"),le=o("f6f2"),ae=o("db6a");const ce={class:"knowledge-builder"},re={class:"status-icon"},ne={class:"status-text"},ie={key:0,class:"progress-container"},se={key:1,class:"info-container"},de={key:2,class:"success-container"},ue={key:3,class:"error-container"},be={class:"dialog-footer"};function pe(e,t,o,a,c,r){const n=Object(l["resolveComponent"])("Loading"),i=Object(l["resolveComponent"])("el-icon"),s=Object(l["resolveComponent"])("CircleCheckFilled"),d=Object(l["resolveComponent"])("CircleCloseFilled"),u=Object(l["resolveComponent"])("el-progress"),b=Object(l["resolveComponent"])("el-alert"),p=Object(l["resolveComponent"])("el-button"),m=Object(l["resolveComponent"])("el-dialog");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",ce,[Object(l["createVNode"])(m,{modelValue:a.visible,"onUpdate:modelValue":t[0]||(t[0]=e=>a.visible=e),title:"构建知识库",width:"650px","close-on-click-modal":!1,"show-close":"processing"!==a.buildingStatus,class:"builder-dialog"},{footer:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("span",be,["processing"!==a.buildingStatus?(Object(l["openBlock"])(),Object(l["createBlock"])(p,{key:0,onClick:a.close},{default:Object(l["withCtx"])(()=>t[4]||(t[4]=[Object(l["createTextVNode"])("关闭")])),_:1},8,["onClick"])):Object(l["createCommentVNode"])("",!0),"pending"===a.buildingStatus?(Object(l["openBlock"])(),Object(l["createBlock"])(p,{key:1,type:"primary",onClick:a.startBuild},{default:Object(l["withCtx"])(()=>t[5]||(t[5]=[Object(l["createTextVNode"])("开始构建")])),_:1},8,["onClick"])):Object(l["createCommentVNode"])("",!0),"failed"===a.buildingStatus?(Object(l["openBlock"])(),Object(l["createBlock"])(p,{key:2,type:"primary",onClick:a.startBuild},{default:Object(l["withCtx"])(()=>t[6]||(t[6]=[Object(l["createTextVNode"])("重试")])),_:1},8,["onClick"])):Object(l["createCommentVNode"])("",!0)])]),default:Object(l["withCtx"])(()=>[(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",{class:"building-status",key:a.buildingStatus},[Object(l["createElementVNode"])("div",re,["processing"===a.buildingStatus?(Object(l["openBlock"])(),Object(l["createBlock"])(i,{key:0,class:"spinning"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(n)]),_:1})):"completed"===a.buildingStatus?(Object(l["openBlock"])(),Object(l["createBlock"])(i,{key:1,class:"success"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(s)]),_:1})):"failed"===a.buildingStatus?(Object(l["openBlock"])(),Object(l["createBlock"])(i,{key:2,class:"error"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(d)]),_:1})):Object(l["createCommentVNode"])("",!0)]),Object(l["createElementVNode"])("div",ne,[Object(l["createElementVNode"])("h3",null,Object(l["toDisplayString"])("pending"===a.buildingStatus?"准备构建知识库":"processing"===a.buildingStatus?"正在构建知识库":"completed"===a.buildingStatus?"知识库构建完成":"知识库构建失败"),1),Object(l["createElementVNode"])("p",null,Object(l["toDisplayString"])(a.buildingMessage),1),"processing"===a.buildingStatus?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",ie,[Object(l["createVNode"])(u,{percentage:a.buildingProgress,format:e=>e+"%"},null,8,["percentage","format"])])):Object(l["createCommentVNode"])("",!0),"pending"===a.buildingStatus?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",se,[Object(l["createVNode"])(b,{title:"构建知识库将处理所有已上传的文档，并将它们整合到一个统一的知识库中",type:"info",closable:!1,"show-icon":""},{default:Object(l["withCtx"])(()=>t[1]||(t[1]=[Object(l["createElementVNode"])("p",null,"这个过程可能需要一些时间，取决于文档数量和大小。",-1),Object(l["createElementVNode"])("p",null,"构建完成后，您将能够使用智能问答功能对知识库进行提问。",-1)])),_:1})])):Object(l["createCommentVNode"])("",!0),"completed"===a.buildingStatus?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",de,[Object(l["createVNode"])(b,{title:"知识库已成功构建！",type:"success",closable:!1,"show-icon":""},{default:Object(l["withCtx"])(()=>t[2]||(t[2]=[Object(l["createElementVNode"])("p",null,"所有文档已被处理并整合到知识库中，您现在可以使用智能问答功能。",-1)])),_:1})])):Object(l["createCommentVNode"])("",!0),"failed"===a.buildingStatus?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",ue,[Object(l["createVNode"])(b,{title:"知识库构建失败",type:"error",closable:!1,"show-icon":""},{default:Object(l["withCtx"])(()=>[Object(l["createElementVNode"])("p",null,Object(l["toDisplayString"])(a.buildingMessage),1),t[3]||(t[3]=Object(l["createElementVNode"])("p",null,"请检查日志或联系管理员解决问题。",-1))]),_:1})])):Object(l["createCommentVNode"])("",!0)])]))]),_:1},8,["modelValue","show-close"])])}var me=o("5a0c"),fe=o.n(me),ge={name:"KnowledgeBuilder",components:{Loading:le["Loading"],CircleCheckFilled:le["CircleCheckFilled"],CircleCloseFilled:le["CircleCloseFilled"]},props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","build-completed","build-failed"],setup(e,{emit:t}){const o=Object(l["computed"])({get:()=>e.modelValue,set:e=>t("update:modelValue",e)}),a=Object(l["ref"])("pending"),c=Object(l["ref"])(0),r=Object(l["ref"])("正在初始化..."),n=Object(l["ref"])(""),i=Object(l["ref"])(""),s=Object(l["ref"])(null);let d=null,u=0;const b=()=>{d&&(clearTimeout(d),d=null,console.log("Polling timer cleared."))},p=async()=>{console.log("startBuild called");try{a.value="processing",r.value="正在启动知识库构建，请稍候...",c.value=0,n.value="",i.value="",s.value=null,u=0,b(),console.log("Calling buildKnowledgeBase API...");const e=await Object(ae["b"])();console.log("buildKnowledgeBase API response:",e),d=setTimeout(m,100),console.log("Initial pollBuildStatus scheduled.")}catch(l){var e,o;console.error("启动知识库构建时出错:",l),a.value="failed",r.value=(null===(e=l.response)||void 0===e||null===(o=e.data)||void 0===o?void 0:o.message)||l.message||"启动构建失败",t("build-failed",l),b()}},m=async()=>{if(console.log("pollBuildStatus called. Current status:",a.value),("completed"===a.value||"failed"===a.value)&&d)return console.log("Build already completed or failed, clearing timer from pollBuildStatus."),void b();if(!o.value&&d)return console.log("Dialog not visible, clearing timer from pollBuildStatus."),void b();try{console.log("Calling getKnowledgeBaseStatus API...");const e=await Object(ae["i"])();console.log("getKnowledgeBaseStatus API response:",JSON.stringify(e,null,2));const o=e||{};if(o&&"object"===typeof o){console.log("Status object received:",o);const e=o.status||"pending";if(a.value=e,r.value=o.message||("processing"===e?"正在处理中，请稍候...":"等待状态更新..."),c.value=o.progress||c.value,console.log("Updated frontend status:",a.value,"Progress:",c.value,"Message:",r.value),o.full_output?(n.value=o.full_output,i.value=o.full_output):o.graphrag_output&&(n.value=o.graphrag_output),Object(l["nextTick"])(()=>{const e=document.querySelector(".output-content pre");e&&(e.scrollTop=e.scrollHeight)}),"completed"===e||"failed"===e)if(console.log(`Build ended with status: ${e}. Stopping poll.`),b(),"completed"===e){c.value=100;const e=o.started_at?new Date(o.started_at):null,l=o.finished_at?new Date(o.finished_at):new Date;s.value={startTime:e,endTime:l,duration:e&&l?f(e,l):"未知",totalDocs:o.total_docs||0,totalChunks:o.total_chunks||0},te["a"].success(o.message||"知识库构建完成！"),t("build-completed")}else te["a"].error(o.message||"知识库构建失败，请查看输出或日志。"),t("build-failed",{message:o.message,detail:o.error_detail});else if("processing"===e){const e=1e3;console.log(`Status is 'processing'. Scheduling next poll in ${e}ms.`),b(),d=setTimeout(m,e)}else if("pending"===e){const e=2e3;console.log(`Status is 'pending'. Scheduling next poll in ${e}ms.`),b(),d=setTimeout(m,e)}else console.warn("Unknown status from backend:",e,"Stopping poll."),b()}else if(console.warn("Invalid or empty response object from getKnowledgeBaseStatus. Response:",JSON.stringify(e)),r.value="获取状态响应格式无效...","processing"===a.value){const e=3e3;b(),d=setTimeout(m,e)}else a.value="failed",r.value="获取状态失败，响应无效。",t("build-failed",{message:"获取状态失败，响应无效。"}),b()}catch(e){if(console.error("获取构建状态时出错 (pollBuildStatus catch):",e),r.value="获取构建状态失败: "+(e.message||"未知错误")+". 将尝试再次轮询。","processing"===a.value)if(u=(u||0)+1,u<=5){const e=3e3;b(),d=setTimeout(m,e),console.log(`轮询错误，第${u}次重试，${e}ms后重试`)}else console.error("轮询重试次数已达上限，停止轮询"),a.value="failed",r.value="获取构建状态失败，已达重试上限。",t("build-failed",e),b();else a.value="failed",r.value="获取构建状态失败。",t("build-failed",e),b()}},f=(e,t)=>{const o=Math.abs(t-e),l=Math.floor(o/6e4),a=(o%6e4/1e3).toFixed(0);return`${l}分${a}秒`},g=e=>e?fe()(e).format("YYYY-MM-DD HH:mm:ss"):"未知",j=()=>{o.value=!1};return Object(l["onMounted"])(()=>{console.log("KnowledgeBuilder onMounted. Initial modelValue:",e.modelValue)}),Object(l["onBeforeUnmount"])(()=>{console.log("KnowledgeBuilder onBeforeUnmount. Clearing poll timer."),b()}),Object(l["watch"])(o,e=>{e?(console.log("Dialog became visible. Current status:",a.value),"processing"!==a.value&&(console.log("Resetting status to pending for new build session."),a.value="pending",r.value="准备开始新的知识库构建。",c.value=0,n.value="",i.value="",s.value=null,u=0,b())):(console.log("Dialog closed. Current status:",a.value),"processing"===a.value&&(console.log("Dialog closed during processing, stopping poll timer."),b()))}),{visible:o,buildingStatus:a,buildingProgress:c,buildingMessage:r,buildingOutput:n,fullOutput:i,buildingStats:s,startBuild:p,formatBuildTime:g,close:j}}},je=(o("5bd1"),o("6b0d")),Oe=o.n(je);const he=Oe()(ge,[["render",pe],["__scopeId","data-v-17b2f24e"]]);var ve=he,ye={name:"Knowledge",components:{KnowledgeBuilder:ve},setup(){const e=Object(ee["c"])(),t=Object(l["ref"])(Date.now()),o=Object(l["ref"])(""),a=Object(l["ref"])("all"),c=Object(l["ref"])(1),r=Object(l["ref"])(10),n=Object(l["ref"])(!1),i=Object(l["ref"])(!1),s=Object(l["ref"])(!1),d=Object(l["ref"])(!1),u=Object(l["ref"])(!1),b=Object(l["ref"])(null),p=Object(l["ref"])("list"),m=Object(l["ref"])("-created_at"),f=Object(l["ref"])(!1),g=Object(l["ref"])(!1),j=Object(l["ref"])(!1),O=Object(l["ref"])(!1),h=Object(l["ref"])(!0),v=Object(l["ref"])(null),y=Object(l["ref"])([]),w=Object(l["ref"])(null),V=Object(l["ref"])(null),C=Object(l["ref"])(0),N=Object(l["reactive"])({id:null,title:"",description:"",category:null,creator:null}),k=Object(l["reactive"])({title:"",description:"",file:null,category:null,tags:"",chunk_size:500,chunk_overlap:50,is_public:!0}),x={title:[{required:!0,message:"请输入文档标题",trigger:"blur"}],file:[{required:!0,message:"请上传文件",trigger:"change"}]},_=Object(l["reactive"])({id:null,name:"",description:"",icon:"Document",color:"#409EFF"}),E=Object(l["ref"])({types:{pdf:!1,doc:!1,xls:!1,ppt:!1,img:!1,txt:!1,md:!1}}),F=Object(l["ref"])([{id:"all",name:"全部文档",icon:"Files",color:"#007bff",document_count:0}]),D=Object(l["ref"])([]),B=Object(l["computed"])(()=>{const e=F.value.find(e=>e.id===a.value);return e?e.name:"全部文档"}),S=Object(l["computed"])(()=>D.value.filter(e=>"processing"===e.status).length),U=Object(l["ref"])(!1),$=async()=>{f.value=!0,console.log("开始获取知识库分类...");try{const t=await Object(ae["f"])();console.log("获取分类响应:",t);let o=[];if(t)if(t.results&&Array.isArray(t.results))o=t.results;else if(Array.isArray(t))o=t;else if("object"===typeof t){const e=["data","categories","items"];for(const l of e)if(t[l]&&Array.isArray(t[l])){o=t[l];break}}let l=0;try{const e=await Object(ae["h"])({page:1,page_size:1});e&&Object.prototype.hasOwnProperty.call(e,"count")?(l=e.count,console.log("获取到全部文档总数:",l)):console.warn("未能从 getDocuments 响应中获取总数 count:",e)}catch(e){console.error("获取全部文档总数失败:",e)}const a={id:"all",name:"全部文档",icon:"Files",color:"#007bff",document_count:l};o&&o.length>0?(console.log("找到分类数据，数量:",o.length),F.value=[a,...o]):(console.warn("未找到有效的分类数据"),t&&t.message?te["a"].warning(t.message):!t&&o.length,F.value=[a])}catch(t){console.error("获取分类失败:",t),t.response?(console.error("错误响应状态:",t.response.status),console.error("错误响应数据:",t.response.data)):t.message&&t.message.includes("message channel closed")?console.warn("通信通道关闭：",t.message):te["a"].error("无法加载知识库分类，请检查网络连接或联系管理员"),F.value=[{id:"all",name:"全部文档",icon:"Files",color:"#007bff",document_count:0}]}finally{f.value=!1}},T=async()=>{g.value=!0;try{const e={page:c.value,page_size:r.value,ordering:m.value};a.value&&"all"!==a.value&&(e.category=a.value),o.value&&(e.search=o.value);const t=[],l={doc:["doc","docx"],xls:["xls","xlsx"],ppt:["ppt","pptx"]};for(const[o,a]of Object.entries(E.value.types))a&&(l[o]?t.push(...l[o]):t.push(o));const n=[...new Set(t)];n.length>0&&(e.file_type=n.join(","));const i=await Object(ae["h"])(e);if(i)if(console.log("获取文档响应:",i),i.results&&Array.isArray(i.results))D.value=i.results,C.value=i.count||i.total||D.value.length;else if(Array.isArray(i))D.value=i,C.value=i.length;else if(i.data&&Array.isArray(i.data))D.value=i.data,C.value=i.total||i.count||D.value.length;else if("object"===typeof i){const e=Object.values(i).filter(e=>e&&"object"===typeof e&&("title"in e||"file"in e));e.length>0?(D.value=e,C.value=e.length):(console.error("无法从响应中提取文档列表:",i),D.value=[],C.value=0,te["a"].warning("获取文档列表格式异常"))}else console.error("文档响应格式不支持:",typeof i,i),D.value=[],C.value=0,te["a"].warning("获取文档列表格式不支持");else D.value=[],C.value=0}catch(e){console.error("获取文档失败:",e),te["a"].error("无法加载知识库文档")}finally{g.value=!1}},A=async e=>{O.value=!0;try{const t=await Object(ae["g"])(e);y.value=t}catch(t){console.error("获取文档分块失败:",t),te["a"].error("无法加载文档分块数据")}finally{O.value=!1}},R=e=>{c.value=e,T()},L=e=>{r.value=e,c.value=1,T()},z=e=>{a.value=e,c.value=1,T()},I=()=>{c.value=1,T()},P=()=>{c.value=1,T()},M=e=>{if(console.log(">>> handleFileChange: Received file object from el-upload:",e),e&&e.raw){if(console.log(">>> handleFileChange: file.raw (the actual File object):",e.raw),0===e.raw.size)return te["a"].error("文件大小为0，请选择有效文件"),!1;const t=10485760;if(e.raw.size>t)return te["a"].error(`文件过大，最大支持${t/1048576}MB`),!1;const o=e.raw.name,l=o.slice(o.lastIndexOf(".")+1).toLowerCase(),a=["txt","pdf","doc","docx","md","ppt","pptx","xls","xlsx"];return a.includes(l)?(k.file=e.raw,console.log(">>> handleFileChange: uploadForm.file after assignment:",k.file,k.file?`Name: ${k.file.name}, Size: ${k.file.size} bytes, Type: ${k.file.type}`:"No file"),k.title=k.title||e.name.split(".")[0],!0):(te["a"].error(`不支持的文件类型: ${l}。仅支持 ${a.join(", ")} 格式。`),k.file=null,V.value&&V.value.clearFiles(),!1)}return console.warn(">>> handleFileChange: file.raw is not available. File:",e),!1},K=()=>{if(console.log(">>> handleRemove: File removed by user. Setting uploadForm.file to null."),k.file=null,k.title&&k.title.includes(".")){var e,t;const o=null===(e=k.file)||void 0===e||null===(t=e.name)||void 0===t?void 0:t.split(".")[0];k.title===o&&(k.title="")}},q=e=>{const t=e.name,o=t.slice(t.lastIndexOf(".")+1).toLowerCase(),l=["txt","pdf","doc","docx","md","ppt","pptx","xls","xlsx"];if(!l.includes(o))return te["a"].error(`不支持的文件类型: ${o}。仅支持 ${l.join(", ")} 格式。`),!1;const a=10485760;return e.size>a?(te["a"].error(`文件大小超过限制，最大支持 ${a/1048576}MB`),!1):0!==e.size||(te["a"].error("文件为空，请选择有效文件"),!1)},J=e=>{console.error("上传错误:",e),te["a"].error("上传错误，请检查文件格式或网络连接"),k.file=null},Y=async()=>{w.value&&await w.value.validate(async e=>{if(!e)return console.log("error submit!! Form validation failed."),j.value=!1,!1;{if(j.value=!0,console.log(">>> submitUpload: Current uploadForm.file before appending to FormData:",k.file),!k.file)return console.warn(">>> submitUpload: uploadForm.file is null or undefined before appending."),j.value=!1,void te["a"].warning("请先选择文件再上传");if(0===k.file.size)return console.error(">>> submitUpload: 文件大小为0，无法上传"),j.value=!1,void te["a"].error("文件大小为0，请选择有效文件");console.log(`>>> submitUpload: uploadForm.file details - Name: ${k.file.name}, Size: ${k.file.size} bytes, Type: ${k.file.type}`);const e=new FormData;e.append("title",k.title),e.append("description",k.description),e.append("file",k.file),k.category?(e.append("category",k.category),console.log(">>> submitUpload: Attaching category to FormData: "+k.category)):console.log(">>> submitUpload: No category selected (uploadForm.category is null/empty). Not attaching to FormData."),e.append("tags",JSON.stringify(k.tags)),e.append("chunk_size",k.chunk_size.toString()),e.append("chunk_overlap",k.chunk_overlap.toString()),e.append("is_public",k.is_public.toString());const o=e.get("file");if(!o||0===o.size)return console.error(">>> submitUpload: FormData中的文件无效或大小为0"),j.value=!1,void te["a"].error("FormData处理文件失败，请重试");try{const t=await Object(ae["m"])(e);console.log(">>> submitUpload: API Response from uploadDocument:",t),te["a"].success("文档上传请求已发送，后台正在处理..."),j.value=!1,n.value=!1;const o=k.title;ce();let l=0;const c=10,r=3e3,i=setInterval(async()=>{l++,console.log(`>>> Polling for document status (attempt ${l}/${c})...`);try{const e=await Object(ae["h"])({page:1,page_size:10,ordering:"-created_at",category:a.value||void 0});let t=null;e&&e.results&&e.results.length>0&&(t=e.results.find(e=>e.title===o)),t?(console.log(`>>> Polling: Document "${o}" found (or assumed processed). Refreshing lists.`),clearInterval(i),T(),$(),te["a"].success(`文档 "${o}" 处理完毕并已刷新列表!`),j.value=!1):l>=c&&(console.log(">>> Polling: Max attempts reached. Refreshing lists anyway."),clearInterval(i),T(),$(),te["a"].info(`文档 "${o}" 可能仍在后台处理中，列表已刷新。`),j.value=!1)}catch(e){console.error(">>> Polling error:",e),clearInterval(i),T(),$(),te["a"].error("检查文档状态时出错，列表已刷新。"),j.value=!1}},r)}catch(t){console.error("上传文档失败:",t),j.value=!1,V.value&&V.value.clearFiles();let e="文档上传失败";if(t.response&&t.response.data){const o=t.response.data;"string"===typeof o?e+=": "+o:o.detail?e+=": "+o.detail:o.message?e+=": "+o.message:o.file&&Array.isArray(o.file)?e+=": "+o.file.join(", "):"error"===o.status&&o.message&&o.message.includes("不支持的文件类型")?e=o.message:"object"===typeof o&&(e+=": "+JSON.stringify(o).substring(0,100))}te["a"].error(e)}}})},H=async e=>{v.value=e,u.value=!0,await A(e.id)},Q=e=>{b.value=e,_.id=e.id,_.name=e.name,_.description=e.description||"",_.icon=e.icon||"Document",e.color&&e.color.length>20?(_.color=e.color.substring(0,20),console.log(`编辑分类时截断颜色值: ${e.color} -> ${_.color}`)):_.color=e.color||"#409EFF",d.value=!0},G=async e=>{try{await oe["a"].confirm(`确定要删除分类 "${e.name}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Object(ae["c"])(e.id),te["a"].success("分类删除成功"),$()}catch(l){var t,o;if("cancel"!==l)console.error("删除分类失败:",l),te["a"].error("删除分类失败: "+((null===(t=l.response)||void 0===t||null===(o=t.data)||void 0===o?void 0:o.detail)||l.message||"未知错误"))}},W=async()=>{if(console.log("保存分类表单被调用，模式:",b.value?"edit":"add"),Ve(_.color),d.value=!1,b.value){if(console.log("尝试更新分类:",_),!b.value.id)return void te["a"].error("无法更新分类，未找到当前编辑的分类ID");try{const e=await Object(ae["k"])(b.value.id,_);console.log("更新分类响应:",e),e&&(e.id||e.data&&e.data.id)?(te["a"].success("分类更新成功"),await $(),a.value===(e.id||e.data.id)&&await T()):e&&e.error?te["a"].error("更新分类失败: "+(e.error.message||"未知错误")):e&&e.detail?te["a"].error("更新分类失败: "+e.detail):te["a"].error("更新分类失败，响应格式不符合预期或无ID返回")}catch(e){console.error("更新分类失败:",e),te["a"].error("更新分类失败，请检查网络或联系管理员")}}else{console.log("尝试添加新分类:",_);try{const e=await Object(ae["a"])(_);if(console.log("添加分类响应:",e),e&&(e.id||e.data&&e.data.id)){te["a"].success("分类添加成功"),await $();const t=e.id||e.data.id;t?(a.value=t,console.log("新分类创建成功，自动选中新分类 ID: "+t),await T()):console.warn("新创建的分类ID未找到，无法自动选中。")}else e&&e.error?te["a"].error("添加分类失败: "+(e.error.message||"未知错误")):e&&e.detail?te["a"].error("添加分类失败: "+e.detail):(te["a"].error("添加分类失败，响应格式不符合预期或无ID返回"),console.error("添加分类失败，响应:",e))}catch(e){console.error("添加分类失败:",e),te["a"].error("添加分类失败，请检查网络或联系管理员")}}Z()},X=()=>{d.value=!1,b.value=null,_.id=null,_.name="",_.description="",_.icon="Document",_.color="#409EFF"},Z=()=>{b.value=null,_.id=null,_.name="",_.description="",_.icon="Document",_.color="#409EFF",d.value=!0},ce=()=>{w.value&&w.value.resetFields(),k.title="",k.description="",k.file=null,k.category=null,k.tags="",k.is_public=!0,k.chunk_size=500,k.chunk_overlap=50,V.value&&V.value.clearFiles(),console.log(">>> resetUploadForm: uploadForm和上传组件已完全重置")},re=()=>{j.value?te["a"].warning("文件正在上传中，请等待上传完成"):(ce(),n.value=!1)},ne=e=>{re(),e()},ie=()=>{ce(),a.value&&"all"!==a.value?(k.category=a.value,console.log(">>> openUploadDialog: Auto-selecting current category: "+a.value)):(k.category=null,console.log(">>> openUploadDialog: No category auto-selected (current is 'all' or none).")),n.value=!0},se=async e=>{try{if(console.log("预览文档对象:",e),e.original_file)try{const t=await fetch(e.original_file);if(t.ok){const e=await t.blob(),o=window.URL.createObjectURL(e);return window.open(o,"_blank"),void setTimeout(()=>window.URL.revokeObjectURL(o),100)}}catch(t){console.warn("通过 original_file 访问失败，尝试其他方式:",t)}try{const t=await Object(ae["e"])(e.id),o=new Blob([t.data],{type:t.headers["content-type"]||"application/octet-stream"}),l=window.URL.createObjectURL(o);return window.open(l,"_blank"),void setTimeout(()=>window.URL.revokeObjectURL(l),100)}catch(o){console.warn("通过API获取文件失败，尝试直接访问文件URL:",o)}if(e.file_url){try{const t=await fetch(e.file_url);if(t.ok){const e=await t.blob(),o=window.URL.createObjectURL(e);return window.open(o,"_blank"),void setTimeout(()=>window.URL.revokeObjectURL(o),100)}}catch(l){console.warn("直接访问文件URL失败:",l)}const t=e.file_url.split("/"),o=t[t.length-1];let c=null;const r=e.file_url.match(/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})/);r&&r[1]&&(c=r[1],console.log("从URL中提取的UUID:",c));const n=["/media/original_files/"+o,"/media/original_files/company_1/"+o,"/backend/media/original_files/"+o,"/backend/media/original_files/company_1/"+o,"/media/documents/1/"+o,"/backend/media/documents/1/"+o];o.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\.[a-z]+$/)||e.id&&(n.push(`/media/documents/1/${e.id}.${e.file_type}`),n.push(`/backend/media/documents/1/${e.id}.${e.file_type}`)),c&&(n.push(`/media/documents/1/${c}.${e.file_type}`),n.push(`/backend/media/documents/1/${c}.${e.file_type}`));for(const e of n)try{const t=await fetch(e);if(t.ok){const e=await t.blob(),o=window.URL.createObjectURL(e);return window.open(o,"_blank"),void setTimeout(()=>window.URL.revokeObjectURL(o),100)}}catch(a){console.warn(`尝试路径 ${e} 失败:`,a)}}throw new Error("无法找到有效的文件路径")}catch(t){console.error("预览文档失败:",t),te["a"].error("预览文档失败: 无法找到或访问文件。请联系管理员检查文件路径配置。")}},de=async e=>{try{if(console.log("下载文档对象:",e),e.original_file)try{const t=await fetch(e.original_file);if(t.ok){const o=await t.blob(),l=e.original_filename||e.title+"."+e.file_type,a=window.URL.createObjectURL(o),c=document.createElement("a");return c.href=a,c.setAttribute("download",l),document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(a),void te["a"].success(`文档 "${l}" 下载成功`)}}catch(t){console.warn("通过 original_file 下载失败，尝试其他方式:",t)}try{const t=await Object(ae["e"])(e.id),o=e.title?`${e.title}.${e.file_type}`:e.file_url?e.file_url.split("/").pop():"document."+e.file_type,l=window.URL.createObjectURL(new Blob([t.data],{type:t.headers["content-type"]||"application/octet-stream"})),a=document.createElement("a");return a.href=l,a.setAttribute("download",o),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(l),void te["a"].success(`文档 "${o}" 下载成功`)}catch(o){console.warn("通过API获取文件失败，尝试直接访问文件URL:",o)}if(e.file_url){try{const t=await fetch(e.file_url);if(t.ok){const o=await t.blob(),l=e.title?`${e.title}.${e.file_type}`:e.file_url.split("/").pop(),a=window.URL.createObjectURL(o),c=document.createElement("a");return c.href=a,c.setAttribute("download",l),document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(a),void te["a"].success(`文档 "${l}" 下载成功`)}}catch(l){console.warn("直接访问文件URL失败:",l)}const t=e.file_url.split("/"),o=t[t.length-1];let c=null;const r=e.file_url.match(/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})/);r&&r[1]&&(c=r[1],console.log("从URL中提取的UUID:",c));const n=["/media/original_files/"+o,"/media/original_files/company_1/"+o,"/backend/media/original_files/"+o,"/backend/media/original_files/company_1/"+o,"/media/documents/1/"+o,"/backend/media/documents/1/"+o];o.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\.[a-z]+$/)||e.id&&(n.push(`/media/documents/1/${e.id}.${e.file_type}`),n.push(`/backend/media/documents/1/${e.id}.${e.file_type}`)),c&&(n.push(`/media/documents/1/${c}.${e.file_type}`),n.push(`/backend/media/documents/1/${c}.${e.file_type}`));for(const l of n)try{const t=await fetch(l);if(t.ok){const l=await t.blob(),a=e.title?`${e.title}.${e.file_type}`:o,c=window.URL.createObjectURL(l),r=document.createElement("a");return r.href=c,r.setAttribute("download",a),document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(c),void te["a"].success(`文档 "${a}" 下载成功`)}}catch(a){console.warn(`尝试路径 ${l} 失败:`,a)}}throw new Error("无法找到有效的文件路径")}catch(t){console.error("下载文档失败:",t),te["a"].error("下载文档失败: 无法找到或访问文件。请联系管理员检查文件路径配置。")}},ue=e=>{console.log("准备分享文档:",e.title),te["a"].info(`文档"${e.title}"的分享功能即将上线`)},be=e=>{N.id=e.id,N.title=e.title,N.description=e.description,N.category=e.category,N.creator=e.creator,i.value=!0},pe=async()=>{if(N.id)try{await Object(ae["l"])(N.id,{title:N.title,description:N.description,category:N.category,creator:N.creator}),te["a"].success("文档更新成功"),i.value=!1,T()}catch(e){console.error("更新文档失败:",e);let t="更新文档失败";if(e.response&&e.response.data){const o=e.response.data;if("object"===typeof o&&null!==o){const e=Object.entries(o).map(([e,t])=>`${e}: ${Array.isArray(t)?t.join(" "):t}`).join("; ");t+=e?": "+e:": 请求失败，无详细信息。"}else t+=": "+o}else e.message?t+=": "+e.message:t+=": 未知错误";te["a"].error(t)}},me=e=>{i.value=!1,e()},fe=()=>{i.value=!1},ge=async e=>{console.log(">>> Vue component: Attempting to delete document (local method):",e);try{await oe["a"].confirm(`确定要删除文档 "${e.title}" 吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),console.log(">>> Vue component: Calling apiDeleteDocument for ID:",e.id),await Object(ae["d"])(e.id),te["a"].success("文档删除成功"),T(),$()}catch(l){if("cancel"!==l){var t,o;console.error("删除文档失败:",l);const e=(null===l||void 0===l||null===(t=l.response)||void 0===t||null===(o=t.data)||void 0===o?void 0:o.detail)||(null===l||void 0===l?void 0:l.message)||"未知错误";te["a"].error("删除文档失败: "+e)}}},je=e=>{const t=e?e.toLowerCase():"",o={pdf:le["Document"],doc:le["Document"],docx:le["Document"],xls:le["DataAnalysis"],xlsx:le["DataAnalysis"],ppt:le["Tickets"],pptx:le["Tickets"],png:le["PictureFilled"],jpg:le["PictureFilled"],jpeg:le["PictureFilled"],gif:le["PictureFilled"],svg:le["PictureFilled"],img:le["PictureFilled"],txt:le["Files"],md:le["Files"],other:le["Files"]};return o[t]||le["Files"]},Oe=e=>{if(!e)return"";const t=new Date(e);return t.toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})},he=e=>e?e<1024?e+" KB":(e/1024).toFixed(2)+" MB":"0 KB",ve=e=>e?Array.isArray(e)?e:e.split(",").map(e=>e.trim()).filter(e=>e):[],ye=()=>{T(),$(),te["a"].success("知识库构建完成，现在可以使用智能问答功能了！")},we=e=>{console.error("知识库构建失败:",e),te["a"].error("知识库构建失败，请检查日志或联系管理员")},Ve=e=>{if(e&&e.length>20){if(e.startsWith("rgba")){const t=e.replace(/rgba\((\d+),\s*(\d+),\s*(\d+),[^)]+\)/,(e,t,o,l)=>{const a=e=>{const t=parseInt(e).toString(16);return 1===t.length?"0"+t:t};return`#${a(t)}${a(o)}${a(l)}`});_.color=t.substring(0,20)}else _.color=e.substring(0,20);console.log(`颜色值已格式化: ${e} -> ${_.color}`)}},Ce=async()=>{console.log("强制刷新知识库组件"),t.value=Date.now(),c.value=1;try{const e=document.querySelectorAll(".el-overlay, .el-overlay-dialog, .el-overlay-message-box, .el-popup-parent--hidden");e.forEach(e=>{if(e&&e.parentNode)try{e.parentNode.removeChild(e)}catch(t){console.error("清理浮层元素失败:",t)}}),document&&document.body&&(document.body.style.overflow="",document.body.classList.remove("el-popup-parent--hidden"),document.body.style.pointerEvents="auto");const t=document.querySelectorAll(".el-dropdown-menu, .el-select-dropdown");t.forEach(e=>{if(e&&e.parentNode)try{e.parentNode.removeChild(e)}catch(t){console.error("清理下拉菜单失败:",t)}})}catch(e){console.error("清理DOM元素失败:",e)}await Object(l["nextTick"])();try{const e=document.querySelectorAll(".knowledge-container button, .el-dropdown-menu__item, .document-item-card, .card-actions button, .card-footer button, .el-dropdown, .category-item");e.forEach(e=>{if(e){e.style.pointerEvents="auto",e.hasAttribute("disabled")&&!e.classList.contains("is-disabled")&&e.removeAttribute("disabled");try{const t=e.parentNode;t&&(e.style.opacity="1",e.style.visibility="visible",e.style.display="")}catch(t){console.error("重置元素样式失败:",t)}}}),V.value&&(V.value.clearFiles(),k.file=null,k.title="",k.description=""),document.querySelectorAll(".document-item-card").forEach(e=>{e&&(e.style.pointerEvents="auto",e.style.cursor="pointer",e.style.zIndex="1",e.style.position="relative")}),document.querySelectorAll(".el-dropdown").forEach(e=>{e&&(e.style.pointerEvents="auto")})}catch(e){console.error("重置交互元素失败:",e)}try{console.log("重新加载所有数据..."),g.value=!0,await $().catch(e=>(console.error("强制刷新分类失败:",e),[])),await T().catch(e=>(console.error("强制刷新文档失败:",e),[])),console.log("数据刷新完成")}catch(e){console.error("强制刷新数据失败:",e)}finally{g.value=!1}await Object(l["nextTick"])(),setTimeout(()=>{try{document.querySelectorAll(".knowledge-container button, .el-dropdown, .document-item-card").forEach(e=>{e&&(e.style.pointerEvents="auto")})}catch(e){console.error("最终DOM修复失败:",e)}},300)};return Object(l["watch"])(()=>e.fullPath,e=>{"/knowledge"===e&&(console.log("检测到路由变化到知识库页面，强制刷新"),setTimeout(()=>{Ce()},100))}),Object(l["onMounted"])(()=>{console.log("Knowledge组件挂载"),Ce()}),Object(l["onActivated"])(()=>{console.log("Knowledge组件被激活"),Ce()}),Object(l["onBeforeUnmount"])(()=>{}),{searchQuery:o,selectedCategory:a,categories:F,documents:D,filters:E,currentPage:c,pageSize:r,totalDocs:C,uploadVisible:n,uploadForm:k,uploadFormRef:w,uploadRef:V,uploadRules:x,uploading:j,loading:g,viewMode:p,sortOrder:m,showCategoryDialog:s,showAddCategoryForm:d,editingCategory:b,categoryForm:_,categoryLoading:f,showChunksDialog:u,selectedDocument:v,documentChunks:y,chunksLoading:O,isAdmin:h,currentCategoryName:B,processingCount:S,forceRefresh:Ce,internalRefreshKey:t,Search:le["Search"],Upload:le["Upload"],FolderAdd:le["FolderAdd"],View:le["View"],Download:le["Download"],More:le["More"],Share:le["Share"],Edit:le["Edit"],EditPen:le["EditPen"],FolderOpened:le["FolderOpened"],Star:le["Star"],Delete:le["Delete"],Document:le["Document"],Files:le["Files"],Tickets:le["Tickets"],DataAnalysis:le["DataAnalysis"],PictureFilled:le["PictureFilled"],UploadFilled:le["UploadFilled"],Loading:le["Loading"],List:le["List"],Grid:le["Grid"],Crop:le["Crop"],Plus:le["Plus"],InfoFilled:le["InfoFilled"],Clock:le["Clock"],User:le["User"],Refresh:le["Refresh"],selectCategory:z,handleSearch:I,applyFilters:P,getFileIcon:je,formatDate:Oe,formatFileSize:he,getTagsList:ve,previewDocument:se,downloadDocument:de,shareDocument:ue,editDocument:be,handleUpdateDocument:pe,handleCloseEditDialog:me,handleCancelEditDialog:fe,deleteDocument:ge,handleFileChange:M,handleRemove:K,beforeUpload:q,handleUploadError:J,submitUpload:Y,handlePageChange:R,handleSizeChange:L,showDocumentChunks:H,editCategory:Q,handleDeleteCategory:G,saveCategoryForm:W,cancelCategoryForm:X,resetCategoryForm:Z,buildingVisible:U,handleBuildCompleted:ye,handleBuildFailed:we,resetUploadForm:ce,handleCloseUploadDialog:ne,openUploadDialog:ie,handleCancelUpload:re,formatColorValue:Ve,editDialogVisible:i,editForm:N}}};o("066b");const we=Oe()(ye,[["render",Z],["__scopeId","data-v-64d34e3b"]]);t["default"]=we},5388:function(e,t,o){"use strict";var l=o("c65b");e.exports=function(e,t,o){var a,c,r=o?e:e.iterator,n=e.next;while(!(a=l(n,r)).done)if(c=t(a.value),void 0!==c)return c}},5494:function(e,t,o){"use strict";var l=o("83ab"),a=o("e330"),c=o("edd0"),r=URLSearchParams.prototype,n=a(r.forEach);l&&!("size"in r)&&c(r,"size",{get:function(){var e=0;return n(this,(function(){e++})),e},configurable:!0,enumerable:!0})},"5acf":function(e,t,o){},"5bd1":function(e,t,o){"use strict";o("a853")},"68df":function(e,t,o){"use strict";var l=o("dc19"),a=o("8e16"),c=o("384f"),r=o("7f65");e.exports=function(e){var t=l(this),o=r(e);return!(a(t)>o.size)&&!1!==c(t,(function(e){if(!o.includes(e))return!1}),!0)}},"72c3":function(e,t,o){"use strict";var l=o("23e7"),a=o("e9bc"),c=o("dad2");l({target:"Set",proto:!0,real:!0,forced:!c("union")},{union:a})},"79a4":function(e,t,o){"use strict";var l=o("23e7"),a=o("d039"),c=o("953b"),r=o("dad2"),n=!r("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||a((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));l({target:"Set",proto:!0,real:!0,forced:n},{intersection:c})},"7f65":function(e,t,o){"use strict";var l=o("59ed"),a=o("825a"),c=o("c65b"),r=o("5926"),n=o("46c4"),i="Invalid size",s=RangeError,d=TypeError,u=Math.max,b=function(e,t){this.set=e,this.size=u(t,0),this.has=l(e.has),this.keys=l(e.keys)};b.prototype={getIterator:function(){return n(a(c(this.keys,this.set)))},includes:function(e){return c(this.has,this.set,e)}},e.exports=function(e){a(e);var t=+e.size;if(t!==t)throw new d(i);var o=r(t);if(o<0)throw new s(i);return new b(e,o)}},"83b9":function(e,t,o){"use strict";var l=o("cb27"),a=o("384f"),c=l.Set,r=l.add;e.exports=function(e){var t=new c;return a(e,(function(e){r(t,e)})),t}},"88a7":function(e,t,o){"use strict";var l=o("cb2d"),a=o("e330"),c=o("577e"),r=o("d6d6"),n=URLSearchParams,i=n.prototype,s=a(i.append),d=a(i["delete"]),u=a(i.forEach),b=a([].push),p=new n("a=1&a=2&b=3");p["delete"]("a",1),p["delete"]("b",void 0),p+""!=="a=2"&&l(i,"delete",(function(e){var t=arguments.length,o=t<2?void 0:arguments[1];if(t&&void 0===o)return d(this,e);var l=[];u(this,(function(e,t){b(l,{key:t,value:e})})),r(t,1);var a,n=c(e),i=c(o),p=0,m=0,f=!1,g=l.length;while(p<g)a=l[p++],f||a.key===n?(f=!0,d(this,a.key)):m++;while(m<g)a=l[m++],a.key===n&&a.value===i||s(this,a.key,a.value)}),{enumerable:!0,unsafe:!0})},"8b00":function(e,t,o){"use strict";var l=o("23e7"),a=o("68df"),c=o("dad2"),r=!c("isSubsetOf",(function(e){return e}));l({target:"Set",proto:!0,real:!0,forced:r},{isSubsetOf:a})},"8e16":function(e,t,o){"use strict";var l=o("7282"),a=o("cb27");e.exports=l(a.proto,"size","get")||function(e){return e.size}},"910d":function(e,t,o){"use strict";var l=o("23e7"),a=o("c65b"),c=o("59ed"),r=o("825a"),n=o("46c4"),i=o("c5cc"),s=o("9bdd"),d=o("c430"),u=o("2a62"),b=o("f99f"),p=!d&&b("filter",TypeError),m=i((function(){var e,t,o,l=this.iterator,c=this.predicate,n=this.next;while(1){if(e=r(a(n,l)),t=this.done=!!e.done,t)return;if(o=e.value,s(l,c,[o,this.counter++],!0))return o}}));l({target:"Iterator",proto:!0,real:!0,forced:d||p},{filter:function(e){r(this);try{c(e)}catch(t){u(this,"throw",t)}return p?a(p,this,e):new m(n(this),{predicate:e})}})},"953b":function(e,t,o){"use strict";var l=o("dc19"),a=o("cb27"),c=o("8e16"),r=o("7f65"),n=o("384f"),i=o("5388"),s=a.Set,d=a.add,u=a.has;e.exports=function(e){var t=l(this),o=r(e),a=new s;return c(t)>o.size?i(o.getIterator(),(function(e){u(t,e)&&d(a,e)})):n(t,(function(e){o.includes(e)&&d(a,e)})),a}},9961:function(e,t,o){"use strict";var l=o("dc19"),a=o("cb27"),c=o("83b9"),r=o("7f65"),n=o("5388"),i=a.add,s=a.has,d=a.remove;e.exports=function(e){var t=l(this),o=r(e).getIterator(),a=c(t);return n(o,(function(e){s(t,e)?d(a,e):i(a,e)})),a}},a4e7:function(e,t,o){"use strict";var l=o("23e7"),a=o("395e"),c=o("dad2"),r=!c("isSupersetOf",(function(e){return!e}));l({target:"Set",proto:!0,real:!0,forced:r},{isSupersetOf:a})},a5f7:function(e,t,o){"use strict";var l=o("dc19"),a=o("cb27"),c=o("83b9"),r=o("8e16"),n=o("7f65"),i=o("384f"),s=o("5388"),d=a.has,u=a.remove;e.exports=function(e){var t=l(this),o=n(e),a=c(t);return r(t)<=o.size?i(t,(function(e){o.includes(e)&&u(a,e)})):s(o.getIterator(),(function(e){d(t,e)&&u(a,e)})),a}},a853:function(e,t,o){},b4bc:function(e,t,o){"use strict";var l=o("dc19"),a=o("cb27").has,c=o("8e16"),r=o("7f65"),n=o("384f"),i=o("5388"),s=o("2a62");e.exports=function(e){var t=l(this),o=r(e);if(c(t)<=o.size)return!1!==n(t,(function(e){if(o.includes(e))return!1}),!0);var d=o.getIterator();return!1!==i(d,(function(e){if(a(t,e))return s(d,"normal",!1)}))}},c1a1:function(e,t,o){"use strict";var l=o("23e7"),a=o("b4bc"),c=o("dad2"),r=!c("isDisjointFrom",(function(e){return!e}));l({target:"Set",proto:!0,real:!0,forced:r},{isDisjointFrom:a})},cb27:function(e,t,o){"use strict";var l=o("e330"),a=Set.prototype;e.exports={Set:Set,add:l(a.add),has:l(a.has),remove:l(a["delete"]),proto:a}},d6d6:function(e,t,o){"use strict";var l=TypeError;e.exports=function(e,t){if(e<t)throw new l("Not enough arguments");return e}},dad2:function(e,t,o){"use strict";var l=o("d066"),a=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},c=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var o=l("Set");try{(new o)[e](a(0));try{return(new o)[e](a(-1)),!1}catch(n){if(!t)return!0;try{return(new o)[e](c(-1/0)),!1}catch(i){var r=new o;return r.add(1),r.add(2),t(r[e](c(1/0)))}}}catch(i){return!1}}},db6a:function(e,t,o){"use strict";o.d(t,"f",(function(){return c})),o.d(t,"a",(function(){return r})),o.d(t,"k",(function(){return n})),o.d(t,"c",(function(){return i})),o.d(t,"h",(function(){return s})),o.d(t,"m",(function(){return d})),o.d(t,"l",(function(){return u})),o.d(t,"d",(function(){return b})),o.d(t,"e",(function(){return p})),o.d(t,"g",(function(){return m})),o.d(t,"b",(function(){return f})),o.d(t,"i",(function(){return g})),o.d(t,"j",(function(){return j}));o("d9e2");var l=o("b775");const a="/api/knowledge";function c(){return console.log("调用getCategories API函数"),Object(l["a"])({url:a+"/categories/",method:"get"}).then(e=>{if(console.log("getCategories API响应成功:",e),!e)return console.warn("getCategories响应为空，返回空数组"),[];if(Array.isArray(e))return e;if(e.results&&Array.isArray(e.results))return e.results;if(e.data&&Array.isArray(e.data))return e.data;if("object"===typeof e)for(const t of["items","categories","list"])if(e[t]&&Array.isArray(e[t]))return e[t];return console.warn("无法从响应中提取分类数据，返回空数组:",e),[]}).catch(e=>(console.error("getCategories API请求失败:",e),e.response&&(console.error("错误状态码:",e.response.status),console.error("错误数据:",e.response.data)),[]))}function r(e){return Object(l["a"])({url:a+"/categories/",method:"post",data:e})}function n(e,t){return Object(l["a"])({url:`${a}/categories/${e}/`,method:"put",data:t})}function i(e){return Object(l["a"])({url:`${a}/categories/${e}/`,method:"delete"})}function s(e){return console.log("调用getDocuments API:",a+"/documents/","参数:",e),Object(l["a"])({url:a+"/documents/",method:"get",params:e}).then(e=>(console.log("getDocuments API响应成功:",e),e)).catch(e=>{throw console.error("getDocuments API请求失败:",e),e.response&&(console.error("错误状态码:",e.response.status),console.error("错误数据:",e.response.data)),e})}function d(e){if(console.log("开始上传文件...",e),e instanceof FormData){const t=e.get("file");if(!t)return console.warn("FormData中未找到文件!"),Promise.reject(new Error("未找到有效文件"));if(console.log("FormData中的文件信息:",{name:t.name,size:t.size,type:t.type,lastModified:t.lastModified}),!t.size||0===t.size)return Promise.reject(new Error("文件大小为0，无法上传"))}return Object(l["a"])({url:a+"/documents/",method:"post",data:e,timeout:12e4,headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{const t=Math.round(100*e.loaded/e.total);console.log(`上传进度: ${t}%`)}}).then(e=>(console.log("文件上传成功响应:",e),e)).catch(e=>{throw console.error("文件上传失败:",e),e.response?(console.error("上传错误状态码:",e.response.status),console.error("上传错误数据:",e.response.data),413===e.response.status?e.message="文件太大，超出服务器允许的上传限制":400===e.response.status?e.message="上传参数错误: "+JSON.stringify(e.response.data):401===e.response.status?e.message="未授权，请重新登录后再尝试上传":500===e.response.status&&(e.message="服务器处理上传时发生错误")):e.request&&(console.error("没有收到上传响应:",e.request),"ECONNABORTED"===e.code?e.message="上传超时，请检查网络或尝试上传较小的文件":e.message="网络错误，未收到服务器响应"),e})}function u(e,t){return Object(l["a"])({url:`${a}/documents/${e}/`,method:"put",data:t})}function b(e){console.log(">>> deleteDocument function entered for ID:",e);const t={url:`${a}/documents/${e}/`,method:"delete"};return console.log(">>> deleteDocument - Request config prepared:",t),Object(l["a"])(t).then(e=>(console.log("deleteDocument API响应成功:",e),e)).catch(e=>{throw console.error("deleteDocument API请求失败:",e),e.response&&(console.error("错误状态码:",e.response.status),console.error("错误数据:",e.response.data)),e})}function p(e){return Object(l["a"])({url:`${a}/documents/${e}/`,method:"get",responseType:"blob"})}function m(e){return Object(l["a"])({url:`${a}/documents/${e}/chunks/`,method:"get"})}function f(){return console.log("调用buildKnowledgeBase API"),Object(l["a"])({url:a+"/build/",method:"post"}).then(e=>(console.log("buildKnowledgeBase API响应成功:",e),e)).catch(e=>{throw console.error("buildKnowledgeBase API请求失败:",e),e.response&&(console.error("错误状态码:",e.response.status),console.error("错误数据:",e.response.data)),e})}function g(){return Object(l["a"])({url:a+"/build/status/",method:"get"})}function j(){return Object(l["a"])({url:a+"/list/",method:"get"})}},dc19:function(e,t,o){"use strict";var l=o("cb27").has;e.exports=function(e){return l(e),e}},e9bc:function(e,t,o){"use strict";var l=o("dc19"),a=o("cb27").add,c=o("83b9"),r=o("7f65"),n=o("5388");e.exports=function(e){var t=l(this),o=r(e).getIterator(),i=c(t);return n(o,(function(e){a(i,e)})),i}},f665:function(e,t,o){"use strict";var l=o("23e7"),a=o("c65b"),c=o("2266"),r=o("59ed"),n=o("825a"),i=o("46c4"),s=o("2a62"),d=o("f99f"),u=d("find",TypeError);l({target:"Iterator",proto:!0,real:!0,forced:u},{find:function(e){n(this);try{r(e)}catch(l){s(this,"throw",l)}if(u)return a(u,this,e);var t=i(this),o=0;return c(t,(function(t,l){if(e(t,o++))return l(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})}}]);
//# sourceMappingURL=chunk-67b19ef6.bff0928b.js.map