(function(e){function t(t){for(var o,a,c=t[0],i=t[1],l=t[2],d=0,u=[];d<c.length;d++)a=c[d],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&u.push(r[a][0]),r[a]=0;for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o]);m&&m(t);while(u.length)u.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],o=!0,a=1;a<n.length;a++){var c=n[a];0!==r[c]&&(o=!1)}o&&(s.splice(t--,1),e=i(i.s=n[0]))}return e}var o={},a={app:0},r={app:0},s=[];function c(e){return i.p+"js/"+({}[e]||e)+"."+{"chunk-02aa04cc":"6075db03","chunk-0ae3a023":"1643ffa3","chunk-2d0e1bd0":"21124529","chunk-09678759":"859284e4","chunk-13c76586":"046f712b","chunk-4b61b3a4":"3cc4a6d4","chunk-507683ba":"b35fdf1f","chunk-561f9db3":"56f07e68","chunk-5be386f4":"0532290c","chunk-7a60782c":"8a2bf971","chunk-78f6b38d":"5c2c172b","chunk-03e2242f":"ca34026a","chunk-9226625e":"65e7d9c7","chunk-8e2c8c7a":"06767273","chunk-2d9a0760":"10f482db","chunk-2f1268ca":"8b0bb7d4","chunk-3112d588":"bddb68ea","chunk-4af16728":"898e6535","chunk-0c5bcbf5":"48c0cd9c","chunk-e70702fc":"0a89d5c7","chunk-181ee86a":"3d573574","chunk-4d5970f7":"fca2bb8f","chunk-4d602d60":"18bcf523","chunk-50c3118c":"0e3012e4","chunk-54095702":"eec9bd89","chunk-5a365133":"e813d740","chunk-2d0e4842":"87234c90","chunk-5c63176c":"65f09c12","chunk-67b19ef6":"bff0928b","chunk-69624f04":"dce099b6","chunk-78895312":"a2e879e4","chunk-7bb95057":"f3dde87a","chunk-7ca9e3e2":"b6115a09","chunk-80328ba4":"56ce618f","chunk-9fbfaac6":"dbf82b78","chunk-d7c0b38c":"4d7ac8e4","chunk-63b4299e":"96fafc36","chunk-e72ec65a":"56032a2d","chunk-e78c34f0":"b9b43789","chunk-fdcda268":"084753e2","chunk-2d0b1f6a":"3b752c53","chunk-7fdcfda9":"9e70b9aa","chunk-14313059":"c900006b","chunk-2d216214":"7116429a"}[e]+".js"}function i(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.e=function(e){var t=[],n={"chunk-02aa04cc":1,"chunk-0ae3a023":1,"chunk-09678759":1,"chunk-13c76586":1,"chunk-507683ba":1,"chunk-561f9db3":1,"chunk-7a60782c":1,"chunk-78f6b38d":1,"chunk-03e2242f":1,"chunk-9226625e":1,"chunk-8e2c8c7a":1,"chunk-2d9a0760":1,"chunk-2f1268ca":1,"chunk-3112d588":1,"chunk-4af16728":1,"chunk-0c5bcbf5":1,"chunk-181ee86a":1,"chunk-4d5970f7":1,"chunk-4d602d60":1,"chunk-50c3118c":1,"chunk-54095702":1,"chunk-5a365133":1,"chunk-5c63176c":1,"chunk-67b19ef6":1,"chunk-69624f04":1,"chunk-78895312":1,"chunk-7bb95057":1,"chunk-7ca9e3e2":1,"chunk-80328ba4":1,"chunk-9fbfaac6":1,"chunk-d7c0b38c":1,"chunk-63b4299e":1,"chunk-e72ec65a":1,"chunk-e78c34f0":1,"chunk-fdcda268":1};a[e]?t.push(a[e]):0!==a[e]&&n[e]&&t.push(a[e]=new Promise((function(t,n){for(var o="css/"+({}[e]||e)+"."+{"chunk-02aa04cc":"f7a578b7","chunk-0ae3a023":"07b7eabb","chunk-2d0e1bd0":"31d6cfe0","chunk-09678759":"055cb790","chunk-13c76586":"9ec642b9","chunk-4b61b3a4":"31d6cfe0","chunk-507683ba":"459886f4","chunk-561f9db3":"9d955c7b","chunk-5be386f4":"31d6cfe0","chunk-7a60782c":"0799fb07","chunk-78f6b38d":"1b7f7760","chunk-03e2242f":"7d42041d","chunk-9226625e":"ecc42da0","chunk-8e2c8c7a":"e3fefcc1","chunk-2d9a0760":"98ca2755","chunk-2f1268ca":"65c884af","chunk-3112d588":"a636e159","chunk-4af16728":"02226c3f","chunk-0c5bcbf5":"ae5535b8","chunk-e70702fc":"31d6cfe0","chunk-181ee86a":"9ac94aa3","chunk-4d5970f7":"c9fe0fee","chunk-4d602d60":"8cd35d84","chunk-50c3118c":"e0516032","chunk-54095702":"2933e529","chunk-5a365133":"68903c68","chunk-2d0e4842":"31d6cfe0","chunk-5c63176c":"3d435b79","chunk-67b19ef6":"f7f2da77","chunk-69624f04":"34d2fc52","chunk-78895312":"8855bbd0","chunk-7bb95057":"af32b5ff","chunk-7ca9e3e2":"66770644","chunk-80328ba4":"f609cea6","chunk-9fbfaac6":"61f75073","chunk-d7c0b38c":"91c2bd99","chunk-63b4299e":"288c5864","chunk-e72ec65a":"93c9b1bd","chunk-e78c34f0":"24a14167","chunk-fdcda268":"66a2a8a8","chunk-2d0b1f6a":"31d6cfe0","chunk-7fdcfda9":"31d6cfe0","chunk-14313059":"31d6cfe0","chunk-2d216214":"31d6cfe0"}[e]+".css",r=i.p+o,s=document.getElementsByTagName("link"),c=0;c<s.length;c++){var l=s[c],d=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(d===o||d===r))return t()}var u=document.getElementsByTagName("style");for(c=0;c<u.length;c++){l=u[c],d=l.getAttribute("data-href");if(d===o||d===r)return t()}var m=document.createElement("link");m.rel="stylesheet",m.type="text/css",m.onload=t,m.onerror=function(t){var o=t&&t.target&&t.target.src||r,s=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");s.code="CSS_CHUNK_LOAD_FAILED",s.request=o,delete a[e],m.parentNode.removeChild(m),n(s)},m.href=r;var p=document.getElementsByTagName("head")[0];p.appendChild(m)})).then((function(){a[e]=0})));var o=r[e];if(0!==o)if(o)t.push(o[2]);else{var s=new Promise((function(t,n){o=r[e]=[t,n]}));t.push(o[2]=s);var l,d=document.createElement("script");d.charset="utf-8",d.timeout=120,i.nc&&d.setAttribute("nonce",i.nc),d.src=c(e);var u=new Error;l=function(t){d.onerror=d.onload=null,clearTimeout(m);var n=r[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;u.message="Loading chunk "+e+" failed.\n("+o+": "+a+")",u.name="ChunkLoadError",u.type=o,u.request=a,n[1](u)}r[e]=void 0}};var m=setTimeout((function(){l({type:"timeout",target:d})}),12e4);d.onerror=d.onload=l,document.head.appendChild(d)}return Promise.all(t)},i.m=e,i.c=o,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],d=l.push.bind(l);l.push=t,l=l.slice();for(var u=0;u<l.length;u++)t(l[u]);var m=d;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"017d":function(e,t,n){},"0eee":function(e,t,n){"use strict";n("406b")},"1a5d":function(e,t,n){var o={"./admin/CompanyManagement.vue":["ab09","chunk-80328ba4"],"./admin/ContractManagement.vue":["77ce","chunk-3112d588"],"./admin/ContractTemplateEdit.vue":["b456","chunk-4b61b3a4","chunk-e70702fc","chunk-181ee86a"],"./admin/ContractTemplateManagement.vue":["d724","chunk-e70702fc","chunk-63b4299e"],"./admin/Dashboard.vue":["0a6e","chunk-2d0e1bd0","chunk-5be386f4","chunk-9226625e"],"./admin/DepartmentManagement.vue":["e544","chunk-7ca9e3e2"],"./admin/KnowledgeManagement.vue":["3e4b","chunk-7bb95057"],"./admin/Layout.vue":["d577","chunk-69624f04"],"./admin/Login.vue":["676a","chunk-e78c34f0"],"./admin/SmartDocManagement.vue":["1edc","chunk-54095702"],"./admin/UserManagement.vue":["58ff","chunk-2d9a0760"],"./auth/Login.vue":["5326","chunk-4af16728"],"./auth/Register.vue":["935e","chunk-4d602d60"],"./calendar/Index.vue":["7e6b","chunk-78895312"],"./chat/Index.vue":["13ab","chunk-02aa04cc"],"./company/Index.vue":["248f","chunk-d7c0b38c"],"./contact/Index.vue":["1d0c","chunk-e72ec65a"],"./contract/Detail.vue":["3496","chunk-4b61b3a4","chunk-507683ba","chunk-0c5bcbf5"],"./contract/Index.vue":["e1e7","chunk-5c63176c"],"./dashboard/Index.vue":["cd59","chunk-2d0e1bd0","chunk-09678759"],"./dashboard/components/NlpScheduler.vue":["23bf","chunk-4d5970f7"],"./knowledge/Index.vue":["3c26","chunk-67b19ef6"],"./layout/Index.vue":["1974","chunk-50c3118c"],"./profile/Index.vue":["385a","chunk-9fbfaac6"],"./project/Index.vue":["7b3c","chunk-2f1268ca"],"./project/ProjectDetail.vue":["f6d1","chunk-2d0e1bd0","chunk-5be386f4","chunk-7a60782c","chunk-78f6b38d","chunk-03e2242f"],"./project/components/DashboardView.vue":["ab435","chunk-2d0e1bd0","chunk-8e2c8c7a"],"./project/components/DocumentsView.vue":["d1c5","chunk-2d0e1bd0","chunk-13c76586"],"./project/components/ReportsView.vue":["6966","chunk-5be386f4","chunk-78f6b38d","chunk-2d0e4842"],"./project/components/RequirementsView.vue":["b274","chunk-5a365133"],"./project/components/TasksView.vue":["ccb0","chunk-7a60782c"],"./setting/Index.vue":["1662","chunk-fdcda268"],"./smartdoc/Detail.vue":["0fcf","chunk-2d0e1bd0","chunk-4b61b3a4","chunk-507683ba","chunk-561f9db3"],"./smartdoc/Index.vue":["762e","chunk-0ae3a023"]};function a(e){if(!n.o(o,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=o[e],a=t[0];return Promise.all(t.slice(1).map(n.e)).then((function(){return n(a)}))}a.keys=function(){return Object.keys(o)},a.id="1a5d",e.exports=a},"406b":function(e,t,n){},4360:function(e,t,n){"use strict";n("e9f5"),n("7d54");var o=n("5502"),a=(n("14d9"),n("cee4"));const r=a["a"].create({baseURL:"http://localhost:8000",timeout:1e4,headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer "+t),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e.data,e=>(console.error("API错误:",e.response||e),e.response&&401===e.response.status&&(localStorage.removeItem("token"),localStorage.removeItem("user")),Promise.reject(e)));var s={login(e){return r.post("/api/auth/login/",e)},adminLogin(e){return r.post("/api/auth/admin/login/",e)},register(e){return console.log("发送注册请求:",e),r.post("/api/auth/register/",e,{headers:{"Content-Type":"application/json",Accept:"application/json"}})},logout(){return r.post("/api/auth/logout/")},requestPasswordReset(e){return r.post("/api/auth/password/request-reset/",e)},resetPassword(e){return r.post("/api/auth/password/reset/",e)}},c=n("c24f");const i={token:localStorage.getItem("token")||"",user:JSON.parse(localStorage.getItem("user"))||null,loading:!1,error:null},l={AUTH_REQUEST(e,t=!0){e.loading=t,t&&(e.error=null)},AUTH_SUCCESS(e,{token:t,user:n}){e.loading=!1,e.token=t,e.user=n,e.error=null},AUTH_ERROR(e,t){e.loading=!1,e.error=t},LOGOUT(e){e.token="",e.user=null},CLEAR_ERROR(e){e.error=null},UPDATE_USER_PROFILE(e,t){e.user={...e.user,...t},localStorage.setItem("user",JSON.stringify(e.user))},SET_USER_PROFILE(e,t){e.user={...e.user,...t},localStorage.setItem("user",JSON.stringify(e.user))}},d={async login({commit:e,dispatch:t},n){e("AUTH_REQUEST");try{const o=await s.login(n);if(o.success){const{token:n,userId:a,username:r}=o.data;localStorage.setItem("token",n);const s={id:a,username:r};return localStorage.setItem("user",JSON.stringify(s)),e("AUTH_SUCCESS",{token:n,user:s}),t("getUserProfile"),Promise.resolve(o)}return e("AUTH_ERROR",o.message||"登录失败"),Promise.reject(o)}catch(o){let t="登录失败，请稍后重试";return o.response?o.response.data?o.response.data.message?t=o.response.data.message:o.response.data.detail?t=o.response.data.detail:"string"===typeof o.response.data&&(t=o.response.data):o.response.statusText&&(t=`服务器错误 (${o.response.status}): ${o.response.statusText}`):o.message&&(t=o.message),e("AUTH_ERROR",t),Promise.reject({...o,message:t})}},async adminLogin({commit:e,dispatch:t},n){e("AUTH_REQUEST");try{const o=await s.adminLogin(n);if(o.success){const{token:n,userId:a,username:r}=o.data;localStorage.setItem("token",n);const s={id:a,username:r,isAdmin:!0};return localStorage.setItem("user",JSON.stringify(s)),e("AUTH_SUCCESS",{token:n,user:s}),t("getUserProfile"),Promise.resolve(o)}return e("AUTH_ERROR",o.message||"登录失败"),Promise.reject(o)}catch(o){let t="登录失败，请稍后重试";return o.response&&o.response.data&&o.response.data.message?t=o.response.data.message:o.message&&(t=o.message),e("AUTH_ERROR",t),Promise.reject({...o,message:t})}},async register({commit:e},t){e("AUTH_REQUEST");try{const n=await s.register(t);return n.success?Promise.resolve(n):(e("AUTH_ERROR",n.message),Promise.reject(n))}catch(a){var n,o;const t=(null===(n=a.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message)||"注册失败，请稍后重试";return e("AUTH_ERROR",t),Promise.reject(a)}},async logout({commit:e}){try{await s.logout()}catch(n){console.error("登出请求失败，但会继续清除本地会话",n)}localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.setItem("theme","light"),document.documentElement.setAttribute("data-theme","light");const t=document.querySelector('meta[name="theme-color"]');return t&&t.setAttribute("content","#ffffff"),e("LOGOUT"),Promise.resolve()},async requestPasswordReset({commit:e},{email:t}){e("AUTH_REQUEST");try{const n=await s.requestPasswordReset({email:t});return n.success?(e("AUTH_SUCCESS",{token:"",user:null}),Promise.resolve(n)):(e("AUTH_ERROR",n.message),Promise.reject(n))}catch(a){var n,o;const t=(null===(n=a.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message)||"请求重置密码失败，请稍后重试";return e("AUTH_ERROR",t),Promise.reject(a)}},async resetPassword({commit:e},t){e("AUTH_REQUEST");try{const n=await s.resetPassword(t);return n.success?(e("AUTH_SUCCESS",{token:"",user:null}),Promise.resolve(n)):(e("AUTH_ERROR",n.message),Promise.reject(n))}catch(a){var n,o;const t=(null===(n=a.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message)||"重置密码失败，请稍后重试";return e("AUTH_ERROR",t),Promise.reject(a)}},async getUserProfile({commit:e}){e("AUTH_REQUEST");try{console.log("开始获取用户个人信息");const t=await c["a"].getUserProfile();console.log("获取用户个人信息响应:",t);let n=null;if(t&&t.success&&t.data)console.log("检测到标准响应格式"),n=t.data;else if(t&&200===t.code&&t.data)console.log("检测到code=200响应格式"),n=t.data;else{if(!t||"object"!==typeof t||!t.id)return console.error("无法解析用户信息响应:",t),e("AUTH_ERROR","获取用户信息失败：响应格式错误"),Promise.reject({message:"响应格式错误"});console.log("检测到直接返回数据对象格式"),n=t}return n.company||console.warn("用户数据中未包含公司ID:",n),e("SET_USER_PROFILE",n),console.log("用户信息已更新到Vuex和localStorage"),Promise.resolve({success:!0,data:n})}catch(t){console.error("获取用户信息失败, 详细错误:",t);let n="获取用户信息失败，请稍后重试";return t.response?(console.error("错误状态码:",t.response.status),console.error("错误响应数据:",t.response.data),403===t.response.status?n="您没有权限获取用户信息，请重新登录":t.response.data&&"object"===typeof t.response.data&&(t.response.data.message?n=t.response.data.message:t.response.data.detail&&(n=t.response.data.detail))):t.message&&(n=t.message),e("AUTH_ERROR",n),Promise.reject({...t,message:n})}},async updateUserProfile({commit:e},t){e("AUTH_REQUEST");try{console.log("发送到API的数据:",t);const n=await c["a"].updateUserProfile(t);if(n.success)return e("UPDATE_USER_PROFILE",n.data),Promise.resolve(n);{const t=n.message||"更新用户信息失败";return e("AUTH_ERROR",t),Promise.reject(t)}}catch(n){console.error("用户信息更新错误:",n);let t="更新用户信息失败，请稍后重试";if("string"===typeof n)t=n;else if(n.message)t=n.message;else if(n.response&&n.response.data)if("string"===typeof n.response.data)t=n.response.data;else if(n.response.data.message)t=n.response.data.message;else if(n.response.data.detail)t=n.response.data.detail;else if(n.response.data.error)t=n.response.data.error;else{const e=[];for(const t in n.response.data)Array.isArray(n.response.data[t])&&e.push(`${t}: ${n.response.data[t].join(", ")}`);e.length>0&&(t=e.join("; "))}return e("AUTH_ERROR",t),Promise.reject(t)}},async updateUserAvatar({commit:e},t){e("AUTH_REQUEST");try{const n=await c["a"].updateUserAvatar(t);return n.success?(e("UPDATE_USER_PROFILE",{avatar:n.data.avatar}),Promise.resolve(n)):(e("AUTH_ERROR",n.message||"更新头像失败"),Promise.reject(n))}catch(a){var n,o;const t=(null===(n=a.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message)||"更新头像失败，请稍后重试";return e("AUTH_ERROR",t),Promise.reject(a)}},async changePassword({commit:e},t){e("AUTH_REQUEST");try{const n=await c["a"].changePassword(t);if(n.success)return e("CLEAR_ERROR"),Promise.resolve(n);{const t=n.fieldErrors&&n.fieldErrors.old_password&&Array.isArray(n.fieldErrors.old_password)&&n.fieldErrors.old_password.includes("Incorrect password.");return t?e("CLEAR_ERROR"):e("AUTH_ERROR",n.message||"修改密码失败"),n}}catch(a){if(a.isValidationResult)return e("CLEAR_ERROR"),a;const t=a.fieldErrors&&a.fieldErrors.old_password&&Array.isArray(a.fieldErrors.old_password)&&a.fieldErrors.old_password.includes("Incorrect password.");if(t)e("CLEAR_ERROR");else{var n,o;const t=(null===(n=a.response)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.message)||"修改密码失败，请稍后重试";e("AUTH_ERROR",t)}return Promise.reject(a)}finally{e("AUTH_REQUEST",!1)}},clearError({commit:e}){e("CLEAR_ERROR")}},u={isAuthenticated:e=>!!e.token,currentUser:e=>e.user,loading:e=>e.loading,error:e=>e.error};var m={namespaced:!0,state:i,mutations:l,actions:d,getters:u};t["a"]=Object(o["a"])({state:{app:{sidebar:{opened:!0},device:"desktop"},unread:{messages:5,notifications:8,tasks:3,approvals:2},settingsVisible:!1,settingsOpenedOnPath:null},mutations:{TOGGLE_SIDEBAR(e){e.app.sidebar.opened=!e.app.sidebar.opened},SET_DEVICE(e,t){e.app.device=t},SET_UNREAD(e,t){e.unread={...e.unread,...t}},SET_SETTINGS_VISIBLE(e,t){e.settingsVisible=t,e.settingsOpenedOnPath=t?window.location.pathname:null}},actions:{toggleSidebar({commit:e}){e("TOGGLE_SIDEBAR")},setDevice({commit:e},t){e("SET_DEVICE",t)},openSettings({commit:e}){document.querySelectorAll(".el-overlay").forEach(e=>{e&&e.parentNode&&e.parentNode.removeChild(e)}),document.body.style.overflow="",document.body.classList.remove("el-popup-parent--hidden"),setTimeout(()=>{e("SET_SETTINGS_VISIBLE",!0)},100)}},getters:{sidebar:e=>e.app.sidebar,device:e=>e.app.device,unread:e=>e.dashboard.unread,user:e=>e.user.user,settingsVisible:e=>e.settingsVisible,settingsOpenedOnPath:e=>e.settingsOpenedOnPath},modules:{user:m}})},"56d7":function(e,t,n){"use strict";n.r(t);n("e9f5"),n("7d54");var o=n("7a23"),a=n("c3a1");n("7437");const r={id:"app"};function s(e,t,n,a,s,c){const i=Object(o["resolveComponent"])("router-view"),l=Object(o["resolveComponent"])("settings-dialog");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",r,[Object(o["createVNode"])(i),Object(o["createVNode"])(l,{visible:a.settingsVisible,"onUpdate:visible":t[0]||(t[0]=e=>a.settingsVisible=e)},null,8,["visible"])])}var c=n("5502");const i={key:0,class:"settings-dialog-wrapper"},l={key:0,class:"settings-dialog-container"},d={class:"settings-dialog"},u={class:"settings-content"};function m(e,t,n,a,r,s){const c=Object(o["resolveComponent"])("theme-settings");return a.renderDialog?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",i,[(Object(o["openBlock"])(),Object(o["createBlock"])(o["Teleport"],{to:"body"},[Object(o["createVNode"])(o["Transition"],{name:"settings-fade"},{default:Object(o["withCtx"])(()=>[n.visible?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",l,[Object(o["createElementVNode"])("div",{class:"settings-dialog-overlay",onClick:t[0]||(t[0]=(...e)=>a.handleOverlayClick&&a.handleOverlayClick(...e))}),Object(o["createElementVNode"])("div",d,[Object(o["createElementVNode"])("div",u,[Object(o["createVNode"])(c,{onClose:a.handleClose},null,8,["onClose"])])])])):Object(o["createCommentVNode"])("",!0)]),_:1})]))])):Object(o["createCommentVNode"])("",!0)}var p=n("6605");const h={class:"settings-panel"},f={class:"settings-header"},b={class:"settings-actions"},g={class:"settings-content"},v={class:"settings-main"},j={key:0,class:"settings-section"},O={class:"setting-item"},w={class:"setting-item"},k={class:"setting-item"},y={class:"font-size-slider"},E={key:1,class:"settings-section"},S={class:"label-with-icon"},_={class:"info-icon-wrapper"},N={class:"label-with-icon"},x={class:"info-icon-wrapper"},C={class:"label-with-icon"},V={class:"info-icon-wrapper"},A={class:"label-with-icon"},I={class:"info-icon-wrapper"},T={class:"label-with-icon"},R={class:"info-icon-wrapper"};function P(e,t,n,a,r,s){const c=Object(o["resolveComponent"])("Refresh"),i=Object(o["resolveComponent"])("el-icon"),l=Object(o["resolveComponent"])("el-button"),d=Object(o["resolveComponent"])("Check"),u=Object(o["resolveComponent"])("Setting"),m=Object(o["resolveComponent"])("el-menu-item"),p=Object(o["resolveComponent"])("Brush"),P=Object(o["resolveComponent"])("el-menu"),U=Object(o["resolveComponent"])("Sunny"),L=Object(o["resolveComponent"])("el-radio-button"),B=Object(o["resolveComponent"])("Moon"),D=Object(o["resolveComponent"])("el-radio-group"),z=Object(o["resolveComponent"])("el-slider"),M=Object(o["resolveComponent"])("info-filled"),H=Object(o["resolveComponent"])("el-tooltip"),q=Object(o["resolveComponent"])("el-input"),$=Object(o["resolveComponent"])("el-form-item"),J=Object(o["resolveComponent"])("el-col"),F=Object(o["resolveComponent"])("el-row"),Q=Object(o["resolveComponent"])("el-form");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",h,[Object(o["createElementVNode"])("div",f,[t[12]||(t[12]=Object(o["createElementVNode"])("h2",null,"系统设置",-1)),Object(o["createElementVNode"])("div",b,[Object(o["createVNode"])(l,{onClick:s.restoreDefaults,type:"link"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(c)]),_:1}),t[10]||(t[10]=Object(o["createTextVNode"])(" 恢复默认 "))]),_:1},8,["onClick"]),Object(o["createVNode"])(l,{onClick:s.saveSettings,type:"primary"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(d)]),_:1}),t[11]||(t[11]=Object(o["createTextVNode"])(" 保存设置 "))]),_:1},8,["onClick"])])]),Object(o["createElementVNode"])("div",g,[Object(o["createVNode"])(P,{class:"settings-sidebar","default-active":r.activeSection},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(m,{index:"ai",onClick:t[0]||(t[0]=e=>r.activeSection="ai")},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(u)]),_:1}),t[13]||(t[13]=Object(o["createElementVNode"])("span",null,"个性化AI设置",-1))]),_:1}),Object(o["createVNode"])(m,{index:"ui",onClick:t[1]||(t[1]=e=>r.activeSection="ui")},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(p)]),_:1}),t[14]||(t[14]=Object(o["createElementVNode"])("span",null,"界面偏好",-1))]),_:1})]),_:1},8,["default-active"]),Object(o["createElementVNode"])("div",v,["ui"===r.activeSection?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",j,[t[23]||(t[23]=Object(o["createElementVNode"])("h3",null,"主题设置",-1)),Object(o["createElementVNode"])("div",O,[t[17]||(t[17]=Object(o["createElementVNode"])("span",{class:"setting-label"},"主题模式",-1)),Object(o["createVNode"])(D,{modelValue:r.settings.theme,"onUpdate:modelValue":t[2]||(t[2]=e=>r.settings.theme=e),size:"large"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(L,{label:"light"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(U)]),_:1}),t[15]||(t[15]=Object(o["createTextVNode"])(" 浅色 "))]),_:1}),Object(o["createVNode"])(L,{label:"dark"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(i,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(B)]),_:1}),t[16]||(t[16]=Object(o["createTextVNode"])(" 深色 "))]),_:1})]),_:1},8,["modelValue"])]),t[24]||(t[24]=Object(o["createElementVNode"])("h3",null,"布局设置",-1)),Object(o["createElementVNode"])("div",w,[t[21]||(t[21]=Object(o["createElementVNode"])("span",{class:"setting-label"},"内容密度",-1)),Object(o["createVNode"])(D,{modelValue:r.settings.density,"onUpdate:modelValue":t[3]||(t[3]=e=>r.settings.density=e),size:"large"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(L,{label:"compact"},{default:Object(o["withCtx"])(()=>t[18]||(t[18]=[Object(o["createTextVNode"])("紧凑")])),_:1}),Object(o["createVNode"])(L,{label:"standard"},{default:Object(o["withCtx"])(()=>t[19]||(t[19]=[Object(o["createTextVNode"])("标准")])),_:1}),Object(o["createVNode"])(L,{label:"comfortable"},{default:Object(o["withCtx"])(()=>t[20]||(t[20]=[Object(o["createTextVNode"])("宽松")])),_:1})]),_:1},8,["modelValue"])]),Object(o["createElementVNode"])("div",k,[t[22]||(t[22]=Object(o["createElementVNode"])("span",{class:"setting-label"},"字体大小",-1)),Object(o["createElementVNode"])("div",y,[Object(o["createVNode"])(z,{modelValue:r.settings.fontSize,"onUpdate:modelValue":t[4]||(t[4]=e=>r.settings.fontSize=e),min:12,max:20,step:1,"show-input":"","format-tooltip":e=>e+"px"},null,8,["modelValue","format-tooltip"])])])])):Object(o["createCommentVNode"])("",!0),"ai"===r.activeSection?(Object(o["openBlock"])(),Object(o["createElementBlock"])("div",E,[t[34]||(t[34]=Object(o["createElementVNode"])("h3",null,"个性化AI设置",-1)),Object(o["createVNode"])(Q,{"label-position":"top",model:r.aiSettings},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(F,{gutter:20},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(J,{span:12},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])($,null,{label:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("span",S,[t[25]||(t[25]=Object(o["createTextVNode"])(" AI如何称呼您 ")),Object(o["createVNode"])(H,{effect:"light",content:"您希望AI助手如何称呼您，例如您的姓名或昵称。",placement:"top"},{trigger:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("span",_,[Object(o["createVNode"])(i,{class:"info-icon"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(M)]),_:1})])]),_:1})])]),default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(q,{modelValue:r.aiSettings.nickname,"onUpdate:modelValue":t[5]||(t[5]=e=>r.aiSettings.nickname=e),placeholder:"例如：李经理",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),Object(o["createVNode"])(J,{span:12},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])($,null,{label:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("span",N,[t[26]||(t[26]=Object(o["createTextVNode"])(" 您的职位 ")),Object(o["createVNode"])(H,{effect:"light",content:"您的职位信息有助于AI在生成内容时更贴合您的专业领域。",placement:"top"},{trigger:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("span",x,[Object(o["createVNode"])(i,{class:"info-icon"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(M)]),_:1})])]),_:1})])]),default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(q,{modelValue:r.aiSettings.job,"onUpdate:modelValue":t[6]||(t[6]=e=>r.aiSettings.job=e),placeholder:"例如：软件工程师",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),Object(o["createVNode"])($,null,{label:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("span",C,[t[27]||(t[27]=Object(o["createTextVNode"])(" AI沟通风格 ")),Object(o["createVNode"])(H,{effect:"light",content:"选择您偏好的AI沟通风格，或在下方文本框中自定义。",placement:"top"},{trigger:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("span",V,[Object(o["createVNode"])(i,{class:"info-icon"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(M)]),_:1})])]),_:1})])]),default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(D,{modelValue:r.aiSettings.tone,"onUpdate:modelValue":t[7]||(t[7]=e=>r.aiSettings.tone=e)},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(L,{label:"professional"},{default:Object(o["withCtx"])(()=>t[28]||(t[28]=[Object(o["createTextVNode"])("专业严谨")])),_:1}),Object(o["createVNode"])(L,{label:"friendly"},{default:Object(o["withCtx"])(()=>t[29]||(t[29]=[Object(o["createTextVNode"])("亲切友好")])),_:1}),Object(o["createVNode"])(L,{label:"concise"},{default:Object(o["withCtx"])(()=>t[30]||(t[30]=[Object(o["createTextVNode"])("简洁直接")])),_:1}),Object(o["createVNode"])(L,{label:"custom"},{default:Object(o["withCtx"])(()=>t[31]||(t[31]=[Object(o["createTextVNode"])("自定义")])),_:1})]),_:1},8,["modelValue"])]),_:1}),"custom"===r.aiSettings.tone?(Object(o["openBlock"])(),Object(o["createBlock"])($,{key:0},{label:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("span",A,[t[32]||(t[32]=Object(o["createTextVNode"])(" 自定义AI风格 ")),Object(o["createVNode"])(H,{effect:"light",content:'在这里输入您希望AI具备的其它沟通风格或特征，例如"幽默"、"详细"等，多个词语请用逗号隔开。',placement:"top"},{trigger:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("span",I,[Object(o["createVNode"])(i,{class:"info-icon"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(M)]),_:1})])]),_:1})])]),default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(q,{type:"textarea",modelValue:r.aiSettings.traitsText,"onUpdate:modelValue":t[8]||(t[8]=e=>r.aiSettings.traitsText=e),placeholder:"例如：富有创造力, 善于总结",rows:3,class:"textarea-input"},null,8,["modelValue"])]),_:1})):Object(o["createCommentVNode"])("",!0),Object(o["createVNode"])($,null,{label:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("span",T,[t[33]||(t[33]=Object(o["createTextVNode"])(" 其它自定义信息 ")),Object(o["createVNode"])(H,{effect:"light",content:"您可以在此提供更多关于您的工作内容、兴趣偏好或特定要求的信息，以便AI为您提供更个性化的服务。",placement:"top"},{trigger:Object(o["withCtx"])(()=>[Object(o["createElementVNode"])("span",R,[Object(o["createVNode"])(i,{class:"info-icon"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(M)]),_:1})])]),_:1})])]),default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(q,{type:"textarea",modelValue:r.aiSettings.otherInfo,"onUpdate:modelValue":t[9]||(t[9]=e=>r.aiSettings.otherInfo=e),placeholder:"例如：我主要负责XX项目的管理，请在总结时突出项目进度和风险点。",rows:4,class:"textarea-input"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):Object(o["createCommentVNode"])("",!0)])])])}n("d9e2");var U=n("f6f2"),L=n("b775"),B=n("3ef4"),D={name:"ThemeSettings",components:{Refresh:U["Refresh"],Check:U["Check"],Setting:U["Setting"],Brush:U["Brush"],Sunny:U["Sunny"],Moon:U["Moon"],InfoFilled:U["InfoFilled"]},data(){return{activeSection:"ui",settings:{theme:localStorage.getItem("theme")||"light",density:localStorage.getItem("density")||"standard",fontSize:parseInt(localStorage.getItem("fontSize"))||14},aiSettings:{nickname:"",job:"",tone:"professional",traitsText:"",otherInfo:""},defaultSettings:{theme:"light",density:"standard",fontSize:14},defaultAiSettings:{nickname:"",job:"",tone:"professional",traitsText:"",otherInfo:""}}},created(){this.loadAiSettings()},watch:{"settings.theme":{handler(e){this.applyTheme(e)},immediate:!0},"settings.fontSize":{handler(e){document.documentElement.style.setProperty("--font-size-base",e+"px"),localStorage.setItem("fontSize",e)},immediate:!0},"settings.density":{handler(e){document.body.setAttribute("data-density",e),localStorage.setItem("density",e)},immediate:!0}},methods:{async loadAiSettings(){try{const e=await Object(L["a"])({url:"/api/settings/ai-settings",method:"get"});e&&e.success&&(this.aiSettings={nickname:e.data.nickname||"",job:e.data.job||"",tone:e.data.tone||"professional",traitsText:e.data.traits_text||"",otherInfo:e.data.other_info||""})}catch(e){console.error("获取AI设置失败:",e)}},async saveAiSettings(){try{const e={nickname:this.aiSettings.nickname,job:this.aiSettings.job,tone:this.aiSettings.tone,traits_text:this.aiSettings.traitsText,other_info:this.aiSettings.otherInfo};await Object(L["a"])({url:"/api/settings/ai-settings",method:"post",data:e})}catch(e){throw console.error("保存AI设置失败:",e),new Error("保存AI设置失败")}},applyTheme(e){document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e);const t=document.querySelector('meta[name="theme-color"]');t&&t.setAttribute("content","dark"===e?"#1a1a1a":"#ffffff")},async saveSettings(){try{localStorage.setItem("theme",this.settings.theme),localStorage.setItem("density",this.settings.density),localStorage.setItem("fontSize",this.settings.fontSize),"ai"===this.activeSection&&await this.saveAiSettings(),this.applyTheme(this.settings.theme),document.body.setAttribute("data-density",this.settings.density),document.documentElement.style.setProperty("--font-size-base",this.settings.fontSize+"px"),Object(B["a"])({message:"设置已保存",type:"success"}),this.$emit("close")}catch(e){Object(B["a"])({message:e.message||"保存失败",type:"error"})}},restoreDefaults(){"ui"===this.activeSection?this.settings=JSON.parse(JSON.stringify(this.defaultSettings)):"ai"===this.activeSection&&(this.aiSettings=JSON.parse(JSON.stringify(this.defaultAiSettings)))}}},z=(n("773f"),n("6b0d")),M=n.n(z);const H=M()(D,[["render",P],["__scopeId","data-v-93e36392"]]);var q=H,$={name:"SettingsDialog",components:{ThemeSettings:q},props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(e,{emit:t}){const n=Object(c["b"])(),a=Object(p["d"])(),r=Object(o["ref"])(!0);Object(o["watch"])(()=>a.currentRoute.value.path,(t,n)=>{e.visible&&n!==t&&l()}),Object(o["watch"])(()=>e.visible,async e=>{e?(document.body.classList.add("settings-dialog-open"),await Object(o["nextTick"])(),d()):document.body.classList.remove("settings-dialog-open")});const s=t=>{e.visible&&"Escape"===t.key&&l()},i=()=>{l()},l=()=>{t("update:visible",!1),setTimeout(()=>{n.commit("SET_SETTINGS_VISIBLE",!1),u()},100)},d=()=>{const e=document.querySelector(".settings-dialog");e&&e.focus()},u=()=>{document.querySelectorAll(".el-overlay, .el-popup-parent--hidden, .v-modal").forEach(e=>{e&&e.parentNode&&e.parentNode.removeChild(e)}),document.body.style.overflow="",document.body.classList.remove("el-popup-parent--hidden"),document.body.classList.remove("settings-dialog-open")};return Object(o["onMounted"])(()=>{window.addEventListener("keydown",s),u()}),Object(o["onUnmounted"])(()=>{window.removeEventListener("keydown",s),u()}),{renderDialog:r,handleClose:l,handleOverlayClick:i}}};n("6d32");const J=M()($,[["render",m]]);var F=J,Q={name:"App",components:{SettingsDialog:F},setup(){const e=Object(c["b"])(),t=Object(o["computed"])({get:()=>e.state.settingsVisible||!1,set:t=>e.commit("SET_SETTINGS_VISIBLE",t)});return Object(o["provide"])("settingsVisible",t),{settingsVisible:t}}};n("0eee");const G=M()(Q,[["render",s]]);var K=G;n("a732");const W=e=>()=>new Promise(t=>{try{const o=n("1a5d")(`./${e}.vue`);t(o)}catch(o){console.error("路由加载失败: "+e,o),t({template:`<div class="error-page">\n            <div style="text-align: center; padding: 100px 20px;">\n              <h2 style="color: #f56c6c;">页面加载失败</h2>\n              <p>抱歉，无法加载请求的页面: ${e}</p>\n              <button @click="$router.push('/')" \n                style="padding: 10px 20px; background: #409eff; color: white; border: none; border-radius: 4px; cursor: pointer;">\n                返回首页\n              </button>\n            </div>\n          </div>`})}}),X=W("auth/Login"),Y=W("auth/Register"),Z=W("admin/Login"),ee=W("admin/Layout"),te=W("admin/Dashboard"),ne=W("admin/UserManagement"),oe=W("admin/CompanyManagement"),ae=W("admin/DepartmentManagement"),re=W("admin/SmartDocManagement"),se=W("admin/ContractManagement"),ce=W("admin/ContractTemplateManagement"),ie=W("admin/ContractTemplateEdit"),le=W("admin/KnowledgeManagement"),de=W("layout/Index"),ue=W("dashboard/Index"),me=W("calendar/Index"),pe=W("knowledge/Index"),he=W("chat/Index"),fe=W("contract/Index"),be=W("contract/Detail"),ge=W("contact/Index"),ve=W("project/Index"),je=W("project/ProjectDetail"),Oe=W("company/Index"),we=W("profile/Index"),ke=W("smartdoc/Index"),ye=W("smartdoc/Detail"),Ee=[{path:"/admin/login",name:"AdminLogin",component:Z,meta:{title:"管理员登录",requiresAuth:!1}},{path:"/admin",component:ee,redirect:"/admin/dashboard",meta:{requiresAuth:!0,requiresAdmin:!0},children:[{path:"dashboard",name:"AdminDashboard",component:te,meta:{title:"仪表盘"}},{path:"users",name:"UserManagement",component:ne,meta:{title:"用户管理"}},{path:"companies",name:"CompanyManagement",component:oe,meta:{title:"公司管理"}},{path:"departments",name:"DepartmentManagement",component:ae,meta:{title:"部门管理"}},{path:"smart-docs",name:"SmartDocManagement",component:re,meta:{title:"智能文档管理"}},{path:"contracts",name:"AdminContractManagement",component:se,meta:{title:"合同管理"}},{path:"contract-templates",name:"AdminContractTemplateManagement",component:ce,meta:{title:"合同模板管理"}},{path:"contract-templates/new",name:"AdminContractTemplateNew",component:ie,meta:{title:"新建合同模板"}},{path:"contract-templates/edit/:id",name:"AdminContractTemplateEdit",component:ie,meta:{title:"编辑合同模板"},props:!0},{path:"knowledge",name:"KnowledgeManagement",component:le,meta:{title:"知识库管理"}}]},{path:"/login",name:"Login",component:X,meta:{title:"登录",requiresAuth:!1}},{path:"/register",name:"Register",component:Y,meta:{title:"注册",requiresAuth:!1}},{path:"/",component:de,redirect:"/dashboard",meta:{requiresAuth:!0},children:[{path:"dashboard",name:"Dashboard",component:ue,meta:{title:"工作中心",icon:"bi-grid-1x2"}},{path:"calendar",name:"Calendar",component:me,meta:{title:"日程安排",icon:"bi-calendar-week"}},{path:"knowledge",name:"Knowledge",component:pe,meta:{title:"企业知识库",icon:"bi-book"}},{path:"chat",name:"Chat",component:he,meta:{title:"即时沟通",icon:"bi-chat-dots"}},{path:"smartdoc",name:"SmartDoc",component:ke,meta:{title:"文档处理",icon:"bi-file-earmark-text"}},{path:"smartdoc/:id",name:"SmartDocDetail",component:ye,meta:{title:"文档详情",icon:"bi-file-earmark-text"},hidden:!0,props:!0,beforeEnter:(e,t,n)=>{const o=e.params.id;!o||isNaN(o)?n({name:"SmartDoc"}):n()}},{path:"contract",name:"Contract",component:fe,meta:{title:"智能合同",icon:"bi-file-earmark-ruled"}},{path:"contract/:id",name:"ContractDetail",component:be,meta:{title:"合同详情",icon:"bi-file-earmark-ruled"},hidden:!0,beforeEnter:(e,t,n)=>{const o=e.params.id;!o||"contract"===o||isNaN(o)?n({name:"Contract"}):n()}},{path:"contact",name:"Contact",component:ge,meta:{title:"企业通讯录",icon:"bi-person-lines-fill"}},{path:"project",name:"Project",component:ve,meta:{title:"项目协作",icon:"bi-kanban"}},{path:"project/:id",name:"ProjectDetail",component:je,meta:{title:"项目详情",icon:"bi-kanban"},hidden:!0,props:!0,beforeEnter:(e,t,n)=>{const o=e.params.id;!o||isNaN(o)?n({name:"Project"}):n()}},{path:"company",name:"Company",component:Oe,meta:{title:"企业信息",icon:"bi-building"}},{path:"profile",name:"Profile",component:we,meta:{title:"个人中心",icon:"bi-person"}}]},{path:"/:pathMatch(.*)*",redirect:"/login"}],Se=Object(p["a"])({history:Object(p["b"])(),routes:Ee});Se.beforeEach((e,t,n)=>{document.title=e.meta.title?e.meta.title+" - 智能办公系统":"智能办公系统";const o=null!==localStorage.getItem("token"),a=JSON.parse(localStorage.getItem("user"));if(!e.matched.some(e=>e.meta.requiresAdmin)||o&&null!==a&&void 0!==a&&a.isAdmin)if(!e.matched.some(e=>e.meta.requiresAuth)||o){if(t.path.startsWith("/smartdoc/")){const t=e.path.split("/");if(t.length>2&&"smartdoc"===t[1]&&isNaN(t[2])){const e="/"+t.slice(2).join("/");return void n({path:e,replace:!0})}}n()}else n({name:"Login"});else n({name:"AdminLogin"})});var _e=Se,Ne=n("4360"),xe=(n("b20f"),n("94f1")),Ce=n.n(xe);n("ab8b"),n("cd74");const Ve={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"};function Ae(e,t,n,a,r,s){return Object(o["openBlock"])(),Object(o["createElementBlock"])("svg",Ve,t[0]||(t[0]=[Object(o["createElementVNode"])("path",{fill:"currentColor",d:"M768 384h-512a32 32 0 1 1 0-64h512a32 32 0 0 1 0 64zm-192 192h-128a32 32 0 0 1 0-64h128a32 32 0 0 1 0 64zm0 256h-128a32 32 0 1 1 0-64h128a32 32 0 0 1 0 64zm192-256h-128a32 32 0 0 1 0-64h128a32 32 0 0 1 0 64zm0 256h-128a32 32 0 1 1 0-64h128a32 32 0 0 1 0 64zM384 576h-128a32 32 0 0 1 0-64h128a32 32 0 0 1 0 64zm0 256h-128a32 32 0 1 1 0-64h128a32 32 0 0 1 0 64z"},null,-1)]))}var Ie={name:"AlignCenter"};const Te=M()(Ie,[["render",Ae]]);var Re=Te;const Pe={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"};function Ue(e,t,n,a,r,s){return Object(o["openBlock"])(),Object(o["createElementBlock"])("svg",Pe,t[0]||(t[0]=[Object(o["createElementVNode"])("path",{fill:"currentColor",d:"M256 320h512a32 32 0 1 1 0 64H256a32 32 0 0 1 0-64zm0 192h256a32 32 0 1 1 0 64H256a32 32 0 0 1 0-64zm0 192h256a32 32 0 1 1 0 64H256a32 32 0 0 1 0-64z"},null,-1)]))}var Le={name:"AlignLeft"};const Be=M()(Le,[["render",Ue]]);var De=Be;const ze={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"};function Me(e,t,n,a,r,s){return Object(o["openBlock"])(),Object(o["createElementBlock"])("svg",ze,t[0]||(t[0]=[Object(o["createElementVNode"])("path",{fill:"currentColor",d:"M768 320H256a32 32 0 0 0 0 64h512a32 32 0 0 0 0-64zm0 192H512a32 32 0 0 0 0 64h256a32 32 0 0 0 0-64zm0 192H512a32 32 0 0 0 0 64h256a32 32 0 0 0 0-64z"},null,-1)]))}var He={name:"AlignRight"};const qe=M()(He,[["render",Me]]);var $e=qe;const Je={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"};function Fe(e,t,n,a,r,s){return Object(o["openBlock"])(),Object(o["createElementBlock"])("svg",Je,t[0]||(t[0]=[Object(o["createElementVNode"])("path",{fill:"currentColor",d:"M697.8 481.4c33.6-35 54.2-82.3 54.2-134.3v-10.2C752 229.3 663.9 142 555.3 142H259.4c-15.1 0-27.4 12.3-27.4 27.4v679.1c0 16.3 13.2 29.5 29.5 29.5h318.7c117 0 211.8-94.2 211.8-210.5v-11c0-73-37.4-137.3-94.2-175.1zM328 238h224.7c57.1 0 103.3 44.4 103.3 99.3v9.5c0 54.8-46.3 99.3-103.3 99.3H328V238zm366.6 429.4c0 62.9-51.7 113.9-115.5 113.9H328V542.7h251.1c63.8 0 115.5 51 115.5 113.9v10.8z"},null,-1)]))}var Qe={name:"Bold"};const Ge=M()(Qe,[["render",Fe]]);var Ke=Ge;const We={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"};function Xe(e,t,n,a,r,s){return Object(o["openBlock"])(),Object(o["createElementBlock"])("svg",We,t[0]||(t[0]=[Object(o["createElementVNode"])("path",{fill:"currentColor",d:"M832 256h-192v-64h192a64 64 0 0 1 64 64v448a64 64 0 0 1-64 64H192a64 64 0 0 1-64-64V256a64 64 0 0 1 64-64h192v64H192v448h640V256zm-22.4 236.8L531.2 683.2a32 32 0 0 1-44.8 0L376 572.8a8 8 0 0 1 0-11.2l36.4-36.4a8 8 0 0 1 11.2 0l89.6 89.6 244.8-244.8a8 8 0 0 1 11.2 0l36.4 36.4a8 8 0 0 1 0 11.2z"},null,-1)]))}var Ye={name:"CheckboxButton"};const Ze=M()(Ye,[["render",Xe]]);var et=Ze;const tt={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"};function nt(e,t,n,a,r,s){return Object(o["openBlock"])(),Object(o["createElementBlock"])("svg",tt,t[0]||(t[0]=[Object(o["createElementVNode"])("path",{fill:"currentColor",d:"M800 192H224a64 64 0 0 0-64 64v512a64 64 0 0 0 64 64h576a64 64 0 0 0 64-64V256a64 64 0 0 0-64-64zm0 64v172.7L724.7 512h-425.4L224 428.7V256h576zM371.8 704l-99.3-99.3 45.3-45.3 99.3 99.2 99.2-99.2 45.3 45.3-99.3 99.3 99.3 99.2-45.3 45.3-99.2-99.3-99.3 99.3-45.3-45.3 99.3-99.2z"},null,-1)]))}var ot={name:"Inbox"};const at=M()(ot,[["render",nt]]);var rt=at;const st={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"};function ct(e,t,n,a,r,s){return Object(o["openBlock"])(),Object(o["createElementBlock"])("svg",st,t[0]||(t[0]=[Object(o["createElementVNode"])("path",{fill:"currentColor",d:"M640 192h-288a32 32 0 0 0 0 64h96l-128 512h-96a32 32 0 0 0 0 64h288a32 32 0 0 0 0-64h-96l128-512h96a32 32 0 0 0 0-64z"},null,-1)]))}var it={name:"Italic"};const lt=M()(it,[["render",ct]]);var dt=lt;const ut={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"};function mt(e,t,n,a,r,s){return Object(o["openBlock"])(),Object(o["createElementBlock"])("svg",ut,t[0]||(t[0]=[Object(o["createElementVNode"])("path",{fill:"currentColor",d:"M832 320v-64a64 64 0 0 0-64-64H256a64 64 0 0 0-64 64v64h640zm-640 64v448a64 64 0 0 0 64 64h512a64 64 0 0 0 64-64V384H192zm448 256a128 128 0 1 1-256 0 128 128 0 0 1 256 0zm-384-96a32 32 0 0 1 32-32h96a32 32 0 0 1 0 64h-96a32 32 0 0 1-32-32z"},null,-1)]))}var pt={name:"Save"};const ht=M()(pt,[["render",mt]]);var ft=ht;const bt={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"};function gt(e,t,n,a,r,s){return Object(o["openBlock"])(),Object(o["createElementBlock"])("svg",bt,t[0]||(t[0]=[Object(o["createElementVNode"])("path",{fill:"currentColor",d:"M232 768h560v64H232v-64zm280-384c0-68.3 55.7-124 124-124 48.6 0 92.9 28.2 113.5 72.2 5.6 11.9 20.2 16.2 31.5 9.1 8.8-5.5 12.2-16.3 9.7-25.9C766 339 702.8 288 636 288c-97 0-176 79-176 176v160c0 97 79 176 176 176s176-79 176-176v-92c0-11-9-20-20-20s-20 9-20 20v92c0 75.1-60.9 136-136 136s-136-60.9-136-136V384z"},null,-1)]))}var vt={name:"Underline"};const jt=M()(vt,[["render",gt]]);var Ot=jt;function wt(e){e.component("AlignCenter",Re),e.component("AlignLeft",De),e.component("AlignRight",$e),e.component("Bold",Ke),e.component("CheckboxButton",et),e.component("Inbox",rt),e.component("Italic",dt),e.component("Save",ft),e.component("Underline",Ot)}function kt(){const e={"quill.min.js":"/static/lib/quill/quill.min.js","quill.snow.css":"/static/lib/quill/quill.snow.css","vue-quill.snow.css":"/static/lib/quill/quill.snow.css","@vueup/vue-quill":"/static/lib/quill/quill.min.js"},t={js:"script",css:"link"};function n(){const t=document.head;Object.values(e).forEach(e=>{const n=e.split(".").pop();if(!document.querySelector(`link[rel="preload"][href="${e}"]`)){const o=document.createElement("link");o.rel="preload",o.href=e,o.as="css"===n?"style":"script",t.appendChild(o)}})}function o(){if(!window._patchedAddEventListener){window._patchedAddEventListener=!0;try{const e=Node.prototype.addEventListener,t=Node.prototype.removeEventListener;Node.prototype.addEventListener=function(t,n){if("DOMNodeInserted"===t||"DOMNodeRemoved"===t){console.warn(`检测到已弃用的${t}事件，替换为MutationObserver`);const e=this;e._mutationListeners||(e._mutationListeners=new Map);const o=Date.now()+Math.random().toString(36).slice(2),a=new MutationObserver(o=>{for(let a of o)"childList"===a.type&&("DOMNodeInserted"===t&&a.addedNodes.length>0&&a.addedNodes.forEach(o=>{const a={type:t,bubbles:!0,relatedNode:e,target:o,preventDefault:()=>{},stopPropagation:()=>{}};try{n.call(e,a)}catch(r){console.error("执行监听器时出错:",r)}}),"DOMNodeRemoved"===t&&a.removedNodes.length>0&&a.removedNodes.forEach(o=>{const a={type:t,bubbles:!0,relatedNode:e,target:o,preventDefault:()=>{},stopPropagation:()=>{}};try{n.call(e,a)}catch(r){console.error("执行监听器时出错:",r)}}))});return e._mutationListeners.set(o,{type:t,originalListener:n,observer:a}),("function"===typeof n||n&&"object"===typeof n)&&(n._mutationListenerId=o),void a.observe(e,{childList:!0,subtree:!0})}return e.apply(this,arguments)},Node.prototype.removeEventListener=function(e,n){if(("DOMNodeInserted"===e||"DOMNodeRemoved"===e)&&this._mutationListeners&&("function"===typeof n||n&&"object"===typeof n)){const t=n._mutationListenerId;if(t&&this._mutationListeners.has(t)){const e=this._mutationListeners.get(t);return e.observer.disconnect(),void this._mutationListeners.delete(t)}for(const[o,a]of this._mutationListeners.entries())if(a.type===e&&a.originalListener===n)return a.observer.disconnect(),void this._mutationListeners.delete(o)}return t.apply(this,arguments)},console.log("已应用DOMNodeInserted/DOMNodeRemoved事件拦截补丁")}catch(e){console.error("应用事件拦截补丁失败:",e)}}}function a(){if(!document.getElementById("quill-inline-styles")){const e=document.createElement("style");e.id="quill-inline-styles",e.textContent='\n        .ql-container {\n          box-sizing: border-box;\n          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;\n          font-size: 14px;\n          height: 100%;\n          margin: 0px;\n          position: relative;\n          border: 1px solid #ccc;\n          border-radius: 4px;\n        }\n        .ql-editor {\n          box-sizing: border-box;\n          cursor: text;\n          line-height: 1.42;\n          height: 100%;\n          outline: none;\n          overflow-y: auto;\n          padding: 12px 15px;\n          tab-size: 4;\n          text-align: left;\n          white-space: pre-wrap;\n          word-wrap: break-word;\n          min-height: 200px;\n        }\n        .suggestion-highlight {\n          background-color: rgba(255, 217, 102, 0.3);\n          border-bottom: 1px dashed #ffb300;\n          cursor: pointer;\n          position: relative;\n        }\n        .suggestion-tooltip {\n          position: absolute;\n          z-index: 9999;\n          background: white;\n          border: 1px solid #ccc;\n          border-radius: 4px;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n          padding: 10px;\n          max-width: 400px;\n        }\n      ',document.head.appendChild(e),console.log("已添加内联Quill样式作为备用")}}"undefined"!==typeof window&&document.head&&n(),"undefined"!==typeof window&&o(),window.addEventListener("error",(function(n){if(!n.target||!n.target.src&&!n.target.href)return!0;const o=n.target,r=o.src||o.href;let s=!1;for(const[c,i]of Object.entries(e))if(r.includes(c)){console.warn(`检测到CDN资源 ${c} 加载失败，正在切换到本地备份...`);const e=i.split(".").pop(),n=t[e]||"script";o.parentNode&&o.parentNode.removeChild(o);const r=document.createElement(n);"script"===n?(r.src=i,r.async=!0,r.onerror=()=>{console.error(`本地备份资源 ${i} 也加载失败，可能需要检查文件是否存在`)}):"link"===n&&(r.href=i,r.rel="stylesheet",r.onerror=()=>{console.error(`本地备份样式 ${i} 加载失败，尝试使用内联样式`),a()}),document.body.appendChild(r),console.log("已切换到本地备份: "+i),s=!0;break}return s?(n.preventDefault(),n.stopPropagation(),!0):void 0}),!0);const r=window.fetch;function s(){if(window.Quill)return;console.warn("未检测到Quill对象，尝试加载本地版本");const e=window.location.origin+"/static/lib/quill/";if(!document.getElementById("quill-snow-css")){const t=document.createElement("link");t.rel="stylesheet",t.id="quill-snow-css",t.href=e+"quill.snow.css",document.head.appendChild(t)}if(!document.getElementById("quill-script")){const t=document.createElement("script");t.id="quill-script",t.src=e+"quill.min.js",t.async=!1,document.body.appendChild(t)}}window.fetch=async function(...t){const n=t[0].toString();try{const e=await r(...t);if(!e.ok)throw new Error("请求失败: "+e.status);return e}catch(o){for(const[t,s]of Object.entries(e))if(n.includes(t)){console.warn(`Fetch请求 ${n} 失败，尝试使用本地备份...`);try{const e=await r(s);if(e.ok)return e}catch(a){console.error("本地备份请求也失败: "+a)}}throw o}},window.addEventListener("DOMContentLoaded",(function(){setTimeout(s,1e3)}))}function yt(){kt(),window.addEventListener("error",(function(e){if(e.target&&("IMG"===e.target.tagName||"SCRIPT"===e.target.tagName))return e.stopPropagation(),e.preventDefault(),console.warn("资源加载错误被捕获并处理:",e.target.src||e.target.href),!0}),!0);const e=window.onload;window.onload=function(t){try{"function"===typeof e&&e(t)}catch(o){console.warn("window.onload错误被捕获:",o.message),(o.message.includes("is not a function")||o.message.includes("not a function"))&&console.warn("检测到常见的事件处理错误，已被安全处理")}const n=document.querySelectorAll("img");n.forEach(e=>{const t=e.onload;e.onload=function(e){try{"function"===typeof t&&t.call(this,e)}catch(o){console.warn("图片onload错误被捕获:",o.message)}};const n=e.onerror;e.onerror=function(e){try{"function"===typeof n&&n.call(this,e),this.src="/static/img/placeholder.png",this.onerror=null}catch(o){console.warn("图片onerror错误被捕获:",o.message)}}})};const t=document.createElement;document.createElement=function(e){const n=t.call(document,e);if("img"===e.toLowerCase()){const e=n.onload;n.onload=function(t){try{"function"===typeof e&&e.call(this,t)}catch(n){console.warn("动态创建的图片onload错误被捕获:",n.message)}}}return n},window.addEventListener("unhandledrejection",(function(e){if(console.warn("未处理的Promise异常被捕获:",e.reason),e.reason&&"string"===typeof e.reason.message&&e.reason.message.includes("message channel closed"))return console.warn("检测到消息通道关闭错误，这通常是由后端服务断开连接引起的"),void e.preventDefault();e.reason&&(e.reason.toString().includes("modules[moduleId].call")||e.reason.toString().includes("Cannot read property")||e.reason.toString().includes("is not an object"))&&console.warn("检测到Vue Router模块加载错误，尝试刷新页面解决..."),e.preventDefault()})),window.onerror=function(e,t,n,o,a){return console.warn("全局错误被捕获:",{message:e,source:t,lineno:n,colno:o,error:a?a.stack:null}),!(!e||!e.includes("stopPropagation is not a function")&&!e.includes("v-stop-propagation"))&&(console.warn("检测到事件传播错误，这可能是自定义指令中的问题"),!0)}}var Et=n("1344");window.lottie=Ce.a,yt();const St=()=>{const e=localStorage.getItem("theme"),t=localStorage.getItem("density"),n=localStorage.getItem("fontSize");if(e)document.documentElement.setAttribute("data-theme",e);else{const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.setAttribute("data-theme",e?"dark":"light"),localStorage.setItem("theme",e?"dark":"light")}t?document.body.setAttribute("data-density",t):(document.body.setAttribute("data-density","standard"),localStorage.setItem("density","standard")),n?document.documentElement.style.setProperty("--font-size-base",n+"px"):(document.documentElement.style.setProperty("--font-size-base","14px"),localStorage.setItem("fontSize","14")),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{if(!localStorage.getItem("theme")){const t=e.matches?"dark":"light";document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t)}})};St();const _t=Object(o["createApp"])(K),Nt=Object(Et["a"])();_t.config.globalProperties.emitter=Nt,_t.directive("stop-propagation",{mounted(e){const t=["click","mousedown","mouseup","touchstart","touchend"];e._eventHandlers={},t.forEach(t=>{e._eventHandlers[t]=function(e){const t=e.target.closest("a")||e.target.closest(".el-menu-item");!t&&e&&"function"===typeof e.stopPropagation&&e.stopPropagation()},e.addEventListener(t,e._eventHandlers[t])})},beforeUnmount(e){e._eventHandlers&&(Object.keys(e._eventHandlers).forEach(t=>{e.removeEventListener(t,e._eventHandlers[t])}),delete e._eventHandlers)}});for(const[xt,Ct]of Object.entries(U))_t.component(xt,Ct);wt(_t),_t.use(Ne["a"]),_t.use(_e),_t.use(a["a"],{size:"default",zIndex:3e3,dropdown:{teleported:!0,placement:"bottom-end",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundariesElement:"viewport"}}]}}}),_t.mount("#app")},"6d32":function(e,t,n){"use strict";n("017d")},"773f":function(e,t,n){"use strict";n("c61c")},b20f:function(e,t,n){},b775:function(e,t,n){"use strict";n("e9f5"),n("ab43"),n("a732");var o=n("cee4"),a=n("3ef4");const r=o["a"].create({baseURL:"http://localhost:8000",timeout:18e4,headers:{"Content-Type":"application/json"}}),s=e=>{const t=e.url||"",n=e.method||"",o=e.data;let a=18e4;if(t.includes("ai_generate_document"))a=18e4;else if(t.includes("ai_polish")||t.includes("check_contract"))if("post"!==n&&"put"!==n||!o)a=12e4;else{const e="string"===typeof o?o.length:o.content?o.content.length:0;e>5e4?a=18e4:e>2e4?a=12e4:e>5e3&&(a=9e4),console.log(`智能超时: 内容大小 ${e} 字符, 设置超时 ${a/1e3} 秒`)}else t.includes("contract")&&"post"===n&&o&&o.use_ai_agent&&(console.log("检测到AI合同生成请求，设置较长超时时间"),a=18e4);return a};r.interceptors.request.use(e=>{if(console.log("发送请求至:",e.url,"方法:",e.method),e.timeout=s(e),e.data instanceof FormData){const t=Array.from(e.data.entries()).some(e=>e[1]instanceof File);t&&(console.log("检测到文件上传请求，增加超时时间"),e.timeout=Math.max(e.timeout,18e4))}e.signal&&console.log("请求可取消 (AbortSignal已设置)"),e.data&&e.data.signal&&(e.signal=e.data.signal,delete e.data.signal,console.log("从数据中提取并设置AbortSignal"));const t=!1!==e.auth,n=localStorage.getItem("token");if(console.log("Token from localStorage:",n?"有效令牌":"无令牌"),n&&t?(e.headers.Authorization="Bearer "+n,console.log("已添加认证token (格式: Bearer ...) 对请求:",e.url),(e.url.includes("export")||e.url.includes("export-direct"))&&console.log("导出请求的认证头:",e.headers.Authorization?"已设置":"未设置")):t?(console.warn("未找到认证token，Authorization头部未设置:",e.url),(e.url.includes("export")||e.url.includes("export-direct"))&&console.warn("导出文档需要认证，但未找到认证令牌！")):console.log("此请求不需要认证:",e.url,"方法:",e.method),e.data instanceof FormData){if(delete e.headers["Content-Type"],e.url.includes("/api/chat/messages/")){console.log("检测到聊天消息上传请求，FormData内容:");for(let[t,n]of e.data.entries())n instanceof File?console.log(`- ${t}: [文件] ${n.name}, 类型: ${n.type}, 大小: ${n.size} 字节`):console.log(`- ${t}: ${n}`)}}else"post"!==e.method&&"put"!==e.method||e.headers["Content-Type"]||(e.headers["Content-Type"]="application/json");return e},e=>(console.error("请求错误:",e),Promise.reject(e))),r.interceptors.response.use(e=>{if(console.log("收到响应:",e.config.url,e.status),204===e.status)return{status:204};if(e.config.url.includes("/api/smartdoc/documents/")&&e.config.url.endsWith("/")&&!e.config.url.includes("list")){const t=e.headers["content-length"]||"未知";console.log("文档详情响应大小:",t,"字节"),t&&parseInt(t)>1e5&&console.log("检测到大型文档响应:",{url:e.config.url,size:t+" 字节",status:e.status,headers:e.headers,time:(new Date).toISOString()})}(e.config.url.includes("check_contract")||e.config.url.includes("ai_polish")||e.config.url.includes("contracts")&&"post"===e.config.method)&&console.log("重要API响应:",{url:e.config.url,status:e.status,headers:e.headers,dataType:typeof e.data,dataHasKeys:"object"===typeof e.data?Object.keys(e.data).join(","):"not-an-object",responseTime:(new Date).toISOString()});const t=e.data;if(t){const n=typeof t,o=Array.isArray(t);console.log("响应数据类型:",o?"Array":n,o?`(长度:${t.length})`:"object"===n?`(键:${Object.keys(t).join(",")})`:""),e.config.url.includes("/api/smartdoc/documents/")&&e.config.url.endsWith("/")&&"object"===n&&void 0===t.content&&t.id&&console.warn("警告: 文档详情响应缺少content字段")}if("blob"===e.config.responseType)return console.log("检测到blob响应类型，文件大小:",e.data.size,"字节"),e.data.size<100&&console.warn("警告：blob响应数据过小，可能无效:",e.data.size,"字节"),e;const n=t&&!Array.isArray(t)&&t.results&&Array.isArray(t.results);if(n)return console.log("检测到DRF分页响应格式:","count=",t.count,"next=",Boolean(t.next),"previous=",Boolean(t.previous),"结果数量=",t.results.length),{count:t.count,total:t.count,next:t.next,previous:t.previous,results:t.results,data:t.results};if(e.data){if(Array.isArray(e.data))return console.log("处理数组响应数据"),{data:e.data,count:e.data.length,total:e.data.length};if("object"===typeof e.data)return console.log("处理对象响应数据"),"data"in e.data?e.data:{data:e.data}}return{data:{}}},e=>{if(o["a"].isCancel(e))return console.log("请求被取消:",e.message),Promise.reject({isCancelled:!0,message:"请求被取消，可能是超时或用户中断"});if(e.response&&400===e.response.status){const t=e.response.data,n=e.config.url.includes("/api/auth/users/change_password/"),o=t&&t.old_password&&Array.isArray(t.old_password)&&t.old_password.includes("Incorrect password.");if(n&&o)return console.log("密码验证：当前密码不正确 - 这是预期的验证结果"),Promise.reject({isValidationResult:!0,status:400,data:e.response.data,message:"",fieldErrors:{old_password:["Incorrect password."]}})}if(console.error("响应错误:",e),"ECONNABORTED"===e.code||e.message&&e.message.includes("timeout"))return console.error("请求超时:",e.config.url),a["a"].error("请求超时，服务器响应时间过长，请稍后重试"),Promise.reject({isTimeout:!0,message:"请求超时，服务器响应时间过长"});if(e.response){const n=e.response.status;if(e.config&&"blob"===e.config.responseType&&(console.error("Blob响应错误:",n,e.config.url),e.response.data instanceof Blob)){const t=e.response.data;if("application/json"===t.type){const e=new FileReader;e.onload=()=>{try{const t=JSON.parse(e.result);console.error("Blob错误详情:",t),a["a"].error(t.error||t.message||"导出失败，请稍后重试")}catch(t){console.error("解析Blob错误失败:",t),a["a"].error("导出失败，请稍后重试")}},e.readAsText(t)}else a["a"].error("导出失败，请稍后重试");return Promise.reject({isBlobError:!0,status:n,message:"导出文件失败"})}if(401===n){a["a"].error("登录已过期，请重新登录"),localStorage.removeItem("token"),localStorage.removeItem("user");const e=window.location.pathname;"/login"!==e&&"/"!==e&&setTimeout(()=>{window.location.href="/login"},1500)}else if(403===n){a["a"].error("登录已过期，请重新登录"),localStorage.removeItem("token"),localStorage.removeItem("user");const e=window.location.pathname;"/login"!==e&&"/"!==e&&setTimeout(()=>{window.location.href="/login"},1500)}else if(400===n){const t=e.response.data;console.error("400错误详细数据:",t),console.error("400错误完整内容:",JSON.stringify(t,null,2));let n="请求参数错误";t&&t.message?n=t.message:t&&t.error?n=t.error:"string"===typeof t?n=t:t&&"object"===typeof t&&(n=Object.entries(t).map(([e,t])=>`${e}: ${Array.isArray(t)?t.join(", "):t}`).join("; ")),a["a"].error(n)}else if(n>=500)a["a"].error("服务器错误，请稍后再试");else try{a["a"].error(e.response.data&&e.response.data.message?e.response.data.message:"请求失败")}catch(t){a["a"].error("请求失败")}}else e.request?a["a"].error("网络连接失败，请检查网络设置"):a["a"].error("请求配置错误");return Promise.reject(e)}),t["a"]=r},c24f:function(e,t,n){"use strict";n("d9e2"),n("14d9"),n("e9f5"),n("7d54"),n("ab43");var o=n("b775");const a={async getUserProfile(){console.log("调用getUserProfile API");try{const e=await o["a"].get("/api/auth/users/me/");return console.log("getUserProfile API响应:",e),e&&e.success&&e.data?e:e&&200===e.code&&e.data?{success:!0,data:e.data}:e&&"object"===typeof e&&e.id?{success:!0,data:e}:(console.error("getUserProfile API响应格式未识别:",e),{success:!1,message:"用户信息响应格式错误",error:e})}catch(e){return console.error("getUserProfile API错误:",e),{success:!1,message:e.message||"获取用户信息失败",error:e}}},async updateUserProfile(e){let t=e.id;if(!t){const e=localStorage.getItem("user");if(e){const n=JSON.parse(e);t=n.id}}if(!t)return{success:!1,message:"用户ID不存在，无法更新个人信息"};const n={username:e.username||"",name:e.name||"",email:e.email||"",phone:e.phone||"",position:e.position||"",department:e.department||"",office:e.office||"",employee_id:e.employee_id||"",manager:e.manager||"",bio:e.bio||""};if(!n.username){const e=localStorage.getItem("user");if(e){const t=JSON.parse(e);t.username&&(n.username=t.username)}}console.log(`正在发送PUT请求到: /api/auth/users/${t}/`),console.log("发送的数据:",JSON.stringify(n));try{const e=await o["a"].put(`/api/auth/users/${t}/`,n);return{success:!0,message:"个人信息更新成功",data:e.data||e}}catch(a){console.error("API请求失败:",a);let e="更新用户信息失败，请稍后重试",t=null;if(a.response){if(console.error("状态码:",a.response.status),console.error("响应数据:",a.response.data),a.response.data)if("string"===typeof a.response.data)e=a.response.data;else if(a.response.data.message)e=a.response.data.message;else if(a.response.data.detail)e=a.response.data.detail;else if(a.response.data.error)e=a.response.data.error;else{t={};let n=!1;if(Object.entries(a.response.data).forEach(([o,a])=>{Array.isArray(a)&&a.length>0&&(t[o]=a,n=!0,"username"===o&&a.includes("用户名已存在")?e="该用户名已被使用，请选择其他用户名":"email"===o&&a.includes("邮箱已存在")&&(e="该邮箱已被注册，请使用其他邮箱"))}),n){const n=Object.entries(t).map(([e,t])=>`${e}: ${t.join(", ")}`).join("; ");n&&(e=n)}}}else a.message&&(e=a.message);return{success:!1,message:e,fields:t,error:a}}},async updateUserAvatar(e){const t=localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")).id:null;if(!t)throw new Error("用户未登录");const n=await o["a"].post(`/api/auth/users/${t}/avatar/`,e,{headers:{"Content-Type":"multipart/form-data"}});return n},async changePassword(e){const{old_password:t,new_password:n,confirm_password:a}=e,r={old_password:t,new_password:n,confirm_password:a};console.log("发送密码修改请求");try{const e=await o["a"].put("/api/auth/users/change_password/",r);return console.log("密码修改成功"),{success:!0,message:"密码修改成功",data:e}}catch(s){if(s.isValidationResult)return console.log("密码验证：当前密码不正确"),{success:!1,message:"",fieldErrors:s.fieldErrors||s.data};if(console.error("密码修改失败"),s.response){console.error("错误状态码:",s.response.status);const e=s.response.data;if(e&&e.message&&(e.message.toLowerCase().includes("success")||e.message.toLowerCase().includes("successfully")))return console.log("实际上密码修改成功了，返回成功消息"),{success:!0,message:"密码修改成功",data:e};const t=e&&e.old_password&&Array.isArray(e.old_password)&&e.old_password.includes("Incorrect password.");let n="密码修改失败，请检查您输入的当前密码是否正确";if("string"===typeof e)n=e;else if(e)if(e.message)n=e.message;else if(e.detail)n=e.detail;else if(e.non_field_errors&&Array.isArray(e.non_field_errors))n=e.non_field_errors.join(", ");else if(e.old_password&&Array.isArray(e.old_password))n=e.old_password.includes("Incorrect password.")?"当前密码不正确，请重新输入":"当前密码: "+e.old_password.join(", ");else if(e.new_password&&Array.isArray(e.new_password)){const t=e.new_password.map(e=>e.includes("too short")?"新密码太短":e.includes("too common")?"新密码太简单":e.includes("entirely numeric")?"新密码不能全为数字":e.includes("similar to")?"新密码与用户信息过于相似":e);n="新密码问题: "+t.join(", ")}else{const t=[];try{Object.entries(e).forEach(([e,n])=>{let o=e;"old_password"===e&&(o="当前密码"),"new_password"===e&&(o="新密码"),"confirm_password"===e&&(o="确认密码"),Array.isArray(n)&&n.length>0?t.push(`${o}: ${n.join(", ")}`):"string"===typeof n?t.push(`${o}: ${n}`):null!==n&&"object"===typeof n&&t.push(`${o}: ${JSON.stringify(n)}`)})}catch(c){console.error("解析错误字段时出错:",c)}t.length>0&&(n=t.join("; "))}return{success:!1,message:t?"":n,fieldErrors:e}}return{success:!1,message:s.message||"密码修改失败，请重试"}}},async getCompanyUsers(e){try{if(!e){const t=localStorage.getItem("user");if(t){const n=JSON.parse(t);e=n.company}if(!e)return{success:!1,message:"缺少公司ID，无法获取用户列表"}}const t=await o["a"].get(`/api/auth/companies/${e}/users/`);let n=[];return Array.isArray(t.data)?n=t.data:t.data&&Array.isArray(t.data.data)?n=t.data.data:t.data&&t.data.results&&Array.isArray(t.data.results)&&(n=t.data.results),{success:!0,data:n}}catch(t){return console.error("获取公司用户列表失败:",t),{success:!1,message:t.message||"获取用户列表失败",error:t}}}};t["a"]=a},c61c:function(e,t,n){}});
//# sourceMappingURL=app.ca20c92b.js.map