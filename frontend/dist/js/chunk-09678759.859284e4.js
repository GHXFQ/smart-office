(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-09678759","chunk-2d0e4842"],{"0b4f":function(e,t,a){},"1c6f":function(e,t,a){"use strict";a("c4cc")},"1d68":function(e,t,a){},"1f3f":function(e,t,a){"use strict";a.d(t,"e",(function(){return c})),a.d(t,"f",(function(){return l})),a.d(t,"d",(function(){return o})),a.d(t,"a",(function(){return i})),a.d(t,"g",(function(){return r})),a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return d}));var n=a("b775");function c(e,t){return Object(n["a"])({url:"/api/calendar/events/monthly/",method:"get",params:{year:e,month:t}})}function l(e){return Object(n["a"])({url:"/api/calendar/events/weekly/",method:"get",params:{date:e}})}function o(e){return Object(n["a"])({url:"/api/calendar/events/daily/",method:"get",params:{date:e}})}function i(e){const{title:t,start:a,end:c,location:l,description:o,type:i,reminder:r,participants:s}=e;return Object(n["a"])({url:"/api/calendar/events/",method:"post",data:{title:t,start:a,end:c,location:l,description:o,type:i,reminder:r,participants:s}})}function r(e,t){const{title:a,start:c,end:l,location:o,description:i,type:r,reminder:s,participants:d}=t;return Object(n["a"])({url:`/api/calendar/events/${e}/`,method:"put",data:{title:a,start:c,end:l,location:o,description:i,type:r,reminder:s,participants:d}})}function s(e){return Object(n["a"])({url:`/api/calendar/events/${e}/`,method:"delete"})}function d(e){return Object(n["a"])({url:`/api/calendar/events/${e}/`,method:"get"})}},"271a":function(e,t,a){"use strict";var n=a("cb2d"),c=a("e330"),l=a("577e"),o=a("d6d6"),i=URLSearchParams,r=i.prototype,s=c(r.getAll),d=c(r.has),u=new i("a=1");!u.has("a",2)&&u.has("a",void 0)||n(r,"has",(function(e){var t=arguments.length,a=t<2?void 0:arguments[1];if(t&&void 0===a)return d(this,e);var n=s(this,e);o(t,1);var c=l(a),i=0;while(i<n.length)if(n[i++]===c)return!0;return!1}),{enumerable:!0,unsafe:!0})},"43f2":function(e,t,a){},"48cf":function(e,t,a){"use strict";a.d(t,"f",(function(){return c})),a.d(t,"g",(function(){return l})),a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return i})),a.d(t,"e",(function(){return r})),a.d(t,"d",(function(){return s})),a.d(t,"c",(function(){return d}));a("d9e2");var n=a("b775");function c(){return Object(n["a"])({url:"/api/ai/schedule-reminder/",method:"get"})}function l(e){return Object(n["a"])({url:`/api/ai/recommendations/${e}/mark_as_read/`,method:"post"})}function o(e){return Object(n["a"])({url:"/api/ai/chat-with-documents/",method:"post",data:e,responseType:"text"})}function i(e,t,a,n){const c=new AbortController,l=c.signal,o=localStorage.getItem("token"),i={"Content-Type":"application/json"};return o&&(i["Authorization"]="Bearer "+o),fetch("http://localhost:8000/api/ai/chat-with-documents/",{method:"POST",headers:i,body:JSON.stringify(e),signal:l}).then(async e=>{if(!e.ok){const t=await e.json().catch(()=>({message:"服务返回了错误状态，且响应体不是有效的JSON。"}));throw new Error(t.message||"HTTP error! Status: "+e.status)}const c=e.body.getReader(),l=new TextDecoder("utf-8");let o="",i=null;const r=async()=>{while(1){const{done:r,value:s}=await c.read();if(r){o&&console.error("Stream finished but buffer is not empty:",o),a&&a(i);break}o+=l.decode(s,{stream:!0});const d=o.split("\n");o=d.pop();for(const c of d)if(c.startsWith("data:")){const l=c.substring(5).trim();if("[DONE]"===l)return void(a&&a(i));try{const e=JSON.parse(l);t&&t(e,e.chat_id),("session_id"===e.type||e.chat_id)&&(i=e.chat_id)}catch(e){console.error("无法解析JSON流: ",l,e),n&&n(new Error("无法解析服务器发送的数据"))}}}};r().catch(e=>{console.error("An error occurred while processing the stream:",e),n&&n(e)})}).catch(e=>{"AbortError"!==e.name&&(console.error("Fetch request failed:",e),n&&n(e))}),c}function r(){return Object(n["a"])({url:"/api/ai/chats/",method:"get"})}function s(e){return Object(n["a"])({url:`/api/ai/chats/${e}/`,method:"get"})}function d(e){return Object(n["a"])({url:`/api/ai/chats/${e}/`,method:"delete"})}},"4b15":function(e,t,a){},"4fc5":function(e,t,a){"use strict";a("6330")},5494:function(e,t,a){"use strict";var n=a("83ab"),c=a("e330"),l=a("edd0"),o=URLSearchParams.prototype,i=c(o.forEach);n&&!("size"in o)&&l(o,"size",{get:function(){var e=0;return i(this,(function(){e++})),e},configurable:!0,enumerable:!0})},6007:function(e,t,a){},6330:function(e,t,a){},"67b8":function(e,t,a){"use strict";a("43f2")},7198:function(e,t,a){"use strict";a("0b4f")},"79ba":function(e,t,a){},"7b73":function(e,t,a){"use strict";a("4b15")},"7eed":function(e,t,a){"use strict";a("1d68")},"7f9e":function(e,t,a){"use strict";a("6007")},"88a7":function(e,t,a){"use strict";var n=a("cb2d"),c=a("e330"),l=a("577e"),o=a("d6d6"),i=URLSearchParams,r=i.prototype,s=c(r.append),d=c(r["delete"]),u=c(r.forEach),b=c([].push),v=new i("a=1&a=2&b=3");v["delete"]("a",1),v["delete"]("b",void 0),v+""!=="a=2"&&n(r,"delete",(function(e){var t=arguments.length,a=t<2?void 0:arguments[1];if(t&&void 0===a)return d(this,e);var n=[];u(this,(function(e,t){b(n,{key:t,value:e})})),o(t,1);var c,i=l(e),r=l(a),v=0,p=0,m=!1,f=n.length;while(v<f)c=n[v++],m||c.key===i?(m=!0,d(this,c.key)):p++;while(p<f)c=n[p++],c.key===i&&c.value===r||s(this,c.key,c.value)}),{enumerable:!0,unsafe:!0})},"910d":function(e,t,a){"use strict";var n=a("23e7"),c=a("c65b"),l=a("59ed"),o=a("825a"),i=a("46c4"),r=a("c5cc"),s=a("9bdd"),d=a("c430"),u=a("2a62"),b=a("f99f"),v=!d&&b("filter",TypeError),p=r((function(){var e,t,a,n=this.iterator,l=this.predicate,i=this.next;while(1){if(e=o(c(i,n)),t=this.done=!!e.done,t)return;if(a=e.value,s(n,l,[a,this.counter++],!0))return a}}));n({target:"Iterator",proto:!0,real:!0,forced:d||v},{filter:function(e){o(this);try{l(e)}catch(t){u(this,"throw",t)}return v?c(v,this,e):new p(i(this),{predicate:e})}})},a02a:function(e,t,a){"use strict";a("f7af")},a0f6:function(e,t,a){"use strict";a("79ba")},be54:function(e,t,a){"use strict";a("d235")},c4cc:function(e,t,a){},cd59:function(e,t,a){"use strict";a.r(t);var n=a("7a23");const c={class:"openwebui-chat-root"},l={class:"openwebui-chat-window"},o={class:"openwebui-chat-header"},i={class:"openwebui-chat-container"},r={class:"openwebui-chat-body",ref:"chatBody"},s={key:0,class:"openwebui-avatar ai-avatar left-avatar"},d={key:1,class:"openwebui-avatar user-avatar right-avatar"},u=["src"],b={key:1,viewBox:"0 0 40 40",width:"36",height:"36"},v={class:"openwebui-msg-bubble"},p={key:0},m=["innerHTML"],f={key:2,class:"openwebui-cursor"},j={key:3,class:"source-tag knowledge-base-tag"},h={key:4,class:"source-tag general-ai-tag"},O=["data-event-id"],g={class:"card-icon-wrapper"},w={class:"card-content-wrapper"},y={class:"card-title"},k=["innerHTML"],C={key:0,class:"card-actions"},V={key:2,class:"file-bubble-nest file-bubble-vertical"},x={class:"file-icon-area"},N={key:0,src:"https://cdn.jsdelivr.net/gh/file-icons/icons/svg/csv.svg",class:"file-icon-img"},E={class:"file-info-area"},B={class:"file-name"},_={class:"file-meta"},D={key:0,class:"file-desc-text"},S={class:"right-panel-header"},T={class:"right-panel-mode-controls"},F={class:"history-container"},$={class:"history-header"},I={class:"history-list"},A=["onClick"],M={class:"history-item-icon"},U={class:"history-item-info"},L={class:"history-item-title"},z={class:"history-item-time"},H={class:"history-item-actions"},R=["onClick"],Y={key:0,class:"history-empty"},P={class:"openwebui-chat-footer"},W={key:0,class:"openwebui-file-preview-bar"},q={class:"openwebui-file-thumb"},J=["src"],G={class:"openwebui-file-info"},K=["title"],Q={class:"openwebui-file-meta"},X={key:1,class:"openwebui-file-status completed"},Z={class:"openwebui-input-area"},ee={key:1,class:"openwebui-options-area"},te={class:"dialog-footer"};function ae(e,t,a,ae,ne,ce){const le=Object(n["resolveComponent"])("Delete"),oe=Object(n["resolveComponent"])("el-icon"),ie=Object(n["resolveComponent"])("el-button"),re=Object(n["resolveComponent"])("DataAnalysis"),se=Object(n["resolveComponent"])("Cpu"),de=Object(n["resolveComponent"])("EditPen"),ue=Object(n["resolveComponent"])("Document"),be=Object(n["resolveComponent"])("MagicStick"),ve=Object(n["resolveComponent"])("el-radio-button"),pe=Object(n["resolveComponent"])("el-radio-group"),me=Object(n["resolveComponent"])("Expand"),fe=Object(n["resolveComponent"])("Fold"),je=Object(n["resolveComponent"])("ChatLineSquare"),he=Object(n["resolveComponent"])("el-progress"),Oe=Object(n["resolveComponent"])("Check"),ge=Object(n["resolveComponent"])("Close"),we=Object(n["resolveComponent"])("UploadFilled"),ye=Object(n["resolveComponent"])("el-tooltip"),ke=Object(n["resolveComponent"])("el-input"),Ce=Object(n["resolveComponent"])("el-form-item"),Ve=Object(n["resolveComponent"])("el-date-picker"),xe=Object(n["resolveComponent"])("el-option"),Ne=Object(n["resolveComponent"])("el-select"),Ee=Object(n["resolveComponent"])("el-form"),Be=Object(n["resolveComponent"])("el-dialog");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",c,[Object(n["createElementVNode"])("div",l,[Object(n["createElementVNode"])("div",o,[t[16]||(t[16]=Object(n["createElementVNode"])("span",{class:"openwebui-title"},"智慧AI办公助手",-1)),Object(n["createVNode"])(ie,{type:"link",size:"small",onClick:ae.clearChat,class:"clear-chat-btn"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(oe,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(le)]),_:1}),t[15]||(t[15]=Object(n["createTextVNode"])(" 新对话 "))]),_:1},8,["onClick"])]),Object(n["createElementVNode"])("div",i,[Object(n["createElementVNode"])("div",r,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(ae.messages,(e,a)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:a,class:Object(n["normalizeClass"])(["openwebui-msg",e.role])},["assistant"===e.role?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",s,t[17]||(t[17]=[Object(n["createElementVNode"])("svg",{viewBox:"0 0 40 40",width:"36",height:"36"},[Object(n["createElementVNode"])("circle",{cx:"20",cy:"20",r:"20",fill:"#2f54eb"}),Object(n["createElementVNode"])("text",{x:"50%",y:"55%","text-anchor":"middle",fill:"#fff","font-size":"20","font-family":"Arial",dy:".3em"},"🤖")],-1)]))):Object(n["createCommentVNode"])("",!0),"user"===e.role?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",d,[ae.userAvatarUrl?(Object(n["openBlock"])(),Object(n["createElementBlock"])("img",{key:0,src:ae.userAvatarUrl,class:"user-avatar-img",alt:"用户头像",onError:t[0]||(t[0]=(...e)=>ae.handleAvatarError&&ae.handleAvatarError(...e))},null,40,u)):(Object(n["openBlock"])(),Object(n["createElementBlock"])("svg",b,t[18]||(t[18]=[Object(n["createElementVNode"])("circle",{cx:"20",cy:"20",r:"20",fill:"#bbb"},null,-1),Object(n["createElementVNode"])("text",{x:"50%",y:"55%","text-anchor":"middle",fill:"#fff","font-size":"20","font-family":"Arial",dy:".3em"},"🧑",-1)])))])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",v,["text"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])(n["Fragment"],{key:0},["user"===e.role?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",p,Object(n["toDisplayString"])(e.content),1)):(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",{key:1,innerHTML:e.content},null,8,m)),e.streaming?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",f)):Object(n["createCommentVNode"])("",!0),"knowledge_base"===e.source&&"assistant"===e.role?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",j,[Object(n["createVNode"])(oe,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(re)]),_:1}),t[19]||(t[19]=Object(n["createTextVNode"])(" 知识库 "))])):Object(n["createCommentVNode"])("",!0),"general_ai"===e.source&&"assistant"===e.role?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",h,[Object(n["createVNode"])(oe,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(se)]),_:1}),t[20]||(t[20]=Object(n["createTextVNode"])(" AI大模型 "))])):Object(n["createCommentVNode"])("",!0)],64)):"card"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:1,class:Object(n["normalizeClass"])(["openwebui-card-message",ae.getCardClass(e.status)]),"data-event-id":e.event_id},[Object(n["createElementVNode"])("div",g,[Object(n["createVNode"])(oe,null,{default:Object(n["withCtx"])(()=>[(Object(n["openBlock"])(),Object(n["createBlock"])(Object(n["resolveDynamicComponent"])(ae.getCardIcon(e.status))))]),_:2},1024)]),Object(n["createElementVNode"])("div",w,[Object(n["createElementVNode"])("div",y,Object(n["toDisplayString"])(ae.getCardTitle(e.status)),1),Object(n["createElementVNode"])("div",{class:"card-body",innerHTML:e.content},null,8,k),"success"===e.status&&e.event_id?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",C,[Object(n["createVNode"])(ie,{size:"small",onClick:t=>ae.editEvent(e),round:""},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(oe,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(de)]),_:1}),t[21]||(t[21]=Object(n["createTextVNode"])(" 编辑 "))]),_:2},1032,["onClick"]),Object(n["createVNode"])(ie,{type:"danger",size:"small",onClick:t=>ae.deleteEventFromCard(e.event_id),round:""},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(oe,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(le)]),_:1}),t[22]||(t[22]=Object(n["createTextVNode"])(" 删除 "))]),_:2},1032,["onClick"])])):Object(n["createCommentVNode"])("",!0)])],10,O)):"file"===e.type?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",V,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(e.files,e=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.name+e.size,class:"file-message-card"},[Object(n["createElementVNode"])("div",x,["csv"===e.ext?(Object(n["openBlock"])(),Object(n["createElementBlock"])("img",N)):(Object(n["openBlock"])(),Object(n["createBlock"])(oe,{key:1},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(ue)]),_:1}))]),Object(n["createElementVNode"])("div",E,[Object(n["createElementVNode"])("div",B,Object(n["toDisplayString"])(e.name),1),Object(n["createElementVNode"])("div",_,Object(n["toDisplayString"])(e.ext.toUpperCase())+" · "+Object(n["toDisplayString"])(e.size),1)])]))),128)),e.content?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",D,Object(n["toDisplayString"])(e.content),1)):Object(n["createCommentVNode"])("",!0)])):Object(n["createCommentVNode"])("",!0)])],2))),128))],512),Object(n["createElementVNode"])("div",{class:Object(n["normalizeClass"])(["openwebui-right-panel",{collapsed:ae.rightPanelCollapsed}])},[Object(n["createElementVNode"])("div",S,[Object(n["createElementVNode"])("div",T,[Object(n["createVNode"])(pe,{modelValue:ae.chatMode,"onUpdate:modelValue":t[1]||(t[1]=e=>ae.chatMode=e),size:"default"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(ve,{label:"agent"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(oe,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(be)]),_:1}),t[23]||(t[23]=Object(n["createTextVNode"])(" AI助手 "))]),_:1}),Object(n["createVNode"])(ve,{label:"knowledge_base"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(oe,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(re)]),_:1}),t[24]||(t[24]=Object(n["createTextVNode"])(" 知识库 "))]),_:1})]),_:1},8,["modelValue"])]),Object(n["createVNode"])(ie,{circle:"",onClick:t[2]||(t[2]=e=>ae.rightPanelCollapsed=!ae.rightPanelCollapsed),title:ae.rightPanelCollapsed?"展开":"收起",class:"collapse-button"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(oe,{size:16},{default:Object(n["withCtx"])(()=>[ae.rightPanelCollapsed?(Object(n["openBlock"])(),Object(n["createBlock"])(fe,{key:1})):(Object(n["openBlock"])(),Object(n["createBlock"])(me,{key:0}))]),_:1})]),_:1},8,["title"])]),Object(n["createElementVNode"])("div",F,[Object(n["createElementVNode"])("div",$,[t[26]||(t[26]=Object(n["createElementVNode"])("h3",{class:"history-title"},"历史记录",-1)),ae.chatSessions.length>0?(Object(n["openBlock"])(),Object(n["createBlock"])(ie,{key:0,text:"",size:"small",class:"clear-all-btn",onClick:ae.confirmClearAllHistory},{default:Object(n["withCtx"])(()=>t[25]||(t[25]=[Object(n["createTextVNode"])(" 清空 ")])),_:1},8,["onClick"])):Object(n["createCommentVNode"])("",!0)]),Object(n["createElementVNode"])("div",I,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(ae.chatSessions,(e,t)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.id,class:Object(n["normalizeClass"])(["history-item",{active:e.id===ae.chatId}])},[Object(n["createElementVNode"])("div",{class:"history-item-content",onClick:t=>ae.switchChatSession(e.id)},[Object(n["createElementVNode"])("div",M,[Object(n["createVNode"])(oe,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(je)]),_:1})]),Object(n["createElementVNode"])("div",U,[Object(n["createElementVNode"])("div",L,Object(n["toDisplayString"])(e.title||"对话 "+(t+1)),1),Object(n["createElementVNode"])("div",z,Object(n["toDisplayString"])(ae.formatTime(e.created_at)),1)])],8,A),Object(n["createElementVNode"])("div",H,[Object(n["createElementVNode"])("div",{class:"delete-btn-wrapper",onClick:Object(n["withModifiers"])(t=>ae.deleteSession(e.id),["stop"])},[Object(n["createVNode"])(oe,{class:"delete-icon"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(le)]),_:1})],8,R)])],2))),128)),0===ae.chatSessions.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Y," 暂无历史记录 ")):Object(n["createCommentVNode"])("",!0)])])],2)]),Object(n["createElementVNode"])("div",P,[ae.selectedFiles.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",W,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(ae.selectedFiles,(e,a)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:e.id,class:"openwebui-file-card"},[Object(n["createElementVNode"])("div",q,[e.type.startsWith("image/")?(Object(n["openBlock"])(),Object(n["createElementBlock"])("img",{key:0,src:e.url,class:"openwebui-file-img"},null,8,J)):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:1,class:"openwebui-file-icon",style:Object(n["normalizeStyle"])({background:e.bg})},["pdf"===e.ext?(Object(n["openBlock"])(),Object(n["createBlock"])(oe,{key:0},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(ue)]),_:1})):"csv"===e.ext||"xls"===e.ext||"xlsx"===e.ext?(Object(n["openBlock"])(),Object(n["createBlock"])(oe,{key:1},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(ue)]),_:1})):(Object(n["openBlock"])(),Object(n["createBlock"])(oe,{key:2},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(ue)]),_:1}))],4))]),Object(n["createElementVNode"])("div",G,[Object(n["createElementVNode"])("div",{class:"openwebui-file-name",title:e.name},Object(n["toDisplayString"])(e.name),9,K),Object(n["createElementVNode"])("div",Q,Object(n["toDisplayString"])(e.label)+" · "+Object(n["toDisplayString"])(e.size),1),"completed"!==e.status?(Object(n["openBlock"])(),Object(n["createBlock"])(he,{key:0,percentage:e.progress,status:"failed"===e.status?"exception":"","stroke-width":4,class:"openwebui-file-progress"},null,8,["percentage","status"])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",X,[Object(n["createVNode"])(oe,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Oe)]),_:1}),t[27]||(t[27]=Object(n["createTextVNode"])(" 处理完成 "))]))]),Object(n["createVNode"])(oe,{class:"openwebui-file-remove",onClick:e=>ae.removeFile(a)},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(ge)]),_:2},1032,["onClick"])]))),128))])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",Z,[Object(n["createElementVNode"])("input",{type:"file",ref:"fileInput",style:{display:"none"},onChange:t[3]||(t[3]=(...e)=>ae.handleFileUpload&&ae.handleFileUpload(...e)),multiple:"",accept:".txt,.pdf,.doc,.docx,.md,.xls,.xlsx,.csv,.jpg,.jpeg,.png,.gif,.bmp,.webp,.svg,.tiff"},null,544),Object(n["createVNode"])(ye,{content:"文档: txt, pdf, doc, docx, md\n表格: xls, xlsx, csv\n图片: jpg, jpeg, png, gif, bmp, webp, svg, tiff",placement:"top","popper-class":"openwebui-upload-tooltip","open-delay":200},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(ie,{class:"openwebui-upload-btn",onClick:ae.triggerFileInput,title:"上传文件/图片",disabled:ae.loading},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(oe,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(we)]),_:1})]),_:1},8,["onClick","disabled"])]),_:1}),Object(n["createVNode"])(ke,{modelValue:ae.input,"onUpdate:modelValue":t[4]||(t[4]=e=>ae.input=e),placeholder:"请输入您的问题...",onKeyup:Object(n["withKeys"])(ae.sendMsg,["enter"]),class:"openwebui-input",disabled:ae.loading||ae.processingFiles},null,8,["modelValue","onKeyup","disabled"]),Object(n["createVNode"])(ie,{type:"primary",onClick:ae.sendMsg,class:"openwebui-send-btn",loading:ae.loading,disabled:ae.processingFiles},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(ae.loading?"生成中":ae.processingFiles?"处理中":"发送"),1)]),_:1},8,["onClick","loading","disabled"])]),"knowledge_base"===ae.chatMode?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ee,[Object(n["createVNode"])(pe,{modelValue:ae.searchMethod,"onUpdate:modelValue":t[5]||(t[5]=e=>ae.searchMethod=e),size:"small"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(ve,{label:"basic"},{default:Object(n["withCtx"])(()=>t[28]||(t[28]=[Object(n["createTextVNode"])("基础检索")])),_:1}),Object(n["createVNode"])(ve,{label:"local"},{default:Object(n["withCtx"])(()=>t[29]||(t[29]=[Object(n["createTextVNode"])("复杂检索")])),_:1})]),_:1},8,["modelValue"])])):Object(n["createCommentVNode"])("",!0),t[30]||(t[30]=Object(n["createElementVNode"])("div",{class:"openwebui-footer-hint"}," 支持文档、表格、图片等多种格式文件 ",-1))])]),Object(n["createVNode"])(Be,{modelValue:ae.editEventDialogVisible,"onUpdate:modelValue":t[14]||(t[14]=e=>ae.editEventDialogVisible=e),title:"编辑日程",width:"500px",class:"calendar-dialog","append-to-body":!0,"destroy-on-close":!0,"close-on-click-modal":!1},{footer:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",te,[Object(n["createVNode"])(ie,{onClick:t[13]||(t[13]=e=>ae.editEventDialogVisible=!1)},{default:Object(n["withCtx"])(()=>t[31]||(t[31]=[Object(n["createTextVNode"])("取消")])),_:1}),Object(n["createVNode"])(ie,{type:"primary",onClick:ae.saveEditEvent},{default:Object(n["withCtx"])(()=>t[32]||(t[32]=[Object(n["createTextVNode"])("确定")])),_:1},8,["onClick"])])]),default:Object(n["withCtx"])(()=>[ae.editingEvent?(Object(n["openBlock"])(),Object(n["createBlock"])(Ee,{key:0,model:ae.editingEvent,"label-width":"80px"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ce,{label:"标题"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(ke,{modelValue:ae.editingEvent.title,"onUpdate:modelValue":t[6]||(t[6]=e=>ae.editingEvent.title=e),placeholder:"请输入日程标题"},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(Ce,{label:"开始时间"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ve,{modelValue:ae.editingEvent.start,"onUpdate:modelValue":t[7]||(t[7]=e=>ae.editingEvent.start=e),type:"datetime",placeholder:"选择开始时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm"},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(Ce,{label:"结束时间"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ve,{modelValue:ae.editingEvent.end,"onUpdate:modelValue":t[8]||(t[8]=e=>ae.editingEvent.end=e),type:"datetime",placeholder:"选择结束时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm"},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(Ce,{label:"地点"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(ke,{modelValue:ae.editingEvent.location,"onUpdate:modelValue":t[9]||(t[9]=e=>ae.editingEvent.location=e),placeholder:"请输入地点"},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(Ce,{label:"类型"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ne,{modelValue:ae.editingEvent.type,"onUpdate:modelValue":t[10]||(t[10]=e=>ae.editingEvent.type=e),placeholder:"请选择日程类型"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(xe,{label:"会议",value:"blue"}),Object(n["createVNode"])(xe,{label:"出差",value:"orange"}),Object(n["createVNode"])(xe,{label:"假期",value:"green"}),Object(n["createVNode"])(xe,{label:"截止日期",value:"red"}),Object(n["createVNode"])(xe,{label:"其他",value:"purple"})]),_:1},8,["modelValue"])]),_:1}),Object(n["createVNode"])(Ce,{label:"提醒"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ne,{modelValue:ae.editingEvent.reminder,"onUpdate:modelValue":t[11]||(t[11]=e=>ae.editingEvent.reminder=e),placeholder:"请选择提醒时间"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(xe,{label:"不提醒",value:"none"}),Object(n["createVNode"])(xe,{label:"10分钟前",value:"10min"}),Object(n["createVNode"])(xe,{label:"30分钟前",value:"30min"}),Object(n["createVNode"])(xe,{label:"1小时前",value:"1hour"}),Object(n["createVNode"])(xe,{label:"1天前",value:"1day"})]),_:1},8,["modelValue"])]),_:1}),Object(n["createVNode"])(Ce,{label:"备注"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(ke,{modelValue:ae.editingEvent.description,"onUpdate:modelValue":t[12]||(t[12]=e=>ae.editingEvent.description=e),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):Object(n["createCommentVNode"])("",!0)]),_:1},8,["modelValue"])])}a("d9e2"),a("14d9"),a("e9f5"),a("910d"),a("f665"),a("7d54"),a("ab43"),a("a732"),a("88a7"),a("271a"),a("5494");var ne=a("f6f2"),ce=a("b775"),le=a("7c5c"),oe=a("3ef4"),ie=a("c9a1"),re=a("48cf"),se=a("1f3f");function de(e){return e<1024?e+"B":e<1048576?(e/1024).toFixed(1)+"KB":(e/1024/1024).toFixed(1)+"MB"}function ue(e){const t=e.split(".");return t.length>1?t[t.length-1].toLowerCase():""}function be(e,t){const a=t.toLowerCase();return e.startsWith("image/")?"图片":"pdf"===a?"PDF":["csv","xls","xlsx"].includes(a)?"表格":["doc","docx"].includes(a)?"文档":"md"===a?"Markdown":"txt"===a?"文本":a.toUpperCase()}function ve(e){const t=e.toLowerCase();return"pdf"===t?"#f87171":["csv","xls","xlsx"].includes(t)?"#34d399":["doc","docx"].includes(t)?"#60a5fa":"md"===t?"#a78bfa":"txt"===t?"#fbbf24":"#a5b4fc"}function pe(e){return e.replace(/[&<>"']/g,(function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]}))}function me(e){if(!e)return"";const t=new Date(e);return`${t.getMonth()+1}月${t.getDate()}日 ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}var fe={name:"Dashboard",components:{UploadFilled:ne["UploadFilled"],Document:ne["Document"],Close:ne["Close"],Check:ne["Check"],Delete:ne["Delete"],DataAnalysis:ne["DataAnalysis"],Cpu:ne["Cpu"],MagicStick:ne["MagicStick"],ChatLineSquare:ne["ChatLineSquare"],Fold:ne["Fold"],Expand:ne["Expand"],Calendar:ne["Calendar"],ChatDotRound:ne["ChatDotRound"],Collection:ne["Collection"],DocumentCopy:ne["DocumentCopy"],Grid:ne["Grid"],Connection:ne["Connection"],CircleCheckFilled:ne["CircleCheckFilled"],InfoFilled:ne["InfoFilled"],CircleCloseFilled:ne["CircleCloseFilled"],WarningFilled:ne["WarningFilled"],EditPen:ne["EditPen"]},setup(){const{proxy:e}=Object(n["getCurrentInstance"])(),t=Object(n["ref"])(e.$store.state.user.avatar),a=()=>{t.value=""},c=Object(n["ref"])(""),l=Object(n["ref"])([{role:"assistant",content:'<div class="welcome-message">\n          <h3>欢迎来到智行舟平台</h3>\n          <div class="platform-intro">\n            <p>智行舟平台是您的智能协作中心，融合了项目管理、即时通讯、智能文档和AI助手等。我们致力于通过前沿AI技术赋能您的团队，优化业务流程，为您打造无缝连接的未来办公新范式，核心优势如下：</p>\n            \n            <ul class="platform-features">\n              <li><span class="feature-highlight">AI智能引擎</span> - 我们的AI助手能够理解自然语言，处理复杂文档，创建日程，成为您24小时的智能工作伙伴。</li>\n              <li><span class="feature-highlight">一体化协作</span> - 无缝整合项目、日程与沟通工具，打破信息孤岛，让团队协作如行云流水般顺畅，显著提升效率。</li>\n              <li><span class="feature-highlight">智慧文档处理</span> - 从智能合同生成到知识库管理，自动化处理繁杂的文档工作流，让您的团队聚焦于核心创新。</li>\n              <li><span class="feature-highlight">安全可靠保障</span> - 采用企业级数据加密与精细化权限管理，全方位守护您的核心数据资产安全。</li>\n            </ul>\n            \n            <p>借助智行舟平台，您的企业将迈入更敏捷、高效、智能的协作新纪元，激发团队潜力，提升整体竞争力。</p>\n          </div>\n          <p>选择以下功能模块，或直接向我提问，我将为您提供智能助手服务。</p>\n          <div class="quick-nav-cards">\n            <div class="nav-card" onclick="window.location.href=\'/project\'">\n              <div class="nav-card-icon">\n                <i class="bi bi-kanban"></i>\n              </div>\n              <div class="nav-card-content">\n                <div class="nav-card-title">项目协作</div>\n                <div class="nav-card-desc">任务分配、进度跟踪、团队协作</div>\n              </div>\n              <div class="nav-card-arrow"><i class="nav-arrow-icon">→</i></div>\n            </div>\n            <div class="nav-card" onclick="window.location.href=\'/calendar\'">\n              <div class="nav-card-icon">\n                <i class="bi bi-calendar-week"></i>\n              </div>\n              <div class="nav-card-content">\n                <div class="nav-card-title">日程安排</div>\n                <div class="nav-card-desc">会议预约、日程提醒、时间管理</div>\n              </div>\n              <div class="nav-card-arrow"><i class="nav-arrow-icon">→</i></div>\n            </div>\n            <div class="nav-card" onclick="window.location.href=\'/chat\'">\n              <div class="nav-card-icon">\n                <i class="bi bi-chat-dots"></i>\n              </div>\n              <div class="nav-card-content">\n                <div class="nav-card-title">即时沟通</div>\n                <div class="nav-card-desc">团队聊天、文件共享、消息通知</div>\n              </div>\n              <div class="nav-card-arrow"><i class="nav-arrow-icon">→</i></div>\n            </div>\n            <div class="nav-card" onclick="window.location.href=\'/smartdoc\'">\n              <div class="nav-card-icon">\n                <i class="bi bi-file-earmark-text"></i>\n              </div>\n              <div class="nav-card-content">\n                <div class="nav-card-title">智能文档</div>\n                <div class="nav-card-desc">内容创作、智能问答、文档共享</div>\n              </div>\n              <div class="nav-card-arrow"><i class="nav-arrow-icon">→</i></div>\n            </div>\n            <div class="nav-card" onclick="window.location.href=\'/knowledge\'">\n              <div class="nav-card-icon">\n                <i class="bi bi-book"></i>\n              </div>\n              <div class="nav-card-content">\n                <div class="nav-card-title">知识库</div>\n                <div class="nav-card-desc">团队知识共享、检索、存储平台</div>\n              </div>\n              <div class="nav-card-arrow"><i class="nav-arrow-icon">→</i></div>\n            </div>\n            <div class="nav-card" onclick="window.location.href=\'/contract\'">\n              <div class="nav-card-icon">\n                <i class="bi bi-file-earmark-ruled"></i>\n              </div>\n              <div class="nav-card-content">\n                <div class="nav-card-title">智能合同</div>\n                <div class="nav-card-desc">合同模板、AI审查、智能生成</div>\n              </div>\n              <div class="nav-card-arrow"><i class="nav-arrow-icon">→</i></div>\n            </div>\n          </div>\n        </div>',rawContent:"您好，我是您的AI助手，有什么可以帮您？",type:"text"}]),o=Object(n["ref"])(null),i=Object(n["ref"])(null),r=Object(n["ref"])([]),s=Object(n["ref"])(!1),d=Object(n["computed"])(()=>r.value.some(e=>"completed"!==e.status&&"failed"!==e.status)),u=Object(n["ref"])(null),b=Object(n["computed"])(()=>null!==u.value),v=Object(n["ref"])("basic"),p=Object(n["ref"])("agent"),m=Object(n["ref"])("local"),f=Object(n["ref"])(null),j=Object(n["ref"])(!1),h=Object(n["ref"])([]),O=Object(n["ref"])(!1),g=Object(n["ref"])(null),w=Object(n["ref"])(null),y=e.emitter,k=async()=>{try{const e=await Object(re["e"])();return e.data&&Array.isArray(e.data)?h.value=e.data:e.data&&e.data.results&&Array.isArray(e.data.results)&&(h.value=e.data.results),h.value}catch(e){return console.error("获取聊天会话列表失败:",e),h.value=[],[]}},C=async e=>{if(e!==u.value)try{s.value=!0;const t=await Object(re["d"])(e);t.data&&(u.value=e,t.data.messages&&Array.isArray(t.data.messages)&&(l.value=t.data.messages.map(e=>({role:e.role,content:e.content,rawContent:e.content,type:e.type||"text",source:"user"===e.role?"":e.source||("assistant"===e.role?"general_ai":"")}))))}catch(t){console.error("获取聊天会话详情失败:",t),oe["a"].error("切换聊天会话失败");const a=h.value.some(t=>t.id===e);a||(h.value.length>0?await C(h.value[0].id):B())}finally{s.value=!1}};Object(n["watch"])(u,e=>{e&&k()});const V=async()=>{try{const e=await Object(ce["a"])({url:"/api/auth/users/me/",method:"get"});console.log("用户信息完整响应:",e);let a=null;if(e.data&&e.data.data&&e.data.data.avatar)a=e.data.data.avatar;else if(e.data&&e.data.avatar)a=e.data.avatar;else if(e.data){const t=e=>{if(!e||"object"!==typeof e)return null;if("avatar"in e)return e.avatar;for(const a in e)if("object"===typeof e[a]){const n=t(e[a]);if(n)return n}return null};a=t(e.data)}if(console.log("找到的头像URL:",a),a){if(a.startsWith("http")||a.startsWith("data:"))t.value=a;else{const e=window.location.origin;a.startsWith("/")?t.value=`${e}${a}`:t.value=`${e}/${a}`}console.log("处理后的用户头像URL:",t.value)}else console.log("用户信息中没有找到头像:",e.data)}catch(e){console.error("获取用户信息失败:",e)}},x=()=>{Object(n["nextTick"])(()=>{o.value&&(o.value.scrollTop=o.value.scrollHeight)})},N=async e=>{const t=new FormData;t.append("file",e.rawFile);try{e.progress=0,e.status="pending";let a=null,n=0,c=!1;const l=await Object(ce["a"])({url:"/api/ai/documents/upload/",method:"post",data:t,onUploadProgress:t=>{const l=Math.round(100*t.loaded/t.total);if(l<100)e.progress=l,n=l;else if(!c){c=!0;let t=n;a=setInterval(()=>{t+=3,t>=95&&(t=95,clearInterval(a)),e.progress=t},20)}}});return a&&clearInterval(a),e.progress<95&&(e.progress=95),e.status="processing",e.documentId=l.data.id,E(e),l.data.id}catch(a){throw e.status="failed",console.error("文件上传失败:",a),new Error(`上传文件 ${e.name} 失败: ${a.message||"服务器错误"}`)}},E=async(e,t=1e3)=>{if(e.documentId)try{const a=await Object(ce["a"])({url:`/api/ai/documents/${e.documentId}/`,method:"get"});if("completed"===a.data.status)return e.progress=100,void(e.status="completed");if("failed"===a.data.status)return e.status="failed",void(e.progress=0);"processing"===a.data.status&&e.progress<95&&(e.progress=Math.min(e.progress+5,95)),setTimeout(()=>E(e,t),t)}catch(a){setTimeout(()=>E(e,t),t)}},B=()=>{u.value=null,l.value=[{role:"assistant",content:'<div class="welcome-message">\n            <h3>欢迎来到智行舟平台</h3>\n            <div class="platform-intro">\n              <p>智行舟平台是您的智能协作中心，融合了项目管理、即时通讯、智能文档和AI助手。我们致力于通过前沿AI技术赋能您的团队，优化业务流程，为您打造无缝连接的未来办公新范式，核心优势如下：</p>\n              \n              <ul class="platform-features">\n                <li><span class="feature-highlight">AI智能引擎</span> - 我们的AI助手能够理解自然语言，处理复杂文档，自动创建日程，成为您24小时的智能工作伙伴。</li>\n                <li><span class="feature-highlight">一体化协作</span> - 无缝整合项目、日程与沟通工具，打破信息孤岛，让团队协作如行云流水般顺畅，显著提升效率。</li>\n                <li><span class="feature-highlight">智慧文档处理</span> - 从智能合同生成到知识库管理，自动化处理繁杂的文档工作流，让您的团队聚焦于核心创新。</li>\n                <li><span class="feature-highlight">安全可靠保障</span> - 采用企业级数据加密与精细化权限管理，全方位守护您的核心数据资产安全。</li>\n              </ul>\n              \n              <p>借助智行舟平台，您的企业将迈入更敏捷、高效、智能的协作新纪元，激发团队潜力，提升整体竞争力。</p>\n            </div>\n            <p>选择以下功能模块，或直接向我提问，我将为您提供智能助手服务。</p>\n            <div class="quick-nav-cards">\n              <div class="nav-card" onclick="window.location.href=\'/project\'">\n                <div class="nav-card-icon">\n                  <i class="bi bi-kanban"></i>\n                </div>\n                <div class="nav-card-content">\n                  <div class="nav-card-title">项目协作</div>\n                  <div class="nav-card-desc">任务分配、进度跟踪、团队协作</div>\n                </div>\n                <div class="nav-card-arrow"><i class="nav-arrow-icon">→</i></div>\n              </div>\n              <div class="nav-card" onclick="window.location.href=\'/calendar\'">\n                <div class="nav-card-icon">\n                  <i class="bi bi-calendar-week"></i>\n                </div>\n                <div class="nav-card-content">\n                  <div class="nav-card-title">日程安排</div>\n                  <div class="nav-card-desc">会议预约、日程提醒、时间管理</div>\n                </div>\n                <div class="nav-card-arrow"><i class="nav-arrow-icon">→</i></div>\n              </div>\n              <div class="nav-card" onclick="window.location.href=\'/chat\'">\n                <div class="nav-card-icon">\n                  <i class="bi bi-chat-dots"></i>\n                </div>\n                <div class="nav-card-content">\n                  <div class="nav-card-title">即时沟通</div>\n                  <div class="nav-card-desc">团队聊天、文件共享、消息通知</div>\n                </div>\n                <div class="nav-card-arrow"><i class="nav-arrow-icon">→</i></div>\n              </div>\n              <div class="nav-card" onclick="window.location.href=\'/smartdoc\'">\n                <div class="nav-card-icon">\n                  <i class="bi bi-file-earmark-text"></i>\n                </div>\n                <div class="nav-card-content">\n                  <div class="nav-card-title">AI文档</div>\n                  <div class="nav-card-desc">文档摘要、智能问答、内容创作</div>\n                </div>\n                <div class="nav-card-arrow"><i class="nav-arrow-icon">→</i></div>\n              </div>\n              <div class="nav-card" onclick="window.location.href=\'/knowledge\'">\n                <div class="nav-card-icon">\n                  <i class="bi bi-book"></i>\n                </div>\n                <div class="nav-card-content">\n                  <div class="nav-card-title">知识库</div>\n                  <div class="nav-card-desc">团队知识共享、检索、存储平台</div>\n                </div>\n                <div class="nav-card-arrow"><i class="nav-arrow-icon">→</i></div>\n              </div>\n              <div class="nav-card" onclick="window.location.href=\'/contract\'">\n                <div class="nav-card-icon">\n                  <i class="bi bi-file-earmark-ruled"></i>\n                </div>\n                <div class="nav-card-content">\n                  <div class="nav-card-title">智能合同</div>\n                  <div class="nav-card-desc">合同模板、AI审查、智能生成</div>\n                </div>\n                <div class="nav-card-arrow"><i class="nav-arrow-icon">→</i></div>\n              </div>\n            </div>\n          </div>',rawContent:"您好，我是您的AI助手，有什么可以帮您？",type:"text"}],r.value=[],c.value="",f.value&&(f.value.abort(),f.value=null),s.value=!1,Object(n["nextTick"])(()=>{o.value&&(o.value.scrollTop=0)}),k()},_=e=>{let t=l.value[l.value.length-1];if(t&&"assistant"===t.role||(t={role:"assistant",content:"",rawContent:"",type:"text",streaming:!0,source:"knowledge_base"===p.value?"knowledge_base":"general_ai"},l.value.push(t)),"processing_start"===e.type)t.type="text",t.content=e.content,t.rawContent=e.content,t.streaming=!0;else if("text_chunk"===e.type){t.type="text",t.streaming=!0,t.rawContent&&"正在为您处理日程..."!==t.rawContent||(t.rawContent="");const a=e.content.replace(/\[Data: Sources \(\d+\)\]\.?/g,"");t.rawContent+=a,t.content=le["marked"].parse(t.rawContent)}else if("final_card"===e.type)t.type="card",t.streaming=!1,t.content=le["marked"].parse(e.content||""),t.status=e.status||"clarification",t.event_id=e.event_id||null,"success"===e.status&&y.emit("refreshCalendar");else if("error"===e.type)t.type="card",t.streaming=!1,t.content=e.content||"发生未知错误。",t.status="error";else if("update_card"===e.type){const t=l.value.find(t=>"card"===t.type&&t.event_id===e.event_id);t&&(t.content=le["marked"].parse(e.content||""),t.status=e.status||t.status)}else"session_id"===e.type&&e.chat_id&&!u.value&&(u.value=e.chat_id,k());x()},D=async()=>{if(!c.value.trim()&&0===r.value.length)return void oe["a"].warning("请输入内容或上传文件");if(d.value)return void oe["a"].warning("文件正在处理中，请稍候再试");f.value&&f.value.abort();const e={role:"user",content:c.value,type:"text"};l.value.push(e),r.value.length>0&&l.value.push({role:"user",content:`上传了${r.value.length}个文件`,type:"file",files:r.value.map(e=>({name:e.name,size:e.size,ext:e.ext}))});const t={role:"assistant",content:"",type:"text",streaming:!0,source:"knowledge_base"===p.value?"knowledge_base":"general_ai"};l.value.push(t);const a=c.value;c.value="";const n=r.value.map(e=>e.documentId).filter(Boolean);r.value=[],x(),s.value=!0;let o=null;try{const e=await Object(ce["a"])({url:"/api/settings/ai-settings",method:"get"});e&&e.success&&(o=e.data)}catch(b){console.error("获取AI个性化设置失败:",b)}const i={message:a,chat_id:u.value,document_ids:n,chatMode:p.value,method:v.value,ai_settings:o};f.value=Object(re["b"])(i,(e,t)=>{t&&!u.value&&(u.value=t),_(e)},e=>{const t=l.value[l.value.length-1];t&&"assistant"===t.role&&(t.streaming=!1),e&&!u.value&&(u.value=e,k()),s.value=!1,f.value=null},e=>{console.error("流式请求出错:",e);const t=l.value[l.value.length-1];t&&"assistant"===t.role&&(t.content="抱歉，响应生成过程中出现错误，请稍后重试。",t.streaming=!1),s.value=!1,f.value=null,oe["a"].error("请求出错: "+(e.message||"未知错误"))})},S=()=>{i.value&&(i.value.value=""),i.value&&i.value.click()},T=e=>{const t=e.target.files;if(!t||!t.length)return;const a={"text/plain":"txt","application/pdf":"pdf","application/msword":"doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"docx","text/markdown":"md","text/x-markdown":"md","text/csv":"csv","application/csv":"csv","application/vnd.ms-excel":"xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/bmp":"bmp","image/webp":"webp","image/svg+xml":"svg","image/tiff":"tiff"},n="支持的文件格式: txt, pdf, doc, docx, md, xls, xlsx, csv 和常见图片格式",c=[];let l=!1;const o=["txt","pdf","doc","docx","md","xls","xlsx","csv","jpg","jpeg","png","gif","bmp","webp","svg","tiff"];Array.from(t).forEach(e=>{const t=ue(e.name).toLowerCase(),n=o.includes(t);if(a[e.type]||n){const a=e.name+"_"+e.size+"_"+Date.now()+Math.random();if(e.type.startsWith("image/")){const n=new FileReader;n.onload=n=>{r.value.push({id:a,name:e.name,type:e.type,url:n.target.result,size:de(e.size),ext:t,label:be(e.type,t),bg:ve(t),rawFile:e,progress:0,status:"ready"}),N(r.value[r.value.length-1])},n.readAsDataURL(e)}else r.value.push({id:a,name:e.name,type:e.type,url:URL.createObjectURL(e),size:de(e.size),ext:t,label:be(e.type,t),bg:ve(t),rawFile:e,progress:0,status:"ready"}),N(r.value[r.value.length-1]);c.push(r.value[r.value.length-1])}else l=!0,oe["a"].error("不支持的文件类型: "+e.name),console.warn(`文件类型拒绝: ${e.name}, MIME: ${e.type}, 扩展名: ${t}`)}),l&&oe["a"].info(n),c.length>0&&c.length===t.length&&oe["a"].success(`已添加${c.length}个文件`)},F=e=>{r.value.splice(e,1)},$=new le["marked"].Renderer;$.table=function(e,t){return`<table class="openwebui-md-table"><thead>${e}</thead><tbody>${t}</tbody></table>`},$.code=function(e,t,a){const n="code-"+Math.random().toString(36).substr(2,9);let c=(t||"").split(/\s+/)[0],l=c||"code",o=c?"language-"+c:"";return`\n        <div class="openwebui-md-code-block-beauty">\n          <div class="openwebui-md-code-toolbar">\n            <span class="openwebui-md-code-lang">${l}</span>\n            <button class="openwebui-copy-btn" data-clipboard-target="#${n}" title="复制代码">复制</button>\n          </div>\n          <pre class="openwebui-md-pre"><code id="${n}" class="${o}">${a?e:pe(e)}</code></pre>\n        </div>\n      `};const I={walkTokens(e){"del"===e.type&&(e.type="text",e.text=e.raw,delete e.tokens)}};le["marked"].use(I),le["marked"].setOptions({breaks:!0,gfm:!0,headerIds:!1,mangle:!1,renderer:$});const A=e=>{switch(e){case"success":return"success-card";case"error":return"error-card";case"clarification":return"clarification-card";case"deleted":return"deleted-card";default:return""}},M=e=>{switch(e){case"success":return"CircleCheckFilled";case"error":return"CircleCloseFilled";case"clarification":return"InfoFilled";case"deleted":return"WarningFilled";default:return"InfoFilled"}},U=e=>{switch(e){case"success":return"日程操作成功";case"error":return"操作失败";case"clarification":return"需要确认";case"deleted":return"日程已删除";default:return"提示信息"}},L=e=>{const t=window.location.pathname;t.includes(e)||(window.location.href="/"+e)},z=e=>{L(e)},H=async e=>{try{await ie["a"].confirm("确认要删除这条对话记录吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}),await Object(re["c"])(e),await k(),B(),oe["a"].success("对话已删除，已创建新对话")}catch(t){"cancel"!==t&&"close"!==t&&(console.error("删除聊天会话失败:",t),oe["a"].error("删除失败，请稍后重试"))}},R=()=>{ie["a"].confirm("确认要清空所有历史记录吗？此操作不可恢复。","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{Y()}).catch(()=>{})},Y=async()=>{try{s.value=!0;for(const e of h.value)await Object(re["c"])(e.id);h.value=[],B(),oe["a"].success("所有历史记录已清空，已创建新对话")}catch(e){console.error("清空历史记录失败:",e),oe["a"].error("操作失败，请稍后重试")}finally{s.value=!1}};Object(n["onMounted"])(()=>{document.body.addEventListener("click",(function(e){if(e.target.classList&&e.target.classList.contains("openwebui-copy-btn")){const t=e.target.getAttribute("data-clipboard-target").replace("#",""),a=document.getElementById(t);a&&navigator.clipboard.writeText(a.innerText).then(()=>{e.target.innerText="已复制",setTimeout(()=>{e.target.innerText="复制"},1200)})}})),V(),k().then(()=>{0===h.value.length&&B()}),window.addEventListener("beforeunload",()=>{f.value&&f.value.abort()})}),y.on("refreshCalendar",()=>{console.log("收到日历刷新事件，正在重新加载数据...")});const P=async e=>{try{const{data:t}=await Object(se["c"])(e.event_id);w.value=e,g.value={id:t.id,title:t.title,start:G(new Date(t.start)),end:G(new Date(t.end)),location:t.location||"",description:t.description||"",type:t.type||"blue",reminder:t.reminder||"30min",participants:t.participants||[]},O.value=!0}catch(t){console.error("获取事件详情失败:",t),oe["a"].error("无法获取日程详情，请稍后重试")}},W=async()=>{if(!g.value)return;const e=g.value;if(!e.title||!e.title.trim())return void oe["a"].warning("标题不能为空");if(!e.start)return void oe["a"].warning("请选择开始时间");if(!e.end)return void oe["a"].warning("请选择结束时间");const t=new Date(e.start).getTime(),a=new Date(e.end).getTime();if(t>a)oe["a"].warning("结束时间不能早于开始时间");else try{await Object(se["g"])(e.id,{title:e.title,start:e.start,end:e.end,location:e.location,description:e.description,type:e.type,reminder:e.reminder,participants:e.participants}),oe["a"].success("日程已成功更新！"),O.value=!1,w.value&&J(w.value,e.title,e.description),y.emit("refreshCalendar"),g.value=null,w.value=null}catch(n){console.error("更新事件失败:",n),oe["a"].error("更新失败，请稍后重试")}},q=async e=>{try{await ie["a"].confirm("您确定要删除这个日程吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Object(se["b"])(e),oe["a"].success("日程已成功删除！");const t=l.value.find(t=>"card"===t.type&&t.event_id===e);t&&(t.content="该日程已被删除",t.status="deleted"),y.emit("refreshCalendar")}catch(t){if("cancel"===t)return;t.response&&404===t.response.status?oe["a"].error("操作失败：该日程已被删除或不存在。"):(console.error("从卡片删除日程时出错:",t),oe["a"].error("删除失败，请稍后重试。"))}},J=(e,t,a)=>{const c=new Date,l=`${c.getFullYear()}年${c.getMonth()+1}月${c.getDate()}日`;let o=`已成功更新日程：**${t}**\n\n`;o+=`日期：${l}\n\n`,a&&(o+=`描述：${a}\n\n`),o+="您可以在日历中查看完整详情。",e.content=le["marked"].parse(o),e.status="success",Object(n["nextTick"])(()=>{const t=document.querySelector(`.openwebui-card-message[data-event-id="${e.event_id}"]`);t&&(t.classList.remove("clarification-card","error-card","deleted-card"),t.classList.add("success-card"))})},G=e=>{if(!e)return"";try{let t;e instanceof Date?isNaN(e.getTime())?(console.error("无效日期对象",e),t=new Date):t=e:(t=new Date(e),isNaN(t.getTime())&&(console.error("无效日期字符串",e),t=new Date));const a=t.getFullYear(),n=(t.getMonth()+1).toString().padStart(2,"0"),c=t.getDate().toString().padStart(2,"0"),l=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0"),i=`${a}-${n}-${c} ${l}:${o}`;return i}catch(t){console.error("日期格式化错误:",t);const e=new Date;return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}};return{input:c,messages:l,sendMsg:D,chatBody:o,fileInput:i,triggerFileInput:S,handleFileUpload:T,selectedFiles:r,removeFile:F,UploadFilled:ne["UploadFilled"],Document:ne["Document"],Close:ne["Close"],Check:ne["Check"],loading:s,processingFiles:d,clearChat:B,showContextBar:b,chatId:u,userAvatarUrl:t,handleAvatarError:a,searchMethod:v,chatMode:p,retrievalScope:m,rightPanelCollapsed:j,chatSessions:h,switchChatSession:C,formatTime:me,navigateTo:L,navigateToModule:z,Calendar:ne["Calendar"],ChatDotRound:ne["ChatDotRound"],Collection:ne["Collection"],DocumentCopy:ne["DocumentCopy"],Grid:ne["Grid"],Connection:ne["Connection"],deleteSession:H,confirmClearAllHistory:R,clearAllHistory:Y,getCardClass:A,getCardIcon:M,getCardTitle:U,editEvent:P,deleteEventFromCard:q,editEventDialogVisible:O,editingEvent:g,saveEditEvent:W}}},je=(a("7eed"),a("7198"),a("1c6f"),a("7b73"),a("7f9e"),a("4fc5"),a("be54"),a("a02a"),a("67b8"),a("a0f6"),a("6b0d")),he=a.n(je);const Oe=he()(fe,[["render",ae],["__scopeId","data-v-4d090986"]]);t["default"]=Oe},d235:function(e,t,a){},d6d6:function(e,t,a){"use strict";var n=TypeError;e.exports=function(e,t){if(e<t)throw new n("Not enough arguments");return e}},f665:function(e,t,a){"use strict";var n=a("23e7"),c=a("c65b"),l=a("2266"),o=a("59ed"),i=a("825a"),r=a("46c4"),s=a("2a62"),d=a("f99f"),u=d("find",TypeError);n({target:"Iterator",proto:!0,real:!0,forced:u},{find:function(e){i(this);try{o(e)}catch(n){s(this,"throw",n)}if(u)return c(u,this,e);var t=r(this),a=0;return l(t,(function(t,n){if(e(t,a++))return n(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},f7af:function(e,t,a){}}]);
//# sourceMappingURL=chunk-09678759.859284e4.js.map