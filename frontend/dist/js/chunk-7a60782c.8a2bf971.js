(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7a60782c","chunk-2d0e4842"],{"910d":function(e,t,l){"use strict";var a=l("23e7"),c=l("c65b"),o=l("59ed"),r=l("825a"),i=l("46c4"),n=l("c5cc"),d=l("9bdd"),s=l("c430"),u=l("2a62"),b=l("f99f"),p=!s&&b("filter",TypeError),m=n((function(){var e,t,l,a=this.iterator,o=this.predicate,i=this.next;while(1){if(e=r(c(i,a)),t=this.done=!!e.done,t)return;if(l=e.value,d(a,o,[l,this.counter++],!0))return l}}));a({target:"Iterator",proto:!0,real:!0,forced:s||p},{filter:function(e){r(this);try{o(e)}catch(t){u(this,"throw",t)}return p?c(p,this,e):new m(i(this),{predicate:e})}})},a980:function(e,t,l){},b73a:function(e,t,l){"use strict";l("fea9")},bf8a:function(e,t,l){"use strict";l("a980")},ccb0:function(e,t,l){"use strict";l.r(t);l("14d9"),l("e9f5"),l("910d"),l("f665"),l("7d54"),l("ab43"),l("a732");var a=l("7a23"),c=l("f6f2"),o=l("b775"),r=l("3ef4"),i=l("c9a1");const n={class:"module-card modern-tasks"},d={class:"module-header"},s={class:"btn-group"},u={class:"task-filters modern-filters"},b={class:"kanban-view modern-kanban"},p={class:"row"},m={class:"card modern-card"},j={class:"card-header modern-card-header kanban-col-header"},O={class:"mb-0"},v={class:"card-body task-list"},h=["onClick"],g={class:"task-header"},f={class:"mb-0 task-title-main"},V={class:"task-meta-row"},k={key:0},y={key:1},N={class:"task-progress-row"},x={class:"progress-text"},w={class:"task-tags"},C={class:"task-description"},B=["onClick"],_={style:{"font-size":"12px",color:"#888",cursor:"pointer"}},E={key:0,style:{"margin-top":"6px"}},T={key:0,class:"ai-analysis modern-ai-analysis"},D={key:0,class:"text-center py-2"},I={key:1,class:"mb-0"},A=["innerHTML"],S={key:0},L={style:{"font-weight":"600"}},$={style:{margin:"10px 0",display:"flex",gap:"16px","align-items":"center"}},U={style:{"margin-bottom":"10px"}},q={style:{"margin-bottom":"10px"}},z={style:{"margin-bottom":"10px"}},M={class:"ai-analysis modern-ai-analysis"},F={class:"d-flex justify-content-between align-items-center mb-2"},W={key:0,class:"text-center py-2"},R={key:1,class:"mb-0"},Y=["innerHTML"],H={class:"member-completion-list"},J={key:0},P={key:1};var G={__name:"TasksView",props:{project:{type:Object,default:()=>({})},members:{type:Array,default:()=>[]}},setup(e){const t=Object(a["ref"])(null);try{t.value=JSON.parse(localStorage.getItem("user")||"{}"),console.log("当前登录用户:",t.value)}catch(Ie){console.error("解析用户信息失败:",Ie)}const l=e,G=Object(a["computed"])(()=>l.members),K=Object(a["ref"])(""),Q=Object(a["ref"])(""),X=Object(a["ref"])(""),Z=Object(a["ref"])(!1),ee=Object(a["ref"])(!1),te=Object(a["ref"])(null),le=Object(a["ref"])({title:"",assignee:"",priority:"中",dueDate:"",description:"",tags:"",status:"todo",progress:0,completed:0,total:1}),ae=Object(a["ref"])([]),ce=Object(a["ref"])({}),oe=Object(a["computed"])(()=>[{name:"待处理",tasks:ae.value.filter(e=>"todo"===e.status||"待处理"===e.status)},{name:"进行中",tasks:ae.value.filter(e=>"in-progress"===e.status||"进行中"===e.status)},{name:"已完成",tasks:ae.value.filter(e=>"done"===e.status||"已完成"===e.status)}]),re=Object(a["ref"])(!1),ie=Object(a["ref"])(null),ne=Object(a["ref"])(null),de={title:[{required:!0,message:"请输入任务名称",trigger:"blur"}],assignee:[{required:!0,message:"请选择负责人",trigger:"change"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],dueDate:[{required:!0,message:"请选择截止日期",trigger:"change"}],description:[{required:!0,message:"请输入任务描述",trigger:"blur"}],tags:[{required:!0,message:"请输入标签",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]};function se(){l.project&&l.project.id&&o["a"].get("/api/tasks/?project="+l.project.id).then(e=>{const t=Array.isArray(e.data)?e.data:e.data.data||[];ae.value=t.map(e=>({...e,dueDate:e.due_date||e.dueDate||"",priority:"high"===e.priority?"高":"low"===e.priority?"低":"medium"===e.priority?"中":e.priority||"",priorityType:"high"===e.priority||"高"===e.priority?"danger":"low"===e.priority||"低"===e.priority?"info":"warning"})),ae.value.forEach(e=>{e.ai&&0!==e.ai.length||fe(e.id)})})}function ue(e){e&&o["a"].get("/api/task-completions/?task="+e).then(t=>{const l=Array.isArray(t.data)?t.data:t.data.data||[],a=new Map;l.forEach(e=>{var t,l,c;const o=(null===(t=e.user)||void 0===t?void 0:t.id)||(null===(l=e.member)||void 0===l||null===(c=l.user)||void 0===c?void 0:c.id)||e.member_id;o&&a.set(o,{completed:e.completed,completionId:e.id})});const c=G.value,o=c.map(e=>{const t=a.get(e.id);return{id:e.id,name:e.name,completed:!!t&&t.completed,completionId:t?t.completionId:void 0,userId:e.id}});ce.value[e]={total:o.length,completed:o.filter(e=>e.completed).length,members:o}}).catch(t=>{console.error(`获取任务[${e}]完成进度失败:`,t),ce.value[e]={total:G.value.length,completed:0,members:G.value.map(e=>({id:e.id,name:e.name,completed:!1,userId:e.id}))}})}function be(e){var t,l,a;return e&&e.id&&null!==(t=ce.value[e.id])&&void 0!==t&&t.total?Math.round(100*((null===(l=ce.value[e.id])||void 0===l?void 0:l.completed)||0)/(null===(a=ce.value[e.id])||void 0===a?void 0:a.total)):0}function pe(e){return e&&e.id&&ce.value[e.id]?`${(null===(t=ce.value[e.id])||void 0===t?void 0:t.completed)||0}/${(null===(l=ce.value[e.id])||void 0===l?void 0:l.total)||G.value.length||1}人完成`:`0/${G.value.length||1}人完成`;var t,l}function me(e,t){e&&t&&(console.log("为新成员标记任务完成:",e,t),o["a"].post("/api/task-completions/",{task:e,member_id:t,completed:!0,completed_at:(new Date).toISOString()}).then(()=>{if(r["a"].success("已标记为完成"),ce.value[e]){ce.value[e].completed++;const l=ce.value[e].members.map(e=>e.id);G.value.forEach(a=>{l.includes(a.id)||ce.value[e].members.push({id:a.id,name:a.name,completed:a.id===t,completionId:void 0})});const a=ce.value[e].members.find(e=>e.id===t);a&&(a.completed=!0),ce.value[e].total=ce.value[e].members.length}else ce.value[e]={total:G.value.length,completed:1,members:G.value.map(e=>({id:e.id,name:e.name,completed:e.id===t,completionId:void 0}))};ue(e);const l=ce.value[e];l&&l.completed===l.total&&l.total>0&&Oe(e)}).catch(e=>{console.error("创建任务完成记录失败:",e),r["a"].error("操作失败，请重试")}))}function je(e,t){var l;const a=((null===(l=ce.value[e])||void 0===l?void 0:l.members)||[]).find(e=>e.id===t);a&&!a.completed&&(console.log("标记任务完成:",e,t,a.completionId),a.completed=!0,ce.value[e].completed++,ce.value[e].total=Math.max(ce.value[e].total,ce.value[e].members.length,G.value.length),o["a"].patch(`/api/task-completions/${a.completionId}/`,{completed:!0,completed_at:(new Date).toISOString()}).then(()=>{r["a"].success("已标记为完成"),ue(e);const t=ce.value[e];t&&t.completed===t.total&&t.total>0&&Oe(e)}).catch(e=>{console.error("标记完成失败:",e),r["a"].error("操作失败，但界面已更新")}))}function Oe(e){const t=ae.value.find(t=>t.id===e);t&&(t.status="done"),o["a"].patch(`/api/tasks/${e}/`,{status:"done"})}function ve(){ie.value?ie.value.validate(e=>{if(!e)return void r["a"].error("请填写所有必填项");const t=le.value.assignee;if(!t)return void r["a"].error("负责人无效");const a={project:l.project.id,title:le.value.title,description:le.value.description,assignee_id:t,due_date:le.value.dueDate,priority:"高"===le.value.priority?"high":"low"===le.value.priority?"low":"medium",status:"todo",tags:le.value.tags};o["a"].post("/api/tasks/",a).then(()=>{r["a"].success("任务创建成功"),Z.value=!1,se()}).catch(()=>{r["a"].error("任务创建失败")})}):console.error("表单引用不存在")}function he(e){return e.filter(e=>{const t=!K.value||e.title.includes(K.value)||e.description&&e.description.includes(K.value),l=!Q.value||e.assignee&&e.assignee.user&&e.assignee.user.username===Q.value,a=!X.value||e.priority===X.value;return t&&l&&a})}function ge(e){te.value={...e,priorityType:e.priorityType||("高"===e.priority||"high"===e.priority?"danger":"低"===e.priority||"low"===e.priority?"info":"warning"),ai:e.ai||[]},ee.value=!0,e.ai&&0!==e.ai.length||fe(e.id)}function fe(e){if(!e)return;console.log("获取任务AI分析:",e);const t=ae.value.find(t=>t.id===e);t&&(t._aiLoading=!0),o["a"].get(`/api/tasks/${e}/ai_analysis/`).then(t=>{var l;let a=(null===(l=t.data)||void 0===l?void 0:l.suggestions)||[];Array.isArray(a)||(a=[a.toString()]);const c=Te(a);te.value&&te.value.id===e&&(te.value.ai=c);const o=ae.value.find(t=>t.id===e);o&&(o.ai=c),console.log("任务AI分析结果:",c)}).catch(e=>{console.error("获取任务AI分析失败:",e),r["a"].error("获取任务AI分析失败")}).finally(()=>{const t=ae.value.find(t=>t.id===e);t&&(t._aiLoading=!1)})}function Ve(){le.value={title:"",assignee:"",priority:"中",dueDate:"",description:"",tags:"",status:"todo",progress:0,completed:0,total:1},Z.value=!0}function ke(e){e&&o["a"].get("/api/project-members/?project="+e).then(e=>{Array.isArray(e.data)?G.value=e.data.map(e=>{var t,l,a;return{id:e.id,name:(null===(t=e.user)||void 0===t?void 0:t.username)||(null===(l=e.user)||void 0===l?void 0:l.email)||"未命名成员",userId:null===(a=e.user)||void 0===a?void 0:a.id}}):G.value=[],console.log("拉取到的项目成员（ProjectMember）:",G.value)}).catch(e=>{console.error("获取项目成员失败",e),G.value=[]})}Object(a["watch"])([K,Q,X],()=>{},{deep:!0}),Object(a["watch"])(ae,e=>{(e||[]).forEach(e=>ue(e.id))},{immediate:!0}),Object(a["watch"])(()=>l.project,e=>{e&&e.id&&(l.members&&l.members.length>0?(G.value=l.members,console.log("使用父组件传递的成员数据:",G.value)):ke(e.id),se())},{immediate:!0}),Object(a["watch"])(()=>l.members,e=>{e&&e.length>0&&(G.value=e,console.log("成员数据更新:",G.value))},{immediate:!0}),Object(a["onMounted"])(()=>{l.project&&l.project.id&&(l.members&&l.members.length>0?(G.value=l.members,console.log("使用父组件传递的成员数据:",G.value)):ke(l.project.id),se())});const ye=Object(a["ref"])(!1),Ne=Object(a["ref"])(null);function xe(e){Ne.value={...e,status:e.status||"todo"},ye.value=!0}function we(){ne.value?ne.value.validate(e=>{if(!e)return void r["a"].error("请填写所有必填项");let t=[];"string"===typeof Ne.value.tags?t=Ne.value.tags.split(",").map(e=>e.trim()).filter(Boolean):Array.isArray(Ne.value.tags)&&(t=Ne.value.tags);const l={id:Ne.value.id,title:Ne.value.title,description:Ne.value.description||"",priority:"高"===Ne.value.priority?"high":"低"===Ne.value.priority?"low":"medium",due_date:Ne.value.dueDate||"",tags:t,status:Ne.value.status||"todo"};o["a"].patch(`/api/tasks/${Ne.value.id}/`,l).then(()=>{r["a"].success("任务更新成功"),ye.value=!1,se(),ee.value=!1}).catch(()=>{r["a"].error("任务更新失败")})}):console.error("表单引用不存在")}function Ce(e){i["a"].confirm("确定要删除该任务吗？","提示",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{o["a"].delete(`/api/tasks/${e.id}/`).then(()=>{r["a"].success("任务已删除"),se(),ee.value=!1})})}function Be(){if(!ae.value.length)return;re.value=!0;let e=0;const t=ae.value.length;ae.value.forEach(l=>{l._aiLoading=!0,o["a"].get(`/api/tasks/${l.id}/ai_analysis/`).then(e=>{var t;let a=(null===(t=e.data)||void 0===t?void 0:t.suggestions)||[];Array.isArray(a)||(a=[a.toString()]),l.ai=Te(a)}).catch(()=>{l.ai=[]}).finally(()=>{l._aiLoading=!1,e++,e===t&&(re.value=!1,r["a"].success("AI分析完成"))})})}function _e(e){if(!e||!Array.isArray(e))return[];let t=!1;if(e.length>0){const l=e[e.length-1];"string"!==typeof l||"建议:"!==l.trim()&&"建议："!==l.trim()||(t=!0)}if(t)return e;const l=[];let a="",c=[];for(const o of e)"string"===typeof o?o.includes("专业分析:")||o.includes("专业分析：")?(a&&c.length&&l.push(`${a}${c.join(" ")}`),a="专业分析: ",c=[]):o.includes("建议:")||o.includes("建议：")?(a&&c.length&&l.push(`${a}${c.join(" ")}`),a="建议: ",c=[]):o.trim().startsWith("-")||o.trim().startsWith("•")?l.push(o):c.push(o):l.push(o);return a&&c.length&&l.push(`${a}${c.join(" ")}`),l.length?l:e}function Ee(e){if(!e)return"";try{let t=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>");return t=t.replace(/\*(.*?)\*/g,"<em>$1</em>"),t=t.replace(/`(.*?)`/g,"<code>$1</code>"),t=t.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank">$1</a>'),(t.trim().startsWith("-")||t.trim().startsWith("•"))&&(t=t.replace(/^[\s-•]+/,""),t='<span class="list-bullet">•</span> '+t),t.includes("专业分析:")||t.includes("专业分析：")?t='<strong class="analysis-title">专业分析:</strong> '+t.replace(/专业分析[:：]\s*/,""):(t.includes("建议:")||t.includes("建议："))&&(t='<strong class="suggestion-title">建议:</strong> '+t.replace(/建议[:：]\s*/,"")),t}catch(Ie){return console.error("Markdown格式化错误:",Ie),e}}function Te(e){if(!e||!e.length)return[];const t=e.join(" "),l=e.some(e=>"string"===typeof e&&(e.includes("专业分析:")||e.includes("专业分析："))),a=e.some(e=>"string"===typeof e&&(e.includes("建议:")||e.includes("建议：")));if(e.length>0){const t=e[e.length-1];"string"!==typeof t||"建议:"!==t.trim()&&"建议："!==t.trim()||(e.push("- 建议进一步明确任务的细节和具体要求"),e.push("- 考虑提前安排资源，确保任务按时完成"))}if(a||(e.push("建议:"),e.push("- 建议进一步明确任务的细节和具体要求"),e.push("- 考虑提前安排资源，确保任务按时完成")),l||t.includes("紧急性")||t.includes("重要性")||(e.unshift("- 根据任务描述进行初步分析，可能需要更多信息"),e.unshift("专业分析:")),l||a){const t=[];let l=null,a=!1,c=!1;for(let o=0;o<e.length;o++){const r=e[o];"string"===typeof r?r.includes("专业分析:")||r.includes("专业分析：")?(l="analysis",t.push(r),a=!1):r.includes("建议:")||r.includes("建议：")?(l="suggestion",t.push(r),c=!1):"analysis"===l?(r.trim().startsWith("-")||r.trim().startsWith("•")?t.push(r):t.push("- "+r),a=!0):"suggestion"===l?(r.trim().startsWith("-")||r.trim().startsWith("•")?t.push(r):t.push("- "+r),c=!0):t.push(r):t.push(r)}return"analysis"!==l||a?"suggestion"!==l||c||(t.push("- 建议进一步明确任务的细节和具体要求"),t.push("- 考虑提前安排资源，确保任务按时完成")):t.push("- 根据任务描述进行初步分析，可能需要更多信息"),t}const c=[],o=[];e.forEach(e=>{e&&"string"===typeof e&&(e.includes("紧急性")||e.includes("重要性")||e.includes("可行性")?c.push(e):e.includes("专业分析")||e.includes("建议:")||e.includes("建议：")||o.push(e))}),0===o.length&&(o.push("建议进一步明确任务的细节和具体要求"),o.push("考虑提前安排资源，确保任务按时完成"));const r=[];return r.push("专业分析:"),c.length>0?r.push(...c.map(e=>e.trim().startsWith("-")?e:"- "+e)):r.push("- 根据任务描述进行初步分析，可能需要更多信息"),r.push("建议:"),o.length>0?r.push(...o.map(e=>e.trim().startsWith("-")?e:"- "+e)):(r.push("- 建议进一步明确任务的细节和具体要求"),r.push("- 考虑提前安排资源，确保任务按时完成")),r}function De(e){return!(!t.value||!t.value.id)&&Number(e)===Number(t.value.id)}return(e,t)=>{const l=Object(a["resolveComponent"])("el-button"),o=Object(a["resolveComponent"])("el-input"),r=Object(a["resolveComponent"])("el-option"),i=Object(a["resolveComponent"])("el-select"),ae=Object(a["resolveComponent"])("el-badge"),se=Object(a["resolveComponent"])("el-empty"),ue=Object(a["resolveComponent"])("el-tag"),Oe=Object(a["resolveComponent"])("el-icon"),ke=Object(a["resolveComponent"])("el-progress"),Te=Object(a["resolveComponent"])("el-form-item"),Ie=Object(a["resolveComponent"])("el-date-picker"),Ae=Object(a["resolveComponent"])("el-form"),Se=Object(a["resolveComponent"])("el-dialog");return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",n,[Object(a["createElementVNode"])("div",d,[t[26]||(t[26]=Object(a["createElementVNode"])("h5",{class:"module-title"},"任务管理",-1)),Object(a["createElementVNode"])("div",s,[Object(a["createVNode"])(l,{type:"primary",size:"default",round:"",onClick:Ve},{default:Object(a["withCtx"])(()=>t[24]||(t[24]=[Object(a["createTextVNode"])("新建任务")])),_:1}),Object(a["createVNode"])(l,{type:"info",size:"default",round:"",onClick:Be,loading:re.value},{default:Object(a["withCtx"])(()=>t[25]||(t[25]=[Object(a["createTextVNode"])("刷新分析")])),_:1},8,["loading"])])]),Object(a["createElementVNode"])("div",u,[Object(a["createVNode"])(o,{modelValue:K.value,"onUpdate:modelValue":t[0]||(t[0]=e=>K.value=e),placeholder:"搜索任务...",clearable:"",class:"filter-input"},null,8,["modelValue"]),Object(a["createVNode"])(i,{modelValue:Q.value,"onUpdate:modelValue":t[1]||(t[1]=e=>Q.value=e),placeholder:"负责人",clearable:"",class:"filter-select"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(r,{label:"全部",value:""}),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(G.value,e=>(Object(a["openBlock"])(),Object(a["createBlock"])(r,{key:e.id,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Object(a["createVNode"])(i,{modelValue:X.value,"onUpdate:modelValue":t[2]||(t[2]=e=>X.value=e),placeholder:"优先级",clearable:"",class:"filter-select"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(r,{label:"全部",value:""}),Object(a["createVNode"])(r,{label:"高",value:"高"}),Object(a["createVNode"])(r,{label:"中",value:"中"}),Object(a["createVNode"])(r,{label:"低",value:"低"})]),_:1},8,["modelValue"])]),Object(a["createElementVNode"])("div",b,[Object(a["createElementVNode"])("div",p,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(oe.value,e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{class:"col-md-4",key:e.name},[Object(a["createElementVNode"])("div",m,[Object(a["createElementVNode"])("div",j,[Object(a["createElementVNode"])("span",{class:Object(a["normalizeClass"])(["kanban-col-dot",e.name])},null,2),Object(a["createElementVNode"])("h6",O,[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.name)+" ",1),Object(a["createVNode"])(ae,{value:he(e.tasks).length,class:"kanban-badge"},null,8,["value"])])]),Object(a["createElementVNode"])("div",v,[0===he(e.tasks).length?(Object(a["openBlock"])(),Object(a["createBlock"])(se,{key:0,description:"暂无任务","image-size":60})):(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],{key:1},Object(a["renderList"])(he(e.tasks),e=>{var o,r;return Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:e.title,class:"task-card modern-task-card"},[Object(a["createElementVNode"])("div",{class:"task-body",onClick:t=>ge(e)},[Object(a["createElementVNode"])("div",g,[Object(a["createElementVNode"])("h6",f,Object(a["toDisplayString"])(e.title),1),Object(a["createVNode"])(ue,{type:e.priorityType,size:"small"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e.priority),1)]),_:2},1032,["type"])]),Object(a["createElementVNode"])("div",V,[e.assignee&&e.assignee.user?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",k,[Object(a["createVNode"])(Oe,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Object(a["unref"])(c["UserFilled"]))]),_:1}),Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.assignee.user.username),1)])):Object(a["createCommentVNode"])("",!0),e.dueDate?(Object(a["openBlock"])(),Object(a["createElementBlock"])("span",y,[Object(a["createVNode"])(Oe,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Object(a["unref"])(c["Calendar"]))]),_:1}),Object(a["createTextVNode"])(" "+Object(a["toDisplayString"])(e.dueDate),1)])):Object(a["createCommentVNode"])("",!0),Object(a["createElementVNode"])("div",N,[Object(a["createVNode"])(ke,{percentage:be(e),"show-text":!1,style:{width:"60px",height:"4px",display:"inline-block",margin:"0 8px"}},null,8,["percentage"]),Object(a["createElementVNode"])("span",x,Object(a["toDisplayString"])(pe(e)),1)])]),Object(a["createElementVNode"])("div",w,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(e.tags,e=>(Object(a["openBlock"])(),Object(a["createBlock"])(ue,{key:e,size:"small"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e),1)]),_:2},1024))),128))]),Object(a["createElementVNode"])("p",C,Object(a["toDisplayString"])(e.description),1),Object(a["createElementVNode"])("div",{class:"ai-analysis-toggle",onClick:Object(a["withModifiers"])(t=>e._showAI=!e._showAI,["stop"])},[Object(a["createVNode"])(Oe,{style:{"vertical-align":"middle"}},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Object(a["unref"])(c["ChatDotRound"]))]),_:1}),Object(a["createElementVNode"])("span",_,"AI分析 "+Object(a["toDisplayString"])(e._showAI?"▲":"▼"),1),Object(a["createVNode"])(l,{size:"small",type:"link",onClick:Object(a["withModifiers"])(t=>fe(e.id),["stop"]),loading:e._aiLoading},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Oe,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Object(a["unref"])(c["Refresh"]))]),_:1})]),_:2},1032,["onClick","loading"])],8,B),De(null===(o=e.assignee)||void 0===o||null===(r=o.user)||void 0===r?void 0:r.id)?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",E,[Object(a["createVNode"])(l,{size:"small",onClick:Object(a["withModifiers"])(t=>xe(e),["stop"])},{default:Object(a["withCtx"])(()=>t[27]||(t[27]=[Object(a["createTextVNode"])("编辑")])),_:2},1032,["onClick"]),Object(a["createVNode"])(l,{size:"small",type:"danger",onClick:Object(a["withModifiers"])(t=>Ce(e),["stop"])},{default:Object(a["withCtx"])(()=>t[28]||(t[28]=[Object(a["createTextVNode"])("删除")])),_:2},1032,["onClick"])])):Object(a["createCommentVNode"])("",!0),Object(a["createVNode"])(a["Transition"],{name:"fade"},{default:Object(a["withCtx"])(()=>[e._showAI?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",T,[e.ai&&0!==e.ai.length?(Object(a["openBlock"])(),Object(a["createElementBlock"])("ul",I,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(_e(e.ai),e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("li",{key:e,innerHTML:Ee(e)},null,8,A))),128))])):(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",D,t[29]||(t[29]=[Object(a["createElementVNode"])("span",{class:"text-muted"},"暂无AI分析",-1)])))])):Object(a["createCommentVNode"])("",!0)]),_:2},1024)],8,h)])}),128))])])]))),128))])]),Object(a["createVNode"])(Se,{modelValue:Z.value,"onUpdate:modelValue":t[10]||(t[10]=e=>Z.value=e),title:"新建任务",width:"420px",class:"modern-dialog"},{footer:Object(a["withCtx"])(()=>[Object(a["createVNode"])(l,{onClick:t[9]||(t[9]=e=>Z.value=!1)},{default:Object(a["withCtx"])(()=>t[30]||(t[30]=[Object(a["createTextVNode"])("取消")])),_:1}),Object(a["createVNode"])(l,{type:"primary",onClick:ve},{default:Object(a["withCtx"])(()=>t[31]||(t[31]=[Object(a["createTextVNode"])("保存")])),_:1})]),default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Ae,{model:le.value,rules:de,ref_key:"addTaskFormRef",ref:ie,"label-width":"80px",class:"modern-form"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Te,{label:"任务名称",prop:"title",required:""},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(o,{modelValue:le.value.title,"onUpdate:modelValue":t[3]||(t[3]=e=>le.value.title=e),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(Te,{label:"负责人",prop:"assignee",required:""},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{modelValue:le.value.assignee,"onUpdate:modelValue":t[4]||(t[4]=e=>le.value.assignee=e),placeholder:"请选择负责人"},{default:Object(a["withCtx"])(()=>[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(G.value,e=>(Object(a["openBlock"])(),Object(a["createBlock"])(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Object(a["createVNode"])(Te,{label:"优先级",prop:"priority",required:""},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{modelValue:le.value.priority,"onUpdate:modelValue":t[5]||(t[5]=e=>le.value.priority=e),placeholder:"请选择优先级"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(r,{label:"高",value:"高"}),Object(a["createVNode"])(r,{label:"中",value:"中"}),Object(a["createVNode"])(r,{label:"低",value:"低"})]),_:1},8,["modelValue"])]),_:1}),Object(a["createVNode"])(Te,{label:"截止日期",prop:"dueDate",required:""},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Ie,{modelValue:le.value.dueDate,"onUpdate:modelValue":t[6]||(t[6]=e=>le.value.dueDate=e),"value-format":"YYYY-MM-DD",placeholder:"请选择截止日期"},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(Te,{label:"描述",prop:"description",required:""},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(o,{type:"textarea",modelValue:le.value.description,"onUpdate:modelValue":t[7]||(t[7]=e=>le.value.description=e),placeholder:"请输入任务描述"},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(Te,{label:"标签",prop:"tags",required:""},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(o,{modelValue:le.value.tags,"onUpdate:modelValue":t[8]||(t[8]=e=>le.value.tags=e),placeholder:"逗号分隔"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),Object(a["createVNode"])(Se,{modelValue:ee.value,"onUpdate:modelValue":t[15]||(t[15]=e=>ee.value=e),title:"任务详情",width:"480px",class:"modern-dialog"},{footer:Object(a["withCtx"])(()=>{var e,c,o,r,i,n;return[Object(a["createVNode"])(l,{onClick:t[12]||(t[12]=e=>ee.value=!1)},{default:Object(a["withCtx"])(()=>t[43]||(t[43]=[Object(a["createTextVNode"])("关闭")])),_:1}),De(null===(e=te.value)||void 0===e||null===(c=e.assignee)||void 0===c||null===(o=c.user)||void 0===o?void 0:o.id)?(Object(a["openBlock"])(),Object(a["createBlock"])(l,{key:0,onClick:t[13]||(t[13]=e=>xe(te.value)),type:"primary"},{default:Object(a["withCtx"])(()=>t[44]||(t[44]=[Object(a["createTextVNode"])("编辑")])),_:1})):Object(a["createCommentVNode"])("",!0),De(null===(r=te.value)||void 0===r||null===(i=r.assignee)||void 0===i||null===(n=i.user)||void 0===n?void 0:n.id)?(Object(a["openBlock"])(),Object(a["createBlock"])(l,{key:1,onClick:t[14]||(t[14]=e=>Ce(te.value)),type:"danger"},{default:Object(a["withCtx"])(()=>t[45]||(t[45]=[Object(a["createTextVNode"])("删除")])),_:1})):Object(a["createCommentVNode"])("",!0)]}),default:Object(a["withCtx"])(()=>{var e,o,r,i,n;return[te.value?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",S,[Object(a["createElementVNode"])("h5",L,Object(a["toDisplayString"])(te.value.title),1),Object(a["createElementVNode"])("div",$,[Object(a["createVNode"])(ue,{type:te.value.priorityType,size:"small"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(te.value.priority),1)]),_:1},8,["type"]),Object(a["createElementVNode"])("span",null,"负责人："+Object(a["toDisplayString"])(te.value.assignee&&te.value.assignee.user?te.value.assignee.user.username:""),1),Object(a["createElementVNode"])("span",null,"截止："+Object(a["toDisplayString"])(te.value.dueDate),1)]),Object(a["createElementVNode"])("div",U,"描述："+Object(a["toDisplayString"])(te.value.description),1),Object(a["createElementVNode"])("div",q,[t[32]||(t[32]=Object(a["createTextVNode"])("标签：")),(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(te.value.tags,e=>(Object(a["openBlock"])(),Object(a["createBlock"])(ue,{key:e,size:"small"},{default:Object(a["withCtx"])(()=>[Object(a["createTextVNode"])(Object(a["toDisplayString"])(e),1)]),_:2},1024))),128))]),Object(a["createElementVNode"])("div",z,[t[33]||(t[33]=Object(a["createTextVNode"])("进度：")),Object(a["createVNode"])(ke,{percentage:be(te.value)},null,8,["percentage"])]),Object(a["createElementVNode"])("div",M,[Object(a["createElementVNode"])("div",F,[t[35]||(t[35]=Object(a["createElementVNode"])("small",{class:"text-muted"},"AI分析：",-1)),Object(a["createVNode"])(l,{size:"small",type:"link",onClick:t[11]||(t[11]=e=>fe(te.value.id)),loading:te.value._aiLoading},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Oe,null,{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Object(a["unref"])(c["Refresh"]))]),_:1}),t[34]||(t[34]=Object(a["createTextVNode"])(" 刷新分析 "))]),_:1},8,["loading"])]),te.value.ai&&0!==te.value.ai.length?(Object(a["openBlock"])(),Object(a["createElementBlock"])("ul",R,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(_e(te.value.ai),e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("li",{key:e,innerHTML:Ee(e)},null,8,Y))),128))])):(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",W,t[36]||(t[36]=[Object(a["createElementVNode"])("span",{class:"text-muted"},"暂无AI分析",-1)])))]),Object(a["createElementVNode"])("div",H,["todo"===te.value.status||"待处理"===te.value.status?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",J,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(G.value,e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:e.id,class:"member-item"},[Object(a["createElementVNode"])("span",null,Object(a["toDisplayString"])(e.name),1),Object(a["createVNode"])(ue,{type:"info",size:"small"},{default:Object(a["withCtx"])(()=>t[37]||(t[37]=[Object(a["createTextVNode"])("未完成")])),_:1})]))),128))])):null!==(e=ce.value[null===(o=te.value)||void 0===o?void 0:o.id])&&void 0!==e&&e.members&&0!==(null===(r=ce.value[null===(i=te.value)||void 0===i?void 0:i.id])||void 0===r?void 0:r.members.length)?(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],{key:2},Object(a["renderList"])((null===(n=ce.value[te.value.id])||void 0===n?void 0:n.members)||[],e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:e.id,class:"member-item"},[Object(a["createElementVNode"])("span",null,Object(a["toDisplayString"])(e.name),1),e.completed?(Object(a["openBlock"])(),Object(a["createBlock"])(ue,{key:0,type:"success",size:"small"},{default:Object(a["withCtx"])(()=>t[40]||(t[40]=[Object(a["createTextVNode"])("已完成")])),_:1})):De(e.userId)?(Object(a["openBlock"])(),Object(a["createBlock"])(l,{key:1,type:"primary",size:"small",onClick:t=>je(te.value.id,e.id)},{default:Object(a["withCtx"])(()=>t[41]||(t[41]=[Object(a["createTextVNode"])("完成")])),_:2},1032,["onClick"])):(Object(a["openBlock"])(),Object(a["createBlock"])(ue,{key:2,type:"info",size:"small"},{default:Object(a["withCtx"])(()=>t[42]||(t[42]=[Object(a["createTextVNode"])("未完成")])),_:1}))]))),128)):(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",P,[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(G.value,e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:e.id,class:"member-item"},[Object(a["createElementVNode"])("span",null,Object(a["toDisplayString"])(e.name),1),De(e.userId)?(Object(a["openBlock"])(),Object(a["createBlock"])(l,{key:0,type:"primary",size:"small",onClick:t=>me(te.value.id,e.id)},{default:Object(a["withCtx"])(()=>t[38]||(t[38]=[Object(a["createTextVNode"])("完成")])),_:2},1032,["onClick"])):(Object(a["openBlock"])(),Object(a["createBlock"])(ue,{key:1,type:"info",size:"small"},{default:Object(a["withCtx"])(()=>t[39]||(t[39]=[Object(a["createTextVNode"])("未完成")])),_:1}))]))),128))]))])])):Object(a["createCommentVNode"])("",!0)]}),_:1},8,["modelValue"]),Object(a["createVNode"])(Se,{modelValue:ye.value,"onUpdate:modelValue":t[23]||(t[23]=e=>ye.value=e),title:"编辑任务",width:"420px",class:"modern-dialog"},{footer:Object(a["withCtx"])(()=>[Object(a["createVNode"])(l,{onClick:t[22]||(t[22]=e=>ye.value=!1)},{default:Object(a["withCtx"])(()=>t[46]||(t[46]=[Object(a["createTextVNode"])("取消")])),_:1}),Object(a["createVNode"])(l,{type:"primary",onClick:we},{default:Object(a["withCtx"])(()=>t[47]||(t[47]=[Object(a["createTextVNode"])("保存")])),_:1})]),default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Ae,{model:Ne.value,rules:de,ref_key:"editTaskFormRef",ref:ne,"label-width":"80px",class:"modern-form"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Te,{label:"任务名称",prop:"title",required:""},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(o,{modelValue:Ne.value.title,"onUpdate:modelValue":t[16]||(t[16]=e=>Ne.value.title=e),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(Te,{label:"优先级",prop:"priority",required:""},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{modelValue:Ne.value.priority,"onUpdate:modelValue":t[17]||(t[17]=e=>Ne.value.priority=e),placeholder:"请选择优先级"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(r,{label:"高",value:"高"}),Object(a["createVNode"])(r,{label:"中",value:"中"}),Object(a["createVNode"])(r,{label:"低",value:"低"})]),_:1},8,["modelValue"])]),_:1}),Object(a["createVNode"])(Te,{label:"截止日期",prop:"dueDate",required:""},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(Ie,{modelValue:Ne.value.dueDate,"onUpdate:modelValue":t[18]||(t[18]=e=>Ne.value.dueDate=e),"value-format":"YYYY-MM-DD",placeholder:"请选择截止日期"},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(Te,{label:"描述",prop:"description",required:""},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(o,{type:"textarea",modelValue:Ne.value.description,"onUpdate:modelValue":t[19]||(t[19]=e=>Ne.value.description=e),placeholder:"请输入任务描述"},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(Te,{label:"标签",prop:"tags",required:""},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(o,{modelValue:Ne.value.tags,"onUpdate:modelValue":t[20]||(t[20]=e=>Ne.value.tags=e),placeholder:"逗号分隔"},null,8,["modelValue"])]),_:1}),Object(a["createVNode"])(Te,{label:"状态",prop:"status",required:""},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(i,{modelValue:Ne.value.status,"onUpdate:modelValue":t[21]||(t[21]=e=>Ne.value.status=e),placeholder:"请选择状态"},{default:Object(a["withCtx"])(()=>[Object(a["createVNode"])(r,{label:"待处理",value:"todo"}),Object(a["createVNode"])(r,{label:"进行中",value:"in-progress"}),Object(a["createVNode"])(r,{label:"已完成",value:"done"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},K=(l("b73a"),l("bf8a"),l("6b0d")),Q=l.n(K);const X=Q()(G,[["__scopeId","data-v-e8f7f218"]]);t["default"]=X},f665:function(e,t,l){"use strict";var a=l("23e7"),c=l("c65b"),o=l("2266"),r=l("59ed"),i=l("825a"),n=l("46c4"),d=l("2a62"),s=l("f99f"),u=s("find",TypeError);a({target:"Iterator",proto:!0,real:!0,forced:u},{find:function(e){i(this);try{r(e)}catch(a){d(this,"throw",a)}if(u)return c(u,this,e);var t=n(this),l=0;return o(t,(function(t,a){if(e(t,l++))return a(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},fea9:function(e,t,l){}}]);
//# sourceMappingURL=chunk-7a60782c.8a2bf971.js.map