(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d7c0b38c"],{"13d5":function(e,t,a){"use strict";var c=a("23e7"),n=a("d58f").left,o=a("a640"),r=a("1212"),l=a("9adc"),i=!l&&r>79&&r<83,s=i||!o("reduce");c({target:"Array",proto:!0,forced:s},{reduce:function(e){var t=arguments.length;return n(this,e,t,t>1?arguments[1]:void 0)}})},"248f":function(e,t,a){"use strict";a.r(t);var c=a("7a23");const n={class:"company-container"},o={class:"card-header-flex"},r={class:"card-title"},l={class:"company-info"},i={class:"company-logo-section"},s={class:"company-logo"},d={key:0},u=["src"],b={class:"company-name"},m={key:0},p={class:"info-grid"},O={class:"info-item"},j={class:"info-value"},f={class:"info-item"},h={class:"info-value"},v={class:"info-item"},N={class:"info-value"},y={class:"info-item"},g={class:"info-value"},w=["href"],V={key:1},E={class:"info-item"},C={class:"info-value"},k={class:"card-row"},x={class:"card-header-flex"},_={class:"card-title"},D={class:"org-chart"},B={class:"org-node"},I={class:"card-header-flex"},S={class:"card-title"},z={class:"dept-name"};function R(e,t,a,R,$,L){const U=Object(c["resolveComponent"])("OfficeBuilding"),A=Object(c["resolveComponent"])("el-icon"),T=Object(c["resolveComponent"])("el-divider"),P=Object(c["resolveComponent"])("User"),F=Object(c["resolveComponent"])("Location"),W=Object(c["resolveComponent"])("Link"),G=Object(c["resolveComponent"])("Phone"),Z=Object(c["resolveComponent"])("el-card"),q=Object(c["resolveComponent"])("Connection"),J=Object(c["resolveComponent"])("Folder"),M=Object(c["resolveComponent"])("el-tag"),H=Object(c["resolveComponent"])("el-tree"),K=Object(c["resolveComponent"])("Grid"),Q=Object(c["resolveComponent"])("el-empty"),X=Object(c["resolveComponent"])("el-table-column"),Y=Object(c["resolveComponent"])("el-table");return Object(c["openBlock"])(),Object(c["createElementBlock"])("div",n,[Object(c["createVNode"])(Z,{class:"info-card",shadow:"hover"},{header:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",o,[Object(c["createElementVNode"])("div",r,[Object(c["createVNode"])(A,{class:"header-icon"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(U)]),_:1}),t[0]||(t[0]=Object(c["createElementVNode"])("span",null,"企业基本信息",-1))])])]),default:Object(c["withCtx"])(()=>{var e,a;return[Object(c["createElementVNode"])("div",l,[Object(c["createElementVNode"])("div",i,[Object(c["createElementVNode"])("div",s,[R.companyInfo.logo?(Object(c["openBlock"])(),Object(c["createElementBlock"])("img",{key:1,src:R.companyInfo.logo,alt:"公司logo"},null,8,u)):(Object(c["openBlock"])(),Object(c["createElementBlock"])("span",d,Object(c["toDisplayString"])((null===(e=R.companyInfo.shortName)||void 0===e?void 0:e.charAt(0))||(null===(a=R.companyInfo.fullName)||void 0===a?void 0:a.charAt(0))||"企"),1))]),Object(c["createElementVNode"])("div",b,[Object(c["createElementVNode"])("h2",null,Object(c["toDisplayString"])(R.companyInfo.fullName),1),R.companyInfo.shortName?(Object(c["openBlock"])(),Object(c["createElementBlock"])("p",m,Object(c["toDisplayString"])(R.companyInfo.shortName),1)):Object(c["createCommentVNode"])("",!0)])]),Object(c["createVNode"])(T),Object(c["createElementVNode"])("div",p,[Object(c["createElementVNode"])("div",O,[Object(c["createVNode"])(A,null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(U)]),_:1}),t[1]||(t[1]=Object(c["createElementVNode"])("span",{class:"info-label"},"所属行业:",-1)),Object(c["createElementVNode"])("span",j,Object(c["toDisplayString"])(R.companyInfo.industry||"未设置"),1)]),Object(c["createElementVNode"])("div",f,[Object(c["createVNode"])(A,null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(P)]),_:1}),t[2]||(t[2]=Object(c["createElementVNode"])("span",{class:"info-label"},"公司规模:",-1)),Object(c["createElementVNode"])("span",h,Object(c["toDisplayString"])(R.companyInfo.size||"未设置"),1)]),Object(c["createElementVNode"])("div",v,[Object(c["createVNode"])(A,null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(F)]),_:1}),t[3]||(t[3]=Object(c["createElementVNode"])("span",{class:"info-label"},"公司地址:",-1)),Object(c["createElementVNode"])("span",N,Object(c["toDisplayString"])(R.companyInfo.address||"未设置"),1)]),Object(c["createElementVNode"])("div",y,[Object(c["createVNode"])(A,null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(W)]),_:1}),t[4]||(t[4]=Object(c["createElementVNode"])("span",{class:"info-label"},"官方网站:",-1)),Object(c["createElementVNode"])("span",g,[R.companyInfo.website?(Object(c["openBlock"])(),Object(c["createElementBlock"])("a",{key:0,href:R.formatWebsiteUrl(R.companyInfo.website),target:"_blank"},Object(c["toDisplayString"])(R.companyInfo.website),9,w)):(Object(c["openBlock"])(),Object(c["createElementBlock"])("span",V,"未设置"))])]),Object(c["createElementVNode"])("div",E,[Object(c["createVNode"])(A,null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(G)]),_:1}),t[5]||(t[5]=Object(c["createElementVNode"])("span",{class:"info-label"},"联系电话:",-1)),Object(c["createElementVNode"])("span",C,Object(c["toDisplayString"])(R.companyInfo.phone||"未设置"),1)])])])]}),_:1}),Object(c["createElementVNode"])("div",k,[Object(c["createVNode"])(Z,{class:"org-card",shadow:"hover"},{header:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",x,[Object(c["createElementVNode"])("div",_,[Object(c["createVNode"])(A,{class:"header-icon"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(q)]),_:1}),t[6]||(t[6]=Object(c["createElementVNode"])("span",null,"组织架构",-1))])])]),default:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",D,[Object(c["createVNode"])(H,{data:R.orgStructure,props:R.defaultProps,"node-key":"id","default-expand-all":""},{default:Object(c["withCtx"])(({node:e,data:t})=>[Object(c["createElementVNode"])("div",B,[1===e.level?(Object(c["openBlock"])(),Object(c["createBlock"])(A,{key:0},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(U)]),_:1})):(Object(c["openBlock"])(),Object(c["createBlock"])(A,{key:1},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(J)]),_:1})),Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(e.label),1),Object(c["createVNode"])(M,{size:"small",type:"info",class:"org-count"},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])(Object(c["toDisplayString"])(t.count)+"人",1)]),_:2},1024)])]),_:1},8,["data","props"])])]),_:1}),Object(c["createVNode"])(Z,{class:"department-card",shadow:"hover"},{header:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("div",I,[Object(c["createElementVNode"])("div",S,[Object(c["createVNode"])(A,{class:"header-icon"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(K)]),_:1}),t[7]||(t[7]=Object(c["createElementVNode"])("span",null,"部门列表",-1))])])]),default:Object(c["withCtx"])(()=>[R.departments.length?(Object(c["openBlock"])(),Object(c["createBlock"])(Y,{key:1,data:R.departments,style:{width:"100%"},border:"",stripe:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(X,{prop:"name",label:"部门名称"},{default:Object(c["withCtx"])(e=>[Object(c["createElementVNode"])("div",z,[Object(c["createVNode"])(A,null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(J)]),_:1}),Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(e.row.name),1)])]),_:1}),Object(c["createVNode"])(X,{prop:"manager_name",label:"部门主管"},{default:Object(c["withCtx"])(e=>[Object(c["createElementVNode"])("span",null,Object(c["toDisplayString"])(e.row.manager_name||"未设置"),1)]),_:1}),Object(c["createVNode"])(X,{prop:"count",label:"人数",width:"80",align:"center"},{default:Object(c["withCtx"])(e=>[Object(c["createVNode"])(M,{size:"small",type:"info"},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.row.count)+"人",1)]),_:2},1024)]),_:1}),Object(c["createVNode"])(X,{prop:"createTime",label:"创建时间",width:"180"})]),_:1},8,["data"])):(Object(c["openBlock"])(),Object(c["createBlock"])(Q,{key:0,description:"暂无部门数据"}))]),_:1})])])}a("14d9"),a("13d5"),a("e9f5"),a("ab43"),a("9485");var $=a("5502"),L=a("6605"),U=a("f6f2"),A=a("3ef4"),T=a("c9a1"),P=a("fcac"),F={name:"Company",setup(){const e=Object(L["d"])(),t=Object($["b"])(),a=Object(c["computed"])(()=>t.getters["user/currentUser"]),n=Object(c["ref"])(null),o=Object(c["ref"])(null),r=Object(c["reactive"])({id:null,fullName:"",shortName:"",industry:"",size:"",address:"",website:"",phone:"",logo:""}),l=Object(c["reactive"])({id:null,fullName:"",shortName:"",industry:"",size:"",address:"",website:"",phone:""}),i=Object(c["ref"])(!1),s={fullName:[{required:!0,message:"请输入公司全称",trigger:"blur"},{min:2,max:100,message:"长度在2到100个字符之间",trigger:"blur"}],website:[{pattern:/^(https?:\/\/)?(www\.)?([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}(\/[a-zA-Z0-9-._~:/?#[\]@!$&'()*+,;=]*)?$/,message:"请输入合法的URL，例如: http://example.com",trigger:"blur"}]},d={name:[{required:!0,message:"请输入部门名称",trigger:"blur"},{min:2,max:50,message:"长度在2到50个字符之间",trigger:"blur"}]},u=Object(c["ref"])([]),b={children:"children",label:"label"},m=Object(c["ref"])([]),p=Object(c["ref"])([]),O=Object(c["ref"])([{value:"张总",label:"张总"},{value:"李经理",label:"李经理"},{value:"王经理",label:"王经理"},{value:"赵经理",label:"赵经理"},{value:"钱经理",label:"钱经理"},{value:"孙经理",label:"孙经理"},{value:"周经理",label:"周经理"}]),j=Object(c["ref"])(!1),f=Object(c["ref"])(!1),h=Object(c["reactive"])({id:null,name:"",manager:"",company:null,description:""}),v=async()=>{try{if(!a.value||!a.value.id)return A["a"].warning("请先登录"),void e.push("/login");const t=await Object(P["c"])();if(t&&t.success){const e=t.data,a=e.company;Object.assign(r,{id:a.id,fullName:a.name,shortName:a.short_name||"",industry:a.industry||"",size:a.size||"",address:a.address||"",website:a.website||"",phone:a.phone||""}),m.value=e.departments.map(e=>({id:e.id,name:e.name,manager_name:e.manager_name||"",count:e.count||0,createTime:new Date(e.created_at).toLocaleDateString("zh-CN")})),e.totalEmployeeCount=e.totalEmployeeCount||e.total_employee_count||0,N(e.departments,e.totalEmployeeCount),y(e.departments)}else A["a"].error("获取公司数据失败")}catch(t){console.error("获取公司数据失败:",t),A["a"].error("获取公司数据失败，请刷新重试")}},N=(e,t)=>{const a=e.reduce((e,t)=>e+(t.count||0),0),c=t?t-a:0,n=e.map(e=>({id:e.id,label:e.name,count:e.count||0}));c>0&&n.push({id:-1,label:"其它",count:c});const o={id:0,label:r.shortName||r.fullName,count:a+c,children:n};u.value=[o]},y=e=>{p.value=[{value:0,label:r.shortName||r.fullName,children:e.map(e=>({value:e.id,label:e.name}))}]},g=()=>{Object.assign(l,{id:r.id,fullName:r.fullName,shortName:r.shortName,industry:r.industry,size:r.size,address:r.address,website:r.website,phone:r.phone}),i.value=!0},w=async()=>{try{await o.value.validate();let e=l.website.trim();e&&!e.match(/^https?:\/\//)&&(e="http://"+e);const t={name:l.fullName,short_name:l.shortName,industry:l.industry,size:l.size,address:l.address,website:e,phone:l.phone};await Object(P["e"])(l.id,t),A["a"].success("企业信息更新成功"),i.value=!1,v()}catch(t){var e;if(console.error("更新企业信息失败:",t),null!==t&&void 0!==t&&null!==(e=t.response)&&void 0!==e&&e.data){const e=t.response.data,a=[];for(const t in e)Array.isArray(e[t])?a.push(`${t}: ${e[t].join(", ")}`):"string"===typeof e[t]&&a.push(`${t}: ${e[t]}`);a.length>0?A["a"].error(a.join("\n")):A["a"].error("更新企业信息失败，请检查输入内容")}else null!==t&&void 0!==t&&t.message?A["a"].error(t.message):A["a"].error("更新企业信息失败，请稍后重试")}},V=()=>{f.value=!1,Object.assign(h,{id:null,name:"",manager:"",company:r.id,description:""}),j.value=!0},E=e=>{f.value=!0,Object.assign(h,{id:e.id,name:e.name,manager:e.manager,company:r.id,description:""}),j.value=!0},C=e=>{T["a"].confirm(`确定要删除部门"${e.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Object(P["b"])(e.id),A["a"].success(`删除部门: ${e.name} 成功`),v()}catch(t){console.error("删除部门失败:",t),A["a"].error("删除部门失败，请稍后重试")}}).catch(()=>{})},k=async()=>{try{await n.value.validate();const e={name:h.name,company:h.company,manager:h.manager,description:h.description};f.value?(await Object(P["f"])(h.id,e),A["a"].success(`更新部门: ${h.name} 成功`)):(await Object(P["a"])(e),A["a"].success(`新增部门: ${h.name} 成功`)),j.value=!1,v()}catch(e){console.error("保存部门失败:",e),null!==e&&void 0!==e&&e.message?A["a"].error(e.message):A["a"].error("保存部门失败，请稍后重试")}},x=e=>e&&!e.match(/^https?:\/\//)?"http://"+e:e;return Object(c["onMounted"])(()=>{v()}),{companyInfo:r,editingCompanyInfo:l,companyDialogVisible:i,companyFormRef:o,companyRules:s,orgStructure:u,defaultProps:b,departments:m,departmentOptions:p,managers:O,departmentDialogVisible:j,isEdit:f,currentDepartment:h,departmentFormRef:n,departmentRules:d,editCompanyInfo:g,saveCompanyInfo:w,addDepartment:V,editDepartment:E,deleteDepartment:C,saveDepartment:k,formatWebsiteUrl:x,Edit:U["Edit"],Plus:U["Plus"],Delete:U["Delete"],OfficeBuilding:U["OfficeBuilding"],User:U["User"],Location:U["Location"],Link:U["Link"],Phone:U["Phone"],Connection:U["Connection"],Grid:U["Grid"],Folder:U["Folder"]}}},W=(a("fbbf"),a("6b0d")),G=a.n(W);const Z=G()(F,[["render",R],["__scopeId","data-v-22bc7c26"]]);t["default"]=Z},8558:function(e,t,a){"use strict";var c=a("cfe9"),n=a("b5db"),o=a("c6b6"),r=function(e){return n.slice(0,e.length)===e};e.exports=function(){return r("Bun/")?"BUN":r("Cloudflare-Workers")?"CLOUDFLARE":r("Deno/")?"DENO":r("Node.js/")?"NODE":c.Bun&&"string"==typeof Bun.version?"BUN":c.Deno&&"object"==typeof Deno.version?"DENO":"process"===o(c.process)?"NODE":c.window&&c.document?"BROWSER":"REST"}()},9485:function(e,t,a){"use strict";var c=a("23e7"),n=a("2266"),o=a("59ed"),r=a("825a"),l=a("46c4"),i=a("2a62"),s=a("f99f"),d=a("2ba4"),u=a("d039"),b=TypeError,m=u((function(){[].keys().reduce((function(){}),void 0)})),p=!m&&s("reduce",b);c({target:"Iterator",proto:!0,real:!0,forced:m||p},{reduce:function(e){r(this);try{o(e)}catch(u){i(this,"throw",u)}var t=arguments.length<2,a=t?void 0:arguments[1];if(p)return d(p,this,t?[e]:[e,a]);var c=l(this),s=0;if(n(c,(function(c){t?(t=!1,a=c):a=e(a,c,s),s++}),{IS_RECORD:!0}),t)throw new b("Reduce of empty iterator with no initial value");return a}})},"9adc":function(e,t,a){"use strict";var c=a("8558");e.exports="NODE"===c},a640:function(e,t,a){"use strict";var c=a("d039");e.exports=function(e,t){var a=[][e];return!!a&&c((function(){a.call(null,t||function(){return 1},1)}))}},d58f:function(e,t,a){"use strict";var c=a("59ed"),n=a("7b0b"),o=a("44ad"),r=a("07fa"),l=TypeError,i="Reduce of empty array with no initial value",s=function(e){return function(t,a,s,d){var u=n(t),b=o(u),m=r(u);if(c(a),0===m&&s<2)throw new l(i);var p=e?m-1:0,O=e?-1:1;if(s<2)while(1){if(p in b){d=b[p],p+=O;break}if(p+=O,e?p<0:m<=p)throw new l(i)}for(;e?p>=0:m>p;p+=O)p in b&&(d=a(d,b[p],p,u));return d}};e.exports={left:s(!1),right:s(!0)}},f1d8:function(e,t,a){},fbbf:function(e,t,a){"use strict";a("f1d8")},fcac:function(e,t,a){"use strict";a.d(t,"d",(function(){return n})),a.d(t,"e",(function(){return o})),a.d(t,"a",(function(){return r})),a.d(t,"f",(function(){return l})),a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return s}));var c=a("b775");function n(){return Object(c["a"])({url:"/api/auth/companies/simple_list/",method:"get",auth:!1})}function o(e,t){return Object(c["a"])({url:`/api/auth/companies/${e}/`,method:"put",data:t})}function r(e){return Object(c["a"])({url:"/api/auth/departments/",method:"post",data:e})}function l(e,t){return Object(c["a"])({url:`/api/auth/departments/${e}/`,method:"put",data:t})}function i(e){return Object(c["a"])({url:`/api/auth/departments/${e}/`,method:"delete"})}function s(){return Object(c["a"])({url:"/api/auth/companies/current_user_company/",method:"get"})}}}]);
//# sourceMappingURL=chunk-d7c0b38c.4d7ac8e4.js.map