{"version":3,"sources":["webpack:///./src/views/project/Index.vue","webpack:///./src/views/project/Index.vue?738d","webpack:///./node_modules/core-js/modules/es.iterator.filter.js","webpack:///./src/views/project/Index.vue?c1ee","webpack:///./node_modules/core-js/modules/es.iterator.find.js"],"names":["router","useRouter","store","useStore","searchText","ref","projects","activeProjectIdx","showNewProject","newProject","name","desc","start","end","members","memberOptions","isNavCollapsed","currentPage","pageSize","total","projectFormRef","formRules","required","message","trigger","fetchProjects","console","log","request","get","params","page","value","page_size","then","res","data","Array","isArray","results","count","length","forEach","project","status","statusText","statusClass","catch","err","_err$response","_err$response2","_err$response2$data","error","response","alert","detail","getCompanyIdFromUser","user","company_id","company","isNaN","Number","fetchMembers","companyId","warn","token","localStorage","getItem","arr","map","u","id","label","username","_err$response3","_err$response4","ensureUserCompany","getters","onMounted","userStr","push","JSON","parse","e","filteredProjects","computed","keyword","toLowerCase","filter","p","includes","formatDate","dateStr","date","Date","getFullYear","String","getMonth","padStart","getDate","selectProject","idx","goToProjectDetail","handleCommand","command","projectId","find","ElMessageBox","confirm","confirmButtonText","cancelButtonText","type","delete","addProject","validate","valid","ElMessage","formatDateStr","val","test","d","projectData","put","_err$response5","_err$response6","_err$response6$data","post","_err$response7","_err$response8","_err$response8$data","handlePageChange","watch","__exports__","$","call","aCallable","anObject","getIteratorDirect","createIteratorProxy","callWithSafeIterationClosing","IS_PURE","iteratorClose","iteratorHelperWithoutClosingOnEarlyError","filterWithoutClosingOnEarlyError","TypeError","IteratorProxy","result","done","iterator","this","predicate","next","counter","target","proto","real","forced","iterate","findWithoutClosingOnEarlyError","record","stop","IS_RECORD","INTERRUPTED"],"mappings":"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","file":"js/chunk-2f1268ca.8b0bb7d4.js","sourcesContent":["<template>\n  <div class=\"container-fluid\">\n    <div class=\"row\">\n      <!-- 左侧项目导航 -->\n      <div :class=\"['project-sidebar', isNavCollapsed ? 'collapsed' : '']\">\n        <div class=\"card\">\n          <div class=\"card-header\">\n            <span v-if=\"!isNavCollapsed\">我的项目</span>\n            <div class=\"header-actions\">\n              <button v-if=\"!isNavCollapsed\" class=\"btn btn-sm btn-primary\" @click=\"showNewProject = true\">\n                <i class=\"bi bi-plus\"></i> 新建\n              </button>\n              <button class=\"btn btn-sm btn-icon\" @click=\"isNavCollapsed = !isNavCollapsed\">\n                <i :class=\"['bi', isNavCollapsed ? 'bi-chevron-double-right' : 'bi-chevron-double-left']\"></i>\n              </button>\n            </div>\n          </div>\n          <div class=\"card-body p-0\">\n            <div v-if=\"filteredProjects.length === 0\" class=\"empty-state-nav\">\n              <el-icon style=\"font-size:40px;color:#d3d3d3;margin-bottom:10px;\"><FolderOpened /></el-icon>\n              <div class=\"empty-title-nav\">暂无项目</div>\n            </div>\n            <div v-else class=\"project-nav\">\n              <div v-for=\"(project, idx) in projects\" :key=\"project.id\" class=\"project-item\" :class=\"{active: idx === activeProjectIdx}\" @click=\"selectProject(idx)\" :title=\"project.name\">\n                <i class=\"bi bi-kanban\"></i>\n                <span class=\"project-name\">{{ project.name }}</span>\n                <span class=\"badge\" :class=\"project.statusClass\">{{ project.statusText }}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <!-- 右侧内容区域 -->\n      <div :class=\"['project-main-content', isNavCollapsed ? 'expanded' : '']\">\n        <div class=\"card\">\n          <div class=\"card-header\">\n            <span>项目列表</span>\n            <div class=\"search-box\">\n              <el-input v-model=\"searchText\" placeholder=\"搜索项目...\" prefix-icon=\"Search\" clearable />\n            </div>\n          </div>\n          <div class=\"card-body\">\n            <div v-if=\"filteredProjects.length === 0\" class=\"empty-state\">\n              <el-icon style=\"font-size:120px;color:#d3d3d3;margin-bottom:16px;\"><FolderOpened /></el-icon>\n              <div class=\"empty-title\">暂无项目</div>\n              <div class=\"empty-desc\">您还没有任何项目，点击右上角\"新建\"按钮添加您的第一个项目吧！</div>\n            </div>\n            <div v-else class=\"row\">\n              <div v-for=\"project in filteredProjects\" :key=\"project.id\" class=\"col-md-6 mb-4\">\n                <div class=\"project-card\">\n                  <div class=\"project-card-header\">\n                    <h5>{{ project.name }}</h5>\n                    <span class=\"badge\" :class=\"project.statusClass\">{{ project.statusText }}</span>\n                  </div>\n                  <div class=\"project-card-body\">\n                    <p>{{ project.desc || '暂无描述' }}</p>\n                    <div class=\"project-card-stats\">\n                      <div class=\"stat-item\">\n                        <i class=\"bi bi-calendar\"></i>\n                        <span>{{ project.start ? formatDate(project.start) : '未设置' }}</span>\n                      </div>\n                      <div class=\"stat-item\">\n                        <i class=\"bi bi-people\"></i>\n                        <span>{{ project.members ? project.members.length : 0 }}人</span>\n                      </div>\n                    </div>\n                  </div>\n                  <div class=\"project-card-footer\">\n                    <el-button type=\"primary\" size=\"small\" @click=\"goToProjectDetail(project.id)\">查看详情</el-button>\n                    <el-dropdown @command=\"handleCommand($event, project.id)\" trigger=\"click\">\n                      <el-button size=\"small\" plain>\n                        <i class=\"bi bi-three-dots\"></i>\n                      </el-button>\n                      <template #dropdown>\n                        <el-dropdown-menu>\n                          <el-dropdown-item command=\"edit\">编辑项目</el-dropdown-item>\n                          <el-dropdown-item command=\"delete\" divided>删除项目</el-dropdown-item>\n                        </el-dropdown-menu>\n                      </template>\n                    </el-dropdown>\n                  </div>\n                </div>\n              </div>\n            </div>\n            \n            <!-- 分页组件 -->\n            <div class=\"pagination-container\" v-if=\"total > 0\">\n              <el-pagination\n                background\n                layout=\"prev, pager, next\"\n                :total=\"total\"\n                :page-size=\"pageSize\"\n                :current-page=\"currentPage\"\n                @current-change=\"handlePageChange\"\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!-- 新建/编辑项目弹窗 -->\n    <el-dialog v-model=\"showNewProject\" :title=\"newProject.id ? '编辑项目' : '新建项目'\" width=\"500px\">\n      <el-form :model=\"newProject\" label-width=\"80px\" :rules=\"formRules\" ref=\"projectFormRef\">\n        <el-form-item label=\"项目名称\" prop=\"name\" required>\n          <el-input v-model=\"newProject.name\" placeholder=\"请输入项目名称\" />\n        </el-form-item>\n        <el-form-item label=\"项目描述\" prop=\"desc\" required>\n          <el-input v-model=\"newProject.desc\" type=\"textarea\" placeholder=\"请输入项目描述\" />\n        </el-form-item>\n        <el-form-item label=\"开始日期\" prop=\"start\" required>\n          <el-date-picker v-model=\"newProject.start\" placeholder=\"请选择开始日期\" />\n        </el-form-item>\n        <el-form-item label=\"结束日期\" prop=\"end\" required>\n          <el-date-picker v-model=\"newProject.end\" placeholder=\"请选择结束日期\" />\n        </el-form-item>\n        <el-form-item label=\"项目成员\" prop=\"members\" required>\n          <el-select v-model=\"newProject.members\" multiple placeholder=\"请选择项目成员\">\n            <el-option v-for=\"m in memberOptions\" :key=\"m.value\" :label=\"m.label\" :value=\"m.value\" />\n          </el-select>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <el-button @click=\"showNewProject=false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"addProject\">{{ newProject.id ? '保存' : '创建' }}</el-button>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script setup>\nimport { ref, computed, onMounted, watch } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useStore } from 'vuex'\nimport { FolderOpened } from '@element-plus/icons-vue'\nimport { ElMessageBox, ElMessage } from 'element-plus'\nimport request from '@/utils/request'\n\nconst router = useRouter()\nconst store = useStore()\nconst searchText = ref('')\nconst projects = ref([])\nconst activeProjectIdx = ref(0)\nconst showNewProject = ref(false)\nconst newProject = ref({ name: '', desc: '', start: '', end: '', members: [] })\nconst memberOptions = ref([])\nconst isNavCollapsed = ref(false)\nconst currentPage = ref(1)\nconst pageSize = ref(10)\nconst total = ref(0)\n\n// 表单引用\nconst projectFormRef = ref(null)\n\n// 表单验证规则\nconst formRules = {\n  name: [\n    { required: true, message: '请输入项目名称', trigger: 'blur' }\n  ],\n  desc: [\n    { required: true, message: '请输入项目描述', trigger: 'blur' }\n  ],\n  start: [\n    { required: true, message: '请选择开始日期', trigger: 'change' }\n  ],\n  end: [\n    { required: true, message: '请选择结束日期', trigger: 'change' }\n  ],\n  members: [\n    { required: true, message: '请选择项目成员', trigger: 'change' }\n  ]\n}\n\nfunction fetchProjects() {\n  console.log('fetchProjects: 开始请求项目列表')\n  request.get('/api/projects/', {\n    params: {\n      page: currentPage.value,\n      page_size: pageSize.value\n    }\n  }).then(res => {\n    console.log('fetchProjects: 获取成功', res.data)\n    \n    // 处理后端返回的分页数据\n    if (res.data && Array.isArray(res.data.results)) {\n      projects.value = res.data.results || []\n      total.value = res.data.count || 0\n    } else {\n      // 兼容不支持分页的旧接口\n      projects.value = res.data || []\n      total.value = projects.value.length\n    }\n    \n    // 为每个项目添加状态文本和样式\n    projects.value.forEach(project => {\n      if (project.status === 'doing') {\n        project.statusText = '进行中'\n        project.statusClass = 'bg-primary text-white'\n      } else if (project.status === 'done') {\n        project.statusText = '已完成'\n        project.statusClass = 'bg-success text-white'\n      } else {\n        project.statusText = project.status || '未知'\n        project.statusClass = 'bg-secondary text-white'\n      }\n    })\n  }).catch(err => {\n    console.error('fetchProjects: 请求失败', err?.response?.data || err)\n    alert('获取项目列表失败: ' + (err?.response?.data?.detail || '请检查权限或网络连接'))\n  })\n}\n\nfunction getCompanyIdFromUser(user) {\n  if (!user) return null\n  if (typeof user.company_id === 'number') return user.company_id\n  if (typeof user.company === 'number') return user.company\n  // 兼容后端返回字符串数字\n  if (!isNaN(user.company_id)) return Number(user.company_id)\n  if (!isNaN(user.company)) return Number(user.company)\n  return null\n}\n\nfunction fetchMembers(companyId) {\n  companyId = Number(companyId)\n  if (!companyId || isNaN(companyId)) {\n    console.warn('fetchMembers: companyId无效', companyId)\n    return\n  }\n  const token = localStorage.getItem('token')\n  if (!token) {\n    alert('未检测到登录凭证，请重新登录！')\n    memberOptions.value = []\n    return\n  }\n  console.log('fetchMembers: companyId=', companyId, 'token=', token)\n  request.get(`/api/auth/companies/${companyId}/users/`).then(res => {\n    let arr = []\n    if (Array.isArray(res.data)) {\n      arr = res.data\n    } else if (res.data && Array.isArray(res.data.data)) {\n      arr = res.data.data\n    } else {\n      console.error('fetchMembers: 返回数据不是数组', res.data)\n    }\n    memberOptions.value = arr.map(u => ({\n      value: u.id,\n      label: u.name || u.username\n    }))\n  }).catch(err => {\n    if (err?.response?.status === 403) {\n      alert('无权限访问公司成员接口，请重新登录或联系管理员！')\n    } else {\n      alert('获取公司成员失败，请检查网络或联系管理员！')\n    }\n    console.error('fetchMembers: 请求出错', err, err?.response?.data)\n    memberOptions.value = []\n  })\n}\n\n/**\n * 确保当前用户关联了公司\n */\nfunction ensureUserCompany() {\n  const user = store.getters.user\n  \n  if (!user) {\n    console.warn('未找到用户信息')\n    return null\n  }\n  \n  // 检查用户是否有公司信息\n  const companyId = getCompanyIdFromUser(user)\n  \n  if (!companyId) {\n    console.warn('用户未关联公司')\n    return null\n  }\n  \n  return companyId\n}\n\nonMounted(() => {\n  console.log('项目页面挂载')\n  const token = localStorage.getItem('token')\n  const userStr = localStorage.getItem('user')\n  \n  if (!token) {\n    console.warn('未找到token，请确保已登录')\n    router.push('/login')\n    return\n  }\n  \n  if (userStr) {\n    try {\n      const user = JSON.parse(userStr)\n      console.log('当前用户信息:', user)\n      console.log('用户公司ID:', getCompanyIdFromUser(user))\n      \n      // 检查用户公司\n      const companyId = ensureUserCompany()\n      if (!companyId) {\n        alert('您未关联到任何公司，无法访问项目管理页面')\n      }\n    } catch(e) {\n      console.error('解析用户信息失败', e)\n    }\n  }\n  \n  // 获取项目列表\n  fetchProjects()\n})\n\nconst filteredProjects = computed(() => {\n  // 注意：当使用后端分页时，搜索应该由后端处理\n  // 这里仅作为前端过滤的备用方案\n  if (!searchText.value) return projects.value\n  const keyword = searchText.value.toLowerCase()\n  return projects.value.filter(p =>\n    (p.name && p.name.toLowerCase().includes(keyword)) ||\n    (p.desc && p.desc.toLowerCase().includes(keyword))\n  )\n})\n\nfunction formatDate(dateStr) {\n  if (!dateStr) return '未设置'\n  const date = new Date(dateStr)\n  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`\n}\n\nfunction selectProject(idx) {\n  activeProjectIdx.value = idx\n}\n\nfunction goToProjectDetail(id) {\n  router.push({ name: 'ProjectDetail', params: { id } })\n}\n\nfunction handleCommand(command, projectId) {\n  if (command === 'edit') {\n    const project = projects.value.find(p => p.id === projectId)\n    if (project) {\n      newProject.value = { ...project }\n      showNewProject.value = true\n      fetchMembers(project.company) // 拉取公司成员\n    }\n  } else if (command === 'delete') {\n    ElMessageBox.confirm('确定要删除该项目吗？', '提示', {\n      confirmButtonText: '确定',\n      cancelButtonText: '取消',\n      type: 'warning'\n    }).then(() => {\n      request.delete(`/api/projects/${projectId}/`).then(() => {\n        fetchProjects()\n      })\n    }).catch(() => {})\n  }\n}\n\nfunction addProject() {\n  // 使用表单验证\n  if (!projectFormRef.value) {\n    console.error('表单引用不存在')\n    return\n  }\n\n  projectFormRef.value.validate((valid) => {\n    if (!valid) {\n      ElMessage.error('请填写所有必填项')\n      return\n    }\n\n    // 校验开始时间不能大于结束时间\n    if (newProject.value.start && newProject.value.end) {\n      if (new Date(newProject.value.start) > new Date(newProject.value.end)) {\n        ElMessage.error('项目开始时间不能大于结束时间')\n        return\n      }\n    }\n\n    const user = store.getters.user\n    const companyId = getCompanyIdFromUser(user)\n    if (!companyId) {\n      alert('您没有关联到任何公司，无法创建项目')\n      return\n    }\n    // 日期格式化\n    function formatDateStr(val) {\n      if (!val) return null  // 将空字符串改为null，避免空字符串验证错误\n      if (typeof val === 'string' && /^\\d{4}-\\d{2}-\\d{2}$/.test(val)) return val\n      const d = new Date(val)\n      if (isNaN(d)) return null  // 无效日期返回null而不是空字符串\n      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`\n    }\n    const projectData = {\n      ...newProject.value,\n      company_id: companyId, // 确保company_id字段存在\n      start: formatDateStr(newProject.value.start),\n      end: formatDateStr(newProject.value.end)\n    }\n    delete projectData.company // 防御性删除\n    delete projectData.companyId\n    console.log('准备保存的项目数据:', projectData)\n    if (newProject.value.id) {\n      request.put(`/api/projects/${newProject.value.id}/`, projectData)\n        .then((res) => {\n          console.log('项目更新成功:', res.data)\n          showNewProject.value = false\n          fetchProjects()\n        })\n        .catch(err => {\n          console.error('编辑项目失败', err?.response?.data || err)\n          alert('编辑项目失败: ' + (err?.response?.data?.detail || '请检查权限或网络连接'))\n        })\n    } else {\n      request.post('/api/projects/', projectData)\n        .then((res) => {\n          console.log('项目创建成功:', res.data)\n          showNewProject.value = false\n          fetchProjects()\n        })\n        .catch(err => {\n          console.error('创建项目失败', err?.response?.data || err)\n          alert('创建项目失败: ' + (err?.response?.data?.detail || '请检查权限或网络连接'))\n        })\n    }\n    newProject.value = { name: '', desc: '', start: '', end: '', members: [] }\n  })\n}\n\n// 新建项目弹窗打开时自动拉取公司成员，并自动回填已选成员\nwatch(showNewProject, (val) => {\n  if (val) {\n    const user = store.getters.user\n    const companyId = getCompanyIdFromUser(user)\n    if (companyId) fetchMembers(companyId)\n    // 编辑时自动回填成员\n    if (newProject.value.id && Array.isArray(newProject.value.members)) {\n      newProject.value.members = [...newProject.value.members]\n    } else {\n      newProject.value.members = []\n    }\n  }\n})\n\n// 添加分页处理函数\nfunction handlePageChange(page) {\n  currentPage.value = page\n  fetchProjects()\n}\n</script>\n\n<style scoped>\n@import url('https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css');\n@import url('https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css');\n.container-fluid { background: var(--bg-color); min-height: 100vh; }\n.card { border: none; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.05); margin-bottom: 20px; background: var(--bg-color-secondary); }\n.card-header { background-color: var(--bg-color); border-bottom: 1px solid var(--border-color); padding: 15px 20px; font-weight: 600; font-size: 16px; color: var(--text-color); display: flex; justify-content: space-between; align-items: center; }\n.card-body { padding: 20px; }\n.btn-primary { background-color: var(--primary-color); border-color: var(--primary-color); }\n.project-nav { height: 620px; overflow-y: auto; }\n.project-item { display: flex; align-items: center; padding: 12px 15px; color: var(--text-color-secondary); text-decoration: none; transition: all 0.2s; cursor: pointer; border-radius: 5px; margin-bottom: 5px; }\n.project-item:hover {\n  background: var(--hover-color);\n  color: var(--primary-color);\n}\n.project-item.active { background-color: var(--active-color); color: var(--primary-color); font-weight: 500; }\n.project-item i { margin-right: 10px; font-size: 18px; width: 24px; text-align: center; }\n.project-item .badge { margin-left: auto; background-color: var(--border-color); font-weight: 500; padding: 4px 8px; border-radius: 10px; color: var(--text-color); }\n.bg-primary { background: var(--primary-color)!important; }\n.bg-success { background: var(--success-color)!important; }\n.bg-warning { background: var(--warning-color)!important; }\n.bg-secondary { background: var(--border-color)!important; }\n.bg-info { background: var(--info-color)!important; }\n.text-white { color: #fff!important; }\n.empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 300px;\n  color: var(--text-color-tertiary);\n  background: var(--bg-color);\n  border-radius: 8px;\n}\n.empty-title {\n  font-size: 20px;\n  font-weight: 600;\n  margin-bottom: 8px;\n  color: var(--text-color-secondary);\n}\n.empty-desc {\n  font-size: 15px;\n  color: var(--text-color-tertiary);\n}\n.empty-state-nav {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 200px;\n  color: var(--text-color-tertiary);\n  background: var(--bg-color);\n  border-radius: 8px;\n}\n.empty-title-nav {\n  font-size: 16px;\n  font-weight: 500;\n  color: var(--text-color-tertiary);\n  margin-bottom: 8px;\n}\n\n/* 左侧项目导航栏缩放样式 */\n.project-sidebar {\n  width: 25%; /* 对应 col-md-3 */\n  transition: width 0.3s ease;\n  flex-shrink: 0;\n}\n\n.project-sidebar.collapsed {\n  width: 80px;\n}\n\n.project-sidebar.collapsed .project-name,\n.project-sidebar.collapsed .badge {\n  display: none;\n}\n\n.project-sidebar.collapsed .project-item {\n  justify-content: center;\n}\n\n.project-sidebar .card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.project-sidebar .header-actions {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.btn-icon {\n  background: transparent;\n  border: none;\n  color: #6c757d;\n}\n\n.project-name {\n  flex-grow: 1;\n  margin-left: 10px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n\n/* 右侧内容区域响应式样式 */\n.project-main-content {\n  width: 75%; /* 对应 col-md-9 */\n  transition: width 0.3s ease;\n}\n\n.project-main-content.expanded {\n  width: calc(100% - 80px);\n}\n\n/* 分页容器样式 */\n.pagination-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 20px;\n  padding-top: 20px;\n  border-top: 1px solid var(--border-color);\n}\n\n.search-box { width: 250px; }\n.project-card { background: var(--bg-color); border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); padding: 20px; height: 100%; cursor: pointer; transition: all 0.2s; }\n.project-card:hover {\n  background: var(--hover-color);\n  box-shadow: 0 5px 15px rgba(0,0,0,0.18);\n}\n.project-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }\n.project-card-header h5 { margin: 0; font-size: 18px; font-weight: 600; color: var(--text-color); }\n.project-card-body { margin-bottom: 15px; }\n.project-card-body p { color: var(--text-color-secondary); margin-bottom: 15px; }\n.project-card-stats { display: flex; gap: 15px; margin-bottom: 15px; }\n.stat-item { display: flex; align-items: center; color: var(--text-color-tertiary); font-size: 14px; }\n.stat-item i { margin-right: 5px; }\n.project-card-footer { display: flex; justify-content: space-between; }\n</style> ","import script from \"./Index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Index.vue?vue&type=style&index=0&id=3167b32f&scoped=true&lang=css\"\n\nimport exportComponent from \"C:\\\\Users\\\\18083\\\\Desktop\\\\CCIT\\\\office\\\\smart-office\\\\frontend\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-3167b32f\"]])\n\nexport default __exports__","'use strict';\nvar $ = require('../internals/export');\nvar call = require('../internals/function-call');\nvar aCallable = require('../internals/a-callable');\nvar anObject = require('../internals/an-object');\nvar getIteratorDirect = require('../internals/get-iterator-direct');\nvar createIteratorProxy = require('../internals/iterator-create-proxy');\nvar callWithSafeIterationClosing = require('../internals/call-with-safe-iteration-closing');\nvar IS_PURE = require('../internals/is-pure');\nvar iteratorClose = require('../internals/iterator-close');\nvar iteratorHelperWithoutClosingOnEarlyError = require('../internals/iterator-helper-without-closing-on-early-error');\n\nvar filterWithoutClosingOnEarlyError = !IS_PURE && iteratorHelperWithoutClosingOnEarlyError('filter', TypeError);\n\nvar IteratorProxy = createIteratorProxy(function () {\n  var iterator = this.iterator;\n  var predicate = this.predicate;\n  var next = this.next;\n  var result, done, value;\n  while (true) {\n    result = anObject(call(next, iterator));\n    done = this.done = !!result.done;\n    if (done) return;\n    value = result.value;\n    if (callWithSafeIterationClosing(iterator, predicate, [value, this.counter++], true)) return value;\n  }\n});\n\n// `Iterator.prototype.filter` method\n// https://tc39.es/ecma262/#sec-iterator.prototype.filter\n$({ target: 'Iterator', proto: true, real: true, forced: IS_PURE || filterWithoutClosingOnEarlyError }, {\n  filter: function filter(predicate) {\n    anObject(this);\n    try {\n      aCallable(predicate);\n    } catch (error) {\n      iteratorClose(this, 'throw', error);\n    }\n\n    if (filterWithoutClosingOnEarlyError) return call(filterWithoutClosingOnEarlyError, this, predicate);\n\n    return new IteratorProxy(getIteratorDirect(this), {\n      predicate: predicate\n    });\n  }\n});\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./Index.vue?vue&type=style&index=0&id=3167b32f&scoped=true&lang=css\"","'use strict';\nvar $ = require('../internals/export');\nvar call = require('../internals/function-call');\nvar iterate = require('../internals/iterate');\nvar aCallable = require('../internals/a-callable');\nvar anObject = require('../internals/an-object');\nvar getIteratorDirect = require('../internals/get-iterator-direct');\nvar iteratorClose = require('../internals/iterator-close');\nvar iteratorHelperWithoutClosingOnEarlyError = require('../internals/iterator-helper-without-closing-on-early-error');\n\nvar findWithoutClosingOnEarlyError = iteratorHelperWithoutClosingOnEarlyError('find', TypeError);\n\n// `Iterator.prototype.find` method\n// https://tc39.es/ecma262/#sec-iterator.prototype.find\n$({ target: 'Iterator', proto: true, real: true, forced: findWithoutClosingOnEarlyError }, {\n  find: function find(predicate) {\n    anObject(this);\n    try {\n      aCallable(predicate);\n    } catch (error) {\n      iteratorClose(this, 'throw', error);\n    }\n\n    if (findWithoutClosingOnEarlyError) return call(findWithoutClosingOnEarlyError, this, predicate);\n\n    var record = getIteratorDirect(this);\n    var counter = 0;\n    return iterate(record, function (value, stop) {\n      if (predicate(value, counter++)) return stop(value);\n    }, { IS_RECORD: true, INTERRUPTED: true }).result;\n  }\n});\n"],"sourceRoot":""}