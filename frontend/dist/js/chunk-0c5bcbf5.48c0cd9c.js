(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0c5bcbf5"],{1147:function(e,t,o){"use strict";function n(e){return null!=e&&"object"==typeof e}t["a"]=n},2332:function(e,t,o){"use strict";function n(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}t["a"]=n},"26ee":function(e,t,o){"use strict";var n=o("5ea3"),l="object"==typeof self&&self&&self.Object===Object&&self,c=n["a"]||l||Function("return this")();t["a"]=c},"271a":function(e,t,o){"use strict";var n=o("cb2d"),l=o("e330"),c=o("577e"),a=o("d6d6"),i=URLSearchParams,s=i.prototype,r=l(s.getAll),d=l(s.has),u=new i("a=1");!u.has("a",2)&&u.has("a",void 0)||n(s,"has",(function(e){var t=arguments.length,o=t<2?void 0:arguments[1];if(t&&void 0===o)return d(this,e);var n=r(this,e);a(t,1);var l=c(o),i=0;while(i<n.length)if(n[i++]===l)return!0;return!1}),{enumerable:!0,unsafe:!0})},"2d51":function(e,t,o){"use strict";o("3590")},3496:function(e,t,o){"use strict";o.r(t);var n=o("7a23");const l={class:"contract-detail-container"},c={class:"top-navigation-bar"},a={class:"card"},i={class:"card-header d-flex justify-content-between align-items-center"},s={id:"contractTitleHeader"},r={class:"card-body"},d={key:0},u={class:"row mb-3"},g={class:"col-md-6"},b={class:"col-md-6"},m={key:1},p={class:"d-flex justify-content-between align-items-center mb-2"},h={class:"d-flex align-items-center"},j={key:0,class:"d-flex align-items-center"},O={class:"contract-edit-wrapper"},v={class:"contract-edit-container",ref:"contractEditContainer"},f={class:"ai-polish-sidebar",ref:"aiPolishSidebar"},y={class:"ai-polish-button-content"},V={class:"ai-polish-info"},N={key:0,class:"time-estimate"},x={class:"shortcut-hint"},k={class:"ai-polish-personalization"},w={class:"personalization-section"},C={class:"section-header"},E={class:"preference-option"},T={class:"preference-option"},_={class:"personalization-section"},D={class:"section-header"},S={class:"optimization-options"},A={class:"personalization-section"},I={class:"section-header"},B={class:"terminology-manager"},L={key:0,class:"terminology-list"},P={key:1,class:"terminology-empty"},q={class:"ai-polish-features"},$={class:"feature-item"},z={class:"feature-item"},R={class:"feature-item"},Q={class:"feature-item"},M={class:"editor-main-area",ref:"editorMainArea"},U={key:2},F={class:"contract-edit-wrapper"},Y={class:"contract-edit-container",ref:"contractCheckContainer"},J={class:"ai-polish-sidebar check-sidebar",ref:"checkSidebar"},H={class:"ai-polish-button-content"},W={class:"ai-polish-info"},K={key:0,class:"time-estimate"},X={class:"shortcut-hint"},G={class:"ai-polish-personalization"},Z={class:"personalization-section"},ee={class:"section-header"},te={class:"check-options"},oe={class:"personalization-section"},ne={class:"section-header"},le={class:"preference-option"},ce={class:"personalization-section"},ae={class:"section-header"},ie={class:"preference-option"},se={class:"ai-polish-features"},re={class:"feature-item"},de={class:"feature-item"},ue={class:"feature-item"},ge={class:"feature-item"},be={class:"editor-main-area check-result-area",ref:"checkResultArea"},me={class:"check-content-inner",style:{padding:"15px 20px"}},pe={class:"check-result-card"},he={class:"check-result-header"},je={class:"check-result-stats"},Oe={class:"stat-item"},ve={class:"stat-value danger"},fe={class:"stat-item"},ye={class:"stat-value warning"},Ve={class:"stat-item"},Ne={class:"stat-value info"},xe={class:"stat-item"},ke={class:"stat-value"},we={key:0,class:"el-alert el-alert--success",style:{margin:"8px 0 12px 0",padding:"12px 18px","border-radius":"4px"}},Ce={style:{display:"flex","align-items":"center"}},Ee={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",style:{width:"20px",height:"20px","margin-right":"8px",color:"#67c23a","flex-shrink":"0"}},Te={class:"check-result-details"},_e={class:"collapse-header"},De={key:0,class:"empty-result"},Se={class:"issue-header"},Ae={class:"issue-content"},Ie={class:"issue-field"},Be={class:"field-value"},Le={class:"issue-field"},Pe={class:"field-value text-danger"},qe={class:"issue-actions"},$e={class:"collapse-header"},ze={key:0,class:"empty-result"},Re={class:"issue-header"},Qe={class:"issue-content"},Me={class:"issue-field"},Ue={class:"field-value"},Fe={class:"issue-actions"},Ye={class:"collapse-header"},Je={key:0,class:"empty-result"},He={class:"issue-header"},We={class:"issue-content"},Ke={class:"issue-field"},Xe={class:"field-value"},Ge={class:"issue-actions"},Ze={key:3},et={class:"mt-3 text-end"},tt={class:"panel-header"},ot={class:"panel-controls"},nt={key:0,class:"text-center my-2"},lt={key:1,class:"text-center my-3 text-muted"},ct={key:0,class:"p-3 text-center text-muted"},at={class:"original-text"},it={class:"suggested-text"},st={class:"explanation"},rt={class:"suggestion-actions text-end"},dt={key:0,class:"p-3 text-center text-muted"},ut={class:"original-text"},gt={class:"suggested-text"},bt={class:"explanation"},mt={class:"suggestion-actions text-end"},pt={key:2,class:"text-center mt-3"};function ht(e,t,o,ht,jt,Ot){const vt=Object(n["resolveComponent"])("el-tab-pane"),ft=Object(n["resolveComponent"])("el-tabs"),yt=Object(n["resolveComponent"])("Download"),Vt=Object(n["resolveComponent"])("el-icon"),Nt=Object(n["resolveComponent"])("el-button"),xt=Object(n["resolveComponent"])("DocumentAdd"),kt=Object(n["resolveComponent"])("el-input"),wt=Object(n["resolveComponent"])("el-form-item"),Ct=Object(n["resolveComponent"])("el-option"),Et=Object(n["resolveComponent"])("el-select"),Tt=Object(n["resolveComponent"])("el-form"),_t=Object(n["resolveComponent"])("el-date-picker"),Dt=Object(n["resolveComponent"])("Loading"),St=Object(n["resolveComponent"])("MagicStick"),At=Object(n["resolveComponent"])("Timer"),It=Object(n["resolveComponent"])("Position"),Bt=Object(n["resolveComponent"])("Setting"),Lt=Object(n["resolveComponent"])("DocumentChecked"),Pt=Object(n["resolveComponent"])("el-checkbox"),qt=Object(n["resolveComponent"])("el-checkbox-group"),$t=Object(n["resolveComponent"])("Notebook"),zt=Object(n["resolveComponent"])("Plus"),Rt=Object(n["resolveComponent"])("el-tag"),Qt=Object(n["resolveComponent"])("Check"),Mt=Object(n["resolveComponent"])("QuillEditor"),Ut=Object(n["resolveComponent"])("Reading"),Ft=Object(n["resolveComponent"])("InfoFilled"),Yt=Object(n["resolveComponent"])("WarningFilled"),Jt=Object(n["resolveComponent"])("el-badge"),Ht=Object(n["resolveComponent"])("el-empty"),Wt=Object(n["resolveComponent"])("el-collapse-item"),Kt=Object(n["resolveComponent"])("Document"),Xt=Object(n["resolveComponent"])("Warning"),Gt=Object(n["resolveComponent"])("el-collapse"),Zt=Object(n["resolveComponent"])("el-scrollbar"),eo=Object(n["resolveComponent"])("el-timeline-item"),to=Object(n["resolveComponent"])("el-timeline"),oo=Object(n["resolveComponent"])("Close"),no=Object(n["resolveComponent"])("Edit"),lo=Object(n["resolveComponent"])("el-tooltip"),co=Object(n["resolveDirective"])("loading");return Object(n["openBlock"])(),Object(n["createElementBlock"])("div",l,[Object(n["createElementVNode"])("div",c,[Object(n["createVNode"])(ft,{modelValue:ht.activeTab,"onUpdate:modelValue":t[0]||(t[0]=e=>ht.activeTab=e),class:"contract-detail-tabs"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(vt,{label:"基本信息",name:"basicInfo"}),Object(n["createVNode"])(vt,{label:"合同文本",name:"contractText"}),Object(n["createVNode"])(vt,{label:"合同检查",name:"contractCheck"}),Object(n["createVNode"])(vt,{label:"操作记录",name:"history"})]),_:1},8,["modelValue"])]),Object(n["withDirectives"])((Object(n["openBlock"])(),Object(n["createElementBlock"])("div",a,[Object(n["createElementVNode"])("div",i,[Object(n["createElementVNode"])("span",s,Object(n["toDisplayString"])(ht.contractTitle),1),Object(n["createElementVNode"])("div",null,[Object(n["createVNode"])(Nt,{type:"default",size:"small",class:"me-2",onClick:ht.downloadContract},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(yt)]),_:1}),t[22]||(t[22]=Object(n["createTextVNode"])(" 下载Word "))]),_:1},8,["onClick"]),Object(n["createVNode"])(Nt,{type:"primary",size:"small",onClick:ht.saveChanges,loading:ht.isSaving},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(xt)]),_:1}),t[23]||(t[23]=Object(n["createTextVNode"])(" 保存更改 "))]),_:1},8,["onClick","loading"])])]),Object(n["createElementVNode"])("div",r,["basicInfo"===ht.activeTab?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",d,[t[24]||(t[24]=Object(n["createElementVNode"])("h5",null,"基本信息",-1)),Object(n["createElementVNode"])("div",u,[Object(n["createElementVNode"])("div",g,[Object(n["createVNode"])(Tt,{"label-position":"top"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(wt,{label:"合同名称"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(kt,{modelValue:ht.contractDetails.title,"onUpdate:modelValue":t[1]||(t[1]=e=>ht.contractDetails.title=e)},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(wt,{label:"合同编号"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(kt,{modelValue:ht.contractDetails.number,"onUpdate:modelValue":t[2]||(t[2]=e=>ht.contractDetails.number=e),disabled:""},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(wt,{label:"合同类型"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Et,{modelValue:ht.contractDetails.type,"onUpdate:modelValue":t[3]||(t[3]=e=>ht.contractDetails.type=e),style:{width:"100%"}},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ct,{label:"采购合同",value:"采购合同"}),Object(n["createVNode"])(Ct,{label:"销售合同",value:"销售合同"}),Object(n["createVNode"])(Ct,{label:"服务合同",value:"服务合同"}),Object(n["createVNode"])(Ct,{label:"合作协议",value:"合作协议"}),Object(n["createVNode"])(Ct,{label:"租赁合同",value:"租赁合同"}),Object(n["createVNode"])(Ct,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),Object(n["createVNode"])(wt,{label:"合同金额"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(kt,{modelValue:ht.contractDetails.amount,"onUpdate:modelValue":t[4]||(t[4]=e=>ht.contractDetails.amount=e),prefix:"¥"},null,8,["modelValue"])]),_:1})]),_:1})]),Object(n["createElementVNode"])("div",b,[Object(n["createVNode"])(Tt,{"label-position":"top"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(wt,{label:"签约对方"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(kt,{modelValue:ht.contractDetails.company,"onUpdate:modelValue":t[5]||(t[5]=e=>ht.contractDetails.company=e)},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(wt,{label:"签约日期"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(_t,{modelValue:ht.contractDetails.signDate,"onUpdate:modelValue":t[6]||(t[6]=e=>ht.contractDetails.signDate=e),type:"date","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(wt,{label:"生效日期"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(_t,{modelValue:ht.contractDetails.startDate,"onUpdate:modelValue":t[7]||(t[7]=e=>ht.contractDetails.startDate=e),type:"date","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),Object(n["createVNode"])(wt,{label:"到期日期"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(_t,{modelValue:ht.contractDetails.expireDate,"onUpdate:modelValue":t[8]||(t[8]=e=>ht.contractDetails.expireDate=e),type:"date","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})])])])):"contractText"===ht.activeTab?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",m,[Object(n["createElementVNode"])("div",p,[t[26]||(t[26]=Object(n["createElementVNode"])("h5",null,"合同文本编辑",-1)),Object(n["createElementVNode"])("div",h,[ht.realTimePolishLoading?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",j,[Object(n["createVNode"])(Vt,{class:"is-loading"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Dt)]),_:1}),t[25]||(t[25]=Object(n["createElementVNode"])("span",{class:"ms-1"},"AI分析中...",-1))])):Object(n["createCommentVNode"])("",!0)])]),Object(n["createElementVNode"])("div",O,[Object(n["createElementVNode"])("div",v,[Object(n["createElementVNode"])("div",f,[Object(n["createVNode"])(Nt,{type:"primary",size:"large",onClick:ht.manualAnalyzeText,loading:ht.realTimePolishLoading,disabled:ht.realTimePolishLoading,class:"ai-polish-button"},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",y,[Object(n["createVNode"])(Vt,{class:"ai-polish-icon no-bg"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(St)]),_:1}),Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(ht.realTimePolishLoading?"正在分析中...":"AI智能润色"),1)])]),_:1},8,["onClick","loading","disabled"]),Object(n["createElementVNode"])("div",V,[ht.realTimePolishLoading?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",N,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(At)]),_:1}),Object(n["createElementVNode"])("span",null,"预计用时: "+Object(n["toDisplayString"])(ht.estimatedTime),1)])),Object(n["createElementVNode"])("div",x,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(It)]),_:1}),t[27]||(t[27]=Object(n["createElementVNode"])("span",null,"快捷键: Ctrl+Shift+A",-1))])]),Object(n["createElementVNode"])("div",k,[t[38]||(t[38]=Object(n["createElementVNode"])("h6",{class:"personalization-title"},"个性化定制",-1)),Object(n["createElementVNode"])("div",w,[Object(n["createElementVNode"])("div",C,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Bt)]),_:1}),t[28]||(t[28]=Object(n["createElementVNode"])("span",null,"润色偏好",-1))]),Object(n["createElementVNode"])("div",E,[t[29]||(t[29]=Object(n["createElementVNode"])("span",null,"语言风格",-1)),Object(n["createVNode"])(Et,{modelValue:ht.polishPreferences.style,"onUpdate:modelValue":t[9]||(t[9]=e=>ht.polishPreferences.style=e),size:"small",placeholder:"选择风格"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ct,{label:"正式严谨",value:"formal"}),Object(n["createVNode"])(Ct,{label:"中性专业",value:"neutral"}),Object(n["createVNode"])(Ct,{label:"简洁明了",value:"concise"})]),_:1},8,["modelValue"])]),Object(n["createElementVNode"])("div",T,[t[30]||(t[30]=Object(n["createElementVNode"])("span",null,"合同类型",-1)),Object(n["createVNode"])(Et,{modelValue:ht.polishPreferences.contractType,"onUpdate:modelValue":t[10]||(t[10]=e=>ht.polishPreferences.contractType=e),size:"small",placeholder:"选择类型"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ct,{label:"通用合同",value:"general"}),Object(n["createVNode"])(Ct,{label:"买卖合同",value:"sales"}),Object(n["createVNode"])(Ct,{label:"劳务合同",value:"labor"}),Object(n["createVNode"])(Ct,{label:"租赁合同",value:"lease"}),Object(n["createVNode"])(Ct,{label:"技术合同",value:"technology"})]),_:1},8,["modelValue"])])]),Object(n["createElementVNode"])("div",_,[Object(n["createElementVNode"])("div",D,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Lt)]),_:1}),t[31]||(t[31]=Object(n["createElementVNode"])("span",null,"优化重点",-1))]),Object(n["createElementVNode"])("div",S,[Object(n["createVNode"])(qt,{modelValue:ht.polishPreferences.focus,"onUpdate:modelValue":t[11]||(t[11]=e=>ht.polishPreferences.focus=e)},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Pt,{label:"grammar"},{default:Object(n["withCtx"])(()=>t[32]||(t[32]=[Object(n["createTextVNode"])("语法规范")])),_:1}),Object(n["createVNode"])(Pt,{label:"terminology"},{default:Object(n["withCtx"])(()=>t[33]||(t[33]=[Object(n["createTextVNode"])("专业术语")])),_:1}),Object(n["createVNode"])(Pt,{label:"structure"},{default:Object(n["withCtx"])(()=>t[34]||(t[34]=[Object(n["createTextVNode"])("句式结构")])),_:1}),Object(n["createVNode"])(Pt,{label:"consistency"},{default:Object(n["withCtx"])(()=>t[35]||(t[35]=[Object(n["createTextVNode"])("用词一致性")])),_:1})]),_:1},8,["modelValue"])])]),Object(n["createElementVNode"])("div",A,[Object(n["createElementVNode"])("div",I,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])($t)]),_:1}),t[36]||(t[36]=Object(n["createElementVNode"])("span",null,"术语词典",-1))]),Object(n["createElementVNode"])("div",B,[Object(n["createVNode"])(kt,{modelValue:ht.newTerminology.term,"onUpdate:modelValue":t[12]||(t[12]=e=>ht.newTerminology.term=e),size:"small",placeholder:"添加专业术语",class:"terminology-input"},{append:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Nt,{onClick:ht.addCustomTerminology},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(zt)]),_:1})]),_:1},8,["onClick"])]),_:1},8,["modelValue"]),ht.customTerminologies.length>0?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",L,[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(ht.customTerminologies,(e,t)=>(Object(n["openBlock"])(),Object(n["createBlock"])(Rt,{key:t,closable:"",onClose:e=>ht.removeCustomTerminology(t),class:"terminology-tag"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e),1)]),_:2},1032,["onClose"]))),128))])):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",P,t[37]||(t[37]=[Object(n["createElementVNode"])("span",{class:"text-muted"},"添加常用术语以确保准确性",-1)])))])])]),Object(n["createElementVNode"])("div",q,[Object(n["createElementVNode"])("div",$,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Qt)]),_:1}),t[39]||(t[39]=Object(n["createElementVNode"])("span",null,"改善语法和表达",-1))]),Object(n["createElementVNode"])("div",z,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Qt)]),_:1}),t[40]||(t[40]=Object(n["createElementVNode"])("span",null,"优化专业术语",-1))]),Object(n["createElementVNode"])("div",R,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Qt)]),_:1}),t[41]||(t[41]=Object(n["createElementVNode"])("span",null,"增强阅读体验",-1))]),Object(n["createElementVNode"])("div",Q,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Qt)]),_:1}),t[42]||(t[42]=Object(n["createElementVNode"])("span",null,"保持个性化定制",-1))])])],512),Object(n["createElementVNode"])("div",M,[Object(n["createVNode"])(Mt,{content:ht.contractDetails.content,"onUpdate:content":t[13]||(t[13]=e=>ht.contractDetails.content=e),ref:"quillEditor",toolbar:ht.editorOption.modules.toolbar,contentType:"html",class:"contract-text-editor",theme:"snow",onTextChange:ht.onContractContentChange},null,8,["content","toolbar","onTextChange"])],512)],512)])])):"contractCheck"===ht.activeTab?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",U,[t[77]||(t[77]=Object(n["createElementVNode"])("div",{class:"d-flex justify-content-between align-items-center mb-3"},[Object(n["createElementVNode"])("h5",null,"合同检查审核")],-1)),Object(n["createElementVNode"])("div",F,[Object(n["createElementVNode"])("div",Y,[Object(n["createElementVNode"])("div",J,[Object(n["createVNode"])(Nt,{type:"primary",size:"large",onClick:ht.startContractCheck,loading:ht.isChecking,disabled:ht.isChecking,class:"ai-polish-button"},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",H,[Object(n["createVNode"])(Vt,{class:"ai-polish-icon no-bg"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Lt)]),_:1}),Object(n["createElementVNode"])("span",null,Object(n["toDisplayString"])(ht.isChecking?"检查中...":"AI智能检查"),1)])]),_:1},8,["onClick","loading","disabled"]),Object(n["createElementVNode"])("div",W,[ht.isChecking?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",K,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(At)]),_:1}),Object(n["createElementVNode"])("span",null,"预计用时: "+Object(n["toDisplayString"])(ht.estimatedTime),1)])),Object(n["createElementVNode"])("div",X,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(It)]),_:1}),t[43]||(t[43]=Object(n["createElementVNode"])("span",null,"快捷键: Ctrl+Shift+C",-1))])]),Object(n["createElementVNode"])("div",G,[t[52]||(t[52]=Object(n["createElementVNode"])("h6",{class:"personalization-title"},"检查偏好设置",-1)),Object(n["createElementVNode"])("div",Z,[Object(n["createElementVNode"])("div",ee,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Bt)]),_:1}),t[44]||(t[44]=Object(n["createElementVNode"])("span",null,"检查维度",-1))]),Object(n["createElementVNode"])("div",te,[Object(n["createVNode"])(Pt,{modelValue:ht.checkPreferences.legalCompliance,"onUpdate:modelValue":t[14]||(t[14]=e=>ht.checkPreferences.legalCompliance=e)},{default:Object(n["withCtx"])(()=>t[45]||(t[45]=[Object(n["createTextVNode"])("法律合规性")])),_:1},8,["modelValue"]),Object(n["createVNode"])(Pt,{modelValue:ht.checkPreferences.completeness,"onUpdate:modelValue":t[15]||(t[15]=e=>ht.checkPreferences.completeness=e)},{default:Object(n["withCtx"])(()=>t[46]||(t[46]=[Object(n["createTextVNode"])("条款完整性")])),_:1},8,["modelValue"]),Object(n["createVNode"])(Pt,{modelValue:ht.checkPreferences.riskAlert,"onUpdate:modelValue":t[16]||(t[16]=e=>ht.checkPreferences.riskAlert=e)},{default:Object(n["withCtx"])(()=>t[47]||(t[47]=[Object(n["createTextVNode"])("风险提示")])),_:1},8,["modelValue"])])]),Object(n["createElementVNode"])("div",oe,[Object(n["createElementVNode"])("div",ne,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ut)]),_:1}),t[48]||(t[48]=Object(n["createElementVNode"])("span",null,"合同类型参考",-1))]),Object(n["createElementVNode"])("div",le,[t[49]||(t[49]=Object(n["createElementVNode"])("span",null,"合同类型",-1)),Object(n["createVNode"])(Et,{modelValue:ht.checkPreferences.contractType,"onUpdate:modelValue":t[17]||(t[17]=e=>ht.checkPreferences.contractType=e),size:"small",placeholder:"选择类型"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ct,{label:"通用合同",value:"general"}),Object(n["createVNode"])(Ct,{label:"买卖合同",value:"sales"}),Object(n["createVNode"])(Ct,{label:"劳务合同",value:"labor"}),Object(n["createVNode"])(Ct,{label:"租赁合同",value:"lease"}),Object(n["createVNode"])(Ct,{label:"技术合同",value:"technology"})]),_:1},8,["modelValue"])])]),Object(n["createElementVNode"])("div",ce,[Object(n["createElementVNode"])("div",ae,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ft)]),_:1}),t[50]||(t[50]=Object(n["createElementVNode"])("span",null,"关注程度",-1))]),Object(n["createElementVNode"])("div",ie,[t[51]||(t[51]=Object(n["createElementVNode"])("span",null,"检查深度",-1)),Object(n["createVNode"])(Et,{modelValue:ht.checkPreferences.checkDepth,"onUpdate:modelValue":t[18]||(t[18]=e=>ht.checkPreferences.checkDepth=e),size:"small",placeholder:"选择深度"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ct,{label:"标准检查",value:"standard"}),Object(n["createVNode"])(Ct,{label:"深度检查",value:"deep"}),Object(n["createVNode"])(Ct,{label:"快速检查",value:"quick"})]),_:1},8,["modelValue"])])])]),Object(n["createElementVNode"])("div",se,[Object(n["createElementVNode"])("div",re,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Qt)]),_:1}),t[53]||(t[53]=Object(n["createElementVNode"])("span",null,"法律合规审查",-1))]),Object(n["createElementVNode"])("div",de,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Qt)]),_:1}),t[54]||(t[54]=Object(n["createElementVNode"])("span",null,"条款完整性检查",-1))]),Object(n["createElementVNode"])("div",ue,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Qt)]),_:1}),t[55]||(t[55]=Object(n["createElementVNode"])("span",null,"潜在风险分析",-1))]),Object(n["createElementVNode"])("div",ge,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Qt)]),_:1}),t[56]||(t[56]=Object(n["createElementVNode"])("span",null,"智能修改建议",-1))])])],512),Object(n["createElementVNode"])("div",be,[Object(n["createVNode"])(Zt,{height:"calc(100% - 10px)",always:"",class:"contract-check-scrollbar"},{default:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",me,[Object(n["createElementVNode"])("div",pe,[Object(n["createElementVNode"])("div",he,[t[58]||(t[58]=Object(n["createElementVNode"])("h6",null,"检查结果概览",-1)),ht.checkResult.totalIssues>0?(Object(n["openBlock"])(),Object(n["createBlock"])(Rt,{key:0,type:"danger",size:"small"},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])("发现"+Object(n["toDisplayString"])(ht.checkResult.totalIssues)+"个问题",1)]),_:1})):(Object(n["openBlock"])(),Object(n["createBlock"])(Rt,{key:1,type:"success",size:"small"},{default:Object(n["withCtx"])(()=>t[57]||(t[57]=[Object(n["createTextVNode"])("未发现问题")])),_:1}))]),Object(n["createElementVNode"])("div",je,[Object(n["createElementVNode"])("div",Oe,[Object(n["createElementVNode"])("div",ve,Object(n["toDisplayString"])(ht.checkResult.criticalIssues),1),t[59]||(t[59]=Object(n["createElementVNode"])("div",{class:"stat-label"},"严重问题",-1))]),Object(n["createElementVNode"])("div",fe,[Object(n["createElementVNode"])("div",ye,Object(n["toDisplayString"])(ht.checkResult.warningIssues),1),t[60]||(t[60]=Object(n["createElementVNode"])("div",{class:"stat-label"},"警告",-1))]),Object(n["createElementVNode"])("div",Ve,[Object(n["createElementVNode"])("div",Ne,Object(n["toDisplayString"])(ht.checkResult.suggestions),1),t[61]||(t[61]=Object(n["createElementVNode"])("div",{class:"stat-label"},"建议",-1))]),Object(n["createElementVNode"])("div",xe,[Object(n["createElementVNode"])("div",ke,Object(n["toDisplayString"])(ht.checkResult.totalIssues),1),t[62]||(t[62]=Object(n["createElementVNode"])("div",{class:"stat-label"},"问题总数",-1))])])]),e.aiCheckFinished&&!ht.isChecking&&0===ht.checkResult.totalIssues?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",we,[Object(n["createElementVNode"])("div",Ce,[(Object(n["openBlock"])(),Object(n["createElementBlock"])("svg",Ee,t[63]||(t[63]=[Object(n["createElementVNode"])("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm-55.808 536.384-99.52-99.584a38.4 38.4 0 1 0-54.336 54.336l126.72 126.72a38.272 38.272 0 0 0 54.336 0l262.4-262.464a38.4 38.4 0 1 0-54.272-54.336L456.192 600.384z"},null,-1)]))),t[64]||(t[64]=Object(n["createElementVNode"])("span",{style:{"font-size":"15px","font-weight":"bold",color:"#67c23a","margin-right":"6px"}},"合同检查完成",-1)),t[65]||(t[65]=Object(n["createElementVNode"])("span",{style:{"font-size":"14px",color:"#606266","font-weight":"normal"}},"AI分析完成，未发现明显风险。合同文本质量良好，符合常规法律和业务要求。",-1))])])):Object(n["createCommentVNode"])("",!0),Object(n["createElementVNode"])("div",Te,[Object(n["createVNode"])(Gt,{modelValue:ht.activeCollapse,"onUpdate:modelValue":t[19]||(t[19]=e=>ht.activeCollapse=e),class:"check-collapse"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Wt,{title:"法律合规性",name:"legalCompliance"},{title:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",_e,[Object(n["createVNode"])(Vt,{class:"text-danger"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Yt)]),_:1}),t[66]||(t[66]=Object(n["createElementVNode"])("span",null,"法律合规性",-1)),ht.checkResult.legalComplianceIssues.length>0?(Object(n["openBlock"])(),Object(n["createBlock"])(Jt,{key:0,value:ht.checkResult.legalComplianceIssues.length,type:"danger",class:"ms-2"},null,8,["value"])):Object(n["createCommentVNode"])("",!0)])]),default:Object(n["withCtx"])(()=>[0===ht.checkResult.legalComplianceIssues.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",De,[Object(n["createVNode"])(Ht,{description:"未发现法律合规性问题","image-size":80})])):Object(n["createCommentVNode"])("",!0),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(ht.checkResult.legalComplianceIssues,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:"legal-"+o,class:"check-issue-card"},[Object(n["createElementVNode"])("div",Se,[Object(n["createVNode"])(Vt,{class:"text-danger fs-4"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Yt)]),_:1}),Object(n["createElementVNode"])("h6",null,Object(n["toDisplayString"])(e.title),1)]),Object(n["createElementVNode"])("div",Ae,[Object(n["createElementVNode"])("div",Ie,[t[67]||(t[67]=Object(n["createElementVNode"])("div",{class:"field-label"},"当前条款：",-1)),Object(n["createElementVNode"])("div",Be,Object(n["toDisplayString"])(e.current),1)]),Object(n["createElementVNode"])("div",Le,[t[68]||(t[68]=Object(n["createElementVNode"])("div",{class:"field-label"},"问题：",-1)),Object(n["createElementVNode"])("div",Pe,Object(n["toDisplayString"])(e.problem),1)])]),Object(n["createElementVNode"])("div",qe,[Object(n["createVNode"])(Nt,{size:"small",type:"primary",onClick:t=>ht.viewRegulation(e)},{default:Object(n["withCtx"])(()=>t[69]||(t[69]=[Object(n["createTextVNode"])("查看法规")])),_:2},1032,["onClick"]),Object(n["createVNode"])(Nt,{size:"small",type:"default"},{default:Object(n["withCtx"])(()=>t[70]||(t[70]=[Object(n["createTextVNode"])("忽略")])),_:1})])]))),128))]),_:1}),Object(n["createVNode"])(Wt,{title:"条款完整性",name:"clauseCompleteness"},{title:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",$e,[Object(n["createVNode"])(Vt,{class:"text-warning"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Kt)]),_:1}),t[71]||(t[71]=Object(n["createElementVNode"])("span",null,"条款完整性",-1)),ht.checkResult.completenessIssues.length>0?(Object(n["openBlock"])(),Object(n["createBlock"])(Jt,{key:0,value:ht.checkResult.completenessIssues.length,type:"warning",class:"ms-2"},null,8,["value"])):Object(n["createCommentVNode"])("",!0)])]),default:Object(n["withCtx"])(()=>[0===ht.checkResult.completenessIssues.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ze,[Object(n["createVNode"])(Ht,{description:"未发现条款完整性问题","image-size":80})])):Object(n["createCommentVNode"])("",!0),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(ht.checkResult.completenessIssues,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:"comp-"+o,class:"check-issue-card"},[Object(n["createElementVNode"])("div",Re,[Object(n["createVNode"])(Vt,{class:"text-warning fs-4"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Xt)]),_:1}),Object(n["createElementVNode"])("h6",null,Object(n["toDisplayString"])(e.title),1)]),Object(n["createElementVNode"])("div",Qe,[Object(n["createElementVNode"])("div",Me,[t[72]||(t[72]=Object(n["createElementVNode"])("div",{class:"field-label"},"建议：",-1)),Object(n["createElementVNode"])("div",Ue,Object(n["toDisplayString"])(e.suggestion),1)])]),Object(n["createElementVNode"])("div",Fe,[Object(n["createVNode"])(Nt,{size:"small",type:"default"},{default:Object(n["withCtx"])(()=>t[73]||(t[73]=[Object(n["createTextVNode"])("忽略")])),_:1})])]))),128))]),_:1}),Object(n["createVNode"])(Wt,{title:"风险提示",name:"riskAlert"},{title:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("div",Ye,[Object(n["createVNode"])(Vt,{class:"text-info"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ft)]),_:1}),t[74]||(t[74]=Object(n["createElementVNode"])("span",null,"风险提示",-1)),ht.checkResult.riskAlerts.length>0?(Object(n["openBlock"])(),Object(n["createBlock"])(Jt,{key:0,value:ht.checkResult.riskAlerts.length,type:"info",class:"ms-2"},null,8,["value"])):Object(n["createCommentVNode"])("",!0)])]),default:Object(n["withCtx"])(()=>[0===ht.checkResult.riskAlerts.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Je,[Object(n["createVNode"])(Ht,{description:"未发现风险提示","image-size":80})])):Object(n["createCommentVNode"])("",!0),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(ht.checkResult.riskAlerts,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:"risk-"+o,class:"check-issue-card"},[Object(n["createElementVNode"])("div",He,[Object(n["createVNode"])(Vt,{class:"text-info fs-4"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ft)]),_:1}),Object(n["createElementVNode"])("h6",null,Object(n["toDisplayString"])(e.title),1)]),Object(n["createElementVNode"])("div",We,[Object(n["createElementVNode"])("div",Ke,[t[75]||(t[75]=Object(n["createElementVNode"])("div",{class:"field-label"},"建议：",-1)),Object(n["createElementVNode"])("div",Xe,Object(n["toDisplayString"])(e.suggestion),1)])]),Object(n["createElementVNode"])("div",Ge,[Object(n["createVNode"])(Nt,{size:"small",type:"default"},{default:Object(n["withCtx"])(()=>t[76]||(t[76]=[Object(n["createTextVNode"])("忽略")])),_:1})])]))),128))]),_:1})]),_:1},8,["modelValue"])])])]),_:1})],512)],512)])])):"history"===ht.activeTab?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",Ze,[t[78]||(t[78]=Object(n["createElementVNode"])("h5",null,"操作记录",-1)),Object(n["createVNode"])(to,null,{default:Object(n["withCtx"])(()=>[(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(ht.contractHistory,(e,t)=>(Object(n["openBlock"])(),Object(n["createBlock"])(eo,{key:t,timestamp:e.time},{default:Object(n["withCtx"])(()=>[Object(n["createTextVNode"])(Object(n["toDisplayString"])(e.content),1)]),_:2},1032,["timestamp"]))),128))]),_:1}),0===ht.contractHistory.length?(Object(n["openBlock"])(),Object(n["createBlock"])(Ht,{key:0,description:"暂无操作记录"})):Object(n["createCommentVNode"])("",!0)])):Object(n["createCommentVNode"])("",!0),t[80]||(t[80]=Object(n["createElementVNode"])("hr",null,null,-1)),Object(n["createElementVNode"])("div",et,[Object(n["createVNode"])(Nt,{onClick:ht.goBack},{default:Object(n["withCtx"])(()=>t[79]||(t[79]=[Object(n["createTextVNode"])("返回列表")])),_:1},8,["onClick"])])])])),[[co,ht.isLoading]]),"contractText"===ht.activeTab?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:0,class:Object(n["normalizeClass"])(["ai-suggestions-panel",{show:ht.showAiSuggestions,collapsed:ht.isAiPanelCollapsed}]),id:"aiSuggestionsPanel"},[Object(n["createElementVNode"])("div",tt,[Object(n["createElementVNode"])("h5",null,[Object(n["createVNode"])(Vt,{class:"text-warning"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ut)]),_:1}),t[81]||(t[81]=Object(n["createTextVNode"])(" AI 润色建议"))]),Object(n["createElementVNode"])("div",ot,[Object(n["createVNode"])(Nt,{type:"link",onClick:ht.hideAiPanel},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(oo)]),_:1})]),_:1},8,["onClick"])])]),ht.realTimePolishLoading?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",nt,[Object(n["createVNode"])(Vt,{class:"is-loading"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Dt)]),_:1}),t[82]||(t[82]=Object(n["createElementVNode"])("span",{class:"ms-1"},"正在分析内容...",-1))])):Object(n["createCommentVNode"])("",!0),ht.realTimePolishLoading||0!==ht.aiSuggestions.syntax.length||0!==ht.aiSuggestions.terminology.length?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",lt,[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ft)]),_:1}),t[83]||(t[83]=Object(n["createElementVNode"])("p",null,"没有建议可显示",-1)),t[84]||(t[84]=Object(n["createElementVNode"])("p",{class:"small"},'点击上方"AI润色分析"按钮可获取建议',-1))])),Object(n["createVNode"])(Gt,{modelValue:ht.activeSuggestionCollapse,"onUpdate:modelValue":t[20]||(t[20]=e=>ht.activeSuggestionCollapse=e)},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Wt,{name:"syntax"},{title:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("span",null,[Object(n["createVNode"])(Vt,{class:"me-1"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(no)]),_:1}),Object(n["createTextVNode"])(" 语法与格式 ("+Object(n["toDisplayString"])(ht.aiSuggestions.syntax.length)+")",1)])]),default:Object(n["withCtx"])(()=>[0===ht.aiSuggestions.syntax.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",ct," 没有语法或格式问题 ")):Object(n["createCommentVNode"])("",!0),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(ht.aiSuggestions.syntax,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:"syntax-"+o,class:"suggestion-item"},[Object(n["createElementVNode"])("div",at,Object(n["toDisplayString"])(e.original),1),Object(n["createElementVNode"])("div",it,Object(n["toDisplayString"])(e.suggested),1),Object(n["createElementVNode"])("p",st,Object(n["toDisplayString"])(e.explanation),1),Object(n["createElementVNode"])("div",rt,[Object(n["createVNode"])(Nt,{size:"small",onClick:e=>ht.ignoreSuggestion("syntax",o)},{default:Object(n["withCtx"])(()=>t[85]||(t[85]=[Object(n["createTextVNode"])("忽略")])),_:2},1032,["onClick"]),Object(n["createVNode"])(Nt,{size:"small",type:"success",onClick:e=>ht.adoptSuggestion("syntax",o)},{default:Object(n["withCtx"])(()=>t[86]||(t[86]=[Object(n["createTextVNode"])("采纳")])),_:2},1032,["onClick"])])]))),128))]),_:1}),Object(n["createVNode"])(Wt,{name:"terminology"},{title:Object(n["withCtx"])(()=>[Object(n["createElementVNode"])("span",null,[Object(n["createVNode"])(Vt,{class:"me-1"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Ut)]),_:1}),Object(n["createTextVNode"])(" 专业术语 ("+Object(n["toDisplayString"])(ht.aiSuggestions.terminology.length)+")",1)])]),default:Object(n["withCtx"])(()=>[0===ht.aiSuggestions.terminology.length?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",dt," 没有术语问题 ")):Object(n["createCommentVNode"])("",!0),(Object(n["openBlock"])(!0),Object(n["createElementBlock"])(n["Fragment"],null,Object(n["renderList"])(ht.aiSuggestions.terminology,(e,o)=>(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:"term-"+o,class:"suggestion-item"},[Object(n["createElementVNode"])("div",ut,Object(n["toDisplayString"])(e.original),1),Object(n["createElementVNode"])("div",gt,Object(n["toDisplayString"])(e.suggested),1),Object(n["createElementVNode"])("p",bt,Object(n["toDisplayString"])(e.explanation),1),Object(n["createElementVNode"])("div",mt,[Object(n["createVNode"])(Nt,{size:"small",onClick:e=>ht.ignoreSuggestion("terminology",o)},{default:Object(n["withCtx"])(()=>t[87]||(t[87]=[Object(n["createTextVNode"])("忽略")])),_:2},1032,["onClick"]),Object(n["createVNode"])(Nt,{size:"small",type:"success",onClick:e=>ht.adoptSuggestion("terminology",o)},{default:Object(n["withCtx"])(()=>t[88]||(t[88]=[Object(n["createTextVNode"])("采纳")])),_:2},1032,["onClick"])])]))),128))]),_:1})]),_:1},8,["modelValue"]),ht.aiSuggestions.syntax.length>0||ht.aiSuggestions.terminology.length>0?(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",pt,[Object(n["createVNode"])(Nt,{type:"primary",size:"small",onClick:ht.applyAllSuggestions},{default:Object(n["withCtx"])(()=>t[89]||(t[89]=[Object(n["createTextVNode"])("应用所有采纳的建议")])),_:1},8,["onClick"])])):Object(n["createCommentVNode"])("",!0)],2)):Object(n["createCommentVNode"])("",!0),"contractText"!==ht.activeTab||ht.showAiSuggestions?Object(n["createCommentVNode"])("",!0):(Object(n["openBlock"])(),Object(n["createElementBlock"])("div",{key:1,class:"panel-open-button",onClick:t[21]||(t[21]=e=>ht.showAiSuggestions=!0)},[Object(n["createVNode"])(lo,{content:"显示AI润色建议",placement:"left"},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Nt,{type:"primary",size:"small",circle:""},{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(Vt,null,{default:Object(n["withCtx"])(()=>[Object(n["createVNode"])(St)]),_:1})]),_:1})]),_:1})]))])}o("d9e2"),o("14d9"),o("e9f5"),o("910d"),o("7d54"),o("ab43"),o("1e70"),o("79a4"),o("c1a1"),o("8b00"),o("a4e7"),o("1e5a"),o("72c3"),o("88a7"),o("271a"),o("5494");var jt=o("6605"),Ot=o("3ef4"),vt=o("90b1"),ft=o("c9a1"),yt=o("f6f2"),Vt=o("35ad"),Nt=o("b775"),xt=o("93e8"),kt=(o("d263"),o("2332")),wt=o("26ee"),Ct=function(){return wt["a"].Date.now()},Et=Ct,Tt=/\s/;function _t(e){var t=e.length;while(t--&&Tt.test(e.charAt(t)));return t}var Dt=_t,St=/^\s+/;function At(e){return e?e.slice(0,Dt(e)+1).replace(St,""):e}var It=At,Bt=o("f0ce"),Lt=o("1147"),Pt="[object Symbol]";function qt(e){return"symbol"==typeof e||Object(Lt["a"])(e)&&Object(Bt["a"])(e)==Pt}var $t=qt,zt=NaN,Rt=/^[-+]0x[0-9a-f]+$/i,Qt=/^0b[01]+$/i,Mt=/^0o[0-7]+$/i,Ut=parseInt;function Ft(e){if("number"==typeof e)return e;if($t(e))return zt;if(Object(kt["a"])(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Object(kt["a"])(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=It(e);var o=Qt.test(e);return o||Mt.test(e)?Ut(e.slice(2),o?2:8):Rt.test(e)?zt:+e}var Yt=Ft,Jt="Expected a function",Ht=Math.max,Wt=Math.min;function Kt(e,t,o){var n,l,c,a,i,s,r=0,d=!1,u=!1,g=!0;if("function"!=typeof e)throw new TypeError(Jt);function b(t){var o=n,c=l;return n=l=void 0,r=t,a=e.apply(c,o),a}function m(e){return r=e,i=setTimeout(j,t),d?b(e):a}function p(e){var o=e-s,n=e-r,l=t-o;return u?Wt(l,c-n):l}function h(e){var o=e-s,n=e-r;return void 0===s||o>=t||o<0||u&&n>=c}function j(){var e=Et();if(h(e))return O(e);i=setTimeout(j,p(e))}function O(e){return i=void 0,g&&n?b(e):(n=l=void 0,a)}function v(){void 0!==i&&clearTimeout(i),r=0,n=s=l=i=void 0}function f(){return void 0===i?a:O(Et())}function y(){var e=Et(),o=h(e);if(n=arguments,l=this,s=e,o){if(void 0===i)return m(s);if(u)return clearTimeout(i),i=setTimeout(j,t),b(s)}return void 0===i&&(i=setTimeout(j,t)),a}return t=Yt(t)||0,Object(kt["a"])(o)&&(d=!!o.leading,u="maxWait"in o,c=u?Ht(Yt(o.maxWait)||0,t):c,g="trailing"in o?!!o.trailing:g),y.cancel=v,y.flush=f,y}var Xt=Kt;let Gt,Zt;const eo=()=>{if("undefined"===typeof window)return;if(!window.Quill)return void console.error("Quill未加载，无法初始化扩展");const e=window.Quill.import("blots/inline");Gt=class extends e{static create(e){const t=super.create();return t.setAttribute("data-suggestion-id",e.id),t.setAttribute("class","suggestion-highlight"),t.setAttribute("data-original",e.original),t.setAttribute("data-suggested",e.suggested),t.title="点击查看修改建议",t.style.position="relative",t.style.backgroundColor="rgba(255, 217, 102, 0.3)",t.style.borderBottom="1px dashed #ffb300",t.style.padding="0 2px",t.style.cursor="pointer",t}static formats(e){return{id:e.getAttribute("data-suggestion-id"),original:e.getAttribute("data-original"),suggested:e.getAttribute("data-suggested")}}},Gt.blotName="suggestion",Gt.tagName="span",window.Quill.register(Gt),Zt=class{constructor(e,t){this.quill=e,this.options=t,this.suggestions=t.suggestions||[],this.container=document.createElement("div"),this.container.className="ql-suggestion-tooltip",this.container.style.display="none",document.body.appendChild(this.container),this.quill.on("text-change",()=>{this.update()}),this._clickListener=e=>{e.target&&e.target.classList.contains("suggestion-highlight")?this.showTooltip(e.target):this.hideTooltip()},this.quill.root.addEventListener("click",this._clickListener),this.observer=new MutationObserver(e=>{for(const t of e)"childList"!==t.type&&"characterData"!==t.type||this.update()}),this.observer.observe(this.quill.root,{childList:!0,subtree:!0,characterData:!0})}update(){}showTooltip(e){const t=e.getBoundingClientRect(),o=e.getAttribute("data-suggestion-id"),n=e.getAttribute("data-original"),l=e.getAttribute("data-suggested");this.container.innerHTML=`\n        <div class="suggestion-tooltip-content">\n          <div class="suggestion-tooltip-header">AI文本优化建议</div>\n          <div class="suggestion-tooltip-body">\n            <div class="suggestion-label">原文本:</div>\n            <div class="suggestion-original">${n}</div>\n            <div class="suggestion-arrow"><span>→</span></div>\n            <div class="suggestion-label">建议修改为:</div>\n            <div class="suggestion-suggested">${l}</div>\n            <div class="suggestion-diff">\n              ${this._generateDiff(n,l)}\n            </div>\n          </div>\n          <div class="suggestion-actions">\n            <button class="btn-adopt" data-id="${o}">采纳</button>\n            <button class="btn-ignore" data-id="${o}">忽略</button>\n          </div>\n        </div>\n      `,this.container.style.display="block",this.container.style.top=t.bottom+window.scrollY+5+"px",this.container.style.left=t.left+window.scrollX+"px";const c=this.container.querySelector(".btn-adopt"),a=this.container.querySelector(".btn-ignore");this._adoptListener&&c.removeEventListener("click",this._adoptListener),this._ignoreListener&&a.removeEventListener("click",this._ignoreListener),this._adoptListener=()=>{this.options.onAdopt&&this.options.onAdopt(o),this.hideTooltip()},this._ignoreListener=()=>{this.options.onIgnore&&this.options.onIgnore(o),this.hideTooltip()},c.addEventListener("click",this._adoptListener),a.addEventListener("click",this._ignoreListener)}_generateDiff(e,t){try{if(!e||!t)return"";const o=e.split(/\s+/),n=t.split(/\s+/);let l=0;while(l<o.length&&l<n.length&&o[l]===n[l])l++;let c=o.length-1,a=n.length-1;while(c>=0&&a>=0&&o[c]===n[a])c--,a--;const i=o.slice(0,l).join(" "),s=o.slice(c+1).join(" "),r=o.slice(l,c+1).join(" "),d=n.slice(l,a+1).join(" ");return`\n          <div class="diff-explain">具体差异:</div>\n          <div class="diff-content">\n            ${i?`<span class="diff-common">${i}</span> `:""}\n            <span class="diff-removed">${r}</span> → \n            <span class="diff-added">${d}</span>\n            ${s?` <span class="diff-common">${s}</span>`:""}\n          </div>\n        `}catch(o){return console.error("生成差异对比失败:",o),""}}hideTooltip(){this.container.style.display="none"}applySuggestions(e){this.suggestions=e,this.clearAllSuggestionFormats(),e.forEach(e=>{const t=this.quill.getText();let o=t.indexOf(e.original);-1!==o&&this.quill.formatText(o,e.original.length,{suggestion:{id:e.id,original:e.original,suggested:e.suggested}},"api")})}clearAllSuggestionFormats(){const e=this.quill.getText();this.quill.formatText(0,e.length,{suggestion:!1},"api")}destroy(){if(this.observer&&(this.observer.disconnect(),this.observer=null),this.quill&&this.quill.root&&this.quill.root.removeEventListener("click",this._clickListener),this._adoptListener){const e=this.container.querySelector(".btn-adopt");e&&e.removeEventListener("click",this._adoptListener)}if(this._ignoreListener){const e=this.container.querySelector(".btn-ignore");e&&e.removeEventListener("click",this._ignoreListener)}this.container&&this.container.parentNode&&(this.container.parentNode.removeChild(this.container),this.container=null)}},window.Quill.register("modules/suggestion",Zt)};var to={name:"ContractDetail",components:{QuillEditor:xt["a"],Download:yt["Download"],DocumentAdd:yt["DocumentAdd"],MagicStick:yt["MagicStick"],Check:yt["Check"],Warning:yt["Warning"],WarningFilled:yt["WarningFilled"],Document:yt["Document"],InfoFilled:yt["InfoFilled"],Edit:yt["Edit"],Reading:yt["Reading"],Close:yt["Close"],Loading:yt["Loading"],Timer:yt["Timer"],Position:yt["Position"],Setting:yt["Setting"],DocumentChecked:yt["DocumentChecked"],Notebook:yt["Notebook"],Plus:yt["Plus"]},setup(){const e=Object(jt["c"])(),t=Object(jt["d"])(),o=Object(n["computed"])(()=>{if("ContractDetail"!==e.name)return null;const t=e.params.id;return isNaN(Number(t))?null:Number(t)}),l=Object(n["ref"])("basicInfo"),c=Object(n["ref"])(["legalCompliance","clauseCompleteness","riskAlert"]),a=Object(n["ref"])(["syntax","terminology"]),i=Object(n["reactive"])({style:"neutral",contractType:"general",focus:["grammar","terminology"]}),s=Object(n["reactive"])({legalCompliance:!0,completeness:!0,riskAlert:!0,contractType:"general",checkDepth:"standard"}),r=Object(n["ref"])([]),d=Object(n["reactive"])({term:""}),u=()=>{d.term.trim()&&(r.value.includes(d.term.trim())?(Ot["a"].warning("该术语已存在"),d.term=""):(r.value.push(d.term.trim()),d.term="",i.focus.includes("terminology")||i.focus.push("terminology"),localStorage.setItem("customTerminologies",JSON.stringify(r.value)),Ot["a"].success("已添加术语")))},g=e=>{r.value.splice(e,1),localStorage.setItem("customTerminologies",JSON.stringify(r.value))},b=Object(n["ref"])(!1),m=Object(n["ref"])(null),p=Object(n["ref"])(!1),h=Object(n["ref"])(!1),j=Object(n["ref"])(!1),O=Object(n["ref"])(null),v=Object(n["ref"])(null),f=Object(n["ref"])(null),y=Object(n["ref"])(null),V=Object(n["ref"])(null),N=Object(n["ref"])(null),x=Object(n["ref"])(!1),k=Object(n["ref"])(!1),w=Object(n["ref"])(""),C=Object(n["ref"])(0),E=Object(n["ref"])(!1),T=Object(n["ref"])(!1),_=()=>{T.value=!T.value},D={placeholder:"请输入合同内容",modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]],suggestion:{suggestions:[],onAdopt:e=>{te(e)},onIgnore:e=>{oe(e)}}}},S=Object(n["reactive"])({id:o.value,number:"",title:"",type:"",amount:"",company:"",signDate:"",startDate:"",expireDate:"",content:"",status:"",created_by:null,created_at:"",updated_at:"",attachments:[],actions:[]}),A=Object(n["computed"])(()=>S.title?"合同详情: "+S.number:"加载中..."),I=Object(n["reactive"])({totalIssues:0,criticalIssues:0,warningIssues:0,suggestions:0,legalComplianceIssues:[],completenessIssues:[],riskAlerts:[]}),B=Object(n["reactive"])({syntax:[],terminology:[]}),L=Object(n["computed"])(()=>{var e;return(null===(e=S.actions)||void 0===e?void 0:e.map(e=>{var t;return{time:e.created_at,content:`${(null===(t=e.user)||void 0===t?void 0:t.username)||"系统"} ${e.description}`}}))||[]}),P=async(n=!1)=>{try{if("ContractDetail"!==e.name)return void console.log("不在合同详情页面，跳过加载");if(!o.value||"contract"===o.value||isNaN(o.value))return console.log("无效的合同ID:",o.value),void t.push({name:"Contract"});h.value=!0;const l=await Object(Vt["g"])(o.value);console.log("合同详情API响应:",l);const c=l.data||l;Object.keys(S).forEach(e=>{e in c&&(S[e]=c[e])}),c.content?S.content=c.content:S.content=`<p>这里是合同文本内容，请编辑...</p>\n<p><strong>甲方：</strong>我方公司名称</p>\n<p><strong>乙方：</strong>${S.company||"对方公司"}</p>`,c.sign_date&&(S.signDate=c.sign_date),c.start_date&&(S.startDate=c.start_date),c.expire_date&&(S.expireDate=c.expire_date),c.amount&&(S.amount=Number(c.amount).toLocaleString("zh-CN")),n||Ot["a"].success("合同详情加载成功")}catch(l){console.error("加载合同详情失败:",l),Ot["a"].error("加载合同详情失败，请稍后重试")}finally{h.value=!1}},q=()=>{t.push({name:"Contract"})},$=async()=>{try{j.value=!0;const e=vt["a"].service({lock:!0,text:"保存中...",background:"rgba(0, 0, 0, 0.7)"}),t=e=>/^\d{4}-\d{2}-\d{2}$/.test(e),n=e=>/^\d+(\.\d{1,2})?$/.test(e),l={title:S.title,type:S.type,amount:n(S.amount.replace(/[^\d.]/g,""))?S.amount.replace(/[^\d.]/g,""):null,company:S.company,sign_date:t(S.signDate)?S.signDate:null,start_date:t(S.startDate)?S.startDate:null,expire_date:t(S.expireDate)?S.expireDate:null,content:S.content};await Object(Vt["j"])(o.value,l),Ot["a"].success("合同更改已保存"),await P(!0),e.close()}catch(e){console.error("保存合同更改失败:",e),e.response&&e.response.data&&console.error("错误响应数据:",e.response.data),Ot["a"].error("保存失败，请检查输入内容和日期格式")}finally{j.value=!1}},z=async()=>{if(console.log("%c========== 开始合同检查 ==========","background:#3a8ee6;color:white;padding:4px 8px;border-radius:4px;font-weight:bold;"),console.log("startContractCheck函数被调用"),N.value&&(console.log("确保检查结果区域样式正确"),N.value.style.height="100%",console.log("使用el-scrollbar组件处理滚动")),console.log("当前活动标签：",l.value),document.querySelector(".contract-edit-container")?console.log("合同检查容器DOM元素存在"):(console.log("警告：合同检查容器DOM元素不存在！"),document.querySelector(".contract-detail-container")&&console.log("发现合同详情容器元素"),document.getElementById("contractCheckContainer")&&console.log("通过ID找到合同检查容器元素")),N.value){const e=window.getComputedStyle(N.value);console.log("检查结果区域样式:",{display:e.display,height:e.height,overflow:e.overflow,position:e.position}),console.log("强制刷新检查结果区域布局"),N.value.style.display="none",setTimeout(()=>{N.value.style.display="flex";let e=N.value.querySelector(".check-content-scroll-wrapper");if(!e){const t=N.value.querySelector(".el-scrollbar__wrap");t&&(e=t.querySelector(".check-content-scroll-wrapper"))}if(e){const t=window.getComputedStyle(e);console.log("滚动容器样式:",{height:t.height,overflow:t.overflow,position:t.position})}else console.warn("未找到滚动容器元素（check-content-scroll-wrapper），但不影响功能")},50)}else console.error("checkResultArea引用不存在！");if(b.value)return void console.log("已有检查正在进行中，忽略此次点击");if(!o.value||isNaN(o.value))return console.error("合同ID无效:",o.value),void Ot["a"].error("合同ID无效，无法进行检查");if(!S.content)return console.log("合同内容为空，提示用户"),void Ot["a"].warning("请先在合同文本标签页输入合同内容");console.log("开始执行合同检查 - 详细信息:"),console.log("合同ID:",o.value,typeof o.value),console.log("内容长度:",S.content.length),console.log("检查偏好设置:",JSON.stringify(s,null,2)),b.value=!0,he.value=!1;let e=null;try{console.log("显示加载提示"),e=vt["a"].service({text:"AI正在分析合同文本，请稍候...",background:"rgba(255, 255, 255, 0.7)"}),Ot["a"].info("AI分析合同文本中...");const t={content:S.content,preferences:{contract_type:s.contractType,check_depth:s.checkDepth,check_areas:[]}};s.legalCompliance&&t.preferences.check_areas.push("legal_compliance"),s.completeness&&t.preferences.check_areas.push("completeness"),s.riskAlert&&t.preferences.check_areas.push("risk_alert"),0===t.preferences.check_areas.length&&(console.log("未选择任何检查区域，使用默认全部检查"),Ot["a"].warning("未选择任何检查区域，将使用默认全部检查"),t.preferences.check_areas=["legal_compliance","completeness","risk_alert"],s.legalCompliance=!0,s.completeness=!0,s.riskAlert=!0),console.log("发送检查请求参数:",JSON.stringify(t,null,2)),console.log("发送到API:",`/api/contract/contracts/${o.value}/check_contract/`);const n=(new Date).getTime();console.log("开始请求时间:",(new Date).toLocaleTimeString());const l=await Object(Vt["b"])(o.value,t),a=l.data||l,i=(new Date).getTime();if(console.log("请求完成时间:",(new Date).toLocaleTimeString()),console.log("请求耗时:",(i-n)/1e3,"秒"),console.log("收到检查响应:",a),a.error)return console.error("合同检查API返回错误:",a.error),void Ot["a"].error("合同文本检查失败: "+a.error);console.log("更新检查结果对象..."),I.totalIssues=a.totalIssues||0,I.criticalIssues=a.criticalIssues||0,I.warningIssues=a.warningIssues||0,I.suggestions=a.suggestions||0,I.legalComplianceIssues=a.legalComplianceIssues||[],I.completenessIssues=a.completenessIssues||[],I.riskAlerts=a.riskAlerts||[],I.totalIssues>0?(console.log(`发现${I.totalIssues}个问题，提示用户查看详情`),Ot["a"].warning(`发现${I.totalIssues}个问题，请查看详情`)):(console.log("未发现问题，提示用户合同文本质量良好"),Ot["a"].success("未发现明显问题，合同文本质量良好"),console.log("无问题时也自动展开法律合规性部分展示空结果"),c.value=["legalCompliance"]),I.legalComplianceIssues.length>0?(console.log("自动展开法律合规性部分"),c.value=["legalCompliance"]):I.completenessIssues.length>0?(console.log("自动展开条款完整性部分"),c.value=["clauseCompleteness"]):I.riskAlerts.length>0&&(console.log("自动展开风险提示部分"),c.value=["riskAlert"]),console.log("合同检查完成，结果:",I),console.log("%c========== 合同检查完成 ==========","background:#67c23a;color:white;padding:4px 8px;border-radius:4px;font-weight:bold;"),he.value=!0}catch(t){console.error("%c合同文本检查失败:","color:red;font-weight:bold;",t),console.error("错误详情:",JSON.stringify(t,null,2)),t.response&&(console.error("服务器响应:",t.response.status,t.response.statusText),console.error("响应数据:",t.response.data)),Ot["a"].error("合同文本检查失败: "+(t.message||"请稍后重试")),he.value=!1}finally{e&&(console.log("关闭加载提示"),e.close()),b.value=!1,console.log("重置检查状态 isChecking = false")}},R=Object(n["computed"])(()=>{const e=S.content||"",t=e.length;return t<=1e3?"约10秒":t<=5e3?"约30秒":t<=15e3?"约1分钟":t<=3e4?"约2分钟":"2-3分钟"}),Q=async()=>{if(!S.content)return void Ot["a"].warning("请先输入合同内容");le(),B.syntax=[],B.terminology=[],T.value=!1,k.value=!0,setTimeout(()=>{p.value=!0,console.log("AI分析开始，强制显示AI建议面板")},500);const e=new Promise((e,t)=>{setTimeout(()=>t(new Error("分析请求超时，服务器可能繁忙")),18e4)}),t=vt["a"].service({text:"AI正在分析文本，请稍候...",background:"rgba(255, 255, 255, 0.7)"}),n=S.content;w.value=n,C.value=Date.now(),n.length>1e4&&Ot["a"].warning("文本较长，分析可能需要较长时间，请耐心等待");try{const l={content:n,is_manual:!0,preferences:{style:i.style,contract_type:i.contractType,focus:i.focus,custom_terminologies:r.value}};console.log("发送分析请求，参数:",JSON.stringify(l,null,2));const c=await Promise.race([Object(Vt["a"])(o.value,l),e]);if(console.log("API返回结果:",c),c&&!c.error){const e=e=>{if(!Array.isArray(e))return[];const t=["合同名称","合同编号","合同金额","签约对方","签约日期","生效日期","到期日期","甲方名称","乙方名称","标题"];return e.filter(e=>!t.some(t=>e.original.includes(t)||e.suggested.includes(t)||e.explanation.includes(t)))};c.data&&c.data.syntax&&(B.syntax=e(c.data.syntax),console.log("语法建议:",B.syntax)),c.data&&c.data.terminology&&(B.terminology=e(c.data.terminology),console.log("术语建议:",B.terminology)),B.syntax.forEach((e,t)=>{e.id="syntax-"+t}),B.terminology.forEach((e,t)=>{e.id="term-"+t}),E.value&&setTimeout(()=>{ce()},100);const t=B.syntax.length+B.terminology.length;t>0?(p.value=!0,console.log("显示AI建议面板，共有建议:",t),Ot["a"].success(`AI分析完成：发现${t}条优化建议`)):(console.log("未找到任何建议"),Ot["a"].info("AI分析完成，未发现需要优化的内容"))}else console.error("AI分析返回结果异常:",c),Ot["a"].warning("AI分析未返回有效结果，请稍后重试")}catch(l){if(!l.message.includes("超时"))throw l;ft["a"].confirm("服务器响应时间过长，可能是文本较长或服务器繁忙。您希望如何处理？","请求超时",{confirmButtonText:"再试一次",cancelButtonText:"取消操作",type:"warning"}).then(()=>{Ot["a"].info("正在重新尝试分析..."),setTimeout(()=>{Q()},1e3)}).catch(()=>{Ot["a"].info("已取消AI分析操作")})}finally{t&&t.close(),k.value=!1}},M=Xt(()=>{console.log('内容已更改，可通过点击"AI润色分析"按钮进行分析')},3e3),U=()=>{console.log("调整高度，当前标签页:",l.value);const e=window.innerHeight,t=20;if("contractText"===l.value){if(!O.value||!v.value||!f.value)return void console.log("文本编辑容器未加载，跳过高度调整");const n=O.value.getBoundingClientRect(),l=n.top,c=Math.max(e-l-t,500);if(O.value.style.height=c+"px",m.value&&m.value.getQuill)try{const e=m.value.getQuill();e&&setTimeout(()=>{e.update()},100)}catch(o){console.warn("Quill编辑器刷新失败:",o)}}else if("contractCheck"===l.value){if(!y.value)return void console.log("合同检查容器未加载，跳过高度调整");const o=y.value.getBoundingClientRect(),n=o.top,l=Math.max(e-n-t+60,600);y.value.style.height=l+"px",console.log("已设置合同检查容器高度:",l)}},F=()=>{window.addEventListener("resize",U),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState&&(console.log("页面重新变为可见，调整布局"),Object(n["nextTick"])(()=>{U()}))})},Y=()=>{window.removeEventListener("resize",U)};Object(n["watch"])(()=>l.value,e=>{console.log("切换到标签页:",e),"contractText"===e?(console.log("处理合同文本标签页切换"),Object(n["nextTick"])(()=>{U(),me()}),E.value&&setTimeout(()=>{ce()},500)):"contractCheck"===e?(console.log("处理合同检查标签页切换"),Object(n["nextTick"])(()=>{S.content?console.log("合同内容已加载，检查页面准备就绪"):(console.log("合同内容未加载，提示用户先输入内容"),Ot["a"].info("请先在合同文本标签页输入合同内容，然后进行AI检查")),U(),N.value&&(console.log("强制刷新检查结果区域布局"),N.value.style.height="100%",console.log("使用el-scrollbar组件处理滚动"),N.value.style.display="none",setTimeout(()=>{N.value.style.display="flex"},50))})):"history"===e?(console.log("处理操作记录标签页切换"),Object(n["nextTick"])(()=>{S.content?console.log("合同内容已加载，操作记录页面准备就绪"):(console.log("合同内容未加载，提示用户先输入内容"),Ot["a"].info("请先在合同文本标签页输入合同内容，然后进行AI检查")),U(),N.value&&(console.log("强制刷新检查结果区域布局"),N.value.style.height="100%",console.log("使用el-scrollbar组件处理滚动"),N.value.style.display="none",setTimeout(()=>{N.value.style.display="flex"},50))})):(console.log("切换到其他标签页:",e),p.value=!1,be&&be.disconnect())});const J=()=>{p.value=!1,T.value=!1,console.log("隐藏面板，showAiSuggestions设置为false")},H=(e,t)=>{const o=B[e][t];if(m.value&&o)try{const n=m.value.getQuill();if(!n)throw new Error("无法获取编辑器实例");const l=n.root?n.root.scrollTop:0,c=n.getText(),a=S.content;let i=!1;const s=[()=>{const e=c.indexOf(o.original);return-1!==e&&(n.deleteText(e,o.original.length),n.insertText(e,o.suggested),!0)},()=>{const e=o.original.trim(),t=c.indexOf(e);return-1!==t&&(n.deleteText(t,e.length),n.insertText(t,o.suggested),!0)},()=>{const e=o.original.replace(/\s+/g," ").trim(),t=c.replace(/\s+/g," "),l=t.indexOf(e);if(-1!==l){const e=c.substring(0,l),a=o.original.match(/^\s+/)?o.original.match(/^\s+/)[0].length:0,i=l-(e.length-t.substring(0,l).length)+a,s=o.original.length;return n.deleteText(i,s),n.insertText(i,o.suggested),!0}return!1},()=>{try{const e=o.original.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),t=new RegExp(e,"g");if(a.match(t)){const e=a.replace(t,o.suggested);return S.content=e,!0}}catch(e){console.error("正则表达式匹配失败:",e)}return!1},()=>{try{const e=o.original.replace(/[\r\n]+/g," ").trim(),t=c.replace(/[\r\n]+/g," "),l=t.indexOf(e);if(-1!==l){let e=l;const t=o.original.length;return n.deleteText(e,t),n.insertText(e,o.suggested),!0}}catch(e){console.error("模糊匹配失败:",e)}return!1}];for(const e of s)if(e()){i=!0;break}i?(B[e].splice(t,1),Ot["a"].success("已采纳建议"),setTimeout(()=>{n&&n.root&&(n.root.scrollTop=l)},10),E.value&&(le(),(B.syntax.length>0||B.terminology.length>0)&&setTimeout(()=>ce(),100))):(Ot["a"].warning("无法找到匹配的文本，请手动编辑"),console.warn("未能找到匹配文本:",o.original))}catch(n){console.error("采纳建议出错:",n),Ot["a"].error("采纳建议时出错: "+(n.message||"未知错误"))}else Ot["a"].error("编辑器未初始化或建议信息不完整")},W=(e,t)=>{B[e].splice(t,1),Ot["a"].info("已忽略建议"),E.value&&(le(),(B.syntax.length>0||B.terminology.length>0)&&setTimeout(()=>ce(),100))},K=async()=>{if(0!==B.syntax.length||0!==B.terminology.length)try{const t=vt["a"].service({lock:!0,text:"应用所有建议...",background:"rgba(0, 0, 0, 0.7)"});if(!m.value||!m.value.getQuill)throw new Error("编辑器未初始化");const o=m.value.getQuill();if(!o)throw new Error("无法获取编辑器实例");const n=o.root?o.root.scrollTop:0,l=o.getText(),c=[...B.syntax,...B.terminology],a=(e,t)=>{const o=[()=>{const o=t.indexOf(e.original);return-1!==o?{index:o,length:e.original.length}:null},()=>{const o=e.original.trim(),n=t.indexOf(o);return-1!==n?{index:n,length:o.length}:null},()=>{const o=e.original.replace(/\s+/g," ").trim(),n=t.replace(/\s+/g," "),l=n.indexOf(o);if(-1!==l){const o=t.substring(0,l),n=o.length-o.replace(/\s/g,"").length,c=Math.max(0,l-n);return{index:c,length:e.original.length}}return null},()=>{const o=e.original.replace(/[\r\n]+/g," ").trim(),n=t.replace(/[\r\n]+/g," "),l=n.indexOf(o);return-1!==l?{index:l,length:e.original.length}:null}];for(const n of o){const e=n();if(e)return e}return null},i=c.map(e=>{const t=a(e,l);return t?{...e,index:t.index,length:t.length}:{...e,index:-1}}).filter(e=>-1!==e.index),s=i.sort((e,t)=>t.index-e.index);if(0===s.length)return t.close(),void Ot["a"].warning("未能找到任何匹配的建议文本");let r=0,d=0;for(const u of s)try{o.deleteText(u.index,u.length),o.insertText(u.index,u.suggested),r++}catch(e){console.error("替换建议失败:",e,u),d++}B.syntax=[],B.terminology=[],setTimeout(()=>{o&&o.root&&(o.root.scrollTop=n)},10),Ot["a"].success(`成功应用${r}项建议${d>0?`，${d}项失败`:""}`),t.close(),J()}catch(e){console.error("应用所有建议失败:",e),Ot["a"].error("应用所有建议失败: "+(e.message||"未知错误"))}else Ot["a"].info("没有待处理的建议")},X=()=>{j.value=!0;const e=vt["a"].service({lock:!0,text:"正在保存并生成Word文档...",background:"rgba(0, 0, 0, 0.7)"}),t=e=>e&&"string"===typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e)?e:null,n=e=>/^\d+(\.\d{1,2})?$/.test(e),l={title:S.title,type:S.type,amount:n(S.amount.replace(/[^\d.]/g,""))?S.amount.replace(/[^\d.]/g,""):null,company:S.company,sign_date:t(S.signDate),start_date:t(S.startDate),expire_date:t(S.expireDate),content:S.content};Object(Vt["j"])(o.value,l).then(()=>{const e=`/api/contract/contracts/${o.value}/download-docx/`,t=e=>{const t="; "+document.cookie,o=t.split(`; ${e}=`);return 2===o.length?o.pop().split(";").shift():""},n=t("csrftoken");console.log("CSRF令牌:",n||"未找到"),console.log("认证Cookie:",document.cookie);const l=localStorage.getItem("token");console.log("认证令牌:",l?"找到":"未找到"),Object(Nt["a"])({url:e,method:"GET",responseType:"blob",headers:{"X-CSRFToken":n,Authorization:l?"Bearer "+l:""}}).then(e=>{const t=new Blob([e.data],{type:e.headers["content-type"]||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),o=window.URL.createObjectURL(t),n=document.createElement("a");n.href=o,n.download=`${S.number||"合同"}_${S.title||"未命名"}.docx`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(o),Ot["a"].success("合同已保存并下载")}).catch(e=>{console.error("下载合同出错:",e),Ot["a"].error("下载失败: "+(e.message||"权限验证失败"))})}).catch(e=>{console.error("保存合同出错:",e),Ot["a"].error("保存失败，无法下载合同")}).finally(()=>{e.close(),j.value=!1})},G=e=>{const t=vt["a"].service({text:"正在查询相关法规...",background:"rgba(255, 255, 255, 0.7)"});Object(Nt["a"])({url:"/api/contract/regulation-query/",method:"post",data:{issue_title:e.title,issue_content:e.current,issue_problem:e.problem,contract_type:S.type}}).then(e=>{t.close(),ft["a"].alert(`<div class="regulation-detail">\n            <h4>适用法规: ${e.regulation||"《中华人民共和国合同法》"}</h4>\n            <div class="regulation-content">\n              <p>${e.regulation_content||"根据相关法律法规，合同中应明确约定双方权利义务，避免含糊不清的条款。"}</p>\n            </div>\n            <div class="regulation-suggestion mt-2">\n              <h5>修改建议:</h5>\n              <p>${e.suggestion||"建议参照相关法律法规，明确表述合同条款，确保合同的有效性和可执行性。"}</p>\n            </div>\n          </div>`,"法规详情",{dangerouslyUseHTMLString:!0,confirmButtonText:"了解",customClass:"regulation-dialog"})}).catch(e=>{t.close(),console.error("获取法规详情失败:",e),Ot["a"].error("获取法规详情失败，请稍后再试")})};Object(n["watch"])(()=>e.name,(e,t)=>{"ContractDetail"===t&&"ContractDetail"!==e&&(console.log("离开合同详情页面，重置状态"),o.value=null,h.value=!1,j.value=!1,k.value=!1,b.value=!1)},{immediate:!0}),Object(n["watch"])(()=>e.params.id,(n,l)=>{if("ContractDetail"===e.name)if(n&&"undefined"!==n&&!isNaN(Number(n))){const e=Number(n),t=l?Number(l):null;if(e!==t){console.log("合同ID已变更，加载新合同",n),o.value=e;const t=!l||"complete"!==document.readyState;P(t)}}else console.log("无效的合同ID参数:",n),t.push({name:"Contract"})},{immediate:!0});const Z=()=>{const e=document.getElementById("aiFloatingButton");e&&document.body.removeChild(e);const t=document.createElement("div");t.id="aiFloatingButton",t.className="ai-floating-button",t.innerHTML='\n        <button class="el-button el-button--primary el-button--small is-circle">\n          <i class="el-icon">\n            <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">\n              <path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm0 832a384 384 0 0 0 0-768 384 384 0 0 0 0 768zm-94.656-298.656a32 32 0\n                0 0 45.312 45.312l96-96a32 32 0 0 0 0-45.312l-96-96a32 32 0 0 0-45.312 45.312L466.752 512l-49.408 49.344z"></path>\n            </svg>\n          </i>\n        </button>\n      ';const o=document.createElement("style");o.textContent="\n        .ai-floating-button {\n          position: fixed;\n          top: 50%;\n          right: 0;\n          transform: translateY(-50%);\n          z-index: 2000;\n          background-color: #fff;\n          border-top-left-radius: 50%;\n          border-bottom-left-radius: 50%;\n          box-shadow: -2px 0 10px rgba(0,0,0,0.1);\n          padding: 10px 5px 10px 10px;\n          cursor: pointer;\n          transition: all 0.3s ease;\n        }\n        .ai-floating-button:hover {\n          right: 5px;\n        }\n        .ai-floating-button button {\n          margin: 0;\n        }\n      ",document.head.appendChild(o),t.addEventListener("click",()=>{p.value=!0,console.log("点击展开按钮，showAiSuggestions设置为true")}),document.body.appendChild(t)},ee=()=>{const e=document.getElementById("aiFloatingButton");e&&("contractText"!==l.value||p.value?e.style.display="none":e.style.display="block")};Object(n["watch"])([p,l],()=>{ee()});const te=e=>{try{console.log("开始采纳建议:",e);let t=!1,o=null,n=-1;for(let l=0;l<B.syntax.length;l++)if(B.syntax[l].id===e){t=!0,o="syntax",n=l;break}if(!t)for(let l=0;l<B.terminology.length;l++)if(B.terminology[l].id===e){t=!0,o="terminology",n=l;break}return t&&o&&n>-1?(console.log("找到建议位置:",o,n),H(o,n),!0):(console.error("未找到对应建议:",e),Ot["a"].warning("无法找到对应的建议，请从侧边栏采纳"),!1)}catch(t){return console.error("采纳内联建议失败:",t),Ot["a"].error("采纳建议失败: "+(t.message||"未知错误")),!1}},oe=e=>{try{console.log("开始忽略建议:",e);let t=!1,o=null,n=-1;for(let l=0;l<B.syntax.length;l++)if(B.syntax[l].id===e){t=!0,o="syntax",n=l;break}if(!t)for(let l=0;l<B.terminology.length;l++)if(B.terminology[l].id===e){t=!0,o="terminology",n=l;break}return t&&o&&n>-1?(W(o,n),!0):(console.warn("未找到要忽略的建议:",e),!1)}catch(t){return console.error("忽略建议出错:",t),Ot["a"].error("忽略建议失败: "+(t.message||"未知错误")),!1}},ne=()=>{try{if(!m.value)return null;if(m.value.$el&&"function"===typeof m.value.$el.querySelector)return m.value.$el.querySelector(".ql-editor");if(m.value.container)return m.value.container.querySelector(".ql-editor");if(m.value.getQuill){const e=m.value.getQuill();if(e&&e.root)return e.root}return document.querySelector(".contract-text-editor .ql-editor")}catch(e){return console.error("获取编辑器元素失败:",e),null}},le=()=>{const e=ne();if(e)try{const t=e.querySelectorAll(".suggestion-highlight");t.forEach(e=>{const t=e.textContent,o=e.parentNode;if(o){const n=document.createTextNode(t);o.replaceChild(n,e)}})}catch(t){console.error("清除建议高亮失败:",t)}else console.warn("无法获取编辑器元素，跳过清除操作")},ce=()=>{try{var e;const t=[...B.syntax||[],...B.terminology||[]];if(!t.length)return;le();const o=ne();if(!o)return console.warn("无法获取编辑器元素，无法应用内联建议"),void(p.value=!0);const n=null===(e=m.value)||void 0===e?void 0:e.getQuill();if(!n)return void console.warn("无法获取Quill编辑器实例");const l=n.getText();let c=0;const a=e=>e.replace(/\s+/g," ").trim(),i=[...t].sort((e,t)=>t.original.length-e.original.length),s=(e,t)=>{const o=e.indexOf(t);if(-1!==o)return{index:o,length:t.length};const n=t.trim(),l=e.indexOf(n);if(-1!==l)return{index:l,length:n.length};const c=a(e),i=a(t),s=c.indexOf(i);if(-1!==s){let o=-1,n=0;for(let t=0;t<e.length;t++)if(a(e.substring(0,t+1)).length>n&&n++,n===s+1){o=t-i.length+1;break}if(-1!==o)return{index:o,length:t.length}}return{index:-1,length:0}};if(i.forEach(e=>{try{if(!e.original||0===e.original.length)return void console.warn("忽略空的原始文本建议");const o=s(l,e.original);if(-1===o.index)return void console.warn(`未找到原始文本: "${e.original.substring(0,30)}${e.original.length>30?"...":""}"，跳过高亮。`);e.id||(e.id="suggestion-"+Math.random().toString(36).substring(2,9));try{const t={"background-color":"rgba(255, 217, 102, 0.3)","border-bottom":"1px dashed #ffb300",cursor:"pointer","data-suggestion-id":e.id,"data-original":e.original,"data-suggested":e.suggested,"data-explanation":e.explanation||"",title:"点击查看修改建议",class:"suggestion-highlight",style:"pointer-events: auto !important; cursor: pointer !important; z-index: 9999 !important; position: relative !important;"};n.formatText(o.index,o.length,t,"api"),setTimeout(()=>{const t=document.querySelectorAll(`[data-suggestion-id="${e.id}"]`);t.length>0?t.forEach(t=>{t.setAttribute("data-original",e.original),t.setAttribute("data-suggested",e.suggested),e.explanation&&t.setAttribute("data-explanation",e.explanation),t.style.setProperty("pointer-events","auto","important"),t.style.setProperty("cursor","pointer","important"),t.style.setProperty("position","relative","important"),t.style.setProperty("z-index","9999","important"),t.classList.add("suggestion-highlight"),t.addEventListener("click",(function(o){o.preventDefault(),o.stopPropagation(),console.log("高亮元素点击 - addEventListener:",e.id),fe(t,o)}),!0),t.onclick=function(o){o.preventDefault(),o.stopPropagation(),console.log("高亮元素点击 - onclick:",e.id),fe(t,o)}}):console.warn("未找到高亮元素 ID:"+e.id)},200),c++}catch(t){console.error("应用Quill格式失败:",t)}}catch(t){console.error("处理建议失败:",t,e)}}),c>0){Ot["a"].info(`在编辑器中高亮了${c}条建议修改，点击高亮部分可查看详情`),document.removeEventListener("click",ye,!0),document.addEventListener("click",ye,!0),console.log("添加文档级高亮点击事件委托");const e=ne();e&&(e.removeEventListener("click",ve,!0),e.addEventListener("click",ve,!0),console.log("已重新绑定编辑器高亮点击事件"))}else t.length>0&&(Ot["a"].warning("无法在当前文本中匹配建议内容，建议在侧边栏查看"),p.value=!0)}catch(t){console.error("应用内联建议失败:",t),p.value=!0}},ae=(e,t,o)=>{const n=e.getBoundingClientRect();o.innerHTML="",window.activeSuggestionTooltip=o;let l="";l=window.enhancedDiffDisplay?window.enhancedDiffDisplay(t.original,t.suggested):se(t.original,t.suggested);const c=document.createElement("div");c.className="suggestion-tooltip-content",c.innerHTML=`\n        <div class="suggestion-tooltip-header">\n          <span class="suggestion-tooltip-title">AI文本优化建议</span>\n          <span class="suggestion-tooltip-close">&times;</span>\n        </div>\n        <div class="suggestion-tooltip-body">\n          <div class="suggestion-comparison">\n            <div class="suggestion-column">\n              <div class="suggestion-label">原文本:</div>\n              <div class="suggestion-original">${ie(t.original)}</div>\n            </div>\n            <div class="suggestion-divider"></div>\n            <div class="suggestion-column">\n              <div class="suggestion-label">建议修改为:</div>\n              <div class="suggestion-suggested">${ie(t.suggested)}</div>\n            </div>\n          </div>\n          <div class="suggestion-diff-container">\n            <div class="suggestion-label">差异对比:</div>\n            <div class="suggestion-diff">${l}</div>\n          </div>\n          ${t.explanation?`\n          <div class="suggestion-explanation-container">\n            <div class="suggestion-label">修改说明:</div>\n            <div class="suggestion-explanation">${ie(t.explanation)}</div>\n          </div>`:""}\n        </div>\n        <div class="suggestion-actions">\n          <button class="btn-adopt" type="button">采纳此建议</button>\n          <button class="btn-ignore" type="button">忽略</button>\n        </div>\n      `,o.appendChild(c),o.style.position="absolute",o.style.top=n.bottom+window.scrollY+5+"px",o.style.left=n.left+window.scrollX+"px",o.style.display="block",setTimeout(()=>{const e=o.getBoundingClientRect();e.right>window.innerWidth&&(o.style.left=Math.max(10,window.innerWidth-e.width-10)+"px"),e.bottom>window.innerHeight&&(o.style.top=Math.max(10,window.innerHeight-e.height-10)+window.scrollY+"px")},0);const a=o.querySelector(".btn-adopt"),i=o.querySelector(".btn-ignore"),s=o.querySelector(".suggestion-tooltip-close"),r=a.cloneNode(!0),d=i.cloneNode(!0),u=s.cloneNode(!0);a.parentNode.replaceChild(r,a),i.parentNode.replaceChild(d,i),s.parentNode.replaceChild(u,s),r.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),console.log("采纳建议:",t.id);try{te(t.id),o.style.display="none"}catch(n){console.error("采纳建议出错:",n),Ot["a"].error("采纳建议时出错，请稍后再试")}}),d.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),console.log("忽略建议:",t.id);try{oe(t.id),o.style.display="none"}catch(n){console.error("忽略建议出错:",n),Ot["a"].error("忽略建议时出错，请稍后再试")}}),u.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),o.style.display="none"});const g=t=>{o.contains(t.target)||e.contains(t.target)||(o.style.display="none",document.removeEventListener("click",g))};setTimeout(()=>{document.removeEventListener("click",g),document.addEventListener("click",g)},100)},ie=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),se=(e,t)=>{try{if(!e||!t)return"";const o=e=>e.split(/([,.!?;:，。！？；：\s]+|[\u4e00-\u9fa5])/g).filter(e=>""!==e),n=o(e),l=o(t);let c='<div class="diff-content">';const a=new Set,i=[];for(let e=0;e<n.length;e++)for(let t=0;t<l.length;t++)if(n[e]===l[t]&&!a.has("2:"+t)){i.push({index1:e,index2:t,token:n[e]}),a.add("2:"+t);break}i.sort((e,t)=>e.index2-t.index2);let s=-1,r=-1;for(const e of i){if(e.index1>s+1){c+='<span class="diff-removed">';for(let t=s+1;t<e.index1;t++)c+=ie(n[t]);c+="</span>"}if(e.index2>r+1){c+='<span class="diff-added">';for(let t=r+1;t<e.index2;t++)c+=ie(l[t]);c+="</span>"}c+=`<span class="diff-common">${ie(e.token)}</span>`,s=e.index1,r=e.index2}if(s<n.length-1){c+='<span class="diff-removed">';for(let e=s+1;e<n.length;e++)c+=ie(n[e]);c+="</span>"}if(r<l.length-1){c+='<span class="diff-added">';for(let e=r+1;e<l.length;e++)c+=ie(l[e]);c+="</span>"}return c+="</div>",c}catch(o){return console.error("生成差异对比失败:",o),`<div class="diff-error">无法生成差异对比: ${o.message}</div>`}},re=e=>{e?(Ot["a"].info("已启用内联建议，润色结果将直接显示在编辑器中"),setTimeout(()=>{ne()?B.syntax.length>0||B.terminology.length>0?w.value===S.content?(ce(),Ot["a"].success("已将现有建议应用到编辑器中")):Ot["a"].warning('内容已更改，请重新点击"AI润色分析"按钮获取最新建议'):Ot["a"].info('没有可应用的建议，请点击"AI润色分析"按钮获取建议'):(console.warn("无法获取编辑器元素，将使用侧边栏显示建议"),p.value=!0,E.value=!1)},100)):(Ot["a"].info("已禁用内联建议，建议将只在侧边栏显示"),setTimeout(()=>{try{le()}catch(e){console.error("清除建议标记失败:",e)}},100))},de=()=>{const e=e=>{e.ctrlKey&&e.shiftKey&&"a"===e.key.toLowerCase()&&("contractText"!==l.value||k.value||(e.preventDefault(),Q(),Ot["a"].info("已通过快捷键触发AI润色分析"))),e.ctrlKey&&e.shiftKey&&"c"===e.key.toLowerCase()&&("contractCheck"!==l.value||b.value||(e.preventDefault(),z(),Ot["a"].info("已通过快捷键触发AI合同检查")))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}};Object(n["onMounted"])(async()=>{const t=history.state.newContractData;if(t){console.log("检测到导航状态中的新合同数据，直接填充:",t);const e=e=>{Object.keys(S).forEach(t=>{t in e&&(S[t]=e[t])}),e.sign_date&&(S.signDate=e.sign_date),e.start_date&&(S.startDate=e.start_date),e.expire_date&&(S.expireDate=e.expire_date),e.amount&&(S.amount=Number(e.amount).toLocaleString("zh-CN"))};e(t),h.value=!1,Ot["a"].success("AI生成合同加载成功")}else"ContractDetail"===e.name&&o.value?(console.log("组件挂载，开始加载合同详情:",o.value),await P(!0)):console.log("组件挂载但不在合同详情页面或合同ID无效，跳过加载");console.log("组件挂载完成，UI初始化"),setTimeout(()=>{if(N.value){console.log("强制修复滚动区域样式"),N.value.style.display="flex",N.value.style.flexDirection="column",N.value.style.overflow="hidden",N.value.style.height="100%";const e=N.value.querySelector(".check-content-scroll-wrapper");e&&(e.style.flex="1",e.style.overflowY="auto",e.style.padding="15px",e.style.height="0")}},300),pe(),Object(n["nextTick"])(()=>{U(),F(),me()}),"contractText"===l.value&&console.log("直接进入文本编辑标签，可以点击润色按钮进行分析"),Z(),ee();const c=de();ge.value=c,document.addEventListener("visibilitychange",ue);const a=document.createElement("style");a.id="suggestion-highlight-fix-style",a.textContent="\n        /* 单独的通用高亮样式 */\n        .suggestion-highlight, \n        [data-suggestion-id],\n        body .ql-editor .suggestion-highlight,\n        body .ql-editor [data-suggestion-id],\n        .ql-container .ql-editor .suggestion-highlight,\n        .ql-container .ql-editor [data-suggestion-id] {\n          pointer-events: auto !important; /* 确保点击事件可以触发 */\n          cursor: pointer !important;\n          background-color: rgba(255, 217, 102, 0.3) !important;\n          border-bottom: 1px dashed #ffb300 !important;\n          z-index: 9999 !important; /* 提高z-index确保在最上层 */\n          position: relative !important;\n        }\n        \n        /* 确保tooltip容器也具有足够的z-index */\n        .suggestion-tooltip,\n        #suggestion-tooltip-container {\n          position: fixed !important; /* 改为fixed定位，避免受父级影响 */\n          z-index: 10000 !important; /* 比高亮元素更高 */\n          pointer-events: auto !important;\n          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2) !important;\n        }\n\n        /* 确保Quill编辑器不会阻止点击事件传播 */\n        .ql-editor {\n          position: relative !important;\n        }\n      ",document.head.appendChild(a),Object(n["nextTick"])(()=>{U(),me(),F()})});const ue=()=>{document.hidden||(console.log("页面重新获得焦点，调整布局高度"),setTimeout(U,100))};Object(n["onUnmounted"])(()=>{const e=document.getElementById("aiFloatingButton");e&&document.body.removeChild(e),o.value=null;const t=document.querySelector(".ql-suggestion-tooltip");t&&document.body.removeChild(t);const n=document.getElementById("suggestion-styles");if(n&&document.head.removeChild(n),m.value)try{const e=m.value.getQuill();if(e){const t=e.getModule("suggestion");t&&"function"===typeof t.destroy&&t.destroy()}}catch(c){console.error("清理建议模块失败:",c)}ge.value&&ge.value(),Y(),be&&(be.disconnect(),be=null),document.removeEventListener("visibilitychange",ue),document.removeEventListener("click",ye,!0);const l=document.getElementById("suggestion-highlight-fix-style");l&&document.head.removeChild(l)});const ge=Object(n["ref"])(null);let be=null;const me=()=>{be&&be.disconnect(),"contractText"===l.value&&O.value&&(be=new MutationObserver(()=>{U()}),be.observe(O.value,{childList:!0,subtree:!0,attributes:!0}),console.log("已设置DOM变化监听器"))},pe=()=>{if("undefined"!==typeof window&&window.Quill){try{console.log("Quill已加载，初始化扩展"),eo(),setTimeout(()=>{const e=ne();e||(console.warn("Quill编辑器DOM元素无法访问，可能导致某些功能不可用"),E.value=!1)},300)}catch(s){console.error("初始化Quill扩展失败:",s),E.value=!1}return}console.log("Quill未加载，尝试加载资源");const e=[{js:window.location.origin+"/static/lib/quill/quill.min.js",css:window.location.origin+"/static/lib/quill/quill.snow.css"},{js:"https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js",css:"https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css"},{js:"https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.min.js",css:"https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.snow.css"},{js:"https://unpkg.com/quill@1.3.7/dist/quill.min.js",css:"https://unpkg.com/quill@1.3.7/dist/quill.snow.css"}];let t=0;const o=e.length,n=e=>new Promise((t,o)=>{const n=document.getElementById("quill-snow-css");n&&document.head.removeChild(n);const l=document.createElement("link");l.rel="stylesheet",l.id="quill-snow-css",l.href=e,l.onload=()=>{console.log("Quill CSS 加载成功:",e),t()},l.onerror=()=>{console.error("Quill CSS 加载失败:",e),o()},document.head.appendChild(l)}),c=e=>new Promise((t,o)=>{const n=document.getElementById("quill-js");n&&document.body.removeChild(n);const l=document.createElement("script");l.src=e,l.id="quill-js",l.async=!0,l.onload=()=>{console.log("Quill JS 加载成功:",e),t()},l.onerror=()=>{console.error("Quill JS 加载失败:",e),o()},document.body.appendChild(l)}),a=()=>{if(t>=o)return console.error("所有Quill资源加载尝试都失败了"),void i();const r=e[t];t++,console.log(`尝试加载Quill资源 (${t}/${o}):`,r),n(r.css).then(()=>c(r.js)).then(()=>{console.log("Quill资源加载完成，初始化扩展"),setTimeout(()=>{try{window.Quill?(eo(),"contractText"===l.value&&E.value&&setTimeout(ce,500)):(console.error("Quill未能正确加载，脚本可能已执行但Quill对象未定义"),a())}catch(s){console.error("初始化Quill扩展失败:",s),a()}},300)}).catch(()=>{console.log("资源加载失败，尝试下一个源"),a()})},i=()=>{Ot["a"].warning("高级编辑器加载失败，使用基本编辑器功能"),E.value=!1,p.value=!0;const e=document.createElement("style");e.id="quill-basic-styles",e.textContent="\n          .ql-container{border:1px solid #ccc;font-family:sans-serif;}\n          .ql-editor{min-height:300px;padding:12px 15px;}\n          .ql-toolbar{border-top:none;border-left:none;border-right:none;border-bottom:1px solid #e0e0e0;background-color:#f8f9fa;}\n        ",document.head.appendChild(e)};a()};Object(n["onMounted"])(()=>{P();const e=localStorage.getItem("customTerminologies");if(e)try{r.value=JSON.parse(e)}catch(c){console.error("解析存储的术语出错:",c)}const t=localStorage.getItem("polishPreferences");if(t)try{const e=JSON.parse(t);e.focus&&!Array.isArray(e.focus)&&(e.focus=["grammar","terminology"]),Object.assign(i,e),console.log("已加载润色偏好设置:",i)}catch(c){console.error("解析存储的润色偏好出错:",c)}const o=localStorage.getItem("checkPreferences");if(o)try{const e=JSON.parse(o);Object.assign(s,e),console.log("已加载检查偏好设置:",s)}catch(c){console.error("解析存储的检查偏好出错:",c)}const l=ne();l&&(l.addEventListener("click",ve,!0),setTimeout(()=>{document.addEventListener("click",(function(e){let t=e.target;if(t.classList&&t.classList.contains("suggestion-highlight")||t.hasAttribute&&t.hasAttribute("data-suggestion-id")){console.log("全局点击监听捕获到高亮元素点击");const o=t.getAttribute("data-suggestion-id");if(!o)return;fe(t,e)}}),!0)},500)),Object(n["nextTick"])(()=>{U(),me(),F()})}),Object(n["watch"])(i,e=>{console.log("保存润色偏好:",e),localStorage.setItem("polishPreferences",JSON.stringify({style:e.style,contractType:e.contractType,focus:e.focus}))},{deep:!0}),Object(n["watch"])(()=>S.content,(e,t)=>{e&&e!==t&&e!==w.value&&(le(),M())}),Object(n["watch"])(s,e=>{console.log("保存检查偏好:",e),localStorage.setItem("checkPreferences",JSON.stringify(e))},{deep:!0}),Object(n["onBeforeUnmount"])(()=>{Y(),document.removeEventListener("visibilitychange",()=>{}),be&&be.disconnect();const e=document.getElementById("suggestion-highlight-fix-style");e&&document.head.removeChild(e),console.log("组件即将卸载，已清理所有事件监听器")});const he=Object(n["ref"])(!1);function je(){if(m.value&&m.value.getQuill){const e=m.value.getQuill();e&&e.root&&(e.root.scrollTop=e.root.scrollHeight)}}function Oe(){}function ve(e){try{console.log("捕获到编辑器点击事件",e.target);let t=e.target;const o=e=>!!e&&(e.classList&&e.classList.contains("suggestion-highlight")||e.hasAttribute&&e.hasAttribute("data-suggestion-id")||e.getAttribute&&e.getAttribute("data-suggestion-id"));if(o(t))return console.log("直接匹配到高亮元素"),e.preventDefault(),e.stopPropagation(),void fe(t,e);while(t&&t!==document.body){if(o(t))return console.log("在父级找到高亮元素"),e.preventDefault(),e.stopPropagation(),void fe(t,e);t=t.parentElement}const n=e.target.querySelectorAll&&e.target.querySelectorAll(".suggestion-highlight, [data-suggestion-id]");if(n&&n.length>0)return console.log("在子元素中找到高亮元素"),e.preventDefault(),e.stopPropagation(),void fe(n[0],e)}catch(t){console.error("高亮点击处理出错:",t)}}function fe(e,t){t.preventDefault(),t.stopPropagation();const o=e.getAttribute("data-suggestion-id");if(!o)return void console.error("未找到suggestion-id属性");console.log("处理高亮元素点击:",o);const n=e.getAttribute("data-original"),l=e.getAttribute("data-suggested"),c=e.getAttribute("data-explanation")||"";if(n&&l){const t={id:o,original:n,suggested:l,explanation:c};let a=document.getElementById("suggestion-tooltip-container");return a||(a=document.createElement("div"),a.id="suggestion-tooltip-container",a.className="suggestion-tooltip",a.style.display="none",document.body.appendChild(a)),ae(e,t,a),void console.log("从DOM属性显示建议:",t)}let a=null;for(let s=0;s<B.syntax.length;s++)if(B.syntax[s].id===o){a=B.syntax[s];break}if(!a)for(let s=0;s<B.terminology.length;s++)if(B.terminology[s].id===o){a=B.terminology[s];break}if(!a)return console.error("无法找到对应的建议内容:",o),void Ot["a"].warning("无法找到对应的建议内容");let i=document.getElementById("suggestion-tooltip-container");i||(i=document.createElement("div"),i.id="suggestion-tooltip-container",i.className="suggestion-tooltip",i.style.display="none",document.body.appendChild(i)),ae(e,a,i)}function ye(e){let t=e.target;const o=e=>e.classList&&e.classList.contains("suggestion-highlight")||e.hasAttribute&&e.hasAttribute("data-suggestion-id");if(o(t))return console.log("文档级事件捕获到高亮点击"),e.preventDefault(),e.stopPropagation(),void fe(t,e);while(t&&t!==document.body){if(o(t))return console.log("文档级事件捕获到高亮父元素点击"),e.preventDefault(),e.stopPropagation(),void fe(t,e);t=t.parentElement}}return Object(n["onMounted"])(()=>{const e=ne();e&&e.addEventListener("click",ve,!0)}),Object(n["onBeforeUnmount"])(()=>{const e=ne();e&&e.removeEventListener("click",ve,!0)}),Object(n["watch"])(l,e=>{"contractText"===e?E.value&&(le(),w.value===S.content&&(B.syntax.length>0||B.terminology.length>0)&&setTimeout(()=>{ce()},300)):le()}),Object(n["onMounted"])(()=>{document.addEventListener("click",(function(e){let t=e.target;if(t.classList&&t.classList.contains("suggestion-highlight")||t.hasAttribute&&t.hasAttribute("data-suggestion-id")){console.log("全局点击监听捕获到高亮元素点击");const o=t.getAttribute("data-suggestion-id");if(!o)return;let n=null;for(const e of B.syntax)if(e.id===o){n=e;break}if(!n)for(const e of B.terminology)if(e.id===o){n=e;break}n&&fe(t,e)}}))}),Object(n["watch"])(()=>e.query._refresh,t=>{t&&"ContractDetail"===e.name&&(console.log("检测到刷新参数变化，强制刷新合同详情:",t),P(!1))}),{activeTab:l,activeCollapse:c,activeSuggestionCollapse:a,contractId:o,contractDetails:S,contractTitle:A,checkResult:I,aiSuggestions:B,contractHistory:L,polishPreferences:i,checkPreferences:s,customTerminologies:r,newTerminology:d,addCustomTerminology:u,removeCustomTerminology:g,isChecking:b,quillEditor:m,editorOption:D,showAiSuggestions:p,goBack:q,saveChanges:$,isLoading:h,isSaving:j,isRealTimePolishing:x,realTimePolishLoading:k,toggleAiPanelCollapse:_,isAiPanelCollapsed:T,adoptInlineEditSuggestion:te,ignoreInlineEditSuggestion:oe,applyInlineSuggestions:ce,enableInlineSuggestions:E,onInlineSuggestionsToggle:re,debouncedAnalyzeText:M,clearInlineEditSuggestions:le,showSuggestionTooltip:ae,generateDiff:se,manualAnalyzeText:Q,estimatedTime:R,startContractCheck:z,viewRegulation:G,downloadContract:X,adoptSuggestion:H,ignoreSuggestion:W,applyAllSuggestions:K,hideAiPanel:J,contractEditContainer:O,aiPolishSidebar:v,editorMainArea:f,contractCheckContainer:y,checkSidebar:V,checkResultArea:N,scrollQuillToBottom:je,onContractContentChange:Oe}}},oo=(o("2d51"),o("5016"),o("935a"),o("3c41"),o("4c1b"),o("6b0d")),no=o.n(oo);const lo=no()(to,[["render",ht],["__scopeId","data-v-0b2bc0a7"]]);t["default"]=lo},3590:function(e,t,o){},"35ad":function(e,t,o){"use strict";o.d(t,"h",(function(){return c})),o.d(t,"g",(function(){return a})),o.d(t,"c",(function(){return i})),o.d(t,"j",(function(){return s})),o.d(t,"e",(function(){return r})),o.d(t,"i",(function(){return d})),o.d(t,"d",(function(){return u})),o.d(t,"b",(function(){return g})),o.d(t,"a",(function(){return b})),o.d(t,"f",(function(){return m}));o("d9e2");var n=o("b775"),l=o("c24f");function c(e){return Object(n["a"])({url:"/api/contract/contracts/",method:"get",params:e})}function a(e){return Object(n["a"])({url:`/api/contract/contracts/${e}/`,method:"get"})}function i(e){return Object(n["a"])({url:"/api/contract/contracts/",method:"post",data:e})}function s(e,t){return Object(n["a"])({url:`/api/contract/contracts/${e}/`,method:"put",data:t})}function r(e){return Object(n["a"])({url:`/api/contract/contracts/${e}/`,method:"delete"})}function d(e){return Object(n["a"])({url:"/api/contract/contracts/template_suggestions/",method:"get",params:e})}function u(e,t){return Object(n["a"])({url:`/api/contract/templates/${e}/use_template/`,method:"post",data:t})}function g(e,t){if(!e||isNaN(Number(e)))return console.error("无效的合同ID:",e),Promise.reject(new Error("无效的合同ID"));if(!t||!t.content)return console.error("无效的合同内容:",t),Promise.reject(new Error("合同内容不能为空"));const o=t&&t.content?t.content.length:0;return console.log(`调用checkContract API - ID: ${e}, 内容长度: ${o}`),Object(n["a"])({url:`/api/contract/contracts/${e}/check_contract/`,method:"post",data:t,timeout:18e4}).catch(e=>{throw console.error("合同检查API错误:",e),e})}function b(e,t,o){if(!t||!t.content)return console.error("无效的合同内容:",t),Promise.reject(new Error("合同内容不能为空"));const l=t&&t.content?t.content.length:0;return console.log(`调用aiPolishContract API - ID: ${e}, 内容长度: ${l}`),Object(n["a"])({url:`/api/contract/contracts/${e}/ai_polish/`,method:"post",data:t,signal:o}).then(e=>(console.log("AI润色返回数据:",e),e)).catch(e=>{throw console.error("AI润色API错误:",e),e})}const{getCompanyUsers:m}=l["a"]},"38f5":function(e,t,o){},"3c41":function(e,t,o){"use strict";o("7d8d")},"4c1b":function(e,t,o){"use strict";o("38f5")},5016:function(e,t,o){"use strict";o("cc30")},5494:function(e,t,o){"use strict";var n=o("83ab"),l=o("e330"),c=o("edd0"),a=URLSearchParams.prototype,i=l(a.forEach);n&&!("size"in a)&&c(a,"size",{get:function(){var e=0;return i(this,(function(){e++})),e},configurable:!0,enumerable:!0})},"5ea3":function(e,t,o){"use strict";(function(e){var o="object"==typeof e&&e&&e.Object===Object&&e;t["a"]=o}).call(this,o("c8ba"))},"7b3e":function(e,t,o){},"7d8d":function(e,t,o){},"88a7":function(e,t,o){"use strict";var n=o("cb2d"),l=o("e330"),c=o("577e"),a=o("d6d6"),i=URLSearchParams,s=i.prototype,r=l(s.append),d=l(s["delete"]),u=l(s.forEach),g=l([].push),b=new i("a=1&a=2&b=3");b["delete"]("a",1),b["delete"]("b",void 0),b+""!=="a=2"&&n(s,"delete",(function(e){var t=arguments.length,o=t<2?void 0:arguments[1];if(t&&void 0===o)return d(this,e);var n=[];u(this,(function(e,t){g(n,{key:t,value:e})})),a(t,1);var l,i=c(e),s=c(o),b=0,m=0,p=!1,h=n.length;while(b<h)l=n[b++],p||l.key===i?(p=!0,d(this,l.key)):m++;while(m<h)l=n[m++],l.key===i&&l.value===s||r(this,l.key,l.value)}),{enumerable:!0,unsafe:!0})},"935a":function(e,t,o){"use strict";o("7b3e")},ca54:function(e,t,o){"use strict";var n=o("26ee"),l=n["a"].Symbol;t["a"]=l},cc30:function(e,t,o){},d6d6:function(e,t,o){"use strict";var n=TypeError;e.exports=function(e,t){if(e<t)throw new n("Not enough arguments");return e}},f0ce:function(e,t,o){"use strict";var n=o("ca54"),l=Object.prototype,c=l.hasOwnProperty,a=l.toString,i=n["a"]?n["a"].toStringTag:void 0;function s(e){var t=c.call(e,i),o=e[i];try{e[i]=void 0;var n=!0}catch(s){}var l=a.call(e);return n&&(t?e[i]=o:delete e[i]),l}var r=s,d=Object.prototype,u=d.toString;function g(e){return u.call(e)}var b=g,m="[object Null]",p="[object Undefined]",h=n["a"]?n["a"].toStringTag:void 0;function j(e){return null==e?void 0===e?p:m:h&&h in Object(e)?r(e):b(e)}t["a"]=j}}]);
//# sourceMappingURL=chunk-0c5bcbf5.48c0cd9c.js.map