(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-63b4299e","chunk-2d0e4842"],{"910d":function(e,t,a){"use strict";var l=a("23e7"),c=a("c65b"),d=a("59ed"),n=a("825a"),o=a("46c4"),s=a("c5cc"),i=a("9bdd"),r=a("c430"),b=a("2a62"),m=a("f99f"),u=!r&&m("filter",TypeError),h=s((function(){var e,t,a,l=this.iterator,d=this.predicate,o=this.next;while(1){if(e=n(c(o,l)),t=this.done=!!e.done,t)return;if(a=e.value,i(l,d,[a,this.counter++],!0))return a}}));l({target:"Iterator",proto:!0,real:!0,forced:r||u},{filter:function(e){n(this);try{d(e)}catch(t){b(this,"throw",t)}return u?c(u,this,e):new h(o(this),{predicate:e})}})},d724:function(e,t,a){"use strict";a.r(t);var l=a("7a23");const c={class:"contract-template-management"},d={class:"actions"},n={class:"template-list"},o={key:0,class:"loading-spinner"},s={key:1,class:"empty-state"},i={key:2,class:"table-responsive"},r={class:"table table-hover align-middle"},b={class:"badge bg-secondary"},m={class:"form-check form-switch d-flex align-items-center"},u=["id","onUpdate:modelValue","onChange"],h=["for"],p=["onClick"],j={class:"modal fade",id:"deleteConfirmModal",tabindex:"-1","aria-hidden":"true"},O={class:"modal-dialog modal-dialog-centered"},v={class:"modal-content"},E={class:"modal-body text-center py-4"},f={class:"mb-1"},y={class:"modal-footer"},V=["disabled"],g={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"};function N(e,t,a,N,w,k){var x;const C=Object(l["resolveComponent"])("router-link");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",c,[t[12]||(t[12]=Object(l["createElementVNode"])("h1",{class:"page-title"},"合同模板管理",-1)),Object(l["createElementVNode"])("div",d,[Object(l["createVNode"])(C,{to:{name:"AdminContractTemplateNew"},class:"btn btn-primary"},{default:Object(l["withCtx"])(()=>t[1]||(t[1]=[Object(l["createElementVNode"])("i",{class:"bi bi-plus-lg"},null,-1),Object(l["createTextVNode"])(" 新建模板 ")])),_:1})]),Object(l["createElementVNode"])("div",n,[w.loading?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",o,t[2]||(t[2]=[Object(l["createElementVNode"])("div",{class:"spinner-border text-primary",role:"status"},[Object(l["createElementVNode"])("span",{class:"visually-hidden"},"加载中...")],-1)]))):0===w.templates.length?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",s,t[3]||(t[3]=[Object(l["createElementVNode"])("i",{class:"bi bi-file-earmark-text-fill"},null,-1),Object(l["createElementVNode"])("p",null,"暂无合同模板",-1),Object(l["createElementVNode"])("span",null,'点击"新建模板"按钮来创建一个吧',-1)]))):(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",i,[Object(l["createElementVNode"])("table",r,[t[6]||(t[6]=Object(l["createElementVNode"])("thead",null,[Object(l["createElementVNode"])("tr",null,[Object(l["createElementVNode"])("th",null,"模板名称"),Object(l["createElementVNode"])("th",null,"合同类型"),Object(l["createElementVNode"])("th",null,"行业领域"),Object(l["createElementVNode"])("th",null,"创建人"),Object(l["createElementVNode"])("th",null,"创建时间"),Object(l["createElementVNode"])("th",null,"状态"),Object(l["createElementVNode"])("th",null,"操作")])],-1)),Object(l["createElementVNode"])("tbody",null,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(k.filteredTemplates,e=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",{key:e.id},[Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(e.name),1),Object(l["createElementVNode"])("td",null,[Object(l["createElementVNode"])("span",b,Object(l["toDisplayString"])(e.contract_type),1)]),Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(e.industry||"-"),1),Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(e.created_by_name),1),Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(new Date(e.created_at).toLocaleDateString()),1),Object(l["createElementVNode"])("td",null,[Object(l["createElementVNode"])("div",m,[Object(l["withDirectives"])(Object(l["createElementVNode"])("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"switch-"+e.id,"onUpdate:modelValue":t=>e.is_active=t,onChange:t=>k.toggleStatus(e)},null,40,u),[[l["vModelCheckbox"],e.is_active]]),Object(l["createElementVNode"])("label",{class:"form-check-label ms-2",for:"switch-"+e.id},Object(l["toDisplayString"])(e.is_active?"已启用":"已禁用"),9,h)])]),Object(l["createElementVNode"])("td",null,[Object(l["createVNode"])(C,{to:{name:"AdminContractTemplateEdit",params:{id:e.id}},class:"btn btn-sm btn-outline-primary me-2"},{default:Object(l["withCtx"])(()=>t[4]||(t[4]=[Object(l["createElementVNode"])("i",{class:"bi bi-pencil-square"},null,-1),Object(l["createTextVNode"])(" 编辑 ")])),_:2},1032,["to"]),Object(l["createElementVNode"])("button",{onClick:t=>k.confirmDelete(e),class:"btn btn-sm btn-outline-danger"},t[5]||(t[5]=[Object(l["createElementVNode"])("i",{class:"bi bi-trash"},null,-1),Object(l["createTextVNode"])(" 删除 ")]),8,p)])]))),128))])])]))]),Object(l["createElementVNode"])("div",j,[Object(l["createElementVNode"])("div",O,[Object(l["createElementVNode"])("div",v,[t[11]||(t[11]=Object(l["createElementVNode"])("div",{class:"modal-header bg-danger text-white"},[Object(l["createElementVNode"])("h5",{class:"modal-title"},[Object(l["createElementVNode"])("i",{class:"bi bi-exclamation-triangle me-2"}),Object(l["createTextVNode"])("删除确认")]),Object(l["createElementVNode"])("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Object(l["createElementVNode"])("div",E,[t[8]||(t[8]=Object(l["createElementVNode"])("h4",null,"确定要删除此模板吗？",-1)),Object(l["createElementVNode"])("p",f,[t[7]||(t[7]=Object(l["createTextVNode"])("模板名称: ")),Object(l["createElementVNode"])("strong",null,Object(l["toDisplayString"])(null===(x=w.templateToDelete)||void 0===x?void 0:x.name),1)]),t[9]||(t[9]=Object(l["createElementVNode"])("p",{class:"mb-0 text-danger"},"此操作无法撤销，请确认您的选择。",-1))]),Object(l["createElementVNode"])("div",y,[t[10]||(t[10]=Object(l["createElementVNode"])("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消",-1)),Object(l["createElementVNode"])("button",{type:"button",class:"btn btn-danger",onClick:t[0]||(t[0]=(...e)=>k.executeDelete&&k.executeDelete(...e)),disabled:w.deleting},[w.deleting?(Object(l["openBlock"])(),Object(l["createElementBlock"])("span",g)):Object(l["createCommentVNode"])("",!0),Object(l["createTextVNode"])(" "+Object(l["toDisplayString"])(w.deleting?"删除中...":"确认删除"),1)],8,V)])])])]),t[13]||(t[13]=Object(l["createStaticVNode"])('<div class="modal fade" id="deleteSuccessModal" tabindex="-1" aria-hidden="true" data-v-87890dde><div class="modal-dialog modal-dialog-centered" data-v-87890dde><div class="modal-content" data-v-87890dde><div class="modal-header bg-success text-white" data-v-87890dde><h5 class="modal-title" data-v-87890dde><i class="bi bi-check-circle me-2" data-v-87890dde></i>操作成功</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" data-v-87890dde></button></div><div class="modal-body text-center py-4" data-v-87890dde><h4 data-v-87890dde>模板已成功删除</h4></div><div class="modal-footer justify-content-center" data-v-87890dde><button type="button" class="btn btn-success px-4" data-bs-dismiss="modal" data-v-87890dde>确定</button></div></div></div></div>',1))])}a("e9f5"),a("910d");var w=a("50fc"),k=a("7b17"),x={name:"ContractTemplateManagement",data(){return{templates:[],loading:!0,templateToDelete:null,deleteConfirmModal:null,deleteSuccessModal:null,deleting:!1}},computed:{filteredTemplates(){return this.templates.filter(e=>e&&e.id)}},mounted(){this.fetchTemplates(),this.deleteConfirmModal=new k["a"](document.getElementById("deleteConfirmModal")),this.deleteSuccessModal=new k["a"](document.getElementById("deleteSuccessModal"))},methods:{async fetchTemplates(){this.loading=!0;try{const e=await w["a"].getContractTemplates();if(console.log("API响应:",e),e&&e.data){const t=Array.isArray(e.data.results)?e.data.results:Array.isArray(e.data)?e.data:[];this.templates=t.filter(e=>null!==e)}else console.error("获取合同模板返回了不正确的数据格式:",e),this.templates=[]}catch(e){console.error("获取合同模板失败:",e),this.showErrorModal("获取模板列表失败，请稍后重试。"),this.templates=[]}finally{this.loading=!1}},async toggleStatus(e){const t=!e.is_active;try{await w["a"].updateContractTemplate(e.id,{is_active:e.is_active})}catch(a){console.error("更新模板状态失败:",a),e.is_active=t,this.showErrorModal("更新模板状态失败，请稍后重试。")}},confirmDelete(e){this.templateToDelete=e,this.deleteConfirmModal.show()},async executeDelete(){if(this.templateToDelete){this.deleting=!0;try{await w["a"].deleteContractTemplate(this.templateToDelete.id),this.deleteConfirmModal.hide(),await this.fetchTemplates(),this.deleteSuccessModal.show()}catch(e){console.error("删除模板失败:",e),this.deleteConfirmModal.hide(),this.showErrorModal("删除模板失败，请稍后重试。")}finally{this.deleting=!1,this.templateToDelete=null}}},showErrorModal(e){const t=document.createElement("div");t.innerHTML=`\n        <div class="modal fade" id="tempErrorModal" tabindex="-1" aria-hidden="true">\n          <div class="modal-dialog modal-dialog-centered">\n            <div class="modal-content">\n              <div class="modal-header bg-danger text-white">\n                <h5 class="modal-title"><i class="bi bi-exclamation-triangle me-2"></i>操作失败</h5>\n                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>\n              </div>\n              <div class="modal-body text-center py-4">\n                <p class="mb-0">${e}</p>\n              </div>\n              <div class="modal-footer justify-content-center">\n                <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">确定</button>\n              </div>\n            </div>\n          </div>\n        </div>`,document.body.appendChild(t);const a=new k["a"](document.getElementById("tempErrorModal"));a.show(),document.getElementById("tempErrorModal").addEventListener("hidden.bs.modal",(function(){document.body.removeChild(t)}))}}},C=(a("fe62"),a("6b0d")),T=a.n(C);const D=T()(x,[["render",N],["__scopeId","data-v-87890dde"]]);t["default"]=D},f168:function(e,t,a){},fe62:function(e,t,a){"use strict";a("f168")}}]);
//# sourceMappingURL=chunk-63b4299e.96fafc36.js.map