(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d9a0760"],{"052a":function(e,t,a){"use strict";a("c8e2")},"50fc":function(e,t,a){"use strict";var r=a("cee4");const c=r["a"].create({baseURL:"http://localhost:8000/api/admin",timeout:1e4,headers:{"Content-Type":"application/json"}});c.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer "+t),e},e=>Promise.reject(e)),t["a"]={getDashboardData(){return c.get("/dashboard/")},getDashboardAnalysis(e,t){return c.post("/dashboard/analysis/",{chart_title:e,chart_data:t})},getUsers(e){return c.get("/users/",{params:e})},createUser(e){return c.post("/users/",e)},updateUser(e,t){return c.patch(`/users/${e}/`,t)},deleteUser(e){return c.delete(`/users/${e}/`)},getCompanies(e){return c.get("/companies/",{params:e})},createCompany(e){return c.post("/companies/",e)},updateCompany(e,t){return c.patch(`/companies/${e}/`,t)},deleteCompany(e){return c.delete(`/companies/${e}/`)},getDepartments(e){return c.get("/departments/",{params:e})},createDepartment(e){return c.post("/departments/",e)},updateDepartment(e,t){return c.patch(`/departments/${e}/`,t)},deleteDepartment(e){return c.delete(`/departments/${e}/`)},getSmartDocs(e){return c.get("/smart-docs/",{params:e})},getSmartDocDetail(e){return c.get(`/smart-docs/${e}/`)},deleteSmartDoc(e){return c.delete(`/smart-docs/${e}/`)},getContracts(e){return c.get("/contracts/",{params:e})},getContractDetail(e){return c.get(`/contracts/${e}/`)},deleteContract(e){return c.delete(`/contracts/${e}/`)},getContractTemplates(){return c.get("/contract-templates/")},getContractTemplate(e){return c.get(`/contract-templates/${e}/`)},createContractTemplate(e){return c.post("/contract-templates/",e)},updateContractTemplate(e,t){return c.patch(`/contract-templates/${e}/`,t)},deleteContractTemplate(e){return c.delete(`/contract-templates/${e}/`)},getKnowledgeCategories(e){return c.get("/knowledge-categories/",{params:e})},createKnowledgeCategory(e){return c.post("/knowledge-categories/",e)},updateKnowledgeCategory(e,t){return c.patch(`/knowledge-categories/${e}/`,t)},deleteKnowledgeCategory(e){return c.delete(`/knowledge-categories/${e}/`)},getKnowledgeBases(e){return c.get("/knowledge-bases/",{params:e})},getKnowledgeBaseDetail(e){return c.get(`/knowledge-bases/${e}/`)},createKnowledgeBase(e){const t=new FormData;for(const a in e)null!==e[a]&&void 0!==e[a]&&t.append(a,e[a]);return c.post("/knowledge-bases/",t,{headers:{"Content-Type":"multipart/form-data"}})},updateKnowledgeBase(e,t){const a=new FormData;for(const r in t)"original_file"!==r&&null!==t[r]&&void 0!==t[r]&&a.append(r,t[r]);return t.original_file instanceof File&&a.append("original_file",t.original_file),c.patch(`/knowledge-bases/${e}/`,a,{headers:{"Content-Type":"multipart/form-data"}})},deleteKnowledgeBase(e){return c.delete(`/knowledge-bases/${e}/`)},getKnowledgeBuildStatus(){return c.get("/knowledge/build/")},buildKnowledgeForCompanies(e){return c.post("/knowledge/build/",{company_ids:e})}}},"58ff":function(e,t,a){"use strict";a.r(t);var r=a("7a23"),c=a("50fc"),l=a("3ef4"),n=a("c9a1"),o=a("4c02"),d=a("54bb"),u=a("c349"),s=a("cf2e"),b=a("1e49"),i=a("ae7b"),p=a("7faf"),j=a("db9d"),O=a("d8e8"),m=a("91c0"),f=a("f6f2");const g={class:"management-container"},w={class:"card-header"},h={class:"header-left"},V={class:"header-right"},v={class:"table-container"},y={class:"pagination-container"},C={class:"dialog-footer"};var N={__name:"UserManagement",setup(e){const t=Object(r["ref"])([]),a=Object(r["ref"])([]),N=Object(r["ref"])([]),x=Object(r["ref"])(""),k=Object(r["ref"])(0),_=Object(r["reactive"])({page:1,pageSize:10}),B=Object(r["ref"])(!1),T=Object(r["ref"])({}),D=Object(r["ref"])(null);let U=null;const $=Object(r["ref"])(!0),z=async()=>{$.value=!0;try{const e={search:x.value,page:_.page,page_size:_.pageSize},a=await c["a"].getUsers(e);t.value=a.data.results,k.value=a.data.count}catch(e){console.error("获取用户列表失败:",e),l["a"].error("获取用户列表失败")}finally{$.value=!1}},S=()=>{clearTimeout(U),U=setTimeout(()=>{_.page=1,z()},300)},K=async()=>{try{const e=await c["a"].getCompanies({all:"true"});a.value=e.data}catch(e){console.error("获取公司列表失败:",e)}},E=async e=>{if(e)try{const t={all:"true",company:e},a=await c["a"].getDepartments(t);N.value=a.data}catch(t){console.error(`获取公司 ${e} 的部门列表失败:`,t),N.value=[]}else N.value=[]},F=async e=>{T.value.department=null,await E(e)},q=async(e={})=>{await K(),e&&e.id?(T.value={...e},e.company&&await E(e.company)):T.value={username:"",name:"",email:"",password:"",position:"",company:null,department:null},B.value=!0},I=()=>{var e;B.value=!1,null===(e=D.value)||void 0===e||e.resetFields()},J=async()=>{D.value&&await D.value.validate(async e=>{if(e)try{const e={...T.value};e.password||delete e.password,null===e.department&&delete e.department,e.id?await c["a"].updateUser(e.id,e):await c["a"].createUser(e),I(),z(),l["a"].success("用户保存成功！")}catch(r){var t,a;console.error("保存用户失败:",(null===(t=r.response)||void 0===t?void 0:t.data)||r.message);const e=null!==(a=r.response)&&void 0!==a&&a.data?JSON.stringify(r.response.data):"请检查网络或联系技术支持";l["a"].error("保存用户失败: "+e)}})},L=e=>{n["a"].confirm(`确定要删除用户【${e.name||e.username}】吗？此操作无法撤销。`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await c["a"].deleteUser(e.id),l["a"].success("用户删除成功"),z()}catch(t){l["a"].error("删除用户失败"),console.error("删除用户失败:",t)}}).catch(()=>{l["a"].info("已取消删除")})},P=e=>{_.pageSize=e,z()},A=e=>{_.page=e,z()};return Object(r["onMounted"])(()=>{z()}),(e,c)=>{const l=Object(r["resolveDirective"])("loading");return Object(r["openBlock"])(),Object(r["createElementBlock"])("div",g,[Object(r["createVNode"])(Object(r["unref"])(o["a"]),{class:"box-card"},{header:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("div",w,[Object(r["createElementVNode"])("div",h,[Object(r["createVNode"])(Object(r["unref"])(d["a"]),{class:"header-icon"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(f["User"]))]),_:1}),c[12]||(c[12]=Object(r["createElementVNode"])("span",null,"用户管理",-1))]),Object(r["createElementVNode"])("div",V,[Object(r["createVNode"])(Object(r["unref"])(u["a"]),{modelValue:x.value,"onUpdate:modelValue":c[0]||(c[0]=e=>x.value=e),placeholder:"搜索用户...",clearable:"",onClear:z,onInput:S,class:"search-input"},{append:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(s["a"]),{icon:Object(r["unref"])(f["Search"])},null,8,["icon"])]),_:1},8,["modelValue"]),Object(r["createVNode"])(Object(r["unref"])(s["a"]),{type:"primary",icon:Object(r["unref"])(f["Plus"]),onClick:c[1]||(c[1]=e=>q())},{default:Object(r["withCtx"])(()=>c[13]||(c[13]=[Object(r["createTextVNode"])("添加用户")])),_:1},8,["icon"])])])]),default:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("div",v,[Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["unref"])(b["a"]),{data:t.value,style:{width:"100%"}},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(b["b"]),{type:"index",index:e=>(_.page-1)*_.pageSize+e+1,label:"序号",width:"80"},null,8,["index"]),Object(r["createVNode"])(Object(r["unref"])(b["b"]),{prop:"name",label:"用户名",sortable:""},{default:Object(r["withCtx"])(e=>[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.row.name||e.row.username),1)]),_:1}),Object(r["createVNode"])(Object(r["unref"])(b["b"]),{prop:"email",label:"邮箱",sortable:""}),Object(r["createVNode"])(Object(r["unref"])(b["b"]),{prop:"company_name",label:"公司",sortable:""},{default:Object(r["withCtx"])(e=>[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.row.company_name||"未分配"),1)]),_:1}),Object(r["createVNode"])(Object(r["unref"])(b["b"]),{prop:"department_name",label:"部门",sortable:""},{default:Object(r["withCtx"])(e=>[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.row.department_name||"未分配"),1)]),_:1}),Object(r["createVNode"])(Object(r["unref"])(b["b"]),{prop:"position",label:"职位"},{default:Object(r["withCtx"])(e=>[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.row.position||"未指定"),1)]),_:1}),Object(r["createVNode"])(Object(r["unref"])(b["b"]),{label:"角色",width:"120"},{default:Object(r["withCtx"])(e=>[e.row.is_staff?(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["unref"])(i["a"]),{key:0,type:"danger",size:"small"},{default:Object(r["withCtx"])(()=>c[14]||(c[14]=[Object(r["createTextVNode"])("管理员")])),_:1})):e.row.is_department_manager?(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["unref"])(i["a"]),{key:1,type:"primary",size:"small"},{default:Object(r["withCtx"])(()=>c[15]||(c[15]=[Object(r["createTextVNode"])("部门主管")])),_:1})):(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["unref"])(i["a"]),{key:2,type:"success",size:"small"},{default:Object(r["withCtx"])(()=>c[16]||(c[16]=[Object(r["createTextVNode"])("员工")])),_:1}))]),_:1}),Object(r["createVNode"])(Object(r["unref"])(b["b"]),{label:"操作",width:"120"},{default:Object(r["withCtx"])(e=>[Object(r["createVNode"])(Object(r["unref"])(s["a"]),{text:"",type:"primary",size:"small",onClick:t=>q(e.row)},{default:Object(r["withCtx"])(()=>c[17]||(c[17]=[Object(r["createTextVNode"])("编辑")])),_:2},1032,["onClick"]),Object(r["createVNode"])(Object(r["unref"])(s["a"]),{text:"",type:"danger",size:"small",onClick:t=>L(e.row)},{default:Object(r["withCtx"])(()=>c[18]||(c[18]=[Object(r["createTextVNode"])("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[l,$.value]])]),Object(r["createElementVNode"])("div",y,[Object(r["createVNode"])(Object(r["unref"])(p["a"]),{"current-page":_.page,"onUpdate:currentPage":c[2]||(c[2]=e=>_.page=e),"page-size":_.pageSize,"onUpdate:pageSize":c[3]||(c[3]=e=>_.pageSize=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:k.value,onSizeChange:P,onCurrentChange:A},null,8,["current-page","page-size","total"])]),Object(r["createVNode"])(Object(r["unref"])(j["a"]),{modelValue:B.value,"onUpdate:modelValue":c[11]||(c[11]=e=>B.value=e),title:T.value.id?"编辑用户":"添加用户",width:"500px"},{footer:Object(r["withCtx"])(()=>[Object(r["createElementVNode"])("span",C,[Object(r["createVNode"])(Object(r["unref"])(s["a"]),{onClick:I},{default:Object(r["withCtx"])(()=>c[19]||(c[19]=[Object(r["createTextVNode"])("取消")])),_:1}),Object(r["createVNode"])(Object(r["unref"])(s["a"]),{type:"primary",onClick:J},{default:Object(r["withCtx"])(()=>c[20]||(c[20]=[Object(r["createTextVNode"])("保存")])),_:1})])]),default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(O["a"]),{model:T.value,ref_key:"userForm",ref:D,"label-width":"80px"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(O["b"]),{label:"用户名",prop:"username",rules:[{required:!0,message:"请输入用户名"}]},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(u["a"]),{modelValue:T.value.username,"onUpdate:modelValue":c[4]||(c[4]=e=>T.value.username=e)},null,8,["modelValue"])]),_:1}),Object(r["createVNode"])(Object(r["unref"])(O["b"]),{label:"姓名",prop:"name"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(u["a"]),{modelValue:T.value.name,"onUpdate:modelValue":c[5]||(c[5]=e=>T.value.name=e)},null,8,["modelValue"])]),_:1}),Object(r["createVNode"])(Object(r["unref"])(O["b"]),{label:"邮箱",prop:"email",rules:[{required:!0,message:"请输入邮箱"},{type:"email",message:"请输入有效的邮箱地址"}]},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(u["a"]),{modelValue:T.value.email,"onUpdate:modelValue":c[6]||(c[6]=e=>T.value.email=e)},null,8,["modelValue"])]),_:1}),Object(r["createVNode"])(Object(r["unref"])(O["b"]),{label:"密码",prop:"password",rules:T.value.id?[]:[{required:!0,message:"请输入密码"}]},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(u["a"]),{modelValue:T.value.password,"onUpdate:modelValue":c[7]||(c[7]=e=>T.value.password=e),type:"password",placeholder:T.value.id?"留空则不修改":""},null,8,["modelValue","placeholder"])]),_:1},8,["rules"]),Object(r["createVNode"])(Object(r["unref"])(O["b"]),{label:"职位",prop:"position"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(u["a"]),{modelValue:T.value.position,"onUpdate:modelValue":c[8]||(c[8]=e=>T.value.position=e)},null,8,["modelValue"])]),_:1}),Object(r["createVNode"])(Object(r["unref"])(O["b"]),{label:"所属公司",prop:"company",rules:[{required:!0,message:"请选择公司"}]},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(m["c"]),{modelValue:T.value.company,"onUpdate:modelValue":c[9]||(c[9]=e=>T.value.company=e),placeholder:"请选择",onChange:F},{default:Object(r["withCtx"])(()=>[(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(a.value,e=>(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["unref"])(m["a"]),{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),T.value.company?(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["unref"])(O["b"]),{key:0,label:"所属部门",prop:"department"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(m["c"]),{modelValue:T.value.department,"onUpdate:modelValue":c[10]||(c[10]=e=>T.value.department=e),placeholder:"请选择"},{default:Object(r["withCtx"])(()=>[Object(r["createVNode"])(Object(r["unref"])(m["a"]),{label:"-- 未分配 --",value:null}),(Object(r["openBlock"])(!0),Object(r["createElementBlock"])(r["Fragment"],null,Object(r["renderList"])(N.value,e=>(Object(r["openBlock"])(),Object(r["createBlock"])(Object(r["unref"])(m["a"]),{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):Object(r["createCommentVNode"])("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})])}}},x=(a("052a"),a("6b0d")),k=a.n(x);const _=k()(N,[["__scopeId","data-v-2c6bd0cd"]]);t["default"]=_},c8e2:function(e,t,a){}}]);
//# sourceMappingURL=chunk-2d9a0760.10f482db.js.map