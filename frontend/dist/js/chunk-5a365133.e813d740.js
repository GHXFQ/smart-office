(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5a365133","chunk-2d0e4842"],{"24d2":function(e,t,a){"use strict";a.d(t,"e",(function(){return l})),a.d(t,"m",(function(){return r})),a.d(t,"b",(function(){return o})),a.d(t,"k",(function(){return n})),a.d(t,"f",(function(){return i})),a.d(t,"a",(function(){return s})),a.d(t,"l",(function(){return d})),a.d(t,"c",(function(){return u})),a.d(t,"i",(function(){return b})),a.d(t,"g",(function(){return j})),a.d(t,"j",(function(){return p})),a.d(t,"d",(function(){return O})),a.d(t,"h",(function(){return m}));var c=a("b775");function l(e){return Object(c["a"])({url:"/api/project-documents/",method:"get",params:{project:e}})}function r(e){return Object(c["a"])({url:"/api/project-documents/",method:"post",data:e,headers:{"Content-Type":"multipart/form-data"}})}function o(e){return Object(c["a"])({url:`/api/project-documents/${e}/`,method:"delete"})}function n(e,t){return Object(c["a"])({url:`/api/project-documents/${e}/`,method:"patch",data:t,headers:{"Content-Type":"application/json"}})}function i(e){return Object(c["a"])({url:"/api/requirements/",method:"get",params:{project:e}})}function s(e){return Object(c["a"])({url:"/api/requirements/",method:"post",data:e})}function d(e,t){return Object(c["a"])({url:`/api/requirements/${e}/`,method:"patch",data:t})}function u(e){return Object(c["a"])({url:`/api/requirements/${e}/`,method:"delete"})}function b(e){return Object(c["a"])({url:"/api/requirements/ai_analysis/",method:"get",params:{project:e}})}function j(e){return Object(c["a"])({url:"/api/project-documents/ai_dashboard/",method:"get",params:{project:e}})}function p(e){return Object(c["a"])({url:`/api/requirements/${e}/ai_analysis/`,method:"get"})}function O(e,t){return Object(c["a"])({url:`/api/projects/${e}/export_ai_report/`,method:"post",data:t,responseType:"blob",timeout:12e4,headers:{"Content-Type":"application/json",Accept:"application/pdf, application/json;q=0.9"},validateStatus:function(e){return e>=200&&e<500}})}function m(e){return Object(c["a"])({url:`/api/projects/${e}/chart_analysis/`,method:"get"})}},"452c":function(e,t,a){"use strict";a("81a0")},"7a39":function(e,t,a){"use strict";a("ee97")},"81a0":function(e,t,a){},"910d":function(e,t,a){"use strict";var c=a("23e7"),l=a("c65b"),r=a("59ed"),o=a("825a"),n=a("46c4"),i=a("c5cc"),s=a("9bdd"),d=a("c430"),u=a("2a62"),b=a("f99f"),j=!d&&b("filter",TypeError),p=i((function(){var e,t,a,c=this.iterator,r=this.predicate,n=this.next;while(1){if(e=o(l(n,c)),t=this.done=!!e.done,t)return;if(a=e.value,s(c,r,[a,this.counter++],!0))return a}}));c({target:"Iterator",proto:!0,real:!0,forced:d||j},{filter:function(e){o(this);try{r(e)}catch(t){u(this,"throw",t)}return j?l(j,this,e):new p(n(this),{predicate:e})}})},b274:function(e,t,a){"use strict";a.r(t);a("e9f5"),a("910d"),a("7d54");var c=a("7a23"),l=a("f6f2"),r=a("3ef4"),o=a("c9a1"),n=a("24d2"),i=a("6605");const s={class:"module-card"},d={class:"module-header"},u={class:"btn-group"},b={class:"ai-requirement-analysis mb-4"},j={class:"d-flex justify-content-between align-items-center mb-3"},p={class:"btn-group"},O={class:"row"},m={class:"col-md-4"},v={class:"ai-analysis-card"},f={class:"col-md-4"},V={class:"ai-analysis-card"},g={class:"requirement-dependencies"},y={class:"dependency-item"},h={class:"dependency-item"},N={class:"col-md-4"},x={class:"ai-analysis-card"},w={class:"ai-suggestions"},k={key:0,class:"text-center py-2"},C={class:"filter-bar",style:{display:"flex",gap:"12px","margin-bottom":"16px"}},E={class:"requirements-list"},_={class:"list-group"},B={class:"d-flex w-100 justify-content-between"},q={class:"mb-1"},A={class:"ai-requirement-tags"},D={class:"text-end"},T={class:"ai-requirement-status"},S={class:"text-muted"},I={style:{"margin-top":"8px"}},F={class:"mb-1"},z={key:0,class:"ai-requirement-analysis"},$={class:"d-flex justify-content-between"},U={key:0},L={key:1},M={key:1,class:"ai-requirement-analysis"};var R={__name:"RequirementsView",setup(e){const t=Object(i["c"])(),a=Object(c["computed"])(()=>t.params.id),R=Object(c["ref"])([]),J=Object(c["ref"])(!1),Y=Object(c["ref"])(!1),G=Object(c["ref"])(!1),H=Object(c["ref"])(!1),K=Object(c["ref"])(null),P=Object(c["ref"])({name:"",priority:"medium",tags:"",description:"",status:"pending"}),Q=Object(c["ref"])(!1),W=Object(c["ref"])({completeness:0,dependencies:0,conflicts:0,suggestions:[]}),X=Object(c["ref"])(""),Z=Object(c["ref"])(""),ee=Object(c["ref"])(""),te=Object(c["computed"])(()=>R.value.filter(e=>{const t=!X.value||e.priority===X.value,a=!Z.value||e.status===Z.value,c=!ee.value||e.name.includes(ee.value)||e.description&&e.description.includes(ee.value);return t&&a&&c})),ae=Object(c["ref"])(null),ce={name:[{required:!0,message:"请输入需求名称",trigger:"blur"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],tags:[{required:!0,message:"请输入标签",trigger:"blur"}],description:[{required:!0,message:"请输入需求描述",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},le=async()=>{try{J.value=!0;const e=await Object(n["f"])(a.value);R.value=e.data,R.value.forEach(e=>{e.analyzing=!1,e.showFullAnalysis=!1,e.ai_analysis="",pe(e)})}catch(e){console.error("获取需求列表失败:",e),r["a"].error("获取需求列表失败")}finally{J.value=!1}},re=async()=>{if(a.value)try{Q.value=!0;const e=await Object(n["i"])(a.value);e.data?(W.value={completeness:e.data.completeness||0,dependencies:e.data.dependencies||0,conflicts:e.data.conflicts||0,suggestions:Array.isArray(e.data.suggestions)?e.data.suggestions:[]},console.log("AI需求分析结果:",W.value)):(console.error("AI分析响应数据格式错误:",e),r["a"].error("AI分析响应数据格式错误"))}catch(e){console.error("获取AI分析失败:",e),r["a"].error("获取AI分析失败")}finally{Q.value=!1}else r["a"].warning("没有有效的项目ID")},oe=e=>e>=80?"success":e>=60?"warning":"exception",ne=e=>{H.value=!0,K.value=e.id,P.value={name:e.name,priority:e.priority,tags:e.tags,description:e.description,status:e.status},G.value=!0},ie=()=>{G.value=!1,H.value=!1,K.value=null,P.value={name:"",priority:"medium",tags:"",description:"",status:"pending"}},se=async()=>{ae.value?ae.value.validate(async e=>{if(e)try{Y.value=!0;const e={project:a.value,name:P.value.name,description:P.value.description,priority:P.value.priority,tags:P.value.tags,status:P.value.status};H.value&&K.value?(await Object(n["l"])(K.value,e),r["a"].success("需求更新成功")):(await Object(n["a"])(e),r["a"].success("需求创建成功")),ie(),Oe()}catch(t){console.error("保存需求失败:",t),r["a"].error("保存需求失败")}finally{Y.value=!1}else r["a"].error("请填写所有必填项")}):console.error("表单引用不存在")},de=async e=>{try{await o["a"].confirm("确定删除此需求？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),J.value=!0,await Object(n["c"])(e.id),r["a"].success("删除成功"),Oe()}catch(t){"cancel"!==t&&(console.error("删除需求失败:",t),r["a"].error("删除需求失败"))}finally{J.value=!1}},ue=e=>{const t={pending:"info","in-progress":"primary",completed:"success"};return t[e]||"info"},be=e=>{const t={pending:"待处理","in-progress":"进行中",completed:"已完成"};return t[e]||"待处理"},je=e=>{if(!e)return"刚刚";const t=new Date(e),a=new Date,c=a-t;if(c<864e5){const e=Math.floor(c/36e5);if(e>0)return e+"小时前";const t=Math.floor(c/6e4);return t>0?t+"分钟前":"刚刚"}return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},pe=(e,t=!1)=>{e.id?(e.analyzing=!0,Object(n["j"])(e.id).then(a=>{e.ai_analysis=a.data.ai_analysis||"暂无分析",e.showFullAnalysis=!1,t&&r["a"].success("AI分析完成")}).catch(()=>{e.ai_analysis="AI分析失败",t&&r["a"].error("AI分析失败")}).finally(()=>{e.analyzing=!1})):t&&r["a"].warning("无效的需求ID")};Object(c["onMounted"])(()=>{le(),re()}),Object(c["watch"])(a,()=>{a.value&&(le(),re())});const Oe=()=>{le(),re()};return(e,t)=>{const a=Object(c["resolveComponent"])("el-button"),r=Object(c["resolveComponent"])("el-icon"),o=Object(c["resolveComponent"])("el-progress"),n=Object(c["resolveComponent"])("el-option"),i=Object(c["resolveComponent"])("el-select"),K=Object(c["resolveComponent"])("el-input"),le=Object(c["resolveComponent"])("el-tag"),Oe=Object(c["resolveComponent"])("el-empty"),me=Object(c["resolveComponent"])("el-form-item"),ve=Object(c["resolveComponent"])("el-form"),fe=Object(c["resolveComponent"])("el-dialog"),Ve=Object(c["resolveDirective"])("loading");return Object(c["openBlock"])(),Object(c["createElementBlock"])(c["Fragment"],null,[Object(c["createElementVNode"])("div",s,[Object(c["createElementVNode"])("div",d,[t[11]||(t[11]=Object(c["createElementVNode"])("h5",{class:"module-title"},"需求管理",-1)),Object(c["createElementVNode"])("div",u,[Object(c["createVNode"])(a,{type:"primary",size:"default",round:"",onClick:t[0]||(t[0]=e=>G.value=!0)},{default:Object(c["withCtx"])(()=>t[10]||(t[10]=[Object(c["createTextVNode"])("新建需求")])),_:1})])]),Object(c["createElementVNode"])("div",b,[Object(c["createElementVNode"])("div",j,[t[13]||(t[13]=Object(c["createElementVNode"])("h6",{class:"mb-0"},"AI需求分析",-1)),Object(c["createElementVNode"])("div",p,[Object(c["createVNode"])(a,{size:"small",onClick:re,loading:Q.value},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(r,null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(l["Refresh"]))]),_:1}),t[12]||(t[12]=Object(c["createTextVNode"])("刷新分析 "))]),_:1},8,["loading"])])]),Object(c["createElementVNode"])("div",O,[Object(c["createElementVNode"])("div",m,[Object(c["createElementVNode"])("div",v,[t[14]||(t[14]=Object(c["createElementVNode"])("h6",{class:"text-primary"},"需求完整性",-1)),Object(c["createVNode"])(o,{percentage:W.value.completeness,status:oe(W.value.completeness),style:{"margin-bottom":"8px"}},null,8,["percentage","status"]),t[15]||(t[15]=Object(c["createElementVNode"])("p",{class:"text-muted small"},"需求描述完整性评分",-1))])]),Object(c["createElementVNode"])("div",f,[Object(c["createElementVNode"])("div",V,[t[16]||(t[16]=Object(c["createElementVNode"])("h6",{class:"text-primary"},"需求依赖关系",-1)),Object(c["createElementVNode"])("div",g,[Object(c["createElementVNode"])("div",y,[Object(c["createVNode"])(r,null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(l["Connection"]))]),_:1}),Object(c["createTextVNode"])(" 发现"+Object(c["toDisplayString"])(W.value.dependencies)+"个需求依赖关系 ",1)]),Object(c["createElementVNode"])("div",h,[Object(c["createVNode"])(r,null,{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(Object(c["unref"])(l["CircleCloseFilled"]))]),_:1}),Object(c["createTextVNode"])(" "+Object(c["toDisplayString"])(W.value.conflicts)+"个需求存在冲突 ",1)])])])]),Object(c["createElementVNode"])("div",N,[Object(c["createElementVNode"])("div",x,[t[17]||(t[17]=Object(c["createElementVNode"])("h6",{class:"text-primary"},"智能建议",-1)),Object(c["createElementVNode"])("div",w,[0===W.value.suggestions.length?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",k)):Object(c["createCommentVNode"])("",!0),(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(W.value.suggestions,(e,t)=>(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",{class:"suggestion-item",key:t},[Object(c["createVNode"])(r,null,{default:Object(c["withCtx"])(()=>[0===t?(Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["unref"])(l["Lightning"]),{key:0})):(Object(c["openBlock"])(),Object(c["createBlock"])(Object(c["unref"])(l["Check"]),{key:1}))]),_:2},1024),Object(c["createTextVNode"])(" "+Object(c["toDisplayString"])(e),1)]))),128))])])])])]),Object(c["createElementVNode"])("div",C,[Object(c["createVNode"])(i,{modelValue:X.value,"onUpdate:modelValue":t[1]||(t[1]=e=>X.value=e),placeholder:"优先级",clearable:"",style:{width:"120px"}},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(n,{label:"全部",value:""}),Object(c["createVNode"])(n,{label:"高",value:"high"}),Object(c["createVNode"])(n,{label:"中",value:"medium"}),Object(c["createVNode"])(n,{label:"低",value:"low"})]),_:1},8,["modelValue"]),Object(c["createVNode"])(i,{modelValue:Z.value,"onUpdate:modelValue":t[2]||(t[2]=e=>Z.value=e),placeholder:"状态",clearable:"",style:{width:"120px"}},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(n,{label:"全部",value:""}),Object(c["createVNode"])(n,{label:"待处理",value:"pending"}),Object(c["createVNode"])(n,{label:"进行中",value:"in-progress"}),Object(c["createVNode"])(n,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"]),Object(c["createVNode"])(K,{modelValue:ee.value,"onUpdate:modelValue":t[3]||(t[3]=e=>ee.value=e),placeholder:"关键词",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),Object(c["withDirectives"])((Object(c["openBlock"])(),Object(c["createElementBlock"])("div",E,[Object(c["createElementVNode"])("div",_,[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(te.value,e=>(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",{class:"list-group-item list-group-item-action",key:e.id},[Object(c["createElementVNode"])("div",B,[Object(c["createElementVNode"])("div",null,[Object(c["createElementVNode"])("h6",q,Object(c["toDisplayString"])(e.name),1),Object(c["createElementVNode"])("div",A,[(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(e.tags_list,e=>(Object(c["openBlock"])(),Object(c["createBlock"])(le,{key:e.text,type:e.type,size:"small"},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.text),1)]),_:2},1032,["type"]))),128))])]),Object(c["createElementVNode"])("div",D,[Object(c["createVNode"])(le,{type:ue(e.status),size:"small"},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])(Object(c["toDisplayString"])(be(e.status)),1)]),_:2},1032,["type"]),Object(c["createElementVNode"])("div",T,[Object(c["createElementVNode"])("small",S,Object(c["toDisplayString"])(je(e.created_at)),1)]),Object(c["createElementVNode"])("div",I,[Object(c["createVNode"])(a,{size:"small",type:"primary",text:"",onClick:t=>ne(e)},{default:Object(c["withCtx"])(()=>t[18]||(t[18]=[Object(c["createTextVNode"])("编辑")])),_:2},1032,["onClick"]),Object(c["createVNode"])(a,{size:"small",type:"danger",text:"",onClick:t=>de(e)},{default:Object(c["withCtx"])(()=>t[19]||(t[19]=[Object(c["createTextVNode"])("删除")])),_:2},1032,["onClick"]),Object(c["createVNode"])(a,{size:"small",type:"info",text:"",onClick:t=>pe(e,!0),loading:e.analyzing},{default:Object(c["withCtx"])(()=>t[20]||(t[20]=[Object(c["createTextVNode"])("AI分析")])),_:2},1032,["onClick","loading"])])])]),Object(c["createElementVNode"])("p",F,Object(c["toDisplayString"])(e.description||"暂无描述"),1),e.ai_analysis?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",z,[Object(c["createElementVNode"])("div",$,[t[21]||(t[21]=Object(c["createElementVNode"])("small",{class:"text-muted"},"AI分析：",-1)),Object(c["createVNode"])(a,{type:"link",size:"small",onClick:t=>e.showFullAnalysis=!e.showFullAnalysis},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.showFullAnalysis?"收起":"展开"),1)]),_:2},1032,["onClick"])]),e.showFullAnalysis?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",U,Object(c["toDisplayString"])(e.ai_analysis),1)):(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",L,Object(c["toDisplayString"])(e.ai_analysis.substring(0,100))+Object(c["toDisplayString"])(e.ai_analysis.length>100?"...":""),1))])):(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",M,t[22]||(t[22]=[Object(c["createElementVNode"])("small",{class:"text-muted"},"暂无AI分析",-1)])))]))),128))]),0===R.value.length?(Object(c["openBlock"])(),Object(c["createBlock"])(Oe,{key:0,description:"暂无需求数据"})):Object(c["createCommentVNode"])("",!0)])),[[Ve,J.value]])]),Object(c["createVNode"])(fe,{modelValue:G.value,"onUpdate:modelValue":t[9]||(t[9]=e=>G.value=e),title:H.value?"编辑需求":"新建需求",width:"400px"},{footer:Object(c["withCtx"])(()=>[Object(c["createVNode"])(a,{onClick:ie},{default:Object(c["withCtx"])(()=>t[23]||(t[23]=[Object(c["createTextVNode"])("取消")])),_:1}),Object(c["createVNode"])(a,{type:"primary",onClick:se,loading:Y.value},{default:Object(c["withCtx"])(()=>[Object(c["createTextVNode"])(Object(c["toDisplayString"])(H.value?"保存":"提交"),1)]),_:1},8,["loading"])]),default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(ve,{model:P.value,"label-width":"80px",rules:ce,ref_key:"reqFormRef",ref:ae},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(me,{label:"需求名称",prop:"name",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(K,{modelValue:P.value.name,"onUpdate:modelValue":t[4]||(t[4]=e=>P.value.name=e),placeholder:"请输入需求名称"},null,8,["modelValue"])]),_:1}),Object(c["createVNode"])(me,{label:"优先级",prop:"priority",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(i,{modelValue:P.value.priority,"onUpdate:modelValue":t[5]||(t[5]=e=>P.value.priority=e),placeholder:"请选择"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(n,{label:"高",value:"high"}),Object(c["createVNode"])(n,{label:"中",value:"medium"}),Object(c["createVNode"])(n,{label:"低",value:"low"})]),_:1},8,["modelValue"])]),_:1}),Object(c["createVNode"])(me,{label:"标签",prop:"tags",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(K,{modelValue:P.value.tags,"onUpdate:modelValue":t[6]||(t[6]=e=>P.value.tags=e),placeholder:"逗号分隔，如：功能,高优先级"},null,8,["modelValue"])]),_:1}),Object(c["createVNode"])(me,{label:"描述",prop:"description",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(K,{modelValue:P.value.description,"onUpdate:modelValue":t[7]||(t[7]=e=>P.value.description=e),type:"textarea",placeholder:"请输入需求描述"},null,8,["modelValue"])]),_:1}),Object(c["createVNode"])(me,{label:"状态",prop:"status",required:""},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(i,{modelValue:P.value.status,"onUpdate:modelValue":t[8]||(t[8]=e=>P.value.status=e),placeholder:"请选择"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(n,{label:"待处理",value:"pending"}),Object(c["createVNode"])(n,{label:"进行中",value:"in-progress"}),Object(c["createVNode"])(n,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],64)}}},J=(a("452c"),a("7a39"),a("6b0d")),Y=a.n(J);const G=Y()(R,[["__scopeId","data-v-1c82d407"]]);t["default"]=G},ee97:function(e,t,a){}}]);
//# sourceMappingURL=chunk-5a365133.e813d740.js.map