{"version":3,"sources":["webpack:///./src/api/project.js","webpack:///./src/views/project/components/RequirementsView.vue?d5f0","webpack:///./src/views/project/components/RequirementsView.vue?cce2","webpack:///./node_modules/core-js/modules/es.iterator.filter.js","webpack:///./src/views/project/components/RequirementsView.vue","webpack:///./src/views/project/components/RequirementsView.vue?e916"],"names":["fetchProjectDocuments","projectId","request","url","method","params","project","uploadProjectDocument","data","headers","deleteProjectDocument","id","updateProjectDocument","fetchRequirements","createRequirement","updateRequirement","deleteRequirement","getRequirementAiAnalysis","getDocumentAiDashboard","getSingleRequirementAiAnalysis","requirementId","exportProjectAiReport","responseType","timeout","validateStatus","status","getProjectChartAnalysis","$","call","aCallable","anObject","getIteratorDirect","createIteratorProxy","callWithSafeIterationClosing","IS_PURE","iteratorClose","iteratorHelperWithoutClosingOnEarlyError","filterWithoutClosingOnEarlyError","TypeError","IteratorProxy","result","done","value","iterator","this","predicate","next","counter","target","proto","real","forced","filter","error","route","useRoute","computed","requirements","ref","loading","submitting","showAddReq","editMode","editingReqId","addReqForm","name","priority","tags","description","aiAnalysisLoading","aiAnalysis","completeness","dependencies","conflicts","suggestions","filterPriority","filterStatus","filterKeyword","filteredRequirements","req","matchPriority","matchStatus","matchKeyword","includes","reqFormRef","formRules","required","message","trigger","fetchRequirementList","async","res","forEach","analyzing","showFullAnalysis","ai_analysis","analyzeRequirement","console","ElMessage","fetchAiAnalysis","Array","isArray","log","warning","getCompletenessStatus","score","openEditReq","closeDialog","submitAddReq","validate","valid","formData","success","refreshAfterChange","handleDeleteReq","ElMessageBox","confirm","confirmButtonText","cancelButtonText","type","getStatusType","types","getStatusText","texts","formatDate","dateString","date","Date","now","diff","hours","Math","floor","minutes","getFullYear","String","getMonth","padStart","getDate","showMsg","then","catch","finally","onMounted","watch","__exports__"],"mappings":"mIAAA,0cAGO,SAASA,EAAsBC,GACpC,OAAOC,eAAQ,CACbC,IAAK,0BACLC,OAAQ,MACRC,OAAQ,CAAEC,QAASL,KAKhB,SAASM,EAAsBC,GACpC,OAAON,eAAQ,CACbC,IAAK,0BACLC,OAAQ,OACRI,OACAC,QAAS,CAAE,eAAgB,yBAKxB,SAASC,EAAsBC,GACpC,OAAOT,eAAQ,CACbC,IAAK,0BAA0BQ,KAC/BP,OAAQ,WAKL,SAASQ,EAAsBD,EAAIH,GACxC,OAAON,eAAQ,CACbC,IAAK,0BAA0BQ,KAC/BP,OAAQ,QACRI,OACAC,QAAS,CAAE,eAAgB,sBAKxB,SAASI,EAAkBZ,GAChC,OAAOC,eAAQ,CACbC,IAAK,qBACLC,OAAQ,MACRC,OAAQ,CAAEC,QAASL,KAKhB,SAASa,EAAkBN,GAChC,OAAON,eAAQ,CACbC,IAAK,qBACLC,OAAQ,OACRI,SAKG,SAASO,EAAkBJ,EAAIH,GACpC,OAAON,eAAQ,CACbC,IAAK,qBAAqBQ,KAC1BP,OAAQ,QACRI,SAKG,SAASQ,EAAkBL,GAChC,OAAOT,eAAQ,CACbC,IAAK,qBAAqBQ,KAC1BP,OAAQ,WAKL,SAASa,EAAyBhB,GACvC,OAAOC,eAAQ,CACbC,IAAK,iCACLC,OAAQ,MACRC,OAAQ,CAAEC,QAASL,KAKhB,SAASiB,EAAuBjB,GACrC,OAAOC,eAAQ,CACbC,IAAK,uCACLC,OAAQ,MACRC,OAAQ,CAAEC,QAASL,KAKhB,SAASkB,EAA+BC,GAC7C,OAAOlB,eAAQ,CACbC,IAAK,qBAAqBiB,iBAC1BhB,OAAQ,QAKL,SAASiB,EAAsBpB,EAAWO,GAC/C,OAAON,eAAQ,CACbC,IAAK,iBAAiBF,sBACtBG,OAAQ,OACRI,OACAc,aAAc,OACdC,QAAS,KACTd,QAAS,CACP,eAAgB,mBAChB,OAAU,2CAEZe,eAAgB,SAAUC,GACxB,OAAOA,GAAU,KAAOA,EAAS,OAMhC,SAASC,EAAwBzB,GACtC,OAAOC,eAAQ,CACbC,IAAK,iBAAiBF,oBACtBG,OAAQ,U,oCC1HZ,W,oCCAA,W,6DCCA,IAAIuB,EAAI,EAAQ,QACZC,EAAO,EAAQ,QACfC,EAAY,EAAQ,QACpBC,EAAW,EAAQ,QACnBC,EAAoB,EAAQ,QAC5BC,EAAsB,EAAQ,QAC9BC,EAA+B,EAAQ,QACvCC,EAAU,EAAQ,QAClBC,EAAgB,EAAQ,QACxBC,EAA2C,EAAQ,QAEnDC,GAAoCH,GAAWE,EAAyC,SAAUE,WAElGC,EAAgBP,GAAoB,WACtC,IAGIQ,EAAQC,EAAMC,EAHdC,EAAWC,KAAKD,SAChBE,EAAYD,KAAKC,UACjBC,EAAOF,KAAKE,KAEhB,MAAO,EAAM,CAGX,GAFAN,EAASV,EAASF,EAAKkB,EAAMH,IAC7BF,EAAOG,KAAKH,OAASD,EAAOC,KACxBA,EAAM,OAEV,GADAC,EAAQF,EAAOE,MACXT,EAA6BU,EAAUE,EAAW,CAACH,EAAOE,KAAKG,YAAY,GAAO,OAAOL,MAMjGf,EAAE,CAAEqB,OAAQ,WAAYC,OAAO,EAAMC,MAAM,EAAMC,OAAQjB,GAAWG,GAAoC,CACtGe,OAAQ,SAAgBP,GACtBf,EAASc,MACT,IACEf,EAAUgB,GACV,MAAOQ,GACPlB,EAAcS,KAAM,QAASS,GAG/B,OAAIhB,EAAyCT,EAAKS,EAAkCO,KAAMC,GAEnF,IAAIN,EAAcR,EAAkBa,MAAO,CAChDC,UAAWA,Q,ssCCiHjB,MAAMS,EAAQC,iBACRtD,EAAYuD,sBAAS,IAAMF,EAAMjD,OAAOM,IAExC8C,EAAeC,iBAAI,IACnBC,EAAUD,kBAAI,GACdE,EAAaF,kBAAI,GACjBG,EAAaH,kBAAI,GACjBI,EAAWJ,kBAAI,GACfK,EAAeL,iBAAI,MACnBM,EAAaN,iBAAI,CAAEO,KAAM,GAAIC,SAAU,SAAUC,KAAM,GAAIC,YAAa,GAAI3C,OAAQ,YACpF4C,EAAoBX,kBAAI,GACxBY,EAAaZ,iBAAI,CACrBa,aAAc,EACdC,aAAc,EACdC,UAAW,EACXC,YAAa,KAETC,EAAiBjB,iBAAI,IACrBkB,EAAelB,iBAAI,IACnBmB,GAAgBnB,iBAAI,IACpBoB,GAAuBtB,sBAAS,IAC7BC,EAAaf,MAAMU,OAAO2B,IAC/B,MAAMC,GAAiBL,EAAejC,OAASqC,EAAIb,WAAaS,EAAejC,MACzEuC,GAAeL,EAAalC,OAASqC,EAAItD,SAAWmD,EAAalC,MACjEwC,GAAgBL,GAAcnC,OAASqC,EAAId,KAAKkB,SAASN,GAAcnC,QAAWqC,EAAIX,aAAeW,EAAIX,YAAYe,SAASN,GAAcnC,OAClJ,OAAOsC,GAAiBC,GAAeC,KAKrCE,GAAa1B,iBAAI,MAGjB2B,GAAY,CAChBpB,KAAM,CAAC,CAAEqB,UAAU,EAAMC,QAAS,UAAWC,QAAS,SACtDtB,SAAU,CAAC,CAAEoB,UAAU,EAAMC,QAAS,SAAUC,QAAS,WACzDrB,KAAM,CAAC,CAAEmB,UAAU,EAAMC,QAAS,QAASC,QAAS,SACpDpB,YAAa,CAAC,CAAEkB,UAAU,EAAMC,QAAS,UAAWC,QAAS,SAC7D/D,OAAQ,CAAC,CAAE6D,UAAU,EAAMC,QAAS,QAASC,QAAS,YAIlDC,GAAuBC,UAC3B,IACE/B,EAAQjB,OAAQ,EAChB,MAAMiD,QAAY9E,eAAkBZ,EAAUyC,OAC9Ce,EAAaf,MAAQiD,EAAInF,KACzBiD,EAAaf,MAAMkD,QAAQb,IACzBA,EAAIc,WAAY,EAChBd,EAAIe,kBAAmB,EAEvBf,EAAIgB,YAAc,GAClBC,GAAmBjB,KAErB,MAAO1B,GACP4C,QAAQ5C,MAAM,YAAaA,GAC3B6C,OAAU7C,MAAM,YAChB,QACAM,EAAQjB,OAAQ,IAKdyD,GAAkBT,UACtB,GAAKzF,EAAUyC,MAKf,IACE2B,EAAkB3B,OAAQ,EAC1B,MAAMiD,QAAY1E,eAAyBhB,EAAUyC,OAGjDiD,EAAInF,MACN8D,EAAW5B,MAAQ,CACjB6B,aAAcoB,EAAInF,KAAK+D,cAAgB,EACvCC,aAAcmB,EAAInF,KAAKgE,cAAgB,EACvCC,UAAWkB,EAAInF,KAAKiE,WAAa,EACjCC,YAAa0B,MAAMC,QAAQV,EAAInF,KAAKkE,aAAeiB,EAAInF,KAAKkE,YAAc,IAG5EuB,QAAQK,IAAI,YAAahC,EAAW5B,SAEpCuD,QAAQ5C,MAAM,gBAAiBsC,GAC/BO,OAAU7C,MAAM,iBAElB,MAAOA,GACP4C,QAAQ5C,MAAM,YAAaA,GAC3B6C,OAAU7C,MAAM,YAChB,QACAgB,EAAkB3B,OAAQ,OA1B1BwD,OAAUK,QAAQ,cA+BhBC,GAAyBC,GACzBA,GAAS,GAAW,UACpBA,GAAS,GAAW,UACjB,YAIHC,GAAe3B,IACnBjB,EAASpB,OAAQ,EACjBqB,EAAarB,MAAQqC,EAAIpE,GACzBqD,EAAWtB,MAAQ,CACjBuB,KAAMc,EAAId,KACVC,SAAUa,EAAIb,SACdC,KAAMY,EAAIZ,KACVC,YAAaW,EAAIX,YACjB3C,OAAQsD,EAAItD,QAEdoC,EAAWnB,OAAQ,GAIfiE,GAAcA,KAClB9C,EAAWnB,OAAQ,EACnBoB,EAASpB,OAAQ,EACjBqB,EAAarB,MAAQ,KACrBsB,EAAWtB,MAAQ,CAAEuB,KAAM,GAAIC,SAAU,SAAUC,KAAM,GAAIC,YAAa,GAAI3C,OAAQ,YAIlFmF,GAAelB,UACdN,GAAW1C,MAKhB0C,GAAW1C,MAAMmE,SAASnB,UACxB,GAAKoB,EAKL,IACElD,EAAWlB,OAAQ,EACnB,MAAMqE,EAAW,CACfzG,QAASL,EAAUyC,MACnBuB,KAAMD,EAAWtB,MAAMuB,KACvBG,YAAaJ,EAAWtB,MAAM0B,YAC9BF,SAAUF,EAAWtB,MAAMwB,SAC3BC,KAAMH,EAAWtB,MAAMyB,KACvB1C,OAAQuC,EAAWtB,MAAMjB,QAEvBqC,EAASpB,OAASqB,EAAarB,aAC3B3B,eAAkBgD,EAAarB,MAAOqE,GAC5Cb,OAAUc,QAAQ,kBAEZlG,eAAkBiG,GACxBb,OAAUc,QAAQ,WAEpBL,KACAM,KACA,MAAO5D,GACP4C,QAAQ5C,MAAM,UAAWA,GACzB6C,OAAU7C,MAAM,UAChB,QACAO,EAAWlB,OAAQ,OA3BnBwD,OAAU7C,MAAM,cANlB4C,QAAQ5C,MAAM,YAuCZ6D,GAAkBxB,UACtB,UACQyB,OAAaC,QAAQ,WAAY,KAAM,CAC3CC,kBAAmB,KACnBC,iBAAkB,KAClBC,KAAM,YAGR5D,EAAQjB,OAAQ,QACV1B,eAAkB+D,EAAIpE,IAC5BuF,OAAUc,QAAQ,QAClBC,KACA,MAAO5D,GACO,WAAVA,IACF4C,QAAQ5C,MAAM,UAAWA,GACzB6C,OAAU7C,MAAM,WAElB,QACAM,EAAQjB,OAAQ,IAKd8E,GAAiB/F,IACrB,MAAMgG,EAAQ,CACZ,QAAW,OACX,cAAe,UACf,UAAa,WAEf,OAAOA,EAAMhG,IAAW,QAIpBiG,GAAiBjG,IACrB,MAAMkG,EAAQ,CACZ,QAAW,MACX,cAAe,MACf,UAAa,OAEf,OAAOA,EAAMlG,IAAW,OAIpBmG,GAAcC,IAClB,IAAKA,EAAY,MAAO,KACxB,MAAMC,EAAO,IAAIC,KAAKF,GAChBG,EAAM,IAAID,KACVE,EAAOD,EAAMF,EAGnB,GAAIG,EAAO,MAAqB,CAC9B,MAAMC,EAAQC,KAAKC,MAAMH,EAAO,MAChC,GAAIC,EAAQ,EACV,OAAUA,EAAH,MAET,MAAMG,EAAUF,KAAKC,MAAMH,EAAO,KAClC,OAAII,EAAU,EACFA,EAAH,MAEF,KAIT,MAAO,GAAGP,EAAKQ,iBAAiBC,OAAOT,EAAKU,WAAa,GAAGC,SAAS,EAAG,QAAQF,OAAOT,EAAKY,WAAWD,SAAS,EAAG,QAI/GzC,GAAqBA,CAACjB,EAAK4D,GAAU,KACpC5D,EAAIpE,IAIToE,EAAIc,WAAY,EAChB1E,eAA+B4D,EAAIpE,IAChCiI,KAAKjD,IACJZ,EAAIgB,YAAcJ,EAAInF,KAAKuF,aAAe,OAC1ChB,EAAIe,kBAAmB,EACnB6C,GAASzC,OAAUc,QAAQ,YAEhC6B,MAAM,KACL9D,EAAIgB,YAAc,SACd4C,GAASzC,OAAU7C,MAAM,YAE9ByF,QAAQ,KACP/D,EAAIc,WAAY,KAfd8C,GAASzC,OAAUK,QAAQ,YAoBnCwC,uBAAU,KACRtD,KACAU,OAIF6C,mBAAM/I,EAAW,KACXA,EAAUyC,QACZ+C,KACAU,QAKJ,MAAMc,GAAqBA,KACzBxB,KACAU,M,g0UCnaF,MAAM8C,EAA2B,IAAgB,EAAQ,CAAC,CAAC,YAAY,qBAExD,gB","file":"js/chunk-5a365133.e813d740.js","sourcesContent":["import request from '@/utils/request'\n\n// 获取项目文档列表\nexport function fetchProjectDocuments(projectId) {\n  return request({\n    url: '/api/project-documents/',\n    method: 'get',\n    params: { project: projectId }\n  })\n}\n\n// 上传项目文档\nexport function uploadProjectDocument(data) {\n  return request({\n    url: '/api/project-documents/',\n    method: 'post',\n    data,\n    headers: { 'Content-Type': 'multipart/form-data' }\n  })\n}\n\n// 删除项目文档\nexport function deleteProjectDocument(id) {\n  return request({\n    url: `/api/project-documents/${id}/`,\n    method: 'delete'\n  })\n}\n\n// 编辑项目文档\nexport function updateProjectDocument(id, data) {\n  return request({\n    url: `/api/project-documents/${id}/`,\n    method: 'patch',\n    data,\n    headers: { 'Content-Type': 'application/json' }\n  })\n}\n\n// 获取项目需求列表\nexport function fetchRequirements(projectId) {\n  return request({\n    url: '/api/requirements/',\n    method: 'get',\n    params: { project: projectId }\n  })\n}\n\n// 创建需求\nexport function createRequirement(data) {\n  return request({\n    url: '/api/requirements/',\n    method: 'post',\n    data\n  })\n}\n\n// 更新需求\nexport function updateRequirement(id, data) {\n  return request({\n    url: `/api/requirements/${id}/`,\n    method: 'patch',\n    data\n  })\n}\n\n// 删除需求\nexport function deleteRequirement(id) {\n  return request({\n    url: `/api/requirements/${id}/`,\n    method: 'delete'\n  })\n}\n\n// 获取需求AI分析\nexport function getRequirementAiAnalysis(projectId) {\n  return request({\n    url: '/api/requirements/ai_analysis/',\n    method: 'get',\n    params: { project: projectId }\n  })\n}\n\n// 获取文档AI聚合分析\nexport function getDocumentAiDashboard(projectId) {\n  return request({\n    url: '/api/project-documents/ai_dashboard/',\n    method: 'get',\n    params: { project: projectId }\n  })\n}\n\n// 获取单条需求AI分析\nexport function getSingleRequirementAiAnalysis(requirementId) {\n  return request({\n    url: `/api/requirements/${requirementId}/ai_analysis/`,\n    method: 'get'\n  })\n}\n\n// 导出项目AI分析报告（支持POST图片）\nexport function exportProjectAiReport(projectId, data) {\n  return request({\n    url: `/api/projects/${projectId}/export_ai_report/`,\n    method: 'post',\n    data,\n    responseType: 'blob', // 重要：下载文件\n    timeout: 120000, // 增加超时时间到120秒\n    headers: {\n      'Content-Type': 'application/json',\n      'Accept': 'application/pdf, application/json;q=0.9'\n    },\n    validateStatus: function (status) {\n      return status >= 200 && status < 500 // 默认只接受2xx响应状态码\n    }\n  })\n}\n\n// 获取项目报表中每个图表的AI分析\nexport function getProjectChartAnalysis(projectId) {\n  return request({\n    url: `/api/projects/${projectId}/chart_analysis/`,\n    method: 'get'\n  })\n} ","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./RequirementsView.vue?vue&type=style&index=0&id=1c82d407&scoped=true&lang=css\"","export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--1-1!./RequirementsView.vue?vue&type=style&index=1&id=1c82d407&lang=scss\"","'use strict';\nvar $ = require('../internals/export');\nvar call = require('../internals/function-call');\nvar aCallable = require('../internals/a-callable');\nvar anObject = require('../internals/an-object');\nvar getIteratorDirect = require('../internals/get-iterator-direct');\nvar createIteratorProxy = require('../internals/iterator-create-proxy');\nvar callWithSafeIterationClosing = require('../internals/call-with-safe-iteration-closing');\nvar IS_PURE = require('../internals/is-pure');\nvar iteratorClose = require('../internals/iterator-close');\nvar iteratorHelperWithoutClosingOnEarlyError = require('../internals/iterator-helper-without-closing-on-early-error');\n\nvar filterWithoutClosingOnEarlyError = !IS_PURE && iteratorHelperWithoutClosingOnEarlyError('filter', TypeError);\n\nvar IteratorProxy = createIteratorProxy(function () {\n  var iterator = this.iterator;\n  var predicate = this.predicate;\n  var next = this.next;\n  var result, done, value;\n  while (true) {\n    result = anObject(call(next, iterator));\n    done = this.done = !!result.done;\n    if (done) return;\n    value = result.value;\n    if (callWithSafeIterationClosing(iterator, predicate, [value, this.counter++], true)) return value;\n  }\n});\n\n// `Iterator.prototype.filter` method\n// https://tc39.es/ecma262/#sec-iterator.prototype.filter\n$({ target: 'Iterator', proto: true, real: true, forced: IS_PURE || filterWithoutClosingOnEarlyError }, {\n  filter: function filter(predicate) {\n    anObject(this);\n    try {\n      aCallable(predicate);\n    } catch (error) {\n      iteratorClose(this, 'throw', error);\n    }\n\n    if (filterWithoutClosingOnEarlyError) return call(filterWithoutClosingOnEarlyError, this, predicate);\n\n    return new IteratorProxy(getIteratorDirect(this), {\n      predicate: predicate\n    });\n  }\n});\n","<template>\n  <div class=\"module-card\">\n    <div class=\"module-header\">\n      <h5 class=\"module-title\">需求管理</h5>\n      <div class=\"btn-group\">\n        <el-button type=\"primary\" size=\"default\" round @click=\"showAddReq=true\">新建需求</el-button>\n      </div>\n    </div>\n    <!-- AI需求分析 -->\n    <div class=\"ai-requirement-analysis mb-4\">\n      <div class=\"d-flex justify-content-between align-items-center mb-3\">\n        <h6 class=\"mb-0\">AI需求分析</h6>\n        <div class=\"btn-group\">\n          <el-button size=\"small\" @click=\"fetchAiAnalysis\" :loading=\"aiAnalysisLoading\">\n            <el-icon><Refresh /></el-icon>刷新分析\n          </el-button>\n        </div>\n      </div>\n      <div class=\"row\">\n        <div class=\"col-md-4\">\n          <div class=\"ai-analysis-card\">\n            <h6 class=\"text-primary\">需求完整性</h6>\n            <el-progress :percentage=\"aiAnalysis.completeness\" :status=\"getCompletenessStatus(aiAnalysis.completeness)\" style=\"margin-bottom:8px;\" />\n            <p class=\"text-muted small\">需求描述完整性评分</p>\n          </div>\n        </div>\n        <div class=\"col-md-4\">\n          <div class=\"ai-analysis-card\">\n            <h6 class=\"text-primary\">需求依赖关系</h6>\n            <div class=\"requirement-dependencies\">\n              <div class=\"dependency-item\">\n                <el-icon><Connection /></el-icon>\n                发现{{aiAnalysis.dependencies}}个需求依赖关系\n              </div>\n              <div class=\"dependency-item\">\n                <el-icon><CircleCloseFilled /></el-icon>\n                {{aiAnalysis.conflicts}}个需求存在冲突\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class=\"col-md-4\">\n          <div class=\"ai-analysis-card\">\n            <h6 class=\"text-primary\">智能建议</h6>\n            <div class=\"ai-suggestions\">\n              <div v-if=\"aiAnalysis.suggestions.length === 0\" class=\"text-center py-2\">\n                <!-- 不显示任何内容 -->\n              </div>\n              <div class=\"suggestion-item\" v-for=\"(suggestion, i) in aiAnalysis.suggestions\" :key=\"i\">\n                <el-icon><Lightning v-if=\"i === 0\" /><Check v-else /></el-icon>\n                {{suggestion}}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!-- 筛选区 -->\n    <div class=\"filter-bar\" style=\"display:flex;gap:12px;margin-bottom:16px;\">\n      <el-select v-model=\"filterPriority\" placeholder=\"优先级\" clearable style=\"width:120px;\">\n        <el-option label=\"全部\" value=\"\" />\n        <el-option label=\"高\" value=\"high\" />\n        <el-option label=\"中\" value=\"medium\" />\n        <el-option label=\"低\" value=\"low\" />\n      </el-select>\n      <el-select v-model=\"filterStatus\" placeholder=\"状态\" clearable style=\"width:120px;\">\n        <el-option label=\"全部\" value=\"\" />\n        <el-option label=\"待处理\" value=\"pending\" />\n        <el-option label=\"进行中\" value=\"in-progress\" />\n        <el-option label=\"已完成\" value=\"completed\" />\n      </el-select>\n      <el-input v-model=\"filterKeyword\" placeholder=\"关键词\" clearable style=\"width:180px;\" />\n    </div>\n    <!-- 需求列表 -->\n    <div v-loading=\"loading\" class=\"requirements-list\">\n      <div class=\"list-group\">\n        <div class=\"list-group-item list-group-item-action\" v-for=\"req in filteredRequirements\" :key=\"req.id\">\n          <div class=\"d-flex w-100 justify-content-between\">\n            <div>\n              <h6 class=\"mb-1\">{{ req.name }}</h6>\n              <div class=\"ai-requirement-tags\">\n                <el-tag v-for=\"tag in req.tags_list\" :key=\"tag.text\" :type=\"tag.type\" size=\"small\">{{ tag.text }}</el-tag>\n              </div>\n            </div>\n            <div class=\"text-end\">\n              <el-tag :type=\"getStatusType(req.status)\" size=\"small\">{{ getStatusText(req.status) }}</el-tag>\n              <div class=\"ai-requirement-status\">\n                <small class=\"text-muted\">{{ formatDate(req.created_at) }}</small>\n              </div>\n              <div style=\"margin-top: 8px;\">\n                <el-button size=\"small\" type=\"primary\" text @click=\"openEditReq(req)\">编辑</el-button>\n                <el-button size=\"small\" type=\"danger\" text @click=\"handleDeleteReq(req)\">删除</el-button>\n                <el-button size=\"small\" type=\"info\" text @click=\"analyzeRequirement(req, true)\" :loading=\"req.analyzing\">AI分析</el-button>\n              </div>\n            </div>\n          </div>\n          <p class=\"mb-1\">{{ req.description || '暂无描述' }}</p>\n          <div class=\"ai-requirement-analysis\" v-if=\"req.ai_analysis\">\n            <div class=\"d-flex justify-content-between\">\n              <small class=\"text-muted\">AI分析：</small>\n              <el-button type=\"link\" size=\"small\" @click=\"req.showFullAnalysis = !req.showFullAnalysis\">\n                {{ req.showFullAnalysis ? '收起' : '展开' }}\n              </el-button>\n            </div>\n            <div v-if=\"req.showFullAnalysis\">{{ req.ai_analysis }}</div>\n            <div v-else>{{ req.ai_analysis.substring(0, 100) }}{{ req.ai_analysis.length > 100 ? '...' : '' }}</div>\n          </div>\n          <div class=\"ai-requirement-analysis\" v-else>\n            <small class=\"text-muted\">暂无AI分析</small>\n          </div>\n        </div>\n      </div>\n      <el-empty v-if=\"requirements.length === 0\" description=\"暂无需求数据\" />\n    </div>\n  </div>\n  <!-- 新建/编辑需求弹窗 -->\n  <el-dialog v-model=\"showAddReq\" :title=\"editMode ? '编辑需求' : '新建需求'\" width=\"400px\">\n    <el-form :model=\"addReqForm\" label-width=\"80px\" :rules=\"formRules\" ref=\"reqFormRef\">\n      <el-form-item label=\"需求名称\" prop=\"name\" required>\n        <el-input v-model=\"addReqForm.name\" placeholder=\"请输入需求名称\" />\n      </el-form-item>\n      <el-form-item label=\"优先级\" prop=\"priority\" required>\n        <el-select v-model=\"addReqForm.priority\" placeholder=\"请选择\">\n          <el-option label=\"高\" value=\"high\" />\n          <el-option label=\"中\" value=\"medium\" />\n          <el-option label=\"低\" value=\"low\" />\n        </el-select>\n      </el-form-item>\n      <el-form-item label=\"标签\" prop=\"tags\" required>\n        <el-input v-model=\"addReqForm.tags\" placeholder=\"逗号分隔，如：功能,高优先级\" />\n      </el-form-item>\n      <el-form-item label=\"描述\" prop=\"description\" required>\n        <el-input v-model=\"addReqForm.description\" type=\"textarea\" placeholder=\"请输入需求描述\" />\n      </el-form-item>\n      <el-form-item label=\"状态\" prop=\"status\" required>\n        <el-select v-model=\"addReqForm.status\" placeholder=\"请选择\">\n          <el-option label=\"待处理\" value=\"pending\" />\n          <el-option label=\"进行中\" value=\"in-progress\" />\n          <el-option label=\"已完成\" value=\"completed\" />\n        </el-select>\n      </el-form-item>\n    </el-form>\n    <template #footer>\n      <el-button @click=\"closeDialog\">取消</el-button>\n      <el-button type=\"primary\" @click=\"submitAddReq\" :loading=\"submitting\">{{ editMode ? '保存' : '提交' }}</el-button>\n    </template>\n  </el-dialog>\n</template>\n<script setup>\nimport { Connection, CircleCloseFilled, Lightning, Check, Refresh } from '@element-plus/icons-vue'\nimport { ref, onMounted, computed, watch } from 'vue'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport { fetchRequirements, createRequirement, updateRequirement, deleteRequirement, getRequirementAiAnalysis, getSingleRequirementAiAnalysis } from '@/api/project'\nimport { useRoute } from 'vue-router'\n\nconst route = useRoute()\nconst projectId = computed(() => route.params.id)\n\nconst requirements = ref([])\nconst loading = ref(false)\nconst submitting = ref(false)\nconst showAddReq = ref(false)\nconst editMode = ref(false)\nconst editingReqId = ref(null)\nconst addReqForm = ref({ name: '', priority: 'medium', tags: '', description: '', status: 'pending' })\nconst aiAnalysisLoading = ref(false)\nconst aiAnalysis = ref({\n  completeness: 0,\n  dependencies: 0,\n  conflicts: 0,\n  suggestions: []\n})\nconst filterPriority = ref('')\nconst filterStatus = ref('')\nconst filterKeyword = ref('')\nconst filteredRequirements = computed(() => {\n  return requirements.value.filter(req => {\n    const matchPriority = !filterPriority.value || req.priority === filterPriority.value\n    const matchStatus = !filterStatus.value || req.status === filterStatus.value\n    const matchKeyword = !filterKeyword.value || req.name.includes(filterKeyword.value) || (req.description && req.description.includes(filterKeyword.value))\n    return matchPriority && matchStatus && matchKeyword\n  })\n})\n\n// 表单引用\nconst reqFormRef = ref(null)\n\n// 表单验证规则\nconst formRules = {\n  name: [{ required: true, message: '请输入需求名称', trigger: 'blur' }],\n  priority: [{ required: true, message: '请选择优先级', trigger: 'change' }],\n  tags: [{ required: true, message: '请输入标签', trigger: 'blur' }],\n  description: [{ required: true, message: '请输入需求描述', trigger: 'blur' }],\n  status: [{ required: true, message: '请选择状态', trigger: 'change' }]\n}\n\n// 获取需求列表\nconst fetchRequirementList = async () => {\n  try {\n    loading.value = true\n    const res = await fetchRequirements(projectId.value)\n    requirements.value = res.data\n    requirements.value.forEach(req => {\n      req.analyzing = false\n      req.showFullAnalysis = false\n      // 自动AI分析\n      req.ai_analysis = ''\n      analyzeRequirement(req)\n    })\n  } catch (error) {\n    console.error('获取需求列表失败:', error)\n    ElMessage.error('获取需求列表失败')\n  } finally {\n    loading.value = false\n  }\n}\n\n// 获取需求AI分析\nconst fetchAiAnalysis = async () => {\n  if (!projectId.value) {\n    ElMessage.warning('没有有效的项目ID')\n    return\n  }\n  \n  try {\n    aiAnalysisLoading.value = true\n    const res = await getRequirementAiAnalysis(projectId.value)\n    \n    // 检查响应数据结构\n    if (res.data) {\n      aiAnalysis.value = {\n        completeness: res.data.completeness || 0,\n        dependencies: res.data.dependencies || 0,\n        conflicts: res.data.conflicts || 0,\n        suggestions: Array.isArray(res.data.suggestions) ? res.data.suggestions : []\n      }\n      \n      console.log('AI需求分析结果:', aiAnalysis.value)\n    } else {\n      console.error('AI分析响应数据格式错误:', res)\n      ElMessage.error('AI分析响应数据格式错误')\n    }\n  } catch (error) {\n    console.error('获取AI分析失败:', error)\n    ElMessage.error('获取AI分析失败')\n  } finally {\n    aiAnalysisLoading.value = false\n  }\n}\n\n// 获取完整性状态\nconst getCompletenessStatus = (score) => {\n  if (score >= 80) return 'success' \n  if (score >= 60) return 'warning'\n  return 'exception'\n}\n\n// 打开编辑弹窗\nconst openEditReq = (req) => {\n  editMode.value = true\n  editingReqId.value = req.id\n  addReqForm.value = {\n    name: req.name,\n    priority: req.priority,\n    tags: req.tags,\n    description: req.description,\n    status: req.status\n  }\n  showAddReq.value = true\n}\n\n// 关闭弹窗\nconst closeDialog = () => {\n  showAddReq.value = false\n  editMode.value = false\n  editingReqId.value = null\n  addReqForm.value = { name: '', priority: 'medium', tags: '', description: '', status: 'pending' }\n}\n\n// 提交新建/编辑需求\nconst submitAddReq = async () => {\n  if (!reqFormRef.value) {\n    console.error('表单引用不存在')\n    return\n  }\n  \n  reqFormRef.value.validate(async valid => {\n    if (!valid) {\n      ElMessage.error('请填写所有必填项')\n      return\n    }\n    \n    try {\n      submitting.value = true\n      const formData = {\n        project: projectId.value,\n        name: addReqForm.value.name,\n        description: addReqForm.value.description,\n        priority: addReqForm.value.priority,\n        tags: addReqForm.value.tags,\n        status: addReqForm.value.status\n      }\n      if (editMode.value && editingReqId.value) {\n        await updateRequirement(editingReqId.value, formData)\n        ElMessage.success('需求更新成功')\n      } else {\n        await createRequirement(formData)\n        ElMessage.success('需求创建成功')\n      }\n      closeDialog()\n      refreshAfterChange()\n    } catch (error) {\n      console.error('保存需求失败:', error)\n      ElMessage.error('保存需求失败')\n    } finally {\n      submitting.value = false\n    }\n  })\n}\n\n// 删除需求\nconst handleDeleteReq = async (req) => {\n  try {\n    await ElMessageBox.confirm('确定删除此需求？', '提示', {\n      confirmButtonText: '确定',\n      cancelButtonText: '取消',\n      type: 'warning'\n    })\n    \n    loading.value = true\n    await deleteRequirement(req.id)\n    ElMessage.success('删除成功')\n    refreshAfterChange()\n  } catch (error) {\n    if (error !== 'cancel') {\n      console.error('删除需求失败:', error)\n      ElMessage.error('删除需求失败')\n    }\n  } finally {\n    loading.value = false\n  }\n}\n\n// 获取状态类型\nconst getStatusType = (status) => {\n  const types = {\n    'pending': 'info',\n    'in-progress': 'primary',\n    'completed': 'success'\n  }\n  return types[status] || 'info'\n}\n\n// 获取状态文本\nconst getStatusText = (status) => {\n  const texts = {\n    'pending': '待处理',\n    'in-progress': '进行中',\n    'completed': '已完成'\n  }\n  return texts[status] || '待处理'\n}\n\n// 格式化日期\nconst formatDate = (dateString) => {\n  if (!dateString) return '刚刚'\n  const date = new Date(dateString)\n  const now = new Date()\n  const diff = now - date\n  \n  // 如果小于1天，显示\"x小时前\"或\"x分钟前\"\n  if (diff < 24 * 60 * 60 * 1000) {\n    const hours = Math.floor(diff / (60 * 60 * 1000))\n    if (hours > 0) {\n      return `${hours}小时前`\n    }\n    const minutes = Math.floor(diff / (60 * 1000))\n    if (minutes > 0) {\n      return `${minutes}分钟前`\n    }\n    return '刚刚'\n  }\n  \n  // 否则显示日期\n  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`\n}\n\n// 分析需求\nconst analyzeRequirement = (req, showMsg = false) => {\n  if (!req.id) {\n    if (showMsg) ElMessage.warning('无效的需求ID')\n    return\n  }\n  req.analyzing = true\n  getSingleRequirementAiAnalysis(req.id)\n    .then(res => {\n      req.ai_analysis = res.data.ai_analysis || '暂无分析'\n      req.showFullAnalysis = false\n      if (showMsg) ElMessage.success('AI分析完成')\n    })\n    .catch(() => {\n      req.ai_analysis = 'AI分析失败'\n      if (showMsg) ElMessage.error('AI分析失败')\n    })\n    .finally(() => {\n      req.analyzing = false\n    })\n}\n\n// 在组件挂载时获取需求列表和AI分析\nonMounted(() => {\n  fetchRequirementList()\n  fetchAiAnalysis()\n})\n\n// 监听项目ID变化，同时刷新需求列表和AI分析\nwatch(projectId, () => {\n  if (projectId.value) {\n    fetchRequirementList()\n    fetchAiAnalysis()\n  }\n})\n\n// 在创建或更新需求后刷新AI分析\nconst refreshAfterChange = () => {\n  fetchRequirementList()\n  fetchAiAnalysis()\n}\n</script>\n<style scoped>\n.module-card { background: var(--bg-color-secondary); border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px; padding: 20px; }\n.module-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }\n.module-title { font-size: 1.1rem; font-weight: 600; color: var(--text-color) !important; margin: 0; }\n.btn-group { display: flex; gap: 10px; }\n.row { display: flex; flex-wrap: wrap; margin: 0 -10px; }\n.col-md-4 { padding: 0 10px; width: 33.3333%; }\n.mb-4 { margin-bottom: 24px; }\n.list-group { margin: 0; }\n.list-group-item,\n.list-group-item-action,\n.list-group-item-action:active,\n.list-group-item-action:focus,\n.list-group-item-action:hover {\n  background: var(--bg-color-tertiary) !important;\n  color: var(--text-color);\n  border: none;\n}\n.ai-analysis-card { background: var(--bg-color-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin-bottom: 15px; }\n.dependency-item, .suggestion-item { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }\n.text-primary { color: var(--primary-color)!important; }\n.filter-bar { display: flex; gap: 12px; margin-bottom: 16px; }\n.list-group-item:hover {\n  background: var(--hover-color);\n  color: var(--primary-color);\n}\n.ai-requirement-analysis {\n  background: var(--bg-color-tertiary);\n  border-radius: 8px;\n  padding: 16px;\n  margin-bottom: 16px;\n  color: var(--text-color);\n}\n.ai-requirement-analysis .text-muted,\n.ai-requirement-analysis small {\n  color: var(--text-color-tertiary) !important;\n}\n\n/* 确保 Element Plus 组件在深色模式下正确显示 */\n:deep(.el-dialog),\n:deep(.el-dialog .el-dialog__body),\n:deep(.el-dialog .el-dialog__header),\n:deep(.el-dialog .el-dialog__footer) {\n  background: var(--bg-color-secondary) !important;\n  color: var(--text-color) !important;\n}\n\n:deep(.el-button.el-button--text) {\n  color: var(--primary-color) !important;\n}\n\n:deep(.el-select-dropdown),\n:deep(.el-select-dropdown__item),\n:deep(.el-select-dropdown__list) {\n  background-color: var(--bg-color-secondary) !important;\n  color: var(--text-color) !important;\n}\n\n:deep(.el-select-dropdown__item.hover),\n:deep(.el-select-dropdown__item:hover) {\n  background-color: var(--hover-color) !important;\n}\n\n/* 修复 el-tag 标签在深色模式下的显示 */\n:deep(.el-tag) {\n  background-color: var(--bg-color-tertiary) !important;\n  color: var(--text-color) !important;\n  border-color: var(--border-color) !important;\n}\n\n:deep(.el-tag.el-tag--info) {\n  background-color: var(--bg-color-tertiary) !important;\n  border-color: var(--border-color) !important;\n}\n\n:deep(.el-tag.el-tag--success) {\n  background-color: var(--success-color) !important;\n  border-color: var(--success-color) !important;\n  color: #fff !important;\n}\n\n:deep(.el-tag.el-tag--primary) {\n  background-color: var(--primary-color) !important;\n  border-color: var(--primary-color) !important;\n  color: #fff !important;\n}\n\n:deep(.el-tag.el-tag--warning) {\n  background-color: var(--warning-color) !important;\n  border-color: var(--warning-color) !important;\n  color: #fff !important;\n}\n\n:deep(.el-tag.el-tag--danger) {\n  background-color: var(--danger-color) !important;\n  border-color: var(--danger-color) !important;\n  color: #fff !important;\n}\n\n/* 修复按钮悬停效果 */\n:deep(.el-button:hover),\n:deep(.el-button:focus) {\n  background-color: var(--hover-color) !important;\n  border-color: var(--primary-color) !important;\n  color: var(--primary-color) !important;\n}\n\n:deep(.el-button--primary:hover),\n:deep(.el-button--primary:focus) {\n  background-color: var(--primary-color) !important;\n  opacity: 0.9;\n  color: #fff !important;\n}\n\n:deep(.el-button--danger:hover),\n:deep(.el-button--danger:focus) {\n  background-color: var(--danger-color) !important;\n  opacity: 0.9;\n  color: #fff !important;\n}\n\n:deep(.el-button--info:hover),\n:deep(.el-button--info:focus) {\n  background-color: var(--info-color) !important;\n  opacity: 0.9;\n  color: #fff !important;\n}\n\n:deep(.el-button--text:hover),\n:deep(.el-button--text:focus) {\n  background-color: transparent !important;\n  color: var(--primary-color) !important;\n  opacity: 0.9;\n}\n\n/* 确保字体可见 */\n.ai-requirement-tags,\n.ai-requirement-status {\n  color: var(--text-color) !important;\n}\n\n/* 修复列表项细节 */\n.list-group-item {\n  border-radius: 5px !important;\n  margin-bottom: 10px !important;\n  padding: 16px !important;\n}\n</style>\n\n<style lang=\"scss\">\n[data-theme=\"dark\"] {\n  .module-card, .ai-analysis-card, .list-group-item, .el-dialog {\n    background-color: var(--el-bg-color-page) !important;\n    color: var(--el-text-color-primary) !important;\n    border: 1px solid var(--el-border-color-light) !important;\n  }\n\n  .module-title, h6, .el-dialog__title {\n    color: var(--el-text-color-primary) !important;\n  }\n\n  .text-muted, .small, .ai-requirement-analysis small.text-muted {\n    color: var(--el-text-color-secondary) !important;\n  }\n  \n  .el-form-item__label {\n    color: var(--el-text-color-secondary) !important;\n  }\n\n  .el-input__wrapper, .el-select .el-input__wrapper {\n    background-color: var(--el-fill-color-light) !important;\n    border-color: var(--el-border-color) !important;\n  }\n\n  .list-group-item-action:hover {\n    background-color: var(--el-fill-color-light) !important;\n  }\n\n  .dependency-item, .suggestion-item {\n    color: var(--el-text-color-secondary) !important;\n  }\n}\n</style> ","import script from \"./RequirementsView.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./RequirementsView.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./RequirementsView.vue?vue&type=style&index=0&id=1c82d407&scoped=true&lang=css\"\nimport \"./RequirementsView.vue?vue&type=style&index=1&id=1c82d407&lang=scss\"\n\nimport exportComponent from \"C:\\\\Users\\\\18083\\\\Desktop\\\\CCIT\\\\office\\\\smart-office\\\\frontend\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-1c82d407\"]])\n\nexport default __exports__"],"sourceRoot":""}