(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8e2c8c7a","chunk-2d0e4842"],{"0f0c":function(e,t,c){},"6c4a":function(e,t,c){},"82e0":function(e,t,c){"use strict";c("0f0c")},"910d":function(e,t,c){"use strict";var a=c("23e7"),l=c("c65b"),s=c("59ed"),r=c("825a"),n=c("46c4"),o=c("c5cc"),i=c("9bdd"),d=c("c430"),b=c("2a62"),m=c("f99f"),u=!d&&m("filter",TypeError),j=o((function(){var e,t,c,a=this.iterator,s=this.predicate,n=this.next;while(1){if(e=r(l(n,a)),t=this.done=!!e.done,t)return;if(c=e.value,i(a,s,[c,this.counter++],!0))return c}}));a({target:"Iterator",proto:!0,real:!0,forced:d||u},{filter:function(e){r(this);try{s(e)}catch(t){b(this,"throw",t)}return u?l(u,this,e):new j(n(this),{predicate:e})}})},ab435:function(e,t,c){"use strict";c.r(t);c("14d9"),c("e9f5"),c("910d"),c("7d54");var a=c("7a23"),l=c("c466"),s=c("7c5c"),r=c("b775");const n={class:"dashboard-view"},o={class:"row mb-4"},i={class:"col-md-6"},d={class:"module-card"},b={class:"health-content"},m={key:0,class:"d-flex justify-content-center py-3"},u={class:"progress mb-2"},j={class:"health-desc"},v={class:"col-md-6"},O={class:"module-card"},p={class:"risk-content"},E={key:0,class:"d-flex justify-content-center py-3"},y={class:"risk-text"},h={key:0,class:"text-center text-muted py-3"},k={class:"row mb-4"},N={class:"col-md-3"},f={class:"stats-card bg-success"},V={class:"stats-content"},g={class:"stats-number"},B={class:"col-md-3"},w={class:"stats-card bg-warning"},_={class:"stats-content"},x={class:"stats-number"},D={class:"col-md-3"},M={class:"stats-card bg-primary"},S={class:"stats-content"},$={class:"stats-number"},C={class:"col-md-3"},T={class:"stats-card bg-info"},q={class:"stats-content"},A={class:"stats-number"},F={class:"module-card"},z={class:"activity-list"},L={key:0,class:"d-flex justify-content-center py-3"},H={class:"activity-main"},I={class:"activity-title"},J=["innerHTML"],G={class:"activity-time"},K={key:0,class:"no-activity"};var P={__name:"DashboardView",props:{project:Object,tasks:Array,documents:Array,requirements:Array},setup(e){const t=e,c=Object(a["ref"])(!1),P=Object(a["ref"])(65),Q=Object(a["ref"])("项目处于功能阶段，各项工作有序开展，存在一定不确定性。"),R=Object(a["ref"])([]),U=Object(a["computed"])(()=>{var e;return(null===(e=t.tasks)||void 0===e?void 0:e.filter(e=>"done"===e.status).length)||0}),W=Object(a["computed"])(()=>{var e;return(null===(e=t.tasks)||void 0===e?void 0:e.filter(e=>"done"!==e.status).length)||0}),X=Object(a["computed"])(()=>{var e;return(null===(e=t.documents)||void 0===e?void 0:e.length)||0}),Y=Object(a["computed"])(()=>{var e;return(null===(e=t.requirements)||void 0===e?void 0:e.length)||0}),Z=Object(a["computed"])(()=>P.value>=80?"bg-success":P.value>=60?"bg-warning":"bg-danger");function ee(e){return 0===e?"success":"warning"}function te(e){return 0===e?"bi-check-circle-fill":"bi-exclamation-triangle-fill"}async function ce(){var e;if(null!==(e=t.project)&&void 0!==e&&e.id){c.value=!0;try{const e=await r["a"].get(`/api/projects/${t.project.id}/ai_dashboard/`);console.log("项目分析数据:",e.data),P.value=e.data.health||0,Q.value=e.data.health_desc||"无法获取项目健康度数据",Array.isArray(e.data.risks)?R.value=e.data.risks:R.value=[]}catch(a){console.error("加载项目分析数据失败:",a),P.value=0,Q.value="无法获取项目健康度数据",R.value=[]}finally{c.value=!1}}}const ae=Object(a["computed"])(()=>{var e,c,a;const l=[];return null===(e=t.tasks)||void 0===e||e.forEach(e=>{l.push({id:"task-create-"+e.id,text:`${e.creator_name||"未知用户"} 创建了任务 "${e.title}"`,time:e.created_at,ai_analysis:"任务已创建，优先级"+(e.priority||"未定")}),"in-progress"===e.status&&e.updated_at&&l.push({id:"task-update-"+e.id,text:`${e.assignee_name||"负责人"} 正在处理任务 "${e.title}"`,time:e.updated_at,ai_analysis:"任务正在进行中，请关注进度"})}),null===(c=t.documents)||void 0===c||c.forEach(e=>{l.push({id:"doc-"+e.id,text:`${e.uploader_name||"未知用户"} 上传了文档 "${e.name}"`,time:e.uploaded_at,ai_analysis:e.analysis})}),null===(a=t.requirements)||void 0===a||a.forEach(e=>{l.push({id:"req-"+e.id,text:`${e.creator_name||"未知用户"} 创建了需求 "${e.name}"`,time:e.created_at,ai_analysis:"需求优先级为"+(e.priority||"未定")})}),l.sort((e,t)=>new Date(t.time)-new Date(e.time)).slice(0,10)});return Object(a["onMounted"])(()=>{ce()}),Object(a["watch"])(()=>{var e;return null===(e=t.project)||void 0===e?void 0:e.id},e=>{e&&ce()}),Object(a["watch"])([()=>t.tasks,()=>t.documents,()=>t.requirements],()=>{ce()},{deep:!0}),(e,t)=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",n,[Object(a["createElementVNode"])("div",o,[Object(a["createElementVNode"])("div",i,[Object(a["createElementVNode"])("div",d,[t[1]||(t[1]=Object(a["createElementVNode"])("div",{class:"module-header"},[Object(a["createElementVNode"])("h5",{class:"module-title"},"项目健康度")],-1)),Object(a["createElementVNode"])("div",b,[c.value?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",m,t[0]||(t[0]=[Object(a["createElementVNode"])("div",{class:"spinner-border text-primary",role:"status"},[Object(a["createElementVNode"])("span",{class:"visually-hidden"},"加载中...")],-1)]))):(Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],{key:1},[Object(a["createElementVNode"])("div",u,[Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["progress-bar",Z.value]),role:"progressbar",style:Object(a["normalizeStyle"])({width:P.value+"%"})},null,6)]),Object(a["createElementVNode"])("div",j,[Object(a["createElementVNode"])("p",null,Object(a["toDisplayString"])(Q.value),1)])],64))])])]),Object(a["createElementVNode"])("div",v,[Object(a["createElementVNode"])("div",O,[t[3]||(t[3]=Object(a["createElementVNode"])("div",{class:"module-header"},[Object(a["createElementVNode"])("h5",{class:"module-title"},"风险预警")],-1)),Object(a["createElementVNode"])("div",p,[c.value?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",E,t[2]||(t[2]=[Object(a["createElementVNode"])("div",{class:"spinner-border text-primary",role:"status"},[Object(a["createElementVNode"])("span",{class:"visually-hidden"},"加载中...")],-1)]))):(Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],{key:1},[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(R.value,(e,t)=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:t,class:"risk-item"},[Object(a["createElementVNode"])("div",{class:Object(a["normalizeClass"])(["risk-icon",ee(t)])},[Object(a["createElementVNode"])("i",{class:Object(a["normalizeClass"])(["bi",te(t)])},null,2)],2),Object(a["createElementVNode"])("div",y,Object(a["toDisplayString"])(e),1)]))),128)),0===R.value.length?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",h," 暂无风险预警 ")):Object(a["createCommentVNode"])("",!0)],64))])])])]),Object(a["createElementVNode"])("div",k,[Object(a["createElementVNode"])("div",N,[Object(a["createElementVNode"])("div",f,[Object(a["createElementVNode"])("div",V,[t[4]||(t[4]=Object(a["createElementVNode"])("div",{class:"stats-title"},"已完成任务",-1)),Object(a["createElementVNode"])("div",g,Object(a["toDisplayString"])(U.value),1)])])]),Object(a["createElementVNode"])("div",B,[Object(a["createElementVNode"])("div",w,[Object(a["createElementVNode"])("div",_,[t[5]||(t[5]=Object(a["createElementVNode"])("div",{class:"stats-title"},"待处理任务",-1)),Object(a["createElementVNode"])("div",x,Object(a["toDisplayString"])(W.value),1)])])]),Object(a["createElementVNode"])("div",D,[Object(a["createElementVNode"])("div",M,[Object(a["createElementVNode"])("div",S,[t[6]||(t[6]=Object(a["createElementVNode"])("div",{class:"stats-title"},"文档数量",-1)),Object(a["createElementVNode"])("div",$,Object(a["toDisplayString"])(X.value),1)])])]),Object(a["createElementVNode"])("div",C,[Object(a["createElementVNode"])("div",T,[Object(a["createElementVNode"])("div",q,[t[7]||(t[7]=Object(a["createElementVNode"])("div",{class:"stats-title"},"需求数量",-1)),Object(a["createElementVNode"])("div",A,Object(a["toDisplayString"])(Y.value),1)])])])]),Object(a["createElementVNode"])("div",F,[t[9]||(t[9]=Object(a["createElementVNode"])("div",{class:"module-header"},[Object(a["createElementVNode"])("h5",{class:"module-title"},"最近活动")],-1)),Object(a["createElementVNode"])("div",z,[c.value?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",L,t[8]||(t[8]=[Object(a["createElementVNode"])("div",{class:"spinner-border text-primary",role:"status"},[Object(a["createElementVNode"])("span",{class:"visually-hidden"},"加载中...")],-1)]))):(Object(a["openBlock"])(),Object(a["createElementBlock"])(a["Fragment"],{key:1},[(Object(a["openBlock"])(!0),Object(a["createElementBlock"])(a["Fragment"],null,Object(a["renderList"])(ae.value,e=>(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:e.id,class:"activity-item"},[Object(a["createElementVNode"])("div",H,[Object(a["createElementVNode"])("p",I,Object(a["toDisplayString"])(e.text),1),e.ai_analysis?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",{key:0,class:"activity-desc",innerHTML:Object(a["unref"])(s["marked"])(e.ai_analysis)},null,8,J)):Object(a["createCommentVNode"])("",!0)]),Object(a["createElementVNode"])("div",G,Object(a["toDisplayString"])(Object(a["unref"])(l["a"])(e.time)),1)]))),128)),0===ae.value.length?(Object(a["openBlock"])(),Object(a["createElementBlock"])("div",K," 暂无最近活动 ")):Object(a["createCommentVNode"])("",!0)],64))])])]))}},Q=(c("82e0"),c("c26d"),c("6b0d")),R=c.n(Q);const U=R()(P,[["__scopeId","data-v-2e0dd7ae"]]);t["default"]=U},c26d:function(e,t,c){"use strict";c("6c4a")},c466:function(e,t,c){"use strict";function a(e){if(!e)return"";if(!(e instanceof Date)&&(e=new Date(e),isNaN(e.getTime())))return"无效日期";const t=new Date,c=t.getTime()-e.getTime(),a=Math.floor(c/1e3),l=Math.floor(a/60),s=Math.floor(l/60),r=Math.floor(s/24),n=Math.floor(r/30),o=Math.floor(n/12);return a<60?"刚刚":l<60?l+"分钟前":s<24?s+"小时前":r<30?r+"天前":n<12?n+"个月前":o+"年前"}c.d(t,"a",(function(){return a}))}}]);
//# sourceMappingURL=chunk-8e2c8c7a.06767273.js.map