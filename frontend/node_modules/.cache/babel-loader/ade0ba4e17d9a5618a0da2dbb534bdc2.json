{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\o\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\o\\smart-office\\frontend\\node_modules\\quill\\blots\\cursor.js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\o\\smart-office\\frontend\\node_modules\\quill\\blots\\cursor.js","mtime":1751792162019},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\o\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\o\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\o\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJDOi9Vc2Vycy8xODA4My9EZXNrdG9wL0NDSVQvb2ZmaWNlL28vc21hcnQtb2ZmaWNlL2Zyb250ZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9kZWZpbmVQcm9wZXJ0eS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3Iuc29tZS5qcyI7CmltcG9ydCB7IEVtYmVkQmxvdCwgU2NvcGUgfSBmcm9tICdwYXJjaG1lbnQnOwppbXBvcnQgVGV4dEJsb3QgZnJvbSAnLi90ZXh0LmpzJzsKY2xhc3MgQ3Vyc29yIGV4dGVuZHMgRW1iZWRCbG90IHsKICAvLyBaZXJvIHdpZHRoIG5vIGJyZWFrIHNwYWNlCgogIHN0YXRpYyB2YWx1ZSgpIHsKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIGNvbnN0cnVjdG9yKHNjcm9sbCwgZG9tTm9kZSwgc2VsZWN0aW9uKSB7CiAgICBzdXBlcihzY3JvbGwsIGRvbU5vZGUpOwogICAgdGhpcy5zZWxlY3Rpb24gPSBzZWxlY3Rpb247CiAgICB0aGlzLnRleHROb2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoQ3Vyc29yLkNPTlRFTlRTKTsKICAgIHRoaXMuZG9tTm9kZS5hcHBlbmRDaGlsZCh0aGlzLnRleHROb2RlKTsKICAgIHRoaXMuc2F2ZWRMZW5ndGggPSAwOwogIH0KICBkZXRhY2goKSB7CiAgICAvLyBzdXBlci5kZXRhY2goKSB3aWxsIGFsc28gY2xlYXIgZG9tTm9kZS5fX2Jsb3QKICAgIGlmICh0aGlzLnBhcmVudCAhPSBudWxsKSB0aGlzLnBhcmVudC5yZW1vdmVDaGlsZCh0aGlzKTsKICB9CiAgZm9ybWF0KG5hbWUsIHZhbHVlKSB7CiAgICBpZiAodGhpcy5zYXZlZExlbmd0aCAhPT0gMCkgewogICAgICBzdXBlci5mb3JtYXQobmFtZSwgdmFsdWUpOwogICAgICByZXR1cm47CiAgICB9CiAgICAvLyBUT0RPOiBGaXggdGhpcyBuZXh0IHRpbWUgdGhlIGZpbGUgaXMgZWRpdGVkLgogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby10aGlzLWFsaWFzCiAgICBsZXQgdGFyZ2V0ID0gdGhpczsKICAgIGxldCBpbmRleCA9IDA7CiAgICB3aGlsZSAodGFyZ2V0ICE9IG51bGwgJiYgdGFyZ2V0LnN0YXRpY3Muc2NvcGUgIT09IFNjb3BlLkJMT0NLX0JMT1QpIHsKICAgICAgaW5kZXggKz0gdGFyZ2V0Lm9mZnNldCh0YXJnZXQucGFyZW50KTsKICAgICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudDsKICAgIH0KICAgIGlmICh0YXJnZXQgIT0gbnVsbCkgewogICAgICB0aGlzLnNhdmVkTGVuZ3RoID0gQ3Vyc29yLkNPTlRFTlRTLmxlbmd0aDsKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBhbGxvdyBlbXB0eSBjb250ZXh0IGluIFBhcmNobWVudAogICAgICB0YXJnZXQub3B0aW1pemUoKTsKICAgICAgdGFyZ2V0LmZvcm1hdEF0KGluZGV4LCBDdXJzb3IuQ09OVEVOVFMubGVuZ3RoLCBuYW1lLCB2YWx1ZSk7CiAgICAgIHRoaXMuc2F2ZWRMZW5ndGggPSAwOwogICAgfQogIH0KICBpbmRleChub2RlLCBvZmZzZXQpIHsKICAgIGlmIChub2RlID09PSB0aGlzLnRleHROb2RlKSByZXR1cm4gMDsKICAgIHJldHVybiBzdXBlci5pbmRleChub2RlLCBvZmZzZXQpOwogIH0KICBsZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5zYXZlZExlbmd0aDsKICB9CiAgcG9zaXRpb24oKSB7CiAgICByZXR1cm4gW3RoaXMudGV4dE5vZGUsIHRoaXMudGV4dE5vZGUuZGF0YS5sZW5ndGhdOwogIH0KICByZW1vdmUoKSB7CiAgICBzdXBlci5yZW1vdmUoKTsKICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgRml4IG1lIGxhdGVyCiAgICB0aGlzLnBhcmVudCA9IG51bGw7CiAgfQogIHJlc3RvcmUoKSB7CiAgICBpZiAodGhpcy5zZWxlY3Rpb24uY29tcG9zaW5nIHx8IHRoaXMucGFyZW50ID09IG51bGwpIHJldHVybiBudWxsOwogICAgY29uc3QgcmFuZ2UgPSB0aGlzLnNlbGVjdGlvbi5nZXROYXRpdmVSYW5nZSgpOwogICAgLy8gQnJvd3NlciBtYXkgcHVzaCBkb3duIHN0eWxlcy9ub2RlcyBpbnNpZGUgdGhlIGN1cnNvciBibG90LgogICAgLy8gaHR0cHM6Ly9kdmNzLnczLm9yZy9oZy9lZGl0aW5nL3Jhdy1maWxlL3RpcC9lZGl0aW5nLmh0bWwjcHVzaC1kb3duLXZhbHVlcwogICAgd2hpbGUgKHRoaXMuZG9tTm9kZS5sYXN0Q2hpbGQgIT0gbnVsbCAmJiB0aGlzLmRvbU5vZGUubGFzdENoaWxkICE9PSB0aGlzLnRleHROb2RlKSB7CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgRml4IG1lIGxhdGVyCiAgICAgIHRoaXMuZG9tTm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLmRvbU5vZGUubGFzdENoaWxkLCB0aGlzLmRvbU5vZGUpOwogICAgfQogICAgY29uc3QgcHJldlRleHRCbG90ID0gdGhpcy5wcmV2IGluc3RhbmNlb2YgVGV4dEJsb3QgPyB0aGlzLnByZXYgOiBudWxsOwogICAgY29uc3QgcHJldlRleHRMZW5ndGggPSBwcmV2VGV4dEJsb3QgPyBwcmV2VGV4dEJsb3QubGVuZ3RoKCkgOiAwOwogICAgY29uc3QgbmV4dFRleHRCbG90ID0gdGhpcy5uZXh0IGluc3RhbmNlb2YgVGV4dEJsb3QgPyB0aGlzLm5leHQgOiBudWxsOwogICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBtYWtlIFRleHRCbG90LnRleHQgcHVibGljCiAgICBjb25zdCBuZXh0VGV4dCA9IG5leHRUZXh0QmxvdCA/IG5leHRUZXh0QmxvdC50ZXh0IDogJyc7CiAgICBjb25zdCB7CiAgICAgIHRleHROb2RlCiAgICB9ID0gdGhpczsKICAgIC8vIHRha2UgdGV4dCBmcm9tIGluc2lkZSB0aGlzIGJsb3QgYW5kIHJlc2V0IGl0CiAgICBjb25zdCBuZXdUZXh0ID0gdGV4dE5vZGUuZGF0YS5zcGxpdChDdXJzb3IuQ09OVEVOVFMpLmpvaW4oJycpOwogICAgdGV4dE5vZGUuZGF0YSA9IEN1cnNvci5DT05URU5UUzsKCiAgICAvLyBwcm9hY3RpdmVseSBtZXJnZSBUZXh0QmxvdHMgYXJvdW5kIGN1cnNvciBzbyB0aGF0IG9wdGltaXphdGlvbgogICAgLy8gZG9lc24ndCBsb3NlIHRoZSBjdXJzb3IuICB0aGUgcmVhc29uIHdlIGFyZSBoZXJlIGluIGN1cnNvci5yZXN0b3JlCiAgICAvLyBjb3VsZCBiZSB0aGF0IHRoZSB1c2VyIGNsaWNrZWQgaW4gcHJldlRleHRCbG90IG9yIG5leHRUZXh0QmxvdCwgb3IKICAgIC8vIHRoZSB1c2VyIHR5cGVkIHNvbWV0aGluZy4KICAgIGxldCBtZXJnZWRUZXh0QmxvdDsKICAgIGlmIChwcmV2VGV4dEJsb3QpIHsKICAgICAgbWVyZ2VkVGV4dEJsb3QgPSBwcmV2VGV4dEJsb3Q7CiAgICAgIGlmIChuZXdUZXh0IHx8IG5leHRUZXh0QmxvdCkgewogICAgICAgIHByZXZUZXh0QmxvdC5pbnNlcnRBdChwcmV2VGV4dEJsb3QubGVuZ3RoKCksIG5ld1RleHQgKyBuZXh0VGV4dCk7CiAgICAgICAgaWYgKG5leHRUZXh0QmxvdCkgewogICAgICAgICAgbmV4dFRleHRCbG90LnJlbW92ZSgpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmIChuZXh0VGV4dEJsb3QpIHsKICAgICAgbWVyZ2VkVGV4dEJsb3QgPSBuZXh0VGV4dEJsb3Q7CiAgICAgIG5leHRUZXh0QmxvdC5pbnNlcnRBdCgwLCBuZXdUZXh0KTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IG5ld1RleHROb2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobmV3VGV4dCk7CiAgICAgIG1lcmdlZFRleHRCbG90ID0gdGhpcy5zY3JvbGwuY3JlYXRlKG5ld1RleHROb2RlKTsKICAgICAgdGhpcy5wYXJlbnQuaW5zZXJ0QmVmb3JlKG1lcmdlZFRleHRCbG90LCB0aGlzKTsKICAgIH0KICAgIHRoaXMucmVtb3ZlKCk7CiAgICBpZiAocmFuZ2UpIHsKICAgICAgLy8gY2FsY3VsYXRlIHNlbGVjdGlvbiB0byByZXN0b3JlCiAgICAgIGNvbnN0IHJlbWFwT2Zmc2V0ID0gKG5vZGUsIG9mZnNldCkgPT4gewogICAgICAgIGlmIChwcmV2VGV4dEJsb3QgJiYgbm9kZSA9PT0gcHJldlRleHRCbG90LmRvbU5vZGUpIHsKICAgICAgICAgIHJldHVybiBvZmZzZXQ7CiAgICAgICAgfQogICAgICAgIGlmIChub2RlID09PSB0ZXh0Tm9kZSkgewogICAgICAgICAgcmV0dXJuIHByZXZUZXh0TGVuZ3RoICsgb2Zmc2V0IC0gMTsKICAgICAgICB9CiAgICAgICAgaWYgKG5leHRUZXh0QmxvdCAmJiBub2RlID09PSBuZXh0VGV4dEJsb3QuZG9tTm9kZSkgewogICAgICAgICAgcmV0dXJuIHByZXZUZXh0TGVuZ3RoICsgbmV3VGV4dC5sZW5ndGggKyBvZmZzZXQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgICB9OwogICAgICBjb25zdCBzdGFydCA9IHJlbWFwT2Zmc2V0KHJhbmdlLnN0YXJ0Lm5vZGUsIHJhbmdlLnN0YXJ0Lm9mZnNldCk7CiAgICAgIGNvbnN0IGVuZCA9IHJlbWFwT2Zmc2V0KHJhbmdlLmVuZC5ub2RlLCByYW5nZS5lbmQub2Zmc2V0KTsKICAgICAgaWYgKHN0YXJ0ICE9PSBudWxsICYmIGVuZCAhPT0gbnVsbCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBzdGFydE5vZGU6IG1lcmdlZFRleHRCbG90LmRvbU5vZGUsCiAgICAgICAgICBzdGFydE9mZnNldDogc3RhcnQsCiAgICAgICAgICBlbmROb2RlOiBtZXJnZWRUZXh0QmxvdC5kb21Ob2RlLAogICAgICAgICAgZW5kT2Zmc2V0OiBlbmQKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgdXBkYXRlKG11dGF0aW9ucywgY29udGV4dCkgewogICAgaWYgKG11dGF0aW9ucy5zb21lKG11dGF0aW9uID0+IHsKICAgICAgcmV0dXJuIG11dGF0aW9uLnR5cGUgPT09ICdjaGFyYWN0ZXJEYXRhJyAmJiBtdXRhdGlvbi50YXJnZXQgPT09IHRoaXMudGV4dE5vZGU7CiAgICB9KSkgewogICAgICBjb25zdCByYW5nZSA9IHRoaXMucmVzdG9yZSgpOwogICAgICBpZiAocmFuZ2UpIGNvbnRleHQucmFuZ2UgPSByYW5nZTsKICAgIH0KICB9CgogIC8vIEF2b2lkIC5xbC1jdXJzb3IgYmVpbmcgYSBkZXNjZW5kYW50IG9mIGA8YS8+YC4KICAvLyBUaGUgcmVhc29uIGlzIFNhZmFyaSBwdXNoZXMgZG93biBgPGEvPmAgb24gdGV4dCBpbnNlcnRpb24uCiAgLy8gVGhhdCB3aWxsIGNhdXNlIERPTSBub2RlcyBub3Qgc3luYyB3aXRoIHRoZSBtb2RlbC4KICAvLwogIC8vIEZvciBleGFtcGxlICh7SX0gaXMgdGhlIGNhcmV0KSwgZ2l2ZW4gdGhlIG1hcmt1cDoKICAvLyAgICA8YT48c3BhbiBjbGFzcz0icWwtY3Vyc29yIj5cdUZFRkZ7SX08L3NwYW4+PC9hPgogIC8vIFdoZW4gdHlwaW5nIGEgY2hhciAieCIsIGA8YS8+YCB3aWxsIGJlIHB1c2hlZCBkb3duIGluc2lkZSB0aGUgYDxzcGFuPmAgZmlyc3Q6CiAgLy8gICAgPHNwYW4gY2xhc3M9InFsLWN1cnNvciI+PGE+XHVGRUZGe0l9PC9hPjwvc3Bhbj4KICAvLyBBbmQgdGhlbiAieCIgd2lsbCBiZSBpbnNlcnRlZCBhZnRlciBgPGEvPmA6CiAgLy8gICAgPHNwYW4gY2xhc3M9InFsLWN1cnNvciI+PGE+XHVGRUZGPC9hPmR7SX08L3NwYW4+CiAgb3B0aW1pemUoY29udGV4dCkgewogICAgLy8gQHRzLWV4cGVjdC1lcnJvciBGaXggbWUgbGF0ZXIKICAgIHN1cGVyLm9wdGltaXplKGNvbnRleHQpOwogICAgbGV0IHsKICAgICAgcGFyZW50CiAgICB9ID0gdGhpczsKICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgaWYgKHBhcmVudC5kb21Ob2RlLnRhZ05hbWUgPT09ICdBJykgewogICAgICAgIHRoaXMuc2F2ZWRMZW5ndGggPSBDdXJzb3IuQ09OVEVOVFMubGVuZ3RoOwogICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogbWFrZSBpc29sYXRlIGdlbmVyaWMKICAgICAgICBwYXJlbnQuaXNvbGF0ZSh0aGlzLm9mZnNldChwYXJlbnQpLCB0aGlzLmxlbmd0aCgpKS51bndyYXAoKTsKICAgICAgICB0aGlzLnNhdmVkTGVuZ3RoID0gMDsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBwYXJlbnQgPSBwYXJlbnQucGFyZW50OwogICAgfQogIH0KICB2YWx1ZSgpIHsKICAgIHJldHVybiAnJzsKICB9Cn0KX2RlZmluZVByb3BlcnR5KEN1cnNvciwgImJsb3ROYW1lIiwgJ2N1cnNvcicpOwpfZGVmaW5lUHJvcGVydHkoQ3Vyc29yLCAiY2xhc3NOYW1lIiwgJ3FsLWN1cnNvcicpOwpfZGVmaW5lUHJvcGVydHkoQ3Vyc29yLCAidGFnTmFtZSIsICdzcGFuJyk7Cl9kZWZpbmVQcm9wZXJ0eShDdXJzb3IsICJDT05URU5UUyIsICdcdUZFRkYnKTsKZXhwb3J0IGRlZmF1bHQgQ3Vyc29yOw=="},{"version":3,"names":["EmbedBlot","Scope","TextBlot","Cursor","value","undefined","constructor","scroll","domNode","selection","textNode","document","createTextNode","CONTENTS","appendChild","savedLength","detach","parent","removeChild","format","name","target","index","statics","scope","BLOCK_BLOT","offset","length","optimize","formatAt","node","position","data","remove","restore","composing","range","getNativeRange","lastChild","parentNode","insertBefore","prevTextBlot","prev","prevTextLength","nextTextBlot","next","nextText","text","newText","split","join","mergedTextBlot","insertAt","newTextNode","create","remapOffset","start","end","startNode","startOffset","endNode","endOffset","update","mutations","context","some","mutation","type","tagName","isolate","unwrap","_defineProperty"],"sources":["../../src/blots/cursor.ts"],"sourcesContent":["import { EmbedBlot, Scope } from 'parchment';\nimport type { Parent, ScrollBlot } from 'parchment';\nimport type Selection from '../core/selection.js';\nimport TextBlot from './text.js';\nimport type { EmbedContextRange } from './embed.js';\n\nclass Cursor extends EmbedBlot {\n  static blotName = 'cursor';\n  static className = 'ql-cursor';\n  static tagName = 'span';\n  static CONTENTS = '\\uFEFF'; // Zero width no break space\n\n  static value() {\n    return undefined;\n  }\n\n  selection: Selection;\n  textNode: Text;\n  savedLength: number;\n\n  constructor(scroll: ScrollBlot, domNode: HTMLElement, selection: Selection) {\n    super(scroll, domNode);\n    this.selection = selection;\n    this.textNode = document.createTextNode(Cursor.CONTENTS);\n    this.domNode.appendChild(this.textNode);\n    this.savedLength = 0;\n  }\n\n  detach() {\n    // super.detach() will also clear domNode.__blot\n    if (this.parent != null) this.parent.removeChild(this);\n  }\n\n  format(name: string, value: unknown) {\n    if (this.savedLength !== 0) {\n      super.format(name, value);\n      return;\n    }\n    // TODO: Fix this next time the file is edited.\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    let target: Parent | this = this;\n    let index = 0;\n    while (target != null && target.statics.scope !== Scope.BLOCK_BLOT) {\n      index += target.offset(target.parent);\n      target = target.parent;\n    }\n    if (target != null) {\n      this.savedLength = Cursor.CONTENTS.length;\n      // @ts-expect-error TODO: allow empty context in Parchment\n      target.optimize();\n      target.formatAt(index, Cursor.CONTENTS.length, name, value);\n      this.savedLength = 0;\n    }\n  }\n\n  index(node: Node, offset: number) {\n    if (node === this.textNode) return 0;\n    return super.index(node, offset);\n  }\n\n  length() {\n    return this.savedLength;\n  }\n\n  position(): [Text, number] {\n    return [this.textNode, this.textNode.data.length];\n  }\n\n  remove() {\n    super.remove();\n    // @ts-expect-error Fix me later\n    this.parent = null;\n  }\n\n  restore(): EmbedContextRange | null {\n    if (this.selection.composing || this.parent == null) return null;\n    const range = this.selection.getNativeRange();\n    // Browser may push down styles/nodes inside the cursor blot.\n    // https://dvcs.w3.org/hg/editing/raw-file/tip/editing.html#push-down-values\n    while (\n      this.domNode.lastChild != null &&\n      this.domNode.lastChild !== this.textNode\n    ) {\n      // @ts-expect-error Fix me later\n      this.domNode.parentNode.insertBefore(\n        this.domNode.lastChild,\n        this.domNode,\n      );\n    }\n\n    const prevTextBlot = this.prev instanceof TextBlot ? this.prev : null;\n    const prevTextLength = prevTextBlot ? prevTextBlot.length() : 0;\n    const nextTextBlot = this.next instanceof TextBlot ? this.next : null;\n    // @ts-expect-error TODO: make TextBlot.text public\n    const nextText = nextTextBlot ? nextTextBlot.text : '';\n    const { textNode } = this;\n    // take text from inside this blot and reset it\n    const newText = textNode.data.split(Cursor.CONTENTS).join('');\n    textNode.data = Cursor.CONTENTS;\n\n    // proactively merge TextBlots around cursor so that optimization\n    // doesn't lose the cursor.  the reason we are here in cursor.restore\n    // could be that the user clicked in prevTextBlot or nextTextBlot, or\n    // the user typed something.\n    let mergedTextBlot;\n    if (prevTextBlot) {\n      mergedTextBlot = prevTextBlot;\n      if (newText || nextTextBlot) {\n        prevTextBlot.insertAt(prevTextBlot.length(), newText + nextText);\n        if (nextTextBlot) {\n          nextTextBlot.remove();\n        }\n      }\n    } else if (nextTextBlot) {\n      mergedTextBlot = nextTextBlot;\n      nextTextBlot.insertAt(0, newText);\n    } else {\n      const newTextNode = document.createTextNode(newText);\n      mergedTextBlot = this.scroll.create(newTextNode);\n      this.parent.insertBefore(mergedTextBlot, this);\n    }\n\n    this.remove();\n    if (range) {\n      // calculate selection to restore\n      const remapOffset = (node: Node, offset: number) => {\n        if (prevTextBlot && node === prevTextBlot.domNode) {\n          return offset;\n        }\n        if (node === textNode) {\n          return prevTextLength + offset - 1;\n        }\n        if (nextTextBlot && node === nextTextBlot.domNode) {\n          return prevTextLength + newText.length + offset;\n        }\n        return null;\n      };\n\n      const start = remapOffset(range.start.node, range.start.offset);\n      const end = remapOffset(range.end.node, range.end.offset);\n      if (start !== null && end !== null) {\n        return {\n          startNode: mergedTextBlot.domNode,\n          startOffset: start,\n          endNode: mergedTextBlot.domNode,\n          endOffset: end,\n        };\n      }\n    }\n    return null;\n  }\n\n  update(mutations: MutationRecord[], context: Record<string, unknown>) {\n    if (\n      mutations.some((mutation) => {\n        return (\n          mutation.type === 'characterData' && mutation.target === this.textNode\n        );\n      })\n    ) {\n      const range = this.restore();\n      if (range) context.range = range;\n    }\n  }\n\n  // Avoid .ql-cursor being a descendant of `<a/>`.\n  // The reason is Safari pushes down `<a/>` on text insertion.\n  // That will cause DOM nodes not sync with the model.\n  //\n  // For example ({I} is the caret), given the markup:\n  //    <a><span class=\"ql-cursor\">\\uFEFF{I}</span></a>\n  // When typing a char \"x\", `<a/>` will be pushed down inside the `<span>` first:\n  //    <span class=\"ql-cursor\"><a>\\uFEFF{I}</a></span>\n  // And then \"x\" will be inserted after `<a/>`:\n  //    <span class=\"ql-cursor\"><a>\\uFEFF</a>d{I}</span>\n  optimize(context?: unknown) {\n    // @ts-expect-error Fix me later\n    super.optimize(context);\n\n    let { parent } = this;\n    while (parent) {\n      if (parent.domNode.tagName === 'A') {\n        this.savedLength = Cursor.CONTENTS.length;\n        // @ts-expect-error TODO: make isolate generic\n        parent.isolate(this.offset(parent), this.length()).unwrap();\n        this.savedLength = 0;\n        break;\n      }\n      parent = parent.parent;\n    }\n  }\n\n  value() {\n    return '';\n  }\n}\n\nexport default Cursor;\n"],"mappings":"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","ignoreList":[]}]}