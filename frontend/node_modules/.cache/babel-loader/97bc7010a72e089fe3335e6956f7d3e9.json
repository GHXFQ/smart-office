{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\chat\\Index.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\chat\\Index.vue","mtime":1751539667123},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746431218000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5zb21lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybC1zZWFyY2gtcGFyYW1zLmRlbGV0ZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwtc2VhcmNoLXBhcmFtcy5oYXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLXNlYXJjaC1wYXJhbXMuc2l6ZS5qcyI7CmltcG9ydCB7IHJlZiwgY29tcHV0ZWQsIG5leHRUaWNrLCBvbk1vdW50ZWQsIG9uQmVmb3JlVW5tb3VudCwgd2F0Y2ggfSBmcm9tICd2dWUnOwppbXBvcnQgeyB1c2VTdG9yZSB9IGZyb20gJ3Z1ZXgnOwppbXBvcnQgeyBFbE1lc3NhZ2UsIEVsTWVzc2FnZUJveCB9IGZyb20gJ2VsZW1lbnQtcGx1cyc7CmltcG9ydCB7IFNlYXJjaCwgUGhvbmUsIFZpZGVvQ2FtZXJhLCBJbmZvRmlsbGVkLCBEb2N1bWVudCwgUGljdHVyZUZpbGxlZCwgRm9sZGVyT3BlbmVkLCBNaWNyb3Bob25lLCBQb3NpdGlvbiwgQ2hhdERvdFNxdWFyZSwgUmVhZGluZywgVXNlckZpbGxlZCwgQ2hhdExpbmVTcXVhcmUsIFJlZnJlc2gsIE1vcmVGaWxsZWQgfSBmcm9tICdAZWxlbWVudC1wbHVzL2ljb25zLXZ1ZSc7CmltcG9ydCB7IGdldENoYXRTZXNzaW9ucywgZ2V0Q2hhdFNlc3Npb24sIHNlbmRUZXh0TWVzc2FnZSwgc2VuZEltYWdlTWVzc2FnZSwgc2VuZEtub3dsZWRnZU1lc3NhZ2UsIGRvd25sb2FkTWVzc2FnZUZpbGUsIHNlbmRGaWxlTWVzc2FnZSwgc3VtbWFyaXplQ2hhdCB9IGZyb20gJ0AvYXBpL2NoYXQnOwppbXBvcnQgeyBnZXRLbm93bGVkZ2VMaXN0IH0gZnJvbSAnQC9hcGkva25vd2xlZGdlJzsKaW1wb3J0IHsgdXNlUm91dGUgfSBmcm9tICd2dWUtcm91dGVyJzsKaW1wb3J0IHJlcXVlc3QgZnJvbSAnQC91dGlscy9yZXF1ZXN0JzsKaW1wb3J0IENoYXRDYWxlbmRhckV2ZW50IGZyb20gJ0AvY29tcG9uZW50cy9DaGF0Q2FsZW5kYXJFdmVudC52dWUnOwppbXBvcnQgeyBhaUNoYXRXaXRoRG9jdW1lbnRzIH0gZnJvbSAnQC9hcGkvYWknOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0NoYXQnLAogIGNvbXBvbmVudHM6IHsKICAgIENoYXRDYWxlbmRhckV2ZW50CiAgfSwKICBzZXR1cCgpIHsKICAgIGNvbnN0IHN0b3JlID0gdXNlU3RvcmUoKTsKICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gY29tcHV0ZWQoKCkgPT4gc3RvcmUuZ2V0dGVycy51c2VyKTsKCiAgICAvLyDmt7vliqDmnKzlnLDnlKjmiLfmlbDmja7lrZjlgqgKICAgIGNvbnN0IHVzZXJJbmZvID0gcmVmKG51bGwpOwogICAgY29uc3Qgc2VhcmNoUXVlcnkgPSByZWYoJycpOwogICAgY29uc3QgYWN0aXZlVGFiID0gcmVmKDApOwogICAgY29uc3Qgc2VsZWN0ZWRDb250YWN0ID0gcmVmKG51bGwpOwogICAgY29uc3QgbWVzc2FnZUlucHV0ID0gcmVmKCcnKTsKICAgIGNvbnN0IG1lc3NhZ2VDb250YWluZXIgPSByZWYobnVsbCk7CiAgICBjb25zdCBmaWxlSW5wdXQgPSByZWYobnVsbCk7CiAgICBjb25zdCBpbWFnZUlucHV0ID0gcmVmKG51bGwpOwogICAgY29uc3QgbWVzc2FnZXMgPSByZWYoW10pOwogICAgY29uc3Qgc2Vzc2lvbnNMb2FkaW5nID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IG1lc3NhZ2VzTG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBjaGF0U2Vzc2lvbnMgPSByZWYoW10pOwogICAgY29uc3QgY3VycmVudENoYXRJZCA9IHJlZihudWxsKTsKCiAgICAvLyDnn6Xor4blupPnm7jlhbMKICAgIGNvbnN0IGtub3dsZWRnZURpYWxvZ1Zpc2libGUgPSByZWYoZmFsc2UpOwogICAgY29uc3Qga25vd2xlZGdlTG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBrbm93bGVkZ2VMaXN0ID0gcmVmKFtdKTsKICAgIGNvbnN0IHNlbGVjdGVkS25vd2xlZGdlID0gcmVmKG51bGwpOwoKICAgIC8vIOagh+etvumhtQogICAgY29uc3QgdGFicyA9IHJlZihbJ+acgOi/keiBiuWkqScsICflkIzkuosnXSk7CgogICAgLy8g6IGU57O75Lq65YiX6KGoCiAgICBjb25zdCBjb250YWN0cyA9IHJlZihbXSk7CiAgICAvLyDmiYDmnInlkIzkuovnlKjmiLfliJfooagKICAgIGNvbnN0IGFsbENvbGxlYWd1ZXMgPSByZWYoW10pOwoKICAgIC8vIOmDqOmXqOWIl+ihqAogICAgY29uc3QgZGVwYXJ0bWVudHMgPSByZWYoW10pOwoKICAgIC8vIOW9k+WJjemAieS4reeahOiBlOezu+S6ugogICAgY29uc3QgY3VycmVudENvbnRhY3QgPSBjb21wdXRlZCgoKSA9PiB7CiAgICAgIGlmIChzZWxlY3RlZENvbnRhY3QudmFsdWUgPT09IG51bGwpIHJldHVybiB7fTsKICAgICAgcmV0dXJuIGNvbnRhY3RzLnZhbHVlLmZpbmQoYyA9PiBjLmlkID09PSBzZWxlY3RlZENvbnRhY3QudmFsdWUpIHx8IHt9OwogICAgfSk7CgogICAgLy8g5a6J5YWo5Zyw6I635Y+W55So5oi3SUTvvIzpgb/lhY3mqKHmnb/kuK3nmoRudWxs6ZSZ6K+vCiAgICBjb25zdCB1c2VySWQgPSBjb21wdXRlZCgoKSA9PiB7CiAgICAgIHZhciBfdXNlckluZm8kdmFsdWU7CiAgICAgIHJldHVybiAoKF91c2VySW5mbyR2YWx1ZSA9IHVzZXJJbmZvLnZhbHVlKSA9PT0gbnVsbCB8fCBfdXNlckluZm8kdmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF91c2VySW5mbyR2YWx1ZS5pZCkgfHwgbnVsbDsKICAgIH0pOwoKICAgIC8vIOagueaNruaQnOe0oui/h+a7pOiBlOezu+S6ugogICAgY29uc3QgZmlsdGVyZWRDb250YWN0cyA9IGNvbXB1dGVkKCgpID0+IHsKICAgICAgaWYgKCFzZWFyY2hRdWVyeS52YWx1ZSkgcmV0dXJuIGNvbnRhY3RzLnZhbHVlOwogICAgICByZXR1cm4gY29udGFjdHMudmFsdWUuZmlsdGVyKGNvbnRhY3QgPT4gY29udGFjdC5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoUXVlcnkudmFsdWUudG9Mb3dlckNhc2UoKSkpOwogICAgfSk7CgogICAgLy8g5qC55o2u5b2T5YmN5r+A5rS755qE5qCH562+6aG16I635Y+W6KaB5pi+56S655qE6IGU57O75Lq6CiAgICBjb25zdCBnZXRBY3RpdmVDb250YWN0cyA9IGNvbXB1dGVkKCgpID0+IHsKICAgICAgaWYgKGFjdGl2ZVRhYi52YWx1ZSA9PT0gMCkgewogICAgICAgIHJldHVybiBmaWx0ZXJlZENvbnRhY3RzLnZhbHVlOwogICAgICB9IGVsc2UgaWYgKGFjdGl2ZVRhYi52YWx1ZSA9PT0gMSkgewogICAgICAgIHJldHVybiBmaWx0ZXJlZENvbnRhY3RzLnZhbHVlLmZpbHRlcihjb250YWN0ID0+ICFjb250YWN0LmlzR3JvdXApOwogICAgICB9CiAgICAgIHJldHVybiBmaWx0ZXJlZENvbnRhY3RzLnZhbHVlOwogICAgfSk7CgogICAgLy8g5oyJ6YOo6Zeo5YiG57uE55qE55So5oi3CiAgICBjb25zdCBncm91cGVkVXNlcnNCeURlcGFydG1lbnQgPSBjb21wdXRlZCgoKSA9PiB7CiAgICAgIC8vIOWQiOW5tuiBiuWkqeiBlOezu+S6uuWSjOaJgOacieWQjOS6iwogICAgICBjb25zdCB1c2Vyc01hcCA9IG5ldyBNYXAoKTsKCiAgICAgIC8vIOWFiOa3u+WKoOiBiuWkqeiBlOezu+S6uu+8iOmdnue+pOe7hO+8iQogICAgICBmaWx0ZXJlZENvbnRhY3RzLnZhbHVlLmZpbHRlcihjb250YWN0ID0+ICFjb250YWN0LmlzR3JvdXApLmZvckVhY2goY29udGFjdCA9PiB7CiAgICAgICAgLy8g6Lez6L+H6Ieq5bexCiAgICAgICAgaWYgKHVzZXJJbmZvLnZhbHVlICYmIGNvbnRhY3QudXNlcklkID09PSB1c2VySW5mby52YWx1ZS5pZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLyDkvb/nlKhJROS9nOS4uuWUr+S4gOmUrgogICAgICAgIHVzZXJzTWFwLnNldChjb250YWN0LnVzZXJJZCB8fCBjb250YWN0LmlkLCBjb250YWN0KTsKICAgICAgfSk7CgogICAgICAvLyDlho3mt7vliqDmiYDmnInlkIzkuovvvIzkvYbpgb/lhY3ph43lpI0KICAgICAgYWxsQ29sbGVhZ3Vlcy52YWx1ZS5mb3JFYWNoKGNvbGxlYWd1ZSA9PiB7CiAgICAgICAgLy8g6Lez6L+H6Ieq5bexCiAgICAgICAgaWYgKHVzZXJJbmZvLnZhbHVlICYmIGNvbGxlYWd1ZS5pZCA9PT0gdXNlckluZm8udmFsdWUuaWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIOWPquacieWcqOS4jeWtmOWcqOaXtuaJjea3u+WKoO+8iOmBv+WFjeimhueblueOsOacieiBlOezu+S6uu+8iQogICAgICAgIGlmICghdXNlcnNNYXAuaGFzKGNvbGxlYWd1ZS5pZCkpIHsKICAgICAgICAgIC8vIOaehOmAoOWFvOWuueagvOW8j+eahOeUqOaIt+WvueixoQogICAgICAgICAgY29uc3QgY29udGFjdCA9IHsKICAgICAgICAgICAgaWQ6ICd1c2VyXycgKyBjb2xsZWFndWUuaWQsCiAgICAgICAgICAgIC8vIOa3u+WKoOWJjee8gOS7pemBv+WFjeS4jueOsOacieS8muivnUlE5Yay56qBCiAgICAgICAgICAgIHVzZXJJZDogY29sbGVhZ3VlLmlkLAogICAgICAgICAgICBuYW1lOiAoY29sbGVhZ3VlLm5hbWUgfHwgY29sbGVhZ3VlLnVzZXJuYW1lIHx8ICfmnKrlkb3lkI3ogZTns7vkuronKS50cmltKCksCiAgICAgICAgICAgIGluaXRpYWw6IChjb2xsZWFndWUubmFtZSB8fCBjb2xsZWFndWUudXNlcm5hbWUgfHwgJ+acquWRveWQjeiBlOezu+S6uicpWzBdLAogICAgICAgICAgICBhdmF0YXI6IGNvbGxlYWd1ZS5hdmF0YXIgfHwgJycsCiAgICAgICAgICAgIGNvbG9yOiBnZXRSYW5kb21Db2xvcihjb2xsZWFndWUuaWQpLAogICAgICAgICAgICBzdGF0dXM6ICdvbmxpbmUnLAogICAgICAgICAgICBsYXN0TWVzc2FnZTogJycsCiAgICAgICAgICAgIGxhc3RUaW1lOiAnJywKICAgICAgICAgICAgdW5yZWFkOiAwLAogICAgICAgICAgICBpc0dyb3VwOiBmYWxzZSwKICAgICAgICAgICAgZGVwYXJ0bWVudDogY29sbGVhZ3VlLmRlcGFydG1lbnQgfHwgJ+WFtuWugycKICAgICAgICAgIH07CiAgICAgICAgICB1c2Vyc01hcC5zZXQoY29sbGVhZ3VlLmlkLCBjb250YWN0KTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgLy8g5Yib5bu65LiA5Liq6YOo6ZeoSUTliLDlkI3np7DnmoTmmKDlsIQKICAgICAgY29uc3QgZGVwYXJ0bWVudE1hcCA9IG5ldyBNYXAoZGVwYXJ0bWVudHMudmFsdWUubWFwKGRlcHQgPT4gW2RlcHQuaWQsIGRlcHQubmFtZV0pKTsKCiAgICAgIC8vIOaMiemDqOmXqOWIhue7hAogICAgICBjb25zdCBncm91cGVkVXNlcnMgPSB7fTsKCiAgICAgIC8vIOWwhk1hcOi9rOS4ukFycmF55ZCO5YiG57uECiAgICAgIEFycmF5LmZyb20odXNlcnNNYXAudmFsdWVzKCkpLmZvckVhY2godXNlciA9PiB7CiAgICAgICAgY29uc3QgZGVwYXJ0bWVudE5hbWUgPSBkZXBhcnRtZW50TWFwLmdldCh1c2VyLmRlcGFydG1lbnQpIHx8ICflhbbku5YnOwogICAgICAgIGlmICghZ3JvdXBlZFVzZXJzW2RlcGFydG1lbnROYW1lXSkgewogICAgICAgICAgZ3JvdXBlZFVzZXJzW2RlcGFydG1lbnROYW1lXSA9IFtdOwogICAgICAgIH0KICAgICAgICBncm91cGVkVXNlcnNbZGVwYXJ0bWVudE5hbWVdLnB1c2godXNlcik7CiAgICAgIH0pOwogICAgICByZXR1cm4gZ3JvdXBlZFVzZXJzOwogICAgfSk7CgogICAgLy8g6Lev55SxCiAgICBjb25zdCByb3V0ZSA9IHVzZVJvdXRlKCk7CgogICAgLy8g5a6a5LmJ5LiA5LiqcmVmcmVzaEludGVydmFs55qE5byV55So77yM5Lul5L6/5Zyo57uE5Lu25Y246L295pe25riF6ZmkCiAgICBsZXQgcmVmcmVzaEludGVydmFsID0gbnVsbDsKCiAgICAvLyDnu4Tku7bljbjovb3ml7bmuIXpmaTlrprml7blmagKICAgIG9uQmVmb3JlVW5tb3VudCgoKSA9PiB7CiAgICAgIGlmIChyZWZyZXNoSW50ZXJ2YWwpIHsKICAgICAgICBjbGVhckludGVydmFsKHJlZnJlc2hJbnRlcnZhbCk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIOi3r+eUseebuOWFs+aTjeS9nAogICAgb25Nb3VudGVkKGFzeW5jICgpID0+IHsKICAgICAgdHJ5IHsKICAgICAgICAvLyDlhYjliqDovb3nlKjmiLfmlbDmja4KICAgICAgICBjb25zdCB1c2VyRGF0YSA9IGF3YWl0IGZldGNoQ3VycmVudFVzZXIoKTsKCiAgICAgICAgLy8g5aaC5p6c6I635Y+W55So5oi35L+h5oGv5aSx6LSl77yM5pi+56S66ZSZ6K+v5bm26L+U5ZueCiAgICAgICAgaWYgKCF1c2VyRGF0YSkgewogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfml6Dms5XliqDovb3nlKjmiLfkv6Hmga/vvIzor7fliLfmlrDpobXpnaLph43or5UnKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coJ+e7hOS7tuaMgui9veaXtuiOt+WPlueahOeUqOaIt+S/oeaBrzonLCB1c2VyRGF0YSk7CgogICAgICAgIC8vIOehruS/neeUqOaIt+aVsOaNruW3sue7j+abtOaWsAogICAgICAgIGlmICghdXNlckluZm8udmFsdWUgfHwgIXVzZXJJbmZvLnZhbHVlLmlkKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfnlKjmiLfmlbDmja7mnKrmraPnoa7liqDovb06JywgdXNlckluZm8udmFsdWUpOwogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfnlKjmiLfmlbDmja7liqDovb3lvILluLjvvIzor7fliLfmlrDpobXpnaLph43or5UnKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5sb2coJ+W9k+WJjeeUqOaIt+aVsOaNruW3suato+ehruWKoOi9vTonLCB1c2VySW5mby52YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICAvLyDliqDovb3miYDmnInnlKjmiLfliJfooagKICAgICAgICBhd2FpdCBsb2FkQWxsVXNlcnMoKTsKCiAgICAgICAgLy8g5Yqg6L296YOo6Zeo5YiX6KGoCiAgICAgICAgYXdhaXQgbG9hZERlcGFydG1lbnRzKCk7CgogICAgICAgIC8vIOWGjeWKoOi9veiBiuWkqeS8muivneWIl+ihqAogICAgICAgIGF3YWl0IGxvYWRDaGF0U2Vzc2lvbnMoKTsKCiAgICAgICAgLy8g5qOA5p+lVVJM5Y+C5pWw5Lit5piv5ZCm5pyJ5Lya6K+dSUQKICAgICAgICBjb25zdCBzZXNzaW9uSWQgPSByb3V0ZS5xdWVyeS5zZXNzaW9uIHx8IHJvdXRlLnF1ZXJ5LmlkOwogICAgICAgIGlmIChzZXNzaW9uSWQpIHsKICAgICAgICAgIC8vIOafpeaJvuWvueW6lOeahOiBlOezu+S6ugogICAgICAgICAgY29uc3QgZm91bmRDb250YWN0ID0gY29udGFjdHMudmFsdWUuZmluZChjID0+IGMuaWQgPT09IHBhcnNlSW50KHNlc3Npb25JZCkpOwogICAgICAgICAgaWYgKGZvdW5kQ29udGFjdCkgewogICAgICAgICAgICAvLyDpgInkuK3or6XogZTns7vkuroKICAgICAgICAgICAgc2VsZWN0ZWRDb250YWN0LnZhbHVlID0gZm91bmRDb250YWN0LmlkOwogICAgICAgICAgICAvLyDliqDovb3ogYrlpKnorrDlvZUKICAgICAgICAgICAgYXdhaXQgbG9hZENoYXRNZXNzYWdlcyhzZXNzaW9uSWQpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8g5aaC5p6c5pyq5om+5Yiw5a+55bqU6IGU57O75Lq677yM5bCd6K+V55u05o6l5Yqg6L295Lya6K+dCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfpgJrov4dJROebtOaOpeWKoOi9veiBiuWkqeS8muivnTonLCBzZXNzaW9uSWQpOwogICAgICAgICAgICBhd2FpdCBsb2FkQ2hhdE1lc3NhZ2VzKHNlc3Npb25JZCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyDorr7nva7lrprml7bliLfmlrAKICAgICAgICByZWZyZXNoSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7CiAgICAgICAgICBpZiAoc2VsZWN0ZWRDb250YWN0LnZhbHVlKSB7CiAgICAgICAgICAgIGF3YWl0IGxvYWRDaGF0TWVzc2FnZXMoc2VsZWN0ZWRDb250YWN0LnZhbHVlLCB0cnVlKTsKICAgICAgICAgIH0KICAgICAgICAgIGF3YWl0IGxvYWRDaGF0U2Vzc2lvbnModHJ1ZSk7CiAgICAgICAgfSwgMzAwMDApOwoKICAgICAgICAvLyDliJ3lp4vmu5rliqjliLDlupXpg6gKICAgICAgICBhd2FpdCBuZXh0VGljaygpOwogICAgICAgIHNjcm9sbFRvQm90dG9tKCk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Yid5aeL5YyW6IGK5aSp57uE5Lu25aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WIneWni+WMluiBiuWkqee7hOS7tuWksei0pTogJyArIGVycm9yLm1lc3NhZ2UpOwogICAgICB9CiAgICB9KTsKCiAgICAvLyDojrflj5blvZPliY3nlKjmiLfkv6Hmga8KICAgIGNvbnN0IGZldGNoQ3VycmVudFVzZXIgPSBhc3luYyAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc29sZS5sb2coJ+W8gOWni+iOt+WPluW9k+WJjeeUqOaIt+S/oeaBry4uLicpOwoKICAgICAgICAvLyDmo4Dmn6Vsb2NhbFN0b3JhZ2XkuK3mmK/lkKbmnIl0b2tlbgogICAgICAgIGNvbnN0IHRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Rva2VuJyk7CiAgICAgICAgaWYgKCF0b2tlbikgewogICAgICAgICAgY29uc29sZS53YXJuKCfmnKzlnLDlrZjlgqjkuK3msqHmnInmib7liLDorqTor4F0b2tlbicpOwogICAgICAgICAgRWxNZXNzYWdlLndhcm5pbmcoJ+acqueZu+W9leaIlueZu+W9leW3sui/h+acn++8jOivt+mHjeaWsOeZu+W9lScpOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdCh7CiAgICAgICAgICB1cmw6ICcvYXBpL2F1dGgvdXNlcnMvbWUvJywKICAgICAgICAgIG1ldGhvZDogJ2dldCcKICAgICAgICB9KTsKICAgICAgICBjb25zb2xlLmxvZygn6I635Y+W55So5oi35L+h5oGv5ZON5bqUOicsIHJlc3BvbnNlKTsKCiAgICAgICAgLy8g5qOA5p+l5ZON5bqU5qC85byP5bm26I635Y+W55So5oi35pWw5o2uCiAgICAgICAgbGV0IHVzZXJEYXRhID0gbnVsbDsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmlkKSB7CiAgICAgICAgICAvLyDnm7TmjqXku45kYXRh5a2X5q616I635Y+W55So5oi35pWw5o2uCiAgICAgICAgICB1c2VyRGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICBjb25zb2xlLmxvZygn5LuOZGF0YeWtl+auteiOt+WPlueUqOaIt+aVsOaNrjonLCB1c2VyRGF0YSk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuZGF0YSAmJiByZXNwb25zZS5kYXRhLmRhdGEuaWQpIHsKICAgICAgICAgIC8vIOS7juW1jOWll2RhdGHlrZfmrrXojrflj5bnlKjmiLfmlbDmja4KICAgICAgICAgIHVzZXJEYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgY29uc29sZS5sb2coJ+S7juW1jOWll2RhdGHlrZfmrrXojrflj5bnlKjmiLfmlbDmja46JywgdXNlckRhdGEpOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuaWQpIHsKICAgICAgICAgIC8vIOebtOaOpeWTjeW6lOWwseaYr+eUqOaIt+aVsOaNrgogICAgICAgICAgdXNlckRhdGEgPSByZXNwb25zZTsKICAgICAgICAgIGNvbnNvbGUubG9nKCfnm7TmjqXojrflj5bnlKjmiLfmlbDmja46JywgdXNlckRhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bnlKjmiLfkv6Hmga/lk43lupTmoLzlvI/lvILluLg6JywgcmVzcG9uc2UpOwogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfnlKjmiLfkv6Hmga/moLzlvI/lvILluLgnKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF1c2VyRGF0YSB8fCAhdXNlckRhdGEuaWQpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPlueahOeUqOaIt+aVsOaNruaXoOaViDonLCB1c2VyRGF0YSk7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+aXoOaViOeahOeUqOaIt+aVsOaNricpOwogICAgICAgIH0KCiAgICAgICAgLy8g5LiN5L2/55So5pyq5a6a5LmJ55qEbXV0YXRpb27vvIzogIzmmK/nm7TmjqXmm7TmlrDmnKzlnLDnirbmgIEKICAgICAgICB1c2VySW5mby52YWx1ZSA9IHVzZXJEYXRhOwoKICAgICAgICAvLyDkv53lrZjliLBsb2NhbFN0b3JhZ2Xku6Xkvr/mjIHkuYXljJYKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndXNlcicsIEpTT04uc3RyaW5naWZ5KHVzZXJEYXRhKSk7CiAgICAgICAgY29uc29sZS5sb2coJ+eUqOaIt+aVsOaNruW3suabtOaWsDonLCB1c2VySW5mby52YWx1ZSk7CiAgICAgICAgcmV0dXJuIHVzZXJEYXRhOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPluW9k+WJjeeUqOaIt+S/oeaBr+Wksei0pTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfojrflj5bnlKjmiLfkv6Hmga/lpLHotKU6ICcgKyAoZXJyb3IubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJykpOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9OwoKICAgIC8vIOWKoOi9veiBiuWkqeS8muivneWIl+ihqAogICAgY29uc3QgbG9hZENoYXRTZXNzaW9ucyA9IGFzeW5jIChpc0JhY2tncm91bmRSZWZyZXNoID0gZmFsc2UpID0+IHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoIWlzQmFja2dyb3VuZFJlZnJlc2gpIHsKICAgICAgICAgIHNlc3Npb25zTG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGNvbnNvbGUubG9nKCfmraPlnKjliqDovb3ogYrlpKnkvJror53liJfooaguLi4nKTsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGdldENoYXRTZXNzaW9ucygpOwogICAgICAgIGNvbnNvbGUubG9nKCfojrflj5bogYrlpKnkvJror53lk43lupQ6JywgcmVzcG9uc2UpOwoKICAgICAgICAvLyDnoa7kv53miJHku6zmnInlk43lupTmlbDmja4KICAgICAgICBpZiAoIXJlc3BvbnNlKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bogYrlpKnkvJror53ov5Tlm57nqbrlk43lupQnKTsKICAgICAgICAgIGNvbnRhY3RzLnZhbHVlID0gW107CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGxldCBkYXRhOwogICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzICYmIHJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgIGRhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgY29uc29sZS5sb2coJ+S9v+eUqOWMheijheagvOW8j+eahOiBiuWkqeaVsOaNrjonLCBkYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YSA9IHJlc3BvbnNlOwogICAgICAgICAgY29uc29sZS5sb2coJ+S9v+eUqOebtOaOpei/lOWbnueahOiBiuWkqeaVsOaNrjonLCBkYXRhKTsKICAgICAgICB9CgogICAgICAgIC8vIOi9rOaNouaVsOaNruagvOW8jwogICAgICAgIGNoYXRTZXNzaW9ucy52YWx1ZSA9IGRhdGE7CgogICAgICAgIC8vIOaehOW7uuiBlOezu+S6uuWIl+ihqAogICAgICAgIGlmIChkYXRhICYmIEFycmF5LmlzQXJyYXkoZGF0YS5yZXN1bHRzKSkgewogICAgICAgICAgY29uc29sZS5sb2coJ+WkhOeQhuWIhumhteaVsOaNrue7k+aehCwg5YWx5pyJ5Lya6K+d5pWwOicsIGRhdGEucmVzdWx0cy5sZW5ndGgpOwogICAgICAgICAgLy8g5aSE55CG5YiG6aG15pWw5o2u57uT5p6ECiAgICAgICAgICBjb250YWN0cy52YWx1ZSA9IGRhdGEucmVzdWx0cy5tYXAoc2Vzc2lvbiA9PiB7CiAgICAgICAgICAgIC8vIOaJvuWIsOWvueaWueeUqOaIt++8iOmdnuW9k+WJjeeUqOaIt++8iQogICAgICAgICAgICBsZXQgb3RoZXJQYXJ0aWNpcGFudCA9IG51bGw7CiAgICAgICAgICAgIGlmIChzZXNzaW9uLnBhcnRpY2lwYW50cyAmJiBBcnJheS5pc0FycmF5KHNlc3Npb24ucGFydGljaXBhbnRzKSkgewogICAgICAgICAgICAgIGlmICh1c2VySW5mby52YWx1ZSAmJiB1c2VySW5mby52YWx1ZS5pZCkgewogICAgICAgICAgICAgICAgb3RoZXJQYXJ0aWNpcGFudCA9IHNlc3Npb24ucGFydGljaXBhbnRzLmZpbmQocCA9PiBwLnVzZXIgJiYgcC51c2VyLmlkICE9PSB1c2VySW5mby52YWx1ZS5pZCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIOWmguaenOayoeacieW9k+WJjeeUqOaIt+S/oeaBr++8jOS9v+eUqOesrOS4gOS4quWPguS4juiAhQogICAgICAgICAgICAgICAgb3RoZXJQYXJ0aWNpcGFudCA9IHNlc3Npb24ucGFydGljaXBhbnRzWzBdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g5aaC5p6c5piv576k6IGK77yM5L2/55So576k6IGK5L+h5oGvCiAgICAgICAgICAgIGlmIChzZXNzaW9uLmlzX2dyb3VwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBzZXNzaW9uLmlkLAogICAgICAgICAgICAgICAgbmFtZTogc2Vzc2lvbi50aXRsZSB8fCAn576k6IGKJywKICAgICAgICAgICAgICAgIGluaXRpYWw6IChzZXNzaW9uLnRpdGxlIHx8ICfnvqTogYonKVswXSwKICAgICAgICAgICAgICAgIGF2YXRhcjogJycsCiAgICAgICAgICAgICAgICBhdmF0YXJfdXJsOiAnJywKICAgICAgICAgICAgICAgIGNvbG9yOiBnZXRSYW5kb21Db2xvcihzZXNzaW9uLmlkKSwKICAgICAgICAgICAgICAgIHN0YXR1czogJ29ubGluZScsCiAgICAgICAgICAgICAgICBsYXN0TWVzc2FnZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBzZXNzaW9uLmxhc3RfbWVzc2FnZS5jb250ZW50IDogJycsCiAgICAgICAgICAgICAgICBsYXN0VGltZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLmxhc3RfbWVzc2FnZS5jcmVhdGVkX2F0KSA6IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24udXBkYXRlZF9hdCksCiAgICAgICAgICAgICAgICB1bnJlYWQ6IHNlc3Npb24udW5yZWFkX2NvdW50LAogICAgICAgICAgICAgICAgaXNHcm91cDogdHJ1ZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOWNleiBiu+8jOS9v+eUqOWvueaWueS/oeaBrwogICAgICAgICAgICBpZiAob3RoZXJQYXJ0aWNpcGFudCkgewogICAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBvdGhlclBhcnRpY2lwYW50LnVzZXI7CiAgICAgICAgICAgICAgLy8g5aSE55CG5aS05YOP6Lev5b6ECiAgICAgICAgICAgICAgbGV0IGF2YXRhcl91cmwgPSAnJzsKICAgICAgICAgICAgICBpZiAodXNlci5hdmF0YXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IHVzZXIuYXZhdGFyOwogICAgICAgICAgICAgICAgaWYgKGF2YXRhci5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgYXZhdGFyLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHsKICAgICAgICAgICAgICAgICAgYXZhdGFyX3VybCA9IGF2YXRhcjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYXZhdGFyLnN0YXJ0c1dpdGgoJy8nKSkgewogICAgICAgICAgICAgICAgICBhdmF0YXJfdXJsID0gYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9CQVNFX0FQSSB8fCAnaHR0cDovL2xvY2FsaG9zdDo4MDAwJ30ke2F2YXRhcn1gOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgYXZhdGFyX3VybCA9IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQkFTRV9BUEkgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6ODAwMCd9LyR7YXZhdGFyfWA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDogc2Vzc2lvbi5pZCwKICAgICAgICAgICAgICAgIHVzZXJJZDogdXNlci5pZCwKICAgICAgICAgICAgICAgIC8vIOa3u+WKoOeUqOaIt0lE77yM55So5LqO5qOA5p+l5piv5ZCm5piv6Ieq5bexCiAgICAgICAgICAgICAgICBuYW1lOiAodXNlci5uYW1lIHx8ICgodXNlci5maXJzdF9uYW1lIHx8ICcnKSArICcgJyArICh1c2VyLmxhc3RfbmFtZSB8fCAnJykpLnRyaW0oKSB8fCB1c2VyLnVzZXJuYW1lIHx8ICfmnKrlkb3lkI3ogZTns7vkuronKS50cmltKCksCiAgICAgICAgICAgICAgICBpbml0aWFsOiAodXNlci5uYW1lIHx8IHVzZXIuZmlyc3RfbmFtZSB8fCB1c2VyLnVzZXJuYW1lIHx8ICfmnKrlkb3lkI3ogZTns7vkuronKVswXSwKICAgICAgICAgICAgICAgIGF2YXRhcjogdXNlci5hdmF0YXIgfHwgJycsCiAgICAgICAgICAgICAgICBhdmF0YXJfdXJsOiBhdmF0YXJfdXJsLAogICAgICAgICAgICAgICAgY29sb3I6IGdldFJhbmRvbUNvbG9yKHVzZXIuaWQpLAogICAgICAgICAgICAgICAgc3RhdHVzOiAnb25saW5lJywKICAgICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IHNlc3Npb24ubGFzdF9tZXNzYWdlLmNvbnRlbnQgOiAnJywKICAgICAgICAgICAgICAgIGxhc3RUaW1lOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24ubGFzdF9tZXNzYWdlLmNyZWF0ZWRfYXQpIDogZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi51cGRhdGVkX2F0KSwKICAgICAgICAgICAgICAgIHVucmVhZDogc2Vzc2lvbi51bnJlYWRfY291bnQsCiAgICAgICAgICAgICAgICBpc0dyb3VwOiBmYWxzZSwKICAgICAgICAgICAgICAgIGRlcGFydG1lbnQ6IHVzZXIuZGVwYXJ0bWVudCB8fCAn5YW25LuWJyAvLyDnoa7kv53mnInpu5jorqTpg6jpl6gKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDlpoLmnpzmsqHmnInlhbbku5blj4LkuI7ogIXvvIjnkIborrrkuIrkuI3lupTor6Xlj5HnlJ/vvIkKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBpZDogc2Vzc2lvbi5pZCwKICAgICAgICAgICAgICBuYW1lOiBzZXNzaW9uLnRpdGxlIHx8ICfogYrlpKknLAogICAgICAgICAgICAgIGluaXRpYWw6IChzZXNzaW9uLnRpdGxlIHx8ICfogYrlpKknKVswXSwKICAgICAgICAgICAgICBhdmF0YXI6ICcnLAogICAgICAgICAgICAgIGF2YXRhcl91cmw6ICcnLAogICAgICAgICAgICAgIGNvbG9yOiBnZXRSYW5kb21Db2xvcihzZXNzaW9uLmlkKSwKICAgICAgICAgICAgICBzdGF0dXM6ICdvbmxpbmUnLAogICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IHNlc3Npb24ubGFzdF9tZXNzYWdlLmNvbnRlbnQgOiAnJywKICAgICAgICAgICAgICBsYXN0VGltZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLmxhc3RfbWVzc2FnZS5jcmVhdGVkX2F0KSA6IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24udXBkYXRlZF9hdCksCiAgICAgICAgICAgICAgdW5yZWFkOiBzZXNzaW9uLnVucmVhZF9jb3VudCwKICAgICAgICAgICAgICBpc0dyb3VwOiBzZXNzaW9uLmlzX2dyb3VwLAogICAgICAgICAgICAgIGRlcGFydG1lbnQ6ICflhbbku5YnCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKGRhdGEgJiYgQXJyYXkuaXNBcnJheShkYXRhKSkgewogICAgICAgICAgY29uc29sZS5sb2coJ+WkhOeQhumdnuWIhumhteaVsOaNrue7k+aehCwg5YWx5pyJ5Lya6K+d5pWwOicsIGRhdGEubGVuZ3RoKTsKICAgICAgICAgIC8vIOWkhOeQhumdnuWIhumhteaVsOaNrue7k+aehAogICAgICAgICAgY29udGFjdHMudmFsdWUgPSBkYXRhLm1hcChzZXNzaW9uID0+IHsKICAgICAgICAgICAgLy8g5om+5Yiw5a+55pa555So5oi377yI6Z2e5b2T5YmN55So5oi377yJCiAgICAgICAgICAgIGxldCBvdGhlclBhcnRpY2lwYW50ID0gbnVsbDsKICAgICAgICAgICAgaWYgKHNlc3Npb24ucGFydGljaXBhbnRzICYmIEFycmF5LmlzQXJyYXkoc2Vzc2lvbi5wYXJ0aWNpcGFudHMpKSB7CiAgICAgICAgICAgICAgaWYgKHVzZXJJbmZvLnZhbHVlICYmIHVzZXJJbmZvLnZhbHVlLmlkKSB7CiAgICAgICAgICAgICAgICBvdGhlclBhcnRpY2lwYW50ID0gc2Vzc2lvbi5wYXJ0aWNpcGFudHMuZmluZChwID0+IHAudXNlciAmJiBwLnVzZXIuaWQgIT09IHVzZXJJbmZvLnZhbHVlLmlkKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8g5aaC5p6c5rKh5pyJ5b2T5YmN55So5oi35L+h5oGv77yM5L2/55So56ys5LiA5Liq5Y+C5LiO6ICFCiAgICAgICAgICAgICAgICBvdGhlclBhcnRpY2lwYW50ID0gc2Vzc2lvbi5wYXJ0aWNpcGFudHNbMF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDlpoLmnpzmmK/nvqTogYrvvIzkvb/nlKjnvqTogYrkv6Hmga8KICAgICAgICAgICAgaWYgKHNlc3Npb24uaXNfZ3JvdXApIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IHNlc3Npb24uaWQsCiAgICAgICAgICAgICAgICBuYW1lOiBzZXNzaW9uLnRpdGxlIHx8ICfnvqTogYonLAogICAgICAgICAgICAgICAgaW5pdGlhbDogKHNlc3Npb24udGl0bGUgfHwgJ+e+pOiBiicpWzBdLAogICAgICAgICAgICAgICAgYXZhdGFyOiAnJywKICAgICAgICAgICAgICAgIGF2YXRhcl91cmw6ICcnLAogICAgICAgICAgICAgICAgY29sb3I6IGdldFJhbmRvbUNvbG9yKHNlc3Npb24uaWQpLAogICAgICAgICAgICAgICAgc3RhdHVzOiAnb25saW5lJywKICAgICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IHNlc3Npb24ubGFzdF9tZXNzYWdlLmNvbnRlbnQgOiAnJywKICAgICAgICAgICAgICAgIGxhc3RUaW1lOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24ubGFzdF9tZXNzYWdlLmNyZWF0ZWRfYXQpIDogZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi51cGRhdGVkX2F0KSwKICAgICAgICAgICAgICAgIHVucmVhZDogc2Vzc2lvbi51bnJlYWRfY291bnQsCiAgICAgICAgICAgICAgICBpc0dyb3VwOiB0cnVlCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g5Y2V6IGK77yM5L2/55So5a+55pa55L+h5oGvCiAgICAgICAgICAgIGlmIChvdGhlclBhcnRpY2lwYW50KSB7CiAgICAgICAgICAgICAgY29uc3QgdXNlciA9IG90aGVyUGFydGljaXBhbnQudXNlcjsKICAgICAgICAgICAgICAvLyDlpITnkIblpLTlg4/ot6/lvoQKICAgICAgICAgICAgICBsZXQgYXZhdGFyX3VybCA9ICcnOwogICAgICAgICAgICAgIGlmICh1c2VyLmF2YXRhcikgewogICAgICAgICAgICAgICAgY29uc3QgYXZhdGFyID0gdXNlci5hdmF0YXI7CiAgICAgICAgICAgICAgICBpZiAoYXZhdGFyLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBhdmF0YXIuc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkgewogICAgICAgICAgICAgICAgICBhdmF0YXJfdXJsID0gYXZhdGFyOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhdmF0YXIuc3RhcnRzV2l0aCgnLycpKSB7CiAgICAgICAgICAgICAgICAgIGF2YXRhcl91cmwgPSBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJIHx8ICdodHRwOi8vbG9jYWxob3N0OjgwMDAnfSR7YXZhdGFyfWA7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBhdmF0YXJfdXJsID0gYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9CQVNFX0FQSSB8fCAnaHR0cDovL2xvY2FsaG9zdDo4MDAwJ30vJHthdmF0YXJ9YDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBzZXNzaW9uLmlkLAogICAgICAgICAgICAgICAgbmFtZTogKHVzZXIubmFtZSB8fCAoKHVzZXIuZmlyc3RfbmFtZSB8fCAnJykgKyAnICcgKyAodXNlci5sYXN0X25hbWUgfHwgJycpKS50cmltKCkgfHwgdXNlci51c2VybmFtZSB8fCAn5pyq5ZG95ZCN6IGU57O75Lq6JykudHJpbSgpLAogICAgICAgICAgICAgICAgaW5pdGlhbDogKHVzZXIubmFtZSB8fCB1c2VyLmZpcnN0X25hbWUgfHwgdXNlci51c2VybmFtZSB8fCAn5pyq5ZG95ZCN6IGU57O75Lq6JylbMF0sCiAgICAgICAgICAgICAgICBhdmF0YXI6IHVzZXIuYXZhdGFyIHx8ICcnLAogICAgICAgICAgICAgICAgYXZhdGFyX3VybDogYXZhdGFyX3VybCwKICAgICAgICAgICAgICAgIGNvbG9yOiBnZXRSYW5kb21Db2xvcih1c2VyLmlkKSwKICAgICAgICAgICAgICAgIHN0YXR1czogJ29ubGluZScsCiAgICAgICAgICAgICAgICBsYXN0TWVzc2FnZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBzZXNzaW9uLmxhc3RfbWVzc2FnZS5jb250ZW50IDogJycsCiAgICAgICAgICAgICAgICBsYXN0VGltZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLmxhc3RfbWVzc2FnZS5jcmVhdGVkX2F0KSA6IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24udXBkYXRlZF9hdCksCiAgICAgICAgICAgICAgICB1bnJlYWQ6IHNlc3Npb24udW5yZWFkX2NvdW50LAogICAgICAgICAgICAgICAgaXNHcm91cDogZmFsc2UsCiAgICAgICAgICAgICAgICBkZXBhcnRtZW50OiB1c2VyLmRlcGFydG1lbnQgfHwgJ+WFtuS7licKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDlpoLmnpzmsqHmnInlhbbku5blj4LkuI7ogIXvvIjnkIborrrkuIrkuI3lupTor6Xlj5HnlJ/vvIkKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBpZDogc2Vzc2lvbi5pZCwKICAgICAgICAgICAgICBuYW1lOiBzZXNzaW9uLnRpdGxlIHx8ICfogYrlpKknLAogICAgICAgICAgICAgIGluaXRpYWw6IChzZXNzaW9uLnRpdGxlIHx8ICfogYrlpKknKVswXSwKICAgICAgICAgICAgICBhdmF0YXI6ICcnLAogICAgICAgICAgICAgIGF2YXRhcl91cmw6ICcnLAogICAgICAgICAgICAgIGNvbG9yOiBnZXRSYW5kb21Db2xvcihzZXNzaW9uLmlkKSwKICAgICAgICAgICAgICBzdGF0dXM6ICdvbmxpbmUnLAogICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IHNlc3Npb24ubGFzdF9tZXNzYWdlLmNvbnRlbnQgOiAnJywKICAgICAgICAgICAgICBsYXN0VGltZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLmxhc3RfbWVzc2FnZS5jcmVhdGVkX2F0KSA6IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24udXBkYXRlZF9hdCksCiAgICAgICAgICAgICAgdW5yZWFkOiBzZXNzaW9uLnVucmVhZF9jb3VudCwKICAgICAgICAgICAgICBpc0dyb3VwOiBzZXNzaW9uLmlzX2dyb3VwLAogICAgICAgICAgICAgIGRlcGFydG1lbnQ6ICflhbbku5YnCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8g5aaC5p6c5rKh5pyJ5pyJ5pWI5pWw5o2uCiAgICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bogYrlpKnkvJror53moLzlvI/lvILluLjmiJbkuLrnqbo6JywgZGF0YSk7CiAgICAgICAgICBjb250YWN0cy52YWx1ZSA9IFtdOwogICAgICAgIH0KICAgICAgICBjb25zb2xlLmxvZygn5aSE55CG5ZCO55qE6IGU57O75Lq65YiX6KGoOicsIGNvbnRhY3RzLnZhbHVlKTsKCiAgICAgICAgLy8g5aaC5p6c5pyJ5pyq6K+75raI5oGv77yM5oyJ5pyq6K+75pWw6YeP5o6S5bqPCiAgICAgICAgaWYgKGNvbnRhY3RzLnZhbHVlLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGNvbnRhY3RzLnZhbHVlLnNvcnQoKGEsIGIpID0+IGIudW5yZWFkIC0gYS51bnJlYWQpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfliqDovb3ogYrlpKnkvJror53lpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Yqg6L296IGK5aSp5Lya6K+d5aSx6LSlOiAnICsgKGVycm9yLm1lc3NhZ2UgfHwgJ+acquefpemUmeivrycpKTsKICAgICAgICBjb250YWN0cy52YWx1ZSA9IFtdOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGlmICghaXNCYWNrZ3JvdW5kUmVmcmVzaCkgewogICAgICAgICAgc2Vzc2lvbnNMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIC8vIOWKoOi9veiBiuWkqea2iOaBrwogICAgY29uc3QgbG9hZENoYXRNZXNzYWdlcyA9IGFzeW5jIChjaGF0SWQsIGlzQmFja2dyb3VuZFJlZnJlc2ggPSBmYWxzZSkgPT4gewogICAgICBpZiAoIWNoYXRJZCkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+aXoOazleWKoOi9vea2iOaBrzogY2hhdElk5Li656m6Jyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKCFpc0JhY2tncm91bmRSZWZyZXNoKSB7CiAgICAgICAgICBtZXNzYWdlc0xvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBjb25zb2xlLmxvZyhg5q2j5Zyo5Yqg6L296IGK5aSp5Lya6K+dICR7Y2hhdElkfSDnmoTmtojmga8uLi5gKTsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGdldENoYXRTZXNzaW9uKGNoYXRJZCk7CiAgICAgICAgY29uc29sZS5sb2coJ+iBiuWkqeS8muivneivpuaDheWTjeW6lDonLCByZXNwb25zZSk7CiAgICAgICAgaWYgKCFyZXNwb25zZSkgewogICAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W6IGK5aSp5Lya6K+d6K+m5oOF6L+U5Zue56m65ZON5bqUJyk7CiAgICAgICAgICBtZXNzYWdlcy52YWx1ZSA9IFtdOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g5aSE55CG5LiN5ZCM55qE5ZON5bqU5qC85byPCiAgICAgICAgbGV0IG1lc3NhZ2VEYXRhID0gW107CiAgICAgICAgbGV0IHNlc3Npb25EYXRhID0gbnVsbDsKICAgICAgICBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLm1lc3NhZ2VzKSB7CiAgICAgICAgICAvLyDmoIflh4bmoLzlvI/vvJrlk43lupTnm7TmjqXljIXlkKttZXNzYWdlc+Wtl+autQogICAgICAgICAgbWVzc2FnZURhdGEgPSByZXNwb25zZS5kYXRhLm1lc3NhZ2VzOwogICAgICAgICAgc2Vzc2lvbkRhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgY29uc29sZS5sb2coJ+agh+WHhuagvOW8j+a2iOaBr+aVsOaNru+8jOa2iOaBr+aVsOmHjzonLCBtZXNzYWdlRGF0YS5sZW5ndGgpOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5kYXRhLm1lc3NhZ2VzKSB7CiAgICAgICAgICAvLyDljIXoo4XmoLzlvI/vvJp7c3VjY2VzczogdHJ1ZSwgZGF0YToge21lc3NhZ2VzOiBbLi4uXX19CiAgICAgICAgICBtZXNzYWdlRGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YS5tZXNzYWdlczsKICAgICAgICAgIHNlc3Npb25EYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgY29uc29sZS5sb2coJ+WMheijheagvOW8j+a2iOaBr+aVsOaNru+8jOa2iOaBr+aVsOmHjzonLCBtZXNzYWdlRGF0YS5sZW5ndGgpOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UubWVzc2FnZXMpIHsKICAgICAgICAgIC8vIOebtOaOpei/lOWbnuagvOW8jzoge21lc3NhZ2VzOiBbLi4uXX0KICAgICAgICAgIG1lc3NhZ2VEYXRhID0gcmVzcG9uc2UubWVzc2FnZXM7CiAgICAgICAgICBzZXNzaW9uRGF0YSA9IHJlc3BvbnNlOwogICAgICAgICAgY29uc29sZS5sb2coJ+ebtOaOpei/lOWbnuagvOW8j+a2iOaBr+aVsOaNru+8jOa2iOaBr+aVsOmHjzonLCBtZXNzYWdlRGF0YS5sZW5ndGgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ+aXoOazleivhuWIq+eahOa2iOaBr+aVsOaNruagvOW8jzonLCByZXNwb25zZSk7CiAgICAgICAgICBjb25zb2xlLmxvZygn5bCd6K+V5qOA5p+l5piv5ZCm5pyJ5YW25LuW5Y+v6IO955qE5raI5oGv5a2X5q61Li4uJyk7CgogICAgICAgICAgLy8g5bCd6K+V5p+l5om+5YW25LuW5Y+v6IO955qE5raI5oGv5a2X5q61CiAgICAgICAgICBjb25zdCBwb3NzaWJsZU1lc3NhZ2VGaWVsZHMgPSBbJ21lc3NhZ2UnLCAnY2hhdF9tZXNzYWdlcycsICdjaGF0cycsICdjb250ZW50J107CiAgICAgICAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIHBvc3NpYmxlTWVzc2FnZUZpZWxkcykgewogICAgICAgICAgICBpZiAocmVzcG9uc2VbZmllbGRdICYmIEFycmF5LmlzQXJyYXkocmVzcG9uc2VbZmllbGRdKSkgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKGDmib7liLDlj6/og73nmoTmtojmga/lrZfmrrUgJHtmaWVsZH3vvIzkvb/nlKjmraTlrZfmrrXmlbDmja5gKTsKICAgICAgICAgICAgICBtZXNzYWdlRGF0YSA9IHJlc3BvbnNlW2ZpZWxkXTsKICAgICAgICAgICAgICBzZXNzaW9uRGF0YSA9IHJlc3BvbnNlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YVtmaWVsZF0gJiYgQXJyYXkuaXNBcnJheShyZXNwb25zZS5kYXRhW2ZpZWxkXSkpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg5ZyoZGF0YeWtl+auteS4reaJvuWIsOWPr+iDveeahOa2iOaBr+Wtl+autSAke2ZpZWxkfe+8jOS9v+eUqOatpOWtl+auteaVsOaNrmApOwogICAgICAgICAgICAgIG1lc3NhZ2VEYXRhID0gcmVzcG9uc2UuZGF0YVtmaWVsZF07CiAgICAgICAgICAgICAgc2Vzc2lvbkRhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobWVzc2FnZURhdGEubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2Fybign5pyq5om+5Yiw5Lu75L2V5raI5oGv5pWw5o2u77yM5L2/55So56m65pWw57uEJyk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyDlpITnkIbmtojmga/lj5HpgIHogIXnmoTlpLTlg48KICAgICAgICBtZXNzYWdlRGF0YS5mb3JFYWNoKG1lc3NhZ2UgPT4gewogICAgICAgICAgaWYgKG1lc3NhZ2Uuc2VuZGVyICYmIG1lc3NhZ2Uuc2VuZGVyLmF2YXRhcikgewogICAgICAgICAgICBjb25zdCBhdmF0YXIgPSBtZXNzYWdlLnNlbmRlci5hdmF0YXI7CiAgICAgICAgICAgIGlmIChhdmF0YXIuc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IGF2YXRhci5zdGFydHNXaXRoKCdodHRwczovLycpKSB7CiAgICAgICAgICAgICAgbWVzc2FnZS5zZW5kZXIuYXZhdGFyX3VybCA9IGF2YXRhcjsKICAgICAgICAgICAgfSBlbHNlIGlmIChhdmF0YXIuc3RhcnRzV2l0aCgnLycpKSB7CiAgICAgICAgICAgICAgbWVzc2FnZS5zZW5kZXIuYXZhdGFyX3VybCA9IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQkFTRV9BUEkgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6ODAwMCd9JHthdmF0YXJ9YDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtZXNzYWdlLnNlbmRlci5hdmF0YXJfdXJsID0gYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9CQVNFX0FQSSB8fCAnaHR0cDovL2xvY2FsaG9zdDo4MDAwJ30vJHthdmF0YXJ9YDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyDorrDlvZXkvJror53lkozmtojmga/mlbDmja4KICAgICAgICBjb25zb2xlLmxvZygn5aSE55CG5ZCO55qE5Lya6K+d5pWw5o2uOicsIHNlc3Npb25EYXRhKTsKICAgICAgICBjb25zb2xlLmxvZygn5aSE55CG5ZCO55qE5raI5oGv5pWw5o2uOicsIG1lc3NhZ2VEYXRhKTsKCiAgICAgICAgLy8g5aaC5p6c5Lya6K+d5LiN5Zyo6IGU57O75Lq65YiX6KGo5Lit77yM5re75Yqg5a6DCiAgICAgICAgaWYgKHNlc3Npb25EYXRhICYmICFjb250YWN0cy52YWx1ZS5zb21lKGMgPT4gYy5pZCA9PT0gcGFyc2VJbnQoY2hhdElkKSkpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCfkvJror53kuI3lnKjogZTns7vkurrliJfooajkuK3vvIzmt7vliqDlroM6Jywgc2Vzc2lvbkRhdGEpOwoKICAgICAgICAgIC8vIOWIm+W7uuS4tOaXtuiBlOezu+S6uuWvueixoQogICAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IHNlc3Npb25EYXRhOwogICAgICAgICAgLy8g5om+5Yiw5a+55pa555So5oi377yI6Z2e5b2T5YmN55So5oi377yJCiAgICAgICAgICBsZXQgb3RoZXJQYXJ0aWNpcGFudCA9IG51bGw7CgogICAgICAgICAgLy8g56Gu5L+dIHNlc3Npb24ucGFydGljaXBhbnRzIOWtmOWcqOS4lOaYr+aVsOe7hAogICAgICAgICAgaWYgKHNlc3Npb24ucGFydGljaXBhbnRzICYmIEFycmF5LmlzQXJyYXkoc2Vzc2lvbi5wYXJ0aWNpcGFudHMpICYmIHNlc3Npb24ucGFydGljaXBhbnRzLmxlbmd0aCA+IDAgJiYgdXNlckluZm8udmFsdWUpIHsKICAgICAgICAgICAgb3RoZXJQYXJ0aWNpcGFudCA9IHNlc3Npb24ucGFydGljaXBhbnRzLmZpbmQocCA9PiBwLnVzZXIgJiYgcC51c2VyLmlkICE9PSB1c2VySW5mby52YWx1ZS5pZCk7CiAgICAgICAgICB9CiAgICAgICAgICBsZXQgdGVtcENvbnRhY3QgPSBudWxsOwoKICAgICAgICAgIC8vIOWmguaenOaYr+e+pOiBiu+8jOS9v+eUqOe+pOiBiuS/oeaBrwogICAgICAgICAgaWYgKHNlc3Npb24uaXNfZ3JvdXApIHsKICAgICAgICAgICAgdGVtcENvbnRhY3QgPSB7CiAgICAgICAgICAgICAgaWQ6IHBhcnNlSW50KGNoYXRJZCksCiAgICAgICAgICAgICAgbmFtZTogc2Vzc2lvbi50aXRsZSB8fCAn576k6IGKJywKICAgICAgICAgICAgICBpbml0aWFsOiAoc2Vzc2lvbi50aXRsZSB8fCAn576k6IGKJylbMF0sCiAgICAgICAgICAgICAgYXZhdGFyOiAnJywKICAgICAgICAgICAgICBhdmF0YXJfdXJsOiAnJywKICAgICAgICAgICAgICBjb2xvcjogZ2V0UmFuZG9tQ29sb3IocGFyc2VJbnQoY2hhdElkKSksCiAgICAgICAgICAgICAgc3RhdHVzOiAnb25saW5lJywKICAgICAgICAgICAgICBsYXN0TWVzc2FnZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBzZXNzaW9uLmxhc3RfbWVzc2FnZS5jb250ZW50IDogJycsCiAgICAgICAgICAgICAgbGFzdFRpbWU6IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24udXBkYXRlZF9hdCksCiAgICAgICAgICAgICAgdW5yZWFkOiAwLAogICAgICAgICAgICAgIGlzR3JvdXA6IHRydWUKICAgICAgICAgICAgfTsKICAgICAgICAgICAgLy8g5Y2V6IGK77yM5L2/55So5a+55pa55L+h5oGvCiAgICAgICAgICB9IGVsc2UgaWYgKG90aGVyUGFydGljaXBhbnQgJiYgb3RoZXJQYXJ0aWNpcGFudC51c2VyKSB7CiAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBvdGhlclBhcnRpY2lwYW50LnVzZXI7CiAgICAgICAgICAgIC8vIOWkhOeQhuWktOWDj+i3r+W+hAogICAgICAgICAgICBsZXQgYXZhdGFyX3VybCA9ICcnOwogICAgICAgICAgICBpZiAodXNlci5hdmF0YXIpIHsKICAgICAgICAgICAgICBjb25zdCBhdmF0YXIgPSB1c2VyLmF2YXRhcjsKICAgICAgICAgICAgICBpZiAoYXZhdGFyLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBhdmF0YXIuc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkgewogICAgICAgICAgICAgICAgYXZhdGFyX3VybCA9IGF2YXRhcjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGF2YXRhci5zdGFydHNXaXRoKCcvJykpIHsKICAgICAgICAgICAgICAgIGF2YXRhcl91cmwgPSBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJIHx8ICdodHRwOi8vbG9jYWxob3N0OjgwMDAnfSR7YXZhdGFyfWA7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGF2YXRhcl91cmwgPSBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJIHx8ICdodHRwOi8vbG9jYWxob3N0OjgwMDAnfS8ke2F2YXRhcn1gOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0ZW1wQ29udGFjdCA9IHsKICAgICAgICAgICAgICBpZDogcGFyc2VJbnQoY2hhdElkKSwKICAgICAgICAgICAgICBuYW1lOiAodXNlci5uYW1lIHx8ICgodXNlci5maXJzdF9uYW1lIHx8ICcnKSArICcgJyArICh1c2VyLmxhc3RfbmFtZSB8fCAnJykpLnRyaW0oKSB8fCB1c2VyLnVzZXJuYW1lIHx8ICfmnKrlkb3lkI3ogZTns7vkuronKS50cmltKCksCiAgICAgICAgICAgICAgaW5pdGlhbDogKHVzZXIubmFtZSB8fCB1c2VyLmZpcnN0X25hbWUgfHwgdXNlci51c2VybmFtZSB8fCAn5pyq5ZG95ZCN6IGU57O75Lq6JylbMF0sCiAgICAgICAgICAgICAgYXZhdGFyOiB1c2VyLmF2YXRhciB8fCAnJywKICAgICAgICAgICAgICBhdmF0YXJfdXJsOiBhdmF0YXJfdXJsLAogICAgICAgICAgICAgIGNvbG9yOiBnZXRSYW5kb21Db2xvcih1c2VyLmlkKSwKICAgICAgICAgICAgICBzdGF0dXM6ICdvbmxpbmUnLAogICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IHNlc3Npb24ubGFzdF9tZXNzYWdlLmNvbnRlbnQgOiAnJywKICAgICAgICAgICAgICBsYXN0VGltZTogZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi51cGRhdGVkX2F0KSwKICAgICAgICAgICAgICB1bnJlYWQ6IDAsCiAgICAgICAgICAgICAgaXNHcm91cDogZmFsc2UKICAgICAgICAgICAgfTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOWmguaenOaXoOazleaJvuWIsOWvueaWueS/oeaBr++8jOS9v+eUqOm7mOiupOWAvAogICAgICAgICAgICB0ZW1wQ29udGFjdCA9IHsKICAgICAgICAgICAgICBpZDogcGFyc2VJbnQoY2hhdElkKSwKICAgICAgICAgICAgICBuYW1lOiBzZXNzaW9uLnRpdGxlIHx8ICfogYrlpKknLAogICAgICAgICAgICAgIGluaXRpYWw6IChzZXNzaW9uLnRpdGxlIHx8ICfogYrlpKknKVswXSwKICAgICAgICAgICAgICBhdmF0YXI6ICcnLAogICAgICAgICAgICAgIGF2YXRhcl91cmw6ICcnLAogICAgICAgICAgICAgIGNvbG9yOiBnZXRSYW5kb21Db2xvcihwYXJzZUludChjaGF0SWQpKSwKICAgICAgICAgICAgICBzdGF0dXM6ICdvbmxpbmUnLAogICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiAnJywKICAgICAgICAgICAgICBsYXN0VGltZTogZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi51cGRhdGVkX2F0KSwKICAgICAgICAgICAgICB1bnJlYWQ6IDAsCiAgICAgICAgICAgICAgaXNHcm91cDogc2Vzc2lvbi5pc19ncm91cAogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOa3u+WKoOS4tOaXtuiBlOezu+S6uuWIsOWIl+ihqAogICAgICAgICAgaWYgKHRlbXBDb250YWN0KSB7CiAgICAgICAgICAgIGNvbnRhY3RzLnZhbHVlLnVuc2hpZnQodGVtcENvbnRhY3QpOwogICAgICAgICAgICBjb25zb2xlLmxvZygn5re75Yqg5Li05pe26IGU57O75Lq6OicsIHRlbXBDb250YWN0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIOabtOaWsOe7hOS7tuaVsOaNrgogICAgICAgIG1lc3NhZ2VzLnZhbHVlID0gbWVzc2FnZURhdGEgfHwgW107CiAgICAgICAgY3VycmVudENoYXRJZC52YWx1ZSA9IHBhcnNlSW50KGNoYXRJZCk7CiAgICAgICAgc2VsZWN0ZWRDb250YWN0LnZhbHVlID0gcGFyc2VJbnQoY2hhdElkKTsKCiAgICAgICAgLy8g5Yqg6L295b2T5YmN5Lya6K+d5bey5LiK5Lyg55qE5paH5qGjSUQKICAgICAgICB0cnkgewogICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdCh7CiAgICAgICAgICAgIHVybDogJy9hcGkvYWkvZG9jdW1lbnRzLycsCiAgICAgICAgICAgIG1ldGhvZDogJ2dldCcsCiAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgIGNoYXQ6IGNoYXRJZAogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChyZXMgJiYgcmVzLmRhdGEgJiYgQXJyYXkuaXNBcnJheShyZXMuZGF0YS5yZXN1bHRzKSkgewogICAgICAgICAgICBzZWxlY3RlZERvY3VtZW50SWRzLnZhbHVlID0gcmVzLmRhdGEucmVzdWx0cy5tYXAoZG9jID0+IGRvYy5pZCk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCflvZPliY3kvJror53mlofmoaNJRDonLCBzZWxlY3RlZERvY3VtZW50SWRzLnZhbHVlKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBzZWxlY3RlZERvY3VtZW50SWRzLnZhbHVlID0gW107CiAgICAgICAgfQoKICAgICAgICAvLyDmu5rliqjliLDlupXpg6gKICAgICAgICBuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICBzY3JvbGxUb0JvdHRvbSgpOwogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WKoOi9veS8muivneivpuaDheWksei0pTonLCBlcnJvcik7CiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9ICfliqDovb3ogYrlpKnmtojmga/lpLHotKUnOwogICAgICAgIGlmIChlcnJvci5yZXNwb25zZSkgewogICAgICAgICAgY29uc3Qgc3RhdHVzID0gZXJyb3IucmVzcG9uc2Uuc3RhdHVzOwogICAgICAgICAgaWYgKHN0YXR1cyA9PT0gNDA0KSB7CiAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICfogYrlpKnkvJror53kuI3lrZjlnKjmiJblt7LooqvliKDpmaQnOwogICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IDQwMykgewogICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAn5peg5p2D6K6/6Zeu5q2k6IGK5aSp5Lya6K+dJzsKICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3IucmVzcG9uc2UuZGF0YSAmJiBlcnJvci5yZXNwb25zZS5kYXRhLm1lc3NhZ2UpIHsKICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gZXJyb3IucmVzcG9uc2UuZGF0YS5tZXNzYWdlOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoZXJyb3IubWVzc2FnZSkgewogICAgICAgICAgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZTsKICAgICAgICB9CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKGVycm9yTWVzc2FnZSk7CiAgICAgICAgbWVzc2FnZXMudmFsdWUgPSBbXTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBpZiAoIWlzQmFja2dyb3VuZFJlZnJlc2gpIHsKICAgICAgICAgIG1lc3NhZ2VzTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICAvLyDliLfmlrDogYrlpKnkvJror53liJfooagKICAgIGNvbnN0IHJlZnJlc2hDaGF0U2Vzc2lvbnMgPSBhc3luYyAoKSA9PiB7CiAgICAgIC8vIOabtOaWsOeUqOaIt+WIl+ihqAogICAgICBhd2FpdCBsb2FkQWxsVXNlcnMoKTsKCiAgICAgIC8vIOabtOaWsOmDqOmXqOWIl+ihqAogICAgICBhd2FpdCBsb2FkRGVwYXJ0bWVudHMoKTsKCiAgICAgIC8vIOabtOaWsOiBiuWkqeS8muivnQogICAgICBhd2FpdCBsb2FkQ2hhdFNlc3Npb25zKCk7CgogICAgICAvLyDlpoLmnpzmnInlvZPliY3ogYrlpKlJRO+8jOehruS/nemAieS4reato+ehrueahOiBlOezu+S6ugogICAgICBpZiAoY3VycmVudENoYXRJZC52YWx1ZSkgewogICAgICAgIGNvbnN0IGNvbnRhY3QgPSBjb250YWN0cy52YWx1ZS5maW5kKGMgPT4gYy5pZCA9PT0gY3VycmVudENoYXRJZC52YWx1ZSk7CiAgICAgICAgaWYgKGNvbnRhY3QpIHsKICAgICAgICAgIHNlbGVjdGVkQ29udGFjdC52YWx1ZSA9IGNvbnRhY3QuaWQ7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIC8vIOehruS/nea2iOaBr+WuueWZqOa7muWKqOWIsOW6lemDqAogICAgY29uc3Qgc2Nyb2xsVG9Cb3R0b20gPSAoKSA9PiB7CiAgICAgIGlmIChtZXNzYWdlQ29udGFpbmVyLnZhbHVlKSB7CiAgICAgICAgbWVzc2FnZUNvbnRhaW5lci52YWx1ZS5zY3JvbGxUb3AgPSBtZXNzYWdlQ29udGFpbmVyLnZhbHVlLnNjcm9sbEhlaWdodDsKICAgICAgfQogICAgfTsKCiAgICAvLyDlnKjpgInmi6nogZTns7vkurrlkI7vvIzmu5rliqjliLDlupXpg6gKICAgIGNvbnN0IHNlbGVjdENvbnRhY3QgPSBhc3luYyBjb250YWN0ID0+IHsKICAgICAgLy8g5qOA5p+l5piv5ZCm5bCd6K+V5LiO6Ieq5bex6IGK5aSpCiAgICAgIGlmICghY29udGFjdC5pc0dyb3VwICYmIHVzZXJJbmZvLnZhbHVlICYmIGNvbnRhY3QudXNlcklkID09PSB1c2VySW5mby52YWx1ZS5pZCkgewogICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfkuI3og73kuI7oh6rlt7HogYrlpKknKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coJ+mAieaLqeiBlOezu+S6ujonLCBjb250YWN0KTsKCiAgICAgIC8vIOWkhOeQhuS4pOenjeexu+Wei+eahElE77ya546w5pyJ5a+56K+dSUTlkoznlKjmiLdJROWJjee8gOeahOaDheWGtQogICAgICBsZXQgY29udGFjdElkID0gY29udGFjdC5pZDsKCiAgICAgIC8vIOajgOafpeaYr+WQpuW3suacieivpeiBlOezu+S6uueahOWvueivnQogICAgICBpZiAodHlwZW9mIGNvbnRhY3RJZCA9PT0gJ3N0cmluZycgJiYgY29udGFjdElkLnN0YXJ0c1dpdGgoJ3VzZXJfJykpIHsKICAgICAgICAvLyDov5nmmK/nm7TmjqXpgInmi6nkuobnlKjmiLfvvIzogIzkuI3mmK/njrDmnInnmoTogYrlpKnkvJror50KICAgICAgICBsZXQgdXNlcklkID0gY29udGFjdC51c2VySWQgfHwgY29udGFjdC5pZC5yZXBsYWNlKCd1c2VyXycsICcnKTsKICAgICAgICBjb25zb2xlLmxvZygn5bCd6K+V5p+l5om+5LiO55So5oi355qE546w5pyJ5a+56K+dOicsIHVzZXJJZCk7CgogICAgICAgIC8vIOWwneivleWcqOeOsOacieS8muivneS4reafpeaJvuS4juivpeeUqOaIt+eahOWvueivnQogICAgICAgIGNvbnN0IGV4aXN0aW5nQ2hhdCA9IGNvbnRhY3RzLnZhbHVlLmZpbmQoYyA9PiAhYy5pc0dyb3VwICYmIChjLnVzZXJJZCAmJiBjLnVzZXJJZCA9PSB1c2VySWQgfHwgYy51c2VyICYmIGMudXNlci5pZCA9PSB1c2VySWQpKTsKICAgICAgICBpZiAoZXhpc3RpbmdDaGF0KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygn5om+5Yiw5LiO55So5oi355qE546w5pyJ5a+56K+dOicsIGV4aXN0aW5nQ2hhdCk7CiAgICAgICAgICBjb250YWN0SWQgPSBleGlzdGluZ0NoYXQuaWQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCfmnKrmib7liLDkuI7nlKjmiLfnmoTnjrDmnInlr7nor53vvIzliJvlu7rmlrDlr7nor50nKTsKCiAgICAgICAgICAvLyDliJvlu7rmlrDnmoTogYrlpKnkvJror50KICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdCh7CiAgICAgICAgICAgICAgdXJsOiAnL2FwaS9jaGF0L3Nlc3Npb25zLycsCiAgICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsCiAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgcGFydGljaXBhbnRfaWRzOiBbdXNlcklkXSwKICAgICAgICAgICAgICAgIGlzX2dyb3VwOiBmYWxzZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfliJvlu7rkvJror53lk43lupQ6JywgcmVzcG9uc2UpOwoKICAgICAgICAgICAgLy8g5aSE55CGQVBJ5ZON5bqUCiAgICAgICAgICAgIGxldCBuZXdTZXNzaW9uID0gbnVsbDsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgICBuZXdTZXNzaW9uID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5pZCkgewogICAgICAgICAgICAgIG5ld1Nlc3Npb24gPSByZXNwb25zZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobmV3U2Vzc2lvbiAmJiBuZXdTZXNzaW9uLmlkKSB7CiAgICAgICAgICAgICAgLy8g5Yib5bu65Li05pe26IGU57O75Lq65a+56LGhCiAgICAgICAgICAgICAgY29uc3QgdGVtcENvbnRhY3QgPSB7CiAgICAgICAgICAgICAgICBpZDogbmV3U2Vzc2lvbi5pZCwKICAgICAgICAgICAgICAgIHVzZXJJZDogdXNlcklkLAogICAgICAgICAgICAgICAgbmFtZTogY29udGFjdC5uYW1lLAogICAgICAgICAgICAgICAgaW5pdGlhbDogY29udGFjdC5pbml0aWFsLAogICAgICAgICAgICAgICAgYXZhdGFyOiBjb250YWN0LmF2YXRhciwKICAgICAgICAgICAgICAgIGF2YXRhcl91cmw6IGNvbnRhY3QuYXZhdGFyX3VybCB8fCAnJywKICAgICAgICAgICAgICAgIGNvbG9yOiBjb250YWN0LmNvbG9yIHx8IGdldFJhbmRvbUNvbG9yKHVzZXJJZCksCiAgICAgICAgICAgICAgICBzdGF0dXM6ICdvbmxpbmUnLAogICAgICAgICAgICAgICAgbGFzdE1lc3NhZ2U6ICcnLAogICAgICAgICAgICAgICAgbGFzdFRpbWU6IGZvcm1hdE1lc3NhZ2VUaW1lKG5ldyBEYXRlKCkpLAogICAgICAgICAgICAgICAgdW5yZWFkOiAwLAogICAgICAgICAgICAgICAgaXNHcm91cDogZmFsc2UsCiAgICAgICAgICAgICAgICBkZXBhcnRtZW50OiBjb250YWN0LmRlcGFydG1lbnQKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAvLyDmt7vliqDliLDogZTns7vkurrliJfooagKICAgICAgICAgICAgICBjb250YWN0cy52YWx1ZS51bnNoaWZ0KHRlbXBDb250YWN0KTsKCiAgICAgICAgICAgICAgLy8g5pu05paw6YCJ5Lit55qE6IGU57O75Lq6CiAgICAgICAgICAgICAgY29udGFjdElkID0gbmV3U2Vzc2lvbi5pZDsKICAgICAgICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5bey5Yib5bu65paw55qE5a+56K+dJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfliJvlu7rkvJror53ov5Tlm57ml6DmlYjmlbDmja4nKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcign5Yib5bu65paw5Lya6K+d5aSx6LSlOicsIGVycm9yKTsKICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfml6Dms5XliJvlu7rmlrDlr7nor506ICcgKyAoZXJyb3IubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJykpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyDliqDovb3pgInkuK3nmoTogZTns7vkuroKICAgICAgc2VsZWN0ZWRDb250YWN0LnZhbHVlID0gY29udGFjdElkOwogICAgICBtZXNzYWdlSW5wdXQudmFsdWUgPSAnJzsKICAgICAgbWVzc2FnZXMudmFsdWUgPSBbXTsKCiAgICAgIC8vIOWKoOi9vea2iOaBrwogICAgICB0cnkgewogICAgICAgIGF3YWl0IGxvYWRDaGF0TWVzc2FnZXMoY29udGFjdElkKTsKCiAgICAgICAgLy8g5rua5Yqo5Yiw5bqV6YOoCiAgICAgICAgbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgc2Nyb2xsVG9Cb3R0b20oKTsKICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfliqDovb3ogYrlpKnmtojmga/lpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5peg5rOV5Yqg6L295a+56K+d5YaF5a6577yaJyArIChlcnJvci5tZXNzYWdlIHx8ICfmnKrnn6XplJnor68nKSk7CiAgICAgIH0KICAgIH07CgogICAgLy8g5Zyo5raI5oGv5YiX6KGo5pu05paw5ZCO77yM5rua5Yqo5Yiw5bqV6YOoCiAgICB3YXRjaChtZXNzYWdlcywgKCkgPT4gewogICAgICBuZXh0VGljaygoKSA9PiB7CiAgICAgICAgc2Nyb2xsVG9Cb3R0b20oKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICAvLyDlj5HpgIHmtojmga8KICAgIGNvbnN0IHNlbmRNZXNzYWdlID0gYXN5bmMgKCkgPT4gewogICAgICBpZiAoIW1lc3NhZ2VJbnB1dC52YWx1ZS50cmltKCkgfHwgIWN1cnJlbnRDaGF0SWQudmFsdWUpIHJldHVybjsKICAgICAgdHJ5IHsKICAgICAgICBjb25zb2xlLmxvZygn5Y+R6YCB5raI5oGv5pe25paH5qGjSURzOicsIHNlbGVjdGVkRG9jdW1lbnRJZHMudmFsdWUpOwogICAgICAgIGlmICghdXNlckluZm8udmFsdWUgfHwgIXVzZXJJbmZvLnZhbHVlLmlkKSB7CiAgICAgICAgICBjb25zdCB1c2VyRGF0YSA9IGF3YWl0IGZldGNoQ3VycmVudFVzZXIoKTsKICAgICAgICAgIGlmICghdXNlckRhdGEgfHwgIXVzZXJEYXRhLmlkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcign5peg5rOV6I635Y+W5b2T5YmN55So5oi35L+h5oGv77yM6K+35Yi35paw6aG16Z2i6YeN6K+VJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IHRlbXBNZXNzYWdlID0gewogICAgICAgICAgaWQ6ICd0ZW1wLScgKyBEYXRlLm5vdygpLAogICAgICAgICAgY29udGVudDogbWVzc2FnZUlucHV0LnZhbHVlLnRyaW0oKSwKICAgICAgICAgIHNlbmRlcjogewogICAgICAgICAgICBpZDogdXNlckluZm8udmFsdWUuaWQsCiAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VySW5mby52YWx1ZS51c2VybmFtZSB8fCAn55So5oi3JywKICAgICAgICAgICAgZmlyc3RfbmFtZTogdXNlckluZm8udmFsdWUuZmlyc3RfbmFtZSB8fCAnJywKICAgICAgICAgICAgbGFzdF9uYW1lOiB1c2VySW5mby52YWx1ZS5sYXN0X25hbWUgfHwgJycKICAgICAgICAgIH0sCiAgICAgICAgICBtZXNzYWdlX3R5cGU6ICd0ZXh0JywKICAgICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgIGlzX3RlbXA6IHRydWUKICAgICAgICB9OwogICAgICAgIG1lc3NhZ2VzLnZhbHVlLnB1c2godGVtcE1lc3NhZ2UpOwogICAgICAgIGNvbnN0IG1lc3NhZ2VDb3B5ID0gbWVzc2FnZUlucHV0LnZhbHVlOwogICAgICAgIG1lc3NhZ2VJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgIGF3YWl0IG5leHRUaWNrKCk7CiAgICAgICAgc2Nyb2xsVG9Cb3R0b20oKTsKICAgICAgICBsZXQgcmVzcG9uc2UsIGFpTXNnOwogICAgICAgIGlmIChzZWxlY3RlZERvY3VtZW50SWRzLnZhbHVlICYmIHNlbGVjdGVkRG9jdW1lbnRJZHMudmFsdWUubGVuZ3RoID4gMCkgewogICAgICAgICAgLy8g5paH5qGj5aKe5by6QUnlr7nor50KICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgYWlDaGF0V2l0aERvY3VtZW50cyh7CiAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VDb3B5LAogICAgICAgICAgICBjaGF0X2lkOiBjdXJyZW50Q2hhdElkLnZhbHVlLAogICAgICAgICAgICBkb2N1bWVudF9pZHM6IHNlbGVjdGVkRG9jdW1lbnRJZHMudmFsdWUKICAgICAgICAgIH0pOwogICAgICAgICAgLy8g5YW85a655rWB5byP5paH5pys5ZON5bqUCiAgICAgICAgICBsZXQgYWlDb250ZW50ID0gJyc7CiAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgdHlwZW9mIHJlc3BvbnNlLmRhdGEgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIGFpQ29udGVudCA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5tZXNzYWdlKSB7CiAgICAgICAgICAgIGFpQ29udGVudCA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChhaUNvbnRlbnQpIHsKICAgICAgICAgICAgYWlNc2cgPSB7CiAgICAgICAgICAgICAgaWQ6ICdhaS0nICsgRGF0ZS5ub3coKSwKICAgICAgICAgICAgICBjb250ZW50OiBhaUNvbnRlbnQsCiAgICAgICAgICAgICAgc2VuZGVyOiB7CiAgICAgICAgICAgICAgICBpZDogMCwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiAnQUnliqnmiYsnCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBtZXNzYWdlX3R5cGU6ICd0ZXh0JywKICAgICAgICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgLy8g55SoQUnlm57lpI3mm7/mjaLkuLTml7bmtojmga8KICAgICAgICAgICAgY29uc3QgdGVtcEluZGV4ID0gbWVzc2FnZXMudmFsdWUuZmluZEluZGV4KG0gPT4gbS5pZCA9PT0gdGVtcE1lc3NhZ2UuaWQpOwogICAgICAgICAgICBpZiAodGVtcEluZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgIG1lc3NhZ2VzLnZhbHVlLnNwbGljZSh0ZW1wSW5kZXgsIDEsIGFpTXNnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtZXNzYWdlcy52YWx1ZS5wdXNoKGFpTXNnKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyDljp/mnInmma7pgJrmtojmga8KICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgc2VuZFRleHRNZXNzYWdlKHsKICAgICAgICAgICAgY2hhdDogY3VycmVudENoYXRJZC52YWx1ZSwKICAgICAgICAgICAgY29udGVudDogbWVzc2FnZUNvcHkKICAgICAgICAgIH0pOwogICAgICAgICAgbGV0IG1lc3NhZ2VEYXRhID0gbnVsbDsKICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdWNjZXNzICYmIHJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgbWVzc2FnZURhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5pZCkgewogICAgICAgICAgICBtZXNzYWdlRGF0YSA9IHJlc3BvbnNlOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5jaGF0KSB7CiAgICAgICAgICAgIG1lc3NhZ2VEYXRhID0gewogICAgICAgICAgICAgIGlkOiByZXNwb25zZS5pZCB8fCAnbXNnLScgKyBEYXRlLm5vdygpLAogICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmNvbnRlbnQsCiAgICAgICAgICAgICAgbWVzc2FnZV90eXBlOiByZXNwb25zZS5tZXNzYWdlX3R5cGUsCiAgICAgICAgICAgICAgZmlsZTogcmVzcG9uc2UuZmlsZSwKICAgICAgICAgICAgICBjcmVhdGVkX2F0OiByZXNwb25zZS5jcmVhdGVkX2F0IHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICBzZW5kZXI6IHsKICAgICAgICAgICAgICAgIGlkOiB1c2VySW5mby52YWx1ZS5pZCwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VySW5mby52YWx1ZS51c2VybmFtZSB8fCAn55So5oi3JywKICAgICAgICAgICAgICAgIGZpcnN0X25hbWU6IHVzZXJJbmZvLnZhbHVlLmZpcnN0X25hbWUgfHwgJycsCiAgICAgICAgICAgICAgICBsYXN0X25hbWU6IHVzZXJJbmZvLnZhbHVlLmxhc3RfbmFtZSB8fCAnJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHRlbXBJbmRleCA9IG1lc3NhZ2VzLnZhbHVlLmZpbmRJbmRleChtID0+IG0uaWQgPT09IHRlbXBNZXNzYWdlLmlkKTsKICAgICAgICAgIGlmICh0ZW1wSW5kZXggIT09IC0xICYmIG1lc3NhZ2VEYXRhKSB7CiAgICAgICAgICAgIG1lc3NhZ2VzLnZhbHVlLnNwbGljZSh0ZW1wSW5kZXgsIDEsIG1lc3NhZ2VEYXRhKTsKICAgICAgICAgIH0gZWxzZSBpZiAobWVzc2FnZURhdGEpIHsKICAgICAgICAgICAgbWVzc2FnZXMudmFsdWUucHVzaChtZXNzYWdlRGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGF3YWl0IG5leHRUaWNrKCk7CiAgICAgICAgc2Nyb2xsVG9Cb3R0b20oKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCflj5HpgIHmtojmga/lpLHotKU6JywgZXJyb3IpOwogICAgICAgIG1lc3NhZ2VzLnZhbHVlID0gbWVzc2FnZXMudmFsdWUuZmlsdGVyKG0gPT4gIW0uaXNfdGVtcCk7CiAgICAgICAgbWVzc2FnZUlucHV0LnZhbHVlID0gZXJyb3Iuc2F2ZWRNZXNzYWdlIHx8IG1lc3NhZ2VJbnB1dC52YWx1ZTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WPkemAgea2iOaBr+Wksei0pe+8jOivt+mHjeivlScpOwogICAgICB9CiAgICB9OwoKICAgIC8vIOaJk+W8gOaWh+S7tuS4iuS8oAogICAgY29uc3Qgb3BlbkZpbGVVcGxvYWQgPSAoKSA9PiB7CiAgICAgIGZpbGVJbnB1dC52YWx1ZS5jbGljaygpOwogICAgfTsKCiAgICAvLyDmiZPlvIDlm77niYfkuIrkvKAKICAgIGNvbnN0IG9wZW5JbWFnZVVwbG9hZCA9ICgpID0+IHsKICAgICAgaW1hZ2VJbnB1dC52YWx1ZS5jbGljaygpOwogICAgfTsKCiAgICAvLyDmt7vliqDmlofku7blkozlm77niYfkuIrkvKDliqDovb3nirbmgIEKICAgIGNvbnN0IGZpbGVVcGxvYWRpbmcgPSByZWYoZmFsc2UpOwogICAgY29uc3QgaW1hZ2VVcGxvYWRpbmcgPSByZWYoZmFsc2UpOwoKICAgIC8vIOWkhOeQhuaWh+S7tuS4iuS8oAogICAgY29uc3QgaGFuZGxlRmlsZVVwbG9hZCA9IGFzeW5jIGV2ZW50ID0+IHsKICAgICAgY29uc3QgZmlsZSA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgICAgaWYgKCFmaWxlIHx8ICFjdXJyZW50Q2hhdElkLnZhbHVlKSByZXR1cm47CiAgICAgIHRyeSB7CiAgICAgICAgLy8g5pi+56S65Yqg6L295Yqo55S7CiAgICAgICAgZmlsZVVwbG9hZGluZy52YWx1ZSA9IHRydWU7CgogICAgICAgIC8vIOebtOaOpeS9v+eUqHNlbmRGaWxlTWVzc2FnZeWPkemAgeaWh+S7tua2iOaBrwogICAgICAgIGF3YWl0IHNlbmRGaWxlTWVzc2FnZShjdXJyZW50Q2hhdElkLnZhbHVlLCBg5Y+R6YCB5paH5Lu2OiAke2ZpbGUubmFtZX1gLCBmaWxlKTsKCiAgICAgICAgLy8g5ZCM5pe25LiK5Lyg5YiwQUnmlofmoaPns7vnu5/vvIjlpoLmnpzpnIDopoHvvIkKICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGUpOwogICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnY2hhdCcsIGN1cnJlbnRDaGF0SWQudmFsdWUpOwogICAgICAgIGF3YWl0IHJlcXVlc3QoewogICAgICAgICAgdXJsOiAnL2FwaS9haS9kb2N1bWVudHMvdXBsb2FkLycsCiAgICAgICAgICBtZXRob2Q6ICdwb3N0JywKICAgICAgICAgIGRhdGE6IGZvcm1EYXRhLAogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ211bHRpcGFydC9mb3JtLWRhdGEnCiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vIOS4iuS8oOWQjuW8uuWItuWIt+aWsOaWh+aho0lE5YiX6KGoCiAgICAgICAgY29uc3QgZG9jUmVzID0gYXdhaXQgcmVxdWVzdCh7CiAgICAgICAgICB1cmw6ICcvYXBpL2FpL2RvY3VtZW50cy8nLAogICAgICAgICAgbWV0aG9kOiAnZ2V0JywKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBjaGF0OiBjdXJyZW50Q2hhdElkLnZhbHVlCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgaWYgKGRvY1JlcyAmJiBkb2NSZXMuZGF0YSAmJiBBcnJheS5pc0FycmF5KGRvY1Jlcy5kYXRhLnJlc3VsdHMpKSB7CiAgICAgICAgICBzZWxlY3RlZERvY3VtZW50SWRzLnZhbHVlID0gZG9jUmVzLmRhdGEucmVzdWx0cy5tYXAoZG9jID0+IGRvYy5pZCk7CiAgICAgICAgICBjb25zb2xlLmxvZygn5LiK5Lyg5ZCO5Yi35paw5paH5qGjSURzOicsIHNlbGVjdGVkRG9jdW1lbnRJZHMudmFsdWUpOwogICAgICAgIH0KICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5paH5Lu25Y+R6YCB5oiQ5YqfJyk7CgogICAgICAgIC8vIOmHjeaWsOWKoOi9vea2iOaBrwogICAgICAgIGxvYWRDaGF0TWVzc2FnZXMoY3VycmVudENoYXRJZC52YWx1ZSwgdHJ1ZSk7CiAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gJyc7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Y+R6YCB5paH5Lu25aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WPkemAgeaWh+S7tuWksei0pScpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIC8vIOaXoOiuuuaIkOWKn+Wksei0pe+8jOmDveWFs+mXreWKoOi9veWKqOeUuwogICAgICAgIGZpbGVVcGxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgfQogICAgfTsKCiAgICAvLyDlpITnkIblm77niYfkuIrkvKAKICAgIGNvbnN0IGhhbmRsZUltYWdlVXBsb2FkID0gYXN5bmMgZXZlbnQgPT4gewogICAgICBjb25zdCBmaWxlID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdOwogICAgICBpZiAoIWZpbGUgfHwgIWN1cnJlbnRDaGF0SWQudmFsdWUpIHJldHVybjsKICAgICAgdHJ5IHsKICAgICAgICAvLyDmmL7npLrliqDovb3liqjnlLsKICAgICAgICBpbWFnZVVwbG9hZGluZy52YWx1ZSA9IHRydWU7CgogICAgICAgIC8vIOS9v+eUqOS/ruaUueWQjueahEFQSeWPguaVsAogICAgICAgIGF3YWl0IHNlbmRJbWFnZU1lc3NhZ2UoY3VycmVudENoYXRJZC52YWx1ZSwgYOWPkemAgeWbvueJh2AsIGZpbGUpOwoKICAgICAgICAvLyDph43mlrDliqDovb3mtojmga8KICAgICAgICBsb2FkQ2hhdE1lc3NhZ2VzKGN1cnJlbnRDaGF0SWQudmFsdWUsIHRydWUpOwoKICAgICAgICAvLyDmuIXnqbrmlofku7bovpPlhaUKICAgICAgICBldmVudC50YXJnZXQudmFsdWUgPSAnJzsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCflj5HpgIHlm77niYflpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Y+R6YCB5Zu+54mH5aSx6LSlJyk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgLy8g5peg6K665oiQ5Yqf5aSx6LSl77yM6YO95YWz6Zet5Yqg6L295Yqo55S7CiAgICAgICAgaW1hZ2VVcGxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgfQogICAgfTsKCiAgICAvLyDmiZPlvIDnn6Xor4blupPlr7nor53moYYKICAgIGNvbnN0IG9wZW5Lbm93bGVkZ2VEaWFsb2cgPSBhc3luYyAoKSA9PiB7CiAgICAgIGtub3dsZWRnZURpYWxvZ1Zpc2libGUudmFsdWUgPSB0cnVlOwogICAgICBhd2FpdCBsb2FkS25vd2xlZGdlTGlzdCgpOwogICAgfTsKCiAgICAvLyDliqDovb3nn6Xor4blupPliJfooagKICAgIGNvbnN0IGxvYWRLbm93bGVkZ2VMaXN0ID0gYXN5bmMgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGtub3dsZWRnZUxvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGRhdGEKICAgICAgICB9ID0gYXdhaXQgZ2V0S25vd2xlZGdlTGlzdCgpOwogICAgICAgIGtub3dsZWRnZUxpc3QudmFsdWUgPSBkYXRhOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WKoOi9veefpeivhuW6k+WIl+ihqOWksei0pTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfliqDovb3nn6Xor4blupPliJfooajlpLHotKUnKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBrbm93bGVkZ2VMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgIH0KICAgIH07CgogICAgLy8g6YCJ5oup55+l6K+G5bqT5paH5Lu2CiAgICBjb25zdCBzZWxlY3RLbm93bGVkZ2UgPSByb3cgPT4gewogICAgICBzZWxlY3RlZEtub3dsZWRnZS52YWx1ZSA9IHJvdzsKICAgIH07CgogICAgLy8g5YiG5Lqr55+l6K+G5bqT5paH5Lu2CiAgICBjb25zdCBzaGFyZUtub3dsZWRnZSA9IGFzeW5jIGtub3dsZWRnZSA9PiB7CiAgICAgIGlmICghY3VycmVudENoYXRJZC52YWx1ZSkgcmV0dXJuOwogICAgICB0cnkgewogICAgICAgIGF3YWl0IHNlbmRLbm93bGVkZ2VNZXNzYWdlKGN1cnJlbnRDaGF0SWQudmFsdWUsIGDliIbkuqvnn6Xor4blupPmlofku7Y6ICR7a25vd2xlZGdlLnRpdGxlfWAsIGtub3dsZWRnZS5pZCk7CgogICAgICAgIC8vIOWFs+mXreWvueivneahhgogICAgICAgIGtub3dsZWRnZURpYWxvZ1Zpc2libGUudmFsdWUgPSBmYWxzZTsKCiAgICAgICAgLy8g6YeN5paw5Yqg6L295raI5oGvCiAgICAgICAgbG9hZENoYXRNZXNzYWdlcyhjdXJyZW50Q2hhdElkLnZhbHVlLCB0cnVlKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfliIbkuqvnn6Xor4blupPmlofku7blpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5YiG5Lqr55+l6K+G5bqT5paH5Lu25aSx6LSlJyk7CiAgICAgIH0KICAgIH07CgogICAgLy8g5LiL6L295paH5Lu2CiAgICBjb25zdCBkb3dubG9hZEZpbGUgPSBhc3luYyBtZXNzYWdlID0+IHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGRvd25sb2FkTWVzc2FnZUZpbGUobWVzc2FnZS5pZCk7CgogICAgICAgIC8vIOWIm+W7uuS4i+i9vemTvuaOpQogICAgICAgIGNvbnN0IHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFtyZXNwb25zZS5kYXRhXSkpOwogICAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgbGluay5ocmVmID0gdXJsOwogICAgICAgIGxpbmsuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcsIG1lc3NhZ2UuZmlsZV9uYW1lIHx8ICdkb3dubG9hZCcpOwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgbGluay5jbGljaygpOwogICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGluayk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5LiL6L295paH5Lu25aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+S4i+i9veaWh+S7tuWksei0pScpOwogICAgICB9CiAgICB9OwoKICAgIC8vIOafpeeci+efpeivhuW6k+aWh+S7tgogICAgY29uc3Qgdmlld0tub3dsZWRnZSA9IG1lc3NhZ2UgPT4gewogICAgICBpZiAobWVzc2FnZS5rbm93bGVkZ2VfZGV0YWlsKSB7CiAgICAgICAgLy8g5Y+v5Lul6Lez6L2s5Yiw55+l6K+G5bqT6K+m5oOF6aG16Z2iCiAgICAgICAgRWxNZXNzYWdlQm94LmFsZXJ0KGDmoIfpopg6ICR7bWVzc2FnZS5rbm93bGVkZ2VfZGV0YWlsLnRpdGxlfTxicj7mj4/ov7A6ICR7bWVzc2FnZS5rbm93bGVkZ2VfZGV0YWlsLmRlc2NyaXB0aW9uIHx8ICfml6AnfWAsICfnn6Xor4blupPmlofku7YnLCB7CiAgICAgICAgICBkYW5nZXJvdXNseVVzZUhUTUxTdHJpbmc6IHRydWUsCiAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruWumicKICAgICAgICB9KTsKICAgICAgfQogICAgfTsKCiAgICAvLyDojrflj5blj5HpgIHogIXpopzoibIKICAgIGNvbnN0IGdldFNlbmRlckNvbG9yID0gc2VuZGVyID0+IHsKICAgICAgcmV0dXJuIGdldFJhbmRvbUNvbG9yKHNlbmRlci5pZCk7CiAgICB9OwoKICAgIC8vIOiOt+WPluWPkemAgeiAhemmluWtl+avjQogICAgY29uc3QgZ2V0U2VuZGVySW5pdGlhbCA9IHNlbmRlciA9PiB7CiAgICAgIHJldHVybiAoc2VuZGVyLmZpcnN0X25hbWUgfHwgc2VuZGVyLnVzZXJuYW1lKVswXTsKICAgIH07CgogICAgLy8g5qC55o2uSUTnlJ/miJDpmo/mnLrpopzoibIKICAgIGNvbnN0IGdldFJhbmRvbUNvbG9yID0gaWQgPT4gewogICAgICBjb25zdCBjb2xvcnMgPSBbJyMwMDdiZmYnLCAnIzI4YTc0NScsICcjZGMzNTQ1JywgJyNmZDdlMTQnLCAnIzZmNDJjMScsICcjMjBjOTk3JywgJyMxN2EyYjgnLCAnIzZjNzU3ZCddOwoKICAgICAgLy8g5L2/55SoSUTkvZzkuLrntKLlvJXvvIznoa7kv53lkIzkuIDnlKjmiLfpopzoibLkuIDoh7QKICAgICAgY29uc3QgaW5kZXggPSB0eXBlb2YgaWQgPT09ICdudW1iZXInID8gaWQgJSBjb2xvcnMubGVuZ3RoIDogMDsKICAgICAgcmV0dXJuIGNvbG9yc1tpbmRleF07CiAgICB9OwoKICAgIC8vIOagvOW8j+WMlua2iOaBr+aXtumXtAogICAgY29uc3QgZm9ybWF0TWVzc2FnZVRpbWUgPSB0aW1lc3RhbXAgPT4gewogICAgICBpZiAoIXRpbWVzdGFtcCkgcmV0dXJuICcnOwogICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodGltZXN0YW1wKTsKICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsKICAgICAgY29uc3QgZGlmZiA9IG5vdyAtIGRhdGU7CgogICAgICAvLyDku4rlpKnlhoXnmoTmtojmga/mmL7npLrml7bpl7QKICAgICAgaWYgKGRpZmYgPCAyNCAqIDYwICogNjAgKiAxMDAwKSB7CiAgICAgICAgY29uc3QgaG91cnMgPSBkYXRlLmdldEhvdXJzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpOwogICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBkYXRlLmdldE1pbnV0ZXMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgcmV0dXJuIGAke2hvdXJzfToke21pbnV0ZXN9YDsKICAgICAgfQoKICAgICAgLy8g5LiA5ZGo5YaF55qE5raI5oGv5pi+56S65pif5pyf5YegCiAgICAgIGlmIChkaWZmIDwgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApIHsKICAgICAgICBjb25zdCBkYXlzID0gWyflkajml6UnLCAn5ZGo5LiAJywgJ+WRqOS6jCcsICflkajkuIknLCAn5ZGo5ZubJywgJ+WRqOS6lCcsICflkajlha0nXTsKICAgICAgICByZXR1cm4gZGF5c1tkYXRlLmdldERheSgpXTsKICAgICAgfQoKICAgICAgLy8g5pu05pep55qE5raI5oGv5pi+56S65pel5pyfCiAgICAgIHJldHVybiBgJHtkYXRlLmdldE1vbnRoKCkgKyAxfeaciCR7ZGF0ZS5nZXREYXRlKCl95pelYDsKICAgIH07CgogICAgLy8g5qC85byP5YyW5pel5pyfCiAgICBjb25zdCBmb3JtYXREYXRlID0gdGltZXN0YW1wID0+IHsKICAgICAgaWYgKCF0aW1lc3RhbXApIHJldHVybiAnJzsKICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHRpbWVzdGFtcCk7CiAgICAgIHJldHVybiBgJHtkYXRlLmdldEZ1bGxZZWFyKCl9LSR7KGRhdGUuZ2V0TW9udGgoKSArIDEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX0tJHtkYXRlLmdldERhdGUoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YDsKICAgIH07CgogICAgLy8g5qC85byP5YyW5paH5Lu25aSn5bCPCiAgICBjb25zdCBmb3JtYXRGaWxlU2l6ZSA9IHNpemVJbktCID0+IHsKICAgICAgaWYgKHNpemVJbktCIDwgMTAyNCkgewogICAgICAgIHJldHVybiBgJHtzaXplSW5LQn0gS0JgOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBgJHsoc2l6ZUluS0IgLyAxMDI0KS50b0ZpeGVkKDIpfSBNQmA7CiAgICAgIH0KICAgIH07CgogICAgLy8g6I635Y+W54q25oCB5paH5a2XCiAgICBjb25zdCBnZXRTdGF0dXNUZXh0ID0gc3RhdHVzID0+IHsKICAgICAgY29uc3Qgc3RhdHVzTWFwID0gewogICAgICAgICdvbmxpbmUnOiAn5Zyo57q/JywKICAgICAgICAnb2ZmbGluZSc6ICfnprvnur8nLAogICAgICAgICdidXN5JzogJ+W/meeijCcsCiAgICAgICAgJ2F3YXknOiAn56a75byAJwogICAgICB9OwogICAgICByZXR1cm4gc3RhdHVzTWFwW3N0YXR1c10gfHwgc3RhdHVzOwogICAgfTsKCiAgICAvLyDmt7vliqDlvLrliLbliLfmlrDmlrnms5UKICAgIGNvbnN0IGZvcmNlUmVmcmVzaCA9IGFzeW5jICgpID0+IHsKICAgICAgdHJ5IHsKICAgICAgICBFbE1lc3NhZ2UuaW5mbygn5q2j5Zyo5by65Yi25Yi35paw5pWw5o2uLi4uJyk7CgogICAgICAgIC8vIOmHjeaWsOiOt+WPlueUqOaIt+S/oeaBrwogICAgICAgIGNvbnN0IHVzZXJEYXRhID0gYXdhaXQgZmV0Y2hDdXJyZW50VXNlcigpOwogICAgICAgIGlmICghdXNlckRhdGEpIHsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5peg5rOV6I635Y+W55So5oi35L+h5oGv77yM6K+35bCd6K+V6YeN5paw55m75b2VJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyDph43mlrDliqDovb3ogYrlpKnkvJror50KICAgICAgICBhd2FpdCBsb2FkQ2hhdFNlc3Npb25zKCk7CiAgICAgICAgaWYgKGNvbnRhY3RzLnZhbHVlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgRWxNZXNzYWdlLndhcm5pbmcoJ+acquaJvuWIsOS7u+S9leiBiuWkqeS8muivne+8jOaCqOWPr+iDvei/mOayoeacieW8gOWni+S7u+S9leWvueivnScpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5Yi35paw5oiQ5Yqf77yB5om+5YiwICcgKyBjb250YWN0cy52YWx1ZS5sZW5ndGggKyAnIOS4quiBiuWkqeS8muivnScpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCflvLrliLbliLfmlrDlpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Yi35paw5aSx6LSlOiAnICsgKGVycm9yLm1lc3NhZ2UgfHwgJ+acquefpemUmeivrycpKTsKICAgICAgfQogICAgfTsKCiAgICAvLyDliqDovb3miYDmnInnlKjmiLcKICAgIGNvbnN0IGxvYWRBbGxVc2VycyA9IGFzeW5jICgpID0+IHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zb2xlLmxvZygn5q2j5Zyo5Yqg6L295omA5pyJ55So5oi35YiX6KGoLi4uJyk7CgogICAgICAgIC8vIOehruS/neW3suiOt+WPluW9k+WJjeeUqOaIt+S/oeaBr+WPiuWFtuWFrOWPuElECiAgICAgICAgaWYgKCF1c2VySW5mby52YWx1ZSB8fCAhdXNlckluZm8udmFsdWUuY29tcGFueSkgewogICAgICAgICAgY29uc29sZS5lcnJvcign5peg5rOV5Yqg6L295ZCM5LqL5YiX6KGo77ya57y65bCR55So5oi35oiW5YWs5Y+45L+h5oGv44CCJyk7CiAgICAgICAgICAvLyDlsJ3or5Xph43mlrDojrflj5bnlKjmiLfkv6Hmga8KICAgICAgICAgIGNvbnN0IHVzZXJEYXRhID0gYXdhaXQgZmV0Y2hDdXJyZW50VXNlcigpOwogICAgICAgICAgaWYgKCF1c2VyRGF0YSB8fCAhdXNlckRhdGEuY29tcGFueSkgewogICAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+aXoOazleiOt+WPluaCqOeahOWFrOWPuOS/oeaBr++8jOaXoOazleWKoOi9veWQjOS6i+WIl+ihqOOAgicpOwogICAgICAgICAgICBhbGxDb2xsZWFndWVzLnZhbHVlID0gW107IC8vIOa4heepuuWIl+ihqAogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IHVzZXJJbmZvLnZhbHVlLmNvbXBhbnk7CiAgICAgICAgY29uc29sZS5sb2coJ+W8gOWni+iOt+WPluWFrOWPuOWQjOS6i+WIl+ihqO+8jOWFrOWPuElEOicsIGNvbXBhbnlJZCk7CgogICAgICAgIC8vIOS9v+eUqC9hcGkvYXV0aC9jb250YWN0cy/lubbkvKDlhaXlhazlj7hJROadpeiOt+WPluWQjOS6i+WIl+ihqAogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdCh7CiAgICAgICAgICB1cmw6ICcvYXBpL2F1dGgvY29udGFjdHMvJywKICAgICAgICAgIG1ldGhvZDogJ2dldCcsCiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgY29tcGFueTogY29tcGFueUlkCiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgY29uc29sZS5sb2coJ+WFrOWPuOWQjOS6i+WIl+ihqEFQSeWTjeW6lDonLCByZXNwb25zZSk7CiAgICAgICAgbGV0IHVzZXJzID0gW107CiAgICAgICAgLy8g5qC55o2u6YCa6K6v5b2V6aG16Z2i55qE57uP6aqM77yM5ZON5bqU5Y+v6IO95ZyoIHJlc3BvbnNlLmRhdGEg5LitCiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnN1Y2Nlc3MgJiYgQXJyYXkuaXNBcnJheShyZXNwb25zZS5kYXRhKSkgewogICAgICAgICAgdXNlcnMgPSByZXNwb25zZS5kYXRhOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UgJiYgQXJyYXkuaXNBcnJheShyZXNwb25zZS5kYXRhKSkgewogICAgICAgICAgdXNlcnMgPSByZXNwb25zZS5kYXRhOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UgJiYgQXJyYXkuaXNBcnJheShyZXNwb25zZSkpIHsKICAgICAgICAgIHVzZXJzID0gcmVzcG9uc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUud2Fybign6I635Y+W5ZCM5LqL5YiX6KGo55qE5ZON5bqU5qC85byP5pyq55+l5oiW5pWw5o2u5Li656m6OicsIHJlc3BvbnNlKTsKICAgICAgICB9CiAgICAgICAgaWYgKHVzZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGDmiJDlip/ojrflj5bliLAgJHt1c2Vycy5sZW5ndGh9IOS4quWQjOS6i2ApOwogICAgICAgICAgLy8g5ZCO56uv6L+U5Zue55qEY29udGFjdHPlj6/og73pnIDopoHmoLzlvI/ljJbku6XljLnphY1hbGxDb2xsZWFndWVz55qE5pyf5pyb57uT5p6ECiAgICAgICAgICBhbGxDb2xsZWFndWVzLnZhbHVlID0gdXNlcnMubWFwKHUgPT4gKHsKICAgICAgICAgICAgaWQ6IHUuaWQsCiAgICAgICAgICAgIHVzZXJuYW1lOiB1LnVzZXJuYW1lLAogICAgICAgICAgICBuYW1lOiB1Lm5hbWUsCiAgICAgICAgICAgIC8vIOebtOaOpeS9v+eUqOmAmuiur+W9leaOpeWPo+aPkOS+m+eahG5hbWXlrZfmrrUKICAgICAgICAgICAgZGVwYXJ0bWVudDogdS5kZXBhcnRtZW50LAogICAgICAgICAgICBhdmF0YXI6IHUuYXZhdGFyX3VybCB8fCB1LmF2YXRhcgogICAgICAgICAgfSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhbGxDb2xsZWFndWVzLnZhbHVlID0gW107IC8vIOWmguaenOayoeacieeUqOaIt++8jOWImea4heepugogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfliqDovb3lhazlj7jlkIzkuovliJfooajov4fnqIvkuK3lh7rplJk6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Yqg6L295ZCM5LqL5YiX6KGo5aSx6LSl77yM6K+356iN5ZCO6YeN6K+V44CCJyk7CiAgICAgICAgYWxsQ29sbGVhZ3Vlcy52YWx1ZSA9IFtdOyAvLyDlh7rplJnml7bmuIXnqbrliJfooagKICAgICAgfQogICAgfTsKCiAgICAvLyDojrflj5bpg6jpl6jliJfooagKICAgIGNvbnN0IGxvYWREZXBhcnRtZW50cyA9IGFzeW5jICgpID0+IHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zb2xlLmxvZygn5q2j5Zyo5Yqg6L296YOo6Zeo5YiX6KGoLi4uJyk7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KHsKICAgICAgICAgIHVybDogJy9hcGkvYXV0aC9kZXBhcnRtZW50cy8nLAogICAgICAgICAgbWV0aG9kOiAnZ2V0JwogICAgICAgIH0pOwogICAgICAgIGNvbnNvbGUubG9nKCfojrflj5bpg6jpl6jlk43lupQ6JywgcmVzcG9uc2UpOwoKICAgICAgICAvLyDlpITnkIblk43lupTmlbDmja4KICAgICAgICBsZXQgZGVwdHMgPSBbXTsKICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UucmVzdWx0cykgewogICAgICAgICAgZGVwdHMgPSByZXNwb25zZS5yZXN1bHRzOwogICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShyZXNwb25zZSkpIHsKICAgICAgICAgIGRlcHRzID0gcmVzcG9uc2U7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyZXNwb25zZS5kYXRhKSkgewogICAgICAgICAgICBkZXB0cyA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0cykgewogICAgICAgICAgICBkZXB0cyA9IHJlc3BvbnNlLmRhdGEucmVzdWx0czsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGRlcHRzICYmIGRlcHRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGDmiJDlip/ojrflj5bliLAke2RlcHRzLmxlbmd0aH3kuKrpg6jpl6hgKTsKICAgICAgICAgIGRlcGFydG1lbnRzLnZhbHVlID0gZGVwdHM7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPlumDqOmXqOWIl+ihqOWksei0pTonLCBlcnJvcik7CiAgICAgIH0KICAgIH07CgogICAgLy8g5pel56iL5LqL5Lu255u45YWzCiAgICBjb25zdCBoaWRkZW5DYWxlbmRhckV2ZW50cyA9IHJlZihbXSk7CgogICAgLy8g5aSE55CG5pel56iL5LqL5Lu25re75Yqg5oiQ5YqfCiAgICBjb25zdCBoYW5kbGVDYWxlbmRhckV2ZW50QWRkZWQgPSAoKSA9PiB7CiAgICAgIC8vIOWPr+S7peWcqOi/memHjOWBmuS4gOS6m+mineWkluWkhOeQhu+8jOS+i+WmgumAmuefpeWFtuS7luS6uuetiQogICAgfTsKCiAgICAvLyDlpITnkIbml6XnqIvkuovku7bpmpDol48KICAgIGNvbnN0IGhhbmRsZUNhbGVuZGFyRXZlbnRIaWRkZW4gPSBtZXNzYWdlSWQgPT4gewogICAgICBoaWRkZW5DYWxlbmRhckV2ZW50cy52YWx1ZS5wdXNoKG1lc3NhZ2VJZCk7CiAgICB9OwogICAgY29uc3Qgc2VsZWN0ZWREb2N1bWVudElkcyA9IHJlZihbXSk7IC8vIOW9k+WJjeS8muivneWFs+iBlOaWh+aho0lECgogICAgLy8gQUnmgLvnu5Pnm7jlhbMKICAgIGNvbnN0IHN1bW1hcnlEaWFsb2dWaXNpYmxlID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IHN1bW1hcnlEYXRlUmFuZ2UgPSByZWYoW25ldyBEYXRlKG5ldyBEYXRlKCkuc2V0RGF0ZShuZXcgRGF0ZSgpLmdldERhdGUoKSAtIDcpKSwgbmV3IERhdGUoKV0pOwogICAgY29uc3Qgc3VtbWFyeUNvbnRlbnQgPSByZWYoJycpOwogICAgY29uc3Qgc3VtbWFyeUxvYWRpbmcgPSByZWYoZmFsc2UpOwogICAgY29uc3QgcGlja2VyT3B0aW9ucyA9IHJlZih7CiAgICAgIHNob3J0Y3V0czogW3sKICAgICAgICB0ZXh0OiAn5pyA6L+R5LiA5ZGoJywKICAgICAgICBvbkNsaWNrKHBpY2tlcikgewogICAgICAgICAgY29uc3QgZW5kID0gbmV3IERhdGUoKTsKICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoKTsKICAgICAgICAgIHN0YXJ0LnNldFRpbWUoc3RhcnQuZ2V0VGltZSgpIC0gMzYwMCAqIDEwMDAgKiAyNCAqIDcpOwogICAgICAgICAgcGlja2VyLiRlbWl0KCdwaWNrJywgW3N0YXJ0LCBlbmRdKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiAn5pyA6L+R5LiA5Liq5pyIJywKICAgICAgICBvbkNsaWNrKHBpY2tlcikgewogICAgICAgICAgY29uc3QgZW5kID0gbmV3IERhdGUoKTsKICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoKTsKICAgICAgICAgIHN0YXJ0LnNldFRpbWUoc3RhcnQuZ2V0VGltZSgpIC0gMzYwMCAqIDEwMDAgKiAyNCAqIDMwKTsKICAgICAgICAgIHBpY2tlci4kZW1pdCgncGljaycsIFtzdGFydCwgZW5kXSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgdGV4dDogJ+acgOi/keS4ieS4quaciCcsCiAgICAgICAgb25DbGljayhwaWNrZXIpIHsKICAgICAgICAgIGNvbnN0IGVuZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICBzdGFydC5zZXRUaW1lKHN0YXJ0LmdldFRpbWUoKSAtIDM2MDAgKiAxMDAwICogMjQgKiA5MCk7CiAgICAgICAgICBwaWNrZXIuJGVtaXQoJ3BpY2snLCBbc3RhcnQsIGVuZF0pOwogICAgICAgIH0KICAgICAgfV0KICAgIH0pOwogICAgY29uc3Qgb3BlblN1bW1hcnlEaWFsb2cgPSAoKSA9PiB7CiAgICAgIC8vIOmHjee9ruWGheWuue+8jOS9huS/neeVmeaXpeacn+iMg+WbtAogICAgICBzdW1tYXJ5Q29udGVudC52YWx1ZSA9ICcnOwogICAgICBzdW1tYXJ5RGlhbG9nVmlzaWJsZS52YWx1ZSA9IHRydWU7CiAgICB9OwogICAgY29uc3QgaGFuZGxlQ2xvc2VTdW1tYXJ5RGlhbG9nID0gKCkgPT4gewogICAgICBzdW1tYXJ5RGlhbG9nVmlzaWJsZS52YWx1ZSA9IGZhbHNlOwogICAgfTsKICAgIGNvbnN0IGhhbmRsZVN1bW1hcml6ZSA9IGFzeW5jICgpID0+IHsKICAgICAgaWYgKCFzZWxlY3RlZENvbnRhY3QudmFsdWUpIHsKICAgICAgICBFbE1lc3NhZ2Uud2FybmluZygn6K+35YWI6YCJ5oup5LiA5Liq6IGK5aSpJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICghc3VtbWFyeURhdGVSYW5nZS52YWx1ZSB8fCBzdW1tYXJ5RGF0ZVJhbmdlLnZhbHVlLmxlbmd0aCAhPT0gMikgewogICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfor7fpgInmi6nkuIDkuKrmnInmlYjnmoTml7bpl7TojIPlm7QnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgc3VtbWFyeUxvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICBzdW1tYXJ5Q29udGVudC52YWx1ZSA9ICcnOyAvLyBSZXNldCBiZWZvcmUgZmV0Y2hpbmcKCiAgICAgIGNvbnN0IFtzdGFydERhdGUsIGVuZERhdGVdID0gc3VtbWFyeURhdGVSYW5nZS52YWx1ZTsKICAgICAgdHJ5IHsKICAgICAgICAvLyAnc3VtbWFyaXplQ2hhdCcgcmV0dXJucyB0aGUgZnVsbCBheGlvcyByZXNwb25zZQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc3VtbWFyaXplQ2hhdChzZWxlY3RlZENvbnRhY3QudmFsdWUsIHN0YXJ0RGF0ZS50b0lTT1N0cmluZygpLCBlbmREYXRlLnRvSVNPU3RyaW5nKCkpOwoKICAgICAgICAvLyBUaGUgYWN0dWFsIGRhdGEgZnJvbSB0aGUgYmFja2VuZCBpcyBpbiByZXNwb25zZS5kYXRhCiAgICAgICAgY29uc3Qgc3VtbWFyeSA9IHJlc3BvbnNlLmRhdGEuc3VtbWFyeTsKICAgICAgICBpZiAoc3VtbWFyeSkgewogICAgICAgICAgLy8gSWYgd2UgaGF2ZSBhIHN1bW1hcnksIGRpc3BsYXkgaXQKICAgICAgICAgIHN1bW1hcnlDb250ZW50LnZhbHVlID0gc3VtbWFyeTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gSWYgdGhlIHN1bW1hcnkgaXMgZW1wdHkgb3Igbm90IHByZXNlbnQsIGRpc3BsYXkgYSBjbGVhciBtZXNzYWdlCiAgICAgICAgICBzdW1tYXJ5Q29udGVudC52YWx1ZSA9ICflnKjpgInlrprml7bpl7TojIPlm7TlhoXmsqHmnInlj6/mgLvnu5PnmoTmtojmga/vvIzmiJZBSeacquiDveeUn+aIkOaRmOimgeOAgic7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1N1bW1hcml6YXRpb24gZXJyb3I6JywgZXJyb3IpOwogICAgICAgIHN1bW1hcnlDb250ZW50LnZhbHVlID0gJ+eUn+aIkOaRmOimgeaXtumBh+WIsOmUmeivr++8jOivt+ajgOafpeWQjuWPsOaXpeW/l+aIlueojeWQjuWGjeivleOAgic7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfnlJ/miJDmkZjopoHlpLHotKXvvIzor7fnqI3lkI7lho3or5UnKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBzdW1tYXJ5TG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICB9CiAgICB9OwoKICAgIC8vIOabv+aNouWbvueJh+mihOiniOaWueazlQogICAgY29uc3QgZXhwYW5kZWRJbWFnZSA9IHJlZihudWxsKTsKCiAgICAvLyDliIfmjaLlm77niYfmlL7lpKfmmL7npLoKICAgIGNvbnN0IHRvZ2dsZUltYWdlRXhwYW5kID0gaW1hZ2VVcmwgPT4gewogICAgICBleHBhbmRlZEltYWdlLnZhbHVlID0gaW1hZ2VVcmw7CiAgICB9OwogICAgY29uc3QgZ2V0RmlsZU5hbWUgPSBmdWxsTmFtZSA9PiB7CiAgICAgIGlmICghZnVsbE5hbWUpIHJldHVybiAnJzsKICAgICAgY29uc3QgbGFzdERvdCA9IGZ1bGxOYW1lLmxhc3RJbmRleE9mKCcuJyk7CiAgICAgIGlmIChsYXN0RG90ID09PSAtMSB8fCBsYXN0RG90ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIGZ1bGxOYW1lOwogICAgICB9CiAgICAgIHJldHVybiBmdWxsTmFtZS5zdWJzdHJpbmcoMCwgbGFzdERvdCk7CiAgICB9OwogICAgY29uc3QgZ2V0RmlsZUV4dGVuc2lvbiA9IGZ1bGxOYW1lID0+IHsKICAgICAgaWYgKCFmdWxsTmFtZSkgcmV0dXJuICcnOwogICAgICBjb25zdCBsYXN0RG90ID0gZnVsbE5hbWUubGFzdEluZGV4T2YoJy4nKTsKICAgICAgaWYgKGxhc3REb3QgPT09IC0xIHx8IGxhc3REb3QgPT09IDAgfHwgbGFzdERvdCA+PSBmdWxsTmFtZS5sZW5ndGggLSAxKSB7CiAgICAgICAgcmV0dXJuICcnOwogICAgICB9CiAgICAgIHJldHVybiBmdWxsTmFtZS5zdWJzdHJpbmcobGFzdERvdCk7IC8vIGluY2x1ZGVzIHRoZSBkb3QKICAgIH07CiAgICByZXR1cm4gewogICAgICBzZWFyY2hRdWVyeSwKICAgICAgYWN0aXZlVGFiLAogICAgICBzZWxlY3RlZENvbnRhY3QsCiAgICAgIHRhYnMsCiAgICAgIGNvbnRhY3RzLAogICAgICBjdXJyZW50Q29udGFjdCwKICAgICAgZmlsdGVyZWRDb250YWN0cywKICAgICAgbWVzc2FnZXMsCiAgICAgIG1lc3NhZ2VJbnB1dCwKICAgICAgbWVzc2FnZUNvbnRhaW5lciwKICAgICAgZmlsZUlucHV0LAogICAgICBpbWFnZUlucHV0LAogICAgICBjdXJyZW50VXNlciwKICAgICAgdXNlckluZm8sCiAgICAgIHVzZXJJZCwKICAgICAga25vd2xlZGdlRGlhbG9nVmlzaWJsZSwKICAgICAga25vd2xlZGdlTG9hZGluZywKICAgICAga25vd2xlZGdlTGlzdCwKICAgICAgc2Vzc2lvbnNMb2FkaW5nLAogICAgICBtZXNzYWdlc0xvYWRpbmcsCiAgICAgIC8vIOWbvuaghwogICAgICBTZWFyY2gsCiAgICAgIFBob25lLAogICAgICBWaWRlb0NhbWVyYSwKICAgICAgSW5mb0ZpbGxlZCwKICAgICAgRG9jdW1lbnQsCiAgICAgIFBpY3R1cmVGaWxsZWQsCiAgICAgIEZvbGRlck9wZW5lZCwKICAgICAgTWljcm9waG9uZSwKICAgICAgUG9zaXRpb24sCiAgICAgIENoYXREb3RTcXVhcmUsCiAgICAgIFJlYWRpbmcsCiAgICAgIFVzZXJGaWxsZWQsCiAgICAgIENoYXRMaW5lU3F1YXJlLAogICAgICBSZWZyZXNoLAogICAgICBNb3JlRmlsbGVkLAogICAgICAvLyDmlrnms5UKICAgICAgc2VuZE1lc3NhZ2UsCiAgICAgIGdldFN0YXR1c1RleHQsCiAgICAgIHNlbGVjdENvbnRhY3QsCiAgICAgIG9wZW5GaWxlVXBsb2FkLAogICAgICBvcGVuSW1hZ2VVcGxvYWQsCiAgICAgIGhhbmRsZUZpbGVVcGxvYWQsCiAgICAgIGhhbmRsZUltYWdlVXBsb2FkLAogICAgICBvcGVuS25vd2xlZGdlRGlhbG9nLAogICAgICBzZWxlY3RLbm93bGVkZ2UsCiAgICAgIHNoYXJlS25vd2xlZGdlLAogICAgICBkb3dubG9hZEZpbGUsCiAgICAgIHZpZXdLbm93bGVkZ2UsCiAgICAgIGdldFNlbmRlckNvbG9yLAogICAgICBnZXRTZW5kZXJJbml0aWFsLAogICAgICBmb3JtYXRNZXNzYWdlVGltZSwKICAgICAgZm9ybWF0RGF0ZSwKICAgICAgZm9ybWF0RmlsZVNpemUsCiAgICAgIHJlZnJlc2hDaGF0U2Vzc2lvbnMsCiAgICAgIGZvcmNlUmVmcmVzaCwKICAgICAgZ3JvdXBlZFVzZXJzQnlEZXBhcnRtZW50LAogICAgICBnZXRBY3RpdmVDb250YWN0cywKICAgICAgbG9hZEFsbFVzZXJzLAogICAgICBsb2FkRGVwYXJ0bWVudHMsCiAgICAgIGhpZGRlbkNhbGVuZGFyRXZlbnRzLAogICAgICBoYW5kbGVDYWxlbmRhckV2ZW50QWRkZWQsCiAgICAgIGhhbmRsZUNhbGVuZGFyRXZlbnRIaWRkZW4sCiAgICAgIHNlbGVjdGVkRG9jdW1lbnRJZHMsCiAgICAgIGZpbGVVcGxvYWRpbmcsCiAgICAgIGltYWdlVXBsb2FkaW5nLAogICAgICBzdW1tYXJ5RGlhbG9nVmlzaWJsZSwKICAgICAgc3VtbWFyeURhdGVSYW5nZSwKICAgICAgc3VtbWFyeUNvbnRlbnQsCiAgICAgIHN1bW1hcnlMb2FkaW5nLAogICAgICBwaWNrZXJPcHRpb25zLAogICAgICBvcGVuU3VtbWFyeURpYWxvZywKICAgICAgaGFuZGxlQ2xvc2VTdW1tYXJ5RGlhbG9nLAogICAgICBoYW5kbGVTdW1tYXJpemUsCiAgICAgIGV4cGFuZGVkSW1hZ2UsCiAgICAgIHRvZ2dsZUltYWdlRXhwYW5kLAogICAgICBnZXRGaWxlTmFtZSwKICAgICAgZ2V0RmlsZUV4dGVuc2lvbgogICAgfTsKICB9Cn07"},{"version":3,"names":["ref","computed","nextTick","onMounted","onBeforeUnmount","watch","useStore","ElMessage","ElMessageBox","Search","Phone","VideoCamera","InfoFilled","Document","PictureFilled","FolderOpened","Microphone","Position","ChatDotSquare","Reading","UserFilled","ChatLineSquare","Refresh","MoreFilled","getChatSessions","getChatSession","sendTextMessage","sendImageMessage","sendKnowledgeMessage","downloadMessageFile","sendFileMessage","summarizeChat","getKnowledgeList","useRoute","request","ChatCalendarEvent","aiChatWithDocuments","name","components","setup","store","currentUser","getters","user","userInfo","searchQuery","activeTab","selectedContact","messageInput","messageContainer","fileInput","imageInput","messages","sessionsLoading","messagesLoading","chatSessions","currentChatId","knowledgeDialogVisible","knowledgeLoading","knowledgeList","selectedKnowledge","tabs","contacts","allColleagues","departments","currentContact","value","find","c","id","userId","_userInfo$value","filteredContacts","filter","contact","toLowerCase","includes","getActiveContacts","isGroup","groupedUsersByDepartment","usersMap","Map","forEach","set","colleague","has","username","trim","initial","avatar","color","getRandomColor","status","lastMessage","lastTime","unread","department","departmentMap","map","dept","groupedUsers","Array","from","values","departmentName","get","push","route","refreshInterval","clearInterval","userData","fetchCurrentUser","error","console","log","loadAllUsers","loadDepartments","loadChatSessions","sessionId","query","session","foundContact","parseInt","loadChatMessages","setInterval","scrollToBottom","message","token","localStorage","getItem","warn","warning","response","url","method","data","Error","setItem","JSON","stringify","isBackgroundRefresh","success","isArray","results","length","otherParticipant","participants","p","is_group","title","avatar_url","last_message","content","formatMessageTime","created_at","updated_at","unread_count","startsWith","process","env","VUE_APP_BASE_API","first_name","last_name","sort","a","b","chatId","messageData","sessionData","possibleMessageFields","field","sender","some","tempContact","unshift","res","params","chat","selectedDocumentIds","doc","e","errorMessage","refreshChatSessions","scrollTop","scrollHeight","selectContact","contactId","replace","existingChat","participant_ids","newSession","Date","sendMessage","tempMessage","now","message_type","toISOString","is_temp","messageCopy","aiMsg","chat_id","document_ids","aiContent","tempIndex","findIndex","m","splice","file","savedMessage","openFileUpload","click","openImageUpload","fileUploading","imageUploading","handleFileUpload","event","target","files","formData","FormData","append","headers","docRes","handleImageUpload","openKnowledgeDialog","loadKnowledgeList","selectKnowledge","row","shareKnowledge","knowledge","downloadFile","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","file_name","body","appendChild","removeChild","viewKnowledge","knowledge_detail","alert","description","dangerouslyUseHTMLString","confirmButtonText","getSenderColor","getSenderInitial","colors","index","timestamp","date","diff","hours","getHours","toString","padStart","minutes","getMinutes","days","getDay","getMonth","getDate","formatDate","getFullYear","formatFileSize","sizeInKB","toFixed","getStatusText","statusMap","forceRefresh","info","company","companyId","users","u","depts","hiddenCalendarEvents","handleCalendarEventAdded","handleCalendarEventHidden","messageId","summaryDialogVisible","summaryDateRange","setDate","summaryContent","summaryLoading","pickerOptions","shortcuts","text","onClick","picker","end","start","setTime","getTime","$emit","openSummaryDialog","handleCloseSummaryDialog","handleSummarize","startDate","endDate","summary","expandedImage","toggleImageExpand","imageUrl","getFileName","fullName","lastDot","lastIndexOf","substring","getFileExtension"],"sources":["C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\chat\\Index.vue"],"sourcesContent":["<template>\n  <div class=\"chat-container\">\n        <el-card class=\"chat-card\" :body-style=\"{backgroundColor: 'transparent', padding: 0}\">\n          <div class=\"chat-header-actions\" v-if=\"sessionsLoading\">\n            <el-alert\n              title=\"...\"\n              type=\"info\"\n              :closable=\"false\"\n              show-icon\n            />\n          </div>\n          <div class=\"chat-layout\">\n            <!--  -->\n            <div class=\"chat-sidebar\">\n              <!--  -->\n              <div class=\"search-box\">\n                <div class=\"search-header\">\n                  <el-input \n                    v-model=\"searchQuery\" \n                    placeholder=\"...\"\n                    clearable\n                    :prefix-icon=\"Search\"\n                  ></el-input>\n                  <el-button circle size=\"small\" @click=\"refreshChatSessions\" title=\"\">\n                    <el-icon><Refresh /></el-icon>\n                  </el-button>\n                </div>\n              </div>\n              \n              <!--  -->\n              <div class=\"chat-tabs\">\n                <div \n                  v-for=\"(tab, index) in tabs\" \n                  :key=\"index\"\n                  class=\"chat-tab\"\n                  :class=\"{'active': activeTab === index}\"\n                  @click=\"activeTab = index\"\n                >\n                  {{ tab }}\n                </div>\n              </div>\n              \n              <!--  -->\n              <div class=\"contacts-list\">\n                <!--  () -->\n                <template v-if=\"activeTab === 1\">\n                  <div v-if=\"!sessionsLoading && Object.keys(groupedUsersByDepartment).length > 0\">\n                    <div v-for=\"(departmentUsers, deptName) in groupedUsersByDepartment\" :key=\"deptName\" class=\"department-group\">\n                      <div class=\"department-header\">{{ deptName }}</div>\n                      <div \n                        v-for=\"contact in departmentUsers\" \n                        :key=\"contact.id\"\n                        class=\"contact-item\"\n                        :class=\"{'active': selectedContact === contact.id}\"\n                        @click=\"selectContact(contact)\"\n                      >\n                        <div class=\"contact-avatar\">\n                          <div \n                            v-if=\"!contact.avatar && !contact.avatar_url\" \n                            class=\"avatar\" \n                            :style=\"{backgroundColor: contact.color}\"\n                          >\n                            <span class=\"avatar-initial\">{{ contact.initial }}</span>\n                          </div>\n                          <img v-else :src=\"contact.avatar_url || contact.avatar\" alt=\"avatar\" class=\"avatar\" />\n                          <div \n                            class=\"contact-status\" \n                            :class=\"'status-' + contact.status\"\n                          ></div>\n                        </div>\n                        <div class=\"contact-info\">\n                          <div class=\"contact-name\">\n                            <span>{{ contact.name }}</span>\n                            <span class=\"time\">{{ contact.lastTime }}</span>\n                          </div>\n                          <div class=\"contact-message\">\n                            <span>{{ contact.lastMessage }}</span>\n                            <el-badge \n                              v-if=\"contact.unread\" \n                              :value=\"contact.unread\" \n                              class=\"message-badge\"\n                            />\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div v-else-if=\"!sessionsLoading\" class=\"loading-container\">\n                    <el-skeleton :rows=\"5\" animated />\n                  </div>\n                </template>\n                \n                <!--  -->\n                <template v-else>\n                  <div \n                    v-for=\"contact in filteredContacts\" \n                    :key=\"contact.id\"\n                    class=\"contact-item\"\n                    :class=\"{'active': selectedContact === contact.id}\"\n                    @click=\"selectContact(contact)\"\n                  >\n                    <div class=\"contact-avatar\">\n                      <div \n                        v-if=\"!contact.avatar && !contact.avatar_url\" \n                        class=\"avatar\" \n                        :style=\"{backgroundColor: contact.color}\"\n                      >\n                        <span class=\"avatar-initial\">{{ contact.initial }}</span>\n                      </div>\n                      <img v-else :src=\"contact.avatar_url || contact.avatar\" alt=\"avatar\" class=\"avatar\" />\n                      <div \n                        class=\"contact-status\" \n                        :class=\"'status-' + contact.status\"\n                      ></div>\n                    </div>\n                    <div class=\"contact-info\">\n                      <div class=\"contact-name\">\n                        <span>{{ contact.name }}</span>\n                        <span class=\"time\">{{ contact.lastTime }}</span>\n                      </div>\n                      <div class=\"contact-message\">\n                        <span>{{ contact.lastMessage }}</span>\n                        <el-badge \n                          v-if=\"contact.unread\" \n                          :value=\"contact.unread\" \n                          class=\"message-badge\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <!--  -->\n                  <div v-if=\"!sessionsLoading && filteredContacts.length === 0\" class=\"empty-contacts\">\n                    <el-empty \n                      description=\"\" \n                      :image-size=\"100\"\n                    >\n                      <template #image>\n                        <el-icon :size=\"64\" class=\"empty-icon\"><UserFilled /></el-icon>\n                      </template>\n                    </el-empty>\n                  </div>\n                </template>\n\n                <!--  -->\n                <div v-if=\"sessionsLoading\" class=\"loading-container\">\n                  <el-skeleton :rows=\"5\" animated />\n                </div>\n              </div>\n            </div>\n            \n            <!--  -->\n            <div class=\"chat-content\">\n              <!--  -->\n              <div class=\"chat-header\" v-if=\"selectedContact !== null\">\n                <div class=\"contact-avatar\">\n                  <div \n                    v-if=\"!currentContact.avatar && !currentContact.avatar_url\" \n                    class=\"avatar\" \n                    :style=\"{backgroundColor: currentContact.color}\"\n                  >\n                    <span class=\"avatar-initial\">{{ currentContact.initial || '?' }}</span>\n                  </div>\n                  <img \n                    v-else \n                    :src=\"currentContact.avatar_url || currentContact.avatar\" \n                    alt=\"avatar\" \n                    class=\"avatar\" \n                  />\n                  <div \n                    class=\"contact-status\" \n                    :class=\"'status-' + (currentContact.status || 'online')\"\n                  ></div>\n                </div>\n                <div class=\"contact-info\">\n              <h6>{{ currentContact.name || '' }}</h6>\n              <p>{{ getStatusText(currentContact.status || 'online') }}</p>\n                </div>\n                <div class=\"chat-actions\">\n                  <el-tooltip content=\"AI\" placement=\"bottom\">\n                    <el-button @click=\"openSummaryDialog\" circle>\n                      <el-icon><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-robot\" viewBox=\"0 0 16 16\">\n                        <path d=\"M6 12.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5M3 8.062C3 6.76 4.235 5.765 5.53 5.886a26.6 26.6 0 0 0 4.94 0C11.765 5.765 13 6.76 13 8.062v1.157a.93.93 0 0 1-.765.935c-.845.147-2.34.346-4.235.346s-3.39-.2-4.235-.346A.93.93 0 0 1 3 9.22z\"/>\n                        <path d=\"M4 1.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5M12 1a2 2 0 0 1 2 2v10.5a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2zM4 0a1 1 0 0 0-1 1v10.5a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1z\"/>\n                      </svg></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                </div>\n              </div>\n              \n              <!--  -->\n              <div class=\"chat-messages\" v-if=\"selectedContact !== null\" ref=\"messageContainer\">\n                <!--  -->\n                <template v-if=\"messages.length > 0\">\n                  <div \n                    v-for=\"(message, index) in messages\" \n                    :key=\"message.id || index\"\n                    class=\"message\"\n                    :class=\"message.sender.id === userId ? 'message-sent' : 'message-received'\"\n                  >\n                    <div class=\"message-container\">\n                      <div v-if=\"message.sender.id !== userId\" class=\"message-avatar\">\n                        <div \n                          v-if=\"!message.sender.avatar && !message.sender.avatar_url\" \n                          class=\"avatar small\" \n                          :style=\"{backgroundColor: getSenderColor(message.sender)}\"\n                        >\n                          <span class=\"avatar-initial\">{{ getSenderInitial(message.sender) }}</span>\n                        </div>\n                        <img \n                          v-else \n                          :src=\"message.sender.avatar_url || message.sender.avatar\" \n                          alt=\"avatar\" \n                          class=\"avatar small\" \n                        />\n                      </div>\n                      <div class=\"message-content-wrapper\">\n                        <div \n                          class=\"message-content\"\n                          :class=\"message.sender.id === userId ? 'sent' : 'received'\"\n                        >\n                          <div v-if=\"message.message_type === 'text'\" class=\"text-card\">\n                            <div class=\"text-card-inner\">\n                              {{ message.content }}\n                            </div>\n                          </div>\n                      \n                          <div v-else-if=\"message.message_type === 'image'\" class=\"image-card\">\n                            <div class=\"image-card-inner\">\n                              <div class=\"image-preview\" @click=\"toggleImageExpand(message.file)\">\n                                <img :src=\"message.file\" alt=\"image\" />\n                              </div>\n                            </div>\n                          </div>\n                      \n                          <div v-else-if=\"message.message_type === 'file'\" class=\"file-card\" @click=\"downloadFile(message)\">\n                            <div class=\"file-card-inner\">\n                              <div class=\"file-icon\">\n                                <el-icon><Document /></el-icon>\n                              </div>\n                              <div class=\"file-info\">\n                                <div class=\"file-name\">\n                                  <span class=\"file-name-main\">{{ getFileName(message.file_name) }}</span><!--\n                                --><span class=\"file-name-ext\">{{ getFileExtension(message.file_name) }}</span>\n                                </div>\n                                <div class=\"file-meta\">\n                                  <span class=\"file-size\">{{ formatFileSize(message.file_size) }}</span>\n                                  <span class=\"file-download-hint\"></span>\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                      \n                          <div v-else-if=\"message.message_type === 'knowledge'\" class=\"knowledge-card\" @click=\"viewKnowledge(message)\">\n                            <div class=\"knowledge-card-inner\">\n                              <div class=\"knowledge-icon\">\n                                <el-icon><Reading /></el-icon>\n                              </div>\n                              <div class=\"knowledge-content\">\n                                <div class=\"knowledge-title\">{{ message.knowledge_detail.title }}</div>\n                                <div class=\"knowledge-desc\">{{ message.knowledge_detail.description }}</div>\n                                <div class=\"knowledge-footer\">\n                                  <span class=\"knowledge-type\">{{ message.knowledge_detail.file_type }}</span>\n                                  <span class=\"knowledge-view\"></span>\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                        <div class=\"message-time\">{{ formatMessageTime(message.created_at) }}</div>\n                        \n                        <!--  -->\n                        <ChatCalendarEvent \n                          v-if=\"message.calendar_data && !hiddenCalendarEvents.includes(message.id)\"\n                          :messageId=\"message.id\"\n                          :eventData=\"message.calendar_data\"\n                          @calendar-event-added=\"handleCalendarEventAdded\"\n                          @calendar-event-hidden=\"handleCalendarEventHidden(message.id)\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                </template>\n                \n                <!--  -->\n                <template v-else-if=\"!messagesLoading\">\n                  <div class=\"empty-messages\">\n                    <el-empty description=\"\">\n                      <template #image>\n                        <el-icon :size=\"64\" class=\"empty-icon\"><ChatLineSquare /></el-icon>\n                      </template>\n                      <p></p>\n                    </el-empty>\n                  </div>\n                </template>\n                \n                <!--  -->\n                <template v-else>\n                  <div class=\"loading-messages\">\n                    <el-skeleton :rows=\"3\" animated />\n                    <el-skeleton style=\"margin-top: 20px\" :rows=\"2\" animated />\n                    <div style=\"text-align: right; margin-top: 20px\">\n                      <el-skeleton :rows=\"2\" animated />\n                    </div>\n                  </div>\n                </template>\n              </div>\n              \n              <!--  -->\n              <div class=\"chat-input\" v-if=\"selectedContact !== null\">\n                <div class=\"chat-tools\">\n                  <el-tooltip content=\"\" placement=\"top\">\n                    <el-button circle @click=\"openImageUpload\" :loading=\"imageUploading\">\n                      <el-icon><PictureFilled /></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                  <el-tooltip content=\"\" placement=\"top\">\n                    <el-button circle @click=\"openFileUpload\" :loading=\"fileUploading\">\n                      <el-icon><FolderOpened /></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                  <!-- <el-tooltip content=\"\" placement=\"top\">\n                    <el-button circle @click=\"openKnowledgeDialog\">\n                      <el-icon><Reading /></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                  <el-tooltip content=\"\" placement=\"top\">\n                    <el-button circle>\n                      <el-icon><Microphone /></el-icon>\n                    </el-button>\n                  </el-tooltip> -->\n                </div>\n                <div class=\"input-area\">\n                  <el-input\n                    v-model=\"messageInput\"\n                    type=\"textarea\"\n                    :rows=\"3\"\n                    placeholder=\"...\"\n                    resize=\"none\"\n                    @keyup.enter.prevent=\"sendMessage\"\n                  ></el-input>\n                </div>\n                <div class=\"send-button\">\n                  <el-button type=\"primary\" @click=\"sendMessage\">\n                    <el-icon><Position /></el-icon>\n                    \n                  </el-button>\n                </div>\n              </div>\n              \n              <!--  -->\n              <div class=\"empty-chat\" v-if=\"selectedContact === null\">\n                <div class=\"empty-illustration\">\n                  <el-icon :size=\"64\"><ChatDotSquare /></el-icon>\n                </div>\n                <h4></h4>\n                <p></p>\n              </div>\n            </div>\n          </div>\n        </el-card>\n  \n  <!--  -->\n  <input \n    type=\"file\" \n    ref=\"fileInput\" \n    style=\"display: none\" \n    @change=\"handleFileUpload\" \n  />\n  \n  <!--  -->\n  <input \n    type=\"file\" \n    ref=\"imageInput\" \n    style=\"display: none\" \n    accept=\"image/*\" \n    @change=\"handleImageUpload\" \n  />\n  \n  <!--  -->\n  <el-dialog\n    v-model=\"knowledgeDialogVisible\"\n    title=\"\"\n    width=\"50%\"\n  >\n    <el-table\n      v-loading=\"knowledgeLoading\"\n      :data=\"knowledgeList\"\n      style=\"width: 100%\"\n      @row-click=\"selectKnowledge\"\n    >\n      <el-table-column prop=\"title\" label=\"\"></el-table-column>\n      <el-table-column prop=\"file_type\" label=\"\">\n        <template #default=\"scope\">\n          <el-tag>{{ scope.row.file_type }}</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"created_at\" label=\"\">\n        <template #default=\"scope\">\n          {{ formatDate(scope.row.created_at) }}\n        </template>\n      </el-table-column>\n      <el-table-column label=\"\">\n        <template #default=\"scope\">\n          <el-button type=\"primary\" size=\"small\" @click.stop=\"shareKnowledge(scope.row)\">\n            \n          </el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"knowledgeDialogVisible = false\"></el-button>\n      </span>\n    </template>\n  </el-dialog>\n\n  <!-- AI -->\n  <el-dialog\n    v-model=\"summaryDialogVisible\"\n    title=\"AI \"\n    width=\"50%\"\n    @close=\"handleCloseSummaryDialog\"\n    top=\"5vh\"\n  >\n    <div v-loading=\"summaryLoading\" element-loading-text=\"...\">\n      <el-form label-position=\"top\" style=\"margin-bottom: 20px;\">\n        <el-form-item label=\"\">\n          <el-date-picker\n            v-model=\"summaryDateRange\"\n            type=\"datetimerange\"\n            range-separator=\"\"\n            start-placeholder=\"\"\n            end-placeholder=\"\"\n            :picker-options=\"pickerOptions\"\n            style=\"width: 100%;\"\n          />\n        </el-form-item>\n      </el-form>\n      <div v-if=\"summaryContent\" class=\"summary-content-wrapper\">\n        <el-alert title=\"AI \" type=\"info\" :closable=\"false\" show-icon class=\"summary-title\"></el-alert>\n        <div class=\"summary-content\">\n          <p style=\"white-space: pre-wrap;\">{{ summaryContent }}</p>\n        </div>\n      </div>\n       <el-empty v-if=\"!summaryContent && !summaryLoading\" description=\"\" />\n    </div>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"handleCloseSummaryDialog\"></el-button>\n        <el-button type=\"primary\" @click=\"handleSummarize\" :disabled=\"summaryLoading\">\n          {{ summaryLoading ? '...' : '' }}\n        </el-button>\n      </span>\n    </template>\n  </el-dialog>\n\n  <!--  -->\n  <div class=\"fullscreen-image-preview\" v-if=\"expandedImage\" @click=\"expandedImage = null\">\n    <img :src=\"expandedImage\" alt=\"\" class=\"fullscreen-preview-image\" />\n  </div>\n  \n  <!--  -->\n  <!-- <el-dialog\n    v-model=\"imagePreviewVisible\"\n    :title=\"false\"\n    width=\"80%\"\n    center\n    append-to-body\n    :show-close=\"true\"\n    class=\"image-preview-dialog\"\n  >\n    <img :src=\"previewImageUrl\" alt=\"\" class=\"preview-image\" />\n  </el-dialog> -->\n  </div>\n</template>\n\n<script>\nimport { ref, computed, nextTick, onMounted, onBeforeUnmount, watch } from 'vue'\nimport { useStore } from 'vuex'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport { \n  Search, Phone, VideoCamera, InfoFilled, Document, PictureFilled, \n  FolderOpened, Microphone, Position, ChatDotSquare, Reading, UserFilled, ChatLineSquare,\n  Refresh, MoreFilled\n} from '@element-plus/icons-vue'\nimport { \n  getChatSessions, \n  getChatSession, \n  sendTextMessage, \n  sendImageMessage,\n  sendKnowledgeMessage,\n  downloadMessageFile,\n  sendFileMessage,\n  summarizeChat,\n} from '@/api/chat'\nimport { getKnowledgeList } from '@/api/knowledge'\nimport { useRoute } from 'vue-router'\nimport request from '@/utils/request'\nimport ChatCalendarEvent from '@/components/ChatCalendarEvent.vue'\nimport { aiChatWithDocuments } from '@/api/ai'\n\nexport default {\n  name: 'Chat',\n  components: {\n    ChatCalendarEvent\n  },\n  setup() {\n    const store = useStore()\n    const currentUser = computed(() => store.getters.user)\n    \n    // \n    const userInfo = ref(null)\n    \n    const searchQuery = ref('')\n    const activeTab = ref(0)\n    const selectedContact = ref(null)\n    const messageInput = ref('')\n    const messageContainer = ref(null)\n    const fileInput = ref(null)\n    const imageInput = ref(null)\n    const messages = ref([])\n    const sessionsLoading = ref(false)\n    const messagesLoading = ref(false)\n    const chatSessions = ref([])\n    const currentChatId = ref(null)\n    \n    // \n    const knowledgeDialogVisible = ref(false)\n    const knowledgeLoading = ref(false)\n    const knowledgeList = ref([])\n    const selectedKnowledge = ref(null)\n    \n    // \n    const tabs = ref(['', ''])\n    \n    // \n    const contacts = ref([])\n    // \n    const allColleagues = ref([])\n    \n    // \n    const departments = ref([])\n    \n    // \n    const currentContact = computed(() => {\n      if (selectedContact.value === null) return {}\n      return contacts.value.find(c => c.id === selectedContact.value) || {}\n    })\n    \n    // IDnull\n    const userId = computed(() => {\n      return userInfo.value?.id || null\n    })\n    \n    // \n    const filteredContacts = computed(() => {\n      if (!searchQuery.value) return contacts.value\n      return contacts.value.filter(contact =>\n        contact.name.toLowerCase().includes(searchQuery.value.toLowerCase())\n      )\n    })\n    \n    // \n    const getActiveContacts = computed(() => {\n      if (activeTab.value === 0) {\n        return filteredContacts.value\n      } else if (activeTab.value === 1) {\n        return filteredContacts.value.filter(contact => !contact.isGroup)\n      }\n      return filteredContacts.value\n    })\n    \n    \n    // \n    const groupedUsersByDepartment = computed(() => {\n      // \n      const usersMap = new Map();\n      \n      // \n      filteredContacts.value\n        .filter(contact => !contact.isGroup)\n        .forEach(contact => {\n          // \n          if (userInfo.value && contact.userId === userInfo.value.id) {\n            return;\n          }\n          // ID\n          usersMap.set(contact.userId || contact.id, contact);\n        });\n      \n      // \n      allColleagues.value.forEach(colleague => {\n        // \n        if (userInfo.value && colleague.id === userInfo.value.id) {\n          return;\n        }\n        \n        // \n        if (!usersMap.has(colleague.id)) {\n          // \n          const contact = {\n            id: 'user_' + colleague.id, // ID\n            userId: colleague.id,\n            name: (colleague.name || colleague.username || '').trim(),\n            initial: ((colleague.name || colleague.username || '')[0]),\n            avatar: colleague.avatar || '',\n            color: getRandomColor(colleague.id),\n            status: 'online',\n            lastMessage: '',\n            lastTime: '',\n            unread: 0,\n            isGroup: false,\n            department: colleague.department || ''\n          };\n          usersMap.set(colleague.id, contact);\n        }\n      });\n      \n      // ID\n      const departmentMap = new Map(departments.value.map(dept => [dept.id, dept.name]))\n      \n      // \n      const groupedUsers = {};\n      \n      // MapArray\n      Array.from(usersMap.values()).forEach(user => {\n        const departmentName = departmentMap.get(user.department) || '';\n        if (!groupedUsers[departmentName]) {\n          groupedUsers[departmentName] = [];\n        }\n        groupedUsers[departmentName].push(user);\n      });\n      \n      return groupedUsers;\n    })\n    \n    // \n    const route = useRoute()\n    \n    // refreshInterval\n    let refreshInterval = null\n    \n    // \n    onBeforeUnmount(() => {\n      if (refreshInterval) {\n        clearInterval(refreshInterval)\n      }\n    })\n    \n    // \n    onMounted(async () => {\n      try {\n        // \n        const userData = await fetchCurrentUser()\n        \n        // \n        if (!userData) {\n          ElMessage.error('')\n          return\n        }\n        \n        console.log(':', userData)\n        \n        // \n        if (!userInfo.value || !userInfo.value.id) {\n          console.error(':', userInfo.value)\n          ElMessage.error('')\n          return\n        } else {\n          console.log(':', userInfo.value)\n        }\n        \n        // \n        await loadAllUsers()\n        \n        // \n        await loadDepartments()\n        \n        // \n        await loadChatSessions()\n        \n        // URLID\n        const sessionId = route.query.session || route.query.id\n        if (sessionId) {\n          // \n          const foundContact = contacts.value.find(c => c.id === parseInt(sessionId))\n          if (foundContact) {\n            // \n            selectedContact.value = foundContact.id\n            // \n            await loadChatMessages(sessionId)\n          } else {\n            // \n            console.log('ID:', sessionId)\n            await loadChatMessages(sessionId)\n          }\n        }\n      \n        // \n        refreshInterval = setInterval(async () => {\n          if (selectedContact.value) {\n            await loadChatMessages(selectedContact.value, true)\n          }\n          await loadChatSessions(true)\n        }, 30000)\n        \n        // \n        await nextTick()\n        scrollToBottom()\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error(': ' + error.message)\n      }\n    })\n    \n    // \n    const fetchCurrentUser = async () => {\n      try {\n        console.log('...')\n        \n        // localStoragetoken\n        const token = localStorage.getItem('token')\n        if (!token) {\n          console.warn('token')\n          ElMessage.warning('')\n          return null\n        }\n        \n        const response = await request({\n          url: '/api/auth/users/me/',\n          method: 'get'\n        })\n        \n        console.log(':', response)\n        \n        // \n        let userData = null\n        if (response.data && response.data.id) {\n          // data\n          userData = response.data\n          console.log('data:', userData)\n        } else if (response.data && response.data.data && response.data.data.id) {\n          // data\n          userData = response.data.data\n          console.log('data:', userData)\n        } else if (response.id) {\n          // \n          userData = response\n          console.log(':', userData)\n        } else {\n          console.error(':', response)\n          throw new Error('')\n        }\n        \n        if (!userData || !userData.id) {\n          console.error(':', userData)\n          throw new Error('')\n        }\n        \n        // mutation\n        userInfo.value = userData\n        \n        // localStorage\n        localStorage.setItem('user', JSON.stringify(userData))\n        \n        console.log(':', userInfo.value)\n        return userData\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error(': ' + (error.message || ''))\n        return null\n      }\n    }\n    \n    // \n    const loadChatSessions = async (isBackgroundRefresh = false) => {\n      try {\n        if (!isBackgroundRefresh) {\n          sessionsLoading.value = true\n        }\n        console.log('...')\n        \n        const response = await getChatSessions()\n        console.log(':', response)\n        \n        // \n        if (!response) {\n          console.error('')\n          contacts.value = []\n          return\n        }\n        \n        let data\n        if (response.success && response.data) {\n          data = response.data\n          console.log(':', data)\n        } else {\n          data = response\n          console.log(':', data)\n        }\n        \n        // \n        chatSessions.value = data\n        \n        // \n        if (data && Array.isArray(data.results)) {\n          console.log(', :', data.results.length)\n          // \n          contacts.value = data.results.map(session => {\n            // \n            let otherParticipant = null\n            if (session.participants && Array.isArray(session.participants)) {\n              if (userInfo.value && userInfo.value.id) {\n                otherParticipant = session.participants.find(\n                  p => p.user && p.user.id !== userInfo.value.id\n                )\n              } else {\n                // \n                otherParticipant = session.participants[0]\n              }\n            }\n            \n            // \n            if (session.is_group) {\n              return {\n                id: session.id,\n                name: session.title || '',\n                initial: (session.title || '')[0],\n                avatar: '',\n                avatar_url: '',\n                color: getRandomColor(session.id),\n                status: 'online',\n                lastMessage: session.last_message ? session.last_message.content : '',\n                lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n                unread: session.unread_count,\n                isGroup: true\n              }\n            }\n            \n            // \n            if (otherParticipant) {\n              const user = otherParticipant.user\n              // \n              let avatar_url = '';\n              if (user.avatar) {\n                const avatar = user.avatar;\n                if (avatar.startsWith('http://') || avatar.startsWith('https://')) {\n                  avatar_url = avatar;\n                } else if (avatar.startsWith('/')) {\n                  avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}${avatar}`;\n                } else {\n                  avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}/${avatar}`;\n                }\n              }\n              \n              return {\n                id: session.id,\n                userId: user.id, // ID\n                name: (user.name || (((user.first_name || '') + ' ' + (user.last_name || '')).trim() || user.username) || '').trim(),\n                initial: ((user.name || user.first_name || user.username || '')[0]),\n                avatar: user.avatar || '',\n                avatar_url: avatar_url,\n                color: getRandomColor(user.id),\n                status: 'online',\n                lastMessage: session.last_message ? session.last_message.content : '',\n                lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n                unread: session.unread_count,\n                isGroup: false,\n                department: user.department || '' // \n              }\n            }\n            \n            // \n            return {\n              id: session.id,\n              name: session.title || '',\n              initial: (session.title || '')[0],\n              avatar: '',\n              avatar_url: '',\n              color: getRandomColor(session.id),\n              status: 'online',\n              lastMessage: session.last_message ? session.last_message.content : '',\n              lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n              unread: session.unread_count,\n              isGroup: session.is_group,\n              department: ''\n            }\n          })\n        } else if (data && Array.isArray(data)) {\n          console.log(', :', data.length)\n          // \n          contacts.value = data.map(session => {\n            // \n            let otherParticipant = null\n            if (session.participants && Array.isArray(session.participants)) {\n              if (userInfo.value && userInfo.value.id) {\n                otherParticipant = session.participants.find(\n                  p => p.user && p.user.id !== userInfo.value.id\n                )\n              } else {\n                // \n                otherParticipant = session.participants[0]\n              }\n            }\n            \n            // \n            if (session.is_group) {\n              return {\n                id: session.id,\n                name: session.title || '',\n                initial: (session.title || '')[0],\n                avatar: '',\n                avatar_url: '',\n                color: getRandomColor(session.id),\n                status: 'online',\n                lastMessage: session.last_message ? session.last_message.content : '',\n                lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n                unread: session.unread_count,\n                isGroup: true\n              }\n            }\n            \n            // \n            if (otherParticipant) {\n              const user = otherParticipant.user\n              // \n              let avatar_url = '';\n              if (user.avatar) {\n                const avatar = user.avatar;\n                if (avatar.startsWith('http://') || avatar.startsWith('https://')) {\n                  avatar_url = avatar;\n                } else if (avatar.startsWith('/')) {\n                  avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}${avatar}`;\n                } else {\n                  avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}/${avatar}`;\n                }\n              }\n              \n              return {\n                id: session.id,\n                name: (user.name || (((user.first_name || '') + ' ' + (user.last_name || '')).trim() || user.username) || '').trim(),\n                initial: ((user.name || user.first_name || user.username || '')[0]),\n                avatar: user.avatar || '',\n                avatar_url: avatar_url,\n                color: getRandomColor(user.id),\n                status: 'online',\n                lastMessage: session.last_message ? session.last_message.content : '',\n                lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n                unread: session.unread_count,\n                isGroup: false,\n                department: user.department || ''\n              }\n            }\n            \n            // \n            return {\n              id: session.id,\n              name: session.title || '',\n              initial: (session.title || '')[0],\n              avatar: '',\n              avatar_url: '',\n              color: getRandomColor(session.id),\n              status: 'online',\n              lastMessage: session.last_message ? session.last_message.content : '',\n              lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n              unread: session.unread_count,\n              isGroup: session.is_group,\n              department: ''\n            }\n          })\n        } else {\n          // \n          console.error(':', data)\n          contacts.value = []\n        }\n        \n        console.log(':', contacts.value)\n        \n        // \n        if (contacts.value.length > 0) {\n          contacts.value.sort((a, b) => b.unread - a.unread)\n        }\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error(': ' + (error.message || ''))\n        contacts.value = []\n      } finally {\n        if (!isBackgroundRefresh) {\n          sessionsLoading.value = false\n        }\n      }\n    }\n    \n    // \n    const loadChatMessages = async (chatId, isBackgroundRefresh = false) => {\n      if (!chatId) {\n        console.error(': chatId')\n        return\n      }\n      \n      try {\n        if (!isBackgroundRefresh) {\n          messagesLoading.value = true\n        }\n        console.log(` ${chatId} ...`)\n        \n        const response = await getChatSession(chatId)\n        console.log(':', response)\n        \n        if (!response) {\n          console.error('')\n          messages.value = []\n          return\n        }\n        \n        // \n        let messageData = []\n        let sessionData = null\n        \n        if (response.data && response.data.messages) {\n          // messages\n          messageData = response.data.messages\n          sessionData = response.data\n          console.log(':', messageData.length)\n        } else if (response.data && response.data.data && response.data.data.messages) {\n          // {success: true, data: {messages: [...]}}\n          messageData = response.data.data.messages\n          sessionData = response.data.data\n          console.log(':', messageData.length)\n        } else if (response.messages) {\n          // : {messages: [...]}\n          messageData = response.messages\n          sessionData = response\n          console.log(':', messageData.length)\n        } else {\n          console.warn(':', response)\n          console.log('...')\n          \n          // \n          const possibleMessageFields = ['message', 'chat_messages', 'chats', 'content']\n          for (const field of possibleMessageFields) {\n            if (response[field] && Array.isArray(response[field])) {\n              console.log(` ${field}`)\n              messageData = response[field]\n              sessionData = response\n              break\n            } else if (response.data && response.data[field] && Array.isArray(response.data[field])) {\n              console.log(`data ${field}`)\n              messageData = response.data[field]\n              sessionData = response.data\n              break\n            }\n          }\n          \n          if (messageData.length === 0) {\n            console.warn('')\n          }\n        }\n        \n        // \n        messageData.forEach(message => {\n          if (message.sender && message.sender.avatar) {\n            const avatar = message.sender.avatar;\n            if (avatar.startsWith('http://') || avatar.startsWith('https://')) {\n              message.sender.avatar_url = avatar;\n            } else if (avatar.startsWith('/')) {\n              message.sender.avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}${avatar}`;\n            } else {\n              message.sender.avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}/${avatar}`;\n            }\n          }\n        });\n        \n        // \n        console.log(':', sessionData)\n        console.log(':', messageData)\n        \n        // \n        if (sessionData && !contacts.value.some(c => c.id === parseInt(chatId))) {\n          console.log(':', sessionData)\n          \n          // \n          const session = sessionData\n          // \n          let otherParticipant = null\n          \n          //  session.participants \n          if (session.participants && Array.isArray(session.participants) && session.participants.length > 0 && userInfo.value) {\n            otherParticipant = session.participants.find(p => p.user && p.user.id !== userInfo.value.id)\n          }\n          \n          let tempContact = null\n          \n          // \n          if (session.is_group) {\n            tempContact = {\n              id: parseInt(chatId),\n              name: session.title || '',\n              initial: (session.title || '')[0],\n              avatar: '',\n              avatar_url: '',\n              color: getRandomColor(parseInt(chatId)),\n              status: 'online',\n              lastMessage: session.last_message ? session.last_message.content : '',\n              lastTime: formatMessageTime(session.updated_at),\n              unread: 0,\n              isGroup: true\n            }\n          // \n          } else if (otherParticipant && otherParticipant.user) {\n            const user = otherParticipant.user\n            // \n            let avatar_url = '';\n            if (user.avatar) {\n              const avatar = user.avatar;\n              if (avatar.startsWith('http://') || avatar.startsWith('https://')) {\n                avatar_url = avatar;\n              } else if (avatar.startsWith('/')) {\n                avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}${avatar}`;\n              } else {\n                avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}/${avatar}`;\n              }\n            }\n            \n            tempContact = {\n              id: parseInt(chatId),\n              name: (user.name || (((user.first_name || '') + ' ' + (user.last_name || '')).trim() || user.username) || '').trim(),\n              initial: ((user.name || user.first_name || user.username || '')[0]),\n              avatar: user.avatar || '',\n              avatar_url: avatar_url,\n              color: getRandomColor(user.id),\n              status: 'online',\n              lastMessage: session.last_message ? session.last_message.content : '',\n              lastTime: formatMessageTime(session.updated_at),\n              unread: 0,\n              isGroup: false\n            }\n          } else {\n            // \n            tempContact = {\n              id: parseInt(chatId),\n              name: session.title || '',\n              initial: (session.title || '')[0],\n              avatar: '',\n              avatar_url: '',\n              color: getRandomColor(parseInt(chatId)),\n              status: 'online',\n              lastMessage: '',\n              lastTime: formatMessageTime(session.updated_at),\n              unread: 0,\n              isGroup: session.is_group\n            }\n          }\n          \n          // \n          if (tempContact) {\n            contacts.value.unshift(tempContact)\n            console.log(':', tempContact)\n          }\n        }\n        \n        // \n        messages.value = messageData || []\n        currentChatId.value = parseInt(chatId)\n        selectedContact.value = parseInt(chatId)\n        \n        // ID\n        try {\n          const res = await request({\n            url: '/api/ai/documents/',\n            method: 'get',\n            params: { chat: chatId }\n          })\n          if (res && res.data && Array.isArray(res.data.results)) {\n            selectedDocumentIds.value = res.data.results.map(doc => doc.id)\n            console.log('ID:', selectedDocumentIds.value)\n          }\n        } catch (e) {\n          selectedDocumentIds.value = []\n        }\n        \n        // \n        nextTick(() => {\n          scrollToBottom()\n        })\n      } catch (error) {\n        console.error(':', error)\n        \n        let errorMessage = ''\n        if (error.response) {\n          const status = error.response.status\n          if (status === 404) {\n            errorMessage = ''\n          } else if (status === 403) {\n            errorMessage = ''\n          } else if (error.response.data && error.response.data.message) {\n            errorMessage = error.response.data.message\n          }\n        } else if (error.message) {\n          errorMessage = error.message\n        }\n        \n        ElMessage.error(errorMessage)\n        messages.value = []\n      } finally {\n        if (!isBackgroundRefresh) {\n          messagesLoading.value = false\n        }\n      }\n    }\n    \n    // \n    const refreshChatSessions = async () => {\n      // \n      await loadAllUsers()\n      \n      // \n      await loadDepartments()\n      \n      // \n      await loadChatSessions()\n      \n      // ID\n      if (currentChatId.value) {\n        const contact = contacts.value.find(c => c.id === currentChatId.value)\n        if (contact) {\n          selectedContact.value = contact.id\n        }\n      }\n    }\n    \n    // \n    const scrollToBottom = () => {\n      if (messageContainer.value) {\n        messageContainer.value.scrollTop = messageContainer.value.scrollHeight\n      }\n    }\n    \n    // \n    const selectContact = async (contact) => {\n      // \n      if (!contact.isGroup && userInfo.value && contact.userId === userInfo.value.id) {\n        ElMessage.warning('')\n        return\n      }\n      \n      console.log(':', contact)\n      \n      // IDIDID\n      let contactId = contact.id\n      \n      // \n      if (typeof contactId === 'string' && contactId.startsWith('user_')) {\n        // \n        let userId = contact.userId || contact.id.replace('user_', '')\n        console.log(':', userId)\n        \n        // \n        const existingChat = contacts.value.find(c => \n          !c.isGroup && \n          ((c.userId && c.userId == userId) || \n          (c.user && c.user.id == userId))\n        )\n        \n        if (existingChat) {\n          console.log(':', existingChat)\n          contactId = existingChat.id\n        } else {\n          console.log('')\n          \n          // \n          try {\n            const response = await request({\n              url: '/api/chat/sessions/',\n              method: 'post',\n              data: {\n                participant_ids: [userId],\n                is_group: false\n              }\n            })\n            \n            console.log(':', response)\n            \n            // API\n            let newSession = null\n            \n            if (response && response.data) {\n              newSession = response.data\n            } else if (response && response.id) {\n              newSession = response\n            }\n            \n            if (newSession && newSession.id) {\n              // \n              const tempContact = {\n                id: newSession.id,\n                userId: userId,\n                name: contact.name,\n                initial: contact.initial,\n                avatar: contact.avatar,\n                avatar_url: contact.avatar_url || '',\n                color: contact.color || getRandomColor(userId),\n                status: 'online',\n                lastMessage: '',\n                lastTime: formatMessageTime(new Date()),\n                unread: 0,\n                isGroup: false,\n                department: contact.department\n              }\n              \n              // \n              contacts.value.unshift(tempContact)\n              \n              // \n              contactId = newSession.id\n              ElMessage.success('')\n            } else {\n              throw new Error('')\n            }\n          } catch (error) {\n            console.error(':', error)\n            ElMessage.error(': ' + (error.message || ''))\n            return\n          }\n        }\n      }\n      \n      // \n      selectedContact.value = contactId\n      messageInput.value = ''\n      messages.value = []\n      \n      // \n      try {\n        await loadChatMessages(contactId)\n        \n        // \n        nextTick(() => {\n          scrollToBottom()\n        })\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error('' + (error.message || ''))\n      }\n    }\n    \n    // \n    watch(messages, () => {\n      nextTick(() => {\n        scrollToBottom()\n      })\n    })\n    \n    // \n    const sendMessage = async () => {\n      if (!messageInput.value.trim() || !currentChatId.value) return\n\n      try {\n        console.log('IDs:', selectedDocumentIds.value)\n        if (!userInfo.value || !userInfo.value.id) {\n          const userData = await fetchCurrentUser()\n          if (!userData || !userData.id) {\n            throw new Error('')\n          }\n        }\n\n        const tempMessage = {\n          id: 'temp-' + Date.now(),\n          content: messageInput.value.trim(),\n          sender: {\n            id: userInfo.value.id,\n            username: userInfo.value.username || '',\n            first_name: userInfo.value.first_name || '',\n            last_name: userInfo.value.last_name || ''\n          },\n          message_type: 'text',\n          created_at: new Date().toISOString(),\n          is_temp: true\n        }\n\n        messages.value.push(tempMessage)\n        const messageCopy = messageInput.value\n        messageInput.value = ''\n        await nextTick()\n        scrollToBottom()\n\n        let response, aiMsg\n        if (selectedDocumentIds.value && selectedDocumentIds.value.length > 0) {\n          // AI\n          response = await aiChatWithDocuments({\n            message: messageCopy,\n            chat_id: currentChatId.value,\n            document_ids: selectedDocumentIds.value\n          })\n          // \n          let aiContent = ''\n          if (response && typeof response.data === 'string') {\n            aiContent = response.data\n          } else if (response && response.data && response.data.message) {\n            aiContent = response.data.message\n          }\n          if (aiContent) {\n            aiMsg = {\n              id: 'ai-' + Date.now(),\n              content: aiContent,\n              sender: { id: 0, username: 'AI' },\n              message_type: 'text',\n              created_at: new Date().toISOString()\n            }\n            // AI\n            const tempIndex = messages.value.findIndex(m => m.id === tempMessage.id)\n            if (tempIndex !== -1) {\n              messages.value.splice(tempIndex, 1, aiMsg)\n            } else {\n              messages.value.push(aiMsg)\n            }\n          }\n        } else {\n          // \n          response = await sendTextMessage({\n            chat: currentChatId.value,\n            content: messageCopy\n          })\n          let messageData = null\n          if (response && response.success && response.data) {\n            messageData = response.data\n          } else if (response && response.id) {\n            messageData = response\n          } else if (response && response.chat) {\n            messageData = {\n              id: response.id || 'msg-' + Date.now(),\n              content: response.content,\n              message_type: response.message_type,\n              file: response.file,\n              created_at: response.created_at || new Date().toISOString(),\n              sender: {\n                id: userInfo.value.id,\n                username: userInfo.value.username || '',\n                first_name: userInfo.value.first_name || '',\n                last_name: userInfo.value.last_name || ''\n              }\n            }\n          }\n          const tempIndex = messages.value.findIndex(m => m.id === tempMessage.id)\n          if (tempIndex !== -1 && messageData) {\n            messages.value.splice(tempIndex, 1, messageData)\n          } else if (messageData) {\n            messages.value.push(messageData)\n          }\n        }\n        await nextTick()\n        scrollToBottom()\n      } catch (error) {\n        console.error(':', error)\n        messages.value = messages.value.filter(m => !m.is_temp)\n        messageInput.value = error.savedMessage || messageInput.value\n        ElMessage.error('')\n      }\n    }\n    \n    // \n    const openFileUpload = () => {\n      fileInput.value.click()\n    }\n    \n    // \n    const openImageUpload = () => {\n      imageInput.value.click()\n    }\n    \n    // \n    const fileUploading = ref(false)\n    const imageUploading = ref(false)\n    \n    // \n    const handleFileUpload = async (event) => {\n      const file = event.target.files[0]\n      if (!file || !currentChatId.value) return\n      try {\n        // \n        fileUploading.value = true\n        \n        // sendFileMessage\n        await sendFileMessage(\n          currentChatId.value,\n          `: ${file.name}`,\n          file\n        )\n        \n        // AI\n        const formData = new FormData()\n        formData.append('file', file)\n        formData.append('chat', currentChatId.value)\n        await request({\n          url: '/api/ai/documents/upload/',\n          method: 'post',\n          data: formData,\n          headers: { 'Content-Type': 'multipart/form-data' }\n        })\n        \n        // ID\n        const docRes = await request({\n          url: '/api/ai/documents/',\n          method: 'get',\n          params: { chat: currentChatId.value }\n        })\n        if (docRes && docRes.data && Array.isArray(docRes.data.results)) {\n          selectedDocumentIds.value = docRes.data.results.map(doc => doc.id)\n          console.log('IDs:', selectedDocumentIds.value)\n        }\n        \n        ElMessage.success('')\n        \n        // \n        loadChatMessages(currentChatId.value, true)\n        event.target.value = ''\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error('')\n      } finally {\n        // \n        fileUploading.value = false\n      }\n    }\n    \n    // \n    const handleImageUpload = async (event) => {\n      const file = event.target.files[0]\n      if (!file || !currentChatId.value) return\n      \n      try {\n        // \n        imageUploading.value = true\n        \n        // API\n        await sendImageMessage(\n          currentChatId.value, \n          ``, \n          file\n        )\n        \n        // \n        loadChatMessages(currentChatId.value, true)\n        \n        // \n        event.target.value = ''\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error('')\n      } finally {\n        // \n        imageUploading.value = false\n      }\n    }\n    \n    // \n    const openKnowledgeDialog = async () => {\n      knowledgeDialogVisible.value = true\n      await loadKnowledgeList()\n    }\n    \n    // \n    const loadKnowledgeList = async () => {\n      try {\n        knowledgeLoading.value = true\n        const { data } = await getKnowledgeList()\n        knowledgeList.value = data\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error('')\n      } finally {\n        knowledgeLoading.value = false\n      }\n    }\n    \n    // \n    const selectKnowledge = (row) => {\n      selectedKnowledge.value = row\n    }\n    \n    // \n    const shareKnowledge = async (knowledge) => {\n      if (!currentChatId.value) return\n      \n      try {\n        await sendKnowledgeMessage(\n          currentChatId.value,\n          `: ${knowledge.title}`,\n          knowledge.id\n        )\n        \n        // \n        knowledgeDialogVisible.value = false\n        \n        // \n        loadChatMessages(currentChatId.value, true)\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error('')\n      }\n    }\n    \n    // \n    const downloadFile = async (message) => {\n      try {\n        const response = await downloadMessageFile(message.id)\n        \n        // \n        const url = window.URL.createObjectURL(new Blob([response.data]))\n        const link = document.createElement('a')\n        link.href = url\n        link.setAttribute('download', message.file_name || 'download')\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error('')\n      }\n    }\n    \n    // \n    const viewKnowledge = (message) => {\n      if (message.knowledge_detail) {\n        // \n        ElMessageBox.alert(\n          `: ${message.knowledge_detail.title}<br>: ${message.knowledge_detail.description || ''}`, \n          '', \n          {\n            dangerouslyUseHTMLString: true,\n            confirmButtonText: ''\n          }\n        )\n      }\n    }\n    \n    // \n    const getSenderColor = (sender) => {\n      return getRandomColor(sender.id)\n    }\n    \n    // \n    const getSenderInitial = (sender) => {\n      return (sender.first_name || sender.username)[0]\n    }\n    \n    // ID\n    const getRandomColor = (id) => {\n      const colors = [\n        '#007bff', '#28a745', '#dc3545', '#fd7e14', \n        '#6f42c1', '#20c997', '#17a2b8', '#6c757d'\n      ]\n      \n      // ID\n      const index = typeof id === 'number' ? id % colors.length : 0\n      return colors[index]\n    }\n    \n    // \n    const formatMessageTime = (timestamp) => {\n      if (!timestamp) return ''\n      \n      const date = new Date(timestamp)\n      const now = new Date()\n      const diff = now - date\n      \n      // \n      if (diff < 24 * 60 * 60 * 1000) {\n      const hours = date.getHours().toString().padStart(2, '0')\n      const minutes = date.getMinutes().toString().padStart(2, '0')\n      return `${hours}:${minutes}`\n      }\n      \n      // \n      if (diff < 7 * 24 * 60 * 60 * 1000) {\n        const days = ['', '', '', '', '', '', '']\n        return days[date.getDay()]\n      }\n      \n      // \n      return `${date.getMonth() + 1}${date.getDate()}`\n    }\n    \n    // \n    const formatDate = (timestamp) => {\n      if (!timestamp) return ''\n      \n      const date = new Date(timestamp)\n      return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`\n    }\n    \n    // \n    const formatFileSize = (sizeInKB) => {\n      if (sizeInKB < 1024) {\n        return `${sizeInKB} KB`\n      } else {\n        return `${(sizeInKB / 1024).toFixed(2)} MB`\n      }\n    }\n    \n    // \n    const getStatusText = (status) => {\n      const statusMap = {\n        'online': '',\n        'offline': '',\n        'busy': '',\n        'away': ''\n      }\n      return statusMap[status] || status\n    }\n    \n    // \n    const forceRefresh = async () => {\n      try {\n        ElMessage.info('...')\n        \n        // \n        const userData = await fetchCurrentUser()\n        \n        if (!userData) {\n          ElMessage.error('')\n          return\n        }\n        \n        // \n        await loadChatSessions()\n        \n        if (contacts.value.length === 0) {\n          ElMessage.warning('')\n        } else {\n          ElMessage.success(' ' + contacts.value.length + ' ')\n        }\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error(': ' + (error.message || ''))\n      }\n    }\n    \n    // \n    const loadAllUsers = async () => {\n      try {\n        console.log('...')\n        \n        // ID\n        if (!userInfo.value || !userInfo.value.company) {\n          console.error('')\n          // \n          const userData = await fetchCurrentUser();\n          if (!userData || !userData.company) {\n            ElMessage.error('');\n            allColleagues.value = []; // \n            return;\n          }\n        }\n        \n        const companyId = userInfo.value.company;\n        console.log('ID:', companyId);\n\n        // /api/auth/contacts/ID\n        const response = await request({\n          url: '/api/auth/contacts/',\n          method: 'get',\n          params: { company: companyId }\n        });\n\n        console.log('API:', response);\n\n        let users = [];\n        //  response.data \n        if (response && response.success && Array.isArray(response.data)) {\n          users = response.data;\n        } else if (response && Array.isArray(response.data)) {\n           users = response.data;\n        } else if (response && Array.isArray(response)) {\n           users = response;\n        } else {\n          console.warn(':', response);\n        }\n\n        if (users.length > 0) {\n          console.log(` ${users.length} `);\n          // contactsallColleagues\n          allColleagues.value = users.map(u => ({\n            id: u.id,\n            username: u.username,\n            name: u.name, // name\n            department: u.department,\n            avatar: u.avatar_url || u.avatar\n          }));\n        } else {\n          allColleagues.value = []; // \n        }\n\n      } catch (error) {\n        console.error(':', error);\n        ElMessage.error('');\n        allColleagues.value = []; // \n      }\n    }\n    \n    // \n    const loadDepartments = async () => {\n      try {\n        console.log('...')\n        const response = await request({\n          url: '/api/auth/departments/',\n          method: 'get'\n        })\n        \n        console.log(':', response)\n        \n        // \n        let depts = []\n        if (response && response.results) {\n          depts = response.results\n        } else if (Array.isArray(response)) {\n          depts = response\n        } else if (response && response.data) {\n          if (Array.isArray(response.data)) {\n            depts = response.data\n          } else if (response.data.results) {\n            depts = response.data.results\n          }\n        }\n        \n        if (depts && depts.length > 0) {\n          console.log(`${depts.length}`)\n          departments.value = depts\n        }\n      } catch (error) {\n        console.error(':', error)\n      }\n    }\n    \n    // \n    const hiddenCalendarEvents = ref([])\n    \n    // \n    const handleCalendarEventAdded = () => {\n      // \n    }\n    \n    // \n    const handleCalendarEventHidden = (messageId) => {\n      hiddenCalendarEvents.value.push(messageId)\n    }\n    \n    const selectedDocumentIds = ref([]) // ID\n    \n    // AI\n    const summaryDialogVisible = ref(false)\n    const summaryDateRange = ref([new Date(new Date().setDate(new Date().getDate() - 7)), new Date()])\n    const summaryContent = ref('')\n    const summaryLoading = ref(false)\n    const pickerOptions = ref({\n      shortcuts: [{\n        text: '',\n        onClick(picker) {\n          const end = new Date();\n          const start = new Date();\n          start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);\n          picker.$emit('pick', [start, end]);\n        }\n      }, {\n        text: '',\n        onClick(picker) {\n          const end = new Date();\n          const start = new Date();\n          start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);\n          picker.$emit('pick', [start, end]);\n        }\n      }, {\n        text: '',\n        onClick(picker) {\n          const end = new Date();\n          const start = new Date();\n          start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);\n          picker.$emit('pick', [start, end]);\n        }\n      }]\n    })\n    \n    const openSummaryDialog = () => {\n      // \n      summaryContent.value = ''\n      summaryDialogVisible.value = true\n    }\n    \n    const handleCloseSummaryDialog = () => {\n      summaryDialogVisible.value = false\n    }\n    \n    const handleSummarize = async () => {\n      if (!selectedContact.value) {\n        ElMessage.warning('');\n        return;\n      }\n      if (!summaryDateRange.value || summaryDateRange.value.length !== 2) {\n        ElMessage.warning('');\n        return;\n      }\n\n      summaryLoading.value = true;\n      summaryContent.value = ''; // Reset before fetching\n\n      const [startDate, endDate] = summaryDateRange.value;\n\n      try {\n        // 'summarizeChat' returns the full axios response\n        const response = await summarizeChat(selectedContact.value, startDate.toISOString(), endDate.toISOString());\n        \n        // The actual data from the backend is in response.data\n        const summary = response.data.summary;\n\n        if (summary) {\n          // If we have a summary, display it\n          summaryContent.value = summary;\n        } else {\n          // If the summary is empty or not present, display a clear message\n          summaryContent.value = 'AI';\n        }\n      } catch (error) {\n        console.error('Summarization error:', error);\n        summaryContent.value = '';\n        ElMessage.error('');\n      } finally {\n        summaryLoading.value = false;\n      }\n    };\n    \n    // \n    const expandedImage = ref(null)\n\n    // \n    const toggleImageExpand = (imageUrl) => {\n      expandedImage.value = imageUrl\n    }\n    \n    const getFileName = (fullName) => {\n      if (!fullName) return '';\n      const lastDot = fullName.lastIndexOf('.');\n      if (lastDot === -1 || lastDot === 0) {\n        return fullName;\n      }\n      return fullName.substring(0, lastDot);\n    };\n\n    const getFileExtension = (fullName) => {\n      if (!fullName) return '';\n      const lastDot = fullName.lastIndexOf('.');\n      if (lastDot === -1 || lastDot === 0 || lastDot >= fullName.length - 1) {\n        return '';\n      }\n      return fullName.substring(lastDot); // includes the dot\n    };\n    \n    return {\n      searchQuery,\n      activeTab,\n      selectedContact,\n      tabs,\n      contacts,\n      currentContact,\n      filteredContacts,\n      messages,\n      messageInput,\n      messageContainer,\n      fileInput,\n      imageInput,\n      currentUser,\n      userInfo,\n      userId,\n      knowledgeDialogVisible,\n      knowledgeLoading,\n      knowledgeList,\n      sessionsLoading,\n      messagesLoading,\n      // \n      Search,\n      Phone,\n      VideoCamera,\n      InfoFilled,\n      Document,\n      PictureFilled,\n      FolderOpened,\n      Microphone,\n      Position,\n      ChatDotSquare,\n      Reading,\n      UserFilled,\n      ChatLineSquare,\n      Refresh,\n      MoreFilled,\n      // \n      sendMessage,\n      getStatusText,\n      selectContact,\n      openFileUpload,\n      openImageUpload,\n      handleFileUpload,\n      handleImageUpload,\n      openKnowledgeDialog,\n      selectKnowledge,\n      shareKnowledge,\n      downloadFile,\n      viewKnowledge,\n      getSenderColor,\n      getSenderInitial,\n      formatMessageTime,\n      formatDate,\n      formatFileSize,\n      refreshChatSessions,\n      forceRefresh,\n      groupedUsersByDepartment,\n      getActiveContacts,\n      loadAllUsers,\n      loadDepartments,\n      hiddenCalendarEvents,\n      handleCalendarEventAdded,\n      handleCalendarEventHidden,\n      selectedDocumentIds,\n      fileUploading,\n      imageUploading,\n      summaryDialogVisible,\n      summaryDateRange,\n      summaryContent,\n      summaryLoading,\n      pickerOptions,\n      openSummaryDialog,\n      handleCloseSummaryDialog,\n      handleSummarize,\n      expandedImage,\n      toggleImageExpand,\n      getFileName,\n      getFileExtension\n    }\n  }\n}\n</script>\n\n<style scoped>\n.chat-container {\n  height: calc(100vh - 64px); /*  */\n  width: 100%;\n  padding: 20px;\n  overflow: hidden;\n  box-sizing: border-box;\n  background-color: transparent;\n}\n\n.chat-card {\n  height: 100%;\n  width: 100%;\n  border-radius: 8px;\n  margin: 0;\n  overflow: hidden;\n  box-shadow: 0 2px 12px var(--shadow-color) !important;\n  background-color: transparent;\n}\n\n.chat-card :deep(.el-card__body) {\n  height: 100%;\n  padding: 0;\n  background-color: transparent;\n}\n\n.chat-layout {\n  display: flex;\n  height: 100%;\n  width: 100%;\n  background-color: transparent;\n}\n\n/*  */\n.chat-sidebar {\n  width: 280px;\n  border-right: 1px solid var(--border-color);\n  display: flex;\n  flex-direction: column;\n  background-color: var(--bg-color);\n  height: 100%;\n  overflow: hidden;\n}\n\n.search-box {\n  padding: 15px;\n  border-bottom: 1px solid var(--border-color);\n}\n\n.chat-tabs {\n  display: flex;\n  border-bottom: 1px solid var(--border-color);\n}\n\n.chat-tab {\n  flex: 1;\n  text-align: center;\n  padding: 12px;\n  cursor: pointer;\n  font-weight: 500;\n  color: var(--text-color-secondary);\n  transition: all 0.3s ease;\n}\n\n.chat-tab.active {\n  color: var(--el-color-primary);\n  border-bottom: 2px solid var(--el-color-primary);\n}\n\n.contacts-list {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0;\n}\n\n.contact-item {\n  display: flex;\n  padding: 15px;\n  border-bottom: 1px solid var(--border-color-light);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  border-color: var(--border-color);\n}\n\n.contact-item:hover {\n  background-color: var(--hover-color);\n}\n\n.contact-item.active {\n  background-color: var(--primary-color-light, #f0f7ff);\n}\n\n.contact-avatar {\n  position: relative;\n  margin-right: 12px;\n}\n\n.avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  font-weight: bold;\n}\n\n.avatar.small {\n  width: 32px;\n  height: 32px;\n  font-size: 12px;\n}\n\n.avatar-initial {\n  font-size: 16px;\n}\n\n.contact-status {\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  border: 2px solid var(--bg-color);\n}\n\n.status-online {\n  background-color: #28a745;\n}\n\n.status-offline {\n  background-color: #6c757d;\n}\n\n.status-busy {\n  background-color: #dc3545;\n}\n\n.status-away {\n  background-color: #fd7e14;\n}\n\n.contact-info {\n  flex: 1;\n  overflow: hidden;\n}\n\n.contact-name {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 5px;\n}\n\n.contact-name span {\n  font-weight: 500;\n}\n\n.time {\n  font-size: 12px;\n  color: var(--text-color-tertiary);\n}\n\n.contact-message {\n  display: flex;\n  justify-content: space-between;\n  color: var(--text-color-secondary);\n  font-size: 13px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  position: relative;\n  padding-right: 30px; \n}\n\n.message-badge {\n  position: absolute;\n  right: 5px;\n  top: 0;\n  height: 100%;\n  display: flex;\n  align-items: center;\n}\n\n.message-badge :deep(.el-badge__content) {\n  position: static !important;\n  transform: none !important;\n}\n\n/*  */\n.chat-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  overflow: hidden;\n  background-color: transparent;\n}\n\n.chat-header {\n  display: flex;\n  align-items: center;\n  padding: 15px;\n  border-bottom: 1px solid var(--border-color);\n  background-color: var(--bg-color);\n}\n\n.chat-header .contact-info {\n  margin-right: auto;\n}\n\n.chat-header h6 {\n  margin: 0;\n  font-size: 16px;\n  color: var(--text-color);\n}\n\n.chat-header p {\n  margin: 0;\n  font-size: 12px;\n  color: var(--text-color-tertiary);\n}\n\n.chat-actions {\n  display: flex;\n  gap: 10px;\n  align-items: center;\n  margin-left: auto;\n  padding-right: 15px;\n}\n\n.chat-messages {\n  flex: 1;\n  overflow-y: auto;\n  padding: 20px;\n  max-height: calc(100% - 150px); \n  display: flex;\n  flex-direction: column;\n  background-color: transparent;\n}\n\n.message {\n  margin-bottom: 15px;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  background-color: transparent;\n}\n\n.message-container {\n  width: 100%;\n  display: flex;\n  background-color: transparent;\n}\n\n.message-sent .message-container {\n  flex-direction: row-reverse;\n}\n\n.message-avatar {\n  margin-right: 10px;\n  flex-shrink: 0;\n}\n\n.message-sent .message-avatar {\n  margin-right: 0;\n  margin-left: 10px;\n}\n\n.message-content-wrapper {\n  max-width: 100%;\n  width: auto;\n}\n\n.message-content {\n  padding: 0;\n  border-radius: 0;\n  background-color: transparent;\n  max-width: 280px;\n  width: 100%;\n}\n\n.message-content.received {\n  background-color: transparent;\n  border: none;\n}\n\n.message-content.sent {\n  background-color: transparent;\n  border: none;\n}\n\n.message-time {\n  font-size: 12px;\n  color: var(--text-color-tertiary);\n  margin-top: 5px;\n  text-align: right;\n}\n\n.message-sent .message-time {\n  text-align: right;\n}\n\n.message-received .message-time {\n  text-align: left;\n}\n\n.image-card {\n  width: 100%;\n  max-width: 280px;\n  background-color: transparent;\n  border-radius: 8px;\n  margin: 5px 0;\n  overflow: hidden;\n}\n\n.message-sent .image-card {\n  margin-left: auto;\n}\n\n.image-card-inner {\n  display: flex;\n  flex-direction: column;\n}\n\n.image-preview {\n  width: 100%;\n  height: 180px;\n  overflow: hidden;\n  border-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.image-preview img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  cursor: pointer;\n  transition: transform 0.3s ease;\n}\n\n.image-preview img:hover {\n  transform: scale(1.03);\n}\n\n.file-card {\n  width: 100%;\n  max-width: 280px;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  margin: 5px 0;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  border: none;\n}\n\n.message-sent .file-card {\n  margin-left: auto;\n}\n\n.file-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.file-card-inner {\n  display: flex;\n  align-items: center;\n  padding: 15px;\n}\n\n.file-icon {\n  width: 40px;\n  height: 40px;\n  border-radius: 8px;\n  background-color: var(--el-color-primary-light-9);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 12px;\n}\n\n.file-icon .el-icon {\n  font-size: 24px;\n  color: var(--el-color-primary);\n}\n\n.file-info {\n  flex: 1;\n  overflow: hidden;\n}\n\n.file-name {\n  font-weight: 500;\n  color: var(--text-color);\n  margin-bottom: 4px;\n  display: flex;\n  align-items: baseline;\n  overflow: hidden;\n}\n\n.file-name-main {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  flex-shrink: 1;\n}\n\n.file-name-ext {\n  white-space: nowrap;\n  flex-shrink: 0;\n}\n\n.file-meta {\n  display: flex;\n  justify-content: space-between;\n  font-size: 12px;\n}\n\n.file-size {\n  color: var(--text-color-secondary);\n}\n\n.file-download-hint {\n  color: var(--el-color-primary);\n}\n\n.knowledge-card {\n  width: 100%;\n  max-width: 280px;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  margin: 5px 0;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  border: none;\n}\n\n.message-sent .knowledge-card {\n  margin-left: auto;\n}\n\n.knowledge-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.knowledge-card-inner {\n  display: flex;\n  padding: 15px;\n}\n\n.knowledge-icon {\n  width: 40px;\n  height: 40px;\n  border-radius: 8px;\n  background-color: var(--el-color-success-light-9);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 12px;\n  flex-shrink: 0;\n}\n\n.knowledge-icon .el-icon {\n  font-size: 24px;\n  color: var(--el-color-success);\n}\n\n.knowledge-content {\n  flex: 1;\n  overflow: hidden;\n}\n\n.knowledge-title {\n  font-weight: 500;\n  color: var(--text-color);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin-bottom: 4px;\n}\n\n.knowledge-desc {\n  color: var(--text-color-secondary);\n  font-size: 12px;\n  margin-bottom: 8px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n}\n\n.knowledge-footer {\n  display: flex;\n  justify-content: space-between;\n  font-size: 12px;\n}\n\n.knowledge-type {\n  color: var(--text-color-tertiary);\n  background-color: var(--bg-color-tertiary);\n  padding: 2px 8px;\n  border-radius: 4px;\n}\n\n.knowledge-view {\n  color: var(--el-color-primary);\n}\n\n.chat-input {\n  padding: 15px;\n  background-color: var(--bg-color);\n  border-top: 1px solid var(--border-color);\n  display: flex;\n  flex-direction: column;\n  min-height: 150px; /*  */\n}\n\n.chat-tools {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 10px;\n}\n\n.input-area {\n  margin-bottom: 10px;\n  flex: 1;\n}\n\n.send-button {\n  display: flex;\n  justify-content: flex-end;\n}\n\n.empty-chat {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: #999;\n}\n\n.empty-illustration {\n  margin-bottom: 20px;\n  color: #ddd;\n}\n\n.empty-chat h4 {\n  margin: 0 0 10px;\n}\n\n.empty-chat p {\n  margin: 0;\n  font-size: 14px;\n}\n\n.empty-contacts {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: #999;\n}\n\n.empty-icon {\n  margin-bottom: 20px;\n  color: #ddd;\n}\n\n.empty-contacts h4 {\n  margin: 0 0 10px;\n}\n\n.empty-contacts p {\n  margin: 0;\n  font-size: 14px;\n}\n\n.loading-container {\n  flex: 1;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.empty-messages {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n}\n\n.loading-messages {\n  flex: 1;\n  padding: 20px;\n}\n\n.mt-3 {\n  margin-top: 15px;\n}\n\n.search-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.search-header .el-input {\n  flex: 1;\n}\n\n.chat-header-actions {\n  margin-bottom: 10px;\n}\n\n.refresh-action {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-top: 5px;\n}\n\n.department-group {\n  margin-bottom: 10px;\n  border-color: var(--border-color);\n}\n\n.department-header {\n  padding: 5px 15px;\n  font-size: 13px;\n  color: var(--text-color-secondary);\n  background-color: var(--bg-color-tertiary);\n  border-radius: 4px;\n  margin-bottom: 5px;\n  font-weight: 500;\n  background-color: var(--bg-color-tertiary) !important;\n}\n\n.group-actions {\n  display: flex;\n  align-items: center;\n  margin-left: auto;\n  margin-right: 5px;\n}\n\n.group-action-btn {\n  padding: 6px;\n  color: #909399;\n}\n\n.group-action-btn:hover {\n  color: #409EFF;\n}\n\n/*  */\n:deep(.el-dialog) {\n  background-color: var(--bg-color);\n  color: var(--text-color);\n}\n\n:deep(.el-dialog__title) {\n  color: var(--text-color);\n}\n\n:deep(.el-dialog__body) {\n  color: var(--text-color);\n}\n\n/*  */\n:deep(.el-table) {\n  background-color: var(--bg-color);\n  color: var(--text-color);\n}\n\n:deep(.el-table th.el-table__cell) {\n  background-color: var(--bg-color-tertiary);\n}\n\n:deep(.el-table tr) {\n  background-color: var(--bg-color);\n}\n\n:deep(.el-table td.el-table__cell) {\n  background-color: var(--bg-color);\n  border-bottom: 1px solid var(--border-color);\n}\n\n/*  */\n:deep(.el-select .el-input__wrapper) {\n  background-color: var(--bg-color-secondary);\n}\n\n:deep(.el-select-dropdown) {\n  background-color: var(--bg-color-secondary);\n  border-color: var(--border-color);\n}\n\n:deep(.el-select-dropdown__item) {\n  color: var(--text-color);\n}\n\n:deep(.el-select-dropdown__item.hover),\n:deep(.el-select-dropdown__item:hover) {\n  background-color: var(--hover-color);\n}\n\n:deep(.el-input__wrapper) {\n  background-color: var(--bg-color-secondary) !important;\n  box-shadow: 0 0 0 1px var(--border-color) inset;\n}\n\n:deep(.el-input__inner) {\n  color: var(--text-color);\n}\n\n:deep(.el-select__input) {\n  color: var(--text-color) !important;\n}\n\n:deep(.el-textarea__inner) {\n  background-color: var(--bg-color-secondary);\n  color: var(--text-color);\n  border-color: var(--border-color);\n}\n\n/*  */\n.empty-icon {\n  color: var(--text-color-tertiary);\n}\n\n:deep(.el-icon) {\n  color: inherit;\n}\n\n:deep(.el-button--primary) {\n  color: white;\n}\n\n.chat-header h6 {\n  color: var(--text-color);\n}\n\n/* badge */\n:deep(.el-badge__content) {\n  background-color: var(--error-color, #ef4444);\n}\n\n:deep(.el-tag) {\n  background-color: var(--primary-color-light);\n  border-color: var(--primary-color-light);\n  color: var(--primary-color);\n}\n\n/*  */\n:deep(.el-popper.is-light) {\n  background-color: var(--bg-color-tertiary);\n  border-color: var(--border-color);\n}\n\n:deep(.el-popper__arrow::before) {\n  background-color: var(--bg-color-tertiary);\n  border-color: var(--border-color);\n}\n\n/*  */\n.search-box :deep(.el-input__prefix-inner) {\n  color: var(--text-color-tertiary);\n}\n\n/*  */\n:deep(.el-input),\n:deep(.el-select) {\n  --el-fill-color-blank: var(--bg-color-tertiary);\n  --el-text-color-regular: var(--text-color);\n  --el-border-color: var(--border-color);\n  --el-border-color-hover: var(--primary-color);\n  --el-fill-color-light: var(--bg-color-tertiary);\n}\n\n/*  */\n.department-header {\n  background-color: var(--bg-color-tertiary) !important;\n}\n\n/* El-Card */\n:deep(.el-card) {\n  --el-card-bg-color: var(--bg-color);\n  background-color: var(--bg-color);\n  color: var(--text-color);\n  border-color: var(--border-color);\n}\n\n/* El-Alert */\n:deep(.el-alert) {\n  --el-alert-bg-color: var(--bg-color-tertiary);\n  color: var(--text-color);\n}\n\n:deep(.el-alert--info) {\n  --el-alert-bg-color: var(--bg-color-tertiary);\n}\n\n:deep(.el-empty__image svg) {\n  fill: var(--text-color-tertiary);\n}\n\n/*  */\n:deep(.el-dropdown-menu) {\n  background-color: var(--bg-color-tertiary);\n  border-color: var(--border-color);\n}\n\n:deep(.el-dropdown-menu__item) {\n  color: var(--text-color);\n}\n\n:deep(.el-dropdown-menu__item:hover) {\n  background-color: var(--hover-color);\n}\n\n:deep(.el-dropdown-menu__item--divided:before) {\n  background-color: var(--border-color);\n}\n\n:deep(.el-dropdown-menu__item.is-disabled) {\n  color: var(--text-color-tertiary);\n}\n\n:deep(.el-divider) {\n  background-color: var(--border-color);\n}\n\n/*  */\n:deep(.el-message-box) {\n  background-color: var(--bg-color);\n  border-color: var(--border-color);\n}\n\n:deep(.el-message-box__title) {\n  color: var(--text-color);\n}\n\n:deep(.el-message-box__message) {\n  color: var(--text-color);\n}\n\n:deep(.el-message) {\n  background-color: var(--bg-color);\n  border-color: var(--border-color);\n}\n\n:deep(.el-message__content) {\n  color: var(--text-color);\n}\n\n/*  */\n.el-textarea__wrapper {\n  box-shadow: 0 0 0 1px var(--border-color) inset !important;\n}\n\n.summary-content-wrapper {\n  margin-top: 10px;\n  border: 1px solid #e4e7ed;\n  border-radius: 8px;\n  overflow: hidden;\n}\n\n.summary-title {\n  border-radius: 0;\n  border-bottom: 1px solid #e4e7ed;\n}\n\n.summary-content {\n  padding: 15px;\n  background-color: #fafafa;\n  min-height: 150px;\n  max-height: 40vh;\n  overflow-y: auto;\n}\n\n/*  */\n.fullscreen-image-preview {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.9);\n  z-index: 20003; /*  */\n  overflow: auto;\n  text-align: center;\n  padding: 0;\n  font-size: 0; /*  */\n  cursor: pointer;\n}\n\n.fullscreen-preview-image {\n  margin: 0; /*  */\n  /*  */\n}\n\n/*  */\n.text-card {\n  max-width: 280px;\n  margin: 5px 0;\n  overflow: hidden;\n  border-radius: 8px;\n  background-color: #fff;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.message-sent .text-card {\n  margin-left: auto;\n}\n\n.text-card-inner {\n  padding: 12px 15px;\n  word-break: break-word;\n}\n\n.received .text-card {\n  background-color: #fff;\n}\n\n.sent .text-card {\n  background-color: var(--el-color-primary);\n  color: white;\n}\n\n/*  */\n.message-content {\n  padding: 0;\n  border-radius: 0;\n  background-color: transparent;\n  max-width: 280px;\n  width: 100%;\n}\n\n.message-content-wrapper {\n  max-width: 100%;\n  width: auto;\n}\n\n/*  */\n.image-card, .file-card, .knowledge-card, .text-card {\n  width: 100%;\n  max-width: 280px;\n  margin: 5px 0;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  border-radius: 8px;\n}\n\n.message-sent .image-card,\n.message-sent .file-card,\n.message-sent .knowledge-card,\n.message-sent .text-card {\n  margin-left: auto;\n}\n\n/*  */\n.message-content span {\n  padding: 0;\n  border-radius: 0;\n  display: inline;\n  background-color: transparent;\n  color: inherit;\n}\n\n.file-name-ext {\n  white-space: nowrap;\n  flex-shrink: 0;\n}\n\n.file-card,\n.knowledge-card {\n  min-height: 80px;\n  display: flex;\n  align-items: center;\n}\n\n.file-card-inner,\n.knowledge-card-inner {\n  width: 100%;\n}\n\n.file-card {\n  width: 100%;\n  max-width: 280px;\n}\n</style> "],"mappings":"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","ignoreList":[]}]}