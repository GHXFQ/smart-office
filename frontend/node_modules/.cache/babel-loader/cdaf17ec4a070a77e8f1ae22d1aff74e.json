{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\o\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\o\\smart-office\\frontend\\node_modules\\quill\\blots\\scroll.js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\o\\smart-office\\frontend\\node_modules\\quill\\blots\\scroll.js","mtime":1751792162280},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\o\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\o\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\o\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJDOi9Vc2Vycy8xODA4My9EZXNrdG9wL0NDSVQvb2ZmaWNlL28vc21hcnQtb2ZmaWNlL2Zyb250ZW5kL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9kZWZpbmVQcm9wZXJ0eS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnB1c2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZWR1Y2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5jb25zdHJ1Y3Rvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmZpbHRlci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLnJlZHVjZS5qcyI7CmltcG9ydCB7IENvbnRhaW5lckJsb3QsIExlYWZCbG90LCBTY29wZSwgU2Nyb2xsQmxvdCB9IGZyb20gJ3BhcmNobWVudCc7CmltcG9ydCBEZWx0YSwgeyBBdHRyaWJ1dGVNYXAsIE9wIH0gZnJvbSAncXVpbGwtZGVsdGEnOwppbXBvcnQgRW1pdHRlciBmcm9tICcuLi9jb3JlL2VtaXR0ZXIuanMnOwppbXBvcnQgQmxvY2ssIHsgQmxvY2tFbWJlZCwgYnViYmxlRm9ybWF0cyB9IGZyb20gJy4vYmxvY2suanMnOwppbXBvcnQgQnJlYWsgZnJvbSAnLi9icmVhay5qcyc7CmltcG9ydCBDb250YWluZXIgZnJvbSAnLi9jb250YWluZXIuanMnOwpmdW5jdGlvbiBpc0xpbmUoYmxvdCkgewogIHJldHVybiBibG90IGluc3RhbmNlb2YgQmxvY2sgfHwgYmxvdCBpbnN0YW5jZW9mIEJsb2NrRW1iZWQ7Cn0KZnVuY3Rpb24gaXNVcGRhdGFibGUoYmxvdCkgewogIHJldHVybiB0eXBlb2YgYmxvdC51cGRhdGVDb250ZW50ID09PSAnZnVuY3Rpb24nOwp9CmNsYXNzIFNjcm9sbCBleHRlbmRzIFNjcm9sbEJsb3QgewogIGNvbnN0cnVjdG9yKHJlZ2lzdHJ5LCBkb21Ob2RlLCBfcmVmKSB7CiAgICBsZXQgewogICAgICBlbWl0dGVyCiAgICB9ID0gX3JlZjsKICAgIHN1cGVyKHJlZ2lzdHJ5LCBkb21Ob2RlKTsKICAgIHRoaXMuZW1pdHRlciA9IGVtaXR0ZXI7CiAgICB0aGlzLmJhdGNoID0gZmFsc2U7CiAgICB0aGlzLm9wdGltaXplKCk7CiAgICB0aGlzLmVuYWJsZSgpOwogICAgdGhpcy5kb21Ob2RlLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGUgPT4gdGhpcy5oYW5kbGVEcmFnU3RhcnQoZSkpOwogIH0KICBiYXRjaFN0YXJ0KCkgewogICAgaWYgKCFBcnJheS5pc0FycmF5KHRoaXMuYmF0Y2gpKSB7CiAgICAgIHRoaXMuYmF0Y2ggPSBbXTsKICAgIH0KICB9CiAgYmF0Y2hFbmQoKSB7CiAgICBpZiAoIXRoaXMuYmF0Y2gpIHJldHVybjsKICAgIGNvbnN0IG11dGF0aW9ucyA9IHRoaXMuYmF0Y2g7CiAgICB0aGlzLmJhdGNoID0gZmFsc2U7CiAgICB0aGlzLnVwZGF0ZShtdXRhdGlvbnMpOwogIH0KICBlbWl0TW91bnQoYmxvdCkgewogICAgdGhpcy5lbWl0dGVyLmVtaXQoRW1pdHRlci5ldmVudHMuU0NST0xMX0JMT1RfTU9VTlQsIGJsb3QpOwogIH0KICBlbWl0VW5tb3VudChibG90KSB7CiAgICB0aGlzLmVtaXR0ZXIuZW1pdChFbWl0dGVyLmV2ZW50cy5TQ1JPTExfQkxPVF9VTk1PVU5ULCBibG90KTsKICB9CiAgZW1pdEVtYmVkVXBkYXRlKGJsb3QsIGNoYW5nZSkgewogICAgdGhpcy5lbWl0dGVyLmVtaXQoRW1pdHRlci5ldmVudHMuU0NST0xMX0VNQkVEX1VQREFURSwgYmxvdCwgY2hhbmdlKTsKICB9CiAgZGVsZXRlQXQoaW5kZXgsIGxlbmd0aCkgewogICAgY29uc3QgW2ZpcnN0LCBvZmZzZXRdID0gdGhpcy5saW5lKGluZGV4KTsKICAgIGNvbnN0IFtsYXN0XSA9IHRoaXMubGluZShpbmRleCArIGxlbmd0aCk7CiAgICBzdXBlci5kZWxldGVBdChpbmRleCwgbGVuZ3RoKTsKICAgIGlmIChsYXN0ICE9IG51bGwgJiYgZmlyc3QgIT09IGxhc3QgJiYgb2Zmc2V0ID4gMCkgewogICAgICBpZiAoZmlyc3QgaW5zdGFuY2VvZiBCbG9ja0VtYmVkIHx8IGxhc3QgaW5zdGFuY2VvZiBCbG9ja0VtYmVkKSB7CiAgICAgICAgdGhpcy5vcHRpbWl6ZSgpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCByZWYgPSBsYXN0LmNoaWxkcmVuLmhlYWQgaW5zdGFuY2VvZiBCcmVhayA/IG51bGwgOiBsYXN0LmNoaWxkcmVuLmhlYWQ7CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IKICAgICAgZmlyc3QubW92ZUNoaWxkcmVuKGxhc3QsIHJlZik7CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IKICAgICAgZmlyc3QucmVtb3ZlKCk7CiAgICB9CiAgICB0aGlzLm9wdGltaXplKCk7CiAgfQogIGVuYWJsZSgpIHsKICAgIGxldCBlbmFibGVkID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB0cnVlOwogICAgdGhpcy5kb21Ob2RlLnNldEF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJywgZW5hYmxlZCA/ICd0cnVlJyA6ICdmYWxzZScpOwogIH0KICBmb3JtYXRBdChpbmRleCwgbGVuZ3RoLCBmb3JtYXQsIHZhbHVlKSB7CiAgICBzdXBlci5mb3JtYXRBdChpbmRleCwgbGVuZ3RoLCBmb3JtYXQsIHZhbHVlKTsKICAgIHRoaXMub3B0aW1pemUoKTsKICB9CiAgaW5zZXJ0QXQoaW5kZXgsIHZhbHVlLCBkZWYpIHsKICAgIGlmIChpbmRleCA+PSB0aGlzLmxlbmd0aCgpKSB7CiAgICAgIGlmIChkZWYgPT0gbnVsbCB8fCB0aGlzLnNjcm9sbC5xdWVyeSh2YWx1ZSwgU2NvcGUuQkxPQ0spID09IG51bGwpIHsKICAgICAgICBjb25zdCBibG90ID0gdGhpcy5zY3JvbGwuY3JlYXRlKHRoaXMuc3RhdGljcy5kZWZhdWx0Q2hpbGQuYmxvdE5hbWUpOwogICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQoYmxvdCk7CiAgICAgICAgaWYgKGRlZiA9PSBudWxsICYmIHZhbHVlLmVuZHNXaXRoKCdcbicpKSB7CiAgICAgICAgICBibG90Lmluc2VydEF0KDAsIHZhbHVlLnNsaWNlKDAsIC0xKSwgZGVmKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYmxvdC5pbnNlcnRBdCgwLCB2YWx1ZSwgZGVmKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZW1iZWQgPSB0aGlzLnNjcm9sbC5jcmVhdGUodmFsdWUsIGRlZik7CiAgICAgICAgdGhpcy5hcHBlbmRDaGlsZChlbWJlZCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHN1cGVyLmluc2VydEF0KGluZGV4LCB2YWx1ZSwgZGVmKTsKICAgIH0KICAgIHRoaXMub3B0aW1pemUoKTsKICB9CiAgaW5zZXJ0QmVmb3JlKGJsb3QsIHJlZikgewogICAgaWYgKGJsb3Quc3RhdGljcy5zY29wZSA9PT0gU2NvcGUuSU5MSU5FX0JMT1QpIHsKICAgICAgY29uc3Qgd3JhcHBlciA9IHRoaXMuc2Nyb2xsLmNyZWF0ZSh0aGlzLnN0YXRpY3MuZGVmYXVsdENoaWxkLmJsb3ROYW1lKTsKICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChibG90KTsKICAgICAgc3VwZXIuaW5zZXJ0QmVmb3JlKHdyYXBwZXIsIHJlZik7CiAgICB9IGVsc2UgewogICAgICBzdXBlci5pbnNlcnRCZWZvcmUoYmxvdCwgcmVmKTsKICAgIH0KICB9CiAgaW5zZXJ0Q29udGVudHMoaW5kZXgsIGRlbHRhKSB7CiAgICBjb25zdCByZW5kZXJCbG9ja3MgPSB0aGlzLmRlbHRhVG9SZW5kZXJCbG9ja3MoZGVsdGEuY29uY2F0KG5ldyBEZWx0YSgpLmluc2VydCgnXG4nKSkpOwogICAgY29uc3QgbGFzdCA9IHJlbmRlckJsb2Nrcy5wb3AoKTsKICAgIGlmIChsYXN0ID09IG51bGwpIHJldHVybjsKICAgIHRoaXMuYmF0Y2hTdGFydCgpOwogICAgY29uc3QgZmlyc3QgPSByZW5kZXJCbG9ja3Muc2hpZnQoKTsKICAgIGlmIChmaXJzdCkgewogICAgICBjb25zdCBzaG91bGRJbnNlcnROZXdsaW5lQ2hhciA9IGZpcnN0LnR5cGUgPT09ICdibG9jaycgJiYgKGZpcnN0LmRlbHRhLmxlbmd0aCgpID09PSAwIHx8ICF0aGlzLmRlc2NlbmRhbnQoQmxvY2tFbWJlZCwgaW5kZXgpWzBdICYmIGluZGV4IDwgdGhpcy5sZW5ndGgoKSk7CiAgICAgIGNvbnN0IGRlbHRhID0gZmlyc3QudHlwZSA9PT0gJ2Jsb2NrJyA/IGZpcnN0LmRlbHRhIDogbmV3IERlbHRhKCkuaW5zZXJ0KHsKICAgICAgICBbZmlyc3Qua2V5XTogZmlyc3QudmFsdWUKICAgICAgfSk7CiAgICAgIGluc2VydElubGluZUNvbnRlbnRzKHRoaXMsIGluZGV4LCBkZWx0YSk7CiAgICAgIGNvbnN0IG5ld2xpbmVDaGFyTGVuZ3RoID0gZmlyc3QudHlwZSA9PT0gJ2Jsb2NrJyA/IDEgOiAwOwogICAgICBjb25zdCBsaW5lRW5kSW5kZXggPSBpbmRleCArIGRlbHRhLmxlbmd0aCgpICsgbmV3bGluZUNoYXJMZW5ndGg7CiAgICAgIGlmIChzaG91bGRJbnNlcnROZXdsaW5lQ2hhcikgewogICAgICAgIHRoaXMuaW5zZXJ0QXQobGluZUVuZEluZGV4IC0gMSwgJ1xuJyk7CiAgICAgIH0KICAgICAgY29uc3QgZm9ybWF0cyA9IGJ1YmJsZUZvcm1hdHModGhpcy5saW5lKGluZGV4KVswXSk7CiAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBBdHRyaWJ1dGVNYXAuZGlmZihmb3JtYXRzLCBmaXJzdC5hdHRyaWJ1dGVzKSB8fCB7fTsKICAgICAgT2JqZWN0LmtleXMoYXR0cmlidXRlcykuZm9yRWFjaChuYW1lID0+IHsKICAgICAgICB0aGlzLmZvcm1hdEF0KGxpbmVFbmRJbmRleCAtIDEsIDEsIG5hbWUsIGF0dHJpYnV0ZXNbbmFtZV0pOwogICAgICB9KTsKICAgICAgaW5kZXggPSBsaW5lRW5kSW5kZXg7CiAgICB9CiAgICBsZXQgW3JlZkJsb3QsIHJlZkJsb3RPZmZzZXRdID0gdGhpcy5jaGlsZHJlbi5maW5kKGluZGV4KTsKICAgIGlmIChyZW5kZXJCbG9ja3MubGVuZ3RoKSB7CiAgICAgIGlmIChyZWZCbG90KSB7CiAgICAgICAgcmVmQmxvdCA9IHJlZkJsb3Quc3BsaXQocmVmQmxvdE9mZnNldCk7CiAgICAgICAgcmVmQmxvdE9mZnNldCA9IDA7CiAgICAgIH0KICAgICAgcmVuZGVyQmxvY2tzLmZvckVhY2gocmVuZGVyQmxvY2sgPT4gewogICAgICAgIGlmIChyZW5kZXJCbG9jay50eXBlID09PSAnYmxvY2snKSB7CiAgICAgICAgICBjb25zdCBibG9jayA9IHRoaXMuY3JlYXRlQmxvY2socmVuZGVyQmxvY2suYXR0cmlidXRlcywgcmVmQmxvdCB8fCB1bmRlZmluZWQpOwogICAgICAgICAgaW5zZXJ0SW5saW5lQ29udGVudHMoYmxvY2ssIDAsIHJlbmRlckJsb2NrLmRlbHRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3QgYmxvY2tFbWJlZCA9IHRoaXMuY3JlYXRlKHJlbmRlckJsb2NrLmtleSwgcmVuZGVyQmxvY2sudmFsdWUpOwogICAgICAgICAgdGhpcy5pbnNlcnRCZWZvcmUoYmxvY2tFbWJlZCwgcmVmQmxvdCB8fCB1bmRlZmluZWQpOwogICAgICAgICAgT2JqZWN0LmtleXMocmVuZGVyQmxvY2suYXR0cmlidXRlcykuZm9yRWFjaChuYW1lID0+IHsKICAgICAgICAgICAgYmxvY2tFbWJlZC5mb3JtYXQobmFtZSwgcmVuZGVyQmxvY2suYXR0cmlidXRlc1tuYW1lXSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgaWYgKGxhc3QudHlwZSA9PT0gJ2Jsb2NrJyAmJiBsYXN0LmRlbHRhLmxlbmd0aCgpKSB7CiAgICAgIGNvbnN0IG9mZnNldCA9IHJlZkJsb3QgPyByZWZCbG90Lm9mZnNldChyZWZCbG90LnNjcm9sbCkgKyByZWZCbG90T2Zmc2V0IDogdGhpcy5sZW5ndGgoKTsKICAgICAgaW5zZXJ0SW5saW5lQ29udGVudHModGhpcywgb2Zmc2V0LCBsYXN0LmRlbHRhKTsKICAgIH0KICAgIHRoaXMuYmF0Y2hFbmQoKTsKICAgIHRoaXMub3B0aW1pemUoKTsKICB9CiAgaXNFbmFibGVkKCkgewogICAgcmV0dXJuIHRoaXMuZG9tTm9kZS5nZXRBdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScpID09PSAndHJ1ZSc7CiAgfQogIGxlYWYoaW5kZXgpIHsKICAgIGNvbnN0IGxhc3QgPSB0aGlzLnBhdGgoaW5kZXgpLnBvcCgpOwogICAgaWYgKCFsYXN0KSB7CiAgICAgIHJldHVybiBbbnVsbCwgLTFdOwogICAgfQogICAgY29uc3QgW2Jsb3QsIG9mZnNldF0gPSBsYXN0OwogICAgcmV0dXJuIGJsb3QgaW5zdGFuY2VvZiBMZWFmQmxvdCA/IFtibG90LCBvZmZzZXRdIDogW251bGwsIC0xXTsKICB9CiAgbGluZShpbmRleCkgewogICAgaWYgKGluZGV4ID09PSB0aGlzLmxlbmd0aCgpKSB7CiAgICAgIHJldHVybiB0aGlzLmxpbmUoaW5kZXggLSAxKTsKICAgIH0KICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogbWFrZSBkZXNjZW5kYW50KCkgZ2VuZXJpYwogICAgcmV0dXJuIHRoaXMuZGVzY2VuZGFudChpc0xpbmUsIGluZGV4KTsKICB9CiAgbGluZXMoKSB7CiAgICBsZXQgaW5kZXggPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDA7CiAgICBsZXQgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBOdW1iZXIuTUFYX1ZBTFVFOwogICAgY29uc3QgZ2V0TGluZXMgPSAoYmxvdCwgYmxvdEluZGV4LCBibG90TGVuZ3RoKSA9PiB7CiAgICAgIGxldCBsaW5lcyA9IFtdOwogICAgICBsZXQgbGVuZ3RoTGVmdCA9IGJsb3RMZW5ndGg7CiAgICAgIGJsb3QuY2hpbGRyZW4uZm9yRWFjaEF0KGJsb3RJbmRleCwgYmxvdExlbmd0aCwgKGNoaWxkLCBjaGlsZEluZGV4LCBjaGlsZExlbmd0aCkgPT4gewogICAgICAgIGlmIChpc0xpbmUoY2hpbGQpKSB7CiAgICAgICAgICBsaW5lcy5wdXNoKGNoaWxkKTsKICAgICAgICB9IGVsc2UgaWYgKGNoaWxkIGluc3RhbmNlb2YgQ29udGFpbmVyQmxvdCkgewogICAgICAgICAgbGluZXMgPSBsaW5lcy5jb25jYXQoZ2V0TGluZXMoY2hpbGQsIGNoaWxkSW5kZXgsIGxlbmd0aExlZnQpKTsKICAgICAgICB9CiAgICAgICAgbGVuZ3RoTGVmdCAtPSBjaGlsZExlbmd0aDsKICAgICAgfSk7CiAgICAgIHJldHVybiBsaW5lczsKICAgIH07CiAgICByZXR1cm4gZ2V0TGluZXModGhpcywgaW5kZXgsIGxlbmd0aCk7CiAgfQogIG9wdGltaXplKCkgewogICAgbGV0IG11dGF0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107CiAgICBsZXQgY29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICBpZiAodGhpcy5iYXRjaCkgcmV0dXJuOwogICAgc3VwZXIub3B0aW1pemUobXV0YXRpb25zLCBjb250ZXh0KTsKICAgIGlmIChtdXRhdGlvbnMubGVuZ3RoID4gMCkgewogICAgICB0aGlzLmVtaXR0ZXIuZW1pdChFbWl0dGVyLmV2ZW50cy5TQ1JPTExfT1BUSU1JWkUsIG11dGF0aW9ucywgY29udGV4dCk7CiAgICB9CiAgfQogIHBhdGgoaW5kZXgpIHsKICAgIHJldHVybiBzdXBlci5wYXRoKGluZGV4KS5zbGljZSgxKTsgLy8gRXhjbHVkZSBzZWxmCiAgfQogIHJlbW92ZSgpIHsKICAgIC8vIE5ldmVyIHJlbW92ZSBzZWxmCiAgfQogIHVwZGF0ZShtdXRhdGlvbnMpIHsKICAgIGlmICh0aGlzLmJhdGNoKSB7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KG11dGF0aW9ucykpIHsKICAgICAgICB0aGlzLmJhdGNoID0gdGhpcy5iYXRjaC5jb25jYXQobXV0YXRpb25zKTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgc291cmNlID0gRW1pdHRlci5zb3VyY2VzLlVTRVI7CiAgICBpZiAodHlwZW9mIG11dGF0aW9ucyA9PT0gJ3N0cmluZycpIHsKICAgICAgc291cmNlID0gbXV0YXRpb25zOwogICAgfQogICAgaWYgKCFBcnJheS5pc0FycmF5KG11dGF0aW9ucykpIHsKICAgICAgbXV0YXRpb25zID0gdGhpcy5vYnNlcnZlci50YWtlUmVjb3JkcygpOwogICAgfQogICAgbXV0YXRpb25zID0gbXV0YXRpb25zLmZpbHRlcihfcmVmMiA9PiB7CiAgICAgIGxldCB7CiAgICAgICAgdGFyZ2V0CiAgICAgIH0gPSBfcmVmMjsKICAgICAgY29uc3QgYmxvdCA9IHRoaXMuZmluZCh0YXJnZXQsIHRydWUpOwogICAgICByZXR1cm4gYmxvdCAmJiAhaXNVcGRhdGFibGUoYmxvdCk7CiAgICB9KTsKICAgIGlmIChtdXRhdGlvbnMubGVuZ3RoID4gMCkgewogICAgICB0aGlzLmVtaXR0ZXIuZW1pdChFbWl0dGVyLmV2ZW50cy5TQ1JPTExfQkVGT1JFX1VQREFURSwgc291cmNlLCBtdXRhdGlvbnMpOwogICAgfQogICAgc3VwZXIudXBkYXRlKG11dGF0aW9ucy5jb25jYXQoW10pKTsgLy8gcGFzcyBjb3B5CiAgICBpZiAobXV0YXRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgdGhpcy5lbWl0dGVyLmVtaXQoRW1pdHRlci5ldmVudHMuU0NST0xMX1VQREFURSwgc291cmNlLCBtdXRhdGlvbnMpOwogICAgfQogIH0KICB1cGRhdGVFbWJlZEF0KGluZGV4LCBrZXksIGNoYW5nZSkgewogICAgLy8gQ3VycmVudGx5IGl0IG9ubHkgc3VwcG9ydHMgdG9wLWxldmVsIGVtYmVkcyAoQmxvY2tFbWJlZCkuCiAgICAvLyBXZSBjYW4gdXBkYXRlIGBQYXJlbnRCbG90YCBpbiBwYXJjaG1lbnQgdG8gc3VwcG9ydCBpbmxpbmUgZW1iZWRzLgogICAgY29uc3QgW2Jsb3RdID0gdGhpcy5kZXNjZW5kYW50KGIgPT4gYiBpbnN0YW5jZW9mIEJsb2NrRW1iZWQsIGluZGV4KTsKICAgIGlmIChibG90ICYmIGJsb3Quc3RhdGljcy5ibG90TmFtZSA9PT0ga2V5ICYmIGlzVXBkYXRhYmxlKGJsb3QpKSB7CiAgICAgIGJsb3QudXBkYXRlQ29udGVudChjaGFuZ2UpOwogICAgfQogIH0KICBoYW5kbGVEcmFnU3RhcnQoZXZlbnQpIHsKICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgfQogIGRlbHRhVG9SZW5kZXJCbG9ja3MoZGVsdGEpIHsKICAgIGNvbnN0IHJlbmRlckJsb2NrcyA9IFtdOwogICAgbGV0IGN1cnJlbnRCbG9ja0RlbHRhID0gbmV3IERlbHRhKCk7CiAgICBkZWx0YS5mb3JFYWNoKG9wID0+IHsKICAgICAgY29uc3QgaW5zZXJ0ID0gb3AgPT09IG51bGwgfHwgb3AgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wLmluc2VydDsKICAgICAgaWYgKCFpbnNlcnQpIHJldHVybjsKICAgICAgaWYgKHR5cGVvZiBpbnNlcnQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgY29uc3Qgc3BsaXR0ZWQgPSBpbnNlcnQuc3BsaXQoJ1xuJyk7CiAgICAgICAgc3BsaXR0ZWQuc2xpY2UoMCwgLTEpLmZvckVhY2godGV4dCA9PiB7CiAgICAgICAgICB2YXIgX29wJGF0dHJpYnV0ZXM7CiAgICAgICAgICBjdXJyZW50QmxvY2tEZWx0YS5pbnNlcnQodGV4dCwgb3AuYXR0cmlidXRlcyk7CiAgICAgICAgICByZW5kZXJCbG9ja3MucHVzaCh7CiAgICAgICAgICAgIHR5cGU6ICdibG9jaycsCiAgICAgICAgICAgIGRlbHRhOiBjdXJyZW50QmxvY2tEZWx0YSwKICAgICAgICAgICAgYXR0cmlidXRlczogKF9vcCRhdHRyaWJ1dGVzID0gb3AuYXR0cmlidXRlcykgIT09IG51bGwgJiYgX29wJGF0dHJpYnV0ZXMgIT09IHZvaWQgMCA/IF9vcCRhdHRyaWJ1dGVzIDoge30KICAgICAgICAgIH0pOwogICAgICAgICAgY3VycmVudEJsb2NrRGVsdGEgPSBuZXcgRGVsdGEoKTsKICAgICAgICB9KTsKICAgICAgICBjb25zdCBsYXN0ID0gc3BsaXR0ZWRbc3BsaXR0ZWQubGVuZ3RoIC0gMV07CiAgICAgICAgaWYgKGxhc3QpIHsKICAgICAgICAgIGN1cnJlbnRCbG9ja0RlbHRhLmluc2VydChsYXN0LCBvcC5hdHRyaWJ1dGVzKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3Qga2V5ID0gT2JqZWN0LmtleXMoaW5zZXJ0KVswXTsKICAgICAgICBpZiAoIWtleSkgcmV0dXJuOwogICAgICAgIGlmICh0aGlzLnF1ZXJ5KGtleSwgU2NvcGUuSU5MSU5FKSkgewogICAgICAgICAgY3VycmVudEJsb2NrRGVsdGEucHVzaChvcCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBfb3AkYXR0cmlidXRlczI7CiAgICAgICAgICBpZiAoY3VycmVudEJsb2NrRGVsdGEubGVuZ3RoKCkpIHsKICAgICAgICAgICAgcmVuZGVyQmxvY2tzLnB1c2goewogICAgICAgICAgICAgIHR5cGU6ICdibG9jaycsCiAgICAgICAgICAgICAgZGVsdGE6IGN1cnJlbnRCbG9ja0RlbHRhLAogICAgICAgICAgICAgIGF0dHJpYnV0ZXM6IHt9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgY3VycmVudEJsb2NrRGVsdGEgPSBuZXcgRGVsdGEoKTsKICAgICAgICAgIHJlbmRlckJsb2Nrcy5wdXNoKHsKICAgICAgICAgICAgdHlwZTogJ2Jsb2NrRW1iZWQnLAogICAgICAgICAgICBrZXksCiAgICAgICAgICAgIHZhbHVlOiBpbnNlcnRba2V5XSwKICAgICAgICAgICAgYXR0cmlidXRlczogKF9vcCRhdHRyaWJ1dGVzMiA9IG9wLmF0dHJpYnV0ZXMpICE9PSBudWxsICYmIF9vcCRhdHRyaWJ1dGVzMiAhPT0gdm9pZCAwID8gX29wJGF0dHJpYnV0ZXMyIDoge30KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICBpZiAoY3VycmVudEJsb2NrRGVsdGEubGVuZ3RoKCkpIHsKICAgICAgcmVuZGVyQmxvY2tzLnB1c2goewogICAgICAgIHR5cGU6ICdibG9jaycsCiAgICAgICAgZGVsdGE6IGN1cnJlbnRCbG9ja0RlbHRhLAogICAgICAgIGF0dHJpYnV0ZXM6IHt9CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIHJlbmRlckJsb2NrczsKICB9CiAgY3JlYXRlQmxvY2soYXR0cmlidXRlcywgcmVmQmxvdCkgewogICAgbGV0IGJsb3ROYW1lOwogICAgY29uc3QgZm9ybWF0cyA9IHt9OwogICAgT2JqZWN0LmVudHJpZXMoYXR0cmlidXRlcykuZm9yRWFjaChfcmVmMyA9PiB7CiAgICAgIGxldCBba2V5LCB2YWx1ZV0gPSBfcmVmMzsKICAgICAgY29uc3QgaXNCbG9ja0Jsb3QgPSB0aGlzLnF1ZXJ5KGtleSwgU2NvcGUuQkxPQ0sgJiBTY29wZS5CTE9UKSAhPSBudWxsOwogICAgICBpZiAoaXNCbG9ja0Jsb3QpIHsKICAgICAgICBibG90TmFtZSA9IGtleTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3JtYXRzW2tleV0gPSB2YWx1ZTsKICAgICAgfQogICAgfSk7CiAgICBjb25zdCBibG9jayA9IHRoaXMuY3JlYXRlKGJsb3ROYW1lIHx8IHRoaXMuc3RhdGljcy5kZWZhdWx0Q2hpbGQuYmxvdE5hbWUsIGJsb3ROYW1lID8gYXR0cmlidXRlc1tibG90TmFtZV0gOiB1bmRlZmluZWQpOwogICAgdGhpcy5pbnNlcnRCZWZvcmUoYmxvY2ssIHJlZkJsb3QgfHwgdW5kZWZpbmVkKTsKICAgIGNvbnN0IGxlbmd0aCA9IGJsb2NrLmxlbmd0aCgpOwogICAgT2JqZWN0LmVudHJpZXMoZm9ybWF0cykuZm9yRWFjaChfcmVmNCA9PiB7CiAgICAgIGxldCBba2V5LCB2YWx1ZV0gPSBfcmVmNDsKICAgICAgYmxvY2suZm9ybWF0QXQoMCwgbGVuZ3RoLCBrZXksIHZhbHVlKTsKICAgIH0pOwogICAgcmV0dXJuIGJsb2NrOwogIH0KfQpfZGVmaW5lUHJvcGVydHkoU2Nyb2xsLCAiYmxvdE5hbWUiLCAnc2Nyb2xsJyk7Cl9kZWZpbmVQcm9wZXJ0eShTY3JvbGwsICJjbGFzc05hbWUiLCAncWwtZWRpdG9yJyk7Cl9kZWZpbmVQcm9wZXJ0eShTY3JvbGwsICJ0YWdOYW1lIiwgJ0RJVicpOwpfZGVmaW5lUHJvcGVydHkoU2Nyb2xsLCAiZGVmYXVsdENoaWxkIiwgQmxvY2spOwpfZGVmaW5lUHJvcGVydHkoU2Nyb2xsLCAiYWxsb3dlZENoaWxkcmVuIiwgW0Jsb2NrLCBCbG9ja0VtYmVkLCBDb250YWluZXJdKTsKZnVuY3Rpb24gaW5zZXJ0SW5saW5lQ29udGVudHMocGFyZW50LCBpbmRleCwgaW5saW5lQ29udGVudHMpIHsKICBpbmxpbmVDb250ZW50cy5yZWR1Y2UoKGluZGV4LCBvcCkgPT4gewogICAgY29uc3QgbGVuZ3RoID0gT3AubGVuZ3RoKG9wKTsKICAgIGxldCBhdHRyaWJ1dGVzID0gb3AuYXR0cmlidXRlcyB8fCB7fTsKICAgIGlmIChvcC5pbnNlcnQgIT0gbnVsbCkgewogICAgICBpZiAodHlwZW9mIG9wLmluc2VydCA9PT0gJ3N0cmluZycpIHsKICAgICAgICBjb25zdCB0ZXh0ID0gb3AuaW5zZXJ0OwogICAgICAgIHBhcmVudC5pbnNlcnRBdChpbmRleCwgdGV4dCk7CiAgICAgICAgY29uc3QgW2xlYWZdID0gcGFyZW50LmRlc2NlbmRhbnQoTGVhZkJsb3QsIGluZGV4KTsKICAgICAgICBjb25zdCBmb3JtYXRzID0gYnViYmxlRm9ybWF0cyhsZWFmKTsKICAgICAgICBhdHRyaWJ1dGVzID0gQXR0cmlidXRlTWFwLmRpZmYoZm9ybWF0cywgYXR0cmlidXRlcykgfHwge307CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9wLmluc2VydCA9PT0gJ29iamVjdCcpIHsKICAgICAgICBjb25zdCBrZXkgPSBPYmplY3Qua2V5cyhvcC5pbnNlcnQpWzBdOyAvLyBUaGVyZSBzaG91bGQgb25seSBiZSBvbmUga2V5CiAgICAgICAgaWYgKGtleSA9PSBudWxsKSByZXR1cm4gaW5kZXg7CiAgICAgICAgcGFyZW50Lmluc2VydEF0KGluZGV4LCBrZXksIG9wLmluc2VydFtrZXldKTsKICAgICAgICBjb25zdCBpc0lubGluZUVtYmVkID0gcGFyZW50LnNjcm9sbC5xdWVyeShrZXksIFNjb3BlLklOTElORSkgIT0gbnVsbDsKICAgICAgICBpZiAoaXNJbmxpbmVFbWJlZCkgewogICAgICAgICAgY29uc3QgW2xlYWZdID0gcGFyZW50LmRlc2NlbmRhbnQoTGVhZkJsb3QsIGluZGV4KTsKICAgICAgICAgIGNvbnN0IGZvcm1hdHMgPSBidWJibGVGb3JtYXRzKGxlYWYpOwogICAgICAgICAgYXR0cmlidXRlcyA9IEF0dHJpYnV0ZU1hcC5kaWZmKGZvcm1hdHMsIGF0dHJpYnV0ZXMpIHx8IHt9OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgT2JqZWN0LmtleXMoYXR0cmlidXRlcykuZm9yRWFjaChrZXkgPT4gewogICAgICBwYXJlbnQuZm9ybWF0QXQoaW5kZXgsIGxlbmd0aCwga2V5LCBhdHRyaWJ1dGVzW2tleV0pOwogICAgfSk7CiAgICByZXR1cm4gaW5kZXggKyBsZW5ndGg7CiAgfSwgaW5kZXgpOwp9CmV4cG9ydCBkZWZhdWx0IFNjcm9sbDs="},{"version":3,"names":["ContainerBlot","LeafBlot","Scope","ScrollBlot","Delta","AttributeMap","Op","Emitter","Block","BlockEmbed","bubbleFormats","Break","Container","isLine","blot","isUpdatable","updateContent","Scroll","constructor","registry","domNode","_ref","emitter","batch","optimize","enable","addEventListener","e","handleDragStart","batchStart","Array","isArray","batchEnd","mutations","update","emitMount","emit","events","SCROLL_BLOT_MOUNT","emitUnmount","SCROLL_BLOT_UNMOUNT","emitEmbedUpdate","change","SCROLL_EMBED_UPDATE","deleteAt","index","length","first","offset","line","last","ref","children","head","moveChildren","remove","enabled","arguments","undefined","setAttribute","formatAt","format","value","insertAt","def","scroll","query","BLOCK","create","statics","defaultChild","blotName","appendChild","endsWith","slice","embed","insertBefore","scope","INLINE_BLOT","wrapper","insertContents","delta","renderBlocks","deltaToRenderBlocks","concat","insert","pop","shift","shouldInsertNewlineChar","type","descendant","key","insertInlineContents","newlineCharLength","lineEndIndex","formats","attributes","diff","Object","keys","forEach","name","refBlot","refBlotOffset","find","split","renderBlock","block","createBlock","blockEmbed","isEnabled","getAttribute","leaf","path","lines","Number","MAX_VALUE","getLines","blotIndex","blotLength","lengthLeft","forEachAt","child","childIndex","childLength","push","context","SCROLL_OPTIMIZE","source","sources","USER","observer","takeRecords","filter","_ref2","target","SCROLL_BEFORE_UPDATE","SCROLL_UPDATE","updateEmbedAt","b","event","preventDefault","currentBlockDelta","op","splitted","text","_op$attributes","INLINE","_op$attributes2","entries","_ref3","isBlockBlot","BLOT","_ref4","_defineProperty","parent","inlineContents","reduce","isInlineEmbed"],"sources":["../../src/blots/scroll.ts"],"sourcesContent":["import { ContainerBlot, LeafBlot, Scope, ScrollBlot } from 'parchment';\nimport type { Blot, Parent, EmbedBlot, ParentBlot, Registry } from 'parchment';\nimport Delta, { AttributeMap, Op } from 'quill-delta';\nimport Emitter from '../core/emitter.js';\nimport type { EmitterSource } from '../core/emitter.js';\nimport Block, { BlockEmbed, bubbleFormats } from './block.js';\nimport Break from './break.js';\nimport Container from './container.js';\n\ntype RenderBlock =\n  | {\n      type: 'blockEmbed';\n      attributes: AttributeMap;\n      key: string;\n      value: unknown;\n    }\n  | { type: 'block'; attributes: AttributeMap; delta: Delta };\n\nfunction isLine(blot: unknown): blot is Block | BlockEmbed {\n  return blot instanceof Block || blot instanceof BlockEmbed;\n}\n\ninterface UpdatableEmbed {\n  updateContent(change: unknown): void;\n}\n\nfunction isUpdatable(blot: Blot): blot is Blot & UpdatableEmbed {\n  return typeof (blot as unknown as any).updateContent === 'function';\n}\n\nclass Scroll extends ScrollBlot {\n  static blotName = 'scroll';\n  static className = 'ql-editor';\n  static tagName = 'DIV';\n  static defaultChild = Block;\n  static allowedChildren = [Block, BlockEmbed, Container];\n\n  emitter: Emitter;\n  batch: false | MutationRecord[];\n\n  constructor(\n    registry: Registry,\n    domNode: HTMLDivElement,\n    { emitter }: { emitter: Emitter },\n  ) {\n    super(registry, domNode);\n    this.emitter = emitter;\n    this.batch = false;\n    this.optimize();\n    this.enable();\n    this.domNode.addEventListener('dragstart', (e) => this.handleDragStart(e));\n  }\n\n  batchStart() {\n    if (!Array.isArray(this.batch)) {\n      this.batch = [];\n    }\n  }\n\n  batchEnd() {\n    if (!this.batch) return;\n    const mutations = this.batch;\n    this.batch = false;\n    this.update(mutations);\n  }\n\n  emitMount(blot: Blot) {\n    this.emitter.emit(Emitter.events.SCROLL_BLOT_MOUNT, blot);\n  }\n\n  emitUnmount(blot: Blot) {\n    this.emitter.emit(Emitter.events.SCROLL_BLOT_UNMOUNT, blot);\n  }\n\n  emitEmbedUpdate(blot: Blot, change: unknown) {\n    this.emitter.emit(Emitter.events.SCROLL_EMBED_UPDATE, blot, change);\n  }\n\n  deleteAt(index: number, length: number) {\n    const [first, offset] = this.line(index);\n    const [last] = this.line(index + length);\n    super.deleteAt(index, length);\n    if (last != null && first !== last && offset > 0) {\n      if (first instanceof BlockEmbed || last instanceof BlockEmbed) {\n        this.optimize();\n        return;\n      }\n      const ref =\n        last.children.head instanceof Break ? null : last.children.head;\n      // @ts-expect-error\n      first.moveChildren(last, ref);\n      // @ts-expect-error\n      first.remove();\n    }\n    this.optimize();\n  }\n\n  enable(enabled = true) {\n    this.domNode.setAttribute('contenteditable', enabled ? 'true' : 'false');\n  }\n\n  formatAt(index: number, length: number, format: string, value: unknown) {\n    super.formatAt(index, length, format, value);\n    this.optimize();\n  }\n\n  insertAt(index: number, value: string, def?: unknown) {\n    if (index >= this.length()) {\n      if (def == null || this.scroll.query(value, Scope.BLOCK) == null) {\n        const blot = this.scroll.create(this.statics.defaultChild.blotName);\n        this.appendChild(blot);\n        if (def == null && value.endsWith('\\n')) {\n          blot.insertAt(0, value.slice(0, -1), def);\n        } else {\n          blot.insertAt(0, value, def);\n        }\n      } else {\n        const embed = this.scroll.create(value, def);\n        this.appendChild(embed);\n      }\n    } else {\n      super.insertAt(index, value, def);\n    }\n    this.optimize();\n  }\n\n  insertBefore(blot: Blot, ref?: Blot | null) {\n    if (blot.statics.scope === Scope.INLINE_BLOT) {\n      const wrapper = this.scroll.create(\n        this.statics.defaultChild.blotName,\n      ) as Parent;\n      wrapper.appendChild(blot);\n      super.insertBefore(wrapper, ref);\n    } else {\n      super.insertBefore(blot, ref);\n    }\n  }\n\n  insertContents(index: number, delta: Delta) {\n    const renderBlocks = this.deltaToRenderBlocks(\n      delta.concat(new Delta().insert('\\n')),\n    );\n    const last = renderBlocks.pop();\n    if (last == null) return;\n\n    this.batchStart();\n\n    const first = renderBlocks.shift();\n    if (first) {\n      const shouldInsertNewlineChar =\n        first.type === 'block' &&\n        (first.delta.length() === 0 ||\n          (!this.descendant(BlockEmbed, index)[0] && index < this.length()));\n      const delta =\n        first.type === 'block'\n          ? first.delta\n          : new Delta().insert({ [first.key]: first.value });\n      insertInlineContents(this, index, delta);\n      const newlineCharLength = first.type === 'block' ? 1 : 0;\n      const lineEndIndex = index + delta.length() + newlineCharLength;\n      if (shouldInsertNewlineChar) {\n        this.insertAt(lineEndIndex - 1, '\\n');\n      }\n\n      const formats = bubbleFormats(this.line(index)[0]);\n      const attributes = AttributeMap.diff(formats, first.attributes) || {};\n      Object.keys(attributes).forEach((name) => {\n        this.formatAt(lineEndIndex - 1, 1, name, attributes[name]);\n      });\n\n      index = lineEndIndex;\n    }\n\n    let [refBlot, refBlotOffset] = this.children.find(index);\n    if (renderBlocks.length) {\n      if (refBlot) {\n        refBlot = refBlot.split(refBlotOffset);\n        refBlotOffset = 0;\n      }\n\n      renderBlocks.forEach((renderBlock) => {\n        if (renderBlock.type === 'block') {\n          const block = this.createBlock(\n            renderBlock.attributes,\n            refBlot || undefined,\n          );\n          insertInlineContents(block, 0, renderBlock.delta);\n        } else {\n          const blockEmbed = this.create(\n            renderBlock.key,\n            renderBlock.value,\n          ) as EmbedBlot;\n          this.insertBefore(blockEmbed, refBlot || undefined);\n          Object.keys(renderBlock.attributes).forEach((name) => {\n            blockEmbed.format(name, renderBlock.attributes[name]);\n          });\n        }\n      });\n    }\n\n    if (last.type === 'block' && last.delta.length()) {\n      const offset = refBlot\n        ? refBlot.offset(refBlot.scroll) + refBlotOffset\n        : this.length();\n      insertInlineContents(this, offset, last.delta);\n    }\n\n    this.batchEnd();\n    this.optimize();\n  }\n\n  isEnabled() {\n    return this.domNode.getAttribute('contenteditable') === 'true';\n  }\n\n  leaf(index: number): [LeafBlot | null, number] {\n    const last = this.path(index).pop();\n    if (!last) {\n      return [null, -1];\n    }\n\n    const [blot, offset] = last;\n    return blot instanceof LeafBlot ? [blot, offset] : [null, -1];\n  }\n\n  line(index: number): [Block | BlockEmbed | null, number] {\n    if (index === this.length()) {\n      return this.line(index - 1);\n    }\n    // @ts-expect-error TODO: make descendant() generic\n    return this.descendant(isLine, index);\n  }\n\n  lines(index = 0, length = Number.MAX_VALUE): (Block | BlockEmbed)[] {\n    const getLines = (\n      blot: ParentBlot,\n      blotIndex: number,\n      blotLength: number,\n    ) => {\n      let lines: (Block | BlockEmbed)[] = [];\n      let lengthLeft = blotLength;\n      blot.children.forEachAt(\n        blotIndex,\n        blotLength,\n        (child, childIndex, childLength) => {\n          if (isLine(child)) {\n            lines.push(child);\n          } else if (child instanceof ContainerBlot) {\n            lines = lines.concat(getLines(child, childIndex, lengthLeft));\n          }\n          lengthLeft -= childLength;\n        },\n      );\n      return lines;\n    };\n    return getLines(this, index, length);\n  }\n\n  optimize(context?: { [key: string]: any }): void;\n  optimize(\n    mutations?: MutationRecord[],\n    context?: { [key: string]: any },\n  ): void;\n  optimize(mutations = [], context = {}) {\n    if (this.batch) return;\n    super.optimize(mutations, context);\n    if (mutations.length > 0) {\n      this.emitter.emit(Emitter.events.SCROLL_OPTIMIZE, mutations, context);\n    }\n  }\n\n  path(index: number) {\n    return super.path(index).slice(1); // Exclude self\n  }\n\n  remove() {\n    // Never remove self\n  }\n\n  update(source?: EmitterSource): void;\n  update(mutations?: MutationRecord[]): void;\n  update(mutations?: MutationRecord[] | EmitterSource): void {\n    if (this.batch) {\n      if (Array.isArray(mutations)) {\n        this.batch = this.batch.concat(mutations);\n      }\n      return;\n    }\n    let source: EmitterSource = Emitter.sources.USER;\n    if (typeof mutations === 'string') {\n      source = mutations;\n    }\n    if (!Array.isArray(mutations)) {\n      mutations = this.observer.takeRecords();\n    }\n    mutations = mutations.filter(({ target }) => {\n      const blot = this.find(target, true);\n      return blot && !isUpdatable(blot);\n    });\n    if (mutations.length > 0) {\n      this.emitter.emit(Emitter.events.SCROLL_BEFORE_UPDATE, source, mutations);\n    }\n    super.update(mutations.concat([])); // pass copy\n    if (mutations.length > 0) {\n      this.emitter.emit(Emitter.events.SCROLL_UPDATE, source, mutations);\n    }\n  }\n\n  updateEmbedAt(index: number, key: string, change: unknown) {\n    // Currently it only supports top-level embeds (BlockEmbed).\n    // We can update `ParentBlot` in parchment to support inline embeds.\n    const [blot] = this.descendant((b: Blot) => b instanceof BlockEmbed, index);\n    if (blot && blot.statics.blotName === key && isUpdatable(blot)) {\n      blot.updateContent(change);\n    }\n  }\n\n  protected handleDragStart(event: DragEvent) {\n    event.preventDefault();\n  }\n\n  private deltaToRenderBlocks(delta: Delta) {\n    const renderBlocks: RenderBlock[] = [];\n\n    let currentBlockDelta = new Delta();\n    delta.forEach((op) => {\n      const insert = op?.insert;\n      if (!insert) return;\n      if (typeof insert === 'string') {\n        const splitted = insert.split('\\n');\n        splitted.slice(0, -1).forEach((text) => {\n          currentBlockDelta.insert(text, op.attributes);\n          renderBlocks.push({\n            type: 'block',\n            delta: currentBlockDelta,\n            attributes: op.attributes ?? {},\n          });\n          currentBlockDelta = new Delta();\n        });\n        const last = splitted[splitted.length - 1];\n        if (last) {\n          currentBlockDelta.insert(last, op.attributes);\n        }\n      } else {\n        const key = Object.keys(insert)[0];\n        if (!key) return;\n        if (this.query(key, Scope.INLINE)) {\n          currentBlockDelta.push(op);\n        } else {\n          if (currentBlockDelta.length()) {\n            renderBlocks.push({\n              type: 'block',\n              delta: currentBlockDelta,\n              attributes: {},\n            });\n          }\n          currentBlockDelta = new Delta();\n          renderBlocks.push({\n            type: 'blockEmbed',\n            key,\n            value: insert[key],\n            attributes: op.attributes ?? {},\n          });\n        }\n      }\n    });\n\n    if (currentBlockDelta.length()) {\n      renderBlocks.push({\n        type: 'block',\n        delta: currentBlockDelta,\n        attributes: {},\n      });\n    }\n\n    return renderBlocks;\n  }\n\n  private createBlock(attributes: AttributeMap, refBlot?: Blot) {\n    let blotName: string | undefined;\n    const formats: AttributeMap = {};\n\n    Object.entries(attributes).forEach(([key, value]) => {\n      const isBlockBlot = this.query(key, Scope.BLOCK & Scope.BLOT) != null;\n      if (isBlockBlot) {\n        blotName = key;\n      } else {\n        formats[key] = value;\n      }\n    });\n\n    const block = this.create(\n      blotName || this.statics.defaultChild.blotName,\n      blotName ? attributes[blotName] : undefined,\n    ) as ParentBlot;\n\n    this.insertBefore(block, refBlot || undefined);\n\n    const length = block.length();\n    Object.entries(formats).forEach(([key, value]) => {\n      block.formatAt(0, length, key, value);\n    });\n\n    return block;\n  }\n}\n\nfunction insertInlineContents(\n  parent: ParentBlot,\n  index: number,\n  inlineContents: Delta,\n) {\n  inlineContents.reduce((index, op) => {\n    const length = Op.length(op);\n    let attributes = op.attributes || {};\n    if (op.insert != null) {\n      if (typeof op.insert === 'string') {\n        const text = op.insert;\n        parent.insertAt(index, text);\n        const [leaf] = parent.descendant(LeafBlot, index);\n        const formats = bubbleFormats(leaf);\n        attributes = AttributeMap.diff(formats, attributes) || {};\n      } else if (typeof op.insert === 'object') {\n        const key = Object.keys(op.insert)[0]; // There should only be one key\n        if (key == null) return index;\n        parent.insertAt(index, key, op.insert[key]);\n        const isInlineEmbed = parent.scroll.query(key, Scope.INLINE) != null;\n        if (isInlineEmbed) {\n          const [leaf] = parent.descendant(LeafBlot, index);\n          const formats = bubbleFormats(leaf);\n          attributes = AttributeMap.diff(formats, attributes) || {};\n        }\n      }\n    }\n    Object.keys(attributes).forEach((key) => {\n      parent.formatAt(index, length, key, attributes[key]);\n    });\n    return index + length;\n  }, index);\n}\n\nexport default Scroll;\n"],"mappings":";;;;;;;;AAAA,SAASA,aAAa,EAAEC,QAAQ,EAAEC,KAAK,EAAEC,UAAU,QAAQ,WAAW;AAEtE,OAAOC,KAAK,IAAIC,YAAY,EAAEC,EAAE,QAAQ,aAAa;AACrD,OAAOC,OAAO,MAAM,oBAAoB;AAExC,OAAOC,KAAK,IAAIC,UAAU,EAAEC,aAAa,QAAQ,YAAY;AAC7D,OAAOC,KAAK,MAAM,YAAY;AAC9B,OAAOC,SAAS,MAAM,gBAAgB;AAWtC,SAASC,MAAMA,CAACC,IAAa,EAA8B;EACzD,OAAOA,IAAI,YAAYN,KAAK,IAAIM,IAAI,YAAYL,UAAU;AAC5D;AAMA,SAASM,WAAWA,CAACD,IAAU,EAAiC;EAC9D,OAAO,OAAQA,IAAI,CAAoBE,aAAa,KAAK,UAAU;AACrE;AAEA,MAAMC,MAAM,SAASd,UAAU,CAAC;EAU9Be,WAAWA,CACTC,QAAkB,EAClBC,OAAuB,EAAAC,IAAA,EAEvB;IAAA,IADA;MAAEC;IAA8B,CAAC,GAAAD,IAAA;IAEjC,KAAK,CAACF,QAAQ,EAAEC,OAAO,CAAC;IACxB,IAAI,CAACE,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACC,KAAK,GAAG,KAAK;IAClB,IAAI,CAACC,QAAQ,CAAC,CAAC;IACf,IAAI,CAACC,MAAM,CAAC,CAAC;IACb,IAAI,CAACL,OAAO,CAACM,gBAAgB,CAAC,WAAW,EAAGC,CAAC,IAAK,IAAI,CAACC,eAAe,CAACD,CAAC,CAAC,CAAC;EAC5E;EAEAE,UAAUA,CAAA,EAAG;IACX,IAAI,CAACC,KAAK,CAACC,OAAO,CAAC,IAAI,CAACR,KAAK,CAAC,EAAE;MAC9B,IAAI,CAACA,KAAK,GAAG,EAAE;IACjB;EACF;EAEAS,QAAQA,CAAA,EAAG;IACT,IAAI,CAAC,IAAI,CAACT,KAAK,EAAE;IACjB,MAAMU,SAAS,GAAG,IAAI,CAACV,KAAK;IAC5B,IAAI,CAACA,KAAK,GAAG,KAAK;IAClB,IAAI,CAACW,MAAM,CAACD,SAAS,CAAC;EACxB;EAEAE,SAASA,CAACrB,IAAU,EAAE;IACpB,IAAI,CAACQ,OAAO,CAACc,IAAI,CAAC7B,OAAO,CAAC8B,MAAM,CAACC,iBAAiB,EAAExB,IAAI,CAAC;EAC3D;EAEAyB,WAAWA,CAACzB,IAAU,EAAE;IACtB,IAAI,CAACQ,OAAO,CAACc,IAAI,CAAC7B,OAAO,CAAC8B,MAAM,CAACG,mBAAmB,EAAE1B,IAAI,CAAC;EAC7D;EAEA2B,eAAeA,CAAC3B,IAAU,EAAE4B,MAAe,EAAE;IAC3C,IAAI,CAACpB,OAAO,CAACc,IAAI,CAAC7B,OAAO,CAAC8B,MAAM,CAACM,mBAAmB,EAAE7B,IAAI,EAAE4B,MAAM,CAAC;EACrE;EAEAE,QAAQA,CAACC,KAAa,EAAEC,MAAc,EAAE;IACtC,MAAM,CAACC,KAAK,EAAEC,MAAM,CAAC,GAAG,IAAI,CAACC,IAAI,CAACJ,KAAK,CAAC;IACxC,MAAM,CAACK,IAAI,CAAC,GAAG,IAAI,CAACD,IAAI,CAACJ,KAAK,GAAGC,MAAM,CAAC;IACxC,KAAK,CAACF,QAAQ,CAACC,KAAK,EAAEC,MAAM,CAAC;IAC7B,IAAII,IAAI,IAAI,IAAI,IAAIH,KAAK,KAAKG,IAAI,IAAIF,MAAM,GAAG,CAAC,EAAE;MAChD,IAAID,KAAK,YAAYtC,UAAU,IAAIyC,IAAI,YAAYzC,UAAU,EAAE;QAC7D,IAAI,CAACe,QAAQ,CAAC,CAAC;QACf;MACF;MACA,MAAM2B,GAAG,GACPD,IAAI,CAACE,QAAQ,CAACC,IAAI,YAAY1C,KAAK,GAAG,IAAI,GAAGuC,IAAI,CAACE,QAAQ,CAACC,IAAI;MACjE;MACAN,KAAK,CAACO,YAAY,CAACJ,IAAI,EAAEC,GAAG,CAAC;MAC7B;MACAJ,KAAK,CAACQ,MAAM,CAAC,CAAC;IAChB;IACA,IAAI,CAAC/B,QAAQ,CAAC,CAAC;EACjB;EAEAC,MAAMA,CAAA,EAAiB;IAAA,IAAhB+B,OAAO,GAAAC,SAAA,CAAAX,MAAA,QAAAW,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG,IAAI;IACnB,IAAI,CAACrC,OAAO,CAACuC,YAAY,CAAC,iBAAiB,EAAEH,OAAO,GAAG,MAAM,GAAG,OAAO,CAAC;EAC1E;EAEAI,QAAQA,CAACf,KAAa,EAAEC,MAAc,EAAEe,MAAc,EAAEC,KAAc,EAAE;IACtE,KAAK,CAACF,QAAQ,CAACf,KAAK,EAAEC,MAAM,EAAEe,MAAM,EAAEC,KAAK,CAAC;IAC5C,IAAI,CAACtC,QAAQ,CAAC,CAAC;EACjB;EAEAuC,QAAQA,CAAClB,KAAa,EAAEiB,KAAa,EAAEE,GAAa,EAAE;IACpD,IAAInB,KAAK,IAAI,IAAI,CAACC,MAAM,CAAC,CAAC,EAAE;MAC1B,IAAIkB,GAAG,IAAI,IAAI,IAAI,IAAI,CAACC,MAAM,CAACC,KAAK,CAACJ,KAAK,EAAE5D,KAAK,CAACiE,KAAK,CAAC,IAAI,IAAI,EAAE;QAChE,MAAMrD,IAAI,GAAG,IAAI,CAACmD,MAAM,CAACG,MAAM,CAAC,IAAI,CAACC,OAAO,CAACC,YAAY,CAACC,QAAQ,CAAC;QACnE,IAAI,CAACC,WAAW,CAAC1D,IAAI,CAAC;QACtB,IAAIkD,GAAG,IAAI,IAAI,IAAIF,KAAK,CAACW,QAAQ,CAAC,IAAI,CAAC,EAAE;UACvC3D,IAAI,CAACiD,QAAQ,CAAC,CAAC,EAAED,KAAK,CAACY,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAEV,GAAG,CAAC;QAC3C,CAAC,MAAM;UACLlD,IAAI,CAACiD,QAAQ,CAAC,CAAC,EAAED,KAAK,EAAEE,GAAG,CAAC;QAC9B;MACF,CAAC,MAAM;QACL,MAAMW,KAAK,GAAG,IAAI,CAACV,MAAM,CAACG,MAAM,CAACN,KAAK,EAAEE,GAAG,CAAC;QAC5C,IAAI,CAACQ,WAAW,CAACG,KAAK,CAAC;MACzB;IACF,CAAC,MAAM;MACL,KAAK,CAACZ,QAAQ,CAAClB,KAAK,EAAEiB,KAAK,EAAEE,GAAG,CAAC;IACnC;IACA,IAAI,CAACxC,QAAQ,CAAC,CAAC;EACjB;EAEAoD,YAAYA,CAAC9D,IAAU,EAAEqC,GAAiB,EAAE;IAC1C,IAAIrC,IAAI,CAACuD,OAAO,CAACQ,KAAK,KAAK3E,KAAK,CAAC4E,WAAW,EAAE;MAC5C,MAAMC,OAAO,GAAG,IAAI,CAACd,MAAM,CAACG,MAAM,CAChC,IAAI,CAACC,OAAO,CAACC,YAAY,CAACC,QAC5B,CAAW;MACXQ,OAAO,CAACP,WAAW,CAAC1D,IAAI,CAAC;MACzB,KAAK,CAAC8D,YAAY,CAACG,OAAO,EAAE5B,GAAG,CAAC;IAClC,CAAC,MAAM;MACL,KAAK,CAACyB,YAAY,CAAC9D,IAAI,EAAEqC,GAAG,CAAC;IAC/B;EACF;EAEA6B,cAAcA,CAACnC,KAAa,EAAEoC,KAAY,EAAE;IAC1C,MAAMC,YAAY,GAAG,IAAI,CAACC,mBAAmB,CAC3CF,KAAK,CAACG,MAAM,CAAC,IAAIhF,KAAK,CAAC,CAAC,CAACiF,MAAM,CAAC,IAAI,CAAC,CACvC,CAAC;IACD,MAAMnC,IAAI,GAAGgC,YAAY,CAACI,GAAG,CAAC,CAAC;IAC/B,IAAIpC,IAAI,IAAI,IAAI,EAAE;IAElB,IAAI,CAACrB,UAAU,CAAC,CAAC;IAEjB,MAAMkB,KAAK,GAAGmC,YAAY,CAACK,KAAK,CAAC,CAAC;IAClC,IAAIxC,KAAK,EAAE;MACT,MAAMyC,uBAAuB,GAC3BzC,KAAK,CAAC0C,IAAI,KAAK,OAAO,KACrB1C,KAAK,CAACkC,KAAK,CAACnC,MAAM,CAAC,CAAC,KAAK,CAAC,IACxB,CAAC,IAAI,CAAC4C,UAAU,CAACjF,UAAU,EAAEoC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAIA,KAAK,GAAG,IAAI,CAACC,MAAM,CAAC,CAAE,CAAC;MACtE,MAAMmC,KAAK,GACTlC,KAAK,CAAC0C,IAAI,KAAK,OAAO,GAClB1C,KAAK,CAACkC,KAAK,GACX,IAAI7E,KAAK,CAAC,CAAC,CAACiF,MAAM,CAAC;QAAE,CAACtC,KAAK,CAAC4C,GAAG,GAAG5C,KAAK,CAACe;MAAM,CAAC,CAAC;MACtD8B,oBAAoB,CAAC,IAAI,EAAE/C,KAAK,EAAEoC,KAAK,CAAC;MACxC,MAAMY,iBAAiB,GAAG9C,KAAK,CAAC0C,IAAI,KAAK,OAAO,GAAG,CAAC,GAAG,CAAC;MACxD,MAAMK,YAAY,GAAGjD,KAAK,GAAGoC,KAAK,CAACnC,MAAM,CAAC,CAAC,GAAG+C,iBAAiB;MAC/D,IAAIL,uBAAuB,EAAE;QAC3B,IAAI,CAACzB,QAAQ,CAAC+B,YAAY,GAAG,CAAC,EAAE,IAAI,CAAC;MACvC;MAEA,MAAMC,OAAO,GAAGrF,aAAa,CAAC,IAAI,CAACuC,IAAI,CAACJ,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;MAClD,MAAMmD,UAAU,GAAG3F,YAAY,CAAC4F,IAAI,CAACF,OAAO,EAAEhD,KAAK,CAACiD,UAAU,CAAC,IAAI,CAAC,CAAC;MACrEE,MAAM,CAACC,IAAI,CAACH,UAAU,CAAC,CAACI,OAAO,CAAEC,IAAI,IAAK;QACxC,IAAI,CAACzC,QAAQ,CAACkC,YAAY,GAAG,CAAC,EAAE,CAAC,EAAEO,IAAI,EAAEL,UAAU,CAACK,IAAI,CAAC,CAAC;MAC5D,CAAC,CAAC;MAEFxD,KAAK,GAAGiD,YAAY;IACtB;IAEA,IAAI,CAACQ,OAAO,EAAEC,aAAa,CAAC,GAAG,IAAI,CAACnD,QAAQ,CAACoD,IAAI,CAAC3D,KAAK,CAAC;IACxD,IAAIqC,YAAY,CAACpC,MAAM,EAAE;MACvB,IAAIwD,OAAO,EAAE;QACXA,OAAO,GAAGA,OAAO,CAACG,KAAK,CAACF,aAAa,CAAC;QACtCA,aAAa,GAAG,CAAC;MACnB;MAEArB,YAAY,CAACkB,OAAO,CAAEM,WAAW,IAAK;QACpC,IAAIA,WAAW,CAACjB,IAAI,KAAK,OAAO,EAAE;UAChC,MAAMkB,KAAK,GAAG,IAAI,CAACC,WAAW,CAC5BF,WAAW,CAACV,UAAU,EACtBM,OAAO,IAAI5C,SACb,CAAC;UACDkC,oBAAoB,CAACe,KAAK,EAAE,CAAC,EAAED,WAAW,CAACzB,KAAK,CAAC;QACnD,CAAC,MAAM;UACL,MAAM4B,UAAU,GAAG,IAAI,CAACzC,MAAM,CAC5BsC,WAAW,CAACf,GAAG,EACfe,WAAW,CAAC5C,KACd,CAAc;UACd,IAAI,CAACc,YAAY,CAACiC,UAAU,EAAEP,OAAO,IAAI5C,SAAS,CAAC;UACnDwC,MAAM,CAACC,IAAI,CAACO,WAAW,CAACV,UAAU,CAAC,CAACI,OAAO,CAAEC,IAAI,IAAK;YACpDQ,UAAU,CAAChD,MAAM,CAACwC,IAAI,EAAEK,WAAW,CAACV,UAAU,CAACK,IAAI,CAAC,CAAC;UACvD,CAAC,CAAC;QACJ;MACF,CAAC,CAAC;IACJ;IAEA,IAAInD,IAAI,CAACuC,IAAI,KAAK,OAAO,IAAIvC,IAAI,CAAC+B,KAAK,CAACnC,MAAM,CAAC,CAAC,EAAE;MAChD,MAAME,MAAM,GAAGsD,OAAO,GAClBA,OAAO,CAACtD,MAAM,CAACsD,OAAO,CAACrC,MAAM,CAAC,GAAGsC,aAAa,GAC9C,IAAI,CAACzD,MAAM,CAAC,CAAC;MACjB8C,oBAAoB,CAAC,IAAI,EAAE5C,MAAM,EAAEE,IAAI,CAAC+B,KAAK,CAAC;IAChD;IAEA,IAAI,CAACjD,QAAQ,CAAC,CAAC;IACf,IAAI,CAACR,QAAQ,CAAC,CAAC;EACjB;EAEAsF,SAASA,CAAA,EAAG;IACV,OAAO,IAAI,CAAC1F,OAAO,CAAC2F,YAAY,CAAC,iBAAiB,CAAC,KAAK,MAAM;EAChE;EAEAC,IAAIA,CAACnE,KAAa,EAA6B;IAC7C,MAAMK,IAAI,GAAG,IAAI,CAAC+D,IAAI,CAACpE,KAAK,CAAC,CAACyC,GAAG,CAAC,CAAC;IACnC,IAAI,CAACpC,IAAI,EAAE;MACT,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;IACnB;IAEA,MAAM,CAACpC,IAAI,EAAEkC,MAAM,CAAC,GAAGE,IAAI;IAC3B,OAAOpC,IAAI,YAAYb,QAAQ,GAAG,CAACa,IAAI,EAAEkC,MAAM,CAAC,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;EAC/D;EAEAC,IAAIA,CAACJ,KAAa,EAAuC;IACvD,IAAIA,KAAK,KAAK,IAAI,CAACC,MAAM,CAAC,CAAC,EAAE;MAC3B,OAAO,IAAI,CAACG,IAAI,CAACJ,KAAK,GAAG,CAAC,CAAC;IAC7B;IACA;IACA,OAAO,IAAI,CAAC6C,UAAU,CAAC7E,MAAM,EAAEgC,KAAK,CAAC;EACvC;EAEAqE,KAAKA,CAAA,EAA+D;IAAA,IAA9DrE,KAAK,GAAAY,SAAA,CAAAX,MAAA,QAAAW,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG,CAAC;IAAA,IAAEX,MAAM,GAAAW,SAAA,CAAAX,MAAA,QAAAW,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG0D,MAAM,CAACC,SAAS;IACxC,MAAMC,QAAQ,GAAGA,CACfvG,IAAgB,EAChBwG,SAAiB,EACjBC,UAAkB,KACf;MACH,IAAIL,KAA6B,GAAG,EAAE;MACtC,IAAIM,UAAU,GAAGD,UAAU;MAC3BzG,IAAI,CAACsC,QAAQ,CAACqE,SAAS,CACrBH,SAAS,EACTC,UAAU,EACV,CAACG,KAAK,EAAEC,UAAU,EAAEC,WAAW,KAAK;QAClC,IAAI/G,MAAM,CAAC6G,KAAK,CAAC,EAAE;UACjBR,KAAK,CAACW,IAAI,CAACH,KAAK,CAAC;QACnB,CAAC,MAAM,IAAIA,KAAK,YAAY1H,aAAa,EAAE;UACzCkH,KAAK,GAAGA,KAAK,CAAC9B,MAAM,CAACiC,QAAQ,CAACK,KAAK,EAAEC,UAAU,EAAEH,UAAU,CAAC,CAAC;QAC/D;QACAA,UAAU,IAAII,WAAW;MAC3B,CACF,CAAC;MACD,OAAOV,KAAK;IACd,CAAC;IACD,OAAOG,QAAQ,CAAC,IAAI,EAAExE,KAAK,EAAEC,MAAM,CAAC;EACtC;EAOAtB,QAAQA,CAAA,EAA+B;IAAA,IAA9BS,SAAS,GAAAwB,SAAA,CAAAX,MAAA,QAAAW,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG,EAAE;IAAA,IAAEqE,OAAO,GAAArE,SAAA,CAAAX,MAAA,QAAAW,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG,CAAC,CAAC;IACnC,IAAI,IAAI,CAAClC,KAAK,EAAE;IAChB,KAAK,CAACC,QAAQ,CAACS,SAAS,EAAE6F,OAAO,CAAC;IAClC,IAAI7F,SAAS,CAACa,MAAM,GAAG,CAAC,EAAE;MACxB,IAAI,CAACxB,OAAO,CAACc,IAAI,CAAC7B,OAAO,CAAC8B,MAAM,CAAC0F,eAAe,EAAE9F,SAAS,EAAE6F,OAAO,CAAC;IACvE;EACF;EAEAb,IAAIA,CAACpE,KAAa,EAAE;IAClB,OAAO,KAAK,CAACoE,IAAI,CAACpE,KAAK,CAAC,CAAC6B,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;EACrC;EAEAnB,MAAMA,CAAA,EAAG;IACP;EAAA;EAKFrB,MAAMA,CAACD,SAA4C,EAAQ;IACzD,IAAI,IAAI,CAACV,KAAK,EAAE;MACd,IAAIO,KAAK,CAACC,OAAO,CAACE,SAAS,CAAC,EAAE;QAC5B,IAAI,CAACV,KAAK,GAAG,IAAI,CAACA,KAAK,CAAC6D,MAAM,CAACnD,SAAS,CAAC;MAC3C;MACA;IACF;IACA,IAAI+F,MAAqB,GAAGzH,OAAO,CAAC0H,OAAO,CAACC,IAAI;IAChD,IAAI,OAAOjG,SAAS,KAAK,QAAQ,EAAE;MACjC+F,MAAM,GAAG/F,SAAS;IACpB;IACA,IAAI,CAACH,KAAK,CAACC,OAAO,CAACE,SAAS,CAAC,EAAE;MAC7BA,SAAS,GAAG,IAAI,CAACkG,QAAQ,CAACC,WAAW,CAAC,CAAC;IACzC;IACAnG,SAAS,GAAGA,SAAS,CAACoG,MAAM,CAACC,KAAA,IAAgB;MAAA,IAAf;QAAEC;MAAO,CAAC,GAAAD,KAAA;MACtC,MAAMxH,IAAI,GAAG,IAAI,CAAC0F,IAAI,CAAC+B,MAAM,EAAE,IAAI,CAAC;MACpC,OAAOzH,IAAI,IAAI,CAACC,WAAW,CAACD,IAAI,CAAC;IACnC,CAAC,CAAC;IACF,IAAImB,SAAS,CAACa,MAAM,GAAG,CAAC,EAAE;MACxB,IAAI,CAACxB,OAAO,CAACc,IAAI,CAAC7B,OAAO,CAAC8B,MAAM,CAACmG,oBAAoB,EAAER,MAAM,EAAE/F,SAAS,CAAC;IAC3E;IACA,KAAK,CAACC,MAAM,CAACD,SAAS,CAACmD,MAAM,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;IACpC,IAAInD,SAAS,CAACa,MAAM,GAAG,CAAC,EAAE;MACxB,IAAI,CAACxB,OAAO,CAACc,IAAI,CAAC7B,OAAO,CAAC8B,MAAM,CAACoG,aAAa,EAAET,MAAM,EAAE/F,SAAS,CAAC;IACpE;EACF;EAEAyG,aAAaA,CAAC7F,KAAa,EAAE8C,GAAW,EAAEjD,MAAe,EAAE;IACzD;IACA;IACA,MAAM,CAAC5B,IAAI,CAAC,GAAG,IAAI,CAAC4E,UAAU,CAAEiD,CAAO,IAAKA,CAAC,YAAYlI,UAAU,EAAEoC,KAAK,CAAC;IAC3E,IAAI/B,IAAI,IAAIA,IAAI,CAACuD,OAAO,CAACE,QAAQ,KAAKoB,GAAG,IAAI5E,WAAW,CAACD,IAAI,CAAC,EAAE;MAC9DA,IAAI,CAACE,aAAa,CAAC0B,MAAM,CAAC;IAC5B;EACF;EAEUd,eAAeA,CAACgH,KAAgB,EAAE;IAC1CA,KAAK,CAACC,cAAc,CAAC,CAAC;EACxB;EAEQ1D,mBAAmBA,CAACF,KAAY,EAAE;IACxC,MAAMC,YAA2B,GAAG,EAAE;IAEtC,IAAI4D,iBAAiB,GAAG,IAAI1I,KAAK,CAAC,CAAC;IACnC6E,KAAK,CAACmB,OAAO,CAAE2C,EAAE,IAAK;MACpB,MAAM1D,MAAM,GAAG0D,EAAE,aAAFA,EAAE,uBAAFA,EAAE,CAAE1D,MAAM;MACzB,IAAI,CAACA,MAAM,EAAE;MACb,IAAI,OAAOA,MAAM,KAAK,QAAQ,EAAE;QAC9B,MAAM2D,QAAQ,GAAG3D,MAAM,CAACoB,KAAK,CAAC,IAAI,CAAC;QACnCuC,QAAQ,CAACtE,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC0B,OAAO,CAAE6C,IAAI,IAAK;UAAA,IAAAC,cAAA;UACtCJ,iBAAiB,CAACzD,MAAM,CAAC4D,IAAI,EAAEF,EAAE,CAAC/C,UAAU,CAAC;UAC7Cd,YAAY,CAAC2C,IAAI,CAAC;YAChBpC,IAAI,EAAE,OAAO;YACbR,KAAK,EAAE6D,iBAAiB;YACxB9C,UAAU,GAAAkD,cAAA,GAAEH,EAAE,CAAC/C,UAAU,cAAAkD,cAAA,cAAAA,cAAA,GAAI,CAAC;UAChC,CAAC,CAAC;UACFJ,iBAAiB,GAAG,IAAI1I,KAAK,CAAC,CAAC;QACjC,CAAC,CAAC;QACF,MAAM8C,IAAI,GAAG8F,QAAQ,CAACA,QAAQ,CAAClG,MAAM,GAAG,CAAC,CAAC;QAC1C,IAAII,IAAI,EAAE;UACR4F,iBAAiB,CAACzD,MAAM,CAACnC,IAAI,EAAE6F,EAAE,CAAC/C,UAAU,CAAC;QAC/C;MACF,CAAC,MAAM;QACL,MAAML,GAAG,GAAGO,MAAM,CAACC,IAAI,CAACd,MAAM,CAAC,CAAC,CAAC,CAAC;QAClC,IAAI,CAACM,GAAG,EAAE;QACV,IAAI,IAAI,CAACzB,KAAK,CAACyB,GAAG,EAAEzF,KAAK,CAACiJ,MAAM,CAAC,EAAE;UACjCL,iBAAiB,CAACjB,IAAI,CAACkB,EAAE,CAAC;QAC5B,CAAC,MAAM;UAAA,IAAAK,eAAA;UACL,IAAIN,iBAAiB,CAAChG,MAAM,CAAC,CAAC,EAAE;YAC9BoC,YAAY,CAAC2C,IAAI,CAAC;cAChBpC,IAAI,EAAE,OAAO;cACbR,KAAK,EAAE6D,iBAAiB;cACxB9C,UAAU,EAAE,CAAC;YACf,CAAC,CAAC;UACJ;UACA8C,iBAAiB,GAAG,IAAI1I,KAAK,CAAC,CAAC;UAC/B8E,YAAY,CAAC2C,IAAI,CAAC;YAChBpC,IAAI,EAAE,YAAY;YAClBE,GAAG;YACH7B,KAAK,EAAEuB,MAAM,CAACM,GAAG,CAAC;YAClBK,UAAU,GAAAoD,eAAA,GAAEL,EAAE,CAAC/C,UAAU,cAAAoD,eAAA,cAAAA,eAAA,GAAI,CAAC;UAChC,CAAC,CAAC;QACJ;MACF;IACF,CAAC,CAAC;IAEF,IAAIN,iBAAiB,CAAChG,MAAM,CAAC,CAAC,EAAE;MAC9BoC,YAAY,CAAC2C,IAAI,CAAC;QAChBpC,IAAI,EAAE,OAAO;QACbR,KAAK,EAAE6D,iBAAiB;QACxB9C,UAAU,EAAE,CAAC;MACf,CAAC,CAAC;IACJ;IAEA,OAAOd,YAAY;EACrB;EAEQ0B,WAAWA,CAACZ,UAAwB,EAAEM,OAAc,EAAE;IAC5D,IAAI/B,QAA4B;IAChC,MAAMwB,OAAqB,GAAG,CAAC,CAAC;IAEhCG,MAAM,CAACmD,OAAO,CAACrD,UAAU,CAAC,CAACI,OAAO,CAACkD,KAAA,IAAkB;MAAA,IAAjB,CAAC3D,GAAG,EAAE7B,KAAK,CAAC,GAAAwF,KAAA;MAC9C,MAAMC,WAAW,GAAG,IAAI,CAACrF,KAAK,CAACyB,GAAG,EAAEzF,KAAK,CAACiE,KAAK,GAAGjE,KAAK,CAACsJ,IAAI,CAAC,IAAI,IAAI;MACrE,IAAID,WAAW,EAAE;QACfhF,QAAQ,GAAGoB,GAAG;MAChB,CAAC,MAAM;QACLI,OAAO,CAACJ,GAAG,CAAC,GAAG7B,KAAK;MACtB;IACF,CAAC,CAAC;IAEF,MAAM6C,KAAK,GAAG,IAAI,CAACvC,MAAM,CACvBG,QAAQ,IAAI,IAAI,CAACF,OAAO,CAACC,YAAY,CAACC,QAAQ,EAC9CA,QAAQ,GAAGyB,UAAU,CAACzB,QAAQ,CAAC,GAAGb,SACpC,CAAe;IAEf,IAAI,CAACkB,YAAY,CAAC+B,KAAK,EAAEL,OAAO,IAAI5C,SAAS,CAAC;IAE9C,MAAMZ,MAAM,GAAG6D,KAAK,CAAC7D,MAAM,CAAC,CAAC;IAC7BoD,MAAM,CAACmD,OAAO,CAACtD,OAAO,CAAC,CAACK,OAAO,CAACqD,KAAA,IAAkB;MAAA,IAAjB,CAAC9D,GAAG,EAAE7B,KAAK,CAAC,GAAA2F,KAAA;MAC3C9C,KAAK,CAAC/C,QAAQ,CAAC,CAAC,EAAEd,MAAM,EAAE6C,GAAG,EAAE7B,KAAK,CAAC;IACvC,CAAC,CAAC;IAEF,OAAO6C,KAAK;EACd;AACF;AAAA+C,eAAA,CAvXMzI,MAAM,cACQ,QAAQ;AAAAyI,eAAA,CADtBzI,MAAM,eAES,WAAW;AAAAyI,eAAA,CAF1BzI,MAAM,aAGO,KAAK;AAAAyI,eAAA,CAHlBzI,MAAM,kBAIYT,KAAK;AAAAkJ,eAAA,CAJvBzI,MAAM,qBAKe,CAACT,KAAK,EAAEC,UAAU,EAAEG,SAAS,CAAC;AAoXzD,SAASgF,oBAAoBA,CAC3B+D,MAAkB,EAClB9G,KAAa,EACb+G,cAAqB,EACrB;EACAA,cAAc,CAACC,MAAM,CAAC,CAAChH,KAAK,EAAEkG,EAAE,KAAK;IACnC,MAAMjG,MAAM,GAAGxC,EAAE,CAACwC,MAAM,CAACiG,EAAE,CAAC;IAC5B,IAAI/C,UAAU,GAAG+C,EAAE,CAAC/C,UAAU,IAAI,CAAC,CAAC;IACpC,IAAI+C,EAAE,CAAC1D,MAAM,IAAI,IAAI,EAAE;MACrB,IAAI,OAAO0D,EAAE,CAAC1D,MAAM,KAAK,QAAQ,EAAE;QACjC,MAAM4D,IAAI,GAAGF,EAAE,CAAC1D,MAAM;QACtBsE,MAAM,CAAC5F,QAAQ,CAAClB,KAAK,EAAEoG,IAAI,CAAC;QAC5B,MAAM,CAACjC,IAAI,CAAC,GAAG2C,MAAM,CAACjE,UAAU,CAACzF,QAAQ,EAAE4C,KAAK,CAAC;QACjD,MAAMkD,OAAO,GAAGrF,aAAa,CAACsG,IAAI,CAAC;QACnChB,UAAU,GAAG3F,YAAY,CAAC4F,IAAI,CAACF,OAAO,EAAEC,UAAU,CAAC,IAAI,CAAC,CAAC;MAC3D,CAAC,MAAM,IAAI,OAAO+C,EAAE,CAAC1D,MAAM,KAAK,QAAQ,EAAE;QACxC,MAAMM,GAAG,GAAGO,MAAM,CAACC,IAAI,CAAC4C,EAAE,CAAC1D,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACvC,IAAIM,GAAG,IAAI,IAAI,EAAE,OAAO9C,KAAK;QAC7B8G,MAAM,CAAC5F,QAAQ,CAAClB,KAAK,EAAE8C,GAAG,EAAEoD,EAAE,CAAC1D,MAAM,CAACM,GAAG,CAAC,CAAC;QAC3C,MAAMmE,aAAa,GAAGH,MAAM,CAAC1F,MAAM,CAACC,KAAK,CAACyB,GAAG,EAAEzF,KAAK,CAACiJ,MAAM,CAAC,IAAI,IAAI;QACpE,IAAIW,aAAa,EAAE;UACjB,MAAM,CAAC9C,IAAI,CAAC,GAAG2C,MAAM,CAACjE,UAAU,CAACzF,QAAQ,EAAE4C,KAAK,CAAC;UACjD,MAAMkD,OAAO,GAAGrF,aAAa,CAACsG,IAAI,CAAC;UACnChB,UAAU,GAAG3F,YAAY,CAAC4F,IAAI,CAACF,OAAO,EAAEC,UAAU,CAAC,IAAI,CAAC,CAAC;QAC3D;MACF;IACF;IACAE,MAAM,CAACC,IAAI,CAACH,UAAU,CAAC,CAACI,OAAO,CAAET,GAAG,IAAK;MACvCgE,MAAM,CAAC/F,QAAQ,CAACf,KAAK,EAAEC,MAAM,EAAE6C,GAAG,EAAEK,UAAU,CAACL,GAAG,CAAC,CAAC;IACtD,CAAC,CAAC;IACF,OAAO9C,KAAK,GAAGC,MAAM;EACvB,CAAC,EAAED,KAAK,CAAC;AACX;AAEA,eAAe5B,MAAM","ignoreList":[]}]}