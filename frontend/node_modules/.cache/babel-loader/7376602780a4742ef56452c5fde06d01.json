{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\quill\\modules\\uploader.js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\quill\\modules\\uploader.js","mtime":1751792162348},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJlZHVjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5yZWR1Y2UuanMiOwppbXBvcnQgRGVsdGEgZnJvbSAncXVpbGwtZGVsdGEnOwppbXBvcnQgRW1pdHRlciBmcm9tICcuLi9jb3JlL2VtaXR0ZXIuanMnOwppbXBvcnQgTW9kdWxlIGZyb20gJy4uL2NvcmUvbW9kdWxlLmpzJzsKY2xhc3MgVXBsb2FkZXIgZXh0ZW5kcyBNb2R1bGUgewogIGNvbnN0cnVjdG9yKHF1aWxsLCBvcHRpb25zKSB7CiAgICBzdXBlcihxdWlsbCwgb3B0aW9ucyk7CiAgICBxdWlsbC5yb290LmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBlID0+IHsKICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBsZXQgbmF0aXZlID0gbnVsbDsKICAgICAgaWYgKGRvY3VtZW50LmNhcmV0UmFuZ2VGcm9tUG9pbnQpIHsKICAgICAgICBuYXRpdmUgPSBkb2N1bWVudC5jYXJldFJhbmdlRnJvbVBvaW50KGUuY2xpZW50WCwgZS5jbGllbnRZKTsKICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yCiAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQuY2FyZXRQb3NpdGlvbkZyb21Qb2ludCkgewogICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IKICAgICAgICBjb25zdCBwb3NpdGlvbiA9IGRvY3VtZW50LmNhcmV0UG9zaXRpb25Gcm9tUG9pbnQoZS5jbGllbnRYLCBlLmNsaWVudFkpOwogICAgICAgIG5hdGl2ZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7CiAgICAgICAgbmF0aXZlLnNldFN0YXJ0KHBvc2l0aW9uLm9mZnNldE5vZGUsIHBvc2l0aW9uLm9mZnNldCk7CiAgICAgICAgbmF0aXZlLnNldEVuZChwb3NpdGlvbi5vZmZzZXROb2RlLCBwb3NpdGlvbi5vZmZzZXQpOwogICAgICB9CiAgICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBuYXRpdmUgJiYgcXVpbGwuc2VsZWN0aW9uLm5vcm1hbGl6ZU5hdGl2ZShuYXRpdmUpOwogICAgICBpZiAobm9ybWFsaXplZCkgewogICAgICAgIHZhciBfZSRkYXRhVHJhbnNmZXI7CiAgICAgICAgY29uc3QgcmFuZ2UgPSBxdWlsbC5zZWxlY3Rpb24ubm9ybWFsaXplZFRvUmFuZ2Uobm9ybWFsaXplZCk7CiAgICAgICAgaWYgKChfZSRkYXRhVHJhbnNmZXIgPSBlLmRhdGFUcmFuc2ZlcikgIT09IG51bGwgJiYgX2UkZGF0YVRyYW5zZmVyICE9PSB2b2lkIDAgJiYgX2UkZGF0YVRyYW5zZmVyLmZpbGVzKSB7CiAgICAgICAgICB0aGlzLnVwbG9hZChyYW5nZSwgZS5kYXRhVHJhbnNmZXIuZmlsZXMpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgfQogIHVwbG9hZChyYW5nZSwgZmlsZXMpIHsKICAgIGNvbnN0IHVwbG9hZHMgPSBbXTsKICAgIEFycmF5LmZyb20oZmlsZXMpLmZvckVhY2goZmlsZSA9PiB7CiAgICAgIHZhciBfdGhpcyRvcHRpb25zJG1pbWV0eXA7CiAgICAgIGlmIChmaWxlICYmIChfdGhpcyRvcHRpb25zJG1pbWV0eXAgPSB0aGlzLm9wdGlvbnMubWltZXR5cGVzKSAhPT0gbnVsbCAmJiBfdGhpcyRvcHRpb25zJG1pbWV0eXAgIT09IHZvaWQgMCAmJiBfdGhpcyRvcHRpb25zJG1pbWV0eXAuaW5jbHVkZXMoZmlsZS50eXBlKSkgewogICAgICAgIHVwbG9hZHMucHVzaChmaWxlKTsKICAgICAgfQogICAgfSk7CiAgICBpZiAodXBsb2Fkcy5sZW5ndGggPiAwKSB7CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgRml4IG1lIGxhdGVyCiAgICAgIHRoaXMub3B0aW9ucy5oYW5kbGVyLmNhbGwodGhpcywgcmFuZ2UsIHVwbG9hZHMpOwogICAgfQogIH0KfQpVcGxvYWRlci5ERUZBVUxUUyA9IHsKICBtaW1ldHlwZXM6IFsnaW1hZ2UvcG5nJywgJ2ltYWdlL2pwZWcnXSwKICBoYW5kbGVyKHJhbmdlLCBmaWxlcykgewogICAgaWYgKCF0aGlzLnF1aWxsLnNjcm9sbC5xdWVyeSgnaW1hZ2UnKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwcm9taXNlcyA9IGZpbGVzLm1hcChmaWxlID0+IHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgIHJlc29sdmUocmVhZGVyLnJlc3VsdCk7CiAgICAgICAgfTsKICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgICAgfSk7CiAgICB9KTsKICAgIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKGltYWdlcyA9PiB7CiAgICAgIGNvbnN0IHVwZGF0ZSA9IGltYWdlcy5yZWR1Y2UoKGRlbHRhLCBpbWFnZSkgPT4gewogICAgICAgIHJldHVybiBkZWx0YS5pbnNlcnQoewogICAgICAgICAgaW1hZ2UKICAgICAgICB9KTsKICAgICAgfSwgbmV3IERlbHRhKCkucmV0YWluKHJhbmdlLmluZGV4KS5kZWxldGUocmFuZ2UubGVuZ3RoKSk7CiAgICAgIHRoaXMucXVpbGwudXBkYXRlQ29udGVudHModXBkYXRlLCBFbWl0dGVyLnNvdXJjZXMuVVNFUik7CiAgICAgIHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKHJhbmdlLmluZGV4ICsgaW1hZ2VzLmxlbmd0aCwgRW1pdHRlci5zb3VyY2VzLlNJTEVOVCk7CiAgICB9KTsKICB9Cn07CmV4cG9ydCBkZWZhdWx0IFVwbG9hZGVyOw=="},{"version":3,"names":["Delta","Emitter","Module","Uploader","constructor","quill","options","root","addEventListener","e","preventDefault","native","document","caretRangeFromPoint","clientX","clientY","caretPositionFromPoint","position","createRange","setStart","offsetNode","offset","setEnd","normalized","selection","normalizeNative","_e$dataTransfer","range","normalizedToRange","dataTransfer","files","upload","uploads","Array","from","forEach","file","_this$options$mimetyp","mimetypes","includes","type","push","length","handler","call","DEFAULTS","scroll","query","promises","map","Promise","resolve","reader","FileReader","onload","result","readAsDataURL","all","then","images","update","reduce","delta","image","insert","retain","index","delete","updateContents","sources","USER","setSelection","SILENT"],"sources":["../../src/modules/uploader.ts"],"sourcesContent":["import Delta from 'quill-delta';\nimport type Quill from '../core/quill.js';\nimport Emitter from '../core/emitter.js';\nimport Module from '../core/module.js';\nimport type { Range } from '../core/selection.js';\n\ninterface UploaderOptions {\n  mimetypes: string[];\n  handler: (this: { quill: Quill }, range: Range, files: File[]) => void;\n}\n\nclass Uploader extends Module<UploaderOptions> {\n  static DEFAULTS: UploaderOptions;\n\n  constructor(quill: Quill, options: Partial<UploaderOptions>) {\n    super(quill, options);\n    quill.root.addEventListener('drop', (e) => {\n      e.preventDefault();\n      let native: ReturnType<typeof document.createRange> | null = null;\n      if (document.caretRangeFromPoint) {\n        native = document.caretRangeFromPoint(e.clientX, e.clientY);\n        // @ts-expect-error\n      } else if (document.caretPositionFromPoint) {\n        // @ts-expect-error\n        const position = document.caretPositionFromPoint(e.clientX, e.clientY);\n        native = document.createRange();\n        native.setStart(position.offsetNode, position.offset);\n        native.setEnd(position.offsetNode, position.offset);\n      }\n\n      const normalized = native && quill.selection.normalizeNative(native);\n      if (normalized) {\n        const range = quill.selection.normalizedToRange(normalized);\n        if (e.dataTransfer?.files) {\n          this.upload(range, e.dataTransfer.files);\n        }\n      }\n    });\n  }\n\n  upload(range: Range, files: FileList | File[]) {\n    const uploads: File[] = [];\n    Array.from(files).forEach((file) => {\n      if (file && this.options.mimetypes?.includes(file.type)) {\n        uploads.push(file);\n      }\n    });\n    if (uploads.length > 0) {\n      // @ts-expect-error Fix me later\n      this.options.handler.call(this, range, uploads);\n    }\n  }\n}\n\nUploader.DEFAULTS = {\n  mimetypes: ['image/png', 'image/jpeg'],\n  handler(range: Range, files: File[]) {\n    if (!this.quill.scroll.query('image')) {\n      return;\n    }\n    const promises = files.map<Promise<string>>((file) => {\n      return new Promise((resolve) => {\n        const reader = new FileReader();\n        reader.onload = () => {\n          resolve(reader.result as string);\n        };\n        reader.readAsDataURL(file);\n      });\n    });\n    Promise.all(promises).then((images) => {\n      const update = images.reduce((delta: Delta, image) => {\n        return delta.insert({ image });\n      }, new Delta().retain(range.index).delete(range.length)) as Delta;\n      this.quill.updateContents(update, Emitter.sources.USER);\n      this.quill.setSelection(\n        range.index + images.length,\n        Emitter.sources.SILENT,\n      );\n    });\n  },\n};\n\nexport default Uploader;\n"],"mappings":"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","ignoreList":[]}]}