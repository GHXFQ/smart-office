{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\contract\\Detail.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\contract\\Detail.vue","mtime":1748066837544},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077009623},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746431218000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC5kaWZmZXJlbmNlLnYyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LmludGVyc2VjdGlvbi52Mi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC5pcy1kaXNqb2ludC1mcm9tLnYyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LmlzLXN1YnNldC1vZi52Mi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC5pcy1zdXBlcnNldC1vZi52Mi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC5zeW1tZXRyaWMtZGlmZmVyZW5jZS52Mi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC51bmlvbi52Mi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwtc2VhcmNoLXBhcmFtcy5kZWxldGUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLXNlYXJjaC1wYXJhbXMuaGFzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybC1zZWFyY2gtcGFyYW1zLnNpemUuanMiOwppbXBvcnQgeyByZWYsIHJlYWN0aXZlLCBvbk1vdW50ZWQsIGNvbXB1dGVkLCB3YXRjaCwgb25Vbm1vdW50ZWQsIG5leHRUaWNrLCBvbkJlZm9yZVVubW91bnQgfSBmcm9tICd2dWUnOwppbXBvcnQgeyB1c2VSb3V0ZSwgdXNlUm91dGVyIH0gZnJvbSAndnVlLXJvdXRlcic7CmltcG9ydCB7IEVsTWVzc2FnZSwgRWxMb2FkaW5nLCBFbE1lc3NhZ2VCb3ggfSBmcm9tICdlbGVtZW50LXBsdXMnOwppbXBvcnQgeyBEb3dubG9hZCwgRG9jdW1lbnRBZGQsIE1hZ2ljU3RpY2ssIENoZWNrLCBXYXJuaW5nLCBXYXJuaW5nRmlsbGVkLCBEb2N1bWVudCwgSW5mb0ZpbGxlZCwgRWRpdCwgUmVhZGluZywgQ2xvc2UsIExvYWRpbmcsIEFycm93UmlnaHQsIEFycm93TGVmdCwgVGltZXIsIFBvc2l0aW9uLCBTZXR0aW5nLCBEb2N1bWVudENoZWNrZWQsIE5vdGVib29rLCBQbHVzIH0gZnJvbSAnQGVsZW1lbnQtcGx1cy9pY29ucy12dWUnOwppbXBvcnQgeyBnZXRDb250cmFjdERldGFpbCwgdXBkYXRlQ29udHJhY3QsIGNoZWNrQ29udHJhY3QsIGFpUG9saXNoQ29udHJhY3QgfSBmcm9tICdAL2FwaS9jb250cmFjdCc7CmltcG9ydCByZXF1ZXN0IGZyb20gJ0AvdXRpbHMvcmVxdWVzdCc7Ci8vIOW8leWFpeWvjOaWh+acrOe8lui+keWZqAppbXBvcnQgeyBRdWlsbEVkaXRvciB9IGZyb20gJ0B2dWV1cC92dWUtcXVpbGwnOwovLyDlvJXlhaXlr4zmlofmnKznvJbovpHlmajmoLflvI8KaW1wb3J0ICdAdnVldXAvdnVlLXF1aWxsL2Rpc3QvdnVlLXF1aWxsLnNub3cuY3NzJzsKLy8g5byV5YWlbG9kYXNo55qEZGVib3VuY2Xlh73mlbDnlKjkuo7mgKfog73kvJjljJYKaW1wb3J0IHsgZGVib3VuY2UgfSBmcm9tICdsb2Rhc2gtZXMnOwoKLy8g5bu26L+f5Yqg6L29UXVpbGzmqKHlnZfnoa7kv53lj6rlnKjlrqLmiLfnq6/miafooYwKbGV0IFN1Z2dlc3Rpb25CbG90OwpsZXQgU3VnZ2VzdGlvbk1vZHVsZTsKCi8vIOWIneWni+WMllF1aWxs5omp5bGVIC0g56Gu5L+d5Y+q5Zyo5rWP6KeI5Zmo546v5aKD5Lit5omn6KGMCmNvbnN0IGluaXRRdWlsbEV4dGVuc2lvbnMgPSAoKSA9PiB7CiAgaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSByZXR1cm47CgogIC8vIOehruS/nVF1aWxs5bey57uP6YCa6L+HQ0RO5Yqg6L29CiAgaWYgKCF3aW5kb3cuUXVpbGwpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ1F1aWxs5pyq5Yqg6L2977yM5peg5rOV5Yid5aeL5YyW5omp5bGVJyk7CiAgICByZXR1cm47CiAgfQoKICAvLyDliJvlu7roh6rlrprkuYlRdWlsbOWGheiBlOagvOW8jyAtIOW7uuiurumrmOS6rgogIGNvbnN0IElubGluZVN1Z2dlc3Rpb25CbG90ID0gd2luZG93LlF1aWxsLmltcG9ydCgnYmxvdHMvaW5saW5lJyk7CiAgU3VnZ2VzdGlvbkJsb3QgPSBjbGFzcyBleHRlbmRzIElubGluZVN1Z2dlc3Rpb25CbG90IHsKICAgIHN0YXRpYyBjcmVhdGUodmFsdWUpIHsKICAgICAgY29uc3Qgbm9kZSA9IHN1cGVyLmNyZWF0ZSgpOwogICAgICBub2RlLnNldEF0dHJpYnV0ZSgnZGF0YS1zdWdnZXN0aW9uLWlkJywgdmFsdWUuaWQpOwogICAgICBub2RlLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnc3VnZ2VzdGlvbi1oaWdobGlnaHQnKTsKICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUoJ2RhdGEtb3JpZ2luYWwnLCB2YWx1ZS5vcmlnaW5hbCk7CiAgICAgIG5vZGUuc2V0QXR0cmlidXRlKCdkYXRhLXN1Z2dlc3RlZCcsIHZhbHVlLnN1Z2dlc3RlZCk7CgogICAgICAvLyDmt7vliqDmj5DnpLrlkozmm7TmmI7mmL7nmoTop4bop4nmoLflvI8KICAgICAgbm9kZS50aXRsZSA9ICfngrnlh7vmn6XnnIvkv67mlLnlu7rorq4nOwogICAgICBub2RlLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJzsKICAgICAgbm9kZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAncmdiYSgyNTUsIDIxNywgMTAyLCAwLjMpJzsKICAgICAgbm9kZS5zdHlsZS5ib3JkZXJCb3R0b20gPSAnMXB4IGRhc2hlZCAjZmZiMzAwJzsKICAgICAgbm9kZS5zdHlsZS5wYWRkaW5nID0gJzAgMnB4JzsKICAgICAgbm9kZS5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7CiAgICAgIHJldHVybiBub2RlOwogICAgfQogICAgc3RhdGljIGZvcm1hdHMobm9kZSkgewogICAgICByZXR1cm4gewogICAgICAgIGlkOiBub2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1zdWdnZXN0aW9uLWlkJyksCiAgICAgICAgb3JpZ2luYWw6IG5vZGUuZ2V0QXR0cmlidXRlKCdkYXRhLW9yaWdpbmFsJyksCiAgICAgICAgc3VnZ2VzdGVkOiBub2RlLmdldEF0dHJpYnV0ZSgnZGF0YS1zdWdnZXN0ZWQnKQogICAgICB9OwogICAgfQogIH07CiAgU3VnZ2VzdGlvbkJsb3QuYmxvdE5hbWUgPSAnc3VnZ2VzdGlvbic7CiAgU3VnZ2VzdGlvbkJsb3QudGFnTmFtZSA9ICdzcGFuJzsKICB3aW5kb3cuUXVpbGwucmVnaXN0ZXIoU3VnZ2VzdGlvbkJsb3QpOwoKICAvLyDoh6rlrprkuYlRdWlsbCBNb2R1bGUgLSDlpITnkIblu7rorq7kuqTkupIKICBTdWdnZXN0aW9uTW9kdWxlID0gY2xhc3MgewogICAgY29uc3RydWN0b3IocXVpbGwsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5xdWlsbCA9IHF1aWxsOwogICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwogICAgICB0aGlzLnN1Z2dlc3Rpb25zID0gb3B0aW9ucy5zdWdnZXN0aW9ucyB8fCBbXTsKICAgICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NOYW1lID0gJ3FsLXN1Z2dlc3Rpb24tdG9vbHRpcCc7CiAgICAgIHRoaXMuY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5jb250YWluZXIpOwogICAgICB0aGlzLnF1aWxsLm9uKCd0ZXh0LWNoYW5nZScsICgpID0+IHsKICAgICAgICB0aGlzLnVwZGF0ZSgpOwogICAgICB9KTsKCiAgICAgIC8vIOS/neWtmOeCueWHu+ebkeWQrOWZqOeahOW8leeUqOS7peS+v+S6jua4heeQhgogICAgICB0aGlzLl9jbGlja0xpc3RlbmVyID0gZSA9PiB7CiAgICAgICAgaWYgKGUudGFyZ2V0ICYmIGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnc3VnZ2VzdGlvbi1oaWdobGlnaHQnKSkgewogICAgICAgICAgdGhpcy5zaG93VG9vbHRpcChlLnRhcmdldCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuaGlkZVRvb2x0aXAoKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHRoaXMucXVpbGwucm9vdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX2NsaWNrTGlzdGVuZXIpOwoKICAgICAgLy8g5L2/55SoTXV0YXRpb25PYnNlcnZlcuabv+S7o0RPTU5vZGVJbnNlcnRlZOebkeWQrAogICAgICB0aGlzLm9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIobXV0YXRpb25zID0+IHsKICAgICAgICBmb3IgKGNvbnN0IG11dGF0aW9uIG9mIG11dGF0aW9ucykgewogICAgICAgICAgaWYgKG11dGF0aW9uLnR5cGUgPT09ICdjaGlsZExpc3QnIHx8IG11dGF0aW9uLnR5cGUgPT09ICdjaGFyYWN0ZXJEYXRhJykgewogICAgICAgICAgICB0aGlzLnVwZGF0ZSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CgogICAgICAvLyDphY3nva5vYnNlcnZlcuebkeWQrOWtkOiKgueCueWPmOWMluWSjOWGheWuueWPmOWMlgogICAgICB0aGlzLm9ic2VydmVyLm9ic2VydmUodGhpcy5xdWlsbC5yb290LCB7CiAgICAgICAgY2hpbGRMaXN0OiB0cnVlLAogICAgICAgIHN1YnRyZWU6IHRydWUsCiAgICAgICAgY2hhcmFjdGVyRGF0YTogdHJ1ZQogICAgICB9KTsKICAgIH0KICAgIHVwZGF0ZSgpIHsKICAgICAgLy8g5pu05paw5bu66K6u5qCH6K6wCiAgICB9CiAgICBzaG93VG9vbHRpcChlbGVtZW50KSB7CiAgICAgIGNvbnN0IHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICBjb25zdCBpZCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdkYXRhLXN1Z2dlc3Rpb24taWQnKTsKICAgICAgY29uc3Qgb3JpZ2luYWwgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1vcmlnaW5hbCcpOwogICAgICBjb25zdCBzdWdnZXN0ZWQgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1zdWdnZXN0ZWQnKTsKCiAgICAgIC8vIOWinuW8uuW3peWFt+aPkOekuu+8jOehruS/neWJjeWQjuWvueavlOa4heaZsAogICAgICB0aGlzLmNvbnRhaW5lci5pbm5lckhUTUwgPSBgCiAgICAgICAgPGRpdiBjbGFzcz0ic3VnZ2VzdGlvbi10b29sdGlwLWNvbnRlbnQiPgogICAgICAgICAgPGRpdiBjbGFzcz0ic3VnZ2VzdGlvbi10b29sdGlwLWhlYWRlciI+QUnmlofmnKzkvJjljJblu7rorq48L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9InN1Z2dlc3Rpb24tdG9vbHRpcC1ib2R5Ij4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3VnZ2VzdGlvbi1sYWJlbCI+5Y6f5paH5pysOjwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdWdnZXN0aW9uLW9yaWdpbmFsIj4ke29yaWdpbmFsfTwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdWdnZXN0aW9uLWFycm93Ij48c3Bhbj7ihpI8L3NwYW4+PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InN1Z2dlc3Rpb24tbGFiZWwiPuW7uuiuruS/ruaUueS4ujo8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3VnZ2VzdGlvbi1zdWdnZXN0ZWQiPiR7c3VnZ2VzdGVkfTwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdWdnZXN0aW9uLWRpZmYiPgogICAgICAgICAgICAgICR7dGhpcy5fZ2VuZXJhdGVEaWZmKG9yaWdpbmFsLCBzdWdnZXN0ZWQpfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0ic3VnZ2VzdGlvbi1hY3Rpb25zIj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLWFkb3B0IiBkYXRhLWlkPSIke2lkfSI+6YeH57qzPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0bi1pZ25vcmUiIGRhdGEtaWQ9IiR7aWR9Ij7lv73nlaU8L2J1dHRvbj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICBgOwogICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgdGhpcy5jb250YWluZXIuc3R5bGUudG9wID0gYCR7cmVjdC5ib3R0b20gKyB3aW5kb3cuc2Nyb2xsWSArIDV9cHhgOwogICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gYCR7cmVjdC5sZWZ0ICsgd2luZG93LnNjcm9sbFh9cHhgOwoKICAgICAgLy8g5L2/55So546w5Luj5LqL5Lu257uR5a6a5pa55rOVCiAgICAgIGNvbnN0IGFkb3B0QnRuID0gdGhpcy5jb250YWluZXIucXVlcnlTZWxlY3RvcignLmJ0bi1hZG9wdCcpOwogICAgICBjb25zdCBpZ25vcmVCdG4gPSB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuYnRuLWlnbm9yZScpOwoKICAgICAgLy8g56e76Zmk5pen55qE5LqL5Lu255uR5ZCs5Zmo77yI5aaC5p6c5pyJ77yJCiAgICAgIGlmICh0aGlzLl9hZG9wdExpc3RlbmVyKSB7CiAgICAgICAgYWRvcHRCdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9hZG9wdExpc3RlbmVyKTsKICAgICAgfQogICAgICBpZiAodGhpcy5faWdub3JlTGlzdGVuZXIpIHsKICAgICAgICBpZ25vcmVCdG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9pZ25vcmVMaXN0ZW5lcik7CiAgICAgIH0KCiAgICAgIC8vIOa3u+WKoOaWsOeahOS6i+S7tuebkeWQrOWZqAogICAgICB0aGlzLl9hZG9wdExpc3RlbmVyID0gKCkgPT4gewogICAgICAgIHRoaXMub3B0aW9ucy5vbkFkb3B0ICYmIHRoaXMub3B0aW9ucy5vbkFkb3B0KGlkKTsKICAgICAgICB0aGlzLmhpZGVUb29sdGlwKCk7CiAgICAgIH07CiAgICAgIHRoaXMuX2lnbm9yZUxpc3RlbmVyID0gKCkgPT4gewogICAgICAgIHRoaXMub3B0aW9ucy5vbklnbm9yZSAmJiB0aGlzLm9wdGlvbnMub25JZ25vcmUoaWQpOwogICAgICAgIHRoaXMuaGlkZVRvb2x0aXAoKTsKICAgICAgfTsKICAgICAgYWRvcHRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9hZG9wdExpc3RlbmVyKTsKICAgICAgaWdub3JlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5faWdub3JlTGlzdGVuZXIpOwogICAgfQoKICAgIC8vIOeUn+aIkOW3ruW8guWvueavlAogICAgX2dlbmVyYXRlRGlmZihvcmlnaW5hbCwgc3VnZ2VzdGVkKSB7CiAgICAgIC8vIOeugOWNleeahOW3ruW8guagh+iusAogICAgICB0cnkgewogICAgICAgIGlmICghb3JpZ2luYWwgfHwgIXN1Z2dlc3RlZCkgcmV0dXJuICcnOwogICAgICAgIGNvbnN0IHdvcmRzMSA9IG9yaWdpbmFsLnNwbGl0KC9ccysvKTsKICAgICAgICBjb25zdCB3b3JkczIgPSBzdWdnZXN0ZWQuc3BsaXQoL1xzKy8pOwoKICAgICAgICAvLyDlr7vmib7nrKzkuIDkuKrkuI3lkIznmoTor40KICAgICAgICBsZXQgZmlyc3REaWZmID0gMDsKICAgICAgICB3aGlsZSAoZmlyc3REaWZmIDwgd29yZHMxLmxlbmd0aCAmJiBmaXJzdERpZmYgPCB3b3JkczIubGVuZ3RoICYmIHdvcmRzMVtmaXJzdERpZmZdID09PSB3b3JkczJbZmlyc3REaWZmXSkgewogICAgICAgICAgZmlyc3REaWZmKys7CiAgICAgICAgfQoKICAgICAgICAvLyDmib7mnIDlkI7kuIDkuKrkuI3lkIznmoTor43vvIjku47lkI7lvoDliY3vvIkKICAgICAgICBsZXQgbGFzdERpZmYxID0gd29yZHMxLmxlbmd0aCAtIDE7CiAgICAgICAgbGV0IGxhc3REaWZmMiA9IHdvcmRzMi5sZW5ndGggLSAxOwogICAgICAgIHdoaWxlIChsYXN0RGlmZjEgPj0gMCAmJiBsYXN0RGlmZjIgPj0gMCAmJiB3b3JkczFbbGFzdERpZmYxXSA9PT0gd29yZHMyW2xhc3REaWZmMl0pIHsKICAgICAgICAgIGxhc3REaWZmMS0tOwogICAgICAgICAgbGFzdERpZmYyLS07CiAgICAgICAgfQoKICAgICAgICAvLyDmj5Dlj5bnm7jlkIznmoTliY3nvIDlkozlkI7nvIAKICAgICAgICBjb25zdCBwcmVmaXggPSB3b3JkczEuc2xpY2UoMCwgZmlyc3REaWZmKS5qb2luKCcgJyk7CiAgICAgICAgY29uc3Qgc3VmZml4MSA9IHdvcmRzMS5zbGljZShsYXN0RGlmZjEgKyAxKS5qb2luKCcgJyk7CgogICAgICAgIC8vIOaPkOWPluS4jeWQjOeahOmDqOWIhgogICAgICAgIGNvbnN0IGRpZmYxID0gd29yZHMxLnNsaWNlKGZpcnN0RGlmZiwgbGFzdERpZmYxICsgMSkuam9pbignICcpOwogICAgICAgIGNvbnN0IGRpZmYyID0gd29yZHMyLnNsaWNlKGZpcnN0RGlmZiwgbGFzdERpZmYyICsgMSkuam9pbignICcpOwogICAgICAgIHJldHVybiBgCiAgICAgICAgICA8ZGl2IGNsYXNzPSJkaWZmLWV4cGxhaW4iPuWFt+S9k+W3ruW8gjo8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImRpZmYtY29udGVudCI+CiAgICAgICAgICAgICR7cHJlZml4ID8gYDxzcGFuIGNsYXNzPSJkaWZmLWNvbW1vbiI+JHtwcmVmaXh9PC9zcGFuPiBgIDogJyd9CiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJkaWZmLXJlbW92ZWQiPiR7ZGlmZjF9PC9zcGFuPiDihpIgCiAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJkaWZmLWFkZGVkIj4ke2RpZmYyfTwvc3Bhbj4KICAgICAgICAgICAgJHtzdWZmaXgxID8gYCA8c3BhbiBjbGFzcz0iZGlmZi1jb21tb24iPiR7c3VmZml4MX08L3NwYW4+YCA6ICcnfQogICAgICAgICAgPC9kaXY+CiAgICAgICAgYDsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+eUn+aIkOW3ruW8guWvueavlOWksei0pTonLCBlKTsKICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0KICAgIH0KICAgIGhpZGVUb29sdGlwKCkgewogICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgfQogICAgYXBwbHlTdWdnZXN0aW9ucyhzdWdnZXN0aW9ucykgewogICAgICB0aGlzLnN1Z2dlc3Rpb25zID0gc3VnZ2VzdGlvbnM7CgogICAgICAvLyDlhYjmuIXpmaTmiYDmnInlt7LmnInnmoTlu7rorq7moIforrAKICAgICAgdGhpcy5jbGVhckFsbFN1Z2dlc3Rpb25Gb3JtYXRzKCk7CgogICAgICAvLyDlupTnlKjmlrDnmoTlu7rorq7moIforrAKICAgICAgc3VnZ2VzdGlvbnMuZm9yRWFjaChzdWdnZXN0aW9uID0+IHsKICAgICAgICAvLyDlnKjmlofmoaPkuK3mn6Xmib7lu7rorq7nmoTljp/lp4vmlofmnKzkvY3nva4KICAgICAgICBjb25zdCBjb250ZW50ID0gdGhpcy5xdWlsbC5nZXRUZXh0KCk7CiAgICAgICAgbGV0IGluZGV4ID0gY29udGVudC5pbmRleE9mKHN1Z2dlc3Rpb24ub3JpZ2luYWwpOwogICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIOa3u+WKoOW7uuiuruagvOW8jwogICAgICAgICAgdGhpcy5xdWlsbC5mb3JtYXRUZXh0KGluZGV4LCBzdWdnZXN0aW9uLm9yaWdpbmFsLmxlbmd0aCwgewogICAgICAgICAgICAnc3VnZ2VzdGlvbic6IHsKICAgICAgICAgICAgICBpZDogc3VnZ2VzdGlvbi5pZCwKICAgICAgICAgICAgICBvcmlnaW5hbDogc3VnZ2VzdGlvbi5vcmlnaW5hbCwKICAgICAgICAgICAgICBzdWdnZXN0ZWQ6IHN1Z2dlc3Rpb24uc3VnZ2VzdGVkCiAgICAgICAgICAgIH0KICAgICAgICAgIH0sICdhcGknKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgY2xlYXJBbGxTdWdnZXN0aW9uRm9ybWF0cygpIHsKICAgICAgY29uc3QgY29udGVudCA9IHRoaXMucXVpbGwuZ2V0VGV4dCgpOwogICAgICB0aGlzLnF1aWxsLmZvcm1hdFRleHQoMCwgY29udGVudC5sZW5ndGgsIHsKICAgICAgICAnc3VnZ2VzdGlvbic6IGZhbHNlCiAgICAgIH0sICdhcGknKTsKICAgIH0KCiAgICAvLyDlnKjnu4Tku7bplIDmr4Hml7bmlq3lvIBNdXRhdGlvbk9ic2VydmVyCiAgICBkZXN0cm95KCkgewogICAgICAvLyDmuIXnkIbop4Llr5/lmagKICAgICAgaWYgKHRoaXMub2JzZXJ2ZXIpIHsKICAgICAgICB0aGlzLm9ic2VydmVyLmRpc2Nvbm5lY3QoKTsKICAgICAgICB0aGlzLm9ic2VydmVyID0gbnVsbDsKICAgICAgfQoKICAgICAgLy8g5riF55CG5LqL5Lu255uR5ZCs5ZmoCiAgICAgIGlmICh0aGlzLnF1aWxsICYmIHRoaXMucXVpbGwucm9vdCkgewogICAgICAgIHRoaXMucXVpbGwucm9vdC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuX2NsaWNrTGlzdGVuZXIpOwogICAgICB9CgogICAgICAvLyDmuIXnkIbmjInpkq7kuovku7bnm5HlkKzlmagKICAgICAgaWYgKHRoaXMuX2Fkb3B0TGlzdGVuZXIpIHsKICAgICAgICBjb25zdCBhZG9wdEJ0biA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5idG4tYWRvcHQnKTsKICAgICAgICBpZiAoYWRvcHRCdG4pIHsKICAgICAgICAgIGFkb3B0QnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fYWRvcHRMaXN0ZW5lcik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0aGlzLl9pZ25vcmVMaXN0ZW5lcikgewogICAgICAgIGNvbnN0IGlnbm9yZUJ0biA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5idG4taWdub3JlJyk7CiAgICAgICAgaWYgKGlnbm9yZUJ0bikgewogICAgICAgICAgaWdub3JlQnRuLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5faWdub3JlTGlzdGVuZXIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8g56e76ZmkdG9vbHRpcOWuueWZqAogICAgICBpZiAodGhpcy5jb250YWluZXIgJiYgdGhpcy5jb250YWluZXIucGFyZW50Tm9kZSkgewogICAgICAgIHRoaXMuY29udGFpbmVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5jb250YWluZXIpOwogICAgICAgIHRoaXMuY29udGFpbmVyID0gbnVsbDsKICAgICAgfQogICAgfQogIH07CiAgd2luZG93LlF1aWxsLnJlZ2lzdGVyKCdtb2R1bGVzL3N1Z2dlc3Rpb24nLCBTdWdnZXN0aW9uTW9kdWxlKTsKfTsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdDb250cmFjdERldGFpbCcsCiAgY29tcG9uZW50czogewogICAgUXVpbGxFZGl0b3IsCiAgICBEb3dubG9hZCwKICAgIERvY3VtZW50QWRkLAogICAgTWFnaWNTdGljaywKICAgIENoZWNrLAogICAgV2FybmluZywKICAgIFdhcm5pbmdGaWxsZWQsCiAgICBEb2N1bWVudCwKICAgIEluZm9GaWxsZWQsCiAgICBFZGl0LAogICAgUmVhZGluZywKICAgIENsb3NlLAogICAgTG9hZGluZywKICAgIEFycm93UmlnaHQsCiAgICBBcnJvd0xlZnQsCiAgICBUaW1lciwKICAgIFBvc2l0aW9uLAogICAgU2V0dGluZywKICAgIERvY3VtZW50Q2hlY2tlZCwKICAgIE5vdGVib29rLAogICAgUGx1cwogIH0sCiAgc2V0dXAoKSB7CiAgICBjb25zdCByb3V0ZSA9IHVzZVJvdXRlKCk7CiAgICBjb25zdCByb3V0ZXIgPSB1c2VSb3V0ZXIoKTsKICAgIC8vIOehruS/nWNvbnRyYWN0SWTmmK/mlbDlrZfnsbvlnovvvIzkuJTlj6rlnKjlkIjlkIzor6bmg4XpobXpnaLmnInmlYgKICAgIGNvbnN0IGNvbnRyYWN0SWQgPSBjb21wdXRlZCgoKSA9PiB7CiAgICAgIC8vIOWmguaenOS4jeWcqOWQiOWQjOivpuaDhemhtemdou+8jOebtOaOpei/lOWbnm51bGwKICAgICAgaWYgKHJvdXRlLm5hbWUgIT09ICdDb250cmFjdERldGFpbCcpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBpZCA9IHJvdXRlLnBhcmFtcy5pZDsKICAgICAgcmV0dXJuICFpc05hTihOdW1iZXIoaWQpKSA/IE51bWJlcihpZCkgOiBudWxsOwogICAgfSk7CgogICAgLy8g54q25oCB5Y+Y6YeP5ZKM5ZON5bqU5byP5pWw5o2uCiAgICBjb25zdCBhY3RpdmVUYWIgPSByZWYoJ2Jhc2ljSW5mbycpOwogICAgY29uc3QgYWN0aXZlQ29sbGFwc2UgPSByZWYoWydsZWdhbENvbXBsaWFuY2UnLCAnY2xhdXNlQ29tcGxldGVuZXNzJywgJ3Jpc2tBbGVydCddKTsKICAgIGNvbnN0IGFjdGl2ZVN1Z2dlc3Rpb25Db2xsYXBzZSA9IHJlZihbJ3N5bnRheCcsICd0ZXJtaW5vbG9neSddKTsKCiAgICAvLyDkuKrmgKfljJbmtqboibLlgY/lpb3orr7nva4KICAgIGNvbnN0IHBvbGlzaFByZWZlcmVuY2VzID0gcmVhY3RpdmUoewogICAgICBzdHlsZTogJ25ldXRyYWwnLAogICAgICAvLyDor63oqIDpo47moLzvvJrmraPlvI/kuKXosKjjgIHkuK3mgKfkuJPkuJrjgIHnroDmtIHmmI7kuoYKICAgICAgY29udHJhY3RUeXBlOiAnZ2VuZXJhbCcsCiAgICAgIC8vIOWQiOWQjOexu+Wei++8mumAmueUqOOAgeS5sOWNluOAgeWKs+WKoeetiQogICAgICBmb2N1czogWydncmFtbWFyJywgJ3Rlcm1pbm9sb2d5J10gLy8g5LyY5YyW6YeN54K577ya6K+t5rOV44CB5pyv6K+t44CB5Y+l5byP44CB5LiA6Ie05oCnCiAgICB9KTsKCiAgICAvLyDmo4Dmn6XlgY/lpb3orr7nva4KICAgIGNvbnN0IGNoZWNrUHJlZmVyZW5jZXMgPSByZWFjdGl2ZSh7CiAgICAgIGxlZ2FsQ29tcGxpYW5jZTogdHJ1ZSwKICAgICAgLy8g5rOV5b6L5ZCI6KeE5oCn5qOA5p+lCiAgICAgIGNvbXBsZXRlbmVzczogdHJ1ZSwKICAgICAgLy8g5p2h5qy+5a6M5pW05oCn5qOA5p+lCiAgICAgIHJpc2tBbGVydDogdHJ1ZSwKICAgICAgLy8g6aOO6Zmp5o+Q56S65qOA5p+lCiAgICAgIGNvbnRyYWN0VHlwZTogJ2dlbmVyYWwnLAogICAgICAvLyDlkIjlkIznsbvlnovlj4LogIPvvJrpgJrnlKjjgIHkubDljZbjgIHlirPliqHnrYkKICAgICAgY2hlY2tEZXB0aDogJ3N0YW5kYXJkJyAvLyDmo4Dmn6Xmt7HluqbvvJrmoIflh4bjgIHmt7HluqbjgIHlv6vpgJ8KICAgIH0pOwoKICAgIC8vIOiHquWumuS5ieacr+ivreeuoeeQhgogICAgY29uc3QgY3VzdG9tVGVybWlub2xvZ2llcyA9IHJlZihbXSk7CiAgICBjb25zdCBuZXdUZXJtaW5vbG9neSA9IHJlYWN0aXZlKHsKICAgICAgdGVybTogJycKICAgIH0pOwoKICAgIC8vIOa3u+WKoOiHquWumuS5ieacr+ivrQogICAgY29uc3QgYWRkQ3VzdG9tVGVybWlub2xvZ3kgPSAoKSA9PiB7CiAgICAgIGlmICghbmV3VGVybWlub2xvZ3kudGVybS50cmltKCkpIHJldHVybjsKICAgICAgaWYgKCFjdXN0b21UZXJtaW5vbG9naWVzLnZhbHVlLmluY2x1ZGVzKG5ld1Rlcm1pbm9sb2d5LnRlcm0udHJpbSgpKSkgewogICAgICAgIGN1c3RvbVRlcm1pbm9sb2dpZXMudmFsdWUucHVzaChuZXdUZXJtaW5vbG9neS50ZXJtLnRyaW0oKSk7CiAgICAgICAgbmV3VGVybWlub2xvZ3kudGVybSA9ICcnOwoKICAgICAgICAvLyDlpoLmnpznlKjmiLfmt7vliqDkuobmnK/or63vvIzoh6rliqjli77pgIki5pyv6K+tIuS8mOWMlumHjeeCuQogICAgICAgIGlmICghcG9saXNoUHJlZmVyZW5jZXMuZm9jdXMuaW5jbHVkZXMoJ3Rlcm1pbm9sb2d5JykpIHsKICAgICAgICAgIHBvbGlzaFByZWZlcmVuY2VzLmZvY3VzLnB1c2goJ3Rlcm1pbm9sb2d5Jyk7CiAgICAgICAgfQoKICAgICAgICAvLyDkv53lrZjliLDmnKzlnLDlrZjlgqgKICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY3VzdG9tVGVybWlub2xvZ2llcycsIEpTT04uc3RyaW5naWZ5KGN1c3RvbVRlcm1pbm9sb2dpZXMudmFsdWUpKTsKICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5bey5re75Yqg5pyv6K+tJyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgRWxNZXNzYWdlLndhcm5pbmcoJ+ivpeacr+ivreW3suWtmOWcqCcpOwogICAgICAgIG5ld1Rlcm1pbm9sb2d5LnRlcm0gPSAnJzsKICAgICAgfQogICAgfTsKCiAgICAvLyDnp7vpmaToh6rlrprkuYnmnK/or60KICAgIGNvbnN0IHJlbW92ZUN1c3RvbVRlcm1pbm9sb2d5ID0gaW5kZXggPT4gewogICAgICBjdXN0b21UZXJtaW5vbG9naWVzLnZhbHVlLnNwbGljZShpbmRleCwgMSk7CgogICAgICAvLyDkv53lrZjliLDmnKzlnLDlrZjlgqgKICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2N1c3RvbVRlcm1pbm9sb2dpZXMnLCBKU09OLnN0cmluZ2lmeShjdXN0b21UZXJtaW5vbG9naWVzLnZhbHVlKSk7CiAgICB9OwogICAgY29uc3QgaXNDaGVja2luZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBxdWlsbEVkaXRvciA9IHJlZihudWxsKTsKICAgIGNvbnN0IHNob3dBaVN1Z2dlc3Rpb25zID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IGlzTG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBpc1NhdmluZyA9IHJlZihmYWxzZSk7CgogICAgLy8g5re75Yqg5ZCI5ZCM57yW6L6R5Yy65Z+f55qE5byV55SoCiAgICBjb25zdCBjb250cmFjdEVkaXRDb250YWluZXIgPSByZWYobnVsbCk7CiAgICBjb25zdCBhaVBvbGlzaFNpZGViYXIgPSByZWYobnVsbCk7CiAgICBjb25zdCBlZGl0b3JNYWluQXJlYSA9IHJlZihudWxsKTsKCiAgICAvLyDmt7vliqDlkIjlkIzmo4Dmn6XljLrln5/nmoTlvJXnlKgKICAgIGNvbnN0IGNvbnRyYWN0Q2hlY2tDb250YWluZXIgPSByZWYobnVsbCk7CiAgICBjb25zdCBjaGVja1NpZGViYXIgPSByZWYobnVsbCk7CiAgICBjb25zdCBjaGVja1Jlc3VsdEFyZWEgPSByZWYobnVsbCk7CgogICAgLy8g5a6e5pe2QUnmtqboibLnm7jlhbPnirbmgIHvvIzmlLnkuLrmiYvliqjop6blj5EKICAgIGNvbnN0IGlzUmVhbFRpbWVQb2xpc2hpbmcgPSByZWYoZmFsc2UpOyAvLyDmlLnkuLrpu5jorqTlhbPpl60KICAgIGNvbnN0IHJlYWxUaW1lUG9saXNoTG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBsYXN0QW5hbHl6ZWRDb250ZW50ID0gcmVmKCcnKTsKICAgIGNvbnN0IGxhc3RBbmFseXNpc1RpbWUgPSByZWYoMCk7CgogICAgLy8g5YaF6IGU5bu66K6u6K6+572uCiAgICBjb25zdCBlbmFibGVJbmxpbmVTdWdnZXN0aW9ucyA9IHJlZih0cnVlKTsgLy8g5o6n5Yi25piv5ZCm5Zyo57yW6L6R5Zmo5Lit5pi+56S65YaF6IGU5bu66K6uCgogICAgLy8g6Z2i5p2/5oqY5Y+g54q25oCBCiAgICBjb25zdCBpc0FpUGFuZWxDb2xsYXBzZWQgPSByZWYoZmFsc2UpOwoKICAgIC8vIOWIh+aNoumdouadv+aKmOWPoOeKtuaAgQogICAgY29uc3QgdG9nZ2xlQWlQYW5lbENvbGxhcHNlID0gKCkgPT4gewogICAgICBpc0FpUGFuZWxDb2xsYXBzZWQudmFsdWUgPSAhaXNBaVBhbmVsQ29sbGFwc2VkLnZhbHVlOwogICAgfTsKCiAgICAvLyDlr4zmlofmnKznvJbovpHlmajphY3nva4KICAgIGNvbnN0IGVkaXRvck9wdGlvbiA9IHsKICAgICAgcGxhY2Vob2xkZXI6ICfor7fovpPlhaXlkIjlkIzlhoXlrrknLAogICAgICBtb2R1bGVzOiB7CiAgICAgICAgdG9vbGJhcjogW1snYm9sZCcsICdpdGFsaWMnLCAndW5kZXJsaW5lJywgJ3N0cmlrZSddLCBbJ2Jsb2NrcXVvdGUnLCAnY29kZS1ibG9jayddLCBbewogICAgICAgICAgJ2hlYWRlcic6IDEKICAgICAgICB9LCB7CiAgICAgICAgICAnaGVhZGVyJzogMgogICAgICAgIH1dLCBbewogICAgICAgICAgJ2xpc3QnOiAnb3JkZXJlZCcKICAgICAgICB9LCB7CiAgICAgICAgICAnbGlzdCc6ICdidWxsZXQnCiAgICAgICAgfV0sIFt7CiAgICAgICAgICAnc2NyaXB0JzogJ3N1YicKICAgICAgICB9LCB7CiAgICAgICAgICAnc2NyaXB0JzogJ3N1cGVyJwogICAgICAgIH1dLCBbewogICAgICAgICAgJ2luZGVudCc6ICctMScKICAgICAgICB9LCB7CiAgICAgICAgICAnaW5kZW50JzogJysxJwogICAgICAgIH1dLCBbewogICAgICAgICAgJ2RpcmVjdGlvbic6ICdydGwnCiAgICAgICAgfV0sIFt7CiAgICAgICAgICAnc2l6ZSc6IFsnc21hbGwnLCBmYWxzZSwgJ2xhcmdlJywgJ2h1Z2UnXQogICAgICAgIH1dLCBbewogICAgICAgICAgJ2hlYWRlcic6IFsxLCAyLCAzLCA0LCA1LCA2LCBmYWxzZV0KICAgICAgICB9XSwgW3sKICAgICAgICAgICdjb2xvcic6IFtdCiAgICAgICAgfSwgewogICAgICAgICAgJ2JhY2tncm91bmQnOiBbXQogICAgICAgIH1dLCBbewogICAgICAgICAgJ2ZvbnQnOiBbXQogICAgICAgIH1dLCBbewogICAgICAgICAgJ2FsaWduJzogW10KICAgICAgICB9XSwgWydjbGVhbiddXSwKICAgICAgICBzdWdnZXN0aW9uOiB7CiAgICAgICAgICBzdWdnZXN0aW9uczogW10sCiAgICAgICAgICBvbkFkb3B0OiBzdWdnZXN0aW9uSWQgPT4gewogICAgICAgICAgICBhZG9wdElubGluZUVkaXRTdWdnZXN0aW9uKHN1Z2dlc3Rpb25JZCk7CiAgICAgICAgICB9LAogICAgICAgICAgb25JZ25vcmU6IHN1Z2dlc3Rpb25JZCA9PiB7CiAgICAgICAgICAgIGlnbm9yZUlubGluZUVkaXRTdWdnZXN0aW9uKHN1Z2dlc3Rpb25JZCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIC8vIOWQiOWQjOivpuaDheaVsOaNrgogICAgY29uc3QgY29udHJhY3REZXRhaWxzID0gcmVhY3RpdmUoewogICAgICBpZDogY29udHJhY3RJZC52YWx1ZSwKICAgICAgbnVtYmVyOiAnJywKICAgICAgdGl0bGU6ICcnLAogICAgICB0eXBlOiAnJywKICAgICAgYW1vdW50OiAnJywKICAgICAgY29tcGFueTogJycsCiAgICAgIHNpZ25EYXRlOiAnJywKICAgICAgc3RhcnREYXRlOiAnJywKICAgICAgZXhwaXJlRGF0ZTogJycsCiAgICAgIGNvbnRlbnQ6ICcnLAogICAgICBzdGF0dXM6ICcnLAogICAgICBjcmVhdGVkX2J5OiBudWxsLAogICAgICBjcmVhdGVkX2F0OiAnJywKICAgICAgdXBkYXRlZF9hdDogJycsCiAgICAgIGF0dGFjaG1lbnRzOiBbXSwKICAgICAgYWN0aW9uczogW10KICAgIH0pOwoKICAgIC8vIOiuoeeul+WQiOWQjOagh+mimAogICAgY29uc3QgY29udHJhY3RUaXRsZSA9IGNvbXB1dGVkKCgpID0+IHsKICAgICAgcmV0dXJuIGNvbnRyYWN0RGV0YWlscy50aXRsZSA/IGDlkIjlkIzor6bmg4U6ICR7Y29udHJhY3REZXRhaWxzLm51bWJlcn1gIDogJ+WKoOi9veS4rS4uLic7CiAgICB9KTsKCiAgICAvLyDlkIjlkIzmo4Dmn6Xnu5PmnpwKICAgIGNvbnN0IGNoZWNrUmVzdWx0ID0gcmVhY3RpdmUoewogICAgICB0b3RhbElzc3VlczogMCwKICAgICAgY3JpdGljYWxJc3N1ZXM6IDAsCiAgICAgIHdhcm5pbmdJc3N1ZXM6IDAsCiAgICAgIHN1Z2dlc3Rpb25zOiAwLAogICAgICBsZWdhbENvbXBsaWFuY2VJc3N1ZXM6IFtdLAogICAgICBjb21wbGV0ZW5lc3NJc3N1ZXM6IFtdLAogICAgICByaXNrQWxlcnRzOiBbXQogICAgfSk7CgogICAgLy8gQUnlu7rorq4KICAgIGNvbnN0IGFpU3VnZ2VzdGlvbnMgPSByZWFjdGl2ZSh7CiAgICAgIHN5bnRheDogW10sCiAgICAgIHRlcm1pbm9sb2d5OiBbXQogICAgfSk7CgogICAgLy8g5pON5L2c5Y6G5Y+yIC0g5LuO5ZCI5ZCMYWN0aW9uc+S4reiOt+WPlgogICAgY29uc3QgY29udHJhY3RIaXN0b3J5ID0gY29tcHV0ZWQoKCkgPT4gewogICAgICB2YXIgX2NvbnRyYWN0RGV0YWlscyRhY3RpOwogICAgICByZXR1cm4gKChfY29udHJhY3REZXRhaWxzJGFjdGkgPSBjb250cmFjdERldGFpbHMuYWN0aW9ucykgPT09IG51bGwgfHwgX2NvbnRyYWN0RGV0YWlscyRhY3RpID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfY29udHJhY3REZXRhaWxzJGFjdGkubWFwKGFjdGlvbiA9PiB7CiAgICAgICAgdmFyIF9hY3Rpb24kdXNlcjsKICAgICAgICByZXR1cm4gewogICAgICAgICAgdGltZTogYWN0aW9uLmNyZWF0ZWRfYXQsCiAgICAgICAgICBjb250ZW50OiBgJHsoKF9hY3Rpb24kdXNlciA9IGFjdGlvbi51c2VyKSA9PT0gbnVsbCB8fCBfYWN0aW9uJHVzZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hY3Rpb24kdXNlci51c2VybmFtZSkgfHwgJ+ezu+e7nyd9ICR7YWN0aW9uLmRlc2NyaXB0aW9ufWAKICAgICAgICB9OwogICAgICB9KSkgfHwgW107CiAgICB9KTsKCiAgICAvLyDojrflj5blkIjlkIzor6bmg4UKICAgIGNvbnN0IGdldENvbnRyYWN0RGV0YWlscyA9IGFzeW5jIChsb2FkU2lsZW50bHkgPSBmYWxzZSkgPT4gewogICAgICB0cnkgewogICAgICAgIC8vIOajgOafpeaYr+WQpuWcqOWQiOWQjOivpuaDhemhtemdogogICAgICAgIGlmIChyb3V0ZS5uYW1lICE9PSAnQ29udHJhY3REZXRhaWwnKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygn5LiN5Zyo5ZCI5ZCM6K+m5oOF6aG16Z2i77yM6Lez6L+H5Yqg6L29Jyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyDmo4Dmn6Vjb250cmFjdElk5piv5ZCm5pyJ5pWICiAgICAgICAgaWYgKCFjb250cmFjdElkLnZhbHVlIHx8IGNvbnRyYWN0SWQudmFsdWUgPT09ICdjb250cmFjdCcgfHwgaXNOYU4oY29udHJhY3RJZC52YWx1ZSkpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCfml6DmlYjnmoTlkIjlkIxJRDonLCBjb250cmFjdElkLnZhbHVlKTsKICAgICAgICAgIC8vIOS4jeaYvuekuumUmeivr+a2iOaBr++8jOWPquWcqOaOp+WItuWPsOi+k+WHuuaXpeW/lwogICAgICAgICAgLy8gRWxNZXNzYWdlLmVycm9yKCfml6DmlYjnmoTlkIjlkIxJRCcpCiAgICAgICAgICByb3V0ZXIucHVzaCh7CiAgICAgICAgICAgIG5hbWU6ICdDb250cmFjdCcKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpc0xvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0Q29udHJhY3REZXRhaWwoY29udHJhY3RJZC52YWx1ZSk7CiAgICAgICAgY29uc29sZS5sb2coJ+WQiOWQjOivpuaDhUFQSeWTjeW6lDonLCByZXNwb25zZSk7CgogICAgICAgIC8vIOehruS/nXJlc3BvbnNlLmRhdGHlrZjlnKjvvIzpgILlupRyZXF1ZXN0Lmpz5Lit55qE5pWw5o2u57uT5p6E5aSE55CGCiAgICAgICAgY29uc3QgY29udHJhY3REYXRhID0gcmVzcG9uc2UuZGF0YSB8fCByZXNwb25zZTsKCiAgICAgICAgLy8g5aGr5YWF5ZCI5ZCM6K+m5oOFCiAgICAgICAgT2JqZWN0LmtleXMoY29udHJhY3REZXRhaWxzKS5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgICBpZiAoa2V5IGluIGNvbnRyYWN0RGF0YSkgewogICAgICAgICAgICBjb250cmFjdERldGFpbHNba2V5XSA9IGNvbnRyYWN0RGF0YVtrZXldOwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyDnibnmrorlpITnkIZjb250ZW505a2X5q61CiAgICAgICAgaWYgKGNvbnRyYWN0RGF0YS5jb250ZW50KSB7CiAgICAgICAgICBjb250cmFjdERldGFpbHMuY29udGVudCA9IGNvbnRyYWN0RGF0YS5jb250ZW50OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyDkv67mraPpu5jorqTlhoXlrrnvvIznp7vpmaTnqbrmoIfnrb7lkozml6DmhI/kuYnnmoTnnIHnlaXlj7cKICAgICAgICAgIGNvbnRyYWN0RGV0YWlscy5jb250ZW50ID0gYDxwPui/memHjOaYr+WQiOWQjOaWh+acrOWGheWuue+8jOivt+e8lui+kS4uLjwvcD4KPHA+PHN0cm9uZz7nlLLmlrnvvJo8L3N0cm9uZz7miJHmlrnlhazlj7jlkI3np7A8L3A+CjxwPjxzdHJvbmc+5LmZ5pa577yaPC9zdHJvbmc+JHtjb250cmFjdERldGFpbHMuY29tcGFueSB8fCAn5a+55pa55YWs5Y+4J308L3A+YDsKICAgICAgICB9CgogICAgICAgIC8vIOi9rOaNouaXpeacn+agvOW8jwogICAgICAgIGlmIChjb250cmFjdERhdGEuc2lnbl9kYXRlKSBjb250cmFjdERldGFpbHMuc2lnbkRhdGUgPSBjb250cmFjdERhdGEuc2lnbl9kYXRlOwogICAgICAgIGlmIChjb250cmFjdERhdGEuc3RhcnRfZGF0ZSkgY29udHJhY3REZXRhaWxzLnN0YXJ0RGF0ZSA9IGNvbnRyYWN0RGF0YS5zdGFydF9kYXRlOwogICAgICAgIGlmIChjb250cmFjdERhdGEuZXhwaXJlX2RhdGUpIGNvbnRyYWN0RGV0YWlscy5leHBpcmVEYXRlID0gY29udHJhY3REYXRhLmV4cGlyZV9kYXRlOwoKICAgICAgICAvLyDmoLzlvI/ljJbph5Hpop0KICAgICAgICBpZiAoY29udHJhY3REYXRhLmFtb3VudCkgewogICAgICAgICAgY29udHJhY3REZXRhaWxzLmFtb3VudCA9IE51bWJlcihjb250cmFjdERhdGEuYW1vdW50KS50b0xvY2FsZVN0cmluZygnemgtQ04nKTsKICAgICAgICB9CgogICAgICAgIC8vIOWPquacieWcqOmdnumdmem7mOWKoOi9veaXtuaJjeaYvuekuuaIkOWKn+aPkOekugogICAgICAgIGlmICghbG9hZFNpbGVudGx5KSB7CiAgICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5ZCI5ZCM6K+m5oOF5Yqg6L295oiQ5YqfJyk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WKoOi9veWQiOWQjOivpuaDheWksei0pTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfliqDovb3lkIjlkIzor6bmg4XlpLHotKXvvIzor7fnqI3lkI7ph43or5UnKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBpc0xvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgfQogICAgfTsKCiAgICAvLyDov5Tlm57liJfooagKICAgIGNvbnN0IGdvQmFjayA9ICgpID0+IHsKICAgICAgcm91dGVyLnB1c2goewogICAgICAgIG5hbWU6ICdDb250cmFjdCcKICAgICAgfSk7CiAgICB9OwoKICAgIC8vIOS/neWtmOabtOaUuQogICAgY29uc3Qgc2F2ZUNoYW5nZXMgPSBhc3luYyAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgaXNTYXZpbmcudmFsdWUgPSB0cnVlOwogICAgICAgIGNvbnN0IGxvYWRpbmcgPSBFbExvYWRpbmcuc2VydmljZSh7CiAgICAgICAgICBsb2NrOiB0cnVlLAogICAgICAgICAgdGV4dDogJ+S/neWtmOS4rS4uLicsCiAgICAgICAgICBiYWNrZ3JvdW5kOiAncmdiYSgwLCAwLCAwLCAwLjcpJwogICAgICAgIH0pOwoKICAgICAgICAvLyDmoLzlvI/ljJbml6XmnJ/kuLpZWVlZLU1NLURECiAgICAgICAgY29uc3QgZm9ybWF0RGF0ZSA9IGRhdGUgPT4gewogICAgICAgICAgaWYgKCFkYXRlKSByZXR1cm4gJyc7CgogICAgICAgICAgLy8g5aSE55CG5a2X56ym5Liy5pel5pyfIC0g56Gu5L+d5qC85byP5q2j56GuCiAgICAgICAgICBpZiAodHlwZW9mIGRhdGUgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIC8vIOajgOafpeaYr+WQpuW3sue7j+aYr+ato+ehrueahOagvOW8jwogICAgICAgICAgICBpZiAoL15cZHs0fS1cZHsyfS1cZHsyfSQvLnRlc3QoZGF0ZSkpIHsKICAgICAgICAgICAgICByZXR1cm4gZGF0ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g5bCd6K+V6Kej5p6Q5YW25LuW5qC85byP55qE5a2X56ym5Liy5pel5pyfCiAgICAgICAgICAgIGNvbnN0IHBhcnNlZERhdGUgPSBuZXcgRGF0ZShkYXRlKTsKICAgICAgICAgICAgaWYgKCFpc05hTihwYXJzZWREYXRlLmdldFRpbWUoKSkpIHsKICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0RGF0ZU9iamVjdChwYXJzZWREYXRlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICB9CgogICAgICAgICAgLy8g5aSE55CG5pel5pyf5a+56LGhCiAgICAgICAgICBpZiAoZGF0ZSBpbnN0YW5jZW9mIERhdGUgJiYgIWlzTmFOKGRhdGUuZ2V0VGltZSgpKSkgewogICAgICAgICAgICByZXR1cm4gZm9ybWF0RGF0ZU9iamVjdChkYXRlKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9OwoKICAgICAgICAvLyDovoXliqnlh73mlbDvvJrlsIZEYXRl5a+56LGh5qC85byP5YyW5Li6WVlZWS1NTS1ERAogICAgICAgIGNvbnN0IGZvcm1hdERhdGVPYmplY3QgPSBkYXRlT2JqID0+IHsKICAgICAgICAgIGNvbnN0IHllYXIgPSBkYXRlT2JqLmdldEZ1bGxZZWFyKCk7CiAgICAgICAgICBjb25zdCBtb250aCA9IFN0cmluZyhkYXRlT2JqLmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpOwogICAgICAgICAgY29uc3QgZGF5ID0gU3RyaW5nKGRhdGVPYmouZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCAnMCcpOwogICAgICAgICAgcmV0dXJuIGAke3llYXJ9LSR7bW9udGh9LSR7ZGF5fWA7CiAgICAgICAgfTsKCiAgICAgICAgLy8g5YeG5aSH5pu05paw5pWw5o2uCiAgICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHsKICAgICAgICAgIHRpdGxlOiBjb250cmFjdERldGFpbHMudGl0bGUsCiAgICAgICAgICB0eXBlOiBjb250cmFjdERldGFpbHMudHlwZSwKICAgICAgICAgIGFtb3VudDogY29udHJhY3REZXRhaWxzLmFtb3VudC50b1N0cmluZygpLnJlcGxhY2UoL1teXGQuXS9nLCAnJyksCiAgICAgICAgICBjb21wYW55OiBjb250cmFjdERldGFpbHMuY29tcGFueSwKICAgICAgICAgIHNpZ25fZGF0ZTogZm9ybWF0RGF0ZShjb250cmFjdERldGFpbHMuc2lnbkRhdGUpLAogICAgICAgICAgc3RhcnRfZGF0ZTogZm9ybWF0RGF0ZShjb250cmFjdERldGFpbHMuc3RhcnREYXRlKSwKICAgICAgICAgIGV4cGlyZV9kYXRlOiBmb3JtYXREYXRlKGNvbnRyYWN0RGV0YWlscy5leHBpcmVEYXRlKSwKICAgICAgICAgIGNvbnRlbnQ6IGNvbnRyYWN0RGV0YWlscy5jb250ZW50CiAgICAgICAgfTsKCiAgICAgICAgLy8g56Gu5L+d5pel5pyf5a2X5q615pyJ5pWICiAgICAgICAgaWYgKCF1cGRhdGVEYXRhLnNpZ25fZGF0ZSkgewogICAgICAgICAgRWxNZXNzYWdlLndhcm5pbmcoJ+etvue6puaXpeacn+agvOW8j+aXoOaViO+8jOivt+ajgOafpScpOwogICAgICAgICAgbG9hZGluZy5jbG9zZSgpOwogICAgICAgICAgaXNTYXZpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIOiwg+eUqEFQSeS/neWtmOabtOaWsAogICAgICAgIGF3YWl0IHVwZGF0ZUNvbnRyYWN0KGNvbnRyYWN0SWQudmFsdWUsIHVwZGF0ZURhdGEpOwogICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCflkIjlkIzmm7TmlLnlt7Lkv53lrZgnKTsKCiAgICAgICAgLy8g6YeN5paw6I635Y+W5pyA5paw5pWw5o2u77yM6Z2Z6buY5Yqg6L295LiN5pi+56S65o+Q56S6CiAgICAgICAgYXdhaXQgZ2V0Q29udHJhY3REZXRhaWxzKHRydWUpOwogICAgICAgIGxvYWRpbmcuY2xvc2UoKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfkv53lrZjlkIjlkIzmm7TmlLnlpLHotKU6JywgZXJyb3IpOwoKICAgICAgICAvLyDmt7vliqDor6bnu4bplJnor6/kv6Hmga/ml6Xlv5cKICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UgJiYgZXJyb3IucmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgY29uc29sZS5lcnJvcign6ZSZ6K+v5ZON5bqU5pWw5o2uOicsIGVycm9yLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+S/neWtmOWksei0pe+8jOivt+ajgOafpei+k+WFpeWGheWuueWSjOaXpeacn+agvOW8jycpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGlzU2F2aW5nLnZhbHVlID0gZmFsc2U7CiAgICAgIH0KICAgIH07CgogICAgLy8g5byA5aeL5ZCI5ZCM5qOA5p+lCiAgICBjb25zdCBzdGFydENvbnRyYWN0Q2hlY2sgPSBhc3luYyAoKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCIlYz09PT09PT09PT0g5byA5aeL5ZCI5ZCM5qOA5p+lID09PT09PT09PT0iLCAiYmFja2dyb3VuZDojM2E4ZWU2O2NvbG9yOndoaXRlO3BhZGRpbmc6NHB4IDhweDtib3JkZXItcmFkaXVzOjRweDtmb250LXdlaWdodDpib2xkOyIpOwogICAgICBjb25zb2xlLmxvZygic3RhcnRDb250cmFjdENoZWNr5Ye95pWw6KKr6LCD55SoIik7CgogICAgICAvLyDlvLrliLbkv67lpI3mu5rliqjmoLflvI8KICAgICAgaWYgKGNoZWNrUmVzdWx0QXJlYS52YWx1ZSkgewogICAgICAgIGNvbnNvbGUubG9nKCLnoa7kv53mo4Dmn6Xnu5PmnpzljLrln5/moLflvI/mraPnoa4iKTsKCiAgICAgICAgLy8g56Gu5L+dY2hlY2stcmVzdWx0LWFyZWHlrrnlmajljaDmu6Hpq5jluqYKICAgICAgICBjaGVja1Jlc3VsdEFyZWEudmFsdWUuc3R5bGUuaGVpZ2h0ID0gJzEwMCUnOwoKICAgICAgICAvLyBlbC1zY3JvbGxiYXLlsIboh6rliqjlpITnkIbmu5rliqjvvIzkuI3pnIDopoHpop3lpJborr7nva4KICAgICAgICBjb25zb2xlLmxvZygi5L2/55SoZWwtc2Nyb2xsYmFy57uE5Lu25aSE55CG5rua5YqoIik7CiAgICAgIH0KCiAgICAgIC8vIOS4jeWGjeWwneivleWkhOeQhuiHquWumuS5iea7muWKqOWuueWZqO+8jOiAjOaYr+WujOWFqOS+nei1lmVsLXNjcm9sbGJhcgoKICAgICAgLy8g5bCd6K+V5qOA57Si5b2T5YmN5rS75Yqo55qE5qCH562+CiAgICAgIGNvbnNvbGUubG9nKCLlvZPliY3mtLvliqjmoIfnrb7vvJoiLCBhY3RpdmVUYWIudmFsdWUpOwogICAgICAvLyDmo4Dmn6VIVE1M5piv5ZCm5a2Y5ZyoCiAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuY29udHJhY3QtZWRpdC1jb250YWluZXIiKSkgewogICAgICAgIGNvbnNvbGUubG9nKCLlkIjlkIzmo4Dmn6XlrrnlmahET03lhYPntKDlrZjlnKgiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmxvZygi6K2m5ZGK77ya5ZCI5ZCM5qOA5p+l5a655ZmoRE9N5YWD57Sg5LiN5a2Y5Zyo77yBIik7CiAgICAgICAgLy8g5bCd6K+V5p+l5om+5YW25LuW5Y+v6IO955qE5a655ZmoCiAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5jb250cmFjdC1kZXRhaWwtY29udGFpbmVyIikpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCLlj5HnjrDlkIjlkIzor6bmg4XlrrnlmajlhYPntKAiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb250cmFjdENoZWNrQ29udGFpbmVyIikpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCLpgJrov4dJROaJvuWIsOWQiOWQjOajgOafpeWuueWZqOWFg+e0oCIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8g5qOA5p+l5rua5Yqo5a655Zmo54q25oCBCiAgICAgIGlmIChjaGVja1Jlc3VsdEFyZWEudmFsdWUpIHsKICAgICAgICBjb25zdCBzdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGNoZWNrUmVzdWx0QXJlYS52YWx1ZSk7CiAgICAgICAgY29uc29sZS5sb2coIuajgOafpee7k+aenOWMuuWfn+agt+W8jzoiLCB7CiAgICAgICAgICBkaXNwbGF5OiBzdHlsZS5kaXNwbGF5LAogICAgICAgICAgaGVpZ2h0OiBzdHlsZS5oZWlnaHQsCiAgICAgICAgICBvdmVyZmxvdzogc3R5bGUub3ZlcmZsb3csCiAgICAgICAgICBwb3NpdGlvbjogc3R5bGUucG9zaXRpb24KICAgICAgICB9KTsKCiAgICAgICAgLy8g5by65Yi25Yi35paw5biD5bGACiAgICAgICAgY29uc29sZS5sb2coIuW8uuWItuWIt+aWsOajgOafpee7k+aenOWMuuWfn+W4g+WxgCIpOwogICAgICAgIGNoZWNrUmVzdWx0QXJlYS52YWx1ZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgY2hlY2tSZXN1bHRBcmVhLnZhbHVlLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CgogICAgICAgICAgLy8g6I635Y+W5rua5Yqo5a655Zmo5bm25qOA5p+lCiAgICAgICAgICBjb25zdCBzY3JvbGxXcmFwcGVyID0gY2hlY2tSZXN1bHRBcmVhLnZhbHVlLnF1ZXJ5U2VsZWN0b3IoJy5jaGVjay1jb250ZW50LXNjcm9sbC13cmFwcGVyJyk7CiAgICAgICAgICBpZiAoc2Nyb2xsV3JhcHBlcikgewogICAgICAgICAgICBjb25zdCBzY3JvbGxTdHlsZSA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHNjcm9sbFdyYXBwZXIpOwogICAgICAgICAgICBjb25zb2xlLmxvZygi5rua5Yqo5a655Zmo5qC35byPOiIsIHsKICAgICAgICAgICAgICBoZWlnaHQ6IHNjcm9sbFN0eWxlLmhlaWdodCwKICAgICAgICAgICAgICBvdmVyZmxvdzogc2Nyb2xsU3R5bGUub3ZlcmZsb3csCiAgICAgICAgICAgICAgcG9zaXRpb246IHNjcm9sbFN0eWxlLnBvc2l0aW9uCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigi5pyq5om+5Yiw5rua5Yqo5a655Zmo5YWD57Sg77yBIik7CiAgICAgICAgICB9CiAgICAgICAgfSwgNTApOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnNvbGUuZXJyb3IoImNoZWNrUmVzdWx0QXJlYeW8leeUqOS4jeWtmOWcqO+8gSIpOwogICAgICB9CiAgICAgIGlmIChpc0NoZWNraW5nLnZhbHVlKSB7CiAgICAgICAgY29uc29sZS5sb2coIuW3suacieajgOafpeato+WcqOi/m+ihjOS4re+8jOW/veeVpeatpOasoeeCueWHuyIpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8g5qOA5p+l5ZCI5ZCMSUTmmK/lkKbmnInmlYgKICAgICAgaWYgKCFjb250cmFjdElkLnZhbHVlIHx8IGlzTmFOKGNvbnRyYWN0SWQudmFsdWUpKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigi5ZCI5ZCMSUTml6DmlYg6IiwgY29udHJhY3RJZC52YWx1ZSk7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCflkIjlkIxJROaXoOaViO+8jOaXoOazlei/m+ihjOajgOafpScpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8g5qOA5p+l5ZCI5ZCM5YaF5a655piv5ZCm5Li656m6CiAgICAgIGlmICghY29udHJhY3REZXRhaWxzLmNvbnRlbnQpIHsKICAgICAgICBjb25zb2xlLmxvZygi5ZCI5ZCM5YaF5a655Li656m677yM5o+Q56S655So5oi3Iik7CiAgICAgICAgRWxNZXNzYWdlLndhcm5pbmcoJ+ivt+WFiOWcqOWQiOWQjOaWh+acrOagh+etvumhtei+k+WFpeWQiOWQjOWGheWuuScpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8g6L6T5Ye65YWz6ZSu5L+h5oGvCiAgICAgIGNvbnNvbGUubG9nKCLlvIDlp4vmiafooYzlkIjlkIzmo4Dmn6UgLSDor6bnu4bkv6Hmga86Iik7CiAgICAgIGNvbnNvbGUubG9nKCLlkIjlkIxJRDoiLCBjb250cmFjdElkLnZhbHVlLCB0eXBlb2YgY29udHJhY3RJZC52YWx1ZSk7CiAgICAgIGNvbnNvbGUubG9nKCLlhoXlrrnplb/luqY6IiwgY29udHJhY3REZXRhaWxzLmNvbnRlbnQubGVuZ3RoKTsKICAgICAgY29uc29sZS5sb2coIuajgOafpeWBj+Wlveiuvue9rjoiLCBKU09OLnN0cmluZ2lmeShjaGVja1ByZWZlcmVuY2VzLCBudWxsLCAyKSk7CiAgICAgIGlzQ2hlY2tpbmcudmFsdWUgPSB0cnVlOwogICAgICBsZXQgbG9hZGluZ0luc3RhbmNlID0gbnVsbDsKICAgICAgdHJ5IHsKICAgICAgICAvLyDmmL7npLrliqDovb3mj5DnpLoKICAgICAgICBjb25zb2xlLmxvZygi5pi+56S65Yqg6L295o+Q56S6Iik7CiAgICAgICAgbG9hZGluZ0luc3RhbmNlID0gRWxMb2FkaW5nLnNlcnZpY2UoewogICAgICAgICAgdGV4dDogJ0FJ5q2j5Zyo5YiG5p6Q5ZCI5ZCM5paH5pys77yM6K+356iN5YCZLi4uJywKICAgICAgICAgIGJhY2tncm91bmQ6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNyknCiAgICAgICAgfSk7CiAgICAgICAgRWxNZXNzYWdlLmluZm8oJ0FJ5YiG5p6Q5ZCI5ZCM5paH5pys5LitLi4uJyk7CgogICAgICAgIC8vIOWHhuWkh+ivt+axguWPguaVsO+8jOWMheWQq+S4quaAp+WMluiuvue9rgogICAgICAgIGNvbnN0IHJlcXVlc3RQYXJhbXMgPSB7CiAgICAgICAgICBjb250ZW50OiBjb250cmFjdERldGFpbHMuY29udGVudCwKICAgICAgICAgIHByZWZlcmVuY2VzOiB7CiAgICAgICAgICAgIGNvbnRyYWN0X3R5cGU6IGNoZWNrUHJlZmVyZW5jZXMuY29udHJhY3RUeXBlLAogICAgICAgICAgICBjaGVja19kZXB0aDogY2hlY2tQcmVmZXJlbmNlcy5jaGVja0RlcHRoLAogICAgICAgICAgICBjaGVja19hcmVhczogW10KICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICAvLyDmt7vliqDmo4Dmn6XljLrln58KICAgICAgICBpZiAoY2hlY2tQcmVmZXJlbmNlcy5sZWdhbENvbXBsaWFuY2UpIHsKICAgICAgICAgIHJlcXVlc3RQYXJhbXMucHJlZmVyZW5jZXMuY2hlY2tfYXJlYXMucHVzaCgnbGVnYWxfY29tcGxpYW5jZScpOwogICAgICAgIH0KICAgICAgICBpZiAoY2hlY2tQcmVmZXJlbmNlcy5jb21wbGV0ZW5lc3MpIHsKICAgICAgICAgIHJlcXVlc3RQYXJhbXMucHJlZmVyZW5jZXMuY2hlY2tfYXJlYXMucHVzaCgnY29tcGxldGVuZXNzJyk7CiAgICAgICAgfQogICAgICAgIGlmIChjaGVja1ByZWZlcmVuY2VzLnJpc2tBbGVydCkgewogICAgICAgICAgcmVxdWVzdFBhcmFtcy5wcmVmZXJlbmNlcy5jaGVja19hcmVhcy5wdXNoKCdyaXNrX2FsZXJ0Jyk7CiAgICAgICAgfQoKICAgICAgICAvLyDlpoLmnpzmsqHmnInpgInmi6nku7vkvZXmo4Dmn6XljLrln5/vvIzpu5jorqTpgInmi6nmiYDmnInljLrln58KICAgICAgICBpZiAocmVxdWVzdFBhcmFtcy5wcmVmZXJlbmNlcy5jaGVja19hcmVhcy5sZW5ndGggPT09IDApIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCLmnKrpgInmi6nku7vkvZXmo4Dmn6XljLrln5/vvIzkvb/nlKjpu5jorqTlhajpg6jmo4Dmn6UiKTsKICAgICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfmnKrpgInmi6nku7vkvZXmo4Dmn6XljLrln5/vvIzlsIbkvb/nlKjpu5jorqTlhajpg6jmo4Dmn6UnKTsKICAgICAgICAgIHJlcXVlc3RQYXJhbXMucHJlZmVyZW5jZXMuY2hlY2tfYXJlYXMgPSBbJ2xlZ2FsX2NvbXBsaWFuY2UnLCAnY29tcGxldGVuZXNzJywgJ3Jpc2tfYWxlcnQnXTsKICAgICAgICAgIC8vIOWQjOaXtuabtOaWsFVJ5Lit55qE5aSN6YCJ5qGG54q25oCBCiAgICAgICAgICBjaGVja1ByZWZlcmVuY2VzLmxlZ2FsQ29tcGxpYW5jZSA9IHRydWU7CiAgICAgICAgICBjaGVja1ByZWZlcmVuY2VzLmNvbXBsZXRlbmVzcyA9IHRydWU7CiAgICAgICAgICBjaGVja1ByZWZlcmVuY2VzLnJpc2tBbGVydCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGNvbnNvbGUubG9nKCLlj5HpgIHmo4Dmn6Xor7fmsYLlj4LmlbA6IiwgSlNPTi5zdHJpbmdpZnkocmVxdWVzdFBhcmFtcywgbnVsbCwgMikpOwogICAgICAgIGNvbnNvbGUubG9nKCLlj5HpgIHliLBBUEk6IiwgYC9hcGkvY29udHJhY3QvY29udHJhY3RzLyR7Y29udHJhY3RJZC52YWx1ZX0vY2hlY2tfY29udHJhY3QvYCk7CgogICAgICAgIC8vIOW8gOWni+WPkemAgeivt+axgueahOaXtumXtOaIswogICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIGNvbnNvbGUubG9nKCLlvIDlp4vor7fmsYLml7bpl7Q6IiwgbmV3IERhdGUoKS50b0xvY2FsZVRpbWVTdHJpbmcoKSk7CgogICAgICAgIC8vIOWPkemAgUFQSeivt+axggogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNoZWNrQ29udHJhY3QoY29udHJhY3RJZC52YWx1ZSwgcmVxdWVzdFBhcmFtcyk7CgogICAgICAgIC8vIOivt+axgue7k+adn+eahOaXtumXtOaIswogICAgICAgIGNvbnN0IGVuZFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICBjb25zb2xlLmxvZygi6K+35rGC5a6M5oiQ5pe26Ze0OiIsIG5ldyBEYXRlKCkudG9Mb2NhbGVUaW1lU3RyaW5nKCkpOwogICAgICAgIGNvbnNvbGUubG9nKCLor7fmsYLogJfml7Y6IiwgKGVuZFRpbWUgLSBzdGFydFRpbWUpIC8gMTAwMCwgIuenkiIpOwogICAgICAgIGNvbnNvbGUubG9nKCLmlLbliLDmo4Dmn6Xlk43lupQ6IiwgcmVzdWx0KTsKICAgICAgICBpZiAocmVzdWx0LmVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCLlkIjlkIzmo4Dmn6VBUEnov5Tlm57plJnor686IiwgcmVzdWx0LmVycm9yKTsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcihg5ZCI5ZCM5paH5pys5qOA5p+l5aSx6LSlOiAke3Jlc3VsdC5lcnJvcn1gKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIOabtOaWsOajgOafpee7k+aenAogICAgICAgIGNvbnNvbGUubG9nKCLmm7TmlrDmo4Dmn6Xnu5Pmnpzlr7nosaEuLi4iKTsKICAgICAgICBjaGVja1Jlc3VsdC50b3RhbElzc3VlcyA9IHJlc3VsdC50b3RhbElzc3VlcyB8fCAwOwogICAgICAgIGNoZWNrUmVzdWx0LmNyaXRpY2FsSXNzdWVzID0gcmVzdWx0LmNyaXRpY2FsSXNzdWVzIHx8IDA7CiAgICAgICAgY2hlY2tSZXN1bHQud2FybmluZ0lzc3VlcyA9IHJlc3VsdC53YXJuaW5nSXNzdWVzIHx8IDA7CiAgICAgICAgY2hlY2tSZXN1bHQuc3VnZ2VzdGlvbnMgPSByZXN1bHQuc3VnZ2VzdGlvbnMgfHwgMDsKCiAgICAgICAgLy8g5pu05paw5ZCE6aG56Zeu6aKYCiAgICAgICAgY2hlY2tSZXN1bHQubGVnYWxDb21wbGlhbmNlSXNzdWVzID0gcmVzdWx0LmxlZ2FsQ29tcGxpYW5jZUlzc3VlcyB8fCBbXTsKICAgICAgICBjaGVja1Jlc3VsdC5jb21wbGV0ZW5lc3NJc3N1ZXMgPSByZXN1bHQuY29tcGxldGVuZXNzSXNzdWVzIHx8IFtdOwogICAgICAgIGNoZWNrUmVzdWx0LnJpc2tBbGVydHMgPSByZXN1bHQucmlza0FsZXJ0cyB8fCBbXTsKICAgICAgICBpZiAoY2hlY2tSZXN1bHQudG90YWxJc3N1ZXMgPiAwKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhg5Y+R546wJHtjaGVja1Jlc3VsdC50b3RhbElzc3Vlc33kuKrpl67popjvvIzmj5DnpLrnlKjmiLfmn6XnnIvor6bmg4VgKTsKICAgICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKGDlj5HnjrAke2NoZWNrUmVzdWx0LnRvdGFsSXNzdWVzfeS4qumXrumimO+8jOivt+afpeeci+ivpuaDhWApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmxvZygn5pyq5Y+R546w6Zeu6aKY77yM5o+Q56S655So5oi35ZCI5ZCM5paH5pys6LSo6YeP6Imv5aW9Jyk7CiAgICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5pyq5Y+R546w5piO5pi+6Zeu6aKY77yM5ZCI5ZCM5paH5pys6LSo6YeP6Imv5aW9Jyk7CiAgICAgICAgfQoKICAgICAgICAvLyDoh6rliqjlsZXlvIDnrKzkuIDkuKrmnInpl67popjnmoTpg6jliIYKICAgICAgICBpZiAoY2hlY2tSZXN1bHQubGVnYWxDb21wbGlhbmNlSXNzdWVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCLoh6rliqjlsZXlvIDms5XlvovlkIjop4TmgKfpg6jliIYiKTsKICAgICAgICAgIGFjdGl2ZUNvbGxhcHNlLnZhbHVlID0gWydsZWdhbENvbXBsaWFuY2UnXTsKICAgICAgICB9IGVsc2UgaWYgKGNoZWNrUmVzdWx0LmNvbXBsZXRlbmVzc0lzc3Vlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygi6Ieq5Yqo5bGV5byA5p2h5qy+5a6M5pW05oCn6YOo5YiGIik7CiAgICAgICAgICBhY3RpdmVDb2xsYXBzZS52YWx1ZSA9IFsnY2xhdXNlQ29tcGxldGVuZXNzJ107CiAgICAgICAgfSBlbHNlIGlmIChjaGVja1Jlc3VsdC5yaXNrQWxlcnRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCLoh6rliqjlsZXlvIDpo47pmanmj5DnpLrpg6jliIYiKTsKICAgICAgICAgIGFjdGl2ZUNvbGxhcHNlLnZhbHVlID0gWydyaXNrQWxlcnQnXTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coIuWQiOWQjOajgOafpeWujOaIkO+8jOe7k+aenDoiLCBjaGVja1Jlc3VsdCk7CiAgICAgICAgY29uc29sZS5sb2coIiVjPT09PT09PT09PSDlkIjlkIzmo4Dmn6XlrozmiJAgPT09PT09PT09PSIsICJiYWNrZ3JvdW5kOiM2N2MyM2E7Y29sb3I6d2hpdGU7cGFkZGluZzo0cHggOHB4O2JvcmRlci1yYWRpdXM6NHB4O2ZvbnQtd2VpZ2h0OmJvbGQ7Iik7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignJWPlkIjlkIzmlofmnKzmo4Dmn6XlpLHotKU6JywgJ2NvbG9yOnJlZDtmb250LXdlaWdodDpib2xkOycsIGVycm9yKTsKICAgICAgICBjb25zb2xlLmVycm9yKCfplJnor6/or6bmg4U6JywgSlNPTi5zdHJpbmdpZnkoZXJyb3IsIG51bGwsIDIpKTsKICAgICAgICAvLyDlsJ3or5Xmj5Dlj5bmm7TlpJrplJnor6/kv6Hmga8KICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+acjeWKoeWZqOWTjeW6lDonLCBlcnJvci5yZXNwb25zZS5zdGF0dXMsIGVycm9yLnJlc3BvbnNlLnN0YXR1c1RleHQpOwogICAgICAgICAgY29uc29sZS5lcnJvcign5ZON5bqU5pWw5o2uOicsIGVycm9yLnJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0KICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoYOWQiOWQjOaWh+acrOajgOafpeWksei0pTogJHtlcnJvci5tZXNzYWdlIHx8ICfor7fnqI3lkI7ph43or5UnfWApOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIC8vIOWFs+mXreWKoOi9veaPkOekugogICAgICAgIGlmIChsb2FkaW5nSW5zdGFuY2UpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCLlhbPpl63liqDovb3mj5DnpLoiKTsKICAgICAgICAgIGxvYWRpbmdJbnN0YW5jZS5jbG9zZSgpOwogICAgICAgIH0KICAgICAgICBpc0NoZWNraW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgY29uc29sZS5sb2coIumHjee9ruajgOafpeeKtuaAgSBpc0NoZWNraW5nID0gZmFsc2UiKTsKICAgICAgfQogICAgfTsKCiAgICAvLyDpooTorqHml7bpl7Tmj5DnpLoKICAgIGNvbnN0IGVzdGltYXRlZFRpbWUgPSBjb21wdXRlZCgoKSA9PiB7CiAgICAgIGNvbnN0IGNvbnRlbnQgPSBjb250cmFjdERldGFpbHMuY29udGVudCB8fCAnJzsKICAgICAgY29uc3QgY2hhckNvdW50ID0gY29udGVudC5sZW5ndGg7CgogICAgICAvLyDmoLnmja7lrZfnrKbmlbDorqHnrpfpooTkvLDml7bpl7QKICAgICAgaWYgKGNoYXJDb3VudCA8PSAxMDAwKSByZXR1cm4gJ+e6pjEw56eSJzsKICAgICAgaWYgKGNoYXJDb3VudCA8PSA1MDAwKSByZXR1cm4gJ+e6pjMw56eSJzsKICAgICAgaWYgKGNoYXJDb3VudCA8PSAxNTAwMCkgcmV0dXJuICfnuqYx5YiG6ZKfJzsKICAgICAgaWYgKGNoYXJDb3VudCA8PSAzMDAwMCkgcmV0dXJuICfnuqYy5YiG6ZKfJzsKICAgICAgcmV0dXJuICcyLTPliIbpkp8nOwogICAgfSk7CgogICAgLy8g5omL5Yqo6Kem5Y+R5paH5pys5YiG5p6Q5ram6Imy5Yqf6IO9CiAgICBjb25zdCBtYW51YWxBbmFseXplVGV4dCA9IGFzeW5jICgpID0+IHsKICAgICAgLy8g5qOA5p+l5piv5ZCm5pyJ57yW6L6R5Zmo5YaF5a65CiAgICAgIGlmICghY29udHJhY3REZXRhaWxzLmNvbnRlbnQpIHsKICAgICAgICBFbE1lc3NhZ2Uud2FybmluZygn6K+35YWI6L6T5YWl5ZCI5ZCM5YaF5a65Jyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyDmm7TmlrDnirbmgIHvvIzmmL7npLrliqDovb0KICAgICAgcmVhbFRpbWVQb2xpc2hMb2FkaW5nLnZhbHVlID0gdHJ1ZTsKCiAgICAgIC8vIOa3u+WKoOi2heaXtuiuoeaXtuWZqAogICAgICBjb25zdCB0aW1lb3V0UHJvbWlzZSA9IG5ldyBQcm9taXNlKChfLCByZWplY3QpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlamVjdChuZXcgRXJyb3IoJ+WIhuaekOivt+axgui2heaXtu+8jOacjeWKoeWZqOWPr+iDvee5geW/mScpKSwgNjUwMDApOwogICAgICB9KTsKCiAgICAgIC8vIOaYvuekuuWKoOi9veaPkOekugogICAgICBjb25zdCBsb2FkaW5nSW5zdGFuY2UgPSBFbExvYWRpbmcuc2VydmljZSh7CiAgICAgICAgdGV4dDogJ0FJ5q2j5Zyo5YiG5p6Q5paH5pys77yM6K+356iN5YCZLi4uJywKICAgICAgICBiYWNrZ3JvdW5kOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjcpJwogICAgICB9KTsKCiAgICAgIC8vIOajgOafpeaWh+acrOmVv+W6pgogICAgICBjb25zdCBjb250ZW50ID0gY29udHJhY3REZXRhaWxzLmNvbnRlbnQ7CiAgICAgIGxhc3RBbmFseXplZENvbnRlbnQudmFsdWUgPSBjb250ZW50OwogICAgICBsYXN0QW5hbHlzaXNUaW1lLnZhbHVlID0gRGF0ZS5ub3coKTsKICAgICAgaWYgKGNvbnRlbnQubGVuZ3RoID4gMTAwMDApIHsKICAgICAgICBFbE1lc3NhZ2Uud2FybmluZygn5paH5pys6L6D6ZW/77yM5YiG5p6Q5Y+v6IO96ZyA6KaB6L6D6ZW/5pe26Ze077yM6K+36ICQ5b+D562J5b6FJyk7CiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICAvLyDmnoTlu7ror7fmsYLlj4LmlbDvvIzljIXlkKvkuKrmgKfljJbphY3nva4KICAgICAgICBjb25zdCByZXF1ZXN0UGFyYW1zID0gewogICAgICAgICAgY29udGVudDogY29udGVudCwKICAgICAgICAgIGlzX21hbnVhbDogdHJ1ZSwKICAgICAgICAgIC8vIOagh+iusOS4uuaJi+WKqOWIhuaekO+8jOehruS/neavj+asoemDvemHjeaWsOWIhuaekAogICAgICAgICAgcHJlZmVyZW5jZXM6IHsKICAgICAgICAgICAgc3R5bGU6IHBvbGlzaFByZWZlcmVuY2VzLnN0eWxlLAogICAgICAgICAgICBjb250cmFjdF90eXBlOiBwb2xpc2hQcmVmZXJlbmNlcy5jb250cmFjdFR5cGUsCiAgICAgICAgICAgIGZvY3VzOiBwb2xpc2hQcmVmZXJlbmNlcy5mb2N1cywKICAgICAgICAgICAgY3VzdG9tX3Rlcm1pbm9sb2dpZXM6IGN1c3RvbVRlcm1pbm9sb2dpZXMudmFsdWUKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGNvbnNvbGUubG9nKCLlj5HpgIHliIbmnpDor7fmsYLvvIzlj4LmlbA6IiwgSlNPTi5zdHJpbmdpZnkocmVxdWVzdFBhcmFtcywgbnVsbCwgMikpOwoKICAgICAgICAvLyDkvb/nlKhQcm9taXNlLnJhY2Xnq57kuonmlrnlvI/lpITnkIbotoXml7YKICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQcm9taXNlLnJhY2UoW2FpUG9saXNoQ29udHJhY3QoY29udHJhY3RJZC52YWx1ZSwgcmVxdWVzdFBhcmFtcyksIHRpbWVvdXRQcm9taXNlXSk7CiAgICAgICAgY29uc29sZS5sb2coIkFQSei/lOWbnue7k+aenDoiLCByZXN1bHQpOwogICAgICAgIGlmICghcmVzdWx0LmVycm9yKSB7CiAgICAgICAgICAvLyDov4fmu6TkuI7ln7rmnKzkv6Hmga/nm7jlhbPnmoTlu7rorq4KICAgICAgICAgIGNvbnN0IGZpbHRlckJhc2ljSW5mb1N1Z2dlc3Rpb25zID0gc3VnZ2VzdGlvbnMgPT4gewogICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc3VnZ2VzdGlvbnMpKSByZXR1cm4gW107CiAgICAgICAgICAgIGNvbnN0IGJhc2ljSW5mb0tleXdvcmRzID0gWyflkIjlkIzlkI3np7AnLCAn5ZCI5ZCM57yW5Y+3JywgJ+WQiOWQjOmHkeminScsICfnrb7nuqblr7nmlrknLCAn562+57qm5pel5pyfJywgJ+eUn+aViOaXpeacnycsICfliLDmnJ/ml6XmnJ8nLCAn55Sy5pa55ZCN56ewJywgJ+S5meaWueWQjeensCcsICfmoIfpopgnXTsKICAgICAgICAgICAgcmV0dXJuIHN1Z2dlc3Rpb25zLmZpbHRlcihzdWdnZXN0aW9uID0+IHsKICAgICAgICAgICAgICByZXR1cm4gIWJhc2ljSW5mb0tleXdvcmRzLnNvbWUoa2V5d29yZCA9PiBzdWdnZXN0aW9uLm9yaWdpbmFsLmluY2x1ZGVzKGtleXdvcmQpIHx8IHN1Z2dlc3Rpb24uc3VnZ2VzdGVkLmluY2x1ZGVzKGtleXdvcmQpIHx8IHN1Z2dlc3Rpb24uZXhwbGFuYXRpb24uaW5jbHVkZXMoa2V5d29yZCkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CgogICAgICAgICAgLy8g5pu05paw5bu66K6u77yM6Ieq5Yqo5pi+56S66Z2i5p2/CiAgICAgICAgICBpZiAocmVzdWx0LnN5bnRheCkgewogICAgICAgICAgICBhaVN1Z2dlc3Rpb25zLnN5bnRheCA9IGZpbHRlckJhc2ljSW5mb1N1Z2dlc3Rpb25zKHJlc3VsdC5zeW50YXgpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHJlc3VsdC50ZXJtaW5vbG9neSkgewogICAgICAgICAgICBhaVN1Z2dlc3Rpb25zLnRlcm1pbm9sb2d5ID0gZmlsdGVyQmFzaWNJbmZvU3VnZ2VzdGlvbnMocmVzdWx0LnRlcm1pbm9sb2d5KTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyDmt7vliqDllK/kuIBJRAogICAgICAgICAgYWlTdWdnZXN0aW9ucy5zeW50YXguZm9yRWFjaCgocywgaSkgPT4gewogICAgICAgICAgICBzLmlkID0gYHN5bnRheC0ke2l9YDsKICAgICAgICAgIH0pOwogICAgICAgICAgYWlTdWdnZXN0aW9ucy50ZXJtaW5vbG9neS5mb3JFYWNoKChzLCBpKSA9PiB7CiAgICAgICAgICAgIHMuaWQgPSBgdGVybS0ke2l9YDsKICAgICAgICAgIH0pOwoKICAgICAgICAgIC8vIOWmguaenOWQr+eUqOS6huWGheiBlOW7uuiuruWKn+iDve+8jOWImeW6lOeUqOWGheiBlOW7uuiurgogICAgICAgICAgaWYgKGVuYWJsZUlubGluZVN1Z2dlc3Rpb25zLnZhbHVlKSB7CiAgICAgICAgICAgIC8vIOW7tui/n+S4gOeCueW6lOeUqO+8jOehruS/nee8lui+keWZqOeKtuaAgeW3suabtOaWsAogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICBhcHBseUlubGluZVN1Z2dlc3Rpb25zKCk7CiAgICAgICAgICAgIH0sIDEwMCk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8g56Gu5L+d6Z2i5p2/5pi+56S677yI5aaC5p6c5pyJ5bu66K6u77yJCiAgICAgICAgICBjb25zdCB0b3RhbFN1Z2dlc3Rpb25zID0gYWlTdWdnZXN0aW9ucy5zeW50YXgubGVuZ3RoICsgYWlTdWdnZXN0aW9ucy50ZXJtaW5vbG9neS5sZW5ndGg7CiAgICAgICAgICBpZiAodG90YWxTdWdnZXN0aW9ucyA+IDApIHsKICAgICAgICAgICAgc2hvd0FpU3VnZ2VzdGlvbnMudmFsdWUgPSB0cnVlOwogICAgICAgICAgICAvLyDpgJrnn6XnlKjmiLfmnInmlrDnmoTlu7rorq4KICAgICAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoYEFJ5YiG5p6Q5a6M5oiQ77ya5Y+R546wJHt0b3RhbFN1Z2dlc3Rpb25zfeadoeS8mOWMluW7uuiurmApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgRWxNZXNzYWdlLmluZm8oJ0FJ5YiG5p6Q5a6M5oiQ77yM5pyq5Y+R546w6ZyA6KaB5LyY5YyW55qE5YaF5a65Jyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoICh0aW1lb3V0RXJyKSB7CiAgICAgICAgaWYgKHRpbWVvdXRFcnIubWVzc2FnZS5pbmNsdWRlcygn6LaF5pe2JykpIHsKICAgICAgICAgIEVsTWVzc2FnZUJveC5jb25maXJtKCfmnI3liqHlmajlk43lupTml7bpl7Tov4fplb/vvIzlj6/og73mmK/mlofmnKzovoPplb/miJbmnI3liqHlmajnuYHlv5njgILmgqjluIzmnJvlpoLkvZXlpITnkIbvvJ8nLCAn6K+35rGC6LaF5pe2JywgewogICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+WGjeivleS4gOasoScsCiAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICflj5bmtojmk43kvZwnLAogICAgICAgICAgICB0eXBlOiAnd2FybmluZycKICAgICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgICAvLyDnlKjmiLfpgInmi6nph43or5UKICAgICAgICAgICAgRWxNZXNzYWdlLmluZm8oJ+ato+WcqOmHjeaWsOWwneivleWIhuaekC4uLicpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICBtYW51YWxBbmFseXplVGV4dCgpOwogICAgICAgICAgICB9LCAxMDAwKTsKICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgLy8g55So5oi35Y+W5raI5pON5L2cCiAgICAgICAgICAgIEVsTWVzc2FnZS5pbmZvKCflt7Llj5bmtohBSeWIhuaekOaTjeS9nCcpOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IHRpbWVvdXRFcnI7IC8vIOmHjeaWsOaKm+WHuuWFtuS7luexu+Wei+eahOmUmeivrwogICAgICAgIH0KICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAvLyDlhbPpl63liqDovb3mj5DnpLoKICAgICAgICBpZiAobG9hZGluZ0luc3RhbmNlKSB7CiAgICAgICAgICBsb2FkaW5nSW5zdGFuY2UuY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgcmVhbFRpbWVQb2xpc2hMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgIH0KICAgIH07CgogICAgLy8g6Ieq5Yqo5pu05paw5bu66K6u5Yqf6IO977ya5b2T5ZCI5ZCM57yW6L6R5Zmo5pyJ5Y+Y5pu05LiU6ZW/6L6+M+enkuayoeacieaWsOWGheWuuei+k+WFpe+8jOWwsei/m+ihjOiHquWKqOWIhuaekOW5tuaPkOS+m+abtOaWsOW7uuiurgogICAgLy8g5L2/55So6Ziy5oqWKGRlYm91bmNlKeacuuWItuWunueOsO+8jOehruS/neWPquacieWcqOeUqOaIt+WBnOatoui+k+WFpTPnp5LlkI7miY3kvJrop6blj5HliIbmnpDvvIzpgb/lhY3popHnuYFBUEnosIPnlKgKICAgIC8vIOmYsuaKluWkhOeQhueahOaWh+acrOWPmOWMluWkhOeQhuWHveaVsCAtIOeUseS6juaUueS4uuaJi+WKqOa2puiJsu+8jOWboOatpOS4jeWGjeiHquWKqOWIhuaekAogICAgY29uc3QgZGVib3VuY2VkQW5hbHl6ZVRleHQgPSBkZWJvdW5jZSgoKSA9PiB7CiAgICAgIC8vIOatpOWkhOS4jeWGjeiHquWKqOWIhuaekO+8jOaJi+WKqOa2puiJsuaXtuS9v+eUqCBtYW51YWxBbmFseXplVGV4dCDlh73mlbAKICAgICAgY29uc29sZS5sb2coJ+WGheWuueW3suabtOaUue+8jOWPr+mAmui/h+eCueWHuyJBSea2puiJsuWIhuaekCLmjInpkq7ov5vooYzliIbmnpAnKTsKICAgIH0sIDMwMDApOwoKICAgIC8vIOiwg+aVtOe8lui+keWZqOmrmOW6puS7pemAguW6lOeql+WPo+Wkp+WwjwogICAgY29uc3QgYWRqdXN0RWRpdG9ySGVpZ2h0ID0gKCkgPT4gewogICAgICAvLyDmoLnmja7lvZPliY3mtLvliqjnmoTmoIfnrb7pobXosIPmlbTkuI3lkIzlrrnlmajnmoTpq5jluqYKICAgICAgY29uc29sZS5sb2coIuiwg+aVtOmrmOW6pu+8jOW9k+WJjeagh+etvumhtToiLCBhY3RpdmVUYWIudmFsdWUpOwoKICAgICAgLy8g6KeG5Y+j6auY5bqm5ZKM5YW25LuW6YCa55So6K6h566XCiAgICAgIGNvbnN0IHZpZXdIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7CiAgICAgIGNvbnN0IG1hcmdpbkJvdHRvbSA9IDIwOyAvLyDkuI5DU1PkuK3nmoRtYXJnaW4tYm90dG9t5LiA6Ie0CgogICAgICAvLyDlpoLmnpzmmK/lkIjlkIzmlofmnKzmoIfnrb7pobUKICAgICAgaWYgKGFjdGl2ZVRhYi52YWx1ZSA9PT0gJ2NvbnRyYWN0VGV4dCcpIHsKICAgICAgICAvLyDnoa7kv53lhYPntKDlt7LliqDovb0KICAgICAgICBpZiAoIWNvbnRyYWN0RWRpdENvbnRhaW5lci52YWx1ZSB8fCAhYWlQb2xpc2hTaWRlYmFyLnZhbHVlIHx8ICFlZGl0b3JNYWluQXJlYS52YWx1ZSkgewogICAgICAgICAgY29uc29sZS5sb2coIuaWh+acrOe8lui+keWuueWZqOacquWKoOi9ve+8jOi3s+i/h+mrmOW6puiwg+aVtCIpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g6K6h566X5Y+v55So6auY5bqmCiAgICAgICAgY29uc3QgY29udGFpbmVyUmVjdCA9IGNvbnRyYWN0RWRpdENvbnRhaW5lci52YWx1ZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICBjb25zdCB0b3BPZmZzZXQgPSBjb250YWluZXJSZWN0LnRvcDsKCiAgICAgICAgLy8g6K6h566X55CG5oOz55qE5a655Zmo6auY5bqmCiAgICAgICAgY29uc3QgY29udGFpbmVySGVpZ2h0ID0gTWF0aC5tYXgodmlld0hlaWdodCAtIHRvcE9mZnNldCAtIG1hcmdpbkJvdHRvbSwgNTAwKTsKCiAgICAgICAgLy8g5bqU55So6auY5bqm5Yiw5a655ZmoCiAgICAgICAgY29udHJhY3RFZGl0Q29udGFpbmVyLnZhbHVlLnN0eWxlLmhlaWdodCA9IGAke2NvbnRhaW5lckhlaWdodH1weGA7CgogICAgICAgIC8vIOWmguaenFF1aWxs57yW6L6R5Zmo5bey57uP5Yid5aeL5YyW77yM5Yi35paw5YW25biD5bGACiAgICAgICAgaWYgKHF1aWxsRWRpdG9yLnZhbHVlICYmIHF1aWxsRWRpdG9yLnZhbHVlLmdldFF1aWxsKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBxdWlsbCA9IHF1aWxsRWRpdG9yLnZhbHVlLmdldFF1aWxsKCk7CiAgICAgICAgICAgIGlmIChxdWlsbCkgewogICAgICAgICAgICAgIC8vIOinpuWPkVF1aWxs5biD5bGA5Yi35pawCiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBxdWlsbC51cGRhdGUoKTsKICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybignUXVpbGznvJbovpHlmajliLfmlrDlpLHotKU6JywgZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIOWmguaenOaYr+WQiOWQjOajgOafpeagh+etvumhtQogICAgICBlbHNlIGlmIChhY3RpdmVUYWIudmFsdWUgPT09ICdjb250cmFjdENoZWNrJykgewogICAgICAgIC8vIOehruS/neajgOafpeWuueWZqOW3suWKoOi9vQogICAgICAgIGlmICghY29udHJhY3RDaGVja0NvbnRhaW5lci52YWx1ZSkgewogICAgICAgICAgY29uc29sZS5sb2coIuWQiOWQjOajgOafpeWuueWZqOacquWKoOi9ve+8jOi3s+i/h+mrmOW6puiwg+aVtCIpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g6K6h566X5Y+v55So6auY5bqmCiAgICAgICAgY29uc3QgY29udGFpbmVyUmVjdCA9IGNvbnRyYWN0Q2hlY2tDb250YWluZXIudmFsdWUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgY29uc3QgdG9wT2Zmc2V0ID0gY29udGFpbmVyUmVjdC50b3A7CgogICAgICAgIC8vIOiuoeeul+WuueWZqOmrmOW6piAtIOWHj+Wwj+mhtumDqOi+uei3ne+8jOiuqeajgOafpemhtemdouabtOWkpwogICAgICAgIGNvbnN0IGNvbnRhaW5lckhlaWdodCA9IE1hdGgubWF4KHZpZXdIZWlnaHQgLSB0b3BPZmZzZXQgLSBtYXJnaW5Cb3R0b20gKyA2MCwgNjAwKTsKCiAgICAgICAgLy8g5bqU55So6auY5bqm5Yiw5qOA5p+l5a655ZmoCiAgICAgICAgY29udHJhY3RDaGVja0NvbnRhaW5lci52YWx1ZS5zdHlsZS5oZWlnaHQgPSBgJHtjb250YWluZXJIZWlnaHR9cHhgOwogICAgICAgIGNvbnNvbGUubG9nKCLlt7Lorr7nva7lkIjlkIzmo4Dmn6Xlrrnlmajpq5jluqY6IiwgY29udGFpbmVySGVpZ2h0KTsKICAgICAgfQogICAgfTsKCiAgICAvLyDmt7vliqDnqpflj6PosIPmlbTlpKflsI/kuovku7bnm5HlkKzlmagKICAgIGNvbnN0IHNldHVwUmVzaXplTGlzdGVuZXIgPSAoKSA9PiB7CiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBhZGp1c3RFZGl0b3JIZWlnaHQpOwoKICAgICAgLy8g5re75Yqg6aG16Z2i5Y+v6KeB5oCn5Y+Y5YyW55uR5ZCsCiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Zpc2liaWxpdHljaGFuZ2UnLCAoKSA9PiB7CiAgICAgICAgaWYgKGRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSA9PT0gJ3Zpc2libGUnKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygi6aG16Z2i6YeN5paw5Y+Y5Li65Y+v6KeB77yM6LCD5pW05biD5bGAIik7CiAgICAgICAgICBuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgIGFkanVzdEVkaXRvckhlaWdodCgpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CgogICAgLy8g5riF55CG56qX5Y+j6LCD5pW05aSn5bCP5LqL5Lu255uR5ZCs5ZmoCiAgICBjb25zdCBjbGVhbnVwUmVzaXplTGlzdGVuZXIgPSAoKSA9PiB7CiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCBhZGp1c3RFZGl0b3JIZWlnaHQpOwogICAgfTsKCiAgICAvLyDnm5HlkKzmoIfnrb7pobXlj5jljJbvvIzlnKjmv4DmtLvkuI3lkIzmoIfnrb7pobXml7bmiafooYznm7jlupTmk43kvZwKICAgIHdhdGNoKCgpID0+IGFjdGl2ZVRhYi52YWx1ZSwgbmV3VGFiID0+IHsKICAgICAgY29uc29sZS5sb2coIuWIh+aNouWIsOagh+etvumhtToiLCBuZXdUYWIpOwogICAgICBpZiAobmV3VGFiID09PSAnY29udHJhY3RUZXh0JykgewogICAgICAgIC8vIOWIh+aNouWIsOWQiOWQjOaWh+acrOagh+etvumhtQogICAgICAgIGNvbnNvbGUubG9nKCLlpITnkIblkIjlkIzmlofmnKzmoIfnrb7pobXliIfmjaIiKTsKCiAgICAgICAgLy8g6LCD5pW057yW6L6R5Zmo6auY5bqmCiAgICAgICAgbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgYWRqdXN0RWRpdG9ySGVpZ2h0KCk7CiAgICAgICAgICAvLyDph43mlrDorr7nva5ET03lj5jljJbnm5HlkKwKICAgICAgICAgIHNldHVwTXV0YXRpb25PYnNlcnZlcigpOwogICAgICAgIH0pOwoKICAgICAgICAvLyDlpoLmnpzlkK/nlKjkuoblhoXogZTlu7rorq7vvIzlupTnlKjkuYvliY3nmoTlu7rorq4KICAgICAgICBpZiAoZW5hYmxlSW5saW5lU3VnZ2VzdGlvbnMudmFsdWUpIHsKICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBhcHBseUlubGluZVN1Z2dlc3Rpb25zKCk7CiAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChuZXdUYWIgPT09ICdjb250cmFjdENoZWNrJykgewogICAgICAgIC8vIOWIh+aNouWIsOWQiOWQjOajgOafpeagh+etvumhtQogICAgICAgIGNvbnNvbGUubG9nKCLlpITnkIblkIjlkIzmo4Dmn6XmoIfnrb7pobXliIfmjaIiKTsKCiAgICAgICAgLy8g5ZyoRE9N5pu05paw5ZCO6LCD5pW055WM6Z2iCiAgICAgICAgbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgLy8g5qOA5p+l5ZCI5ZCM5YaF5a655piv5ZCm5bey5Yqg6L29CiAgICAgICAgICBpZiAoY29udHJhY3REZXRhaWxzLmNvbnRlbnQpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coIuWQiOWQjOWGheWuueW3suWKoOi9ve+8jOajgOafpemhtemdouWHhuWkh+Wwsee7qiIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5sb2coIuWQiOWQjOWGheWuueacquWKoOi9ve+8jOaPkOekuueUqOaIt+WFiOi+k+WFpeWGheWuuSIpOwogICAgICAgICAgICBFbE1lc3NhZ2UuaW5mbygn6K+35YWI5Zyo5ZCI5ZCM5paH5pys5qCH562+6aG16L6T5YWl5ZCI5ZCM5YaF5a6577yM54S25ZCO6L+b6KGMQUnmo4Dmn6UnKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyDosIPmlbTmo4Dmn6XnlYzpnaLpq5jluqYKICAgICAgICAgIGFkanVzdEVkaXRvckhlaWdodCgpOwoKICAgICAgICAgIC8vIOW8uuWItuWIt+aWsOa7muWKqOWuueWZqOW4g+WxgAogICAgICAgICAgaWYgKGNoZWNrUmVzdWx0QXJlYS52YWx1ZSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygi5by65Yi25Yi35paw5qOA5p+l57uT5p6c5Yy65Z+f5biD5bGAIik7CgogICAgICAgICAgICAvLyDnoa7kv51jaGVjay1yZXN1bHQtYXJlYeWuueWZqOWNoOa7oemrmOW6pgogICAgICAgICAgICBjaGVja1Jlc3VsdEFyZWEudmFsdWUuc3R5bGUuaGVpZ2h0ID0gJzEwMCUnOwoKICAgICAgICAgICAgLy8gZWwtc2Nyb2xsYmFy5bCG6Ieq5Yqo5aSE55CG5rua5Yqo77yM5LiN6ZyA6KaB6aKd5aSW6K6+572uCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCLkvb/nlKhlbC1zY3JvbGxiYXLnu4Tku7blpITnkIbmu5rliqgiKTsKCiAgICAgICAgICAgIC8vIOinpuWPkemHjee7mAogICAgICAgICAgICBjaGVja1Jlc3VsdEFyZWEudmFsdWUuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgY2hlY2tSZXN1bHRBcmVhLnZhbHVlLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICAgIH0sIDUwKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDliIfmjaLliLDlhbbku5bmoIfnrb7pobUKICAgICAgICBjb25zb2xlLmxvZygi5YiH5o2i5Yiw5YW25LuW5qCH562+6aG1OiIsIG5ld1RhYik7CgogICAgICAgIC8vIOemu+W8gOWQiOWQjOaWh+acrOagh+etvumhteaXtu+8jOehruS/nemakOiXj+mdouadvwogICAgICAgIHNob3dBaVN1Z2dlc3Rpb25zLnZhbHVlID0gZmFsc2U7CgogICAgICAgIC8vIOa4heeQhkRPTeWPmOWMluebkeWQrOWZqAogICAgICAgIGlmIChyZXNpemVPYnNlcnZlcikgewogICAgICAgICAgcmVzaXplT2JzZXJ2ZXIuZGlzY29ubmVjdCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CgogICAgLy8g6ZqQ6JePQUnlu7rorq7pnaLmnb8KICAgIGNvbnN0IGhpZGVBaVBhbmVsID0gKCkgPT4gewogICAgICAvLyDku4XpmpDol4/pnaLmnb/vvIzkv53mjIHmtqboibLlip/og73lvIDlkK8KICAgICAgc2hvd0FpU3VnZ2VzdGlvbnMudmFsdWUgPSBmYWxzZTsKICAgICAgLy8g56Gu5L+d5LiL5qyh5pi+56S65pe25LiN5piv5oqY5Y+g54q25oCBCiAgICAgIGlzQWlQYW5lbENvbGxhcHNlZC52YWx1ZSA9IGZhbHNlOwogICAgICBjb25zb2xlLmxvZygi6ZqQ6JeP6Z2i5p2/77yMc2hvd0FpU3VnZ2VzdGlvbnPorr7nva7kuLpmYWxzZSIpOwogICAgfTsKCiAgICAvLyDph4fnurNBSeW7uuiurgogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzCiAgICBjb25zdCBhZG9wdFN1Z2dlc3Rpb24gPSAodHlwZSwgaW5kZXgpID0+IHsKICAgICAgY29uc3Qgc3VnZ2VzdGlvbiA9IGFpU3VnZ2VzdGlvbnNbdHlwZV1baW5kZXhdOwogICAgICBpZiAocXVpbGxFZGl0b3IudmFsdWUgJiYgc3VnZ2VzdGlvbikgewogICAgICAgIGNvbnN0IGNvbnRlbnQgPSBjb250cmFjdERldGFpbHMuY29udGVudDsKCiAgICAgICAgLy8g5LyY5YyW5paH5pys5Yy56YWN566X5rOVCiAgICAgICAgdHJ5IHsKICAgICAgICAgIC8vIOatpemqpDE6IOWwneivleebtOaOpeWMuemFjQogICAgICAgICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoc3VnZ2VzdGlvbi5vcmlnaW5hbCkpIHsKICAgICAgICAgICAgY29udHJhY3REZXRhaWxzLmNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2Uoc3VnZ2VzdGlvbi5vcmlnaW5hbCwgc3VnZ2VzdGlvbi5zdWdnZXN0ZWQpOwogICAgICAgICAgICBhaVN1Z2dlc3Rpb25zW3R5cGVdLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCflt7Lph4fnurPlu7rorq4nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOatpemqpDI6IOWwneivleS4jeWMuuWIhuWkp+Wwj+WGmeWMuemFjQogICAgICAgICAgY29uc3QgbG93ZXJDb250ZW50ID0gY29udGVudC50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgY29uc3QgbG93ZXJPcmlnaW5hbCA9IHN1Z2dlc3Rpb24ub3JpZ2luYWwudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIGlmIChsb3dlckNvbnRlbnQuaW5jbHVkZXMobG93ZXJPcmlnaW5hbCkpIHsKICAgICAgICAgICAgLy8g5om+5Yiw5a6e6ZmF5L2N572uCiAgICAgICAgICAgIGNvbnN0IHN0YXJ0SW5kZXggPSBsb3dlckNvbnRlbnQuaW5kZXhPZihsb3dlck9yaWdpbmFsKTsKICAgICAgICAgICAgY29uc3QgYWN0dWFsT3JpZ2luYWxUZXh0ID0gY29udGVudC5zdWJzdHJpbmcoc3RhcnRJbmRleCwgc3RhcnRJbmRleCArIHN1Z2dlc3Rpb24ub3JpZ2luYWwubGVuZ3RoKTsKICAgICAgICAgICAgY29udHJhY3REZXRhaWxzLmNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoYWN0dWFsT3JpZ2luYWxUZXh0LCBzdWdnZXN0aW9uLnN1Z2dlc3RlZCk7CiAgICAgICAgICAgIGFpU3VnZ2VzdGlvbnNbdHlwZV0uc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+W3sumHh+e6s+W7uuiuricpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgLy8g5q2l6aqkMzog5bCd6K+V56e76ZmkSFRNTOagh+etvuWQjuWMuemFjQogICAgICAgICAgY29uc3QgdGVtcERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgdGVtcERpdi5pbm5lckhUTUwgPSBjb250ZW50OwogICAgICAgICAgY29uc3QgcGxhaW5UZXh0ID0gdGVtcERpdi50ZXh0Q29udGVudCB8fCB0ZW1wRGl2LmlubmVyVGV4dCB8fCAnJzsKICAgICAgICAgIGlmIChwbGFpblRleHQuaW5jbHVkZXMoc3VnZ2VzdGlvbi5vcmlnaW5hbCkpIHsKICAgICAgICAgICAgLy8g55So5q2j5YiZ6KGo6L6+5byP5Yib5bu65LiA5Liq5a6J5YWo55qE5pCc57Si5qih5byPCiAgICAgICAgICAgIGNvbnN0IGVzY2FwZWRPcmlnaW5hbCA9IHN1Z2dlc3Rpb24ub3JpZ2luYWwucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xdXFxdL2csICdcXCQmJyk7CiAgICAgICAgICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgKCR7ZXNjYXBlZE9yaWdpbmFsfSlgLCAnaScpOwoKICAgICAgICAgICAgLy8g5ZyoSFRNTOWGheWuueS4reafpeaJvuWSjOabv+aNogogICAgICAgICAgICBjb250cmFjdERldGFpbHMuY29udGVudCA9IGNvbnRlbnQucmVwbGFjZShyZWdleCwgc3VnZ2VzdGlvbi5zdWdnZXN0ZWQpOwogICAgICAgICAgICBhaVN1Z2dlc3Rpb25zW3R5cGVdLnNwbGljZShpbmRleCwgMSk7CiAgICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCflt7Lph4fnurPlu7rorq4gKOmAmui/h+aWh+acrOWGheWuueWMuemFjSknKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOatpemqpDQ6IOWwneivleaooeeziuWMuemFjSAtIOenu+mZpOWkmuS9meepuuagvOWSjOagh+eCueWQjuavlOi+gwogICAgICAgICAgY29uc3Qgbm9ybWFsaXplVGV4dCA9IHRleHQgPT4gewogICAgICAgICAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9ccysvZywgJyAnKSAvLyDlpJrkuKrnqbrmoLzmm7/mjaLkuLrljZXkuKoKICAgICAgICAgICAgLnJlcGxhY2UoL1suLDs6IT/vvIzjgILvvJvvvJrvvIHvvJ9dL2csICcnKSAvLyDnp7vpmaTmoIfngrkKICAgICAgICAgICAgLnRyaW0oKS50b0xvd2VyQ2FzZSgpOyAvLyDovazlsI/lhpnlubbnp7vpmaTpppblsL7nqbrmoLwKICAgICAgICAgIH07CiAgICAgICAgICBjb25zdCBub3JtYWxpemVkQ29udGVudCA9IG5vcm1hbGl6ZVRleHQocGxhaW5UZXh0KTsKICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRPcmlnaW5hbCA9IG5vcm1hbGl6ZVRleHQoc3VnZ2VzdGlvbi5vcmlnaW5hbCk7CiAgICAgICAgICBpZiAobm9ybWFsaXplZENvbnRlbnQuaW5jbHVkZXMobm9ybWFsaXplZE9yaWdpbmFsKSkgewogICAgICAgICAgICAvLyDov5nph4zmiJHku6zliJvlu7rkuIDkuKrmm7Tlrr3mnb7nmoTmraPliJnooajovr7lvI/nlKjkuo7mm7/mjaIKICAgICAgICAgICAgY29uc3QgcGF0dGVybiA9IG5vcm1hbGl6ZWRPcmlnaW5hbC5zcGxpdCgvXHMrLykuam9pbignXFxzKycpOwogICAgICAgICAgICBjb25zdCBsb29zZVJlZ2V4ID0gbmV3IFJlZ0V4cChwYXR0ZXJuLCAnaScpOwoKICAgICAgICAgICAgLy8g5Zyo5Y6f5aeLSFRNTOS4reaJp+ihjOabv+aNogogICAgICAgICAgICBjb250cmFjdERldGFpbHMuY29udGVudCA9IGNvbnRlbnQucmVwbGFjZShsb29zZVJlZ2V4LCBzdWdnZXN0aW9uLnN1Z2dlc3RlZCk7CiAgICAgICAgICAgIGFpU3VnZ2VzdGlvbnNbdHlwZV0uc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+W3sumHh+e6s+W7uuiuriAo6YCa6L+H5qih57OK5Yy56YWNKScpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgLy8g5aaC5p6c5omA5pyJ5Yy56YWN5pa55rOV6YO95aSx6LSlCiAgICAgICAgICBFbE1lc3NhZ2Uud2FybmluZygn5peg5rOV5om+5Yiw5Yy56YWN55qE5paH5pys77yM5bu66K6u5omL5Yqo5L+u5pS5Jyk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+mHh+e6s+W7uuiuruWHuumUmTonLCBlcnJvcik7CiAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+mHh+e6s+W7uuiurui/h+eoi+S4reWPkeeUn+mUmeivr++8jOivt+aJi+WKqOS/ruaUuScpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICAvLyDlv73nlaVBSeW7uuiurgogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzCiAgICBjb25zdCBpZ25vcmVTdWdnZXN0aW9uID0gKHR5cGUsIGluZGV4KSA9PiB7CiAgICAgIGFpU3VnZ2VzdGlvbnNbdHlwZV0uc3BsaWNlKGluZGV4LCAxKTsKICAgICAgRWxNZXNzYWdlLmluZm8oJ+W3suW/veeVpeW7uuiuricpOwogICAgfTsKCiAgICAvLyDlupTnlKjmiYDmnInph4fnurPnmoTlu7rorq4KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFycwogICAgY29uc3QgYXBwbHlBbGxTdWdnZXN0aW9ucyA9IGFzeW5jICgpID0+IHsKICAgICAgbGV0IGhhc0NoYW5nZXMgPSBmYWxzZTsKCiAgICAgIC8vIOajgOafpeaYr+WQpuacieimgeW6lOeUqOeahOW7uuiurgogICAgICBpZiAoYWlTdWdnZXN0aW9ucy5zeW50YXgubGVuZ3RoID09PSAwICYmIGFpU3VnZ2VzdGlvbnMudGVybWlub2xvZ3kubGVuZ3RoID09PSAwKSB7CiAgICAgICAgRWxNZXNzYWdlLmluZm8oJ+ayoeacieW+heWkhOeQhueahOW7uuiuricpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGNvbnN0IGxvYWRpbmcgPSBFbExvYWRpbmcuc2VydmljZSh7CiAgICAgICAgICBsb2NrOiB0cnVlLAogICAgICAgICAgdGV4dDogJ+W6lOeUqOaJgOacieW7uuiuri4uLicsCiAgICAgICAgICBiYWNrZ3JvdW5kOiAncmdiYSgwLCAwLCAwLCAwLjcpJwogICAgICAgIH0pOwoKICAgICAgICAvLyDliJvlu7rkuIDkuKrmmbrog73ljLnphY3lkozmm7/mjaLlh73mlbAKICAgICAgICBjb25zdCBzbWFydFJlcGxhY2UgPSAoY29udGVudCwgb3JpZ2luYWwsIHN1Z2dlc3RlZCkgPT4gewogICAgICAgICAgLy8g5bCd6K+V5aSa56eN5Yy56YWN562W55WlCgogICAgICAgICAgLy8g562W55WlMTog55u05o6l5Yy56YWNCiAgICAgICAgICBpZiAoY29udGVudC5pbmNsdWRlcyhvcmlnaW5hbCkpIHsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBuZXdDb250ZW50OiBjb250ZW50LnJlcGxhY2Uob3JpZ2luYWwsIHN1Z2dlc3RlZCksCiAgICAgICAgICAgICAgbWF0Y2hlZDogdHJ1ZQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOetlueVpTI6IOS4jeWMuuWIhuWkp+Wwj+WGmeWMuemFjQogICAgICAgICAgY29uc3QgbG93ZXJDb250ZW50ID0gY29udGVudC50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgY29uc3QgbG93ZXJPcmlnaW5hbCA9IG9yaWdpbmFsLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICBpZiAobG93ZXJDb250ZW50LmluY2x1ZGVzKGxvd2VyT3JpZ2luYWwpKSB7CiAgICAgICAgICAgIC8vIOaJvuWIsOWunumZheS9jee9rgogICAgICAgICAgICBjb25zdCBzdGFydEluZGV4ID0gbG93ZXJDb250ZW50LmluZGV4T2YobG93ZXJPcmlnaW5hbCk7CiAgICAgICAgICAgIGNvbnN0IGFjdHVhbE9yaWdpbmFsVGV4dCA9IGNvbnRlbnQuc3Vic3RyaW5nKHN0YXJ0SW5kZXgsIHN0YXJ0SW5kZXggKyBvcmlnaW5hbC5sZW5ndGgpOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG5ld0NvbnRlbnQ6IGNvbnRlbnQucmVwbGFjZShhY3R1YWxPcmlnaW5hbFRleHQsIHN1Z2dlc3RlZCksCiAgICAgICAgICAgICAgbWF0Y2hlZDogdHJ1ZQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOetlueVpTM6IOenu+mZpEhUTUzmoIfnrb7lkI7ljLnphY0KICAgICAgICAgIGNvbnN0IHRlbXBEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgIHRlbXBEaXYuaW5uZXJIVE1MID0gY29udGVudDsKICAgICAgICAgIGNvbnN0IHBsYWluVGV4dCA9IHRlbXBEaXYudGV4dENvbnRlbnQgfHwgdGVtcERpdi5pbm5lclRleHQgfHwgJyc7CiAgICAgICAgICBpZiAocGxhaW5UZXh0LmluY2x1ZGVzKG9yaWdpbmFsKSkgewogICAgICAgICAgICAvLyDnlKjmraPliJnooajovr7lvI/liJvlu7rkuIDkuKrlronlhajnmoTmkJzntKLmqKHlvI8KICAgICAgICAgICAgY29uc3QgZXNjYXBlZE9yaWdpbmFsID0gb3JpZ2luYWwucmVwbGFjZSgvWy4qKz9eJHt9KCl8W1xdXFxdL2csICdcXCQmJyk7CiAgICAgICAgICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgKCR7ZXNjYXBlZE9yaWdpbmFsfSlgLCAnaScpOwoKICAgICAgICAgICAgLy8g5ZyoSFRNTOWGheWuueS4reafpeaJvuWSjOabv+aNogogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG5ld0NvbnRlbnQ6IGNvbnRlbnQucmVwbGFjZShyZWdleCwgc3VnZ2VzdGVkKSwKICAgICAgICAgICAgICBtYXRjaGVkOiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgLy8g562W55WlNDog5qih57OK5Yy56YWNIC0g56e76Zmk5aSa5L2Z56m65qC85ZKM5qCH54K55ZCO5q+U6L6DCiAgICAgICAgICBjb25zdCBub3JtYWxpemVUZXh0ID0gdGV4dCA9PiB7CiAgICAgICAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoL1xzKy9nLCAnICcpLnJlcGxhY2UoL1suLDs6IT/vvIzjgILvvJvvvJrvvIHvvJ9dL2csICcnKS50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIH07CiAgICAgICAgICBjb25zdCBub3JtYWxpemVkQ29udGVudCA9IG5vcm1hbGl6ZVRleHQocGxhaW5UZXh0KTsKICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRPcmlnaW5hbCA9IG5vcm1hbGl6ZVRleHQob3JpZ2luYWwpOwogICAgICAgICAgaWYgKG5vcm1hbGl6ZWRDb250ZW50LmluY2x1ZGVzKG5vcm1hbGl6ZWRPcmlnaW5hbCkpIHsKICAgICAgICAgICAgLy8g5Yib5bu65pu05a695p2+55qE5q2j5YiZ6KGo6L6+5byPCiAgICAgICAgICAgIGNvbnN0IHBhdHRlcm4gPSBub3JtYWxpemVkT3JpZ2luYWwuc3BsaXQoL1xzKy8pLmpvaW4oJ1xccysnKTsKICAgICAgICAgICAgY29uc3QgbG9vc2VSZWdleCA9IG5ldyBSZWdFeHAocGF0dGVybiwgJ2knKTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBuZXdDb250ZW50OiBjb250ZW50LnJlcGxhY2UobG9vc2VSZWdleCwgc3VnZ2VzdGVkKSwKICAgICAgICAgICAgICBtYXRjaGVkOiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgLy8g5omA5pyJ562W55Wl6YO95aSx6LSl77yM6L+U5Zue5Y6f5aeL5YaF5a65CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBuZXdDb250ZW50OiBjb250ZW50LAogICAgICAgICAgICBtYXRjaGVkOiBmYWxzZQogICAgICAgICAgfTsKICAgICAgICB9OwoKICAgICAgICAvLyDlupTnlKjmiYDmnInlu7rorq4KICAgICAgICBsZXQgc3VjY2Vzc0NvdW50ID0gMDsKICAgICAgICBsZXQgZmFpbENvdW50ID0gMDsKICAgICAgICBsZXQgY29udGVudCA9IGNvbnRyYWN0RGV0YWlscy5jb250ZW50OwogICAgICAgIGNvbnN0IGFsbFN1Z2dlc3Rpb25zID0gWy4uLmFpU3VnZ2VzdGlvbnMuc3ludGF4LCAuLi5haVN1Z2dlc3Rpb25zLnRlcm1pbm9sb2d5XTsKICAgICAgICBmb3IgKGNvbnN0IHN1Z2dlc3Rpb24gb2YgYWxsU3VnZ2VzdGlvbnMpIHsKICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHNtYXJ0UmVwbGFjZShjb250ZW50LCBzdWdnZXN0aW9uLm9yaWdpbmFsLCBzdWdnZXN0aW9uLnN1Z2dlc3RlZCk7CiAgICAgICAgICBpZiAocmVzdWx0Lm1hdGNoZWQpIHsKICAgICAgICAgICAgY29udGVudCA9IHJlc3VsdC5uZXdDb250ZW50OwogICAgICAgICAgICBoYXNDaGFuZ2VzID0gdHJ1ZTsKICAgICAgICAgICAgc3VjY2Vzc0NvdW50Kys7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmYWlsQ291bnQrKzsKICAgICAgICAgICAgY29uc29sZS53YXJuKCfml6Dms5XljLnphY3lu7rorq46Jywgc3VnZ2VzdGlvbi5vcmlnaW5hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyDlpoLmnpzmnInmm7TmlrDvvIzliJnmm7TmlrDlhoXlrrkKICAgICAgICBpZiAoaGFzQ2hhbmdlcykgewogICAgICAgICAgY29udHJhY3REZXRhaWxzLmNvbnRlbnQgPSBjb250ZW50OwoKICAgICAgICAgIC8vIOa4heepuuW7uuiuruaVsOe7hAogICAgICAgICAgYWlTdWdnZXN0aW9ucy5zeW50YXggPSBbXTsKICAgICAgICAgIGFpU3VnZ2VzdGlvbnMudGVybWlub2xvZ3kgPSBbXTsKCiAgICAgICAgICAvLyDkv53lrZjmm7TmlLkKICAgICAgICAgIGF3YWl0IHNhdmVDaGFuZ2VzKCk7CiAgICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcyhg5oiQ5Yqf5bqU55SoJHtzdWNjZXNzQ291bnR96aG55bu66K6u77yMJHtmYWlsQ291bnR96aG55pyq6IO95Yy56YWNYCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfmnKrog73ljLnphY3ku7vkvZXlu7rorq7vvIzlhoXlrrnmnKrlj5jmm7QnKTsKICAgICAgICB9CiAgICAgICAgbG9hZGluZy5jbG9zZSgpOwogICAgICAgIGhpZGVBaVBhbmVsKCk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5bqU55So5bu66K6u5aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+W6lOeUqOW7uuiuruWksei0pTogJyArIChlcnJvci5tZXNzYWdlIHx8ICfmnKrnn6XplJnor68nKSk7CiAgICAgIH0KICAgIH07CgogICAgLy8g5LiL6L295ZCI5ZCMCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnMKICAgIGNvbnN0IGRvd25sb2FkQ29udHJhY3QgPSAoKSA9PiB7CiAgICAgIC8vIOWFiOS/neWtmOWQiOWQjAogICAgICBpc1NhdmluZy52YWx1ZSA9IHRydWU7CiAgICAgIGNvbnN0IGxvYWRpbmcgPSBFbExvYWRpbmcuc2VydmljZSh7CiAgICAgICAgbG9jazogdHJ1ZSwKICAgICAgICB0ZXh0OiAn5q2j5Zyo5L+d5a2Y5bm255Sf5oiQV29yZOaWh+ahoy4uLicsCiAgICAgICAgYmFja2dyb3VuZDogJ3JnYmEoMCwgMCwgMCwgMC43KScKICAgICAgfSk7CgogICAgICAvLyDlh4blpIfmm7TmlrDmlbDmja4KICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHsKICAgICAgICB0aXRsZTogY29udHJhY3REZXRhaWxzLnRpdGxlLAogICAgICAgIHR5cGU6IGNvbnRyYWN0RGV0YWlscy50eXBlLAogICAgICAgIGFtb3VudDogY29udHJhY3REZXRhaWxzLmFtb3VudC5yZXBsYWNlKC9bXlxkLl0vZywgJycpLAogICAgICAgIGNvbXBhbnk6IGNvbnRyYWN0RGV0YWlscy5jb21wYW55LAogICAgICAgIHNpZ25fZGF0ZTogY29udHJhY3REZXRhaWxzLnNpZ25EYXRlLAogICAgICAgIHN0YXJ0X2RhdGU6IGNvbnRyYWN0RGV0YWlscy5zdGFydERhdGUsCiAgICAgICAgZXhwaXJlX2RhdGU6IGNvbnRyYWN0RGV0YWlscy5leHBpcmVEYXRlLAogICAgICAgIGNvbnRlbnQ6IGNvbnRyYWN0RGV0YWlscy5jb250ZW50CiAgICAgIH07CgogICAgICAvLyDlhYjkv53lrZjmm7TmlrAKICAgICAgdXBkYXRlQ29udHJhY3QoY29udHJhY3RJZC52YWx1ZSwgdXBkYXRlRGF0YSkudGhlbigoKSA9PiB7CiAgICAgICAgLy8g5L+d5a2Y5oiQ5Yqf5ZCO6LCD55So5LiL6L29QVBJCiAgICAgICAgY29uc3QgZG93bmxvYWRVcmwgPSBgL2FwaS9jb250cmFjdC9jb250cmFjdHMvJHtjb250cmFjdElkLnZhbHVlfS9kb3dubG9hZC1kb2N4L2A7CgogICAgICAgIC8vIOiOt+WPlkNTUkbku6TniYwgLSDku45Db29raWXkuK3ojrflj5YKICAgICAgICBjb25zdCBnZXRDb29raWUgPSBuYW1lID0+IHsKICAgICAgICAgIGNvbnN0IHZhbHVlID0gYDsgJHtkb2N1bWVudC5jb29raWV9YDsKICAgICAgICAgIGNvbnN0IHBhcnRzID0gdmFsdWUuc3BsaXQoYDsgJHtuYW1lfT1gKTsKICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHJldHVybiBwYXJ0cy5wb3AoKS5zcGxpdCgnOycpLnNoaWZ0KCk7CiAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgfTsKICAgICAgICBjb25zdCBjc3JmVG9rZW4gPSBnZXRDb29raWUoJ2NzcmZ0b2tlbicpOwogICAgICAgIGNvbnNvbGUubG9nKCdDU1JG5Luk54mMOicsIGNzcmZUb2tlbiB8fCAn5pyq5om+5YiwJyk7CiAgICAgICAgY29uc29sZS5sb2coJ+iupOivgUNvb2tpZTonLCBkb2N1bWVudC5jb29raWUpOwoKICAgICAgICAvLyDojrflj5borqTor4Hku6TniYwKICAgICAgICBjb25zdCB0b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpOwogICAgICAgIGNvbnNvbGUubG9nKCforqTor4Hku6TniYw6JywgdG9rZW4gPyAn5om+5YiwJyA6ICfmnKrmib7liLAnKTsKCiAgICAgICAgLy8g5L2/55SoYXhpb3Pnm7TmjqXkuIvovb3mlofku7bvvIznoa7kv53ljIXlkKvorqTor4Hkv6Hmga8KICAgICAgICByZXF1ZXN0KHsKICAgICAgICAgIHVybDogZG93bmxvYWRVcmwsCiAgICAgICAgICBtZXRob2Q6ICdHRVQnLAogICAgICAgICAgcmVzcG9uc2VUeXBlOiAnYmxvYicsCiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICdYLUNTUkZUb2tlbic6IGNzcmZUb2tlbiwKICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiB0b2tlbiA/IGBCZWFyZXIgJHt0b2tlbn1gIDogJycKICAgICAgICAgIH0KICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgIC8vIOWIm+W7ukJsb2IgVVJM5bm25LiL6L29CiAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW3Jlc3BvbnNlLmRhdGFdLCB7CiAgICAgICAgICAgIHR5cGU6IHJlc3BvbnNlLmhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddIHx8ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudCcKICAgICAgICAgIH0pOwogICAgICAgICAgY29uc3QgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgbGluay5ocmVmID0gdXJsOwogICAgICAgICAgbGluay5kb3dubG9hZCA9IGAke2NvbnRyYWN0RGV0YWlscy5udW1iZXIgfHwgJ+WQiOWQjCd9XyR7Y29udHJhY3REZXRhaWxzLnRpdGxlIHx8ICfmnKrlkb3lkI0nfS5kb2N4YDsKICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7CiAgICAgICAgICBsaW5rLmNsaWNrKCk7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspOwogICAgICAgICAgd2luZG93LlVSTC5yZXZva2VPYmplY3RVUkwodXJsKTsKICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCflkIjlkIzlt7Lkv53lrZjlubbkuIvovb0nKTsKICAgICAgICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfkuIvovb3lkIjlkIzlh7rplJk6JywgZXJyb3IpOwogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKGDkuIvovb3lpLHotKU6ICR7ZXJyb3IubWVzc2FnZSB8fCAn5p2D6ZmQ6aqM6K+B5aSx6LSlJ31gKTsKICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+S/neWtmOWQiOWQjOWHuumUmTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfkv53lrZjlpLHotKXvvIzml6Dms5XkuIvovb3lkIjlkIwnKTsKICAgICAgfSkuZmluYWxseSgoKSA9PiB7CiAgICAgICAgbG9hZGluZy5jbG9zZSgpOwogICAgICAgIGlzU2F2aW5nLnZhbHVlID0gZmFsc2U7CiAgICAgIH0pOwogICAgfTsKCiAgICAvLyDmn6XnnIvms5Xop4Tor6bmg4UKICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFycwogICAgY29uc3Qgdmlld1JlZ3VsYXRpb24gPSBpc3N1ZSA9PiB7CiAgICAgIC8vIOS9v+eUqOWFqOWxj+WKoOi9veWKqOeUuwogICAgICBjb25zdCBsb2FkaW5nSW5zdGFuY2UgPSBFbExvYWRpbmcuc2VydmljZSh7CiAgICAgICAgdGV4dDogJ+ato+WcqOafpeivouebuOWFs+azleinhC4uLicsCiAgICAgICAgYmFja2dyb3VuZDogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC43KScKICAgICAgfSk7CgogICAgICAvLyDkvb/nlKhyZXF1ZXN05qih5Z2X6LCD55So5ZCO56uvQVBJ6I635Y+W5rOV6KeE6K+m5oOFCiAgICAgIHJlcXVlc3QoewogICAgICAgIHVybDogJy9hcGkvY29udHJhY3QvcmVndWxhdGlvbnMvcXVlcnkvJywKICAgICAgICBtZXRob2Q6ICdwb3N0JywKICAgICAgICBkYXRhOiB7CiAgICAgICAgICBpc3N1ZV90aXRsZTogaXNzdWUudGl0bGUsCiAgICAgICAgICBpc3N1ZV9jb250ZW50OiBpc3N1ZS5jdXJyZW50LAogICAgICAgICAgaXNzdWVfcHJvYmxlbTogaXNzdWUucHJvYmxlbSwKICAgICAgICAgIGNvbnRyYWN0X3R5cGU6IGNvbnRyYWN0RGV0YWlscy50eXBlCiAgICAgICAgfQogICAgICB9KS50aGVuKGRhdGEgPT4gewogICAgICAgIGxvYWRpbmdJbnN0YW5jZS5jbG9zZSgpOwoKICAgICAgICAvLyDlsZXnpLpBSeeUn+aIkOeahOazleinhOivpuaDhQogICAgICAgIEVsTWVzc2FnZUJveC5hbGVydChgPGRpdiBjbGFzcz0icmVndWxhdGlvbi1kZXRhaWwiPgogICAgICAgICAgICA8aDQ+6YCC55So5rOV6KeEOiAke2RhdGEucmVndWxhdGlvbiB8fCAn44CK5Lit5Y2O5Lq65rCR5YWx5ZKM5Zu95ZCI5ZCM5rOV44CLJ308L2g0PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJyZWd1bGF0aW9uLWNvbnRlbnQiPgogICAgICAgICAgICAgIDxwPiR7ZGF0YS5yZWd1bGF0aW9uX2NvbnRlbnQgfHwgJ+agueaNruebuOWFs+azleW+i+azleinhO+8jOWQiOWQjOS4reW6lOaYjuehrue6puWumuWPjOaWueadg+WIqeS5ieWKoe+8jOmBv+WFjeWQq+eziuS4jea4heeahOadoeasvuOAgid9PC9wPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0icmVndWxhdGlvbi1zdWdnZXN0aW9uIG10LTIiPgogICAgICAgICAgICAgIDxoNT7kv67mlLnlu7rorq46PC9oNT4KICAgICAgICAgICAgICA8cD4ke2RhdGEuc3VnZ2VzdGlvbiB8fCAn5bu66K6u5Y+C54Wn55u45YWz5rOV5b6L5rOV6KeE77yM5piO56Gu6KGo6L+w5ZCI5ZCM5p2h5qy+77yM56Gu5L+d5ZCI5ZCM55qE5pyJ5pWI5oCn5ZKM5Y+v5omn6KGM5oCn44CCJ308L3A+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+YCwgJ+azleinhOivpuaDhScsIHsKICAgICAgICAgIGRhbmdlcm91c2x5VXNlSFRNTFN0cmluZzogdHJ1ZSwKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn5LqG6KejJywKICAgICAgICAgIGN1c3RvbUNsYXNzOiAncmVndWxhdGlvbi1kaWFsb2cnCiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICBsb2FkaW5nSW5zdGFuY2UuY2xvc2UoKTsKICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bms5Xop4Tor6bmg4XlpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign6I635Y+W5rOV6KeE6K+m5oOF5aSx6LSl77yM6K+356iN5ZCO5YaN6K+VJyk7CiAgICAgIH0pOwogICAgfTsKCiAgICAvLyDnm5HlkKzot6/nlLHlj5jljJYKICAgIHdhdGNoKCgpID0+IHJvdXRlLm5hbWUsIChuZXdSb3V0ZU5hbWUsIG9sZFJvdXRlTmFtZSkgPT4gewogICAgICBpZiAob2xkUm91dGVOYW1lID09PSAnQ29udHJhY3REZXRhaWwnICYmIG5ld1JvdXRlTmFtZSAhPT0gJ0NvbnRyYWN0RGV0YWlsJykgewogICAgICAgIC8vIOemu+W8gOWQiOWQjOivpuaDhemhtemdou+8jOehruS/nemHjee9rueKtuaAgQogICAgICAgIGNvbnNvbGUubG9nKCfnprvlvIDlkIjlkIzor6bmg4XpobXpnaLvvIzph43nva7nirbmgIEnKTsKICAgICAgICBjb250cmFjdElkLnZhbHVlID0gbnVsbDsKICAgICAgICAvLyDlhbPpl63miYDmnInliqDovb3nirbmgIEKICAgICAgICBpc0xvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICBpc1NhdmluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgIHJlYWxUaW1lUG9saXNoTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgIGlzQ2hlY2tpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgfQogICAgfSwgewogICAgICBpbW1lZGlhdGU6IHRydWUKICAgIH0pOwoKICAgIC8vIOebkeWQrOi3r+eUseWPmOWMlu+8jOmHjeaWsOWKoOi9veaVsOaNrgogICAgd2F0Y2goKCkgPT4gcm91dGUucGFyYW1zLmlkLCAobmV3SWQsIG9sZElkKSA9PiB7CiAgICAgIGlmIChyb3V0ZS5uYW1lID09PSAnQ29udHJhY3REZXRhaWwnKSB7CiAgICAgICAgaWYgKG5ld0lkICYmIG5ld0lkICE9PSAndW5kZWZpbmVkJyAmJiAhaXNOYU4oTnVtYmVyKG5ld0lkKSkpIHsKICAgICAgICAgIC8vIOi9rOaNouS4uuaVsOWtl+i/m+ihjOavlOi+gwogICAgICAgICAgY29uc3QgbnVtTmV3SWQgPSBOdW1iZXIobmV3SWQpOwogICAgICAgICAgY29uc3QgbnVtT2xkSWQgPSBvbGRJZCA/IE51bWJlcihvbGRJZCkgOiBudWxsOwoKICAgICAgICAgIC8vIOWPquaciUlE55yf5q2j5Y+Y5YyW5pe25omN6YeN5paw5Yqg6L29CiAgICAgICAgICBpZiAobnVtTmV3SWQgIT09IG51bU9sZElkKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCflkIjlkIxJROW3suWPmOabtO+8jOWKoOi9veaWsOWQiOWQjCcsIG5ld0lkKTsKICAgICAgICAgICAgY29udHJhY3RJZC52YWx1ZSA9IG51bU5ld0lkOwoKICAgICAgICAgICAgLy8g5aaC5p6c5piv57uE5Lu25Yia5Yia5oyC6L2977yM5L2/55So6Z2Z6buY5Yqg6L296YG/5YWN6YeN5aSN5o+Q56S6CiAgICAgICAgICAgIGNvbnN0IHNpbGVudExvYWQgPSAhb2xkSWQgfHwgZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gJ2NvbXBsZXRlJzsKICAgICAgICAgICAgZ2V0Q29udHJhY3REZXRhaWxzKHNpbGVudExvYWQpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmxvZygn5peg5pWI55qE5ZCI5ZCMSUTlj4LmlbA6JywgbmV3SWQpOwogICAgICAgICAgcm91dGVyLnB1c2goewogICAgICAgICAgICBuYW1lOiAnQ29udHJhY3QnCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIHsKICAgICAgaW1tZWRpYXRlOiB0cnVlCiAgICB9KTsKCiAgICAvLyDmt7vliqDlsZXlvIDmjInpkq7liLBET00KICAgIGNvbnN0IGFkZEZsb2F0aW5nQnV0dG9uID0gKCkgPT4gewogICAgICAvLyDlpoLmnpzmjInpkq7lt7LlrZjlnKjvvIzlhYjnp7vpmaQKICAgICAgY29uc3QgZXhpc3RpbmdCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWlGbG9hdGluZ0J1dHRvbicpOwogICAgICBpZiAoZXhpc3RpbmdCdXR0b24pIHsKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGV4aXN0aW5nQnV0dG9uKTsKICAgICAgfQoKICAgICAgLy8g5Yib5bu65paw5oyJ6ZKuCiAgICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBidXR0b24uaWQgPSAnYWlGbG9hdGluZ0J1dHRvbic7CiAgICAgIGJ1dHRvbi5jbGFzc05hbWUgPSAnYWktZmxvYXRpbmctYnV0dG9uJzsKICAgICAgYnV0dG9uLmlubmVySFRNTCA9IGAKICAgICAgICA8YnV0dG9uIGNsYXNzPSJlbC1idXR0b24gZWwtYnV0dG9uLS1wcmltYXJ5IGVsLWJ1dHRvbi0tc21hbGwgaXMtY2lyY2xlIj4KICAgICAgICAgIDxpIGNsYXNzPSJlbC1pY29uIj4KICAgICAgICAgICAgPHN2ZyB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgICAgICAgIDxwYXRoIGZpbGw9ImN1cnJlbnRDb2xvciIgZD0iTTUxMiA2NGE0NDggNDQ4IDAgMSAxIDAgODk2IDQ0OCA0NDggMCAwIDEgMC04OTZ6bTAgODMyYTM4NCAzODQgMCAwIDAgMC03NjggMzg0IDM4NCAwIDAgMCAwIDc2OHptLTk0LjY1Ni0yOTguNjU2YTMyIDMyIDAKICAgICAgICAgICAgICAgIDAgMCA0NS4zMTIgNDUuMzEybDk2LTk2YTMyIDMyIDAgMCAwIDAtNDUuMzEybC05Ni05NmEzMiAzMiAwIDAgMC00NS4zMTIgNDUuMzEyTDQ2Ni43NTIgNTEybC00OS40MDggNDkuMzQ0eiI+PC9wYXRoPgogICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgIDwvaT4KICAgICAgICA8L2J1dHRvbj4KICAgICAgYDsKCiAgICAgIC8vIOa3u+WKoOagt+W8jwogICAgICBjb25zdCBzdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N0eWxlJyk7CiAgICAgIHN0eWxlLnRleHRDb250ZW50ID0gYAogICAgICAgIC5haS1mbG9hdGluZy1idXR0b24gewogICAgICAgICAgcG9zaXRpb246IGZpeGVkOwogICAgICAgICAgdG9wOiA1MCU7CiAgICAgICAgICByaWdodDogMDsKICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKTsKICAgICAgICAgIHotaW5kZXg6IDIwMDA7CiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOwogICAgICAgICAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogNTAlOwogICAgICAgICAgYm9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czogNTAlOwogICAgICAgICAgYm94LXNoYWRvdzogLTJweCAwIDEwcHggcmdiYSgwLDAsMCwwLjEpOwogICAgICAgICAgcGFkZGluZzogMTBweCA1cHggMTBweCAxMHB4OwogICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgdHJhbnNpdGlvbjogYWxsIDAuM3MgZWFzZTsKICAgICAgICB9CiAgICAgICAgLmFpLWZsb2F0aW5nLWJ1dHRvbjpob3ZlciB7CiAgICAgICAgICByaWdodDogNXB4OwogICAgICAgIH0KICAgICAgICAuYWktZmxvYXRpbmctYnV0dG9uIGJ1dHRvbiB7CiAgICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgfQogICAgICBgOwogICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTsKCiAgICAgIC8vIOa3u+WKoOeCueWHu+S6i+S7tgogICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgc2hvd0FpU3VnZ2VzdGlvbnMudmFsdWUgPSB0cnVlOwogICAgICAgIGNvbnNvbGUubG9nKCfngrnlh7vlsZXlvIDmjInpkq7vvIxzaG93QWlTdWdnZXN0aW9uc+iuvue9ruS4unRydWUnKTsKICAgICAgfSk7CgogICAgICAvLyDmt7vliqDliLBib2R5CiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKICAgIH07CgogICAgLy8g5pu05paw5bGV5byA5oyJ6ZKu55qE5pi+56S654q25oCBCiAgICBjb25zdCB1cGRhdGVGbG9hdGluZ0J1dHRvbiA9ICgpID0+IHsKICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FpRmxvYXRpbmdCdXR0b24nKTsKICAgICAgaWYgKCFidXR0b24pIHJldHVybjsKICAgICAgaWYgKGFjdGl2ZVRhYi52YWx1ZSA9PT0gJ2NvbnRyYWN0VGV4dCcgJiYgIXNob3dBaVN1Z2dlc3Rpb25zLnZhbHVlKSB7CiAgICAgICAgYnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwogICAgICB9IGVsc2UgewogICAgICAgIGJ1dHRvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICB9CiAgICB9OwoKICAgIC8vIOebkeWQrHNob3dBaVN1Z2dlc3Rpb25z5ZKMYWN0aXZlVGFi55qE5Y+Y5YyW77yM5pu05paw5oyJ6ZKu5pi+56S654q25oCBCiAgICB3YXRjaChbc2hvd0FpU3VnZ2VzdGlvbnMsIGFjdGl2ZVRhYl0sICgpID0+IHsKICAgICAgdXBkYXRlRmxvYXRpbmdCdXR0b24oKTsKICAgIH0pOwoKICAgIC8vIOmHh+e6s+WGheiBlOe8lui+keWZqOS4reeahOW7uuiurgogICAgY29uc3QgYWRvcHRJbmxpbmVFZGl0U3VnZ2VzdGlvbiA9IHN1Z2dlc3Rpb25JZCA9PiB7CiAgICAgIGlmICghcXVpbGxFZGl0b3IudmFsdWUpIHJldHVybjsKCiAgICAgIC8vIOafpeaJvuWMuemFjeeahOW7uuiurgogICAgICBsZXQgc3VnZ2VzdGlvbiA9IG51bGw7CiAgICAgIGxldCBzdWdnZXN0aW9uVHlwZSA9IG51bGw7CiAgICAgIGxldCBzdWdnZXN0aW9uSW5kZXggPSAtMTsKCiAgICAgIC8vIOWcqOivreazleW7uuiuruS4reafpeaJvgogICAgICBjb25zdCBzeW50YXhJbmRleCA9IGFpU3VnZ2VzdGlvbnMuc3ludGF4LmZpbmRJbmRleChzID0+IHMuaWQgPT09IHN1Z2dlc3Rpb25JZCk7CiAgICAgIGlmIChzeW50YXhJbmRleCAhPT0gLTEpIHsKICAgICAgICBzdWdnZXN0aW9uID0gYWlTdWdnZXN0aW9ucy5zeW50YXhbc3ludGF4SW5kZXhdOwogICAgICAgIHN1Z2dlc3Rpb25UeXBlID0gJ3N5bnRheCc7CiAgICAgICAgc3VnZ2VzdGlvbkluZGV4ID0gc3ludGF4SW5kZXg7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g5Zyo5pyv6K+t5bu66K6u5Lit5p+l5om+CiAgICAgICAgY29uc3QgdGVybUluZGV4ID0gYWlTdWdnZXN0aW9ucy50ZXJtaW5vbG9neS5maW5kSW5kZXgocyA9PiBzLmlkID09PSBzdWdnZXN0aW9uSWQpOwogICAgICAgIGlmICh0ZXJtSW5kZXggIT09IC0xKSB7CiAgICAgICAgICBzdWdnZXN0aW9uID0gYWlTdWdnZXN0aW9ucy50ZXJtaW5vbG9neVt0ZXJtSW5kZXhdOwogICAgICAgICAgc3VnZ2VzdGlvblR5cGUgPSAndGVybWlub2xvZ3knOwogICAgICAgICAgc3VnZ2VzdGlvbkluZGV4ID0gdGVybUluZGV4OwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc3VnZ2VzdGlvbikgewogICAgICAgIC8vIOiOt+WPllF1aWxs57yW6L6R5Zmo5a6e5L6LCiAgICAgICAgY29uc3QgZWRpdG9yID0gcXVpbGxFZGl0b3IudmFsdWUuZ2V0UXVpbGwoKTsKCiAgICAgICAgLy8g5Zyo5paH5qGj5Lit5p+l5om+5bm25pu/5o2i5bu66K6uCiAgICAgICAgY29uc3QgY29udGVudCA9IGVkaXRvci5nZXRUZXh0KCk7CiAgICAgICAgbGV0IGluZGV4ID0gY29udGVudC5pbmRleE9mKHN1Z2dlc3Rpb24ub3JpZ2luYWwpOwogICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIOabv+aNouaWh+acrAogICAgICAgICAgZWRpdG9yLmRlbGV0ZVRleHQoaW5kZXgsIHN1Z2dlc3Rpb24ub3JpZ2luYWwubGVuZ3RoKTsKICAgICAgICAgIGVkaXRvci5pbnNlcnRUZXh0KGluZGV4LCBzdWdnZXN0aW9uLnN1Z2dlc3RlZCk7CgogICAgICAgICAgLy8g5LuO5bu66K6u5YiX6KGo5Lit56e76ZmkCiAgICAgICAgICBhaVN1Z2dlc3Rpb25zW3N1Z2dlc3Rpb25UeXBlXS5zcGxpY2Uoc3VnZ2VzdGlvbkluZGV4LCAxKTsKICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCflt7Lph4fnurPlu7rorq4nKTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgLy8g5b+955Wl5YaF6IGU57yW6L6R5Zmo5Lit55qE5bu66K6uCiAgICBjb25zdCBpZ25vcmVJbmxpbmVFZGl0U3VnZ2VzdGlvbiA9IHN1Z2dlc3Rpb25JZCA9PiB7CiAgICAgIC8vIOafpeaJvuWMuemFjeeahOW7uuiurgogICAgICBsZXQgc3VnZ2VzdGlvblR5cGUgPSBudWxsOwogICAgICBsZXQgc3VnZ2VzdGlvbkluZGV4ID0gLTE7CgogICAgICAvLyDlnKjor63ms5Xlu7rorq7kuK3mn6Xmib4KICAgICAgY29uc3Qgc3ludGF4SW5kZXggPSBhaVN1Z2dlc3Rpb25zLnN5bnRheC5maW5kSW5kZXgocyA9PiBzLmlkID09PSBzdWdnZXN0aW9uSWQpOwogICAgICBpZiAoc3ludGF4SW5kZXggIT09IC0xKSB7CiAgICAgICAgc3VnZ2VzdGlvblR5cGUgPSAnc3ludGF4JzsKICAgICAgICBzdWdnZXN0aW9uSW5kZXggPSBzeW50YXhJbmRleDsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDlnKjmnK/or63lu7rorq7kuK3mn6Xmib4KICAgICAgICBjb25zdCB0ZXJtSW5kZXggPSBhaVN1Z2dlc3Rpb25zLnRlcm1pbm9sb2d5LmZpbmRJbmRleChzID0+IHMuaWQgPT09IHN1Z2dlc3Rpb25JZCk7CiAgICAgICAgaWYgKHRlcm1JbmRleCAhPT0gLTEpIHsKICAgICAgICAgIHN1Z2dlc3Rpb25UeXBlID0gJ3Rlcm1pbm9sb2d5JzsKICAgICAgICAgIHN1Z2dlc3Rpb25JbmRleCA9IHRlcm1JbmRleDsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHN1Z2dlc3Rpb25UeXBlICYmIHN1Z2dlc3Rpb25JbmRleCAhPT0gLTEpIHsKICAgICAgICAvLyDku47lu7rorq7liJfooajkuK3np7vpmaQKICAgICAgICBhaVN1Z2dlc3Rpb25zW3N1Z2dlc3Rpb25UeXBlXS5zcGxpY2Uoc3VnZ2VzdGlvbkluZGV4LCAxKTsKICAgICAgICBFbE1lc3NhZ2UuaW5mbygn5bey5b+955Wl5bu66K6uJyk7CgogICAgICAgIC8vIOenu+mZpOaWh+aho+S4reeahOagh+iusAogICAgICAgIGlmIChxdWlsbEVkaXRvci52YWx1ZSkgewogICAgICAgICAgLy8g5Zyo6L+Z6YeM5re75Yqg56e76Zmk5qCH6K6w55qE6YC76L6RCiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIC8vIOabtOWuieWFqOWcsOiOt+WPllF1aWxs57yW6L6R5ZmoRE9N5YWD57Sg55qE6L6F5Yqp5Ye95pWwCiAgICBjb25zdCBnZXRRdWlsbEVkaXRvckVsZW1lbnQgPSAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKCFxdWlsbEVkaXRvci52YWx1ZSkgcmV0dXJuIG51bGw7CgogICAgICAgIC8vIOWwneivleS4jeWQjOeahOaWueW8j+iOt+WPlue8lui+keWZqERPTeWFg+e0oAogICAgICAgIGlmIChxdWlsbEVkaXRvci52YWx1ZS4kZWwgJiYgdHlwZW9mIHF1aWxsRWRpdG9yLnZhbHVlLiRlbC5xdWVyeVNlbGVjdG9yID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAvLyBWdWXnu4Tku7blrp7kvovmlrnlvI8KICAgICAgICAgIHJldHVybiBxdWlsbEVkaXRvci52YWx1ZS4kZWwucXVlcnlTZWxlY3RvcignLnFsLWVkaXRvcicpOwogICAgICAgIH0gZWxzZSBpZiAocXVpbGxFZGl0b3IudmFsdWUuY29udGFpbmVyKSB7CiAgICAgICAgICAvLyDljp/nlJ9RdWlsbOWunuS+i+aWueW8jwogICAgICAgICAgcmV0dXJuIHF1aWxsRWRpdG9yLnZhbHVlLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcucWwtZWRpdG9yJyk7CiAgICAgICAgfSBlbHNlIGlmIChxdWlsbEVkaXRvci52YWx1ZS5nZXRRdWlsbCkgewogICAgICAgICAgLy8gQHZ1ZXVwL3Z1ZS1xdWlsbOaWueW8jwogICAgICAgICAgY29uc3QgcXVpbGwgPSBxdWlsbEVkaXRvci52YWx1ZS5nZXRRdWlsbCgpOwogICAgICAgICAgaWYgKHF1aWxsICYmIHF1aWxsLnJvb3QpIHsKICAgICAgICAgICAgcmV0dXJuIHF1aWxsLnJvb3Q7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyDmnIDlkI7lsJ3or5Xnm7TmjqXlnKjmlofmoaPkuK3mn6Xmib4KICAgICAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0LXRleHQtZWRpdG9yIC5xbC1lZGl0b3InKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPlue8lui+keWZqOWFg+e0oOWksei0pTonLCBlKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfTsKCiAgICAvLyDmuIXpmaTmiYDmnInlhoXogZTnvJbovpHlu7rorq4KICAgIGNvbnN0IGNsZWFySW5saW5lRWRpdFN1Z2dlc3Rpb25zID0gKCkgPT4gewogICAgICBjb25zdCBlZGl0b3JDb250YWluZXIgPSBnZXRRdWlsbEVkaXRvckVsZW1lbnQoKTsKICAgICAgaWYgKCFlZGl0b3JDb250YWluZXIpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ+aXoOazleiOt+WPlue8lui+keWZqOWFg+e0oO+8jOi3s+i/h+a4hemZpOaTjeS9nCcpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIC8vIOafpeaJvuaJgOacieW7uuiurumrmOS6ruWFg+e0oAogICAgICAgIGNvbnN0IGhpZ2hsaWdodHMgPSBlZGl0b3JDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnN1Z2dlc3Rpb24taGlnaGxpZ2h0Jyk7CgogICAgICAgIC8vIOabv+aNouWbnuaZrumAmuaWh+acrAogICAgICAgIGhpZ2hsaWdodHMuZm9yRWFjaChzcGFuID0+IHsKICAgICAgICAgIGNvbnN0IHRleHQgPSBzcGFuLnRleHRDb250ZW50OwogICAgICAgICAgY29uc3QgcGFyZW50ID0gc3Bhbi5wYXJlbnROb2RlOwogICAgICAgICAgaWYgKHBhcmVudCkgewogICAgICAgICAgICBjb25zdCB0ZXh0Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpOwogICAgICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHRleHROb2RlLCBzcGFuKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+a4hemZpOW7uuiurumrmOS6ruWksei0pTonLCBlKTsKICAgICAgfQogICAgfTsKCiAgICAvLyDkv67lpI3lupTnlKjlhoXogZTlu7rorq7lh73mlbAKICAgIGNvbnN0IGFwcGx5SW5saW5lU3VnZ2VzdGlvbnMgPSAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKCFxdWlsbEVkaXRvci52YWx1ZSkgewogICAgICAgICAgY29uc29sZS53YXJuKCfnvJbovpHlmajlsJrmnKrliJ3lp4vljJbvvIzml6Dms5XlupTnlKjlhoXogZTlu7rorq4nKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIOWFiOa4hemZpOaJgOacieW7uuiuruagh+iusO+8jOmBv+WFjemHjeWPoAogICAgICAgIGNsZWFySW5saW5lRWRpdFN1Z2dlc3Rpb25zKCk7CgogICAgICAgIC8vIOS4uuavj+S4quW7uuiurua3u+WKoOWUr+S4gElE77yI5aaC5p6c5rKh5pyJ77yJCiAgICAgICAgY29uc3QgYWxsU3VnZ2VzdGlvbnMgPSBbLi4uYWlTdWdnZXN0aW9ucy5zeW50YXgubWFwKChzLCBpKSA9PiAoewogICAgICAgICAgLi4ucywKICAgICAgICAgIGlkOiBzLmlkIHx8IGBzeW50YXgtJHtpfWAKICAgICAgICB9KSksIC4uLmFpU3VnZ2VzdGlvbnMudGVybWlub2xvZ3kubWFwKChzLCBpKSA9PiAoewogICAgICAgICAgLi4ucywKICAgICAgICAgIGlkOiBzLmlkIHx8IGB0ZXJtLSR7aX1gCiAgICAgICAgfSkpXTsKICAgICAgICBpZiAoIWFsbFN1Z2dlc3Rpb25zLmxlbmd0aCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g5omL5Yqo5aSE55CG5bu66K6u6auY5Lqu77yM5LiN5L6d6LWWUXVpbGzmqKHlnZcKICAgICAgICBjb25zdCBlZGl0b3JDb250YWluZXIgPSBnZXRRdWlsbEVkaXRvckVsZW1lbnQoKTsKICAgICAgICBpZiAoIWVkaXRvckNvbnRhaW5lcikgewogICAgICAgICAgY29uc29sZS53YXJuKCfml6Dms5Xojrflj5bnvJbovpHlmajlhYPntKDvvIzml6Dms5XlupTnlKjlhoXogZTlu7rorq4nKTsKICAgICAgICAgIHNob3dBaVN1Z2dlc3Rpb25zLnZhbHVlID0gdHJ1ZTsgLy8g5aaC5p6c5peg5rOV5bqU55So5YaF6IGU5bu66K6u77yM5pi+56S65L6n6L655qCPCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyDlnKjnvJbovpHlmajlpJbpg6jliJvlu7rlt6Xlhbfmj5DnpLrlrrnlmagKICAgICAgICBsZXQgdG9vbHRpcENvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWdnZXN0aW9uLXRvb2x0aXAtY29udGFpbmVyJyk7CiAgICAgICAgaWYgKCF0b29sdGlwQ29udGFpbmVyKSB7CiAgICAgICAgICB0b29sdGlwQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICB0b29sdGlwQ29udGFpbmVyLmlkID0gJ3N1Z2dlc3Rpb24tdG9vbHRpcC1jb250YWluZXInOwogICAgICAgICAgdG9vbHRpcENvbnRhaW5lci5jbGFzc05hbWUgPSAnc3VnZ2VzdGlvbi10b29sdGlwJzsKICAgICAgICAgIHRvb2x0aXBDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodG9vbHRpcENvbnRhaW5lcik7CiAgICAgICAgfQogICAgICAgIGFsbFN1Z2dlc3Rpb25zLmZvckVhY2goc3VnZ2VzdGlvbiA9PiB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICAvLyDmn6Xmib7mlofmnKzoioLngrkKICAgICAgICAgICAgY29uc3QgdGV4dENvbnRlbnQgPSBlZGl0b3JDb250YWluZXIudGV4dENvbnRlbnQgfHwgJyc7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGV4dENvbnRlbnQuaW5kZXhPZihzdWdnZXN0aW9uLm9yaWdpbmFsKTsKICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkgcmV0dXJuOwoKICAgICAgICAgICAgLy8g55SoVHJlZVdhbGtlcuWvu+aJvuaWh+acrOiKgueCuQogICAgICAgICAgICBjb25zdCB3YWxrZXIgPSBkb2N1bWVudC5jcmVhdGVUcmVlV2Fsa2VyKGVkaXRvckNvbnRhaW5lciwgTm9kZUZpbHRlci5TSE9XX1RFWFQsIG51bGwsIGZhbHNlKTsKICAgICAgICAgICAgbGV0IGN1cnJlbnROb2RlOwogICAgICAgICAgICBsZXQgY3VycmVudEluZGV4ID0gMDsKICAgICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7CiAgICAgICAgICAgIHdoaWxlIChjdXJyZW50Tm9kZSA9IHdhbGtlci5uZXh0Tm9kZSgpKSB7CiAgICAgICAgICAgICAgY29uc3Qgbm9kZVRleHQgPSBjdXJyZW50Tm9kZS5ub2RlVmFsdWU7CiAgICAgICAgICAgICAgY29uc3Qgbm9kZUxlbmd0aCA9IG5vZGVUZXh0Lmxlbmd0aDsKCiAgICAgICAgICAgICAgLy8g5qOA5p+l5piv5ZCm5Zyo5q2k6IqC54K55Lit5om+5Yiw5Y6f5aeL5paH5pysCiAgICAgICAgICAgICAgaWYgKGN1cnJlbnRJbmRleCA8PSBpbmRleCAmJiBpbmRleCA8IGN1cnJlbnRJbmRleCArIG5vZGVMZW5ndGgpIHsKICAgICAgICAgICAgICAgIC8vIOaJvuWIsOS6huiKgueCuQogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRPZmZzZXQgPSBpbmRleCAtIGN1cnJlbnRJbmRleDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIC8vIOWIm+W7uuiMg+WbtAogICAgICAgICAgICAgICAgICBjb25zdCByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7CiAgICAgICAgICAgICAgICAgIHJhbmdlLnNldFN0YXJ0KGN1cnJlbnROb2RlLCBzdGFydE9mZnNldCk7CiAgICAgICAgICAgICAgICAgIHJhbmdlLnNldEVuZChjdXJyZW50Tm9kZSwgc3RhcnRPZmZzZXQgKyBzdWdnZXN0aW9uLm9yaWdpbmFsLmxlbmd0aCk7CgogICAgICAgICAgICAgICAgICAvLyDliJvlu7pzcGFu5qCH562+CiAgICAgICAgICAgICAgICAgIGNvbnN0IHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgICAgICAgIHNwYW4uY2xhc3NOYW1lID0gJ3N1Z2dlc3Rpb24taGlnaGxpZ2h0JzsKICAgICAgICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGUoJ2RhdGEtc3VnZ2VzdGlvbi1pZCcsIHN1Z2dlc3Rpb24uaWQpOwogICAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZSgnZGF0YS1vcmlnaW5hbCcsIHN1Z2dlc3Rpb24ub3JpZ2luYWwpOwogICAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZSgnZGF0YS1zdWdnZXN0ZWQnLCBzdWdnZXN0aW9uLnN1Z2dlc3RlZCk7CiAgICAgICAgICAgICAgICAgIHNwYW4udGl0bGUgPSAn54K55Ye75p+l55yL5L+u5pS55bu66K6uJzsKICAgICAgICAgICAgICAgICAgc3Bhbi5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAncmdiYSgyNTUsIDIxNywgMTAyLCAwLjMpJzsKICAgICAgICAgICAgICAgICAgc3Bhbi5zdHlsZS5ib3JkZXJCb3R0b20gPSAnMXB4IGRhc2hlZCAjZmZiMzAwJzsKICAgICAgICAgICAgICAgICAgc3Bhbi5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7CiAgICAgICAgICAgICAgICAgIHNwYW4uc3R5bGUucGFkZGluZyA9ICcwIDJweCc7CgogICAgICAgICAgICAgICAgICAvLyDnlKhzcGFu5YyF5Zu05paH5pysCiAgICAgICAgICAgICAgICAgIHJhbmdlLnN1cnJvdW5kQ29udGVudHMoc3Bhbik7CgogICAgICAgICAgICAgICAgICAvLyDmt7vliqDngrnlh7vkuovku7bnm5HlkKzlmagKICAgICAgICAgICAgICAgICAgc3Bhbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4gewogICAgICAgICAgICAgICAgICAgIHNob3dTdWdnZXN0aW9uVG9vbHRpcChlLnRhcmdldCwgc3VnZ2VzdGlvbiwgdG9vbHRpcENvbnRhaW5lcik7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChyYW5nZUVycm9yKSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIm+W7uuaWh+acrOiMg+WbtOWksei0pTonLCByYW5nZUVycm9yKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjdXJyZW50SW5kZXggKz0gbm9kZUxlbmd0aDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZm91bmQpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5oiQ5Yqf6auY5Lqu5bu66K6uOicsIHN1Z2dlc3Rpb24uaWQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+W6lOeUqOmrmOS6ruWksei0pTonLCBlKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8g6YCa55+l55So5oi3CiAgICAgICAgaWYgKGFsbFN1Z2dlc3Rpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgIEVsTWVzc2FnZS5pbmZvKGDlnKjnvJbovpHlmajkuK3pq5jkuq7kuoYke2FsbFN1Z2dlc3Rpb25zLmxlbmd0aH3lpITlu7rorq7kv67mlLnvvIzngrnlh7vpq5jkuq7pg6jliIblj6/mn6XnnIvor6bmg4VgKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5bqU55So5YaF6IGU5bu66K6u5aSx6LSlOicsIGVycm9yKTsKICAgICAgICBzaG93QWlTdWdnZXN0aW9ucy52YWx1ZSA9IHRydWU7IC8vIOWmguaenOWGheiBlOWksei0pe+8jOaYvuekuuS+p+i+ueagjwogICAgICB9CiAgICB9OwoKICAgIC8vIOaYvuekuuW7uuiuruW3peWFt+aPkOekugogICAgY29uc3Qgc2hvd1N1Z2dlc3Rpb25Ub29sdGlwID0gKGVsZW1lbnQsIHN1Z2dlc3Rpb24sIHRvb2x0aXBDb250YWluZXIpID0+IHsKICAgICAgY29uc3QgcmVjdCA9IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgogICAgICAvLyDmuIXpmaTnjrDmnInlhoXlrrkKICAgICAgdG9vbHRpcENvbnRhaW5lci5pbm5lckhUTUwgPSAnJzsKCiAgICAgIC8vIOeUn+aIkOW3ruW8guWvueavlO+8iOS9v+eUqOWinuW8uueJiOeul+azle+8iQogICAgICBsZXQgZGlmZkh0bWwgPSAnJzsKICAgICAgaWYgKHdpbmRvdy5lbmhhbmNlZERpZmZEaXNwbGF5KSB7CiAgICAgICAgLy8g5L2/55So6KGl5LiB5Lit5o+Q5L6b55qE5aKe5by654mI5beu5byC566X5rOVCiAgICAgICAgZGlmZkh0bWwgPSB3aW5kb3cuZW5oYW5jZWREaWZmRGlzcGxheShzdWdnZXN0aW9uLm9yaWdpbmFsLCBzdWdnZXN0aW9uLnN1Z2dlc3RlZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8g5Zue6YCA5Yiw566A5Y2V54mI5pysCiAgICAgICAgZGlmZkh0bWwgPSBnZW5lcmF0ZURpZmYoc3VnZ2VzdGlvbi5vcmlnaW5hbCwgc3VnZ2VzdGlvbi5zdWdnZXN0ZWQpOwogICAgICB9CgogICAgICAvLyDorr7nva7lt6Xlhbfmj5DnpLrlhoXlrrkKICAgICAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBjb250ZW50LmNsYXNzTmFtZSA9ICdzdWdnZXN0aW9uLXRvb2x0aXAtY29udGVudCc7CiAgICAgIGNvbnRlbnQuaW5uZXJIVE1MID0gYAogICAgICAgIDxkaXYgY2xhc3M9InN1Z2dlc3Rpb24tdG9vbHRpcC1oZWFkZXIiPgogICAgICAgICAgPHNwYW4gY2xhc3M9InN1Z2dlc3Rpb24tdG9vbHRpcC10aXRsZSI+QUnmlofmnKzkvJjljJblu7rorq48L3NwYW4+CiAgICAgICAgICA8c3BhbiBjbGFzcz0ic3VnZ2VzdGlvbi10b29sdGlwLWNsb3NlIj4mdGltZXM7PC9zcGFuPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9InN1Z2dlc3Rpb24tdG9vbHRpcC1ib2R5Ij4KICAgICAgICAgIDxkaXYgY2xhc3M9InN1Z2dlc3Rpb24tY29tcGFyaXNvbiI+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InN1Z2dlc3Rpb24tY29sdW1uIj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdWdnZXN0aW9uLWxhYmVsIj7ljp/mlofmnKw6PC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3VnZ2VzdGlvbi1vcmlnaW5hbCI+JHtlc2NhcGVIdG1sKHN1Z2dlc3Rpb24ub3JpZ2luYWwpfTwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3VnZ2VzdGlvbi1kaXZpZGVyIj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3VnZ2VzdGlvbi1jb2x1bW4iPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9InN1Z2dlc3Rpb24tbGFiZWwiPuW7uuiuruS/ruaUueS4ujo8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdWdnZXN0aW9uLXN1Z2dlc3RlZCI+JHtlc2NhcGVIdG1sKHN1Z2dlc3Rpb24uc3VnZ2VzdGVkKX08L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxkaXYgY2xhc3M9InN1Z2dlc3Rpb24tZGlmZi1jb250YWluZXIiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdWdnZXN0aW9uLWxhYmVsIj7lt67lvILlr7nmr5Q6PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InN1Z2dlc3Rpb24tZGlmZiI+JHtkaWZmSHRtbH08L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgJHtzdWdnZXN0aW9uLmV4cGxhbmF0aW9uID8gYAogICAgICAgICAgPGRpdiBjbGFzcz0ic3VnZ2VzdGlvbi1leHBsYW5hdGlvbi1jb250YWluZXIiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzdWdnZXN0aW9uLWxhYmVsIj7kv67mlLnor7TmmI46PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InN1Z2dlc3Rpb24tZXhwbGFuYXRpb24iPiR7ZXNjYXBlSHRtbChzdWdnZXN0aW9uLmV4cGxhbmF0aW9uKX08L2Rpdj4KICAgICAgICAgIDwvZGl2PmAgOiAnJ30KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJzdWdnZXN0aW9uLWFjdGlvbnMiPgogICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuLWFkb3B0Ij7ph4fnurPmraTlu7rorq48L2J1dHRvbj4KICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0bi1pZ25vcmUiPuW/veeVpTwvYnV0dG9uPgogICAgICAgIDwvZGl2PgogICAgICBgOwogICAgICB0b29sdGlwQ29udGFpbmVyLmFwcGVuZENoaWxkKGNvbnRlbnQpOwoKICAgICAgLy8g5a6a5L2N5bel5YW35o+Q56S6CiAgICAgIHRvb2x0aXBDb250YWluZXIuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnOwogICAgICB0b29sdGlwQ29udGFpbmVyLnN0eWxlLnpJbmRleCA9ICc5OTk5JzsKICAgICAgdG9vbHRpcENvbnRhaW5lci5zdHlsZS50b3AgPSBgJHtyZWN0LmJvdHRvbSArIHdpbmRvdy5zY3JvbGxZICsgNX1weGA7CiAgICAgIHRvb2x0aXBDb250YWluZXIuc3R5bGUubGVmdCA9IGAke3JlY3QubGVmdCArIHdpbmRvdy5zY3JvbGxYfXB4YDsKICAgICAgdG9vbHRpcENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgdG9vbHRpcENvbnRhaW5lci5zdHlsZS5tYXhXaWR0aCA9ICc0NTBweCc7CiAgICAgIHRvb2x0aXBDb250YWluZXIuc3R5bGUuYmFja2dyb3VuZCA9ICd3aGl0ZSc7CiAgICAgIHRvb2x0aXBDb250YWluZXIuc3R5bGUuYm94U2hhZG93ID0gJzAgMnB4IDEycHggMCByZ2JhKDAsMCwwLC4xKSc7CiAgICAgIHRvb2x0aXBDb250YWluZXIuc3R5bGUuYm9yZGVyID0gJzFweCBzb2xpZCAjZWJlZWY1JzsKICAgICAgdG9vbHRpcENvbnRhaW5lci5zdHlsZS5ib3JkZXJSYWRpdXMgPSAnNHB4JzsKICAgICAgdG9vbHRpcENvbnRhaW5lci5zdHlsZS5wYWRkaW5nID0gJzEycHgnOwoKICAgICAgLy8g5re75Yqg5oyJ6ZKu5LqL5Lu2CiAgICAgIGNvbnN0IGFkb3B0QnRuID0gdG9vbHRpcENvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuYnRuLWFkb3B0Jyk7CiAgICAgIGNvbnN0IGlnbm9yZUJ0biA9IHRvb2x0aXBDb250YWluZXIucXVlcnlTZWxlY3RvcignLmJ0bi1pZ25vcmUnKTsKICAgICAgY29uc3QgY2xvc2VCdG4gPSB0b29sdGlwQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5zdWdnZXN0aW9uLXRvb2x0aXAtY2xvc2UnKTsKICAgICAgYWRvcHRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgYWRvcHRJbmxpbmVFZGl0U3VnZ2VzdGlvbihzdWdnZXN0aW9uLmlkKTsKICAgICAgICB0b29sdGlwQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgIH0pOwogICAgICBpZ25vcmVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgaWdub3JlSW5saW5lRWRpdFN1Z2dlc3Rpb24oc3VnZ2VzdGlvbi5pZCk7CiAgICAgICAgdG9vbHRpcENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICB9KTsKICAgICAgY2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgdG9vbHRpcENvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICB9KTsKCiAgICAgIC8vIOeCueWHu+WklumDqOmakOiXj+W3peWFt+aPkOekugogICAgICBjb25zdCBjbGlja091dHNpZGVIYW5kbGVyID0gZSA9PiB7CiAgICAgICAgaWYgKCF0b29sdGlwQ29udGFpbmVyLmNvbnRhaW5zKGUudGFyZ2V0KSAmJiAhZWxlbWVudC5jb250YWlucyhlLnRhcmdldCkpIHsKICAgICAgICAgIHRvb2x0aXBDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xpY2tPdXRzaWRlSGFuZGxlcik7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgLy8g56Gu5L+d5LiN5Lya6L+e57ut6Kem5Y+RCiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xpY2tPdXRzaWRlSGFuZGxlcik7CiAgICAgIH0sIDEwMCk7CiAgICB9OwoKICAgIC8vIOi9rOS5iUhUTUznibnmrorlrZfnrKYKICAgIGNvbnN0IGVzY2FwZUh0bWwgPSB1bnNhZmUgPT4gewogICAgICByZXR1cm4gdW5zYWZlLnJlcGxhY2UoLyYvZywgIiZhbXA7IikucmVwbGFjZSgvPC9nLCAiJmx0OyIpLnJlcGxhY2UoLz4vZywgIiZndDsiKS5yZXBsYWNlKC8iL2csICImcXVvdDsiKS5yZXBsYWNlKC8nL2csICImIzAzOTsiKTsKICAgIH07CgogICAgLy8g55Sf5oiQ5beu5byC5a+55q+U77yI566A5Y2V54mI5pys77yM5L2c5Li65aSH55So77yJCiAgICBjb25zdCBnZW5lcmF0ZURpZmYgPSAob3JpZ2luYWwsIHN1Z2dlc3RlZCkgPT4gewogICAgICB0cnkgewogICAgICAgIGlmICghb3JpZ2luYWwgfHwgIXN1Z2dlc3RlZCkgcmV0dXJuICcnOwoKICAgICAgICAvLyDkvb/nlKjmm7Tnsr7noa7nmoTliIbor43mlrnms5UKICAgICAgICBjb25zdCB0b2tlbml6ZSA9IHRleHQgPT4gewogICAgICAgICAgLy8g5L+d55WZ5qCH54K556ym5Y+35L2c5Li65Y2V54us55qE5qCH6K6w77yM5ZCM5pe25L+d5oyB5Lit5paH5a2X56ym55qE5a6M5pW05oCnCiAgICAgICAgICByZXR1cm4gdGV4dC5zcGxpdCgvKFssLiE/OzrvvIzjgILvvIHvvJ/vvJvvvJpcc10rfFtcdTRlMDAtXHU5ZmE1XSkvZykuZmlsdGVyKHRva2VuID0+IHRva2VuICE9PSAnJyk7CiAgICAgICAgfTsKICAgICAgICBjb25zdCB0b2tlbnMxID0gdG9rZW5pemUob3JpZ2luYWwpOwogICAgICAgIGNvbnN0IHRva2VuczIgPSB0b2tlbml6ZShzdWdnZXN0ZWQpOwoKICAgICAgICAvLyDmnoTlu7rlt67lvIJIVE1MCiAgICAgICAgbGV0IGh0bWwgPSAnPGRpdiBjbGFzcz0iZGlmZi1jb250ZW50Ij4nOwoKICAgICAgICAvLyDkvb/nlKjmlLnov5vnmoTlt67lvILlr7nmr5Tnrpfms5UKICAgICAgICBjb25zdCBtYXRjaGVkID0gbmV3IFNldCgpOyAvLyDorrDlvZXlt7LljLnphY3nmoTntKLlvJUKCiAgICAgICAgLy8g56ys5LiA5q2l77ya5om+5Ye65a6M5YWo55u45ZCM55qE6YOo5YiGCiAgICAgICAgY29uc3QgY29tbW9uUGFydHMgPSBbXTsKICAgICAgICBmb3IgKGxldCBpMSA9IDA7IGkxIDwgdG9rZW5zMS5sZW5ndGg7IGkxKyspIHsKICAgICAgICAgIGZvciAobGV0IGoxID0gMDsgajEgPCB0b2tlbnMyLmxlbmd0aDsgajErKykgewogICAgICAgICAgICBpZiAodG9rZW5zMVtpMV0gPT09IHRva2VuczJbajFdICYmICFtYXRjaGVkLmhhcyhgMjoke2oxfWApKSB7CiAgICAgICAgICAgICAgY29tbW9uUGFydHMucHVzaCh7CiAgICAgICAgICAgICAgICBpbmRleDE6IGkxLAogICAgICAgICAgICAgICAgaW5kZXgyOiBqMSwKICAgICAgICAgICAgICAgIHRva2VuOiB0b2tlbnMxW2kxXQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIG1hdGNoZWQuYWRkKGAyOiR7ajF9YCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIOaMieeFp+esrOS6jOS4quaWh+acrOeahOmhuuW6j+aOkuW6jwogICAgICAgIGNvbW1vblBhcnRzLnNvcnQoKGEsIGIpID0+IGEuaW5kZXgyIC0gYi5pbmRleDIpOwoKICAgICAgICAvLyDnrKzkuozmraXvvJrmoLnmja7lhbHlkIzpg6jliIbmnoTlu7rlt67lvIIKICAgICAgICBsZXQgbGFzdEluZGV4MSA9IC0xOwogICAgICAgIGxldCBsYXN0SW5kZXgyID0gLTE7CiAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIGNvbW1vblBhcnRzKSB7CiAgICAgICAgICAvLyDlpITnkIbnrKzkuIDkuKrmlofmnKzkuK3nmoTliKDpmaTpg6jliIYKICAgICAgICAgIGlmIChwYXJ0LmluZGV4MSA+IGxhc3RJbmRleDEgKyAxKSB7CiAgICAgICAgICAgIGh0bWwgKz0gJzxzcGFuIGNsYXNzPSJkaWZmLXJlbW92ZWQiPic7CiAgICAgICAgICAgIGZvciAobGV0IGsgPSBsYXN0SW5kZXgxICsgMTsgayA8IHBhcnQuaW5kZXgxOyBrKyspIHsKICAgICAgICAgICAgICBodG1sICs9IGVzY2FwZUh0bWwodG9rZW5zMVtrXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaHRtbCArPSAnPC9zcGFuPic7CiAgICAgICAgICB9CgogICAgICAgICAgLy8g5aSE55CG56ys5LqM5Liq5paH5pys5Lit55qE5re75Yqg6YOo5YiGCiAgICAgICAgICBpZiAocGFydC5pbmRleDIgPiBsYXN0SW5kZXgyICsgMSkgewogICAgICAgICAgICBodG1sICs9ICc8c3BhbiBjbGFzcz0iZGlmZi1hZGRlZCI+JzsKICAgICAgICAgICAgZm9yIChsZXQgayA9IGxhc3RJbmRleDIgKyAxOyBrIDwgcGFydC5pbmRleDI7IGsrKykgewogICAgICAgICAgICAgIGh0bWwgKz0gZXNjYXBlSHRtbCh0b2tlbnMyW2tdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBodG1sICs9ICc8L3NwYW4+JzsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyDmt7vliqDlhbHlkIzpg6jliIYKICAgICAgICAgIGh0bWwgKz0gYDxzcGFuIGNsYXNzPSJkaWZmLWNvbW1vbiI+JHtlc2NhcGVIdG1sKHBhcnQudG9rZW4pfTwvc3Bhbj5gOwogICAgICAgICAgbGFzdEluZGV4MSA9IHBhcnQuaW5kZXgxOwogICAgICAgICAgbGFzdEluZGV4MiA9IHBhcnQuaW5kZXgyOwogICAgICAgIH0KCiAgICAgICAgLy8g5aSE55CG5Ymp5L2Z55qE6YOo5YiGCiAgICAgICAgaWYgKGxhc3RJbmRleDEgPCB0b2tlbnMxLmxlbmd0aCAtIDEpIHsKICAgICAgICAgIGh0bWwgKz0gJzxzcGFuIGNsYXNzPSJkaWZmLXJlbW92ZWQiPic7CiAgICAgICAgICBmb3IgKGxldCBrID0gbGFzdEluZGV4MSArIDE7IGsgPCB0b2tlbnMxLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgIGh0bWwgKz0gZXNjYXBlSHRtbCh0b2tlbnMxW2tdKTsKICAgICAgICAgIH0KICAgICAgICAgIGh0bWwgKz0gJzwvc3Bhbj4nOwogICAgICAgIH0KICAgICAgICBpZiAobGFzdEluZGV4MiA8IHRva2VuczIubGVuZ3RoIC0gMSkgewogICAgICAgICAgaHRtbCArPSAnPHNwYW4gY2xhc3M9ImRpZmYtYWRkZWQiPic7CiAgICAgICAgICBmb3IgKGxldCBrID0gbGFzdEluZGV4MiArIDE7IGsgPCB0b2tlbnMyLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgIGh0bWwgKz0gZXNjYXBlSHRtbCh0b2tlbnMyW2tdKTsKICAgICAgICAgIH0KICAgICAgICAgIGh0bWwgKz0gJzwvc3Bhbj4nOwogICAgICAgIH0KICAgICAgICBodG1sICs9ICc8L2Rpdj4nOwogICAgICAgIHJldHVybiBodG1sOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign55Sf5oiQ5beu5byC5a+55q+U5aSx6LSlOicsIGUpOwogICAgICAgIHJldHVybiBgPGRpdiBjbGFzcz0iZGlmZi1lcnJvciI+5peg5rOV55Sf5oiQ5beu5byC5a+55q+UOiAke2UubWVzc2FnZX08L2Rpdj5gOwogICAgICB9CiAgICB9OwoKICAgIC8vIOWGheiBlOW7uuiuruW8gOWFs+WIh+aNouWkhOeQhgogICAgY29uc3Qgb25JbmxpbmVTdWdnZXN0aW9uc1RvZ2dsZSA9IHZhbHVlID0+IHsKICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgRWxNZXNzYWdlLmluZm8oJ+W3suWQr+eUqOWGheiBlOW7uuiuru+8jOa2puiJsue7k+aenOWwhuebtOaOpeaYvuekuuWcqOe8lui+keWZqOS4rScpOwogICAgICAgIC8vIOWQr+eUqOW5tueri+WNs+W6lOeUqOW9k+WJjeeahOW7uuiurgogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgaWYgKGdldFF1aWxsRWRpdG9yRWxlbWVudCgpKSB7CiAgICAgICAgICAgIC8vIOWmguaenOW3suacieW7uuiuru+8jOWImeW6lOeUqOWug+S7rAogICAgICAgICAgICBpZiAoYWlTdWdnZXN0aW9ucy5zeW50YXgubGVuZ3RoID4gMCB8fCBhaVN1Z2dlc3Rpb25zLnRlcm1pbm9sb2d5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBhcHBseUlubGluZVN1Z2dlc3Rpb25zKCk7CiAgICAgICAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+W3suWwhueOsOacieW7uuiuruW6lOeUqOWIsOe8lui+keWZqOS4rScpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIEVsTWVzc2FnZS5pbmZvKCfmsqHmnInlj6/lupTnlKjnmoTlu7rorq7vvIzor7fngrnlh7siQUnmtqboibLliIbmnpAi5oyJ6ZKu6I635Y+W5bu66K6uJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUud2Fybign5peg5rOV6I635Y+W57yW6L6R5Zmo5YWD57Sg77yM5bCG5L2/55So5L6n6L655qCP5pi+56S65bu66K6uJyk7CiAgICAgICAgICAgIHNob3dBaVN1Z2dlc3Rpb25zLnZhbHVlID0gdHJ1ZTsKICAgICAgICAgICAgZW5hYmxlSW5saW5lU3VnZ2VzdGlvbnMudmFsdWUgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9LCAxMDApOwogICAgICB9IGVsc2UgewogICAgICAgIEVsTWVzc2FnZS5pbmZvKCflt7LnpoHnlKjlhoXogZTlu7rorq7vvIzlu7rorq7lsIblj6rlnKjkvqfovrnmoI/mmL7npLonKTsKICAgICAgICAvLyDnpoHnlKjml7bmuIXpmaTmiYDmnInmoIforrAKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNsZWFySW5saW5lRWRpdFN1Z2dlc3Rpb25zKCk7CiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCfmuIXpmaTlu7rorq7moIforrDlpLHotKU6JywgZXJyb3IpOwogICAgICAgICAgfQogICAgICAgIH0sIDEwMCk7CiAgICAgIH0KICAgIH07CgogICAgLy8g6K6+572u6ZSu55uY5b+r5o236ZSuCiAgICBjb25zdCBzZXR1cEtleWJvYXJkU2hvcnRjdXRzID0gKCkgPT4gewogICAgICBjb25zdCBoYW5kbGVLZXlEb3duID0gZSA9PiB7CiAgICAgICAgLy8g5qOA5p+l5piv5ZCm5Li6IEN0cmwrU2hpZnQrQSAo5ram6Imy5YiG5p6QKQogICAgICAgIGlmIChlLmN0cmxLZXkgJiYgZS5zaGlmdEtleSAmJiBlLmtleS50b0xvd2VyQ2FzZSgpID09PSAnYScpIHsKICAgICAgICAgIC8vIOehruS/neW9k+WJjeWcqOWQiOWQjOaWh+acrOagh+etvuW5tuS4lOS4jeWcqOWKoOi9veS4reeKtuaAgQogICAgICAgICAgaWYgKGFjdGl2ZVRhYi52YWx1ZSA9PT0gJ2NvbnRyYWN0VGV4dCcgJiYgIXJlYWxUaW1lUG9saXNoTG9hZGluZy52YWx1ZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7IC8vIOmYu+atoum7mOiupOihjOS4ugogICAgICAgICAgICBtYW51YWxBbmFseXplVGV4dCgpOwogICAgICAgICAgICBFbE1lc3NhZ2UuaW5mbygn5bey6YCa6L+H5b+r5o236ZSu6Kem5Y+RQUnmtqboibLliIbmnpAnKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIOajgOafpeaYr+WQpuS4uiBDdHJsK1NoaWZ0K0MgKOWQiOWQjOajgOafpSkKICAgICAgICBpZiAoZS5jdHJsS2V5ICYmIGUuc2hpZnRLZXkgJiYgZS5rZXkudG9Mb3dlckNhc2UoKSA9PT0gJ2MnKSB7CiAgICAgICAgICAvLyDnoa7kv53lvZPliY3lnKjlkIjlkIzmo4Dmn6XmoIfnrb7lubbkuJTkuI3lnKjmo4Dmn6XkuK3nirbmgIEKICAgICAgICAgIGlmIChhY3RpdmVUYWIudmFsdWUgPT09ICdjb250cmFjdENoZWNrJyAmJiAhaXNDaGVja2luZy52YWx1ZSkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7IC8vIOmYu+atoum7mOiupOihjOS4ugogICAgICAgICAgICBzdGFydENvbnRyYWN0Q2hlY2soKTsKICAgICAgICAgICAgRWxNZXNzYWdlLmluZm8oJ+W3sumAmui/h+W/q+aNt+mUruinpuWPkUFJ5ZCI5ZCM5qOA5p+lJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZUtleURvd24pOwoKICAgICAgLy8g5riF55CG5LqL5Lu255uR5ZCs5ZmoCiAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVLZXlEb3duKTsKICAgICAgfTsKICAgIH07CgogICAgLy8g57uE5Lu25oyC6L295pe25re75Yqg5oyJ6ZKu5ZKM5b+r5o236ZSuCiAgICBvbk1vdW50ZWQoYXN5bmMgKCkgPT4gewogICAgICAvLyDmo4Dmn6XmmK/lkKblnKjlkIjlkIzor6bmg4XpobXpnaLkuJTmnInmnInmlYhJRAogICAgICBpZiAocm91dGUubmFtZSA9PT0gJ0NvbnRyYWN0RGV0YWlsJyAmJiBjb250cmFjdElkLnZhbHVlKSB7CiAgICAgICAgY29uc29sZS5sb2coJ+e7hOS7tuaMgui9ve+8jOW8gOWni+WKoOi9veWQiOWQjOivpuaDhTonLCBjb250cmFjdElkLnZhbHVlKTsKICAgICAgICAvLyDkvb/nlKjpnZnpu5jliqDovb3pgb/lhY3ph43lpI3mj5DnpLrvvIzot6/nlLHnm5HlkKzkvJrotJ/otKPmmL7npLrmtojmga8KICAgICAgICBhd2FpdCBnZXRDb250cmFjdERldGFpbHModHJ1ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS5sb2coJ+e7hOS7tuaMgui9veS9huS4jeWcqOWQiOWQjOivpuaDhemhtemdouaIluWQiOWQjElE5peg5pWI77yM6Lez6L+H5Yqg6L29Jyk7CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coIue7hOS7tuaMgui9veWujOaIkO+8jFVJ5Yid5aeL5YyWIik7CgogICAgICAvLyDlvLrliLbkv67lpI3mu5rliqjmoLflvI8KICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgaWYgKGNoZWNrUmVzdWx0QXJlYS52YWx1ZSkgewogICAgICAgICAgY29uc29sZS5sb2coJ+W8uuWItuS/ruWkjea7muWKqOWMuuWfn+agt+W8jycpOwogICAgICAgICAgLy8g5L+u5aSN5Y+z5L6n5YaF5a655Yy65Z+f5qC35byPIC0g5L2/55SoZmxleOW4g+WxgAogICAgICAgICAgY2hlY2tSZXN1bHRBcmVhLnZhbHVlLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICAgICAgICBjaGVja1Jlc3VsdEFyZWEudmFsdWUuc3R5bGUuZmxleERpcmVjdGlvbiA9ICdjb2x1bW4nOwogICAgICAgICAgY2hlY2tSZXN1bHRBcmVhLnZhbHVlLnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7CiAgICAgICAgICBjaGVja1Jlc3VsdEFyZWEudmFsdWUuc3R5bGUuaGVpZ2h0ID0gJzEwMCUnOwoKICAgICAgICAgIC8vIOS/ruWkjea7muWKqOWuueWZqOagt+W8jyAtIOS9v+eUqGZsZXjlrZDlhYPntKAKICAgICAgICAgIGNvbnN0IHNjcm9sbFdyYXBwZXIgPSBjaGVja1Jlc3VsdEFyZWEudmFsdWUucXVlcnlTZWxlY3RvcignLmNoZWNrLWNvbnRlbnQtc2Nyb2xsLXdyYXBwZXInKTsKICAgICAgICAgIGlmIChzY3JvbGxXcmFwcGVyKSB7CiAgICAgICAgICAgIHNjcm9sbFdyYXBwZXIuc3R5bGUuZmxleCA9ICcxJzsKICAgICAgICAgICAgc2Nyb2xsV3JhcHBlci5zdHlsZS5vdmVyZmxvd1kgPSAnYXV0byc7CiAgICAgICAgICAgIHNjcm9sbFdyYXBwZXIuc3R5bGUucGFkZGluZyA9ICcxNXB4JzsKICAgICAgICAgICAgc2Nyb2xsV3JhcHBlci5zdHlsZS5oZWlnaHQgPSAnMCc7IC8vIOWFs+mUru+8mmZsZXjluIPlsYDkuK3orr7nva5oZWlnaHQ6MOiuqWZsZXgtZ3Jvd+W3peS9nAogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgMzAwKTsKCiAgICAgIC8vIOehruS/nVF1aWxs5q2j56Gu5Yqg6L29CiAgICAgIGNoZWNrQW5kSW5pdFF1aWxsKCk7CgogICAgICAvLyDliJ3lp4vljJbnvJbovpHlmajpq5jluqYKICAgICAgbmV4dFRpY2soKCkgPT4gewogICAgICAgIGFkanVzdEVkaXRvckhlaWdodCgpOwogICAgICAgIC8vIOiuvue9rueql+WPo+Wkp+Wwj+iwg+aVtOebkeWQrOWZqAogICAgICAgIHNldHVwUmVzaXplTGlzdGVuZXIoKTsKCiAgICAgICAgLy8g6K6+572uTXV0YXRpb25PYnNlcnZlcuadpeebkeaOp0RPTeWPmOWMlgogICAgICAgIHNldHVwTXV0YXRpb25PYnNlcnZlcigpOwogICAgICB9KTsKCiAgICAgIC8vIOajgOafpeaYr+WQpuebtOaOpei/m+WFpeWQiOWQjOaWh+acrOagh+etvu+8jOS4jeWGjeiHquWKqOWIhuaekAogICAgICBpZiAoYWN0aXZlVGFiLnZhbHVlID09PSAnY29udHJhY3RUZXh0JykgewogICAgICAgIGNvbnNvbGUubG9nKCLnm7TmjqXov5vlhaXmlofmnKznvJbovpHmoIfnrb7vvIzlj6/ku6Xngrnlh7vmtqboibLmjInpkq7ov5vooYzliIbmnpAiKTsKICAgICAgfQoKICAgICAgLy8g5re75Yqg5bGV5byA5oyJ6ZKuCiAgICAgIGFkZEZsb2F0aW5nQnV0dG9uKCk7CiAgICAgIC8vIOWIneWni+eKtuaAgeS4i+abtOaWsOaMiemSruaYvuekugogICAgICB1cGRhdGVGbG9hdGluZ0J1dHRvbigpOwoKICAgICAgLy8g6K6+572u6ZSu55uY5b+r5o236ZSuCiAgICAgIGNvbnN0IGNsZWFudXBTaG9ydGN1dHMgPSBzZXR1cEtleWJvYXJkU2hvcnRjdXRzKCk7CgogICAgICAvLyDkv53lrZjmuIXnkIblh73mlbDlvJXnlKjliLDlpJbpg6jlj5jph48KICAgICAga2V5Ym9hcmRTaG9ydGN1dHNDbGVhbnVwLnZhbHVlID0gY2xlYW51cFNob3J0Y3V0czsKCiAgICAgIC8vIOa3u+WKoOmhtemdouWPr+ingeaAp+ebkeWQrO+8jOW9k+eUqOaIt+WIh+Wbnuagh+etvumhteaXtumHjeaWsOiwg+aVtOmrmOW6pgogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJ2aXNpYmlsaXR5Y2hhbmdlIiwgaGFuZGxlVmlzaWJpbGl0eUNoYW5nZSk7CiAgICB9KTsKCiAgICAvLyDlpITnkIbpobXpnaLlj6/op4HmgKflj5jljJYKICAgIGNvbnN0IGhhbmRsZVZpc2liaWxpdHlDaGFuZ2UgPSAoKSA9PiB7CiAgICAgIGlmICghZG9jdW1lbnQuaGlkZGVuKSB7CiAgICAgICAgLy8g6aG16Z2i6YeN5paw5Y+Y5Li65Y+v6KeB5pe277yM6YeN5paw6LCD5pW06auY5bqmCiAgICAgICAgY29uc29sZS5sb2coIumhtemdoumHjeaWsOiOt+W+l+eEpueCue+8jOiwg+aVtOW4g+WxgOmrmOW6piIpOwogICAgICAgIHNldFRpbWVvdXQoYWRqdXN0RWRpdG9ySGVpZ2h0LCAxMDApOwogICAgICB9CiAgICB9OwoKICAgIC8vIOe7hOS7tuWNuOi9veaXtua4heeQhui1hOa6kAogICAgb25Vbm1vdW50ZWQoKCkgPT4gewogICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWlGbG9hdGluZ0J1dHRvbicpOwogICAgICBpZiAoYnV0dG9uKSB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChidXR0b24pOwogICAgICB9CgogICAgICAvLyDph43nva5jb250cmFjdElk77yM56Gu5L+d56a75byA6aG16Z2i5pe25riF55CGCiAgICAgIGNvbnRyYWN0SWQudmFsdWUgPSBudWxsOwoKICAgICAgLy8g5riF55CGc3VnZ2VzdGlvbiB0b29sdGlwCiAgICAgIGNvbnN0IHRvb2x0aXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucWwtc3VnZ2VzdGlvbi10b29sdGlwJyk7CiAgICAgIGlmICh0b29sdGlwKSB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0b29sdGlwKTsKICAgICAgfQoKICAgICAgLy8g56e76Zmk5Yqo5oCB5re75Yqg55qE5qC35byPCiAgICAgIGNvbnN0IHN0eWxlRWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWdnZXN0aW9uLXN0eWxlcycpOwogICAgICBpZiAoc3R5bGVFbGVtKSB7CiAgICAgICAgZG9jdW1lbnQuaGVhZC5yZW1vdmVDaGlsZChzdHlsZUVsZW0pOwogICAgICB9CgogICAgICAvLyDmuIXnkIZNdXRhdGlvbk9ic2VydmVyCiAgICAgIGlmIChxdWlsbEVkaXRvci52YWx1ZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCBlZGl0b3IgPSBxdWlsbEVkaXRvci52YWx1ZS5nZXRRdWlsbCgpOwogICAgICAgICAgaWYgKGVkaXRvcikgewogICAgICAgICAgICBjb25zdCBzdWdnZXN0aW9uTW9kdWxlID0gZWRpdG9yLmdldE1vZHVsZSgnc3VnZ2VzdGlvbicpOwogICAgICAgICAgICBpZiAoc3VnZ2VzdGlvbk1vZHVsZSAmJiB0eXBlb2Ygc3VnZ2VzdGlvbk1vZHVsZS5kZXN0cm95ID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgICAgc3VnZ2VzdGlvbk1vZHVsZS5kZXN0cm95KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcign5riF55CG5bu66K6u5qih5Z2X5aSx6LSlOicsIGVycm9yKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIOa4heeQhumUruebmOW/q+aNt+mUrgogICAgICBpZiAoa2V5Ym9hcmRTaG9ydGN1dHNDbGVhbnVwLnZhbHVlKSB7CiAgICAgICAga2V5Ym9hcmRTaG9ydGN1dHNDbGVhbnVwLnZhbHVlKCk7CiAgICAgIH0KCiAgICAgIC8vIOa4heeQhueql+WPo+Wkp+Wwj+iwg+aVtOS6i+S7tuebkeWQrOWZqAogICAgICBjbGVhbnVwUmVzaXplTGlzdGVuZXIoKTsKCiAgICAgIC8vIOa4heeQhkRPTeWPmOWMluebkeWQrOWZqAogICAgICBpZiAocmVzaXplT2JzZXJ2ZXIpIHsKICAgICAgICByZXNpemVPYnNlcnZlci5kaXNjb25uZWN0KCk7CiAgICAgICAgcmVzaXplT2JzZXJ2ZXIgPSBudWxsOwogICAgICB9CgogICAgICAvLyDnp7vpmaTpobXpnaLlj6/op4HmgKfnm5HlkKwKICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigidmlzaWJpbGl0eWNoYW5nZSIsIGhhbmRsZVZpc2liaWxpdHlDaGFuZ2UpOwogICAgfSk7CgogICAgLy8g55So5LqO5a2Y5YKo5riF55CG5Ye95pWw55qE5byV55SoCiAgICBjb25zdCBrZXlib2FyZFNob3J0Y3V0c0NsZWFudXAgPSByZWYobnVsbCk7CgogICAgLy8g5Yib5bu655So5p2l5a2Y5YKoTXV0YXRpb25PYnNlcnZlcueahOWPmOmHjwogICAgbGV0IHJlc2l6ZU9ic2VydmVyID0gbnVsbDsKCiAgICAvLyDorr7nva5NdXRhdGlvbk9ic2VydmVy5p2l55uR5o6nRE9N5Y+Y5YyWCiAgICBjb25zdCBzZXR1cE11dGF0aW9uT2JzZXJ2ZXIgPSAoKSA9PiB7CiAgICAgIC8vIOehruS/neS5i+WJjeeahG9ic2VydmVy5bey6KKr5riF55CGCiAgICAgIGlmIChyZXNpemVPYnNlcnZlcikgewogICAgICAgIHJlc2l6ZU9ic2VydmVyLmRpc2Nvbm5lY3QoKTsKICAgICAgfQoKICAgICAgLy8g5aaC5p6c5Zyo5ZCI5ZCM5paH5pys5qCH562+6aG177yM6K6+572ub2JzZXJ2ZXIKICAgICAgaWYgKGFjdGl2ZVRhYi52YWx1ZSA9PT0gJ2NvbnRyYWN0VGV4dCcgJiYgY29udHJhY3RFZGl0Q29udGFpbmVyLnZhbHVlKSB7CiAgICAgICAgcmVzaXplT2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcigoKSA9PiB7CiAgICAgICAgICAvLyDlvZNET03lj5jljJbml7bvvIzosIPmlbTnvJbovpHlmajpq5jluqYKICAgICAgICAgIGFkanVzdEVkaXRvckhlaWdodCgpOwogICAgICAgIH0pOwoKICAgICAgICAvLyDphY3nva5vYnNlcnZlcuebkeaOp+WtkOiKgueCueWPmOWMluWSjOWxnuaAp+WPmOWMlgogICAgICAgIHJlc2l6ZU9ic2VydmVyLm9ic2VydmUoY29udHJhY3RFZGl0Q29udGFpbmVyLnZhbHVlLCB7CiAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsCiAgICAgICAgICBzdWJ0cmVlOiB0cnVlLAogICAgICAgICAgYXR0cmlidXRlczogdHJ1ZQogICAgICAgIH0pOwogICAgICAgIGNvbnNvbGUubG9nKCflt7Lorr7nva5ET03lj5jljJbnm5HlkKzlmagnKTsKICAgICAgfQogICAgfTsKCiAgICAvLyDmo4Dmn6XlubbliJ3lp4vljJZRdWlsbAogICAgY29uc3QgY2hlY2tBbmRJbml0UXVpbGwgPSAoKSA9PiB7CiAgICAgIC8vIOWFiOajgOafpeaYr+WQpuW3sue7j+ebtOaOpeWPr+eUqAogICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LlF1aWxsKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnNvbGUubG9nKCdRdWlsbOW3suWKoOi9ve+8jOWIneWni+WMluaJqeWxlScpOwogICAgICAgICAgaW5pdFF1aWxsRXh0ZW5zaW9ucygpOwoKICAgICAgICAgIC8vIOWcqOWIneWni+WMluWQjua3u+WKoOWuieWFqOaAp+ajgOafpQogICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGVkaXRvckVsZW1lbnQgPSBnZXRRdWlsbEVkaXRvckVsZW1lbnQoKTsKICAgICAgICAgICAgaWYgKCFlZGl0b3JFbGVtZW50KSB7CiAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdRdWlsbOe8lui+keWZqERPTeWFg+e0oOaXoOazleiuv+mXru+8jOWPr+iDveWvvOiHtOafkOS6m+WKn+iDveS4jeWPr+eUqCcpOwogICAgICAgICAgICAgIGVuYWJsZUlubGluZVN1Z2dlc3Rpb25zLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sIDMwMCk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIneWni+WMllF1aWxs5omp5bGV5aSx6LSlOicsIGVycm9yKTsKICAgICAgICAgIGVuYWJsZUlubGluZVN1Z2dlc3Rpb25zLnZhbHVlID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8g5aaC5p6c5LiN5Y+v55So77yM5bCd6K+V5aSa56eN6YCU5b6E5Yqg6L29UXVpbGwKICAgICAgY29uc29sZS5sb2coJ1F1aWxs5pyq5Yqg6L2977yM5bCd6K+V5Yqg6L296LWE5rqQJyk7CgogICAgICAvLyDlrprkuYnlpJrkuKrlj6/og73nmoRDRE7otYTmupDot6/lvoQKICAgICAgY29uc3QgY2RuU291cmNlcyA9IFt7CiAgICAgICAganM6IGAke3dpbmRvdy5sb2NhdGlvbi5vcmlnaW59L3N0YXRpYy9saWIvcXVpbGwvcXVpbGwubWluLmpzYCwKICAgICAgICBjc3M6IGAke3dpbmRvdy5sb2NhdGlvbi5vcmlnaW59L3N0YXRpYy9saWIvcXVpbGwvcXVpbGwuc25vdy5jc3NgCiAgICAgIH0sIHsKICAgICAgICBqczogJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vcXVpbGxAMS4zLjcvZGlzdC9xdWlsbC5taW4uanMnLAogICAgICAgIGNzczogJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vcXVpbGxAMS4zLjcvZGlzdC9xdWlsbC5zbm93LmNzcycKICAgICAgfSwgewogICAgICAgIGpzOiAnaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvcXVpbGwvMS4zLjcvcXVpbGwubWluLmpzJywKICAgICAgICBjc3M6ICdodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9xdWlsbC8xLjMuNy9xdWlsbC5zbm93LmNzcycKICAgICAgfSwgewogICAgICAgIGpzOiAnaHR0cHM6Ly91bnBrZy5jb20vcXVpbGxAMS4zLjcvZGlzdC9xdWlsbC5taW4uanMnLAogICAgICAgIGNzczogJ2h0dHBzOi8vdW5wa2cuY29tL3F1aWxsQDEuMy43L2Rpc3QvcXVpbGwuc25vdy5jc3MnCiAgICAgIH1dOwoKICAgICAgLy8g6Lef6Liq5Yqg6L295bCd6K+VCiAgICAgIGxldCBjdXJyZW50U291cmNlSW5kZXggPSAwOwogICAgICBjb25zdCBtYXhSZXRyaWVzID0gY2RuU291cmNlcy5sZW5ndGg7CgogICAgICAvLyDliqDovb1DU1PotYTmupAKICAgICAgY29uc3QgbG9hZENzcyA9IHNvdXJjZSA9PiB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgIC8vIOajgOafpeaYr+WQpuW3sue7j+WKoOi9vei/hwogICAgICAgICAgY29uc3QgZXhpc3RpbmdMaW5rID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aWxsLXNub3ctY3NzJyk7CiAgICAgICAgICBpZiAoZXhpc3RpbmdMaW5rKSB7CiAgICAgICAgICAgIGRvY3VtZW50LmhlYWQucmVtb3ZlQ2hpbGQoZXhpc3RpbmdMaW5rKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGNzc0xpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaW5rJyk7CiAgICAgICAgICBjc3NMaW5rLnJlbCA9ICdzdHlsZXNoZWV0JzsKICAgICAgICAgIGNzc0xpbmsuaWQgPSAncXVpbGwtc25vdy1jc3MnOwogICAgICAgICAgY3NzTGluay5ocmVmID0gc291cmNlOwogICAgICAgICAgY3NzTGluay5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdRdWlsbCBDU1Mg5Yqg6L295oiQ5YqfOicsIHNvdXJjZSk7CiAgICAgICAgICAgIHJlc29sdmUoKTsKICAgICAgICAgIH07CiAgICAgICAgICBjc3NMaW5rLm9uZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1F1aWxsIENTUyDliqDovb3lpLHotKU6Jywgc291cmNlKTsKICAgICAgICAgICAgcmVqZWN0KCk7CiAgICAgICAgICB9OwogICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChjc3NMaW5rKTsKICAgICAgICB9KTsKICAgICAgfTsKCiAgICAgIC8vIOWKoOi9vUpT6LWE5rqQCiAgICAgIGNvbnN0IGxvYWRKcyA9IHNvdXJjZSA9PiB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgIC8vIOajgOafpeaYr+WQpuW3sue7j+WKoOi9vei/hwogICAgICAgICAgY29uc3QgZXhpc3RpbmdTY3JpcHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpbGwtanMnKTsKICAgICAgICAgIGlmIChleGlzdGluZ1NjcmlwdCkgewogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGV4aXN0aW5nU2NyaXB0KTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpOwogICAgICAgICAgc2NyaXB0LnNyYyA9IHNvdXJjZTsKICAgICAgICAgIHNjcmlwdC5pZCA9ICdxdWlsbC1qcyc7CiAgICAgICAgICBzY3JpcHQuYXN5bmMgPSB0cnVlOwogICAgICAgICAgc2NyaXB0Lm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ1F1aWxsIEpTIOWKoOi9veaIkOWKnzonLCBzb3VyY2UpOwogICAgICAgICAgICByZXNvbHZlKCk7CiAgICAgICAgICB9OwogICAgICAgICAgc2NyaXB0Lm9uZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1F1aWxsIEpTIOWKoOi9veWksei0pTonLCBzb3VyY2UpOwogICAgICAgICAgICByZWplY3QoKTsKICAgICAgICAgIH07CiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICAvLyDlsJ3or5XliqDovb3kuIvkuIDkuKrmupAKICAgICAgY29uc3QgdHJ5TmV4dFNvdXJjZSA9ICgpID0+IHsKICAgICAgICBpZiAoY3VycmVudFNvdXJjZUluZGV4ID49IG1heFJldHJpZXMpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+aJgOaciVF1aWxs6LWE5rqQ5Yqg6L295bCd6K+V6YO95aSx6LSl5LqGJyk7CiAgICAgICAgICBmYWxsYmFja1RvQmFzaWNFZGl0b3IoKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc3Qgc291cmNlID0gY2RuU291cmNlc1tjdXJyZW50U291cmNlSW5kZXhdOwogICAgICAgIGN1cnJlbnRTb3VyY2VJbmRleCsrOwogICAgICAgIGNvbnNvbGUubG9nKGDlsJ3or5XliqDovb1RdWlsbOi1hOa6kCAoJHtjdXJyZW50U291cmNlSW5kZXh9LyR7bWF4UmV0cmllc30pOmAsIHNvdXJjZSk7CgogICAgICAgIC8vIOWFiOWwneivleWKoOi9vUNTU++8jOeEtuWQjuWKoOi9vUpTCiAgICAgICAgbG9hZENzcyhzb3VyY2UuY3NzKS50aGVuKCgpID0+IGxvYWRKcyhzb3VyY2UuanMpKS50aGVuKCgpID0+IHsKICAgICAgICAgIC8vIOWKoOi9veaIkOWKn+WQjuWIneWni+WMlgogICAgICAgICAgY29uc29sZS5sb2coJ1F1aWxs6LWE5rqQ5Yqg6L295a6M5oiQ77yM5Yid5aeL5YyW5omp5bGVJyk7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICBpZiAod2luZG93LlF1aWxsKSB7CiAgICAgICAgICAgICAgICBpbml0UXVpbGxFeHRlbnNpb25zKCk7CgogICAgICAgICAgICAgICAgLy8g5aaC5p6c5Zyo5ZCI5ZCM5paH5pys5qCH562+6aG177yM5bCd6K+V5bqU55So5YaF6IGU5bu66K6uCiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlVGFiLnZhbHVlID09PSAnY29udHJhY3RUZXh0JyAmJiBlbmFibGVJbmxpbmVTdWdnZXN0aW9ucy52YWx1ZSkgewogICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGFwcGx5SW5saW5lU3VnZ2VzdGlvbnMsIDUwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1F1aWxs5pyq6IO95q2j56Gu5Yqg6L2977yM6ISa5pys5Y+v6IO95bey5omn6KGM5L2GUXVpbGzlr7nosaHmnKrlrprkuYknKTsKICAgICAgICAgICAgICAgIHRyeU5leHRTb3VyY2UoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcign5Yid5aeL5YyWUXVpbGzmianlsZXlpLHotKU6JywgZXJyb3IpOwogICAgICAgICAgICAgIHRyeU5leHRTb3VyY2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgMzAwKTsKICAgICAgICB9KS5jYXRjaCgoKSA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZygn6LWE5rqQ5Yqg6L295aSx6LSl77yM5bCd6K+V5LiL5LiA5Liq5rqQJyk7CiAgICAgICAgICB0cnlOZXh0U291cmNlKCk7CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICAvLyDpmY3nuqfliLDln7rmnKznvJbovpHlmagKICAgICAgY29uc3QgZmFsbGJhY2tUb0Jhc2ljRWRpdG9yID0gKCkgPT4gewogICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfpq5jnuqfnvJbovpHlmajliqDovb3lpLHotKXvvIzkvb/nlKjln7rmnKznvJbovpHlmajlip/og70nKTsKICAgICAgICBlbmFibGVJbmxpbmVTdWdnZXN0aW9ucy52YWx1ZSA9IGZhbHNlOwogICAgICAgIHNob3dBaVN1Z2dlc3Rpb25zLnZhbHVlID0gdHJ1ZTsKCiAgICAgICAgLy8g5re75Yqg5Z+65pys5qC35byPCiAgICAgICAgY29uc3QgaW5saW5lU3R5bGVzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgICAgICBpbmxpbmVTdHlsZXMuaWQgPSAncXVpbGwtYmFzaWMtc3R5bGVzJzsKICAgICAgICBpbmxpbmVTdHlsZXMudGV4dENvbnRlbnQgPSBgCiAgICAgICAgICAucWwtY29udGFpbmVye2JvcmRlcjoxcHggc29saWQgI2NjYztmb250LWZhbWlseTpzYW5zLXNlcmlmO30KICAgICAgICAgIC5xbC1lZGl0b3J7bWluLWhlaWdodDozMDBweDtwYWRkaW5nOjEycHggMTVweDt9CiAgICAgICAgICAucWwtdG9vbGJhcntib3JkZXItdG9wOm5vbmU7Ym9yZGVyLWxlZnQ6bm9uZTtib3JkZXItcmlnaHQ6bm9uZTtib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZTBlMGUwO2JhY2tncm91bmQtY29sb3I6I2Y4ZjlmYTt9CiAgICAgICAgYDsKICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGlubGluZVN0eWxlcyk7CiAgICAgIH07CgogICAgICAvLyDlvIDlp4vlsJ3or5XliqDovb0KICAgICAgdHJ5TmV4dFNvdXJjZSgpOwogICAgfTsKCiAgICAvLyDlnKhtb3VudGVk6ZKp5a2Q5Lit6K+75Y+W5pys5Zyw5a2Y5YKo55qE5pyv6K+tCiAgICBvbk1vdW50ZWQoKCkgPT4gewogICAgICAvLyDliqDovb3lkIjlkIzor6bmg4UKICAgICAgZ2V0Q29udHJhY3REZXRhaWxzKCk7CgogICAgICAvLyDliqDovb3mnKzlnLDlrZjlgqjnmoToh6rlrprkuYnmnK/or60KICAgICAgY29uc3Qgc2F2ZWRUZXJtaW5vbG9naWVzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2N1c3RvbVRlcm1pbm9sb2dpZXMnKTsKICAgICAgaWYgKHNhdmVkVGVybWlub2xvZ2llcykgewogICAgICAgIHRyeSB7CiAgICAgICAgICBjdXN0b21UZXJtaW5vbG9naWVzLnZhbHVlID0gSlNPTi5wYXJzZShzYXZlZFRlcm1pbm9sb2dpZXMpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+ino+aekOWtmOWCqOeahOacr+ivreWHuumUmTonLCBlKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIOivu+WPluacrOWcsOWtmOWCqOeahOa2puiJsuWBj+WlvQogICAgICBjb25zdCBzYXZlZFByZWZlcmVuY2VzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3BvbGlzaFByZWZlcmVuY2VzJyk7CiAgICAgIGlmIChzYXZlZFByZWZlcmVuY2VzKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IHByZWZlcmVuY2VzID0gSlNPTi5wYXJzZShzYXZlZFByZWZlcmVuY2VzKTsKICAgICAgICAgIC8vIOehruS/nWZvY3Vz5piv5pWw57uE57G75Z6LCiAgICAgICAgICBpZiAocHJlZmVyZW5jZXMuZm9jdXMgJiYgIUFycmF5LmlzQXJyYXkocHJlZmVyZW5jZXMuZm9jdXMpKSB7CiAgICAgICAgICAgIHByZWZlcmVuY2VzLmZvY3VzID0gWydncmFtbWFyJywgJ3Rlcm1pbm9sb2d5J107CiAgICAgICAgICB9CiAgICAgICAgICBPYmplY3QuYXNzaWduKHBvbGlzaFByZWZlcmVuY2VzLCBwcmVmZXJlbmNlcyk7CiAgICAgICAgICBjb25zb2xlLmxvZygn5bey5Yqg6L295ram6Imy5YGP5aW96K6+572uOicsIHBvbGlzaFByZWZlcmVuY2VzKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfop6PmnpDlrZjlgqjnmoTmtqboibLlgY/lpb3lh7rplJk6JywgZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyDor7vlj5bmnKzlnLDlrZjlgqjnmoTmo4Dmn6XlgY/lpb0KICAgICAgY29uc3Qgc2F2ZWRDaGVja1ByZWZlcmVuY2VzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2NoZWNrUHJlZmVyZW5jZXMnKTsKICAgICAgaWYgKHNhdmVkQ2hlY2tQcmVmZXJlbmNlcykgewogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCBwcmVmZXJlbmNlcyA9IEpTT04ucGFyc2Uoc2F2ZWRDaGVja1ByZWZlcmVuY2VzKTsKICAgICAgICAgIE9iamVjdC5hc3NpZ24oY2hlY2tQcmVmZXJlbmNlcywgcHJlZmVyZW5jZXMpOwogICAgICAgICAgY29uc29sZS5sb2coJ+W3suWKoOi9veajgOafpeWBj+Wlveiuvue9rjonLCBjaGVja1ByZWZlcmVuY2VzKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfop6PmnpDlrZjlgqjnmoTmo4Dmn6XlgY/lpb3lh7rplJk6JywgZSk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyDosIPmlbTnvJbovpHlmajpq5jluqYKICAgICAgbmV4dFRpY2soKCkgPT4gewogICAgICAgIGFkanVzdEVkaXRvckhlaWdodCgpOwogICAgICAgIHNldHVwTXV0YXRpb25PYnNlcnZlcigpOwogICAgICAgIHNldHVwUmVzaXplTGlzdGVuZXIoKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICAvLyDnm5HlkKzmtqboibLlgY/lpb3lj5jljJbvvIzkv53lrZjliLDmnKzlnLDlrZjlgqgKICAgIHdhdGNoKHBvbGlzaFByZWZlcmVuY2VzLCBuZXdQcmVmZXJlbmNlcyA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCfkv53lrZjmtqboibLlgY/lpb06JywgbmV3UHJlZmVyZW5jZXMpOwogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncG9saXNoUHJlZmVyZW5jZXMnLCBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgc3R5bGU6IG5ld1ByZWZlcmVuY2VzLnN0eWxlLAogICAgICAgIGNvbnRyYWN0VHlwZTogbmV3UHJlZmVyZW5jZXMuY29udHJhY3RUeXBlLAogICAgICAgIGZvY3VzOiBuZXdQcmVmZXJlbmNlcy5mb2N1cwogICAgICB9KSk7CiAgICB9LCB7CiAgICAgIGRlZXA6IHRydWUKICAgIH0pOwoKICAgIC8vIOebkeWQrOWQiOWQjOWGheWuueWPmOWMlu+8jOW7tui/n+aJp+ihjOWIhuaekAogICAgd2F0Y2goKCkgPT4gY29udHJhY3REZXRhaWxzLmNvbnRlbnQsIChuZXdDb250ZW50LCBvbGRDb250ZW50KSA9PiB7CiAgICAgIGlmIChuZXdDb250ZW50ICYmIG5ld0NvbnRlbnQgIT09IG9sZENvbnRlbnQgJiYgbmV3Q29udGVudCAhPT0gbGFzdEFuYWx5emVkQ29udGVudC52YWx1ZSkgewogICAgICAgIGRlYm91bmNlZEFuYWx5emVUZXh0KCk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIOebkeWQrOajgOafpeWBj+Wlveiuvue9ruWPmOWMlu+8jOS/neWtmOWIsOacrOWcsAogICAgd2F0Y2goY2hlY2tQcmVmZXJlbmNlcywgbmV3UHJlZmVyZW5jZXMgPT4gewogICAgICBjb25zb2xlLmxvZygn5L+d5a2Y5qOA5p+l5YGP5aW9OicsIG5ld1ByZWZlcmVuY2VzKTsKICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NoZWNrUHJlZmVyZW5jZXMnLCBKU09OLnN0cmluZ2lmeShuZXdQcmVmZXJlbmNlcykpOwogICAgfSwgewogICAgICBkZWVwOiB0cnVlCiAgICB9KTsKCiAgICAvLyDlnKjnu4Tku7bljbjovb3liY3muIXnkIbmiYDmnInkuovku7bnm5HlkKwKICAgIG9uQmVmb3JlVW5tb3VudCgoKSA9PiB7CiAgICAgIC8vIOa4heeQhueql+WPo+iwg+aVtOWkp+Wwj+S6i+S7tgogICAgICBjbGVhbnVwUmVzaXplTGlzdGVuZXIoKTsKCiAgICAgIC8vIOa4heeQhumhtemdouWPr+ingeaAp+WPmOWMluebkeWQrAogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCd2aXNpYmlsaXR5Y2hhbmdlJywgKCkgPT4ge30pOwoKICAgICAgLy8g5riF55CGRE9N5Y+Y5YyW6KeC5a+f5ZmoCiAgICAgIGlmIChyZXNpemVPYnNlcnZlcikgewogICAgICAgIHJlc2l6ZU9ic2VydmVyLmRpc2Nvbm5lY3QoKTsKICAgICAgfQogICAgICBjb25zb2xlLmxvZygn57uE5Lu25Y2z5bCG5Y246L2977yM5bey5riF55CG5omA5pyJ5LqL5Lu255uR5ZCs5ZmoJyk7CiAgICB9KTsKICAgIHJldHVybiB7CiAgICAgIGFjdGl2ZVRhYiwKICAgICAgYWN0aXZlQ29sbGFwc2UsCiAgICAgIGFjdGl2ZVN1Z2dlc3Rpb25Db2xsYXBzZSwKICAgICAgY29udHJhY3RJZCwKICAgICAgY29udHJhY3REZXRhaWxzLAogICAgICBjb250cmFjdFRpdGxlLAogICAgICBjaGVja1Jlc3VsdCwKICAgICAgYWlTdWdnZXN0aW9ucywKICAgICAgY29udHJhY3RIaXN0b3J5LAogICAgICBwb2xpc2hQcmVmZXJlbmNlcywKICAgICAgY2hlY2tQcmVmZXJlbmNlcywKICAgICAgY3VzdG9tVGVybWlub2xvZ2llcywKICAgICAgbmV3VGVybWlub2xvZ3ksCiAgICAgIGFkZEN1c3RvbVRlcm1pbm9sb2d5LAogICAgICByZW1vdmVDdXN0b21UZXJtaW5vbG9neSwKICAgICAgaXNDaGVja2luZywKICAgICAgcXVpbGxFZGl0b3IsCiAgICAgIGVkaXRvck9wdGlvbiwKICAgICAgc2hvd0FpU3VnZ2VzdGlvbnMsCiAgICAgIGdvQmFjaywKICAgICAgc2F2ZUNoYW5nZXMsCiAgICAgIGlzTG9hZGluZywKICAgICAgaXNTYXZpbmcsCiAgICAgIGlzUmVhbFRpbWVQb2xpc2hpbmcsCiAgICAgIHJlYWxUaW1lUG9saXNoTG9hZGluZywKICAgICAgdG9nZ2xlQWlQYW5lbENvbGxhcHNlLAogICAgICBpc0FpUGFuZWxDb2xsYXBzZWQsCiAgICAgIGFkb3B0SW5saW5lRWRpdFN1Z2dlc3Rpb24sCiAgICAgIGlnbm9yZUlubGluZUVkaXRTdWdnZXN0aW9uLAogICAgICBhcHBseUlubGluZVN1Z2dlc3Rpb25zLAogICAgICBlbmFibGVJbmxpbmVTdWdnZXN0aW9ucywKICAgICAgb25JbmxpbmVTdWdnZXN0aW9uc1RvZ2dsZSwKICAgICAgZGVib3VuY2VkQW5hbHl6ZVRleHQsCiAgICAgIGNsZWFySW5saW5lRWRpdFN1Z2dlc3Rpb25zLAogICAgICBzaG93U3VnZ2VzdGlvblRvb2x0aXAsCiAgICAgIGdlbmVyYXRlRGlmZiwKICAgICAgbWFudWFsQW5hbHl6ZVRleHQsCiAgICAgIGVzdGltYXRlZFRpbWUsCiAgICAgIHN0YXJ0Q29udHJhY3RDaGVjaywKICAgICAgLy8g5re75Yqg5ZCI5ZCM5qOA5p+l5Ye95pWwCiAgICAgIHZpZXdSZWd1bGF0aW9uLAogICAgICBkb3dubG9hZENvbnRyYWN0LAogICAgICBhZG9wdFN1Z2dlc3Rpb24sCiAgICAgIGlnbm9yZVN1Z2dlc3Rpb24sCiAgICAgIGFwcGx5QWxsU3VnZ2VzdGlvbnMsCiAgICAgIGhpZGVBaVBhbmVsLAogICAgICAvLyDmt7vliqDlvJXnlKjlj5jph48KICAgICAgY29udHJhY3RFZGl0Q29udGFpbmVyLAogICAgICBhaVBvbGlzaFNpZGViYXIsCiAgICAgIGVkaXRvck1haW5BcmVhLAogICAgICBjb250cmFjdENoZWNrQ29udGFpbmVyLAogICAgICAvLyDlkIjlkIzmo4Dmn6XlrrnlmajlvJXnlKgKICAgICAgY2hlY2tTaWRlYmFyLAogICAgICAvLyDmo4Dmn6XkvqfovrnmoI/lvJXnlKgKICAgICAgY2hlY2tSZXN1bHRBcmVhIC8vIOajgOafpee7k+aenOWMuuWfn+W8leeUqAogICAgfTsKICB9Cn07"},{"version":3,"names":["ref","reactive","onMounted","computed","watch","onUnmounted","nextTick","onBeforeUnmount","useRoute","useRouter","ElMessage","ElLoading","ElMessageBox","Download","DocumentAdd","MagicStick","Check","Warning","WarningFilled","Document","InfoFilled","Edit","Reading","Close","Loading","ArrowRight","ArrowLeft","Timer","Position","Setting","DocumentChecked","Notebook","Plus","getContractDetail","updateContract","checkContract","aiPolishContract","request","QuillEditor","debounce","SuggestionBlot","SuggestionModule","initQuillExtensions","window","Quill","console","error","InlineSuggestionBlot","import","create","value","node","setAttribute","id","original","suggested","title","style","position","backgroundColor","borderBottom","padding","cursor","formats","getAttribute","blotName","tagName","register","constructor","quill","options","suggestions","container","document","createElement","className","display","body","appendChild","on","update","_clickListener","e","target","classList","contains","showTooltip","hideTooltip","root","addEventListener","observer","MutationObserver","mutations","mutation","type","observe","childList","subtree","characterData","element","rect","getBoundingClientRect","innerHTML","_generateDiff","top","bottom","scrollY","left","scrollX","adoptBtn","querySelector","ignoreBtn","_adoptListener","removeEventListener","_ignoreListener","onAdopt","onIgnore","words1","split","words2","firstDiff","length","lastDiff1","lastDiff2","prefix","slice","join","suffix1","diff1","diff2","applySuggestions","clearAllSuggestionFormats","forEach","suggestion","content","getText","index","indexOf","formatText","destroy","disconnect","parentNode","removeChild","name","components","setup","route","router","contractId","params","isNaN","Number","activeTab","activeCollapse","activeSuggestionCollapse","polishPreferences","contractType","focus","checkPreferences","legalCompliance","completeness","riskAlert","checkDepth","customTerminologies","newTerminology","term","addCustomTerminology","trim","includes","push","localStorage","setItem","JSON","stringify","success","warning","removeCustomTerminology","splice","isChecking","quillEditor","showAiSuggestions","isLoading","isSaving","contractEditContainer","aiPolishSidebar","editorMainArea","contractCheckContainer","checkSidebar","checkResultArea","isRealTimePolishing","realTimePolishLoading","lastAnalyzedContent","lastAnalysisTime","enableInlineSuggestions","isAiPanelCollapsed","toggleAiPanelCollapse","editorOption","placeholder","modules","toolbar","suggestionId","adoptInlineEditSuggestion","ignoreInlineEditSuggestion","contractDetails","number","amount","company","signDate","startDate","expireDate","status","created_by","created_at","updated_at","attachments","actions","contractTitle","checkResult","totalIssues","criticalIssues","warningIssues","legalComplianceIssues","completenessIssues","riskAlerts","aiSuggestions","syntax","terminology","contractHistory","_contractDetails$acti","map","action","_action$user","time","user","username","description","getContractDetails","loadSilently","log","response","contractData","data","Object","keys","key","sign_date","start_date","expire_date","toLocaleString","goBack","saveChanges","loading","service","lock","text","background","formatDate","date","test","parsedDate","Date","getTime","formatDateObject","dateObj","year","getFullYear","month","String","getMonth","padStart","day","getDate","updateData","toString","replace","close","startContractCheck","height","getElementById","getComputedStyle","overflow","setTimeout","scrollWrapper","scrollStyle","loadingInstance","info","requestParams","preferences","contract_type","check_depth","check_areas","startTime","toLocaleTimeString","result","endTime","statusText","message","estimatedTime","charCount","manualAnalyzeText","timeoutPromise","Promise","_","reject","Error","now","is_manual","custom_terminologies","race","filterBasicInfoSuggestions","Array","isArray","basicInfoKeywords","filter","some","keyword","explanation","s","i","applyInlineSuggestions","totalSuggestions","timeoutErr","confirm","confirmButtonText","cancelButtonText","then","catch","debouncedAnalyzeText","adjustEditorHeight","viewHeight","innerHeight","marginBottom","containerRect","topOffset","containerHeight","Math","max","getQuill","warn","setupResizeListener","visibilityState","cleanupResizeListener","newTab","setupMutationObserver","resizeObserver","hideAiPanel","adoptSuggestion","lowerContent","toLowerCase","lowerOriginal","startIndex","actualOriginalText","substring","tempDiv","plainText","textContent","innerText","escapedOriginal","regex","RegExp","normalizeText","normalizedContent","normalizedOriginal","pattern","looseRegex","ignoreSuggestion","applyAllSuggestions","hasChanges","smartReplace","newContent","matched","successCount","failCount","allSuggestions","downloadContract","downloadUrl","getCookie","cookie","parts","pop","shift","csrfToken","token","getItem","url","method","responseType","headers","blob","Blob","URL","createObjectURL","link","href","download","click","revokeObjectURL","finally","viewRegulation","issue","issue_title","issue_content","current","issue_problem","problem","alert","regulation","regulation_content","dangerouslyUseHTMLString","customClass","newRouteName","oldRouteName","immediate","newId","oldId","numNewId","numOldId","silentLoad","readyState","addFloatingButton","existingButton","button","head","updateFloatingButton","suggestionType","suggestionIndex","syntaxIndex","findIndex","termIndex","editor","deleteText","insertText","getQuillEditorElement","$el","clearInlineEditSuggestions","editorContainer","highlights","querySelectorAll","span","parent","textNode","createTextNode","replaceChild","tooltipContainer","walker","createTreeWalker","NodeFilter","SHOW_TEXT","currentNode","currentIndex","found","nextNode","nodeText","nodeValue","nodeLength","startOffset","range","createRange","setStart","setEnd","surroundContents","showSuggestionTooltip","rangeError","diffHtml","enhancedDiffDisplay","generateDiff","escapeHtml","zIndex","maxWidth","boxShadow","border","borderRadius","closeBtn","clickOutsideHandler","unsafe","tokenize","tokens1","tokens2","html","Set","commonParts","i1","j1","has","index1","index2","add","sort","a","b","lastIndex1","lastIndex2","part","k","onInlineSuggestionsToggle","setupKeyboardShortcuts","handleKeyDown","ctrlKey","shiftKey","preventDefault","flexDirection","flex","overflowY","checkAndInitQuill","cleanupShortcuts","keyboardShortcutsCleanup","handleVisibilityChange","hidden","tooltip","styleElem","suggestionModule","getModule","attributes","editorElement","cdnSources","js","location","origin","css","currentSourceIndex","maxRetries","loadCss","source","resolve","existingLink","cssLink","rel","onload","onerror","loadJs","existingScript","script","src","async","tryNextSource","fallbackToBasicEditor","inlineStyles","savedTerminologies","parse","savedPreferences","assign","savedCheckPreferences","newPreferences","deep","oldContent"],"sources":["C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\contract\\Detail.vue"],"sourcesContent":["<template>\n  <div class=\"contract-detail-container\">\n    <div class=\"card\" v-loading=\"isLoading\">\n      <div class=\"card-header d-flex justify-content-between align-items-center\">\n        <span id=\"contractTitleHeader\">{{ contractTitle }}</span>\n        <div>\n          <el-button type=\"default\" size=\"small\" class=\"me-2\" @click=\"downloadContract\">\n            <el-icon><Download /></el-icon> Word\n          </el-button>\n          <el-button \n            type=\"primary\" \n            size=\"small\" \n            @click=\"saveChanges\" \n            :loading=\"isSaving\"\n          >\n            <el-icon><DocumentAdd /></el-icon> \n          </el-button>\n        </div>\n      </div>\n      <div class=\"card-body\">\n        <el-tabs v-model=\"activeTab\" class=\"contract-detail-tabs\">\n          <el-tab-pane label=\"\" name=\"basicInfo\">\n            <h5></h5>\n            <div class=\"row mb-3\">\n              <div class=\"col-md-6\">\n                <el-form label-position=\"top\">\n                  <el-form-item label=\"\">\n                    <el-input v-model=\"contractDetails.title\"></el-input>\n                  </el-form-item>\n                  <el-form-item label=\"\">\n                    <el-input v-model=\"contractDetails.number\" disabled></el-input>\n                  </el-form-item>\n                  <el-form-item label=\"\">\n                    <el-select v-model=\"contractDetails.type\" style=\"width: 100%;\">\n                      <el-option label=\"\" value=\"\"></el-option>\n                      <el-option label=\"\" value=\"\"></el-option>\n                      <el-option label=\"\" value=\"\"></el-option>\n                      <el-option label=\"\" value=\"\"></el-option>\n                      <el-option label=\"\" value=\"\"></el-option>\n                      <el-option label=\"\" value=\"\"></el-option>\n                    </el-select>\n                  </el-form-item>\n                  <el-form-item label=\"\">\n                    <el-input v-model=\"contractDetails.amount\" prefix=\"\"></el-input>\n                  </el-form-item>\n                </el-form>\n              </div>\n              <div class=\"col-md-6\">\n                <el-form label-position=\"top\">\n                  <el-form-item label=\"\">\n                    <el-input v-model=\"contractDetails.company\"></el-input>\n                  </el-form-item>\n                  <el-form-item label=\"\">\n                    <el-date-picker \n                      v-model=\"contractDetails.signDate\" \n                      type=\"date\" \n                      style=\"width: 100%;\">\n                    </el-date-picker>\n                  </el-form-item>\n                  <el-form-item label=\"\">\n                    <el-date-picker \n                      v-model=\"contractDetails.startDate\" \n                      type=\"date\" \n                      style=\"width: 100%;\">\n                    </el-date-picker>\n                  </el-form-item>\n                  <el-form-item label=\"\">\n                    <el-date-picker \n                      v-model=\"contractDetails.expireDate\" \n                      type=\"date\" \n                      style=\"width: 100%;\">\n                    </el-date-picker>\n                  </el-form-item>\n                </el-form>\n              </div>\n            </div>\n          </el-tab-pane>\n\n          <el-tab-pane label=\"\" name=\"contractText\">\n            <div class=\"d-flex justify-content-between align-items-center mb-2\">\n              <h5></h5>\n              <div class=\"d-flex align-items-center\">\n                <el-tooltip content=\"/\" placement=\"top\">\n                  <el-switch \n                    v-model=\"enableInlineSuggestions\" \n                    size=\"small\" \n                    active-text=\"\" \n                    style=\"margin-right: 15px;\"\n                    @change=\"onInlineSuggestionsToggle\"\n                  />\n                </el-tooltip>\n              <div v-if=\"realTimePolishLoading\" class=\"d-flex align-items-center\">\n                <el-icon class=\"is-loading\"><Loading /></el-icon>\n                <span class=\"ms-1\">AI...</span>\n              </div>\n            </div>\n            </div>\n            \n            <!-- flexAIrefJS -->\n            <div class=\"contract-edit-wrapper\">\n              <!-- badge -->\n              \n              <div class=\"contract-edit-container\" ref=\"contractEditContainer\">\n                <!-- AI -->\n                <div class=\"ai-polish-sidebar\" ref=\"aiPolishSidebar\">\n                  <el-button \n                    type=\"primary\" \n                    size=\"large\" \n                    @click=\"manualAnalyzeText\" \n                    :loading=\"realTimePolishLoading\"\n                    :disabled=\"realTimePolishLoading\"\n                    class=\"ai-polish-button\"\n                  >\n                    <div class=\"ai-polish-button-content\">\n                      <el-icon class=\"ai-polish-icon no-bg\"><MagicStick /></el-icon>\n                      <span>{{ realTimePolishLoading ? '...' : 'AI' }}</span>\n                    </div>\n                  </el-button>\n                  \n                  <div class=\"ai-polish-info\">\n                    <div class=\"time-estimate\" v-if=\"!realTimePolishLoading\">\n                      <el-icon><Timer /></el-icon>\n                      <span>: {{ estimatedTime }}</span>\n                    </div>\n                    <div class=\"shortcut-hint\">\n                      <el-icon><Position /></el-icon>\n                      <span>: Ctrl+Shift+A</span>\n                    </div>\n                  </div>\n                  \n                  <!--  -->\n                  <div class=\"ai-polish-personalization\">\n                    <h6 class=\"personalization-title\"></h6>\n                    \n                    <div class=\"personalization-section\">\n                      <div class=\"section-header\">\n                        <el-icon><Setting /></el-icon>\n                        <span></span>\n                      </div>\n                      \n                      <div class=\"preference-option\">\n                        <span></span>\n                        <el-select v-model=\"polishPreferences.style\" size=\"small\" placeholder=\"\">\n                          <el-option label=\"\" value=\"formal\"></el-option>\n                          <el-option label=\"\" value=\"neutral\"></el-option>\n                          <el-option label=\"\" value=\"concise\"></el-option>\n                        </el-select>\n                      </div>\n                      \n                      <div class=\"preference-option\">\n                        <span></span>\n                        <el-select v-model=\"polishPreferences.contractType\" size=\"small\" placeholder=\"\">\n                          <el-option label=\"\" value=\"general\"></el-option>\n                          <el-option label=\"\" value=\"sales\"></el-option>\n                          <el-option label=\"\" value=\"labor\"></el-option>\n                          <el-option label=\"\" value=\"lease\"></el-option>\n                          <el-option label=\"\" value=\"technology\"></el-option>\n                        </el-select>\n                      </div>\n                    </div>\n                    \n                    <div class=\"personalization-section\">\n                      <div class=\"section-header\">\n                        <el-icon><DocumentChecked /></el-icon>\n                        <span></span>\n                      </div>\n                      \n                      <div class=\"optimization-options\">\n                        <el-checkbox-group v-model=\"polishPreferences.focus\">\n                          <el-checkbox label=\"grammar\"></el-checkbox>\n                          <el-checkbox label=\"terminology\"></el-checkbox>\n                          <el-checkbox label=\"structure\"></el-checkbox>\n                          <el-checkbox label=\"consistency\"></el-checkbox>\n                        </el-checkbox-group>\n                      </div>\n                    </div>\n                    \n                    <div class=\"personalization-section\">\n                      <div class=\"section-header\">\n                        <el-icon><Notebook /></el-icon>\n                        <span></span>\n                      </div>\n                      \n                      <div class=\"terminology-manager\">\n                        <el-input\n                          v-model=\"newTerminology.term\"\n                          size=\"small\"\n                          placeholder=\"\"\n                          class=\"terminology-input\"\n                        >\n                          <template #append>\n                            <el-button @click=\"addCustomTerminology\">\n                              <el-icon><Plus /></el-icon>\n                            </el-button>\n                          </template>\n                        </el-input>\n                        \n                        <div class=\"terminology-list\" v-if=\"customTerminologies.length > 0\">\n                          <el-tag\n                            v-for=\"(term, index) in customTerminologies\"\n                            :key=\"index\"\n                            closable\n                            @close=\"removeCustomTerminology(index)\"\n                            class=\"terminology-tag\"\n                          >\n                            {{term}}\n                          </el-tag>\n                        </div>\n                        <div v-else class=\"terminology-empty\">\n                          <span class=\"text-muted\"></span>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div class=\"ai-polish-features\">\n                    <div class=\"feature-item\">\n                      <el-icon><Check /></el-icon>\n                      <span></span>\n                    </div>\n                    <div class=\"feature-item\">\n                      <el-icon><Check /></el-icon>\n                      <span></span>\n                    </div>\n                    <div class=\"feature-item\">\n                      <el-icon><Check /></el-icon>\n                      <span></span>\n                    </div>\n                    <div class=\"feature-item\">\n                      <el-icon><Check /></el-icon>\n                      <span></span>\n                    </div>\n                  </div>\n                </div>\n                \n                <!--  -->\n                <div class=\"editor-main-area\" ref=\"editorMainArea\">\n                  <QuillEditor\n                    v-model:content=\"contractDetails.content\"\n                    ref=\"quillEditor\"\n                    :toolbar=\"editorOption.modules.toolbar\"\n                    contentType=\"html\"\n                    class=\"contract-text-editor\"\n                    theme=\"snow\"\n                  />\n                </div>\n              </div>\n            </div>\n          </el-tab-pane>\n\n          <el-tab-pane label=\"\" name=\"contractCheck\">\n            <div class=\"d-flex justify-content-between align-items-center mb-3\">\n              <h5></h5>\n            </div>\n\n            <!--  -->\n            <div class=\"contract-edit-wrapper\">\n              <div class=\"contract-edit-container\" ref=\"contractCheckContainer\">\n                <!--  -->\n                <div class=\"ai-polish-sidebar check-sidebar\" ref=\"checkSidebar\">\n                  <el-button \n                    type=\"primary\" \n                    size=\"large\" \n                    @click=\"startContractCheck\" \n                    :loading=\"isChecking\"\n                    :disabled=\"isChecking\"\n                    class=\"ai-polish-button\"\n                  >\n                    <div class=\"ai-polish-button-content\">\n                      <el-icon class=\"ai-polish-icon no-bg\"><DocumentChecked /></el-icon>\n                      <span>{{ isChecking ? '...' : 'AI' }}</span>\n                    </div>\n                  </el-button>\n                  \n                  <div class=\"ai-polish-info\">\n                    <div class=\"time-estimate\" v-if=\"!isChecking\">\n                      <el-icon><Timer /></el-icon>\n                      <span>: {{ estimatedTime }}</span>\n                    </div>\n                    <div class=\"shortcut-hint\">\n                      <el-icon><Position /></el-icon>\n                      <span>: Ctrl+Shift+C</span>\n                    </div>\n                  </div>\n                  \n                  <!--  -->\n                  <div class=\"ai-polish-personalization\">\n                    <h6 class=\"personalization-title\"></h6>\n                    \n                    <div class=\"personalization-section\">\n                      <div class=\"section-header\">\n                        <el-icon><Setting /></el-icon>\n                        <span></span>\n                      </div>\n                      \n                      <div class=\"check-options\">\n                        <el-checkbox v-model=\"checkPreferences.legalCompliance\"></el-checkbox>\n                        <el-checkbox v-model=\"checkPreferences.completeness\"></el-checkbox>\n                        <el-checkbox v-model=\"checkPreferences.riskAlert\"></el-checkbox>\n                      </div>\n                    </div>\n                    \n                    <div class=\"personalization-section\">\n                      <div class=\"section-header\">\n                        <el-icon><Reading /></el-icon>\n                        <span></span>\n                      </div>\n                      \n                      <div class=\"preference-option\">\n                        <span></span>\n                        <el-select v-model=\"checkPreferences.contractType\" size=\"small\" placeholder=\"\">\n                          <el-option label=\"\" value=\"general\"></el-option>\n                          <el-option label=\"\" value=\"sales\"></el-option>\n                          <el-option label=\"\" value=\"labor\"></el-option>\n                          <el-option label=\"\" value=\"lease\"></el-option>\n                          <el-option label=\"\" value=\"technology\"></el-option>\n                        </el-select>\n                      </div>\n                    </div>\n                    \n                    <div class=\"personalization-section\">\n                      <div class=\"section-header\">\n                        <el-icon><InfoFilled /></el-icon>\n                        <span></span>\n                      </div>\n                      \n                      <div class=\"preference-option\">\n                        <span></span>\n                        <el-select v-model=\"checkPreferences.checkDepth\" size=\"small\" placeholder=\"\">\n                          <el-option label=\"\" value=\"standard\"></el-option>\n                          <el-option label=\"\" value=\"deep\"></el-option>\n                          <el-option label=\"\" value=\"quick\"></el-option>\n                        </el-select>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div class=\"ai-polish-features\">\n                    <div class=\"feature-item\">\n                      <el-icon><Check /></el-icon>\n                      <span></span>\n                    </div>\n                    <div class=\"feature-item\">\n                      <el-icon><Check /></el-icon>\n                      <span></span>\n                    </div>\n                    <div class=\"feature-item\">\n                      <el-icon><Check /></el-icon>\n                      <span></span>\n                    </div>\n                    <div class=\"feature-item\">\n                      <el-icon><Check /></el-icon>\n                      <span></span>\n                    </div>\n                  </div>\n                </div>\n                \n                <!--  -->\n                <div class=\"editor-main-area check-result-area\" ref=\"checkResultArea\">\n                  <!-- Element UIel-scrollbar -->\n                  <el-scrollbar height=\"calc(100% - 10px)\" always class=\"contract-check-scrollbar\">\n                    <div class=\"check-content-inner\" style=\"padding: 15px 20px;\">\n                      <!--  -->\n                      <div class=\"check-result-card\">\n                        <div class=\"check-result-header\">\n                          <h6></h6>\n                          <el-tag v-if=\"checkResult.totalIssues > 0\" type=\"danger\" size=\"small\">{{ checkResult.totalIssues }}</el-tag>\n                          <el-tag v-else type=\"success\" size=\"small\"></el-tag>\n                        </div>\n                        \n                        <div class=\"check-result-stats\">\n                          <div class=\"stat-item\">\n                            <div class=\"stat-value danger\">{{ checkResult.criticalIssues }}</div>\n                            <div class=\"stat-label\"></div>\n                          </div>\n                          <div class=\"stat-item\">\n                            <div class=\"stat-value warning\">{{ checkResult.warningIssues }}</div>\n                            <div class=\"stat-label\"></div>\n                          </div>\n                          <div class=\"stat-item\">\n                            <div class=\"stat-value info\">{{ checkResult.suggestions }}</div>\n                            <div class=\"stat-label\"></div>\n                          </div>\n                          <div class=\"stat-item\">\n                            <div class=\"stat-value\">{{ checkResult.totalIssues }}</div>\n                            <div class=\"stat-label\"></div>\n                          </div>\n                        </div>\n                      </div>\n                      \n                      <!--  -->\n                      <div class=\"check-result-details\">\n                        <el-collapse v-model=\"activeCollapse\" class=\"check-collapse\">\n                          <el-collapse-item title=\"\" name=\"legalCompliance\">\n                            <template #title>\n                              <div class=\"collapse-header\">\n                                <el-icon class=\"text-danger\"><WarningFilled /></el-icon>\n                                <span></span>\n                                <el-badge :value=\"checkResult.legalComplianceIssues.length\" type=\"danger\" class=\"ms-2\" v-if=\"checkResult.legalComplianceIssues.length > 0\"></el-badge>\n                              </div>\n                            </template>\n                            \n                            <div v-if=\"checkResult.legalComplianceIssues.length === 0\" class=\"empty-result\">\n                              <el-empty description=\"\" :image-size=\"80\"></el-empty>\n                            </div>\n                            \n                            <div v-for=\"(issue, index) in checkResult.legalComplianceIssues\" :key=\"'legal-'+index\" class=\"check-issue-card\">\n                              <div class=\"issue-header\">\n                                <el-icon class=\"text-danger fs-4\"><WarningFilled /></el-icon>\n                                <h6>{{ issue.title }}</h6>\n                              </div>\n                              <div class=\"issue-content\">\n                                <div class=\"issue-field\">\n                                  <div class=\"field-label\"></div>\n                                  <div class=\"field-value\">{{ issue.current }}</div>\n                                </div>\n                                <div class=\"issue-field\">\n                                  <div class=\"field-label\"></div>\n                                  <div class=\"field-value text-danger\">{{ issue.problem }}</div>\n                                </div>\n                              </div>\n                              <div class=\"issue-actions\">\n                                <el-button size=\"small\" type=\"primary\" @click=\"viewRegulation(issue)\"></el-button>\n                                <el-button size=\"small\" type=\"default\"></el-button>\n                              </div>\n                            </div>\n                          </el-collapse-item>\n\n                          <el-collapse-item title=\"\" name=\"clauseCompleteness\">\n                            <template #title>\n                              <div class=\"collapse-header\">\n                                <el-icon class=\"text-warning\"><Document /></el-icon>\n                                <span></span>\n                                <el-badge :value=\"checkResult.completenessIssues.length\" type=\"warning\" class=\"ms-2\" v-if=\"checkResult.completenessIssues.length > 0\"></el-badge>\n                              </div>\n                            </template>\n                            \n                            <div v-if=\"checkResult.completenessIssues.length === 0\" class=\"empty-result\">\n                              <el-empty description=\"\" :image-size=\"80\"></el-empty>\n                            </div>\n                            \n                            <div v-for=\"(issue, index) in checkResult.completenessIssues\" :key=\"'comp-'+index\" class=\"check-issue-card\">\n                              <div class=\"issue-header\">\n                                <el-icon class=\"text-warning fs-4\"><Warning /></el-icon>\n                                <h6>{{ issue.title }}</h6>\n                              </div>\n                              <div class=\"issue-content\">\n                                <div class=\"issue-field\">\n                                  <div class=\"field-label\"></div>\n                                  <div class=\"field-value\">{{ issue.suggestion }}</div>\n                                </div>\n                              </div>\n                              <div class=\"issue-actions\">\n                                <el-button size=\"small\" type=\"default\"></el-button>\n                              </div>\n                            </div>\n                          </el-collapse-item>\n\n                          <el-collapse-item title=\"\" name=\"riskAlert\">\n                            <template #title>\n                              <div class=\"collapse-header\">\n                                <el-icon class=\"text-info\"><InfoFilled /></el-icon>\n                                <span></span>\n                                <el-badge :value=\"checkResult.riskAlerts.length\" type=\"info\" class=\"ms-2\" v-if=\"checkResult.riskAlerts.length > 0\"></el-badge>\n                              </div>\n                            </template>\n                            \n                            <div v-if=\"checkResult.riskAlerts.length === 0\" class=\"empty-result\">\n                              <el-empty description=\"\" :image-size=\"80\"></el-empty>\n                            </div>\n                            \n                            <div v-for=\"(issue, index) in checkResult.riskAlerts\" :key=\"'risk-'+index\" class=\"check-issue-card\">\n                              <div class=\"issue-header\">\n                                <el-icon class=\"text-info fs-4\"><InfoFilled /></el-icon>\n                                <h6>{{ issue.title }}</h6>\n                              </div>\n                              <div class=\"issue-content\">\n                                <div class=\"issue-field\">\n                                  <div class=\"field-label\"></div>\n                                  <div class=\"field-value\">{{ issue.suggestion }}</div>\n                                </div>\n                              </div>\n                              <div class=\"issue-actions\">\n                                <el-button size=\"small\" type=\"default\"></el-button>\n                              </div>\n                            </div>\n                          </el-collapse-item>\n                        </el-collapse>\n                      </div>\n                    </div>\n                  </el-scrollbar>\n                </div>\n              </div>\n            </div>\n          </el-tab-pane>\n\n          <el-tab-pane label=\"\" name=\"history\">\n            <h5></h5>\n            <el-timeline>\n              <el-timeline-item\n                v-for=\"(activity, index) in contractHistory\"\n                :key=\"index\"\n                :timestamp=\"activity.time\"\n              >\n                {{ activity.content }}\n              </el-timeline-item>\n            </el-timeline>\n            <el-empty \n              v-if=\"contractHistory.length === 0\" \n              description=\"\"\n            ></el-empty>\n          </el-tab-pane>\n        </el-tabs>\n        \n        <hr>\n        <div class=\"mt-3 text-end\">\n          <el-button @click=\"goBack\"></el-button>\n        </div>\n      </div>\n    </div>\n\n    <!-- AI () -->\n    <div \n      v-if=\"activeTab === 'contractText'\"\n      class=\"ai-suggestions-panel\" \n      :class=\"{ 'show': showAiSuggestions, 'collapsed': isAiPanelCollapsed }\"\n      id=\"aiSuggestionsPanel\"\n    >\n      <div class=\"panel-header\">\n        <h5><el-icon class=\"text-warning\"><Reading /></el-icon> AI </h5>\n        <div class=\"panel-controls\">\n          <el-button type=\"text\" @click=\"toggleAiPanelCollapse\">\n            <el-icon v-if=\"isAiPanelCollapsed\"><ArrowRight /></el-icon>\n            <el-icon v-else><ArrowLeft /></el-icon>\n          </el-button>\n          <el-button type=\"text\" @click=\"hideAiPanel\">\n            <el-icon><Close /></el-icon>\n          </el-button>\n        </div>\n      </div>\n      \n      <div v-if=\"realTimePolishLoading\" class=\"text-center my-2\">\n        <el-icon class=\"is-loading\"><Loading /></el-icon>\n        <span class=\"ms-1\">...</span>\n      </div>\n      \n      <div v-if=\"!realTimePolishLoading && aiSuggestions.syntax.length === 0 && aiSuggestions.terminology.length === 0\" class=\"text-center my-3 text-muted\">\n        <el-icon><InfoFilled /></el-icon>\n        <p></p>\n        <p class=\"small\">\"AI\"</p>\n      </div>\n      \n      <el-collapse v-model=\"activeSuggestionCollapse\">\n        <el-collapse-item name=\"syntax\">\n          <template #title>\n            <span><el-icon class=\"me-1\"><Edit /></el-icon>  ({{ aiSuggestions.syntax.length }})</span>\n          </template>\n          \n          <div v-if=\"aiSuggestions.syntax.length === 0\" class=\"p-3 text-center text-muted\">\n            \n          </div>\n          \n          <div \n            v-for=\"(suggestion, index) in aiSuggestions.syntax\" \n            :key=\"'syntax-'+index\" \n            class=\"suggestion-item\"\n          >\n            <div class=\"original-text\">{{ suggestion.original }}</div>\n            <div class=\"suggested-text\">{{ suggestion.suggested }}</div>\n            <p class=\"explanation\">{{ suggestion.explanation }}</p>\n            <div class=\"suggestion-actions text-end\">\n              <el-button size=\"small\" @click=\"ignoreSuggestion('syntax', index)\"></el-button>\n              <el-button size=\"small\" type=\"success\" @click=\"adoptSuggestion('syntax', index)\"></el-button>\n            </div>\n          </div>\n        </el-collapse-item>\n\n        <el-collapse-item name=\"terminology\">\n          <template #title>\n            <span><el-icon class=\"me-1\"><Reading /></el-icon>  ({{ aiSuggestions.terminology.length }})</span>\n          </template>\n          \n          <div v-if=\"aiSuggestions.terminology.length === 0\" class=\"p-3 text-center text-muted\">\n            \n          </div>\n          \n          <div \n            v-for=\"(suggestion, index) in aiSuggestions.terminology\" \n            :key=\"'term-'+index\" \n            class=\"suggestion-item\"\n          >\n            <div class=\"original-text\">{{ suggestion.original }}</div>\n            <div class=\"suggested-text\">{{ suggestion.suggested }}</div>\n            <p class=\"explanation\">{{ suggestion.explanation }}</p>\n            <div class=\"suggestion-actions text-end\">\n              <el-button size=\"small\" @click=\"ignoreSuggestion('terminology', index)\"></el-button>\n              <el-button size=\"small\" type=\"success\" @click=\"adoptSuggestion('terminology', index)\"></el-button>\n            </div>\n          </div>\n        </el-collapse-item>\n      </el-collapse>\n\n      <div class=\"text-center mt-3\" v-if=\"aiSuggestions.syntax.length > 0 || aiSuggestions.terminology.length > 0\">\n        <el-button type=\"primary\" size=\"small\" @click=\"applyAllSuggestions\"></el-button>\n      </div>\n    </div>\n\n    <!--  -->\n    <div \n      v-if=\"activeTab === 'contractText' && !showAiSuggestions\"\n      class=\"panel-open-button\"\n      @click=\"showAiSuggestions = true\"\n    >\n      <el-tooltip content=\"AI\" placement=\"left\">\n        <el-button type=\"primary\" size=\"small\" circle>\n          <el-icon><MagicStick /></el-icon>\n        </el-button>\n      </el-tooltip>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, reactive, onMounted, computed, watch, onUnmounted, nextTick, onBeforeUnmount } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { ElMessage, ElLoading, ElMessageBox } from 'element-plus'\nimport {\n  Download, DocumentAdd, MagicStick, Check, Warning, WarningFilled,\n  Document, InfoFilled, Edit, Reading, Close, Loading, ArrowRight, ArrowLeft,\n  Timer, Position, Setting, DocumentChecked, Notebook, Plus\n} from '@element-plus/icons-vue'\nimport { \n  getContractDetail, \n  updateContract, \n  checkContract,\n  aiPolishContract \n} from '@/api/contract'\nimport request from '@/utils/request'\n// \nimport { QuillEditor } from '@vueup/vue-quill'\n// \nimport '@vueup/vue-quill/dist/vue-quill.snow.css'\n// lodashdebounce\nimport { debounce } from 'lodash-es'\n\n// Quill\nlet SuggestionBlot\nlet SuggestionModule\n\n// Quill - \nconst initQuillExtensions = () => {\n  if (typeof window === 'undefined') return\n  \n  // QuillCDN\n  if (!window.Quill) {\n    console.error('Quill')\n    return\n  }\n  \n  // Quill - \n  const InlineSuggestionBlot = window.Quill.import('blots/inline')\n  SuggestionBlot = class extends InlineSuggestionBlot {\n    static create(value) {\n      const node = super.create()\n      node.setAttribute('data-suggestion-id', value.id)\n      node.setAttribute('class', 'suggestion-highlight')\n      node.setAttribute('data-original', value.original)\n      node.setAttribute('data-suggested', value.suggested)\n      \n      // \n      node.title = ''\n      node.style.position = 'relative'\n      node.style.backgroundColor = 'rgba(255, 217, 102, 0.3)'\n      node.style.borderBottom = '1px dashed #ffb300'\n      node.style.padding = '0 2px'\n      node.style.cursor = 'pointer'\n      \n      return node\n    }\n  \n    static formats(node) {\n      return {\n        id: node.getAttribute('data-suggestion-id'),\n        original: node.getAttribute('data-original'),\n        suggested: node.getAttribute('data-suggested')\n      }\n    }\n  }\n  SuggestionBlot.blotName = 'suggestion'\n  SuggestionBlot.tagName = 'span'\n  window.Quill.register(SuggestionBlot)\n  \n  // Quill Module - \n  SuggestionModule = class {\n    constructor(quill, options) {\n      this.quill = quill\n      this.options = options\n      this.suggestions = options.suggestions || []\n      this.container = document.createElement('div')\n      this.container.className = 'ql-suggestion-tooltip'\n      this.container.style.display = 'none'\n      document.body.appendChild(this.container)\n      \n      this.quill.on('text-change', () => {\n        this.update()\n      })\n      \n      // \n      this._clickListener = (e) => {\n        if (e.target && e.target.classList.contains('suggestion-highlight')) {\n          this.showTooltip(e.target)\n        } else {\n          this.hideTooltip()\n        }\n      }\n      \n      this.quill.root.addEventListener('click', this._clickListener)\n      \n      // MutationObserverDOMNodeInserted\n      this.observer = new MutationObserver((mutations) => {\n        for (const mutation of mutations) {\n          if (mutation.type === 'childList' || mutation.type === 'characterData') {\n            this.update()\n          }\n        }\n      })\n      \n      // observer\n      this.observer.observe(this.quill.root, {\n        childList: true,\n        subtree: true,\n        characterData: true\n      })\n    }\n    \n    update() {\n      // \n    }\n    \n    showTooltip(element) {\n      const rect = element.getBoundingClientRect()\n      const id = element.getAttribute('data-suggestion-id')\n      const original = element.getAttribute('data-original')\n      const suggested = element.getAttribute('data-suggested')\n      \n      // \n      this.container.innerHTML = `\n        <div class=\"suggestion-tooltip-content\">\n          <div class=\"suggestion-tooltip-header\">AI</div>\n          <div class=\"suggestion-tooltip-body\">\n            <div class=\"suggestion-label\">:</div>\n            <div class=\"suggestion-original\">${original}</div>\n            <div class=\"suggestion-arrow\"><span></span></div>\n            <div class=\"suggestion-label\">:</div>\n            <div class=\"suggestion-suggested\">${suggested}</div>\n            <div class=\"suggestion-diff\">\n              ${this._generateDiff(original, suggested)}\n            </div>\n          </div>\n          <div class=\"suggestion-actions\">\n            <button class=\"btn-adopt\" data-id=\"${id}\"></button>\n            <button class=\"btn-ignore\" data-id=\"${id}\"></button>\n          </div>\n        </div>\n      `\n      \n      this.container.style.display = 'block'\n      this.container.style.top = `${rect.bottom + window.scrollY + 5}px`\n      this.container.style.left = `${rect.left + window.scrollX}px`\n      \n      // \n      const adoptBtn = this.container.querySelector('.btn-adopt')\n      const ignoreBtn = this.container.querySelector('.btn-ignore')\n      \n      // \n      if (this._adoptListener) {\n        adoptBtn.removeEventListener('click', this._adoptListener)\n      }\n      if (this._ignoreListener) {\n        ignoreBtn.removeEventListener('click', this._ignoreListener)\n      }\n      \n      // \n      this._adoptListener = () => {\n        this.options.onAdopt && this.options.onAdopt(id)\n        this.hideTooltip()\n      }\n      \n      this._ignoreListener = () => {\n        this.options.onIgnore && this.options.onIgnore(id)\n        this.hideTooltip()\n      }\n      \n      adoptBtn.addEventListener('click', this._adoptListener)\n      ignoreBtn.addEventListener('click', this._ignoreListener)\n    }\n    \n    // \n    _generateDiff(original, suggested) {\n      // \n      try {\n        if (!original || !suggested) return '';\n        \n        const words1 = original.split(/\\s+/);\n        const words2 = suggested.split(/\\s+/);\n        \n        // \n        let firstDiff = 0;\n        while (firstDiff < words1.length && firstDiff < words2.length && \n              words1[firstDiff] === words2[firstDiff]) {\n          firstDiff++;\n        }\n        \n        // \n        let lastDiff1 = words1.length - 1;\n        let lastDiff2 = words2.length - 1;\n        while (lastDiff1 >= 0 && lastDiff2 >= 0 && \n              words1[lastDiff1] === words2[lastDiff2]) {\n          lastDiff1--;\n          lastDiff2--;\n        }\n        \n        // \n        const prefix = words1.slice(0, firstDiff).join(' ');\n        const suffix1 = words1.slice(lastDiff1 + 1).join(' ');\n        \n        // \n        const diff1 = words1.slice(firstDiff, lastDiff1 + 1).join(' ');\n        const diff2 = words2.slice(firstDiff, lastDiff2 + 1).join(' ');\n        \n        return `\n          <div class=\"diff-explain\">:</div>\n          <div class=\"diff-content\">\n            ${prefix ? `<span class=\"diff-common\">${prefix}</span> ` : ''}\n            <span class=\"diff-removed\">${diff1}</span>  \n            <span class=\"diff-added\">${diff2}</span>\n            ${suffix1 ? ` <span class=\"diff-common\">${suffix1}</span>` : ''}\n          </div>\n        `;\n      } catch (e) {\n        console.error(':', e);\n        return '';\n      }\n    }\n    \n    hideTooltip() {\n      this.container.style.display = 'none'\n    }\n    \n    applySuggestions(suggestions) {\n      this.suggestions = suggestions\n      \n      // \n      this.clearAllSuggestionFormats()\n      \n      // \n      suggestions.forEach(suggestion => {\n        // \n        const content = this.quill.getText()\n        let index = content.indexOf(suggestion.original)\n        \n        if (index !== -1) {\n          // \n          this.quill.formatText(index, suggestion.original.length, {\n            'suggestion': {\n              id: suggestion.id,\n              original: suggestion.original,\n              suggested: suggestion.suggested\n            }\n          }, 'api');\n        }\n      });\n    }\n    \n    clearAllSuggestionFormats() {\n      const content = this.quill.getText()\n      this.quill.formatText(0, content.length, { 'suggestion': false }, 'api')\n    }\n    \n    // MutationObserver\n    destroy() {\n      // \n      if (this.observer) {\n        this.observer.disconnect()\n        this.observer = null\n      }\n      \n      // \n      if (this.quill && this.quill.root) {\n        this.quill.root.removeEventListener('click', this._clickListener)\n      }\n      \n      // \n      if (this._adoptListener) {\n        const adoptBtn = this.container.querySelector('.btn-adopt')\n        if (adoptBtn) {\n          adoptBtn.removeEventListener('click', this._adoptListener)\n        }\n      }\n      \n      if (this._ignoreListener) {\n        const ignoreBtn = this.container.querySelector('.btn-ignore')\n        if (ignoreBtn) {\n          ignoreBtn.removeEventListener('click', this._ignoreListener)\n        }\n      }\n      \n      // tooltip\n      if (this.container && this.container.parentNode) {\n        this.container.parentNode.removeChild(this.container)\n        this.container = null\n      }\n    }\n  }\n  \n  window.Quill.register('modules/suggestion', SuggestionModule)\n}\n\nexport default {\n  name: 'ContractDetail',\n  components: {\n    QuillEditor,\n    Download, DocumentAdd, MagicStick, Check, Warning, WarningFilled,\n    Document, InfoFilled, Edit, Reading, Close, Loading, ArrowRight, ArrowLeft,\n    Timer, Position, Setting, DocumentChecked, Notebook, Plus\n  },\n  setup() {\n    const route = useRoute()\n    const router = useRouter()\n    // contractId\n    const contractId = computed(() => {\n      // null\n      if (route.name !== 'ContractDetail') {\n        return null;\n      }\n      const id = route.params.id;\n      return !isNaN(Number(id)) ? Number(id) : null;\n    })\n    \n    // \n    const activeTab = ref('basicInfo')\n    const activeCollapse = ref(['legalCompliance', 'clauseCompleteness', 'riskAlert'])\n    const activeSuggestionCollapse = ref(['syntax', 'terminology'])\n    \n    // \n    const polishPreferences = reactive({\n      style: 'neutral',       // \n      contractType: 'general', // \n      focus: ['grammar', 'terminology'], // \n    })\n    \n    // \n    const checkPreferences = reactive({\n      legalCompliance: true,  // \n      completeness: true,     // \n      riskAlert: true,        // \n      contractType: 'general', // \n      checkDepth: 'standard'  // \n    })\n    \n    // \n    const customTerminologies = ref([])\n    const newTerminology = reactive({\n      term: ''\n    })\n    \n    // \n    const addCustomTerminology = () => {\n      if (!newTerminology.term.trim()) return\n      \n      if (!customTerminologies.value.includes(newTerminology.term.trim())) {\n        customTerminologies.value.push(newTerminology.term.trim())\n        newTerminology.term = ''\n        \n        // \"\"\n        if (!polishPreferences.focus.includes('terminology')) {\n          polishPreferences.focus.push('terminology')\n        }\n        \n        // \n        localStorage.setItem('customTerminologies', JSON.stringify(customTerminologies.value))\n        \n        ElMessage.success('')\n      } else {\n        ElMessage.warning('')\n        newTerminology.term = ''\n      }\n    }\n    \n    // \n    const removeCustomTerminology = (index) => {\n      customTerminologies.value.splice(index, 1)\n      \n      // \n      localStorage.setItem('customTerminologies', JSON.stringify(customTerminologies.value))\n    }\n    \n    const isChecking = ref(false)\n    const quillEditor = ref(null)\n    const showAiSuggestions = ref(false)\n    const isLoading = ref(false)\n    const isSaving = ref(false)\n    \n    // \n    const contractEditContainer = ref(null)\n    const aiPolishSidebar = ref(null)\n    const editorMainArea = ref(null)\n    \n    // \n    const contractCheckContainer = ref(null)\n    const checkSidebar = ref(null)\n    const checkResultArea = ref(null)\n    \n    // AI\n    const isRealTimePolishing = ref(false) // \n    const realTimePolishLoading = ref(false)\n    const lastAnalyzedContent = ref('')\n    const lastAnalysisTime = ref(0)\n    \n    // \n    const enableInlineSuggestions = ref(true) // \n    \n    // \n    const isAiPanelCollapsed = ref(false)\n    \n    // \n    const toggleAiPanelCollapse = () => {\n      isAiPanelCollapsed.value = !isAiPanelCollapsed.value\n    }\n    \n    // \n    const editorOption = {\n      placeholder: '',\n      modules: {\n        toolbar: [\n          ['bold', 'italic', 'underline', 'strike'],\n          ['blockquote', 'code-block'],\n          [{ 'header': 1 }, { 'header': 2 }],\n          [{ 'list': 'ordered' }, { 'list': 'bullet' }],\n          [{ 'script': 'sub' }, { 'script': 'super' }],\n          [{ 'indent': '-1' }, { 'indent': '+1' }],\n          [{ 'direction': 'rtl' }],\n          [{ 'size': ['small', false, 'large', 'huge'] }],\n          [{ 'header': [1, 2, 3, 4, 5, 6, false] }],\n          [{ 'color': [] }, { 'background': [] }],\n          [{ 'font': [] }],\n          [{ 'align': [] }],\n          ['clean']\n        ],\n        suggestion: {\n          suggestions: [],\n          onAdopt: (suggestionId) => {\n            adoptInlineEditSuggestion(suggestionId)\n          },\n          onIgnore: (suggestionId) => {\n            ignoreInlineEditSuggestion(suggestionId)\n          }\n        }\n      }\n    }\n    \n    // \n    const contractDetails = reactive({\n      id: contractId.value,\n      number: '',\n      title: '',\n      type: '',\n      amount: '',\n      company: '',\n      signDate: '',\n      startDate: '',\n      expireDate: '',\n      content: '',\n      status: '',\n      created_by: null,\n      created_at: '',\n      updated_at: '',\n      attachments: [],\n      actions: []\n    })\n    \n    // \n    const contractTitle = computed(() => {\n      return contractDetails.title ? `: ${contractDetails.number}` : '...'\n    })\n\n    // \n    const checkResult = reactive({\n      totalIssues: 0,\n      criticalIssues: 0,\n      warningIssues: 0,\n      suggestions: 0,\n      legalComplianceIssues: [],\n      completenessIssues: [],\n      riskAlerts: []\n    })\n\n    // AI\n    const aiSuggestions = reactive({\n      syntax: [],\n      terminology: []\n    })\n\n    //  - actions\n    const contractHistory = computed(() => {\n      return contractDetails.actions?.map(action => ({\n        time: action.created_at,\n        content: `${action.user?.username || ''} ${action.description}`\n      })) || []\n    })\n\n    // \n    const getContractDetails = async (loadSilently = false) => {\n      try {\n        // \n        if (route.name !== 'ContractDetail') {\n          console.log('')\n          return\n        }\n        \n        // contractId\n        if (!contractId.value || contractId.value === 'contract' || isNaN(contractId.value)) {\n          console.log('ID:', contractId.value)\n          // \n          // ElMessage.error('ID')\n          router.push({ name: 'Contract' })\n          return\n        }\n        \n        isLoading.value = true\n        const response = await getContractDetail(contractId.value)\n        console.log('API:', response)\n        \n        // response.datarequest.js\n        const contractData = response.data || response\n        \n        // \n        Object.keys(contractDetails).forEach(key => {\n          if (key in contractData) {\n            contractDetails[key] = contractData[key]\n          }\n        })\n        \n        // content\n        if (contractData.content) {\n          contractDetails.content = contractData.content\n        } else {\n          // \n          contractDetails.content = `<p>...</p>\n<p><strong></strong></p>\n<p><strong></strong>${contractDetails.company || ''}</p>`\n        }\n        \n        // \n        if (contractData.sign_date) contractDetails.signDate = contractData.sign_date\n        if (contractData.start_date) contractDetails.startDate = contractData.start_date\n        if (contractData.expire_date) contractDetails.expireDate = contractData.expire_date\n        \n        // \n        if (contractData.amount) {\n          contractDetails.amount = Number(contractData.amount).toLocaleString('zh-CN')\n        }\n        \n        // \n        if (!loadSilently) {\n          ElMessage.success('')\n        }\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error('')\n      } finally {\n        isLoading.value = false\n      }\n    }\n\n    // \n    const goBack = () => {\n      router.push({ name: 'Contract' })\n    }\n\n    // \n    const saveChanges = async () => {\n      try {\n        isSaving.value = true\n        const loading = ElLoading.service({\n          lock: true,\n          text: '...',\n          background: 'rgba(0, 0, 0, 0.7)'\n        })\n        \n        // YYYY-MM-DD\n        const formatDate = (date) => {\n          if (!date) return ''\n          \n          //  - \n          if (typeof date === 'string') {\n            // \n            if (/^\\d{4}-\\d{2}-\\d{2}$/.test(date)) {\n              return date\n            }\n            \n            // \n            const parsedDate = new Date(date)\n            if (!isNaN(parsedDate.getTime())) {\n              return formatDateObject(parsedDate)\n            }\n            \n            return ''\n          }\n          \n          // \n          if (date instanceof Date && !isNaN(date.getTime())) {\n            return formatDateObject(date)\n          }\n          \n          return ''\n        }\n        \n        // DateYYYY-MM-DD\n        const formatDateObject = (dateObj) => {\n          const year = dateObj.getFullYear()\n          const month = String(dateObj.getMonth() + 1).padStart(2, '0')\n          const day = String(dateObj.getDate()).padStart(2, '0')\n          return `${year}-${month}-${day}`\n        }\n        \n        // \n        const updateData = {\n          title: contractDetails.title,\n          type: contractDetails.type,\n          amount: contractDetails.amount.toString().replace(/[^\\d.]/g, ''),\n          company: contractDetails.company,\n          sign_date: formatDate(contractDetails.signDate),\n          start_date: formatDate(contractDetails.startDate),\n          expire_date: formatDate(contractDetails.expireDate),\n          content: contractDetails.content\n        }\n        \n        // \n        if (!updateData.sign_date) {\n          ElMessage.warning('')\n          loading.close()\n          isSaving.value = false\n          return\n        }\n        \n        // API\n        await updateContract(contractId.value, updateData)\n        \n        ElMessage.success('')\n        \n        // \n        await getContractDetails(true)\n        \n        loading.close()\n      } catch (error) {\n        console.error(':', error)\n        \n        // \n        if (error.response && error.response.data) {\n          console.error(':', error.response.data)\n        }\n        \n        ElMessage.error('')\n      } finally {\n        isSaving.value = false\n      }\n    }\n\n    // \n    const startContractCheck = async () => {\n      console.log(\"%c==========  ==========\", \"background:#3a8ee6;color:white;padding:4px 8px;border-radius:4px;font-weight:bold;\");\n      console.log(\"startContractCheck\");\n      \n      // \n      if (checkResultArea.value) {\n        console.log(\"\");\n        \n        // check-result-area\n        checkResultArea.value.style.height = '100%';\n        \n        // el-scrollbar\n        console.log(\"el-scrollbar\");\n      }\n      \n      // el-scrollbar\n      \n      // \n      console.log(\"\", activeTab.value);\n      // HTML\n      if (document.querySelector(\".contract-edit-container\")) {\n        console.log(\"DOM\");\n      } else {\n        console.log(\"DOM\");\n        // \n        if (document.querySelector(\".contract-detail-container\")) {\n          console.log(\"\");\n        }\n        if (document.getElementById(\"contractCheckContainer\")) {\n          console.log(\"ID\");\n        }\n      }\n      \n      // \n      if (checkResultArea.value) {\n        const style = window.getComputedStyle(checkResultArea.value);\n        console.log(\":\", {\n          display: style.display,\n          height: style.height,\n          overflow: style.overflow,\n          position: style.position\n        });\n        \n        // \n        console.log(\"\");\n        checkResultArea.value.style.display = 'none';\n        setTimeout(() => {\n          checkResultArea.value.style.display = 'flex';\n          \n          // \n          const scrollWrapper = checkResultArea.value.querySelector('.check-content-scroll-wrapper');\n          if (scrollWrapper) {\n            const scrollStyle = window.getComputedStyle(scrollWrapper);\n            console.log(\":\", {\n              height: scrollStyle.height,\n              overflow: scrollStyle.overflow,\n              position: scrollStyle.position\n            });\n          } else {\n            console.error(\"\");\n          }\n        }, 50);\n      } else {\n        console.error(\"checkResultArea\");\n      }\n      \n      if (isChecking.value) {\n        console.log(\"\");\n        return;\n      }\n      \n      // ID\n      if (!contractId.value || isNaN(contractId.value)) {\n        console.error(\"ID:\", contractId.value);\n        ElMessage.error('ID');\n        return;\n      }\n      \n      // \n      if (!contractDetails.content) {\n        console.log(\"\");\n        ElMessage.warning('');\n        return;\n      }\n      \n      // \n      console.log(\" - :\");\n      console.log(\"ID:\", contractId.value, typeof contractId.value);\n      console.log(\":\", contractDetails.content.length);\n      console.log(\":\", JSON.stringify(checkPreferences, null, 2));\n      \n      isChecking.value = true;\n      let loadingInstance = null;\n      \n      try {\n        // \n        console.log(\"\");\n        loadingInstance = ElLoading.service({\n          text: 'AI...',\n          background: 'rgba(255, 255, 255, 0.7)'\n        });\n        \n        ElMessage.info('AI...');\n        \n        // \n        const requestParams = {\n          content: contractDetails.content,\n          preferences: {\n            contract_type: checkPreferences.contractType,\n            check_depth: checkPreferences.checkDepth,\n            check_areas: []\n          }\n        };\n        \n        // \n        if (checkPreferences.legalCompliance) {\n          requestParams.preferences.check_areas.push('legal_compliance');\n        }\n        if (checkPreferences.completeness) {\n          requestParams.preferences.check_areas.push('completeness');\n        }\n        if (checkPreferences.riskAlert) {\n          requestParams.preferences.check_areas.push('risk_alert');\n        }\n        \n        // \n        if (requestParams.preferences.check_areas.length === 0) {\n          console.log(\"\");\n          ElMessage.warning('');\n          requestParams.preferences.check_areas = ['legal_compliance', 'completeness', 'risk_alert'];\n          // UI\n          checkPreferences.legalCompliance = true;\n          checkPreferences.completeness = true;\n          checkPreferences.riskAlert = true;\n        }\n        \n        console.log(\":\", JSON.stringify(requestParams, null, 2));\n        console.log(\"API:\", `/api/contract/contracts/${contractId.value}/check_contract/`);\n        \n        // \n        const startTime = new Date().getTime();\n        console.log(\":\", new Date().toLocaleTimeString());\n        \n        // API\n        const result = await checkContract(contractId.value, requestParams);\n        \n        // \n        const endTime = new Date().getTime();\n        console.log(\":\", new Date().toLocaleTimeString());\n        console.log(\":\", (endTime - startTime) / 1000, \"\");\n        console.log(\":\", result);\n        \n        if (result.error) {\n          console.error(\"API:\", result.error);\n          ElMessage.error(`: ${result.error}`);\n          return;\n        }\n        \n        // \n        console.log(\"...\");\n        checkResult.totalIssues = result.totalIssues || 0;\n        checkResult.criticalIssues = result.criticalIssues || 0;\n        checkResult.warningIssues = result.warningIssues || 0;\n        checkResult.suggestions = result.suggestions || 0;\n        \n        // \n        checkResult.legalComplianceIssues = result.legalComplianceIssues || [];\n        checkResult.completenessIssues = result.completenessIssues || [];\n        checkResult.riskAlerts = result.riskAlerts || [];\n        \n        if (checkResult.totalIssues > 0) {\n          console.log(`${checkResult.totalIssues}`);\n          ElMessage.warning(`${checkResult.totalIssues}`);\n        } else {\n          console.log('');\n          ElMessage.success('');\n        }\n        \n        // \n        if (checkResult.legalComplianceIssues.length > 0) {\n          console.log(\"\");\n          activeCollapse.value = ['legalCompliance'];\n        } else if (checkResult.completenessIssues.length > 0) {\n          console.log(\"\");\n          activeCollapse.value = ['clauseCompleteness'];\n        } else if (checkResult.riskAlerts.length > 0) {\n          console.log(\"\");\n          activeCollapse.value = ['riskAlert'];\n        }\n        \n        console.log(\":\", checkResult);\n        console.log(\"%c==========  ==========\", \"background:#67c23a;color:white;padding:4px 8px;border-radius:4px;font-weight:bold;\");\n        \n      } catch (error) {\n        console.error('%c:', 'color:red;font-weight:bold;', error);\n        console.error(':', JSON.stringify(error, null, 2));\n        // \n        if (error.response) {\n          console.error(':', error.response.status, error.response.statusText);\n          console.error(':', error.response.data);\n        }\n        ElMessage.error(`: ${error.message || ''}`);\n      } finally {\n        // \n        if (loadingInstance) {\n          console.log(\"\");\n          loadingInstance.close();\n        }\n        isChecking.value = false;\n        console.log(\" isChecking = false\");\n      }\n    };\n\n    // \n    const estimatedTime = computed(() => {\n      const content = contractDetails.content || '';\n      const charCount = content.length;\n      \n      // \n      if (charCount <= 1000) return '10';\n      if (charCount <= 5000) return '30';\n      if (charCount <= 15000) return '1';\n      if (charCount <= 30000) return '2';\n      return '2-3';\n    });\n\n    // \n    const manualAnalyzeText = async () => {\n      // \n      if (!contractDetails.content) {\n        ElMessage.warning('');\n        return;\n      }\n      \n      // \n      realTimePolishLoading.value = true;\n\n      // \n      const timeoutPromise = new Promise((_, reject) => {\n        setTimeout(() => reject(new Error('')), 65000);\n      });\n      \n      // \n      const loadingInstance = ElLoading.service({\n        text: 'AI...',\n        background: 'rgba(255, 255, 255, 0.7)'\n      });\n      \n      // \n      const content = contractDetails.content;\n      lastAnalyzedContent.value = content;\n      lastAnalysisTime.value = Date.now();\n      \n      if (content.length > 10000) {\n        ElMessage.warning('');\n      }\n      \n      try {\n        // \n        const requestParams = {\n          content: content,\n          is_manual: true,  // \n          preferences: {\n            style: polishPreferences.style,\n            contract_type: polishPreferences.contractType,\n            focus: polishPreferences.focus,\n            custom_terminologies: customTerminologies.value\n          }\n        };\n        \n        console.log(\":\", JSON.stringify(requestParams, null, 2));\n        \n        // Promise.race\n        const result = await Promise.race([\n          aiPolishContract(contractId.value, requestParams),\n          timeoutPromise\n        ]);\n        \n        console.log(\"API:\", result);\n        \n        if (!result.error) {\n          // \n          const filterBasicInfoSuggestions = (suggestions) => {\n            if (!Array.isArray(suggestions)) return [];\n            \n            const basicInfoKeywords = [\n              '', '', '', '', '', \n              '', '', '', '', ''\n            ];\n\n            return suggestions.filter(suggestion => {\n              return !basicInfoKeywords.some(keyword => \n                suggestion.original.includes(keyword) || \n                suggestion.suggested.includes(keyword) || \n                suggestion.explanation.includes(keyword)\n              );\n            });\n          };\n          \n          // \n          if (result.syntax) {\n            aiSuggestions.syntax = filterBasicInfoSuggestions(result.syntax);\n          }\n          if (result.terminology) {\n            aiSuggestions.terminology = filterBasicInfoSuggestions(result.terminology);\n          }\n            \n          // ID\n          aiSuggestions.syntax.forEach((s, i) => { s.id = `syntax-${i}`; });\n          aiSuggestions.terminology.forEach((s, i) => { s.id = `term-${i}`; });\n            \n          // \n          if (enableInlineSuggestions.value) {\n            // \n            setTimeout(() => {\n              applyInlineSuggestions();\n            }, 100);\n          }\n          \n          // \n          const totalSuggestions = aiSuggestions.syntax.length + aiSuggestions.terminology.length;\n          if (totalSuggestions > 0) {\n            showAiSuggestions.value = true;\n            // \n            ElMessage.success(`AI${totalSuggestions}`);\n          } else {\n            ElMessage.info('AI');\n          }\n        }\n      } catch (timeoutErr) {\n        if (timeoutErr.message.includes('')) {\n          ElMessageBox.confirm(\n            '',\n            '',\n            {\n              confirmButtonText: '',\n              cancelButtonText: '',\n              type: 'warning'\n            }\n          ).then(() => {\n            // \n            ElMessage.info('...');\n            setTimeout(() => {\n              manualAnalyzeText();\n            }, 1000);\n          }).catch(() => {\n            // \n            ElMessage.info('AI');\n          });\n        } else {\n          throw timeoutErr; // \n        }\n      } finally {\n        // \n        if (loadingInstance) {\n          loadingInstance.close();\n        }\n        realTimePolishLoading.value = false;\n      }\n    };\n    \n    // 3\n    // (debounce)3API\n    //  - \n    const debouncedAnalyzeText = debounce(() => {\n      //  manualAnalyzeText \n      console.log('\"AI\"');\n    }, 3000);\n    \n    // \n    const adjustEditorHeight = () => {\n      // \n      console.log(\":\", activeTab.value);\n      \n      // \n      const viewHeight = window.innerHeight;\n      const marginBottom = 20; // CSSmargin-bottom\n      \n      // \n      if (activeTab.value === 'contractText') {\n        // \n        if (!contractEditContainer.value || !aiPolishSidebar.value || !editorMainArea.value) {\n          console.log(\"\");\n          return;\n        }\n        \n        // \n        const containerRect = contractEditContainer.value.getBoundingClientRect();\n        const topOffset = containerRect.top;\n        \n        // \n        const containerHeight = Math.max(viewHeight - topOffset - marginBottom, 500);\n        \n        // \n        contractEditContainer.value.style.height = `${containerHeight}px`;\n        \n        // Quill\n        if (quillEditor.value && quillEditor.value.getQuill) {\n          try {\n            const quill = quillEditor.value.getQuill();\n            if (quill) {\n              // Quill\n              setTimeout(() => {\n                quill.update();\n              }, 100);\n            }\n          } catch (e) {\n            console.warn('Quill:', e);\n          }\n        }\n      } \n      // \n      else if (activeTab.value === 'contractCheck') {\n        // \n        if (!contractCheckContainer.value) {\n          console.log(\"\");\n          return;\n        }\n        \n        // \n        const containerRect = contractCheckContainer.value.getBoundingClientRect();\n        const topOffset = containerRect.top;\n        \n        //  - \n        const containerHeight = Math.max(viewHeight - topOffset - marginBottom + 60, 600);\n        \n        // \n        contractCheckContainer.value.style.height = `${containerHeight}px`;\n        console.log(\":\", containerHeight);\n      }\n    };\n    \n    // \n    const setupResizeListener = () => {\n      window.addEventListener('resize', adjustEditorHeight);\n      \n      // \n      document.addEventListener('visibilitychange', () => {\n        if (document.visibilityState === 'visible') {\n          console.log(\"\");\n          nextTick(() => {\n            adjustEditorHeight();\n          });\n        }\n      });\n    };\n    \n    // \n    const cleanupResizeListener = () => {\n      window.removeEventListener('resize', adjustEditorHeight);\n    };\n    \n    // \n    watch(() => activeTab.value, (newTab) => {\n      console.log(\":\", newTab);\n      \n      if (newTab === 'contractText') {\n        // \n        console.log(\"\");\n        \n        // \n        nextTick(() => {\n          adjustEditorHeight();\n          // DOM\n          setupMutationObserver();\n        });\n        \n        // \n        if (enableInlineSuggestions.value) {\n          setTimeout(() => {\n            applyInlineSuggestions();\n          }, 500);\n        }\n      } \n      else if (newTab === 'contractCheck') {\n        // \n        console.log(\"\");\n        \n        // DOM\n        nextTick(() => {\n          // \n          if (contractDetails.content) {\n            console.log(\"\");\n          } else {\n            console.log(\"\");\n            ElMessage.info('AI');\n          }\n          \n          // \n          adjustEditorHeight();\n          \n          // \n          if (checkResultArea.value) {\n            console.log(\"\");\n            \n            // check-result-area\n            checkResultArea.value.style.height = '100%';\n            \n            // el-scrollbar\n            console.log(\"el-scrollbar\");\n            \n            // \n            checkResultArea.value.style.display = 'none';\n            setTimeout(() => {\n              checkResultArea.value.style.display = 'flex';\n            }, 50);\n          }\n        });\n      } \n      else {\n        // \n        console.log(\":\", newTab);\n        \n        // \n        showAiSuggestions.value = false;\n        \n        // DOM\n        if (resizeObserver) {\n          resizeObserver.disconnect();\n        }\n      }\n    });\n\n    // AI\n    const hideAiPanel = () => {\n      // \n      showAiSuggestions.value = false\n      // \n      isAiPanelCollapsed.value = false\n      console.log(\"showAiSuggestionsfalse\")\n    }\n\n    // AI\n    // eslint-disable-next-line no-unused-vars\n    const adoptSuggestion = (type, index) => {\n      const suggestion = aiSuggestions[type][index]\n      \n      if (quillEditor.value && suggestion) {\n        const content = contractDetails.content\n        \n        // \n        try {\n          // 1: \n          if (content.includes(suggestion.original)) {\n            contractDetails.content = content.replace(suggestion.original, suggestion.suggested)\n            aiSuggestions[type].splice(index, 1)\n            ElMessage.success('')\n            return\n          }\n          \n          // 2: \n          const lowerContent = content.toLowerCase()\n          const lowerOriginal = suggestion.original.toLowerCase()\n          \n          if (lowerContent.includes(lowerOriginal)) {\n            // \n            const startIndex = lowerContent.indexOf(lowerOriginal)\n            const actualOriginalText = content.substring(startIndex, startIndex + suggestion.original.length)\n            contractDetails.content = content.replace(actualOriginalText, suggestion.suggested)\n            aiSuggestions[type].splice(index, 1)\n            ElMessage.success('')\n            return\n          }\n          \n          // 3: HTML\n          const tempDiv = document.createElement('div')\n          tempDiv.innerHTML = content\n          const plainText = tempDiv.textContent || tempDiv.innerText || ''\n          \n          if (plainText.includes(suggestion.original)) {\n            // \n            const escapedOriginal = suggestion.original.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\n            const regex = new RegExp(`(${escapedOriginal})`, 'i')\n            \n            // HTML\n            contractDetails.content = content.replace(regex, suggestion.suggested)\n            aiSuggestions[type].splice(index, 1)\n            ElMessage.success(' ()')\n            return\n          }\n          \n          // 4:  - \n          const normalizeText = (text) => {\n            return text.replace(/\\s+/g, ' ')  // \n                       .replace(/[.,;:!?]/g, '') // \n                       .trim().toLowerCase()  // \n          }\n          \n          const normalizedContent = normalizeText(plainText)\n          const normalizedOriginal = normalizeText(suggestion.original)\n          \n          if (normalizedContent.includes(normalizedOriginal)) {\n            // \n            const pattern = normalizedOriginal.split(/\\s+/).join('\\\\s+')\n            const looseRegex = new RegExp(pattern, 'i')\n            \n            // HTML\n            contractDetails.content = content.replace(looseRegex, suggestion.suggested)\n            aiSuggestions[type].splice(index, 1)\n            ElMessage.success(' ()')\n            return\n          }\n          \n          // \n          ElMessage.warning('')\n          \n        } catch (error) {\n          console.error(':', error)\n          ElMessage.error('')\n        }\n      }\n    }\n\n    // AI\n    // eslint-disable-next-line no-unused-vars\n    const ignoreSuggestion = (type, index) => {\n      aiSuggestions[type].splice(index, 1)\n      ElMessage.info('')\n    }\n\n    // \n    // eslint-disable-next-line no-unused-vars\n    const applyAllSuggestions = async () => {\n      let hasChanges = false;\n      \n      // \n      if (aiSuggestions.syntax.length === 0 && aiSuggestions.terminology.length === 0) {\n        ElMessage.info('');\n        return;\n      }\n      \n      try {\n        const loading = ElLoading.service({\n          lock: true,\n          text: '...',\n          background: 'rgba(0, 0, 0, 0.7)'\n        });\n        \n        // \n        const smartReplace = (content, original, suggested) => {\n          // \n          \n          // 1: \n          if (content.includes(original)) {\n            return {\n              newContent: content.replace(original, suggested),\n              matched: true\n            };\n          }\n          \n          // 2: \n          const lowerContent = content.toLowerCase();\n          const lowerOriginal = original.toLowerCase();\n          \n          if (lowerContent.includes(lowerOriginal)) {\n            // \n            const startIndex = lowerContent.indexOf(lowerOriginal);\n            const actualOriginalText = content.substring(startIndex, startIndex + original.length);\n            return {\n              newContent: content.replace(actualOriginalText, suggested),\n              matched: true\n            };\n          }\n          \n          // 3: HTML\n          const tempDiv = document.createElement('div');\n          tempDiv.innerHTML = content;\n          const plainText = tempDiv.textContent || tempDiv.innerText || '';\n          \n          if (plainText.includes(original)) {\n            // \n            const escapedOriginal = original.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n            const regex = new RegExp(`(${escapedOriginal})`, 'i');\n            \n            // HTML\n            return {\n              newContent: content.replace(regex, suggested),\n              matched: true\n            };\n          }\n          \n          // 4:  - \n          const normalizeText = (text) => {\n            return text.replace(/\\s+/g, ' ')\n                       .replace(/[.,;:!?]/g, '')\n                       .trim().toLowerCase();\n          };\n          \n          const normalizedContent = normalizeText(plainText);\n          const normalizedOriginal = normalizeText(original);\n          \n          if (normalizedContent.includes(normalizedOriginal)) {\n            // \n            const pattern = normalizedOriginal.split(/\\s+/).join('\\\\s+');\n            const looseRegex = new RegExp(pattern, 'i');\n            \n            return {\n              newContent: content.replace(looseRegex, suggested),\n              matched: true\n            };\n          }\n          \n          // \n          return {\n            newContent: content,\n            matched: false\n          };\n        };\n        \n        // \n        let successCount = 0;\n        let failCount = 0;\n        let content = contractDetails.content;\n        const allSuggestions = [...aiSuggestions.syntax, ...aiSuggestions.terminology];\n        \n        for (const suggestion of allSuggestions) {\n          const result = smartReplace(content, suggestion.original, suggestion.suggested);\n          if (result.matched) {\n            content = result.newContent;\n            hasChanges = true;\n            successCount++;\n          } else {\n            failCount++;\n            console.warn(':', suggestion.original);\n          }\n        }\n        \n        // \n        if (hasChanges) {\n          contractDetails.content = content;\n          \n          // \n          aiSuggestions.syntax = [];\n          aiSuggestions.terminology = [];\n          \n          // \n          await saveChanges();\n          \n          ElMessage.success(`${successCount}${failCount}`);\n        } else {\n          ElMessage.warning('');\n        }\n        \n        loading.close();\n        hideAiPanel();\n        \n      } catch (error) {\n        console.error(':', error);\n        ElMessage.error(': ' + (error.message || ''));\n      }\n    }\n\n    // \n    // eslint-disable-next-line no-unused-vars\n    const downloadContract = () => {\n      // \n      isSaving.value = true;\n      const loading = ElLoading.service({\n        lock: true,\n        text: 'Word...',\n        background: 'rgba(0, 0, 0, 0.7)'\n      });\n      \n      // \n      const updateData = {\n        title: contractDetails.title,\n        type: contractDetails.type,\n        amount: contractDetails.amount.replace(/[^\\d.]/g, ''),\n        company: contractDetails.company,\n        sign_date: contractDetails.signDate,\n        start_date: contractDetails.startDate,\n        expire_date: contractDetails.expireDate,\n        content: contractDetails.content\n      };\n      \n      // \n      updateContract(contractId.value, updateData)\n        .then(() => {\n          // API\n          const downloadUrl = `/api/contract/contracts/${contractId.value}/download-docx/`;\n          \n          // CSRF - Cookie\n          const getCookie = (name) => {\n            const value = `; ${document.cookie}`;\n            const parts = value.split(`; ${name}=`);\n            if (parts.length === 2) return parts.pop().split(';').shift();\n            return '';\n          };\n          const csrfToken = getCookie('csrftoken');\n          console.log('CSRF:', csrfToken || '');\n          console.log('Cookie:', document.cookie);\n          \n          // \n          const token = localStorage.getItem('token');\n          console.log(':', token ? '' : '');\n          \n          // axios\n          request({\n            url: downloadUrl,\n            method: 'GET',\n            responseType: 'blob',\n            headers: {\n              'X-CSRFToken': csrfToken,\n              'Authorization': token ? `Bearer ${token}` : ''\n            }\n          })\n          .then(response => {\n            // Blob URL\n            const blob = new Blob([response.data], {\n              type: response.headers['content-type'] || 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n            });\n            const url = window.URL.createObjectURL(blob);\n            const link = document.createElement('a');\n            link.href = url;\n            link.download = `${contractDetails.number || ''}_${contractDetails.title || ''}.docx`;\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n            window.URL.revokeObjectURL(url);\n            \n            ElMessage.success('');\n          })\n          .catch(error => {\n            console.error(':', error);\n            ElMessage.error(`: ${error.message || ''}`);\n          });\n        })\n        .catch(error => {\n          console.error(':', error);\n          ElMessage.error('');\n        })\n        .finally(() => {\n          loading.close();\n          isSaving.value = false;\n        });\n    }\n    \n    // \n    // eslint-disable-next-line no-unused-vars\n    const viewRegulation = (issue) => {\n      // \n      const loadingInstance = ElLoading.service({\n        text: '...',\n        background: 'rgba(255, 255, 255, 0.7)'\n      });\n      \n      // requestAPI\n      request({\n        url: '/api/contract/regulations/query/',\n        method: 'post',\n        data: {\n          issue_title: issue.title,\n          issue_content: issue.current,\n          issue_problem: issue.problem,\n          contract_type: contractDetails.type\n        }\n      })\n      .then(data => {\n        loadingInstance.close();\n        \n        // AI\n        ElMessageBox.alert(\n          `<div class=\"regulation-detail\">\n            <h4>: ${data.regulation || ''}</h4>\n            <div class=\"regulation-content\">\n              <p>${data.regulation_content || ''}</p>\n            </div>\n            <div class=\"regulation-suggestion mt-2\">\n              <h5>:</h5>\n              <p>${data.suggestion || ''}</p>\n            </div>\n          </div>`,\n          '',\n          {\n            dangerouslyUseHTMLString: true,\n            confirmButtonText: '',\n            customClass: 'regulation-dialog'\n          }\n        );\n      })\n      .catch(error => {\n        loadingInstance.close();\n        console.error(':', error);\n        ElMessage.error('');\n      });\n    }\n\n    // \n    watch(() => route.name, (newRouteName, oldRouteName) => {\n      if (oldRouteName === 'ContractDetail' && newRouteName !== 'ContractDetail') {\n        // \n        console.log('')\n        contractId.value = null\n        // \n        isLoading.value = false\n        isSaving.value = false\n        realTimePolishLoading.value = false\n        isChecking.value = false\n      }\n    }, { immediate: true })\n\n    // \n    watch(() => route.params.id, (newId, oldId) => {\n      if (route.name === 'ContractDetail') {\n        if (newId && newId !== 'undefined' && !isNaN(Number(newId))) {\n          // \n          const numNewId = Number(newId);\n          const numOldId = oldId ? Number(oldId) : null;\n          \n          // ID\n          if (numNewId !== numOldId) {\n            console.log('ID', newId)\n            contractId.value = numNewId\n            \n            // \n            const silentLoad = !oldId || document.readyState !== 'complete';\n            getContractDetails(silentLoad)\n          }\n        } else {\n          console.log('ID:', newId)\n          router.push({ name: 'Contract' })\n        }\n      }\n    }, { immediate: true })\n\n    // DOM\n    const addFloatingButton = () => {\n      // \n      const existingButton = document.getElementById('aiFloatingButton')\n      if (existingButton) {\n        document.body.removeChild(existingButton)\n      }\n\n      // \n      const button = document.createElement('div')\n      button.id = 'aiFloatingButton'\n      button.className = 'ai-floating-button'\n      button.innerHTML = `\n        <button class=\"el-button el-button--primary el-button--small is-circle\">\n          <i class=\"el-icon\">\n            <svg viewBox=\"0 0 1024 1024\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path fill=\"currentColor\" d=\"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm0 832a384 384 0 0 0 0-768 384 384 0 0 0 0 768zm-94.656-298.656a32 32 0\n                0 0 45.312 45.312l96-96a32 32 0 0 0 0-45.312l-96-96a32 32 0 0 0-45.312 45.312L466.752 512l-49.408 49.344z\"></path>\n            </svg>\n          </i>\n        </button>\n      `\n      \n      // \n      const style = document.createElement('style')\n      style.textContent = `\n        .ai-floating-button {\n          position: fixed;\n          top: 50%;\n          right: 0;\n          transform: translateY(-50%);\n          z-index: 2000;\n          background-color: #fff;\n          border-top-left-radius: 50%;\n          border-bottom-left-radius: 50%;\n          box-shadow: -2px 0 10px rgba(0,0,0,0.1);\n          padding: 10px 5px 10px 10px;\n          cursor: pointer;\n          transition: all 0.3s ease;\n        }\n        .ai-floating-button:hover {\n          right: 5px;\n        }\n        .ai-floating-button button {\n          margin: 0;\n        }\n      `\n      document.head.appendChild(style)\n      \n      // \n      button.addEventListener('click', () => {\n        showAiSuggestions.value = true\n        console.log('showAiSuggestionstrue')\n      })\n      \n      // body\n      document.body.appendChild(button)\n    }\n    \n    // \n    const updateFloatingButton = () => {\n      const button = document.getElementById('aiFloatingButton')\n      if (!button) return\n      \n      if (activeTab.value === 'contractText' && !showAiSuggestions.value) {\n        button.style.display = 'block'\n      } else {\n        button.style.display = 'none'\n      }\n    }\n    \n    // showAiSuggestionsactiveTab\n    watch([showAiSuggestions, activeTab], () => {\n      updateFloatingButton()\n    })\n    \n    // \n    const adoptInlineEditSuggestion = (suggestionId) => {\n      if (!quillEditor.value) return\n\n      // \n      let suggestion = null\n      let suggestionType = null\n      let suggestionIndex = -1\n\n      // \n      const syntaxIndex = aiSuggestions.syntax.findIndex(s => s.id === suggestionId)\n      if (syntaxIndex !== -1) {\n        suggestion = aiSuggestions.syntax[syntaxIndex]\n        suggestionType = 'syntax'\n        suggestionIndex = syntaxIndex\n      } else {\n        // \n        const termIndex = aiSuggestions.terminology.findIndex(s => s.id === suggestionId)\n        if (termIndex !== -1) {\n          suggestion = aiSuggestions.terminology[termIndex]\n          suggestionType = 'terminology'\n          suggestionIndex = termIndex\n        }\n      }\n\n      if (suggestion) {\n        // Quill\n        const editor = quillEditor.value.getQuill()\n        \n        // \n        const content = editor.getText()\n        let index = content.indexOf(suggestion.original)\n        \n        if (index !== -1) {\n          // \n          editor.deleteText(index, suggestion.original.length)\n          editor.insertText(index, suggestion.suggested)\n          \n          // \n          aiSuggestions[suggestionType].splice(suggestionIndex, 1)\n          \n          ElMessage.success('')\n        }\n      }\n    }\n    \n    // \n    const ignoreInlineEditSuggestion = (suggestionId) => {\n      // \n      let suggestionType = null\n      let suggestionIndex = -1\n\n      // \n      const syntaxIndex = aiSuggestions.syntax.findIndex(s => s.id === suggestionId)\n      if (syntaxIndex !== -1) {\n        suggestionType = 'syntax'\n        suggestionIndex = syntaxIndex\n      } else {\n        // \n        const termIndex = aiSuggestions.terminology.findIndex(s => s.id === suggestionId)\n        if (termIndex !== -1) {\n          suggestionType = 'terminology'\n          suggestionIndex = termIndex\n        }\n      }\n\n      if (suggestionType && suggestionIndex !== -1) {\n        // \n        aiSuggestions[suggestionType].splice(suggestionIndex, 1)\n        ElMessage.info('')\n        \n        // \n        if (quillEditor.value) {\n          // \n        }\n      }\n    }\n\n    // QuillDOM\n    const getQuillEditorElement = () => {\n      try {\n        if (!quillEditor.value) return null;\n        \n        // DOM\n        if (quillEditor.value.$el && typeof quillEditor.value.$el.querySelector === 'function') {\n          // Vue\n          return quillEditor.value.$el.querySelector('.ql-editor');\n        } else if (quillEditor.value.container) {\n          // Quill\n          return quillEditor.value.container.querySelector('.ql-editor');\n        } else if (quillEditor.value.getQuill) {\n          // @vueup/vue-quill\n          const quill = quillEditor.value.getQuill();\n          if (quill && quill.root) {\n            return quill.root;\n          }\n        }\n        \n        // \n        return document.querySelector('.contract-text-editor .ql-editor');\n      } catch (e) {\n        console.error(':', e);\n        return null;\n      }\n    };\n\n    // \n    const clearInlineEditSuggestions = () => {\n      const editorContainer = getQuillEditorElement();\n      if (!editorContainer) {\n        console.warn('');\n        return;\n      }\n      \n      try {\n        // \n        const highlights = editorContainer.querySelectorAll('.suggestion-highlight');\n        \n        // \n        highlights.forEach(span => {\n          const text = span.textContent;\n          const parent = span.parentNode;\n          if (parent) {\n            const textNode = document.createTextNode(text);\n            parent.replaceChild(textNode, span);\n          }\n        });\n      } catch (e) {\n        console.error(':', e);\n      }\n    }\n    \n    // \n    const applyInlineSuggestions = () => {\n      try {\n        if (!quillEditor.value) {\n          console.warn('');\n          return;\n        }\n        \n        // \n        clearInlineEditSuggestions();\n        \n        // ID\n        const allSuggestions = [\n          ...aiSuggestions.syntax.map((s, i) => ({ ...s, id: s.id || `syntax-${i}` })),\n          ...aiSuggestions.terminology.map((s, i) => ({ ...s, id: s.id || `term-${i}` }))\n        ];\n        \n        if (!allSuggestions.length) {\n          return;\n        }\n        \n        // Quill\n        const editorContainer = getQuillEditorElement();\n        if (!editorContainer) {\n          console.warn('');\n          showAiSuggestions.value = true; // \n          return;\n        }\n        \n        // \n        let tooltipContainer = document.getElementById('suggestion-tooltip-container');\n        if (!tooltipContainer) {\n          tooltipContainer = document.createElement('div');\n          tooltipContainer.id = 'suggestion-tooltip-container';\n          tooltipContainer.className = 'suggestion-tooltip';\n          tooltipContainer.style.display = 'none';\n          document.body.appendChild(tooltipContainer);\n        }\n        \n        allSuggestions.forEach(suggestion => {\n          try {\n            // \n            const textContent = editorContainer.textContent || '';\n            const index = textContent.indexOf(suggestion.original);\n            if (index === -1) return;\n            \n            // TreeWalker\n            const walker = document.createTreeWalker(\n              editorContainer,\n              NodeFilter.SHOW_TEXT,\n              null,\n              false\n            );\n            \n            let currentNode;\n            let currentIndex = 0;\n            let found = false;\n            \n            while ((currentNode = walker.nextNode())) {\n              const nodeText = currentNode.nodeValue;\n              const nodeLength = nodeText.length;\n              \n              // \n              if (currentIndex <= index && index < currentIndex + nodeLength) {\n                // \n                const startOffset = index - currentIndex;\n                \n                try {\n                  // \n                  const range = document.createRange();\n                  range.setStart(currentNode, startOffset);\n                  range.setEnd(currentNode, startOffset + suggestion.original.length);\n                  \n                  // span\n                  const span = document.createElement('span');\n                  span.className = 'suggestion-highlight';\n                  span.setAttribute('data-suggestion-id', suggestion.id);\n                  span.setAttribute('data-original', suggestion.original);\n                  span.setAttribute('data-suggested', suggestion.suggested);\n                  span.title = '';\n                  span.style.backgroundColor = 'rgba(255, 217, 102, 0.3)';\n                  span.style.borderBottom = '1px dashed #ffb300';\n                  span.style.cursor = 'pointer';\n                  span.style.padding = '0 2px';\n                  \n                  // span\n                  range.surroundContents(span);\n                  \n                  // \n                  span.addEventListener('click', (e) => {\n                    showSuggestionTooltip(e.target, suggestion, tooltipContainer);\n                  });\n                  \n                  found = true;\n                } catch (rangeError) {\n                  console.error(':', rangeError);\n                }\n                break;\n              }\n              \n              currentIndex += nodeLength;\n            }\n            \n            if (found) {\n              console.log(':', suggestion.id);\n            }\n          } catch (e) {\n            console.error(':', e);\n          }\n        });\n        \n        // \n        if (allSuggestions.length > 0) {\n          ElMessage.info(`${allSuggestions.length}`);\n        }\n      } catch (error) {\n        console.error(':', error);\n        showAiSuggestions.value = true; // \n      }\n    };\n    \n    // \n    const showSuggestionTooltip = (element, suggestion, tooltipContainer) => {\n      const rect = element.getBoundingClientRect()\n      \n      // \n      tooltipContainer.innerHTML = ''\n      \n      // \n      let diffHtml = '';\n      if (window.enhancedDiffDisplay) {\n        // \n        diffHtml = window.enhancedDiffDisplay(suggestion.original, suggestion.suggested);\n      } else {\n        // \n        diffHtml = generateDiff(suggestion.original, suggestion.suggested);\n      }\n      \n      // \n      const content = document.createElement('div')\n      content.className = 'suggestion-tooltip-content'\n      content.innerHTML = `\n        <div class=\"suggestion-tooltip-header\">\n          <span class=\"suggestion-tooltip-title\">AI</span>\n          <span class=\"suggestion-tooltip-close\">&times;</span>\n        </div>\n        <div class=\"suggestion-tooltip-body\">\n          <div class=\"suggestion-comparison\">\n            <div class=\"suggestion-column\">\n              <div class=\"suggestion-label\">:</div>\n              <div class=\"suggestion-original\">${escapeHtml(suggestion.original)}</div>\n            </div>\n            <div class=\"suggestion-divider\"></div>\n            <div class=\"suggestion-column\">\n              <div class=\"suggestion-label\">:</div>\n              <div class=\"suggestion-suggested\">${escapeHtml(suggestion.suggested)}</div>\n            </div>\n          </div>\n          <div class=\"suggestion-diff-container\">\n            <div class=\"suggestion-label\">:</div>\n            <div class=\"suggestion-diff\">${diffHtml}</div>\n          </div>\n          ${suggestion.explanation ? `\n          <div class=\"suggestion-explanation-container\">\n            <div class=\"suggestion-label\">:</div>\n            <div class=\"suggestion-explanation\">${escapeHtml(suggestion.explanation)}</div>\n          </div>` : ''}\n        </div>\n        <div class=\"suggestion-actions\">\n          <button class=\"btn-adopt\"></button>\n          <button class=\"btn-ignore\"></button>\n        </div>\n      `\n      \n      tooltipContainer.appendChild(content)\n      \n      // \n      tooltipContainer.style.position = 'absolute'\n      tooltipContainer.style.zIndex = '9999'\n      tooltipContainer.style.top = `${rect.bottom + window.scrollY + 5}px`\n      tooltipContainer.style.left = `${rect.left + window.scrollX}px`\n      tooltipContainer.style.display = 'block'\n      tooltipContainer.style.maxWidth = '450px'\n      tooltipContainer.style.background = 'white'\n      tooltipContainer.style.boxShadow = '0 2px 12px 0 rgba(0,0,0,.1)'\n      tooltipContainer.style.border = '1px solid #ebeef5'\n      tooltipContainer.style.borderRadius = '4px'\n      tooltipContainer.style.padding = '12px'\n      \n      // \n      const adoptBtn = tooltipContainer.querySelector('.btn-adopt')\n      const ignoreBtn = tooltipContainer.querySelector('.btn-ignore')\n      const closeBtn = tooltipContainer.querySelector('.suggestion-tooltip-close')\n      \n      adoptBtn.addEventListener('click', () => {\n        adoptInlineEditSuggestion(suggestion.id)\n        tooltipContainer.style.display = 'none'\n      })\n      \n      ignoreBtn.addEventListener('click', () => {\n        ignoreInlineEditSuggestion(suggestion.id)\n        tooltipContainer.style.display = 'none'\n      })\n      \n      closeBtn.addEventListener('click', () => {\n        tooltipContainer.style.display = 'none'\n      })\n      \n      // \n      const clickOutsideHandler = (e) => {\n        if (!tooltipContainer.contains(e.target) && \n            !element.contains(e.target)) {\n          tooltipContainer.style.display = 'none'\n          document.removeEventListener('click', clickOutsideHandler)\n        }\n      }\n      \n      // \n      setTimeout(() => {\n        document.addEventListener('click', clickOutsideHandler)\n      }, 100)\n    }\n    \n    // HTML\n    const escapeHtml = (unsafe) => {\n      return unsafe\n        .replace(/&/g, \"&amp;\")\n        .replace(/</g, \"&lt;\")\n        .replace(/>/g, \"&gt;\")\n        .replace(/\"/g, \"&quot;\")\n        .replace(/'/g, \"&#039;\");\n    }\n    \n    // \n    const generateDiff = (original, suggested) => {\n      try {\n        if (!original || !suggested) return ''\n        \n        // \n        const tokenize = (text) => {\n          // \n          return text.split(/([,.!?;:\\s]+|[\\u4e00-\\u9fa5])/g).filter(token => token !== '');\n        };\n        \n        const tokens1 = tokenize(original);\n        const tokens2 = tokenize(suggested);\n        \n        // HTML\n        let html = '<div class=\"diff-content\">';\n        \n        // \n        const matched = new Set(); // \n        \n        // \n        const commonParts = [];\n        for (let i1 = 0; i1 < tokens1.length; i1++) {\n          for (let j1 = 0; j1 < tokens2.length; j1++) {\n            if (tokens1[i1] === tokens2[j1] && !matched.has(`2:${j1}`)) {\n              commonParts.push({ index1: i1, index2: j1, token: tokens1[i1] });\n              matched.add(`2:${j1}`);\n              break;\n            }\n          }\n        }\n        \n        // \n        commonParts.sort((a, b) => a.index2 - b.index2);\n        \n        // \n        let lastIndex1 = -1;\n        let lastIndex2 = -1;\n        \n        for (const part of commonParts) {\n          // \n          if (part.index1 > lastIndex1 + 1) {\n            html += '<span class=\"diff-removed\">';\n            for (let k = lastIndex1 + 1; k < part.index1; k++) {\n              html += escapeHtml(tokens1[k]);\n            }\n            html += '</span>';\n          }\n          \n          // \n          if (part.index2 > lastIndex2 + 1) {\n            html += '<span class=\"diff-added\">';\n            for (let k = lastIndex2 + 1; k < part.index2; k++) {\n              html += escapeHtml(tokens2[k]);\n            }\n            html += '</span>';\n          }\n          \n          // \n          html += `<span class=\"diff-common\">${escapeHtml(part.token)}</span>`;\n          \n          lastIndex1 = part.index1;\n          lastIndex2 = part.index2;\n        }\n        \n        // \n        if (lastIndex1 < tokens1.length - 1) {\n          html += '<span class=\"diff-removed\">';\n          for (let k = lastIndex1 + 1; k < tokens1.length; k++) {\n            html += escapeHtml(tokens1[k]);\n          }\n          html += '</span>';\n        }\n        \n        if (lastIndex2 < tokens2.length - 1) {\n          html += '<span class=\"diff-added\">';\n          for (let k = lastIndex2 + 1; k < tokens2.length; k++) {\n            html += escapeHtml(tokens2[k]);\n          }\n          html += '</span>';\n        }\n        \n        html += '</div>';\n        return html;\n      } catch (e) {\n        console.error(':', e);\n        return `<div class=\"diff-error\">: ${e.message}</div>`;\n      }\n    }\n\n    // \n    const onInlineSuggestionsToggle = (value) => {\n      if (value) {\n        ElMessage.info('')\n        // \n        setTimeout(() => {\n          if (getQuillEditorElement()) {\n            // \n            if (aiSuggestions.syntax.length > 0 || aiSuggestions.terminology.length > 0) {\n              applyInlineSuggestions()\n              ElMessage.success('')\n            } else {\n              ElMessage.info('\"AI\"')\n            }\n          } else {\n            console.warn('');\n            showAiSuggestions.value = true;\n            enableInlineSuggestions.value = false;\n          }\n        }, 100)\n      } else {\n        ElMessage.info('')\n        // \n        setTimeout(() => {\n          try {\n            clearInlineEditSuggestions();\n          } catch (error) {\n            console.error(':', error);\n          }\n        }, 100);\n      }\n    }\n    \n    // \n    const setupKeyboardShortcuts = () => {\n      const handleKeyDown = (e) => {\n        //  Ctrl+Shift+A ()\n        if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'a') {\n          // \n          if (activeTab.value === 'contractText' && !realTimePolishLoading.value) {\n            e.preventDefault(); // \n            manualAnalyzeText();\n            ElMessage.info('AI');\n          }\n        }\n        \n        //  Ctrl+Shift+C ()\n        if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'c') {\n          // \n          if (activeTab.value === 'contractCheck' && !isChecking.value) {\n            e.preventDefault(); // \n            startContractCheck();\n            ElMessage.info('AI');\n          }\n        }\n      };\n      \n      window.addEventListener('keydown', handleKeyDown);\n      \n      // \n      return () => {\n        window.removeEventListener('keydown', handleKeyDown);\n      };\n    };\n\n    // \n    onMounted(async () => {\n      // ID\n      if (route.name === 'ContractDetail' && contractId.value) {\n        console.log(':', contractId.value)\n        // \n        await getContractDetails(true)\n      } else {\n        console.log('ID')\n      }\n      \n      console.log(\"UI\")\n      \n      // \n      setTimeout(() => {\n        if (checkResultArea.value) {\n          console.log('');\n          //  - flex\n          checkResultArea.value.style.display = 'flex';\n          checkResultArea.value.style.flexDirection = 'column';\n          checkResultArea.value.style.overflow = 'hidden';\n          checkResultArea.value.style.height = '100%';\n          \n          //  - flex\n          const scrollWrapper = checkResultArea.value.querySelector('.check-content-scroll-wrapper');\n          if (scrollWrapper) {\n            scrollWrapper.style.flex = '1';\n            scrollWrapper.style.overflowY = 'auto';\n            scrollWrapper.style.padding = '15px';\n            scrollWrapper.style.height = '0'; // flexheight:0flex-grow\n          }\n        }\n      }, 300);\n      \n      // Quill\n      checkAndInitQuill()\n      \n      // \n      nextTick(() => {\n        adjustEditorHeight();\n        // \n        setupResizeListener();\n        \n        // MutationObserverDOM\n        setupMutationObserver();\n      });\n      \n      // \n      if (activeTab.value === 'contractText') {\n        console.log(\"\")\n      }\n      \n      // \n      addFloatingButton()\n      // \n      updateFloatingButton()\n      \n      // \n      const cleanupShortcuts = setupKeyboardShortcuts();\n      \n      // \n      keyboardShortcutsCleanup.value = cleanupShortcuts;\n      \n      // \n      document.addEventListener(\"visibilitychange\", handleVisibilityChange);\n    })\n    \n    // \n    const handleVisibilityChange = () => {\n      if (!document.hidden) {\n        // \n        console.log(\"\");\n        setTimeout(adjustEditorHeight, 100);\n      }\n    };\n    \n    // \n    onUnmounted(() => {\n      const button = document.getElementById('aiFloatingButton')\n      if (button) {\n        document.body.removeChild(button)\n      }\n      \n      // contractId\n      contractId.value = null\n\n      // suggestion tooltip\n      const tooltip = document.querySelector('.ql-suggestion-tooltip')\n      if (tooltip) {\n        document.body.removeChild(tooltip)\n      }\n      \n      // \n      const styleElem = document.getElementById('suggestion-styles')\n      if (styleElem) {\n        document.head.removeChild(styleElem)\n      }\n      \n      // MutationObserver\n      if (quillEditor.value) {\n        try {\n          const editor = quillEditor.value.getQuill()\n          if (editor) {\n            const suggestionModule = editor.getModule('suggestion')\n            if (suggestionModule && typeof suggestionModule.destroy === 'function') {\n              suggestionModule.destroy()\n            }\n          }\n        } catch (error) {\n          console.error(':', error)\n        }\n      }\n      \n      // \n      if (keyboardShortcutsCleanup.value) {\n        keyboardShortcutsCleanup.value();\n      }\n      \n      // \n      cleanupResizeListener();\n      \n      // DOM\n      if (resizeObserver) {\n        resizeObserver.disconnect();\n        resizeObserver = null;\n      }\n      \n      // \n      document.removeEventListener(\"visibilitychange\", handleVisibilityChange);\n    })\n\n    // \n    const keyboardShortcutsCleanup = ref(null);\n    \n    // MutationObserver\n    let resizeObserver = null;\n    \n    // MutationObserverDOM\n    const setupMutationObserver = () => {\n      // observer\n      if (resizeObserver) {\n        resizeObserver.disconnect();\n      }\n      \n      // observer\n      if (activeTab.value === 'contractText' && contractEditContainer.value) {\n        resizeObserver = new MutationObserver(() => {\n          // DOM\n          adjustEditorHeight();\n        });\n        \n        // observer\n        resizeObserver.observe(contractEditContainer.value, {\n          childList: true,\n          subtree: true,\n          attributes: true\n        });\n        \n        console.log('DOM');\n      }\n    };\n    \n    // Quill\n    const checkAndInitQuill = () => {\n      // \n      if (typeof window !== 'undefined' && window.Quill) {\n        try {\n          console.log('Quill')\n          initQuillExtensions()\n          \n          // \n          setTimeout(() => {\n            const editorElement = getQuillEditorElement();\n            if (!editorElement) {\n              console.warn('QuillDOM');\n              enableInlineSuggestions.value = false;\n            }\n          }, 300);\n        } catch (error) {\n          console.error('Quill:', error)\n          enableInlineSuggestions.value = false\n        }\n        return\n      }\n      \n      // Quill\n      console.log('Quill')\n      \n      // CDN\n      const cdnSources = [\n        {\n          js: `${window.location.origin}/static/lib/quill/quill.min.js`,\n          css: `${window.location.origin}/static/lib/quill/quill.snow.css`\n        },\n        {\n          js: 'https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js',\n          css: 'https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css'\n        },\n        {\n          js: 'https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.min.js',\n          css: 'https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.snow.css'\n        },\n        {\n          js: 'https://unpkg.com/quill@1.3.7/dist/quill.min.js',\n          css: 'https://unpkg.com/quill@1.3.7/dist/quill.snow.css'\n        }\n      ];\n      \n      // \n      let currentSourceIndex = 0;\n      const maxRetries = cdnSources.length;\n      \n      // CSS\n      const loadCss = (source) => {\n        return new Promise((resolve, reject) => {\n          // \n          const existingLink = document.getElementById('quill-snow-css');\n          if (existingLink) {\n            document.head.removeChild(existingLink);\n          }\n          \n          const cssLink = document.createElement('link');\n          cssLink.rel = 'stylesheet';\n          cssLink.id = 'quill-snow-css';\n          cssLink.href = source;\n          \n          cssLink.onload = () => {\n            console.log('Quill CSS :', source);\n            resolve();\n          };\n          \n          cssLink.onerror = () => {\n            console.error('Quill CSS :', source);\n            reject();\n          };\n          \n          document.head.appendChild(cssLink);\n        });\n      };\n      \n      // JS\n      const loadJs = (source) => {\n        return new Promise((resolve, reject) => {\n          // \n          const existingScript = document.getElementById('quill-js');\n          if (existingScript) {\n            document.body.removeChild(existingScript);\n          }\n          \n          const script = document.createElement('script');\n          script.src = source;\n          script.id = 'quill-js';\n          script.async = true;\n          \n          script.onload = () => {\n            console.log('Quill JS :', source);\n            resolve();\n          };\n          \n          script.onerror = () => {\n            console.error('Quill JS :', source);\n            reject();\n          };\n          \n          document.body.appendChild(script);\n        });\n      };\n      \n      // \n      const tryNextSource = () => {\n        if (currentSourceIndex >= maxRetries) {\n          console.error('Quill');\n          fallbackToBasicEditor();\n          return;\n        }\n        \n        const source = cdnSources[currentSourceIndex];\n        currentSourceIndex++;\n        \n        console.log(`Quill (${currentSourceIndex}/${maxRetries}):`, source);\n        \n        // CSSJS\n        loadCss(source.css)\n          .then(() => loadJs(source.js))\n          .then(() => {\n            // \n            console.log('Quill');\n            setTimeout(() => {\n              try {\n                if (window.Quill) {\n                  initQuillExtensions();\n                  \n                  // \n                  if (activeTab.value === 'contractText' && enableInlineSuggestions.value) {\n                    setTimeout(applyInlineSuggestions, 500);\n                  }\n                } else {\n                  console.error('QuillQuill');\n                  tryNextSource();\n                }\n              } catch (error) {\n                console.error('Quill:', error);\n                tryNextSource();\n              }\n            }, 300);\n          })\n          .catch(() => {\n            console.log('');\n            tryNextSource();\n          });\n      };\n      \n      // \n      const fallbackToBasicEditor = () => {\n        ElMessage.warning('');\n        enableInlineSuggestions.value = false;\n        showAiSuggestions.value = true;\n        \n        // \n        const inlineStyles = document.createElement('style');\n        inlineStyles.id = 'quill-basic-styles';\n        inlineStyles.textContent = `\n          .ql-container{border:1px solid #ccc;font-family:sans-serif;}\n          .ql-editor{min-height:300px;padding:12px 15px;}\n          .ql-toolbar{border-top:none;border-left:none;border-right:none;border-bottom:1px solid #e0e0e0;background-color:#f8f9fa;}\n        `;\n        document.head.appendChild(inlineStyles);\n      };\n      \n      // \n      tryNextSource();\n    }\n\n    // mounted\n    onMounted(() => {\n      // \n      getContractDetails();\n      \n      // \n      const savedTerminologies = localStorage.getItem('customTerminologies');\n      if (savedTerminologies) {\n        try {\n          customTerminologies.value = JSON.parse(savedTerminologies);\n        } catch (e) {\n          console.error(':', e);\n        }\n      }\n      \n      // \n      const savedPreferences = localStorage.getItem('polishPreferences');\n      if (savedPreferences) {\n        try {\n          const preferences = JSON.parse(savedPreferences);\n          // focus\n          if (preferences.focus && !Array.isArray(preferences.focus)) {\n            preferences.focus = ['grammar', 'terminology'];\n          }\n          Object.assign(polishPreferences, preferences);\n          console.log(':', polishPreferences);\n        } catch (e) {\n          console.error(':', e);\n        }\n      }\n      \n      // \n      const savedCheckPreferences = localStorage.getItem('checkPreferences');\n      if (savedCheckPreferences) {\n        try {\n          const preferences = JSON.parse(savedCheckPreferences);\n          Object.assign(checkPreferences, preferences);\n          console.log(':', checkPreferences);\n        } catch (e) {\n          console.error(':', e);\n        }\n      }\n      \n      // \n      nextTick(() => {\n        adjustEditorHeight();\n        setupMutationObserver();\n        setupResizeListener();\n      });\n    });\n\n    // \n    watch(polishPreferences, (newPreferences) => {\n      console.log(':', newPreferences);\n      localStorage.setItem('polishPreferences', JSON.stringify({\n        style: newPreferences.style, \n        contractType: newPreferences.contractType,\n        focus: newPreferences.focus\n      }));\n    }, { deep: true });\n\n    // \n    watch(() => contractDetails.content, (newContent, oldContent) => {\n      if (newContent && newContent !== oldContent && newContent !== lastAnalyzedContent.value) {\n        debouncedAnalyzeText();\n      }\n    });\n\n    // \n    watch(checkPreferences, (newPreferences) => {\n      console.log(':', newPreferences);\n      localStorage.setItem('checkPreferences', JSON.stringify(newPreferences));\n    }, { deep: true });\n\n    // \n    onBeforeUnmount(() => {\n      // \n      cleanupResizeListener();\n      \n      // \n      document.removeEventListener('visibilitychange', () => {});\n      \n      // DOM\n      if (resizeObserver) {\n        resizeObserver.disconnect();\n      }\n      \n      console.log('');\n    });\n\n    return {\n      activeTab,\n      activeCollapse,\n      activeSuggestionCollapse,\n      contractId,\n      contractDetails,\n      contractTitle,\n      checkResult,\n      aiSuggestions,\n      contractHistory,\n      polishPreferences,\n      checkPreferences,\n      customTerminologies,\n      newTerminology,\n      addCustomTerminology,\n      removeCustomTerminology,\n      isChecking,\n      quillEditor,\n      editorOption,\n      showAiSuggestions,\n      goBack,\n      saveChanges,\n      isLoading,\n      isSaving,\n      isRealTimePolishing,\n      realTimePolishLoading,\n      toggleAiPanelCollapse,\n      isAiPanelCollapsed,\n      adoptInlineEditSuggestion,\n      ignoreInlineEditSuggestion,\n      applyInlineSuggestions,\n      enableInlineSuggestions,\n      onInlineSuggestionsToggle,\n      debouncedAnalyzeText,\n      clearInlineEditSuggestions,\n      showSuggestionTooltip,\n      generateDiff,\n      manualAnalyzeText,\n      estimatedTime,\n      startContractCheck, // \n      viewRegulation, \n      downloadContract, \n      adoptSuggestion, \n      ignoreSuggestion, \n      applyAllSuggestions, \n      hideAiPanel, \n      // \n      contractEditContainer,\n      aiPolishSidebar,\n      editorMainArea,\n      contractCheckContainer, // \n      checkSidebar, // \n      checkResultArea // \n    }\n  }\n}\n</script>\n\n<style scoped>\n.contract-detail-container {\n  padding: 20px;\n  position: relative;\n  overflow-x: hidden; /*  */\n}\n\n.card {\n  border: none;\n  border-radius: 10px;\n  box-shadow: 0 0 10px rgba(0,0,0,0.05);\n  margin-bottom: 20px;\n}\n\n.card-header {\n  background-color: #fff;\n  border-bottom: 1px solid #f0f0f0;\n  padding: 15px 20px;\n  font-weight: 600;\n  font-size: 16px;\n  color: #343a40;\n}\n\n.card-body {\n  padding: 20px;\n  overflow: visible; /* badge */\n}\n\n.contract-text-editor {\n  min-height: 100%;\n  height: 100%;\n  border: 1px solid #e0e0e0;\n  border-radius: 4px;\n  padding: 0;\n  margin-bottom: 0;\n  background-color: #fff;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);\n  display: flex;\n  flex-direction: column;\n}\n\n.contract-text-editor .ql-toolbar {\n  border-top: none;\n  border-left: none;\n  border-right: none;\n  border-bottom: 1px solid #e0e0e0;\n  background-color: #f8f9fa;\n  padding: 8px 15px;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  flex-shrink: 0;\n}\n\n.contract-text-editor .ql-container {\n  border: none;\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  font-family: 'Microsoft YaHei', Arial, sans-serif;\n}\n\n.contract-text-editor .ql-editor {\n  height: 100%;\n  overflow-y: auto;\n  font-size: 14px;\n  line-height: 1.8;\n  padding: 15px 20px;\n  color: #333;\n  scrollbar-width: thin; /* Firefox */\n  scrollbar-color: #ddd transparent; /* Firefox */\n  scroll-behavior: smooth; /*  */\n}\n\n/*  */\n.contract-text-editor .ql-editor::-webkit-scrollbar {\n  width: 6px;\n  background-color: transparent;\n}\n\n.contract-text-editor .ql-editor::-webkit-scrollbar-thumb {\n  background-color: #ddd;\n  border-radius: 3px;\n  transition: background-color 0.2s;\n}\n\n.contract-text-editor .ql-editor::-webkit-scrollbar-thumb:hover {\n  background-color: #bbb;\n}\n\n.check-item {\n  margin-bottom: 15px;\n}\n\n.me-1 {\n  margin-right: 4px;\n}\n\n.me-2 {\n  margin-right: 8px;\n}\n\n.ms-2 {\n  margin-left: 8px;\n}\n\n.mt-3 {\n  margin-top: 16px;\n}\n\n.mb-0 {\n  margin-bottom: 0;\n}\n\n.mb-1 {\n  margin-bottom: 4px;\n}\n\n.mb-2 {\n  margin-bottom: 8px;\n}\n\n.mb-3 {\n  margin-bottom: 16px;\n}\n\n.fs-4 {\n  font-size: 1.5rem;\n}\n\n/* AI */\n.ai-suggestions-panel {\n  position: fixed;\n  top: 70px;  /*  */\n  right: 0;\n  bottom: 20px;\n  width: 320px;\n  background-color: #f8f9fa;\n  border-left: 1px solid #dee2e6;\n  border-top-left-radius: 8px;\n  border-bottom-left-radius: 8px;\n  padding: 15px;\n  overflow-y: auto;\n  transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;\n  opacity: 0;\n  transform: translateX(100%);\n  z-index: 1040;\n  box-shadow: -3px 0 10px rgba(0, 0, 0, 0.05);\n}\n\n.ai-suggestions-panel.show {\n  opacity: 1;\n  transform: translateX(0);\n}\n\n.ai-suggestions-panel.collapsed {\n  transform: translateX(calc(100% - 35px));\n  border-top-left-radius: 20px;\n  border-bottom-left-radius: 20px;\n}\n\n.ai-suggestions-panel.collapsed .panel-header h5,\n.ai-suggestions-panel.collapsed .suggestion-item,\n.ai-suggestions-panel.collapsed > div:not(.panel-header) {\n  display: none;\n}\n\n.ai-suggestions-panel.collapsed .panel-header {\n  writing-mode: vertical-lr;\n  transform: rotate(180deg);\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 5px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.ai-suggestions-panel.collapsed .panel-controls {\n  transform: rotate(180deg);\n  position: absolute;\n  top: 10px;\n  left: 0;\n}\n\n.panel-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 15px;\n}\n\n.panel-controls {\n  display: flex;\n  align-items: center;\n}\n\n.suggestion-item {\n  background-color: #fff;\n  border: 1px solid #e9ecef;\n  border-radius: 5px;\n  padding: 10px;\n  margin-bottom: 10px;\n  font-size: 0.85rem;\n}\n\n.original-text {\n  text-decoration: line-through;\n  color: #dc3545;\n  font-size: 0.8rem;\n  display: block;\n  margin-bottom: 3px;\n}\n\n.suggested-text {\n  color: #28a745;\n  font-weight: bold;\n  display: block;\n  margin-bottom: 5px;\n}\n\n.explanation {\n  font-size: 0.75rem;\n  color: #6c757d;\n  margin-bottom: 8px;\n}\n\n.text-danger {\n  color: #dc3545;\n}\n\n.text-warning {\n  color: #ffc107;\n}\n\n.text-info {\n  color: #17a2b8;\n}\n\n.text-success {\n  color: #28a745;\n}\n\n.text-primary {\n  color: #007bff;\n}\n\n.text-muted {\n  color: #6c757d;\n}\n\n.text-center {\n  text-align: center;\n}\n\n.text-end {\n  text-align: right;\n}\n\n.d-flex {\n  display: flex;\n}\n\n.flex-shrink-0 {\n  flex-shrink: 0;\n}\n\n.flex-grow-1 {\n  flex-grow: 1;\n}\n\n.justify-content-between {\n  justify-content: space-between;\n}\n\n.align-items-center {\n  align-items: center;\n}\n\n.p-3 {\n  padding: 1rem;\n}\n\n.ms-3 {\n  margin-left: 1rem;\n}\n\n.gap-2 {\n  gap: 0.5rem;\n}\n\n.border {\n  border: 1px solid #dee2e6;\n}\n\n.rounded {\n  border-radius: 0.25rem;\n}\n\n.bg-light {\n  background-color: #f8f9fa;\n}\n\n.row {\n  display: flex;\n  flex-wrap: wrap;\n  margin-right: -15px;\n  margin-left: -15px;\n}\n\n.col-md-3 {\n  flex: 0 0 25%;\n  max-width: 25%;\n  padding-left: 15px;\n  padding-right: 15px;\n}\n\n.col-md-6 {\n  flex: 0 0 50%;\n  max-width: 50%;\n  padding-left: 15px;\n  padding-right: 15px;\n}\n\n@media (max-width: 767.98px) {\n  .col-md-3, .col-md-6 {\n    flex: 0 0 100%;\n    max-width: 100%;\n  }\n}\n\n/*  */\n.panel-open-button {\n  position: fixed;\n  top: 50%;\n  right: 0;\n  transform: translateY(-50%);\n  z-index: 1039;\n  padding: 8px 5px 8px 8px;\n  background-color: rgba(255, 255, 255, 0.95);\n  border-top-left-radius: 50%;\n  border-bottom-left-radius: 50%;\n  box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);\n  cursor: pointer;\n  transition: all 0.3s ease;\n}\n\n.panel-open-button:hover {\n  right: 8px;\n  background-color: #f0f9ff;\n}\n\n.panel-open-button .el-button {\n  box-shadow: 0 0 8px rgba(64, 158, 255, 0.2);\n}\n\n/*  */\n.suggestion-highlight {\n  background-color: rgba(255, 217, 102, 0.3);\n  border-bottom: 1px dashed #ffb300;\n  cursor: pointer;\n  position: relative;\n}\n\n.suggestion-highlight:hover {\n  background-color: rgba(255, 217, 102, 0.5);\n}\n\n.ql-suggestion-tooltip {\n  position: absolute;\n  background-color: white;\n  border: 1px solid #e0e0e0;\n  border-radius: 4px;\n  padding: 8px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n  z-index: 1100;\n  width: auto;\n  max-width: 300px;\n}\n\n.suggestion-tooltip-content {\n  display: flex;\n  flex-direction: column;\n  gap: 5px;\n}\n\n.suggestion-original {\n  text-decoration: line-through;\n  color: #dc3545;\n  font-size: 0.9rem;\n}\n\n.suggestion-suggested {\n  color: #28a745;\n  font-weight: bold;\n  font-size: 0.9rem;\n}\n\n.suggestion-arrow {\n  color: #6c757d;\n  margin: 0 5px;\n}\n\n.suggestion-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 5px;\n  margin-top: 5px;\n}\n\n.suggestion-actions button {\n  border: none;\n  border-radius: 3px;\n  padding: 3px 8px;\n  font-size: 0.8rem;\n  cursor: pointer;\n}\n\n.suggestion-actions .btn-adopt {\n  background-color: #28a745;\n  color: white;\n}\n\n.suggestion-actions .btn-ignore {\n  background-color: #6c757d;\n  color: white;\n}\n\n/*  */\n.diff-content {\n  margin: 8px 0;\n  padding: 5px;\n  background: #f8f9fa;\n  border-radius: 4px;\n  line-height: 1.5;\n  font-family: Consolas, Monaco, monospace;\n  word-break: break-word;\n}\n\n.diff-common {\n  color: #333;\n}\n\n.diff-removed {\n  background-color: #ffecec;\n  color: #b30000;\n  text-decoration: line-through;\n  padding: 0 2px;\n  border-radius: 2px;\n}\n\n.diff-added {\n  background-color: #eaffea;\n  color: #006700;\n  font-weight: bold;\n  padding: 0 2px;\n  border-radius: 2px;\n}\n\n.suggestion-diff-container {\n  margin-top: 10px;\n  border-top: 1px solid #eee;\n  padding-top: 8px;\n}\n\n.suggestion-tooltip-content {\n  min-width: 280px;\n  max-width: 450px;\n}\n\n.suggestion-tooltip-header {\n  display: flex;\n  justify-content: space-between;\n  border-bottom: 1px solid #eee;\n  padding-bottom: 5px;\n  margin-bottom: 8px;\n}\n\n.suggestion-tooltip-title {\n  font-weight: bold;\n  color: #333;\n}\n\n.suggestion-tooltip-close {\n  cursor: pointer;\n  color: #999;\n  font-size: 16px;\n}\n\n.suggestion-comparison {\n  display: flex;\n  margin-bottom: 8px;\n}\n\n.suggestion-column {\n  flex: 1;\n  padding: 0 5px;\n}\n\n.suggestion-divider {\n  width: 1px;\n  background-color: #eee;\n  margin: 0 8px;\n}\n\n.suggestion-label {\n  font-size: 0.8rem;\n  color: #666;\n  margin-bottom: 3px;\n  font-weight: bold;\n}\n\n.suggestion-explanation-container {\n  margin-top: 8px;\n  border-top: 1px solid #eee;\n  padding-top: 8px;\n}\n\n.suggestion-explanation {\n  font-style: italic;\n  color: #666;\n  font-size: 0.9rem;\n}\n\n/* AI */\n.ai-polish-sidebar {\n  width: 250px;\n  flex-shrink: 0;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  background: linear-gradient(135deg, #f5f7fa 0%, #eef2f8 100%);\n  border-radius: 10px;\n  padding: 20px 15px;\n  position: relative;\n  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);\n  border: 1px solid #e6ebf5;\n  height: 100%;\n  overflow-y: auto;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(100, 180, 255, 0.3) transparent;\n  scroll-behavior: smooth;\n  overflow-x: hidden;\n}\n\n.ai-polish-button {\n  width: 100%;\n  padding: 12px 15px;\n  font-size: 16px;\n  font-weight: bold;\n  transition: all 0.3s ease;\n  background: linear-gradient(45deg, #409EFF, #64b5f6);\n  box-shadow: 0 4px 10px rgba(64, 158, 255, 0.3);\n  margin: 5px 0 15px;\n  border-radius: 8px;\n  border: none;\n}\n\n.ai-polish-button:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(64, 158, 255, 0.4);\n  background: linear-gradient(45deg, #3a8ee6, #5aadf6);\n}\n\n.ai-polish-button:active {\n  transform: translateY(1px);\n  box-shadow: 0 2px 8px rgba(64, 158, 255, 0.25);\n}\n\n.ai-polish-button-content {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.ai-polish-icon {\n  font-size: 20px;\n  margin-right: 8px;\n  animation: glow 2s infinite alternate;\n}\n\n@keyframes glow {\n  0% {\n    opacity: 0.8;\n    filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.6));\n  }\n  100% {\n    opacity: 1;\n    filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.9));\n  }\n}\n\n.ai-polish-info {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 8px;\n  margin: 5px 0 15px;\n  width: 100%;\n}\n\n.time-estimate, .shortcut-hint {\n  display: flex;\n  align-items: center;\n  color: #606266;\n  font-size: 13px;\n  background-color: rgba(255, 255, 255, 0.7);\n  padding: 6px 12px;\n  border-radius: 6px;\n  width: 100%;\n  justify-content: flex-start;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\n}\n\n.time-estimate .el-icon, .shortcut-hint .el-icon {\n  color: #409EFF;\n  margin-right: 8px;\n  font-size: 16px;\n}\n\n.ai-polish-features {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  gap: 10px;\n  margin-top: 10px;\n  width: 100%;\n  padding: 12px 15px;\n  background-color: rgba(255, 255, 255, 0.8);\n  border-radius: 8px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\n}\n\n.feature-item {\n  display: flex;\n  align-items: center;\n  color: #303133;\n  font-size: 14px;\n  width: 100%;\n  padding: 5px 0;\n}\n\n.feature-item .el-icon {\n  color: #67c23a;\n  margin-right: 10px;\n  font-size: 18px;\n  background-color: rgba(103, 194, 58, 0.1);\n  padding: 4px;\n  border-radius: 50%;\n}\n\n/*  */\n.contract-edit-container {\n  display: flex;\n  gap: 15px;\n  margin-bottom: 20px;\n  margin-top: 5px;\n  height: calc(100vh - 220px); /* 280px220px */\n  min-height: 600px; /*  */\n  transition: height 0.3s ease;\n  overflow: visible;\n}\n\n.editor-main-area {\n  flex: 1;\n  min-width: 0;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  transition: height 0.3s ease;\n  border-radius: 10px;\n  overflow: hidden;\n  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);\n}\n\n/*  */\n.contract-text-editor:focus-within {\n  box-shadow: 0 2px 15px rgba(64, 158, 255, 0.15);\n  border-color: rgba(64, 158, 255, 0.5);\n}\n\n/*  */\n.ai-polish-sidebar::-webkit-scrollbar {\n  width: 6px;\n  background-color: transparent;\n}\n\n.ai-polish-sidebar::-webkit-scrollbar-thumb {\n  background-color: rgba(100, 180, 255, 0.3);\n  border-radius: 3px;\n  transition: background-color 0.2s;\n}\n\n.ai-polish-sidebar::-webkit-scrollbar-thumb:hover {\n  background-color: rgba(100, 180, 255, 0.5);\n}\n\n/* badge */\n.contract-edit-wrapper {\n  position: relative;\n  margin-bottom: 20px;\n}\n\n/*  */\n.check-sidebar {\n  background: linear-gradient(135deg, #f6f8fa 0%, #eef5ff 100%);\n}\n\n.check-result-card {\n  background-color: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);\n  padding: 20px; /*  */\n  margin-bottom: 20px; /*  */\n  flex-shrink: 0; /*  */\n}\n\n.check-result-area {\n  flex: 1;\n  position: relative;\n  height: 100%;\n  /* overflowel-scrollbar */\n}\n\n/*  */\n.check-content-scroll-wrapper {\n  flex: 1;\n  overflow-y: auto;\n  padding: 15px 20px;\n  display: flex;\n  flex-direction: column;\n  gap: 15px;\n  height: 0; /* flexheight:0flex-grow */\n  scrollbar-width: thin;\n  scrollbar-color: #ddd transparent;\n}\n\n.check-content-scroll-wrapper::-webkit-scrollbar {\n  width: 6px;\n  background-color: transparent;\n}\n\n.check-content-scroll-wrapper::-webkit-scrollbar-thumb {\n  background-color: #ddd;\n  border-radius: 3px;\n  transition: background-color 0.2s;\n}\n\n.check-content-scroll-wrapper::-webkit-scrollbar-thumb:hover {\n  background-color: #bbb;\n}\n\n.check-result-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 15px;\n  border-bottom: 1px solid #f0f0f5;\n  padding-bottom: 12px; /*  */\n}\n\n.check-result-header h6 {\n  font-size: 17px; /*  */\n  font-weight: 600;\n  color: #303133;\n}\n\n.check-result-stats {\n  display: flex;\n  justify-content: space-between;\n  flex-wrap: wrap;\n}\n\n.stat-item {\n  flex: 1;\n  min-width: 100px;\n  text-align: center;\n  padding: 10px;\n  border-radius: 6px;\n  background-color: #f9f9fa;\n  margin: 0 5px;\n}\n\n.stat-value {\n  font-size: 24px;\n  font-weight: 700;\n  margin-bottom: 5px;\n  color: #409EFF;\n}\n\n.stat-value.danger {\n  color: #F56C6C;\n}\n\n.stat-value.warning {\n  color: #E6A23C;\n}\n\n.stat-value.info {\n  color: #909399;\n}\n\n.stat-label {\n  font-size: 13px;\n  color: #606266;\n}\n\n.check-result-details {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  background-color: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);\n  overflow: hidden;\n}\n\n.check-collapse {\n  border: none;\n}\n\n.collapse-header {\n  display: flex;\n  align-items: center;\n  font-size: 14px;\n  font-weight: 500;\n  \n  .el-icon {\n    margin-right: 8px;\n  }\n}\n\n.check-issue-card {\n  background-color: #fafafa;\n  border-radius: 8px; /*  */\n  padding: 18px; /*  */\n  margin-bottom: 20px; /*  */\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05); /*  */\n  \n  &:last-child {\n    margin-bottom: 0;\n  }\n}\n\n.issue-header {\n  display: flex;\n  align-items: center;\n  margin-bottom: 15px; /*  */\n  \n  .el-icon {\n    margin-right: 12px; /*  */\n    font-size: 20px; /*  */\n  }\n  \n  h6 {\n    margin: 0;\n    font-size: 16px; /*  */\n    font-weight: 600;\n  }\n}\n\n.issue-content {\n  margin-bottom: 15px;\n}\n\n.issue-field {\n  margin-bottom: 8px;\n  \n  &:last-child {\n    margin-bottom: 0;\n  }\n}\n\n.field-label {\n  font-size: 13px;\n  color: #606266;\n  font-weight: 500;\n  margin-bottom: 4px;\n}\n\n.field-value {\n  font-size: 14px;\n  line-height: 1.5;\n  color: #333;\n  background-color: white;\n  padding: 8px 12px;\n  border-radius: 4px;\n  border: 1px solid #eee;\n}\n\n.issue-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n}\n\n.empty-result {\n  padding: 30px 0;\n  color: #909399;\n  text-align: center;\n}\n\n.check-options {\n  .el-checkbox {\n    margin-right: 0;\n    margin-left: 0;\n    display: block;\n    margin-bottom: 8px;\n    \n    &:last-child {\n      margin-bottom: 0;\n    }\n  }\n}\n\n/*  */\n.check-keyboard-shortcut {\n  display: none;\n}\n\n/*  */\n.check-sidebar {\n  .preference-option {\n    margin-bottom: 12px;\n    \n    .el-select {\n      width: 100%;  /* 100% */\n      margin-top: 6px;  /*  */\n    }\n    \n    span {\n      display: block;  /*  */\n      margin-bottom: 4px;\n      font-weight: 500;\n    }\n  }\n  \n  .check-options {\n    padding: 5px 0;\n    \n    .el-checkbox {\n      height: 32px;\n      display: flex;\n      align-items: center;\n      border-radius: 4px;\n      transition: background-color 0.2s;\n      padding: 0 8px;\n      margin-bottom: 6px;  /*  */\n      \n      &:hover {\n        background-color: rgba(64, 158, 255, 0.08);\n      }\n      \n      &:last-child {\n        margin-bottom: 0;  /*  */\n      }\n    }\n  }\n  \n  .ai-polish-button {\n    margin-bottom: 20px; /*  */\n  }\n\n  /*  */\n  .ai-polish-personalization {\n    background-color: #f7f9ff;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);\n    width: 100%;\n    padding: 15px;\n    margin: 12px 0;\n    \n    .personalization-title {\n      font-size: 14px;\n      margin-bottom: 12px;\n      padding-bottom: 6px;  /*  */\n      \n      &:after {\n        width: 30px;  /*  */\n        height: 2px;\n      }\n    }\n    \n    .personalization-section {\n      margin-bottom: 14px;\n      background-color: rgba(255, 255, 255, 0.6);\n      border-radius: 6px;\n      padding: 10px;\n      \n      &:last-child {\n        margin-bottom: 0;  /*  */\n      }\n      \n      .section-header {\n        margin-bottom: 8px;\n        .el-icon {\n          font-size: 15px;\n        }\n        \n        span {\n          font-size: 13px;  /*  */\n        }\n      }\n    }\n  }\n  \n  /*  */\n  .ai-polish-features {\n    margin-top: 12px;\n    \n    .feature-item {\n      padding: 4px 0;  /*  */\n      \n      &:last-child {\n        padding-bottom: 0;\n      }\n    }\n  }\n  \n  /*  */\n  width: 240px;  /*  */\n}\n\n/* scrollbar */\n.contract-check-scrollbar {\n  height: 100% !important;\n}\n\n.contract-check-scrollbar .el-scrollbar__wrap {\n  overflow-x: hidden;\n}\n</style>\n\n<style>\n/*  */\n.regulation-dialog .el-message-box__content {\n  max-height: 70vh;\n  overflow-y: auto;\n}\n\n.regulation-detail h4 {\n  color: #409EFF;\n  margin-bottom: 15px;\n  border-bottom: 1px solid #ebeef5;\n  padding-bottom: 10px;\n}\n\n.regulation-detail .regulation-content {\n  background-color: #f8f9fa;\n  padding: 12px;\n  border-left: 4px solid #409EFF;\n  border-radius: 4px;\n  margin: 10px 0;\n}\n\n.regulation-detail .regulation-suggestion h5 {\n  color: #67c23a;\n  margin-bottom: 10px;\n}\n\n.regulation-detail .regulation-suggestion p {\n  background-color: #f0f9eb;\n  padding: 10px;\n  border-left: 4px solid #67c23a;\n  border-radius: 4px;\n}\n</style> \n\n<style lang=\"scss\" scoped>\n// ... existing code ...\n\n/*  */\n.ai-polish-personalization {\n  background-color: #f9f9ff;\n  border-radius: 8px;\n  padding: 15px;\n  margin: 15px 0;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);\n}\n\n.personalization-title {\n  font-size: 14px;\n  font-weight: 600;\n  color: #333;\n  margin-bottom: 15px;\n  position: relative;\n  padding-bottom: 8px;\n  \n  &:after {\n    content: '';\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    width: 40px;\n    height: 2px;\n    background-color: #409EFF;\n  }\n}\n\n.personalization-section {\n  margin-bottom: 15px;\n  \n  &:last-child {\n    margin-bottom: 0;\n  }\n}\n\n.section-header {\n  display: flex;\n  align-items: center;\n  margin-bottom: 10px;\n  font-size: 13px;\n  font-weight: 500;\n  color: #606266;\n  \n  .el-icon {\n    margin-right: 6px;\n    color: #409EFF;\n  }\n}\n\n.preference-option {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 10px;\n  font-size: 13px;\n  \n  span {\n    color: #606266;\n  }\n  \n  .el-select {\n    width: 60%;\n  }\n}\n\n.optimization-options {\n  .el-checkbox-group {\n    display: flex;\n    flex-wrap: wrap;\n    \n    .el-checkbox {\n      margin-right: 15px;\n      margin-bottom: 8px;\n      font-size: 13px;\n    }\n  }\n}\n\n.terminology-manager {\n  .terminology-input {\n    margin-bottom: 10px;\n  }\n  \n  .terminology-list {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 6px;\n    margin-top: 8px;\n    \n    .terminology-tag {\n      margin-right: 5px;\n      margin-bottom: 5px;\n    }\n  }\n  \n  .terminology-empty {\n    font-size: 12px;\n    color: #909399;\n    text-align: center;\n    padding: 8px 0;\n  }\n}\n// ... existing code ...\n\n/*  */\n.check-sidebar {\n  background: linear-gradient(135deg, #f6f8fa 0%, #eef5ff 100%);\n}\n\n.check-result-area {\n  display: flex;\n  flex-direction: column;\n  gap: 15px;\n  overflow-y: auto;\n  padding: 0;\n  background-color: #f9f9fc;\n}\n\n.check-result-card {\n  background-color: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);\n  padding: 15px 20px;\n}\n\n.check-result-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 15px;\n  border-bottom: 1px solid #f0f0f5;\n  padding-bottom: 10px;\n}\n\n.check-result-header h6 {\n  font-size: 16px;\n  font-weight: 600;\n  color: #333;\n  margin: 0;\n}\n\n.check-result-stats {\n  display: flex;\n  justify-content: space-between;\n  flex-wrap: wrap;\n}\n\n.stat-item {\n  flex: 1;\n  min-width: 100px;\n  text-align: center;\n  padding: 10px;\n  border-radius: 6px;\n  background-color: #f9f9fa;\n  margin: 0 5px;\n}\n\n.stat-value {\n  font-size: 24px;\n  font-weight: 700;\n  margin-bottom: 5px;\n  color: #409EFF;\n}\n\n.stat-value.danger {\n  color: #F56C6C;\n}\n\n.stat-value.warning {\n  color: #E6A23C;\n}\n\n.stat-value.info {\n  color: #909399;\n}\n\n.stat-label {\n  font-size: 13px;\n  color: #606266;\n}\n\n.check-result-details {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  background-color: white;\n  border-radius: 8px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.05);\n  overflow: hidden;\n}\n\n.check-collapse {\n  border: none;\n}\n\n.collapse-header {\n  display: flex;\n  align-items: center;\n  font-size: 14px;\n  font-weight: 500;\n  \n  .el-icon {\n    margin-right: 8px;\n  }\n}\n\n.check-issue-card {\n  background-color: #fafafa;\n  border-radius: 6px;\n  padding: 15px;\n  margin-bottom: 15px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);\n  \n  &:last-child {\n    margin-bottom: 0;\n  }\n}\n\n.issue-header {\n  display: flex;\n  align-items: center;\n  margin-bottom: 12px;\n  \n  .el-icon {\n    margin-right: 10px;\n  }\n  \n  h6 {\n    margin: 0;\n    font-size: 15px;\n    font-weight: 600;\n  }\n}\n\n.issue-content {\n  margin-bottom: 15px;\n}\n\n.issue-field {\n  margin-bottom: 8px;\n  \n  &:last-child {\n    margin-bottom: 0;\n  }\n}\n\n.field-label {\n  font-size: 13px;\n  color: #606266;\n  font-weight: 500;\n  margin-bottom: 4px;\n}\n\n.field-value {\n  font-size: 14px;\n  line-height: 1.5;\n  color: #333;\n  background-color: white;\n  padding: 8px 12px;\n  border-radius: 4px;\n  border: 1px solid #eee;\n}\n\n.issue-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n}\n\n.empty-result {\n  padding: 30px 0;\n  color: #909399;\n  text-align: center;\n}\n\n.check-options {\n  .el-checkbox {\n    margin-right: 0;\n    margin-left: 0;\n    display: block;\n    margin-bottom: 8px;\n    \n    &:last-child {\n      margin-bottom: 0;\n    }\n  }\n}\n\n/*  */\n.check-keyboard-shortcut {\n  display: none;\n}\n\n/*  */\n.check-sidebar {\n  .preference-option {\n    margin-bottom: 12px;\n    \n    .el-select {\n      width: 100%;  /* 100% */\n      margin-top: 6px;  /*  */\n    }\n    \n    span {\n      display: block;  /*  */\n      margin-bottom: 4px;\n      font-weight: 500;\n    }\n  }\n  \n  .check-options {\n    padding: 5px 0;\n    \n    .el-checkbox {\n      height: 32px;\n      display: flex;\n      align-items: center;\n      border-radius: 4px;\n      transition: background-color 0.2s;\n      padding: 0 8px;\n      margin-bottom: 6px;  /*  */\n      \n      &:hover {\n        background-color: rgba(64, 158, 255, 0.08);\n      }\n      \n      &:last-child {\n        margin-bottom: 0;  /*  */\n      }\n    }\n  }\n  \n  .ai-polish-button {\n    margin-bottom: 20px; /*  */\n  }\n\n  /*  */\n  .ai-polish-personalization {\n    background-color: #f7f9ff;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);\n    width: 100%;\n    padding: 15px;\n    margin: 12px 0;\n    \n    .personalization-title {\n      font-size: 14px;\n      margin-bottom: 12px;\n      padding-bottom: 6px;  /*  */\n      \n      &:after {\n        width: 30px;  /*  */\n        height: 2px;\n      }\n    }\n    \n    .personalization-section {\n      margin-bottom: 14px;\n      background-color: rgba(255, 255, 255, 0.6);\n      border-radius: 6px;\n      padding: 10px;\n      \n      &:last-child {\n        margin-bottom: 0;  /*  */\n      }\n      \n      .section-header {\n        margin-bottom: 8px;\n        .el-icon {\n          font-size: 15px;\n        }\n        \n        span {\n          font-size: 13px;  /*  */\n        }\n      }\n    }\n  }\n  \n  /*  */\n  .ai-polish-features {\n    margin-top: 12px;\n    \n    .feature-item {\n      padding: 4px 0;  /*  */\n      \n      &:last-child {\n        padding-bottom: 0;\n      }\n    }\n  }\n  \n  /*  */\n  width: 240px;  /*  */\n}\n// ... existing code ...\n</style> \n\n<style lang=\"scss\">\n/*  */\n:deep([data-theme=\"dark\"]), :deep(body.is-dark) {\n  /*  */\n  .contract-detail-container {\n    background-color: var(--bg-color) !important;\n    color: var(--text-color) !important;\n  }\n  \n  .card {\n    background-color: var(--bg-color) !important;\n    color: var(--text-color) !important;\n    border-color: var(--border-color) !important;\n    box-shadow: 0 0 10px rgba(0, 0, 0, 0.15) !important;\n  }\n\n  .card-header {\n    background-color: var(--bg-color) !important;\n    color: var(--text-color) !important;\n    border-bottom-color: var(--border-color) !important;\n  }\n\n  .card-body {\n    background-color: var(--bg-color) !important;\n    color: var(--text-color) !important;\n  }\n  \n  /*  -  */\n  .contract-detail-container .el-card,\n  .contract-detail-container .el-form,\n  .contract-detail-container .row {\n    background-color: var(--bg-color) !important;\n    color: var(--text-color) !important;\n  }\n  \n  /*  */\n  :deep(.el-form) {\n    background-color: var(--bg-color) !important;\n    \n    .el-form-item {\n      background-color: var(--bg-color) !important;\n      \n      .el-form-item__label {\n        color: var(--text-color) !important;\n      }\n      \n      .el-form-item__content {\n        background-color: var(--bg-color) !important;\n      }\n    }\n  }\n  \n  /*  */\n  :deep(.el-input),\n  :deep(.el-select),\n  :deep(.el-date-editor) {\n    background-color: var(--bg-color) !important;\n    \n    .el-input__wrapper {\n      background-color: var(--bg-color) !important;\n      box-shadow: 0 0 0 1px var(--border-color) inset !important;\n    }\n    \n    .el-input__inner {\n      background-color: var(--bg-color) !important;\n      color: var(--text-color) !important;\n    }\n  }\n  \n  /*  */\n  :deep(.el-tabs) {\n    background-color: var(--bg-color) !important;\n    \n    .el-tabs__header {\n      background-color: var(--bg-color) !important;\n      border-bottom-color: var(--border-color) !important;\n    }\n    \n    .el-tabs__nav-wrap::after {\n      background-color: var(--border-color) !important;\n    }\n    \n    .el-tabs__item {\n      color: var(--text-color-secondary) !important;\n    }\n    \n    .el-tabs__item.is-active {\n      color: var(--primary-color) !important;\n    }\n    \n    .el-tabs__content {\n      background-color: var(--bg-color) !important;\n    }\n    \n    .el-tab-pane {\n      background-color: var(--bg-color) !important;\n      color: var(--text-color) !important;\n    }\n  }\n  \n  /*  */\n  .contract-edit-wrapper,\n  .contract-edit-container,\n  .editor-main-area,\n  .check-result-area {\n    background-color: var(--bg-color) !important;\n    color: var(--text-color) !important;\n  }\n  \n  /*  */\n  #contractTitleHeader {\n    color: var(--text-color) !important;\n  }\n  \n  h5, h6 {\n    color: var(--text-color) !important;\n  }\n  \n  /*  */\n  .row, .col-md-6 {\n    background-color: var(--bg-color) !important;\n  }\n  \n  /*  */\n  .contract-text-editor {\n    background-color: var(--bg-color) !important;\n    color: var(--text-color) !important;\n    border-color: var(--border-color) !important;\n    box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.15) !important;\n    \n    :deep(.ql-toolbar) {\n      background-color: var(--bg-color-secondary) !important;\n      border-color: var(--border-color) !important;\n    }\n    \n    :deep(.ql-container) {\n      background-color: var(--bg-color) !important;\n      color: var(--text-color) !important;\n      border-color: var(--border-color) !important;\n    }\n    \n    :deep(.ql-editor) {\n      background-color: var(--bg-color) !important;\n      color: var(--text-color) !important;\n    }\n  }\n  \n  /* AI */\n  .ai-polish-sidebar,\n  .check-sidebar {\n    background: linear-gradient(135deg, var(--bg-color-secondary) 0%, var(--bg-color-tertiary) 100%) !important;\n    border-color: var(--border-color) !important;\n  }\n  \n  /*  */\n  :deep(.el-empty) {\n    background-color: transparent !important;\n    \n    .el-empty__image, \n    .el-empty__description {\n      color: var(--text-color-secondary) !important;\n    }\n  }\n  \n  /*  */\n  :deep(.el-timeline) {\n    background-color: var(--bg-color) !important;\n    color: var(--text-color) !important;\n    \n    .el-timeline-item__tail {\n      border-left-color: var(--border-color) !important;\n    }\n    \n    .el-timeline-item__node {\n      background-color: var(--primary-color) !important;\n    }\n    \n    .el-timeline-item__content {\n      color: var(--text-color) !important;\n    }\n    \n    .el-timeline-item__timestamp {\n      color: var(--text-color-secondary) !important;\n    }\n  }\n  \n  /*  */\n  hr {\n    border-color: var(--border-color) !important;\n    background-color: var(--border-color) !important;\n  }\n  \n  /*  */\n  :deep(.el-dropdown-menu) {\n    background-color: var(--bg-color-secondary) !important;\n    border-color: var(--border-color) !important;\n    \n    .el-dropdown-menu__item {\n      color: var(--text-color) !important;\n    }\n    \n    .el-dropdown-menu__item:hover {\n      background-color: var(--bg-color-tertiary) !important;\n    }\n  }\n  \n  /*  */\n  :deep(.el-dialog),\n  :deep(.el-message-box) {\n    background-color: var(--bg-color) !important;\n    border-color: var(--border-color) !important;\n    \n    .el-dialog__header,\n    .el-message-box__header {\n      background-color: var(--bg-color) !important;\n      border-bottom-color: var(--border-color) !important;\n    }\n    \n    .el-dialog__title,\n    .el-message-box__title {\n      color: var(--text-color) !important;\n    }\n    \n    .el-dialog__body,\n    .el-message-box__content {\n      background-color: var(--bg-color) !important;\n      color: var(--text-color) !important;\n    }\n    \n    .el-dialog__footer,\n    .el-message-box__btns {\n      background-color: var(--bg-color) !important;\n      border-top-color: var(--border-color) !important;\n    }\n  }\n  \n  /*  */\n  .ai-polish-personalization {\n    background-color: var(--bg-color-secondary) !important;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;\n    \n    .personalization-section {\n      background-color: var(--bg-color) !important;\n      \n      .section-header {\n        color: var(--text-color) !important;\n        \n        span {\n          color: var(--text-color) !important;\n        }\n      }\n    }\n    \n    .personalization-title {\n      color: var(--text-color) !important;\n    }\n  }\n  \n  /*  */\n  .check-result-card,\n  .check-result-details,\n  .check-issue-card {\n    background-color: var(--bg-color-secondary) !important;\n    box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.2) !important;\n  }\n  \n  .check-content-inner {\n    background-color: var(--bg-color) !important;\n  }\n  \n  .check-collapse {\n    background-color: transparent !important;\n    \n    :deep(.el-collapse-item__header) {\n      background-color: var(--bg-color-secondary) !important;\n      color: var(--text-color) !important;\n      border-bottom-color: var(--border-color) !important;\n    }\n    \n    :deep(.el-collapse-item__content) {\n      background-color: var(--bg-color-secondary) !important;\n      color: var(--text-color) !important;\n    }\n  }\n  \n  /*  */\n  .stat-item {\n    background-color: var(--bg-color) !important;\n  }\n  \n  /*  */\n  :deep(.el-tooltip__popper) {\n    background-color: var(--bg-color-secondary) !important;\n    border-color: var(--border-color) !important;\n    color: var(--text-color) !important;\n  }\n  \n  /*  */\n  .contract-check-scrollbar {\n    background-color: var(--bg-color) !important;\n    \n    :deep(.el-scrollbar__view) {\n      background-color: var(--bg-color) !important;\n    }\n    \n    :deep(.el-scrollbar__bar) {\n      background-color: var(--bg-color-tertiary) !important;\n    }\n  }\n  \n  /*  */\n  .text-end {\n    background-color: var(--bg-color) !important;\n  }\n\n  /*  */\n  :deep(.el-select-dropdown) {\n    background-color: var(--bg-color-secondary) !important;\n    border-color: var(--border-color) !important;\n    \n    .el-select-dropdown__item {\n      color: var(--text-color) !important;\n    }\n    \n    .el-select-dropdown__item.hover, \n    .el-select-dropdown__item:hover {\n      background-color: var(--bg-color-tertiary) !important;\n    }\n    \n    .el-select-dropdown__item.selected {\n      color: var(--primary-color) !important;\n      background-color: rgba(64, 158, 255, 0.1) !important;\n    }\n  }\n  \n  /*  */\n  :deep(.el-picker-panel) {\n    background-color: var(--bg-color-secondary) !important;\n    border-color: var(--border-color) !important;\n    color: var(--text-color) !important;\n    \n    .el-date-picker__header {\n      background-color: var(--bg-color-secondary) !important;\n      color: var(--text-color) !important;\n    }\n    \n    .el-date-table {\n      background-color: var(--bg-color-secondary) !important;\n      color: var(--text-color) !important;\n      \n      th, td {\n        background-color: var(--bg-color-secondary) !important;\n        color: var(--text-color) !important;\n      }\n      \n      td.current:not(.disabled) span {\n        background-color: var(--primary-color) !important;\n        color: white !important;\n      }\n      \n      td.available:hover {\n        color: var(--primary-color) !important;\n      }\n      \n      td.next-month, td.prev-month {\n        color: var(--text-color-tertiary) !important;\n      }\n    }\n  }\n  \n  /*  */\n  :deep(.el-checkbox) {\n    .el-checkbox__label {\n      color: var(--text-color) !important;\n    }\n    \n    .el-checkbox__input.is-checked .el-checkbox__inner {\n      background-color: var(--primary-color) !important;\n      border-color: var(--primary-color) !important;\n    }\n    \n    .el-checkbox__inner {\n      background-color: var(--bg-color) !important;\n      border-color: var(--border-color) !important;\n    }\n  }\n  \n  /*  */\n  :deep(.el-tag) {\n    background-color: rgba(64, 158, 255, 0.1) !important;\n    border-color: rgba(64, 158, 255, 0.2) !important;\n    color: var(--primary-color) !important;\n    \n    &.el-tag--danger {\n      background-color: rgba(245, 108, 108, 0.1) !important;\n      border-color: rgba(245, 108, 108, 0.2) !important;\n      color: #F56C6C !important;\n    }\n    \n    &.el-tag--success {\n      background-color: rgba(103, 194, 58, 0.1) !important;\n      border-color: rgba(103, 194, 58, 0.2) !important;\n      color: #67C23A !important;\n    }\n    \n    &.el-tag--warning {\n      background-color: rgba(230, 162, 60, 0.1) !important;\n      border-color: rgba(230, 162, 60, 0.2) !important;\n      color: #E6A23C !important;\n    }\n    \n    &.el-tag--info {\n      background-color: rgba(144, 147, 153, 0.1) !important;\n      border-color: rgba(144, 147, 153, 0.2) !important;\n      color: #909399 !important;\n    }\n  }\n  \n  /*  */\n  :deep(.el-switch) {\n    .el-switch__core {\n      background-color: var(--border-color) !important;\n    }\n    \n    &.is-checked .el-switch__core {\n      background-color: var(--primary-color) !important;\n    }\n  }\n}\n</style> \n\n<style lang=\"scss\">\n/*  -  */\nhtml[data-theme=\"dark\"] body, body.is-dark {\n  /*  */\n  .contract-detail-container,\n  .contract-detail-container *:not([class*=\"el-icon\"]):not(i):not(svg):not(path) {\n    background-color: var(--bg-color) !important;\n    color: var(--text-color) !important;\n  }\n  \n  .contract-detail-container {\n    background-color: var(--bg-color) !important;\n    color: var(--text-color) !important;\n    \n    /*  */\n    .card, .el-card {\n      background-color: var(--bg-color) !important;\n      color: var(--text-color) !important;\n      border-color: var(--border-color) !important;\n      box-shadow: 0 0 10px rgba(0, 0, 0, 0.15) !important;\n      \n      .card-header, .el-card__header {\n        background-color: var(--bg-color) !important;\n        color: var(--text-color) !important;\n        border-bottom-color: var(--border-color) !important;\n      }\n      \n      .card-body, .el-card__body {\n        background-color: var(--bg-color) !important;\n        color: var(--text-color) !important;\n      }\n    }\n    \n    /*  */\n    .el-tabs {\n      background-color: var(--bg-color) !important;\n      \n      .el-tabs__header {\n        background-color: var(--bg-color) !important;\n        border-bottom-color: var(--border-color) !important;\n      }\n      \n      .el-tabs__nav-wrap::after {\n        background-color: var(--border-color) !important;\n      }\n      \n      .el-tabs__item {\n        color: var(--text-color-secondary) !important;\n      }\n      \n      .el-tabs__item.is-active {\n        color: var(--primary-color) !important;\n      }\n      \n      .el-tabs__content {\n        background-color: var(--bg-color) !important;\n      }\n      \n      .el-tab-pane {\n        background-color: var(--bg-color) !important;\n        color: var(--text-color) !important;\n      }\n    }\n    \n    /*  */\n    .el-form {\n      background-color: var(--bg-color) !important;\n      \n      .el-form-item {\n        background-color: var(--bg-color) !important;\n        \n        .el-form-item__label {\n          color: var(--text-color) !important;\n        }\n        \n        .el-form-item__content {\n          background-color: var(--bg-color) !important;\n        }\n      }\n    }\n    \n    /*  */\n    .el-input__wrapper,\n    .el-textarea__wrapper {\n      background-color: var(--bg-color) !important;\n      box-shadow: 0 0 0 1px var(--border-color) inset !important;\n    }\n    \n    .el-input__inner,\n    .el-textarea__inner {\n      background-color: var(--bg-color) !important;\n      color: var(--text-color) !important;\n    }\n    \n    .el-select .el-input__wrapper {\n      background-color: var(--bg-color) !important;\n    }\n    \n    .el-date-editor {\n      background-color: var(--bg-color) !important;\n      \n      .el-input__wrapper {\n        background-color: var(--bg-color) !important;\n      }\n    }\n    \n    /*  */\n    .ql-toolbar.ql-snow {\n      background-color: var(--bg-color-secondary) !important;\n      border-color: var(--border-color) !important;\n    }\n    \n    .ql-container.ql-snow {\n      background-color: var(--bg-color) !important;\n      border-color: var(--border-color) !important;\n    }\n    \n    .ql-editor {\n      background-color: var(--bg-color) !important;\n      color: var(--text-color) !important;\n    }\n    \n    /*  */\n    .contract-edit-wrapper,\n    .contract-edit-container {\n      background-color: var(--bg-color) !important;\n      \n      .editor-main-area,\n      .check-result-area {\n        background-color: var(--bg-color) !important;\n      }\n    }\n    \n    /* AI */\n    .ai-polish-sidebar,\n    .check-sidebar {\n      background: linear-gradient(135deg, var(--bg-color-secondary) 0%, var(--bg-color-tertiary) 100%) !important;\n      border-color: var(--border-color) !important;\n    }\n    \n    /*  */\n    .ai-polish-personalization {\n      background-color: var(--bg-color-secondary) !important;\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;\n      \n      .personalization-section {\n        background-color: var(--bg-color) !important;\n        \n        .section-header {\n          color: var(--text-color) !important;\n          \n          span {\n            color: var(--text-color) !important;\n          }\n        }\n      }\n      \n      .personalization-title {\n        color: var(--text-color) !important;\n      }\n    }\n    \n    /*  */\n    .stat-item {\n      background-color: var(--bg-color) !important;\n      \n      .stat-label {\n        color: var(--text-color-secondary) !important;\n      }\n    }\n    \n    /*  */\n    .check-result-card,\n    .check-result-details,\n    .check-issue-card {\n      background-color: var(--bg-color-secondary) !important;\n      box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.2) !important;\n    }\n    \n    .check-content-inner {\n      background-color: var(--bg-color) !important;\n      padding: 15px 20px !important;\n    }\n    \n    /*  */\n    .el-scrollbar {\n      background-color: var(--bg-color) !important;\n      \n      .el-scrollbar__view {\n        background-color: var(--bg-color) !important;\n      }\n    }\n    \n    /*  */\n    div[class*=\"contract\"],\n    div[class*=\"card\"],\n    div[class*=\"box\"],\n    div[class*=\"panel\"],\n    div[class*=\"content\"],\n    div[class*=\"wrapper\"],\n    div[class*=\"container\"] {\n      background-color: var(--bg-color) !important;\n      color: var(--text-color) !important;\n    }\n    \n    /*  */\n    .el-table {\n      background-color: var(--bg-color) !important;\n      color: var(--text-color) !important;\n      \n      .el-table__header, \n      .el-table__body, \n      .el-table__footer {\n        background-color: var(--bg-color) !important;\n      }\n      \n      th, td {\n        background-color: var(--bg-color) !important;\n        border-bottom-color: var(--border-color) !important;\n      }\n      \n      .el-table__row {\n        background-color: var(--bg-color) !important;\n        color: var(--text-color) !important;\n      }\n      \n      .el-table__cell {\n        background-color: var(--bg-color) !important;\n      }\n    }\n  }\n  \n  /*  */\n  .el-select-dropdown,\n  .el-dropdown-menu,\n  .el-picker-panel,\n  .el-tooltip__popper {\n    background-color: var(--bg-color-secondary) !important;\n    border-color: var(--border-color) !important;\n    color: var(--text-color) !important;\n    \n    .el-select-dropdown__item,\n    .el-dropdown-menu__item,\n    .el-date-table td,\n    .el-date-table th,\n    .el-month-table td,\n    .el-year-table td {\n      color: var(--text-color) !important;\n      background-color: var(--bg-color-secondary) !important;\n    }\n    \n    .el-select-dropdown__item.hover, \n    .el-select-dropdown__item:hover,\n    .el-dropdown-menu__item:hover {\n      background-color: var(--bg-color-tertiary) !important;\n    }\n    \n    .el-select-dropdown__item.selected {\n      color: var(--primary-color) !important;\n      background-color: rgba(64, 158, 255, 0.1) !important;\n    }\n    \n    .el-date-table td.current:not(.disabled) span {\n      background-color: var(--primary-color) !important;\n      color: white !important;\n    }\n  }\n  \n  /*  */\n  .el-timeline {\n    background-color: var(--bg-color) !important;\n    color: var(--text-color) !important;\n    \n    .el-timeline-item__tail {\n      border-left-color: var(--border-color) !important;\n    }\n    \n    .el-timeline-item__node {\n      background-color: var(--primary-color) !important;\n    }\n    \n    .el-timeline-item__content {\n      color: var(--text-color) !important;\n    }\n    \n    .el-timeline-item__timestamp {\n      color: var(--text-color-secondary) !important;\n    }\n  }\n  \n  /*  */\n  .el-empty {\n    background-color: transparent !important;\n    \n    .el-empty__image, \n    .el-empty__description {\n      color: var(--text-color-secondary) !important;\n    }\n  }\n  \n  /*  */\n  .el-dialog,\n  .el-message-box {\n    background-color: var(--bg-color) !important;\n    border-color: var(--border-color) !important;\n    \n    .el-dialog__header,\n    .el-message-box__header {\n      background-color: var(--bg-color) !important;\n      border-bottom-color: var(--border-color) !important;\n    }\n    \n    .el-dialog__title,\n    .el-message-box__title {\n      color: var(--text-color) !important;\n    }\n    \n    .el-dialog__body,\n    .el-message-box__content {\n      background-color: var(--bg-color) !important;\n      color: var(--text-color) !important;\n    }\n    \n    .el-dialog__footer,\n    .el-message-box__btns {\n      background-color: var(--bg-color) !important;\n      border-top-color: var(--border-color) !important;\n    }\n  }\n  \n  /*  */\n  hr, \n  .el-divider {\n    border-color: var(--border-color) !important;\n    background-color: var(--border-color) !important;\n  }\n\n  /*  */\n  iframe.ql-video {\n    background-color: black !important;\n  }\n  \n  .ql-picker-options {\n    background-color: var(--bg-color-secondary) !important;\n    color: var(--text-color) !important;\n    border-color: var(--border-color) !important;\n  }\n  \n  .ql-tooltip {\n    background-color: var(--bg-color-secondary) !important;\n    color: var(--text-color) !important;\n    border-color: var(--border-color) !important;\n    \n    input[type=\"text\"] {\n      background-color: var(--bg-color) !important;\n      color: var(--text-color) !important;\n      border-color: var(--border-color) !important;\n    }\n  }\n  \n  /*  */\n  [style*=\"background-color: white\"],\n  [style*=\"background-color:#fff\"],\n  [style*=\"background-color:#ffffff\"],\n  [style*=\"background: white\"],\n  [style*=\"background:#fff\"],\n  [style*=\"background:#ffffff\"] {\n    background-color: var(--bg-color) !important;\n  }\n  \n  [style*=\"color:black\"],\n  [style*=\"color: black\"],\n  [style*=\"color:#000\"],\n  [style*=\"color:#000000\"] {\n    color: var(--text-color) !important;\n  }\n  \n  /* AI */\n  .ai-suggestions-panel {\n    background-color: var(--bg-color-secondary) !important;\n    border-color: var(--border-color) !important;\n    box-shadow: -3px 0 10px rgba(0, 0, 0, 0.15) !important;\n    \n    .panel-header {\n      color: var(--text-color) !important;\n      background-color: var(--bg-color-secondary) !important;\n    }\n    \n    .suggestion-item {\n      background-color: var(--bg-color) !important;\n      border-color: var(--border-color) !important;\n    }\n    \n    .explanation {\n      color: var(--text-color-secondary) !important;\n    }\n  }\n  \n  /*  */\n  .panel-open-button {\n    background-color: var(--bg-color-secondary) !important;\n    box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2) !important;\n  }\n  \n  /* AI */\n  .ai-polish-button, \n  .check-sidebar .ai-polish-button,\n  button.el-button.ai-polish-button {\n    background: linear-gradient(45deg, #409EFF, #64b5f6) !important;\n    \n    .ai-polish-button-content {\n      background: transparent !important;\n    }\n    \n    /*  */\n    .el-icon,\n    .ai-polish-icon,\n    .ai-polish-icon svg,\n    svg,\n    path {\n      background-color: transparent !important;\n      box-shadow: none !important;\n      fill: currentColor !important;\n    }\n    \n    /*  */\n    span {\n      background-color: transparent !important;\n      color: white !important;\n    }\n    \n    /*  */\n    * {\n      background-color: transparent !important;\n    }\n  }\n  \n  /*  */\n  .ai-polish-icon.no-bg,\n  .ai-polish-icon.no-bg svg,\n  .ai-polish-icon.no-bg path {\n    background-color: transparent !important;\n    background: transparent !important;\n    color: white !important;\n    fill: white !important;\n  }\n  \n  /*  */\n  .contract-edit-wrapper .ai-polish-sidebar *,\n  .contract-edit-wrapper .check-sidebar * {\n    &:not(.ai-polish-personalization):not(.ai-polish-features) {\n      background-color: transparent !important;\n    }\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]}]}