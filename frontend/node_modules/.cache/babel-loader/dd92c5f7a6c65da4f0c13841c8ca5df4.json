{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\admin\\DepartmentManagement.vue?vue&type=script&setup=true&lang=js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\admin\\DepartmentManagement.vue","mtime":1750384887305},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746431218000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5zb21lLmpzIjsKaW1wb3J0IHsgcmVmLCByZWFjdGl2ZSwgb25Nb3VudGVkIH0gZnJvbSAndnVlJzsKaW1wb3J0IGFkbWluQXBpIGZyb20gJ0AvYXBpL2FkbWluJzsKaW1wb3J0IHsgRWxNZXNzYWdlLCBFbE1lc3NhZ2VCb3gsIEVsQ2FyZCwgRWxJY29uLCBFbElucHV0LCBFbEJ1dHRvbiwgRWxUYWJsZSwgRWxUYWJsZUNvbHVtbiwgRWxQYWdpbmF0aW9uLCBFbERpYWxvZywgRWxGb3JtLCBFbEZvcm1JdGVtLCBFbFNlbGVjdCwgRWxPcHRpb24gfSBmcm9tICdlbGVtZW50LXBsdXMnOwppbXBvcnQgeyBUaWNrZXRzLCBTZWFyY2gsIFBsdXMgfSBmcm9tICdAZWxlbWVudC1wbHVzL2ljb25zLXZ1ZSc7CmV4cG9ydCBkZWZhdWx0IHsKICBfX25hbWU6ICdEZXBhcnRtZW50TWFuYWdlbWVudCcsCiAgc2V0dXAoX19wcm9wcywgewogICAgZXhwb3NlOiBfX2V4cG9zZQogIH0pIHsKICAgIF9fZXhwb3NlKCk7CiAgICBjb25zdCBkZXBhcnRtZW50cyA9IHJlZihbXSk7CiAgICBjb25zdCBjb21wYW5pZXMgPSByZWYoW10pOwogICAgY29uc3QgY29tcGFueVVzZXJzID0gcmVmKFtdKTsKICAgIGNvbnN0IGxvYWRpbmcgPSByZWYodHJ1ZSk7CiAgICBjb25zdCBzZWFyY2hRdWVyeSA9IHJlZignJyk7CiAgICBjb25zdCB0b3RhbCA9IHJlZigwKTsKICAgIGNvbnN0IHBhZ2luYXRpb24gPSByZWFjdGl2ZSh7CiAgICAgIHBhZ2U6IDEsCiAgICAgIHBhZ2VTaXplOiAxMAogICAgfSk7CiAgICBjb25zdCBpc01vZGFsT3BlbiA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBjdXJyZW50SXRlbSA9IHJlZih7fSk7CiAgICBjb25zdCBpdGVtRm9ybSA9IHJlZihudWxsKTsKICAgIGxldCBzZWFyY2hUaW1lb3V0ID0gbnVsbDsKICAgIGNvbnN0IGZldGNoRGVwYXJ0bWVudHMgPSBhc3luYyAoKSA9PiB7CiAgICAgIGxvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICB0cnkgewogICAgICAgIGNvbnN0IHBhcmFtcyA9IHsKICAgICAgICAgIHNlYXJjaDogc2VhcmNoUXVlcnkudmFsdWUsCiAgICAgICAgICBwYWdlOiBwYWdpbmF0aW9uLnBhZ2UsCiAgICAgICAgICBwYWdlX3NpemU6IHBhZ2luYXRpb24ucGFnZVNpemUKICAgICAgICB9OwogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWRtaW5BcGkuZ2V0RGVwYXJ0bWVudHMocGFyYW1zKTsKICAgICAgICBkZXBhcnRtZW50cy52YWx1ZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0czsKICAgICAgICB0b3RhbC52YWx1ZSA9IHJlc3BvbnNlLmRhdGEuY291bnQ7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigi6I635Y+W6YOo6Zeo5YiX6KGo5aSx6LSlOiIsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+iOt+WPlumDqOmXqOWIl+ihqOWksei0pScpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IGRlYm91bmNlZEZldGNoRGVwYXJ0bWVudHMgPSAoKSA9PiB7CiAgICAgIGNsZWFyVGltZW91dChzZWFyY2hUaW1lb3V0KTsKICAgICAgc2VhcmNoVGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHBhZ2luYXRpb24ucGFnZSA9IDE7CiAgICAgICAgZmV0Y2hEZXBhcnRtZW50cygpOwogICAgICB9LCAzMDApOwogICAgfTsKICAgIGNvbnN0IGZldGNoQ29tcGFuaWVzRm9yU2VsZWN0ID0gYXN5bmMgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWRtaW5BcGkuZ2V0Q29tcGFuaWVzKHsKICAgICAgICAgIGFsbDogJ3RydWUnCiAgICAgICAgfSk7CiAgICAgICAgY29tcGFuaWVzLnZhbHVlID0gcmVzcG9uc2UuZGF0YTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCLojrflj5blhazlj7jliJfooajlpLHotKU6IiwgZXJyb3IpOwogICAgICB9CiAgICB9OwogICAgY29uc3QgZmV0Y2hVc2Vyc0ZvckNvbXBhbnkgPSBhc3luYyBjb21wYW55SWQgPT4gewogICAgICBpZiAoIWNvbXBhbnlJZCkgewogICAgICAgIGNvbXBhbnlVc2Vycy52YWx1ZSA9IFtdOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWRtaW5BcGkuZ2V0VXNlcnMoewogICAgICAgICAgYWxsOiAndHJ1ZScsCiAgICAgICAgICBjb21wYW55X2lkOiBjb21wYW55SWQKICAgICAgICB9KTsKICAgICAgICBjb21wYW55VXNlcnMudmFsdWUgPSByZXNwb25zZS5kYXRhOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoYOiOt+WPluWFrOWPuCAke2NvbXBhbnlJZH0g55qE55So5oi35YiX6KGo5aSx6LSlOmAsIGVycm9yKTsKICAgICAgICBjb21wYW55VXNlcnMudmFsdWUgPSBbXTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IG9uQ29tcGFueUNoYW5nZSA9IGFzeW5jIGNvbXBhbnlJZCA9PiB7CiAgICAgIGN1cnJlbnRJdGVtLnZhbHVlLm1hbmFnZXIgPSBudWxsOwogICAgICBhd2FpdCBmZXRjaFVzZXJzRm9yQ29tcGFueShjb21wYW55SWQpOwogICAgfTsKICAgIGNvbnN0IG9wZW5Nb2RhbCA9IGFzeW5jIChpdGVtID0ge30pID0+IHsKICAgICAgYXdhaXQgZmV0Y2hDb21wYW5pZXNGb3JTZWxlY3QoKTsKICAgICAgY29tcGFueVVzZXJzLnZhbHVlID0gW107IC8vIFJlc2V0IHVzZXIgbGlzdCBpbml0aWFsbHkKCiAgICAgIGlmIChpdGVtICYmIGl0ZW0uaWQpIHsKICAgICAgICBjdXJyZW50SXRlbS52YWx1ZSA9IHsKICAgICAgICAgIC4uLml0ZW0KICAgICAgICB9OwogICAgICAgIGlmIChpdGVtLmNvbXBhbnkpIHsKICAgICAgICAgIGF3YWl0IGZldGNoVXNlcnNGb3JDb21wYW55KGl0ZW0uY29tcGFueSk7CiAgICAgICAgICBjb25zdCBtYW5hZ2VySWQgPSBjdXJyZW50SXRlbS52YWx1ZS5tYW5hZ2VyOwogICAgICAgICAgLy8gSWYgbWFuYWdlciBpcyBmcm9tIGEgZGlmZmVyZW50IGNvbXBhbnksIHJlc2V0IGl0CiAgICAgICAgICBpZiAobWFuYWdlcklkICYmICFjb21wYW55VXNlcnMudmFsdWUuc29tZSh1ID0+IHUuaWQgPT09IG1hbmFnZXJJZCkpIHsKICAgICAgICAgICAgY3VycmVudEl0ZW0udmFsdWUubWFuYWdlciA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGN1cnJlbnRJdGVtLnZhbHVlID0gewogICAgICAgICAgbmFtZTogJycsCiAgICAgICAgICBkZXNjcmlwdGlvbjogJycsCiAgICAgICAgICBjb21wYW55OiBudWxsLAogICAgICAgICAgbWFuYWdlcjogbnVsbAogICAgICAgIH07CiAgICAgIH0KICAgICAgaXNNb2RhbE9wZW4udmFsdWUgPSB0cnVlOwogICAgfTsKICAgIGNvbnN0IGNsb3NlTW9kYWwgPSAoKSA9PiB7CiAgICAgIHZhciBfaXRlbUZvcm0kdmFsdWU7CiAgICAgIGlzTW9kYWxPcGVuLnZhbHVlID0gZmFsc2U7CiAgICAgIChfaXRlbUZvcm0kdmFsdWUgPSBpdGVtRm9ybS52YWx1ZSkgPT09IG51bGwgfHwgX2l0ZW1Gb3JtJHZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfaXRlbUZvcm0kdmFsdWUucmVzZXRGaWVsZHMoKTsKICAgICAgY29tcGFueVVzZXJzLnZhbHVlID0gW107CiAgICB9OwogICAgY29uc3Qgc2F2ZUl0ZW0gPSBhc3luYyAoKSA9PiB7CiAgICAgIGlmICghaXRlbUZvcm0udmFsdWUpIHJldHVybjsKICAgICAgYXdhaXQgaXRlbUZvcm0udmFsdWUudmFsaWRhdGUoYXN5bmMgdmFsaWQgPT4gewogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHsKICAgICAgICAgICAgICAuLi5jdXJyZW50SXRlbS52YWx1ZQogICAgICAgICAgICB9OwogICAgICAgICAgICAvLyBFbnN1cmUgbWFuYWdlciBpcyBudWxsLCBub3QgZW1wdHkgc3RyaW5nLCBpZiBub3Qgc2VsZWN0ZWQKICAgICAgICAgICAgaWYgKHBheWxvYWQubWFuYWdlciA9PT0gJycpIHsKICAgICAgICAgICAgICBwYXlsb2FkLm1hbmFnZXIgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChwYXlsb2FkLmlkKSB7CiAgICAgICAgICAgICAgYXdhaXQgYWRtaW5BcGkudXBkYXRlRGVwYXJ0bWVudChwYXlsb2FkLmlkLCBwYXlsb2FkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBhd2FpdCBhZG1pbkFwaS5jcmVhdGVEZXBhcnRtZW50KHBheWxvYWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNsb3NlTW9kYWwoKTsKICAgICAgICAgICAgZmV0Y2hEZXBhcnRtZW50cygpOwogICAgICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn6YOo6Zeo5L+h5oGv5L+d5a2Y5oiQ5Yqf77yBJyk7CiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCLkv53lrZjpg6jpl6jlpLHotKU6IiwgZXJyb3IpOwogICAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+S/neWtmOmDqOmXqOWksei0pe+8jOivt+eojeWQjumHjeivlScpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwogICAgY29uc3QgY29uZmlybURlbGV0ZSA9IGl0ZW0gPT4gewogICAgICBFbE1lc3NhZ2VCb3guY29uZmlybShg56Gu5a6a6KaB5Yig6Zmk6YOo6Zeo44CQJHtpdGVtLm5hbWV944CR5ZCX77yf6L+Z5Lya5bCG6YOo6Zeo5YaF55qE5omA5pyJ5ZGY5bel55qE6YOo6Zeo6YeN572u5Li656m644CCYCwgJ+itpuWRiicsIHsKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruWumuWIoOmZpCcsCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+WPlua2iCcsCiAgICAgICAgdHlwZTogJ3dhcm5pbmcnCiAgICAgIH0pLnRoZW4oYXN5bmMgKCkgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICBhd2FpdCBhZG1pbkFwaS5kZWxldGVEZXBhcnRtZW50KGl0ZW0uaWQpOwogICAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+mDqOmXqOWIoOmZpOaIkOWKnycpOwogICAgICAgICAgZmV0Y2hEZXBhcnRtZW50cygpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WIoOmZpOWksei0pe+8jOivt+eojeWQjumHjeivlScpOwogICAgICAgICAgY29uc29sZS5lcnJvcigi5Yig6Zmk6YOo6Zeo5aSx6LSlOiIsIGVycm9yKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICBFbE1lc3NhZ2UuaW5mbygn5bey5Y+W5raI5Yig6ZmkJyk7CiAgICAgIH0pOwogICAgfTsKICAgIGNvbnN0IGhhbmRsZVNpemVDaGFuZ2UgPSB2YWwgPT4gewogICAgICBwYWdpbmF0aW9uLnBhZ2VTaXplID0gdmFsOwogICAgICBmZXRjaERlcGFydG1lbnRzKCk7CiAgICB9OwogICAgY29uc3QgaGFuZGxlQ3VycmVudENoYW5nZSA9IHZhbCA9PiB7CiAgICAgIHBhZ2luYXRpb24ucGFnZSA9IHZhbDsKICAgICAgZmV0Y2hEZXBhcnRtZW50cygpOwogICAgfTsKICAgIG9uTW91bnRlZChmZXRjaERlcGFydG1lbnRzKTsKICAgIGNvbnN0IF9fcmV0dXJuZWRfXyA9IHsKICAgICAgZGVwYXJ0bWVudHMsCiAgICAgIGNvbXBhbmllcywKICAgICAgY29tcGFueVVzZXJzLAogICAgICBsb2FkaW5nLAogICAgICBzZWFyY2hRdWVyeSwKICAgICAgdG90YWwsCiAgICAgIHBhZ2luYXRpb24sCiAgICAgIGlzTW9kYWxPcGVuLAogICAgICBjdXJyZW50SXRlbSwKICAgICAgaXRlbUZvcm0sCiAgICAgIGdldCBzZWFyY2hUaW1lb3V0KCkgewogICAgICAgIHJldHVybiBzZWFyY2hUaW1lb3V0OwogICAgICB9LAogICAgICBzZXQgc2VhcmNoVGltZW91dCh2KSB7CiAgICAgICAgc2VhcmNoVGltZW91dCA9IHY7CiAgICAgIH0sCiAgICAgIGZldGNoRGVwYXJ0bWVudHMsCiAgICAgIGRlYm91bmNlZEZldGNoRGVwYXJ0bWVudHMsCiAgICAgIGZldGNoQ29tcGFuaWVzRm9yU2VsZWN0LAogICAgICBmZXRjaFVzZXJzRm9yQ29tcGFueSwKICAgICAgb25Db21wYW55Q2hhbmdlLAogICAgICBvcGVuTW9kYWwsCiAgICAgIGNsb3NlTW9kYWwsCiAgICAgIHNhdmVJdGVtLAogICAgICBjb25maXJtRGVsZXRlLAogICAgICBoYW5kbGVTaXplQ2hhbmdlLAogICAgICBoYW5kbGVDdXJyZW50Q2hhbmdlLAogICAgICByZWYsCiAgICAgIHJlYWN0aXZlLAogICAgICBvbk1vdW50ZWQsCiAgICAgIGdldCBhZG1pbkFwaSgpIHsKICAgICAgICByZXR1cm4gYWRtaW5BcGk7CiAgICAgIH0sCiAgICAgIGdldCBFbE1lc3NhZ2UoKSB7CiAgICAgICAgcmV0dXJuIEVsTWVzc2FnZTsKICAgICAgfSwKICAgICAgZ2V0IEVsTWVzc2FnZUJveCgpIHsKICAgICAgICByZXR1cm4gRWxNZXNzYWdlQm94OwogICAgICB9LAogICAgICBnZXQgRWxDYXJkKCkgewogICAgICAgIHJldHVybiBFbENhcmQ7CiAgICAgIH0sCiAgICAgIGdldCBFbEljb24oKSB7CiAgICAgICAgcmV0dXJuIEVsSWNvbjsKICAgICAgfSwKICAgICAgZ2V0IEVsSW5wdXQoKSB7CiAgICAgICAgcmV0dXJuIEVsSW5wdXQ7CiAgICAgIH0sCiAgICAgIGdldCBFbEJ1dHRvbigpIHsKICAgICAgICByZXR1cm4gRWxCdXR0b247CiAgICAgIH0sCiAgICAgIGdldCBFbFRhYmxlKCkgewogICAgICAgIHJldHVybiBFbFRhYmxlOwogICAgICB9LAogICAgICBnZXQgRWxUYWJsZUNvbHVtbigpIHsKICAgICAgICByZXR1cm4gRWxUYWJsZUNvbHVtbjsKICAgICAgfSwKICAgICAgZ2V0IEVsUGFnaW5hdGlvbigpIHsKICAgICAgICByZXR1cm4gRWxQYWdpbmF0aW9uOwogICAgICB9LAogICAgICBnZXQgRWxEaWFsb2coKSB7CiAgICAgICAgcmV0dXJuIEVsRGlhbG9nOwogICAgICB9LAogICAgICBnZXQgRWxGb3JtKCkgewogICAgICAgIHJldHVybiBFbEZvcm07CiAgICAgIH0sCiAgICAgIGdldCBFbEZvcm1JdGVtKCkgewogICAgICAgIHJldHVybiBFbEZvcm1JdGVtOwogICAgICB9LAogICAgICBnZXQgRWxTZWxlY3QoKSB7CiAgICAgICAgcmV0dXJuIEVsU2VsZWN0OwogICAgICB9LAogICAgICBnZXQgRWxPcHRpb24oKSB7CiAgICAgICAgcmV0dXJuIEVsT3B0aW9uOwogICAgICB9LAogICAgICBnZXQgVGlja2V0cygpIHsKICAgICAgICByZXR1cm4gVGlja2V0czsKICAgICAgfSwKICAgICAgZ2V0IFNlYXJjaCgpIHsKICAgICAgICByZXR1cm4gU2VhcmNoOwogICAgICB9LAogICAgICBnZXQgUGx1cygpIHsKICAgICAgICByZXR1cm4gUGx1czsKICAgICAgfQogICAgfTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfX3JldHVybmVkX18sICdfX2lzU2NyaXB0U2V0dXAnLCB7CiAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICB2YWx1ZTogdHJ1ZQogICAgfSk7CiAgICByZXR1cm4gX19yZXR1cm5lZF9fOwogIH0KfTs="},{"version":3,"names":["ref","reactive","onMounted","adminApi","ElMessage","ElMessageBox","ElCard","ElIcon","ElInput","ElButton","ElTable","ElTableColumn","ElPagination","ElDialog","ElForm","ElFormItem","ElSelect","ElOption","Tickets","Search","Plus","departments","companies","companyUsers","loading","searchQuery","total","pagination","page","pageSize","isModalOpen","currentItem","itemForm","searchTimeout","fetchDepartments","value","params","search","page_size","response","getDepartments","data","results","count","error","console","debouncedFetchDepartments","clearTimeout","setTimeout","fetchCompaniesForSelect","getCompanies","all","fetchUsersForCompany","companyId","getUsers","company_id","onCompanyChange","manager","openModal","item","id","company","managerId","some","u","name","description","closeModal","_itemForm$value","resetFields","saveItem","validate","valid","payload","updateDepartment","createDepartment","success","confirmDelete","confirm","confirmButtonText","cancelButtonText","type","then","deleteDepartment","catch","info","handleSizeChange","val","handleCurrentChange"],"sources":["C:/Users/18083/Desktop/CCIT/office/smart-office/frontend/src/views/admin/DepartmentManagement.vue"],"sourcesContent":["<template>\n  <div class=\"management-container\">\n    <el-card class=\"box-card\">\n      <template #header>\n        <div class=\"card-header\">\n          <div class=\"header-left\">\n            <el-icon class=\"header-icon\"><Tickets /></el-icon>\n            <span>部门管理</span>\n          </div>\n          <div class=\"header-right\">\n            <el-input\n              v-model=\"searchQuery\"\n              placeholder=\"搜索部门...\"\n              clearable\n              @clear=\"fetchDepartments\"\n              @input=\"debouncedFetchDepartments\"\n              class=\"search-input\"\n            >\n              <template #append>\n                <el-button :icon=\"Search\" />\n              </template>\n            </el-input>\n            <el-button type=\"primary\" :icon=\"Plus\" @click=\"openModal()\">添加部门</el-button>\n          </div>\n        </div>\n      </template>\n      <div class=\"table-container\">\n        <el-table :data=\"departments\" v-loading=\"loading\" style=\"width: 100%\">\n          <el-table-column type=\"index\" label=\"序号\" width=\"60\" />\n          <el-table-column prop=\"name\" label=\"部门名称\" sortable />\n          <el-table-column prop=\"company_name\" label=\"所属公司\" sortable />\n          <el-table-column prop=\"manager_name\" label=\"部门主管\" sortable>\n             <template #default=\"scope\">\n                {{ scope.row.manager_name || '无' }}\n            </template>\n          </el-table-column>\n          <el-table-column prop=\"description\" label=\"描述\" />\n          <el-table-column label=\"操作\" width=\"120\">\n            <template #default=\"scope\">\n              <el-button text type=\"primary\" size=\"small\" @click=\"openModal(scope.row)\">编辑</el-button>\n              <el-button text type=\"danger\" size=\"small\" @click=\"confirmDelete(scope.row)\">删除</el-button>\n            </template>\n          </el-table-column>\n        </el-table>\n      </div>\n\n       <div class=\"pagination-container\">\n        <el-pagination\n          v-model:current-page=\"pagination.page\"\n          v-model:page-size=\"pagination.pageSize\"\n          :page-sizes=\"[10, 20, 50, 100]\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          :total=\"total\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n        />\n      </div>\n\n     <!-- 添加/编辑模态框 -->\n      <el-dialog v-model=\"isModalOpen\" :title=\"currentItem.id ? '编辑部门' : '添加部门'\" width=\"500px\">\n        <el-form :model=\"currentItem\" ref=\"itemForm\" label-width=\"80px\">\n          <el-form-item label=\"部门名称\" prop=\"name\" :rules=\"[{ required: true, message: '请输入部门名称' }]\">\n            <el-input v-model=\"currentItem.name\" />\n          </el-form-item>\n          <el-form-item label=\"所属公司\" prop=\"company\" :rules=\"[{ required: true, message: '请选择公司' }]\">\n             <el-select v-model=\"currentItem.company\" placeholder=\"请选择\" @change=\"onCompanyChange\">\n              <el-option v-for=\"company in companies\" :key=\"company.id\" :label=\"company.name\" :value=\"company.id\" />\n            </el-select>\n          </el-form-item>\n          <el-form-item v-if=\"currentItem.company\" label=\"部门主管\" prop=\"manager\">\n             <el-select v-model=\"currentItem.manager\" placeholder=\"请选择\" :disabled=\"!currentItem.company\" clearable>\n               <el-option label=\"-- 不指定 --\" :value=\"null\" />\n              <el-option \n                v-for=\"user in companyUsers\" \n                :key=\"user.id\" \n                :label=\"user.name || user.username\" \n                :value=\"user.id\"\n               />\n             </el-select>\n          </el-form-item>\n          <el-form-item label=\"描述\" prop=\"description\">\n            <el-input v-model=\"currentItem.description\" type=\"textarea\" />\n          </el-form-item>\n        </el-form>\n        <template #footer>\n          <span class=\"dialog-footer\">\n            <el-button @click=\"closeModal\">取消</el-button>\n            <el-button type=\"primary\" @click=\"saveItem\">保存</el-button>\n          </span>\n        </template>\n      </el-dialog>\n    </el-card>\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted } from 'vue';\nimport adminApi from '@/api/admin';\nimport { ElMessage, ElMessageBox, ElCard, ElIcon, ElInput, ElButton, ElTable, ElTableColumn, ElPagination, ElDialog, ElForm, ElFormItem, ElSelect, ElOption } from 'element-plus';\nimport { Tickets, Search, Plus } from '@element-plus/icons-vue';\n\nconst departments = ref([]);\nconst companies = ref([]);\nconst companyUsers = ref([]);\nconst loading = ref(true);\nconst searchQuery = ref('');\nconst total = ref(0);\nconst pagination = reactive({\n  page: 1,\n  pageSize: 10,\n});\nconst isModalOpen = ref(false);\nconst currentItem = ref({});\nconst itemForm = ref(null);\nlet searchTimeout = null;\n\nconst fetchDepartments = async () => {\n  loading.value = true;\n  try {\n    const params = { \n      search: searchQuery.value,\n      page: pagination.page,\n      page_size: pagination.pageSize,\n    };\n    const response = await adminApi.getDepartments(params);\n    departments.value = response.data.results;\n    total.value = response.data.count;\n  } catch (error) {\n    console.error(\"获取部门列表失败:\", error);\n    ElMessage.error('获取部门列表失败');\n  } finally {\n    loading.value = false;\n  }\n};\n\nconst debouncedFetchDepartments = () => {\n  clearTimeout(searchTimeout);\n  searchTimeout = setTimeout(() => {\n    pagination.page = 1;\n    fetchDepartments();\n  }, 300);\n};\n    \nconst fetchCompaniesForSelect = async () => {\n  try {\n    const response = await adminApi.getCompanies({ all: 'true' });\n    companies.value = response.data;\n  } catch (error) {\n    console.error(\"获取公司列表失败:\", error);\n  }\n};\n\nconst fetchUsersForCompany = async (companyId) => {\n  if (!companyId) {\n    companyUsers.value = [];\n    return;\n  }\n  try {\n    const response = await adminApi.getUsers({ all: 'true', company_id: companyId });\n    companyUsers.value = response.data;\n  } catch (error) {\n    console.error(`获取公司 ${companyId} 的用户列表失败:`, error);\n    companyUsers.value = [];\n  }\n};\n    \nconst onCompanyChange = async (companyId) => {\n  currentItem.value.manager = null;\n  await fetchUsersForCompany(companyId);\n};\n\nconst openModal = async (item = {}) => {\n  await fetchCompaniesForSelect();\n  companyUsers.value = []; // Reset user list initially\n\n  if (item && item.id) {\n    currentItem.value = { ...item };\n    if (item.company) {\n      await fetchUsersForCompany(item.company);\n\n      const managerId = currentItem.value.manager;\n      // If manager is from a different company, reset it\n      if (managerId && !companyUsers.value.some(u => u.id === managerId)) {\n        currentItem.value.manager = null;\n      }\n    }\n  } else {\n    currentItem.value = {\n      name: '',\n      description: '',\n      company: null,\n      manager: null\n    };\n  }\n  isModalOpen.value = true;\n};\n\nconst closeModal = () => {\n  isModalOpen.value = false;\n  itemForm.value?.resetFields();\n  companyUsers.value = [];\n};\n\nconst saveItem = async () => {\n  if (!itemForm.value) return;\n  await itemForm.value.validate(async (valid) => {\n    if (valid) {\n      try {\n        const payload = { ...currentItem.value };\n        // Ensure manager is null, not empty string, if not selected\n        if (payload.manager === '') {\n            payload.manager = null;\n        }\n\n        if (payload.id) {\n          await adminApi.updateDepartment(payload.id, payload);\n        } else {\n          await adminApi.createDepartment(payload);\n        }\n        closeModal();\n        fetchDepartments();\n        ElMessage.success('部门信息保存成功！');\n      } catch (error) {\n        console.error(\"保存部门失败:\", error);\n        ElMessage.error('保存部门失败，请稍后重试');\n      }\n    }\n  });\n};\n\nconst confirmDelete = (item) => {\n  ElMessageBox.confirm(\n    `确定要删除部门【${item.name}】吗？这会将部门内的所有员工的部门重置为空。`,\n    '警告',\n    {\n      confirmButtonText: '确定删除',\n      cancelButtonText: '取消',\n      type: 'warning',\n    }\n  ).then(async () => {\n    try {\n      await adminApi.deleteDepartment(item.id);\n      ElMessage.success('部门删除成功');\n      fetchDepartments();\n    } catch (error) {\n      ElMessage.error('删除失败，请稍后重试');\n      console.error(\"删除部门失败:\", error);\n    }\n  }).catch(() => {\n    ElMessage.info('已取消删除');\n  });\n};\n\nconst handleSizeChange = (val) => {\n  pagination.pageSize = val;\n  fetchDepartments();\n};\n\nconst handleCurrentChange = (val) => {\n  pagination.page = val;\n  fetchDepartments();\n};\n\nonMounted(fetchDepartments);\n</script>\n\n<style scoped>\n@import './shared-styles.css';\n\n.management-container {\n  padding: 20px;\n}\n</style> "],"mappings":"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","ignoreList":[]}]}