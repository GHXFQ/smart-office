{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\quill\\modules\\clipboard.js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\quill\\modules\\clipboard.js","mtime":1751792162005},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1746431219000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJDOi9Vc2Vycy8xODA4My9EZXNrdG9wL0NDSVQvb2ZmaWNlL3NtYXJ0LW9mZmljZS9mcm9udGVuZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLnJlZHVjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlLWFsbC5qcyI7CmltcG9ydCB7IEF0dHJpYnV0b3IsIEJsb2NrQmxvdCwgQ2xhc3NBdHRyaWJ1dG9yLCBFbWJlZEJsb3QsIFNjb3BlLCBTdHlsZUF0dHJpYnV0b3IgfSBmcm9tICdwYXJjaG1lbnQnOwppbXBvcnQgRGVsdGEgZnJvbSAncXVpbGwtZGVsdGEnOwppbXBvcnQgeyBCbG9ja0VtYmVkIH0gZnJvbSAnLi4vYmxvdHMvYmxvY2suanMnOwppbXBvcnQgbG9nZ2VyIGZyb20gJy4uL2NvcmUvbG9nZ2VyLmpzJzsKaW1wb3J0IE1vZHVsZSBmcm9tICcuLi9jb3JlL21vZHVsZS5qcyc7CmltcG9ydCBRdWlsbCBmcm9tICcuLi9jb3JlL3F1aWxsLmpzJzsKaW1wb3J0IHsgQWxpZ25BdHRyaWJ1dGUsIEFsaWduU3R5bGUgfSBmcm9tICcuLi9mb3JtYXRzL2FsaWduLmpzJzsKaW1wb3J0IHsgQmFja2dyb3VuZFN0eWxlIH0gZnJvbSAnLi4vZm9ybWF0cy9iYWNrZ3JvdW5kLmpzJzsKaW1wb3J0IENvZGVCbG9jayBmcm9tICcuLi9mb3JtYXRzL2NvZGUuanMnOwppbXBvcnQgeyBDb2xvclN0eWxlIH0gZnJvbSAnLi4vZm9ybWF0cy9jb2xvci5qcyc7CmltcG9ydCB7IERpcmVjdGlvbkF0dHJpYnV0ZSwgRGlyZWN0aW9uU3R5bGUgfSBmcm9tICcuLi9mb3JtYXRzL2RpcmVjdGlvbi5qcyc7CmltcG9ydCB7IEZvbnRTdHlsZSB9IGZyb20gJy4uL2Zvcm1hdHMvZm9udC5qcyc7CmltcG9ydCB7IFNpemVTdHlsZSB9IGZyb20gJy4uL2Zvcm1hdHMvc2l6ZS5qcyc7CmltcG9ydCB7IGRlbGV0ZVJhbmdlIH0gZnJvbSAnLi9rZXlib2FyZC5qcyc7CmltcG9ydCBub3JtYWxpemVFeHRlcm5hbEhUTUwgZnJvbSAnLi9ub3JtYWxpemVFeHRlcm5hbEhUTUwvaW5kZXguanMnOwpjb25zdCBkZWJ1ZyA9IGxvZ2dlcigncXVpbGw6Y2xpcGJvYXJkJyk7CmNvbnN0IENMSVBCT0FSRF9DT05GSUcgPSBbW05vZGUuVEVYVF9OT0RFLCBtYXRjaFRleHRdLCBbTm9kZS5URVhUX05PREUsIG1hdGNoTmV3bGluZV0sIFsnYnInLCBtYXRjaEJyZWFrXSwgW05vZGUuRUxFTUVOVF9OT0RFLCBtYXRjaE5ld2xpbmVdLCBbTm9kZS5FTEVNRU5UX05PREUsIG1hdGNoQmxvdF0sIFtOb2RlLkVMRU1FTlRfTk9ERSwgbWF0Y2hBdHRyaWJ1dG9yXSwgW05vZGUuRUxFTUVOVF9OT0RFLCBtYXRjaFN0eWxlc10sIFsnbGknLCBtYXRjaEluZGVudF0sIFsnb2wsIHVsJywgbWF0Y2hMaXN0XSwgWydwcmUnLCBtYXRjaENvZGVCbG9ja10sIFsndHInLCBtYXRjaFRhYmxlXSwgWydiJywgY3JlYXRlTWF0Y2hBbGlhcygnYm9sZCcpXSwgWydpJywgY3JlYXRlTWF0Y2hBbGlhcygnaXRhbGljJyldLCBbJ3N0cmlrZScsIGNyZWF0ZU1hdGNoQWxpYXMoJ3N0cmlrZScpXSwgWydzdHlsZScsIG1hdGNoSWdub3JlXV07CmNvbnN0IEFUVFJJQlVURV9BVFRSSUJVVE9SUyA9IFtBbGlnbkF0dHJpYnV0ZSwgRGlyZWN0aW9uQXR0cmlidXRlXS5yZWR1Y2UoKG1lbW8sIGF0dHIpID0+IHsKICBtZW1vW2F0dHIua2V5TmFtZV0gPSBhdHRyOwogIHJldHVybiBtZW1vOwp9LCB7fSk7CmNvbnN0IFNUWUxFX0FUVFJJQlVUT1JTID0gW0FsaWduU3R5bGUsIEJhY2tncm91bmRTdHlsZSwgQ29sb3JTdHlsZSwgRGlyZWN0aW9uU3R5bGUsIEZvbnRTdHlsZSwgU2l6ZVN0eWxlXS5yZWR1Y2UoKG1lbW8sIGF0dHIpID0+IHsKICBtZW1vW2F0dHIua2V5TmFtZV0gPSBhdHRyOwogIHJldHVybiBtZW1vOwp9LCB7fSk7CmNsYXNzIENsaXBib2FyZCBleHRlbmRzIE1vZHVsZSB7CiAgY29uc3RydWN0b3IocXVpbGwsIG9wdGlvbnMpIHsKICAgIHZhciBfdGhpcyRvcHRpb25zJG1hdGNoZXI7CiAgICBzdXBlcihxdWlsbCwgb3B0aW9ucyk7CiAgICB0aGlzLnF1aWxsLnJvb3QuYWRkRXZlbnRMaXN0ZW5lcignY29weScsIGUgPT4gdGhpcy5vbkNhcHR1cmVDb3B5KGUsIGZhbHNlKSk7CiAgICB0aGlzLnF1aWxsLnJvb3QuYWRkRXZlbnRMaXN0ZW5lcignY3V0JywgZSA9PiB0aGlzLm9uQ2FwdHVyZUNvcHkoZSwgdHJ1ZSkpOwogICAgdGhpcy5xdWlsbC5yb290LmFkZEV2ZW50TGlzdGVuZXIoJ3Bhc3RlJywgdGhpcy5vbkNhcHR1cmVQYXN0ZS5iaW5kKHRoaXMpKTsKICAgIHRoaXMubWF0Y2hlcnMgPSBbXTsKICAgIENMSVBCT0FSRF9DT05GSUcuY29uY2F0KChfdGhpcyRvcHRpb25zJG1hdGNoZXIgPSB0aGlzLm9wdGlvbnMubWF0Y2hlcnMpICE9PSBudWxsICYmIF90aGlzJG9wdGlvbnMkbWF0Y2hlciAhPT0gdm9pZCAwID8gX3RoaXMkb3B0aW9ucyRtYXRjaGVyIDogW10pLmZvckVhY2goX3JlZiA9PiB7CiAgICAgIGxldCBbc2VsZWN0b3IsIG1hdGNoZXJdID0gX3JlZjsKICAgICAgdGhpcy5hZGRNYXRjaGVyKHNlbGVjdG9yLCBtYXRjaGVyKTsKICAgIH0pOwogIH0KICBhZGRNYXRjaGVyKHNlbGVjdG9yLCBtYXRjaGVyKSB7CiAgICB0aGlzLm1hdGNoZXJzLnB1c2goW3NlbGVjdG9yLCBtYXRjaGVyXSk7CiAgfQogIGNvbnZlcnQoX3JlZjIpIHsKICAgIGxldCB7CiAgICAgIGh0bWwsCiAgICAgIHRleHQKICAgIH0gPSBfcmVmMjsKICAgIGxldCBmb3JtYXRzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgIGlmIChmb3JtYXRzW0NvZGVCbG9jay5ibG90TmFtZV0pIHsKICAgICAgcmV0dXJuIG5ldyBEZWx0YSgpLmluc2VydCh0ZXh0IHx8ICcnLCB7CiAgICAgICAgW0NvZGVCbG9jay5ibG90TmFtZV06IGZvcm1hdHNbQ29kZUJsb2NrLmJsb3ROYW1lXQogICAgICB9KTsKICAgIH0KICAgIGlmICghaHRtbCkgewogICAgICByZXR1cm4gbmV3IERlbHRhKCkuaW5zZXJ0KHRleHQgfHwgJycsIGZvcm1hdHMpOwogICAgfQogICAgY29uc3QgZGVsdGEgPSB0aGlzLmNvbnZlcnRIVE1MKGh0bWwpOwogICAgLy8gUmVtb3ZlIHRyYWlsaW5nIG5ld2xpbmUKICAgIGlmIChkZWx0YUVuZHNXaXRoKGRlbHRhLCAnXG4nKSAmJiAoZGVsdGEub3BzW2RlbHRhLm9wcy5sZW5ndGggLSAxXS5hdHRyaWJ1dGVzID09IG51bGwgfHwgZm9ybWF0cy50YWJsZSkpIHsKICAgICAgcmV0dXJuIGRlbHRhLmNvbXBvc2UobmV3IERlbHRhKCkucmV0YWluKGRlbHRhLmxlbmd0aCgpIC0gMSkuZGVsZXRlKDEpKTsKICAgIH0KICAgIHJldHVybiBkZWx0YTsKICB9CiAgbm9ybWFsaXplSFRNTChkb2MpIHsKICAgIG5vcm1hbGl6ZUV4dGVybmFsSFRNTChkb2MpOwogIH0KICBjb252ZXJ0SFRNTChodG1sKSB7CiAgICBjb25zdCBkb2MgPSBuZXcgRE9NUGFyc2VyKCkucGFyc2VGcm9tU3RyaW5nKGh0bWwsICd0ZXh0L2h0bWwnKTsKICAgIHRoaXMubm9ybWFsaXplSFRNTChkb2MpOwogICAgY29uc3QgY29udGFpbmVyID0gZG9jLmJvZHk7CiAgICBjb25zdCBub2RlTWF0Y2hlcyA9IG5ldyBXZWFrTWFwKCk7CiAgICBjb25zdCBbZWxlbWVudE1hdGNoZXJzLCB0ZXh0TWF0Y2hlcnNdID0gdGhpcy5wcmVwYXJlTWF0Y2hpbmcoY29udGFpbmVyLCBub2RlTWF0Y2hlcyk7CiAgICByZXR1cm4gdHJhdmVyc2UodGhpcy5xdWlsbC5zY3JvbGwsIGNvbnRhaW5lciwgZWxlbWVudE1hdGNoZXJzLCB0ZXh0TWF0Y2hlcnMsIG5vZGVNYXRjaGVzKTsKICB9CiAgZGFuZ2Vyb3VzbHlQYXN0ZUhUTUwoaW5kZXgsIGh0bWwpIHsKICAgIGxldCBzb3VyY2UgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IFF1aWxsLnNvdXJjZXMuQVBJOwogICAgaWYgKHR5cGVvZiBpbmRleCA9PT0gJ3N0cmluZycpIHsKICAgICAgY29uc3QgZGVsdGEgPSB0aGlzLmNvbnZlcnQoewogICAgICAgIGh0bWw6IGluZGV4LAogICAgICAgIHRleHQ6ICcnCiAgICAgIH0pOwogICAgICAvLyBAdHMtZXhwZWN0LWVycm9yCiAgICAgIHRoaXMucXVpbGwuc2V0Q29udGVudHMoZGVsdGEsIGh0bWwpOwogICAgICB0aGlzLnF1aWxsLnNldFNlbGVjdGlvbigwLCBRdWlsbC5zb3VyY2VzLlNJTEVOVCk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBwYXN0ZSA9IHRoaXMuY29udmVydCh7CiAgICAgICAgaHRtbCwKICAgICAgICB0ZXh0OiAnJwogICAgICB9KTsKICAgICAgdGhpcy5xdWlsbC51cGRhdGVDb250ZW50cyhuZXcgRGVsdGEoKS5yZXRhaW4oaW5kZXgpLmNvbmNhdChwYXN0ZSksIHNvdXJjZSk7CiAgICAgIHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKGluZGV4ICsgcGFzdGUubGVuZ3RoKCksIFF1aWxsLnNvdXJjZXMuU0lMRU5UKTsKICAgIH0KICB9CiAgb25DYXB0dXJlQ29weShlKSB7CiAgICB2YXIgX2UkY2xpcGJvYXJkRGF0YSwgX2UkY2xpcGJvYXJkRGF0YTI7CiAgICBsZXQgaXNDdXQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogICAgaWYgKGUuZGVmYXVsdFByZXZlbnRlZCkgcmV0dXJuOwogICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgY29uc3QgW3JhbmdlXSA9IHRoaXMucXVpbGwuc2VsZWN0aW9uLmdldFJhbmdlKCk7CiAgICBpZiAocmFuZ2UgPT0gbnVsbCkgcmV0dXJuOwogICAgY29uc3QgewogICAgICBodG1sLAogICAgICB0ZXh0CiAgICB9ID0gdGhpcy5vbkNvcHkocmFuZ2UsIGlzQ3V0KTsKICAgIChfZSRjbGlwYm9hcmREYXRhID0gZS5jbGlwYm9hcmREYXRhKSA9PT0gbnVsbCB8fCBfZSRjbGlwYm9hcmREYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZSRjbGlwYm9hcmREYXRhLnNldERhdGEoJ3RleHQvcGxhaW4nLCB0ZXh0KTsKICAgIChfZSRjbGlwYm9hcmREYXRhMiA9IGUuY2xpcGJvYXJkRGF0YSkgPT09IG51bGwgfHwgX2UkY2xpcGJvYXJkRGF0YTIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lJGNsaXBib2FyZERhdGEyLnNldERhdGEoJ3RleHQvaHRtbCcsIGh0bWwpOwogICAgaWYgKGlzQ3V0KSB7CiAgICAgIGRlbGV0ZVJhbmdlKHsKICAgICAgICByYW5nZSwKICAgICAgICBxdWlsbDogdGhpcy5xdWlsbAogICAgICB9KTsKICAgIH0KICB9CgogIC8qCiAgICogaHR0cHM6Ly93d3cuaWFuYS5vcmcvYXNzaWdubWVudHMvbWVkaWEtdHlwZXMvdGV4dC91cmktbGlzdAogICAqLwogIG5vcm1hbGl6ZVVSSUxpc3QodXJsTGlzdCkgewogICAgcmV0dXJuIHVybExpc3Quc3BsaXQoL1xyP1xuLykKICAgIC8vIElnbm9yZSBhbGwgY29tbWVudHMKICAgIC5maWx0ZXIodXJsID0+IHVybFswXSAhPT0gJyMnKS5qb2luKCdcbicpOwogIH0KICBvbkNhcHR1cmVQYXN0ZShlKSB7CiAgICB2YXIgX2UkY2xpcGJvYXJkRGF0YTMsIF9lJGNsaXBib2FyZERhdGE0LCBfZSRjbGlwYm9hcmREYXRhNjsKICAgIGlmIChlLmRlZmF1bHRQcmV2ZW50ZWQgfHwgIXRoaXMucXVpbGwuaXNFbmFibGVkKCkpIHJldHVybjsKICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgIGNvbnN0IHJhbmdlID0gdGhpcy5xdWlsbC5nZXRTZWxlY3Rpb24odHJ1ZSk7CiAgICBpZiAocmFuZ2UgPT0gbnVsbCkgcmV0dXJuOwogICAgY29uc3QgaHRtbCA9IChfZSRjbGlwYm9hcmREYXRhMyA9IGUuY2xpcGJvYXJkRGF0YSkgPT09IG51bGwgfHwgX2UkY2xpcGJvYXJkRGF0YTMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lJGNsaXBib2FyZERhdGEzLmdldERhdGEoJ3RleHQvaHRtbCcpOwogICAgbGV0IHRleHQgPSAoX2UkY2xpcGJvYXJkRGF0YTQgPSBlLmNsaXBib2FyZERhdGEpID09PSBudWxsIHx8IF9lJGNsaXBib2FyZERhdGE0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZSRjbGlwYm9hcmREYXRhNC5nZXREYXRhKCd0ZXh0L3BsYWluJyk7CiAgICBpZiAoIWh0bWwgJiYgIXRleHQpIHsKICAgICAgdmFyIF9lJGNsaXBib2FyZERhdGE1OwogICAgICBjb25zdCB1cmxMaXN0ID0gKF9lJGNsaXBib2FyZERhdGE1ID0gZS5jbGlwYm9hcmREYXRhKSA9PT0gbnVsbCB8fCBfZSRjbGlwYm9hcmREYXRhNSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UkY2xpcGJvYXJkRGF0YTUuZ2V0RGF0YSgndGV4dC91cmktbGlzdCcpOwogICAgICBpZiAodXJsTGlzdCkgewogICAgICAgIHRleHQgPSB0aGlzLm5vcm1hbGl6ZVVSSUxpc3QodXJsTGlzdCk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGZpbGVzID0gQXJyYXkuZnJvbSgoKF9lJGNsaXBib2FyZERhdGE2ID0gZS5jbGlwYm9hcmREYXRhKSA9PT0gbnVsbCB8fCBfZSRjbGlwYm9hcmREYXRhNiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2UkY2xpcGJvYXJkRGF0YTYuZmlsZXMpIHx8IFtdKTsKICAgIGlmICghaHRtbCAmJiBmaWxlcy5sZW5ndGggPiAwKSB7CiAgICAgIHRoaXMucXVpbGwudXBsb2FkZXIudXBsb2FkKHJhbmdlLCBmaWxlcyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChodG1sICYmIGZpbGVzLmxlbmd0aCA+IDApIHsKICAgICAgdmFyIF9kb2MkYm9keSRmaXJzdEVsZW1lbjsKICAgICAgY29uc3QgZG9jID0gbmV3IERPTVBhcnNlcigpLnBhcnNlRnJvbVN0cmluZyhodG1sLCAndGV4dC9odG1sJyk7CiAgICAgIGlmIChkb2MuYm9keS5jaGlsZEVsZW1lbnRDb3VudCA9PT0gMSAmJiAoKF9kb2MkYm9keSRmaXJzdEVsZW1lbiA9IGRvYy5ib2R5LmZpcnN0RWxlbWVudENoaWxkKSA9PT0gbnVsbCB8fCBfZG9jJGJvZHkkZmlyc3RFbGVtZW4gPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kb2MkYm9keSRmaXJzdEVsZW1lbi50YWdOYW1lKSA9PT0gJ0lNRycpIHsKICAgICAgICB0aGlzLnF1aWxsLnVwbG9hZGVyLnVwbG9hZChyYW5nZSwgZmlsZXMpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQogICAgdGhpcy5vblBhc3RlKHJhbmdlLCB7CiAgICAgIGh0bWwsCiAgICAgIHRleHQKICAgIH0pOwogIH0KICBvbkNvcHkocmFuZ2UpIHsKICAgIGNvbnN0IHRleHQgPSB0aGlzLnF1aWxsLmdldFRleHQocmFuZ2UpOwogICAgY29uc3QgaHRtbCA9IHRoaXMucXVpbGwuZ2V0U2VtYW50aWNIVE1MKHJhbmdlKTsKICAgIHJldHVybiB7CiAgICAgIGh0bWwsCiAgICAgIHRleHQKICAgIH07CiAgfQogIG9uUGFzdGUocmFuZ2UsIF9yZWYzKSB7CiAgICBsZXQgewogICAgICB0ZXh0LAogICAgICBodG1sCiAgICB9ID0gX3JlZjM7CiAgICBjb25zdCBmb3JtYXRzID0gdGhpcy5xdWlsbC5nZXRGb3JtYXQocmFuZ2UuaW5kZXgpOwogICAgY29uc3QgcGFzdGVkRGVsdGEgPSB0aGlzLmNvbnZlcnQoewogICAgICB0ZXh0LAogICAgICBodG1sCiAgICB9LCBmb3JtYXRzKTsKICAgIGRlYnVnLmxvZygnb25QYXN0ZScsIHBhc3RlZERlbHRhLCB7CiAgICAgIHRleHQsCiAgICAgIGh0bWwKICAgIH0pOwogICAgY29uc3QgZGVsdGEgPSBuZXcgRGVsdGEoKS5yZXRhaW4ocmFuZ2UuaW5kZXgpLmRlbGV0ZShyYW5nZS5sZW5ndGgpLmNvbmNhdChwYXN0ZWREZWx0YSk7CiAgICB0aGlzLnF1aWxsLnVwZGF0ZUNvbnRlbnRzKGRlbHRhLCBRdWlsbC5zb3VyY2VzLlVTRVIpOwogICAgLy8gcmFuZ2UubGVuZ3RoIGNvbnRyaWJ1dGVzIHRvIGRlbHRhLmxlbmd0aCgpCiAgICB0aGlzLnF1aWxsLnNldFNlbGVjdGlvbihkZWx0YS5sZW5ndGgoKSAtIHJhbmdlLmxlbmd0aCwgUXVpbGwuc291cmNlcy5TSUxFTlQpOwogICAgdGhpcy5xdWlsbC5zY3JvbGxTZWxlY3Rpb25JbnRvVmlldygpOwogIH0KICBwcmVwYXJlTWF0Y2hpbmcoY29udGFpbmVyLCBub2RlTWF0Y2hlcykgewogICAgY29uc3QgZWxlbWVudE1hdGNoZXJzID0gW107CiAgICBjb25zdCB0ZXh0TWF0Y2hlcnMgPSBbXTsKICAgIHRoaXMubWF0Y2hlcnMuZm9yRWFjaChwYWlyID0+IHsKICAgICAgY29uc3QgW3NlbGVjdG9yLCBtYXRjaGVyXSA9IHBhaXI7CiAgICAgIHN3aXRjaCAoc2VsZWN0b3IpIHsKICAgICAgICBjYXNlIE5vZGUuVEVYVF9OT0RFOgogICAgICAgICAgdGV4dE1hdGNoZXJzLnB1c2gobWF0Y2hlcik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIE5vZGUuRUxFTUVOVF9OT0RFOgogICAgICAgICAgZWxlbWVudE1hdGNoZXJzLnB1c2gobWF0Y2hlcik7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgQXJyYXkuZnJvbShjb250YWluZXIucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpLmZvckVhY2gobm9kZSA9PiB7CiAgICAgICAgICAgIGlmIChub2RlTWF0Y2hlcy5oYXMobm9kZSkpIHsKICAgICAgICAgICAgICBjb25zdCBtYXRjaGVzID0gbm9kZU1hdGNoZXMuZ2V0KG5vZGUpOwogICAgICAgICAgICAgIG1hdGNoZXMgPT09IG51bGwgfHwgbWF0Y2hlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWF0Y2hlcy5wdXNoKG1hdGNoZXIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG5vZGVNYXRjaGVzLnNldChub2RlLCBbbWF0Y2hlcl0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBbZWxlbWVudE1hdGNoZXJzLCB0ZXh0TWF0Y2hlcnNdOwogIH0KfQpfZGVmaW5lUHJvcGVydHkoQ2xpcGJvYXJkLCAiREVGQVVMVFMiLCB7CiAgbWF0Y2hlcnM6IFtdCn0pOwpmdW5jdGlvbiBhcHBseUZvcm1hdChkZWx0YSwgZm9ybWF0LCB2YWx1ZSwgc2Nyb2xsKSB7CiAgaWYgKCFzY3JvbGwucXVlcnkoZm9ybWF0KSkgewogICAgcmV0dXJuIGRlbHRhOwogIH0KICByZXR1cm4gZGVsdGEucmVkdWNlKChuZXdEZWx0YSwgb3ApID0+IHsKICAgIGlmICghb3AuaW5zZXJ0KSByZXR1cm4gbmV3RGVsdGE7CiAgICBpZiAob3AuYXR0cmlidXRlcyAmJiBvcC5hdHRyaWJ1dGVzW2Zvcm1hdF0pIHsKICAgICAgcmV0dXJuIG5ld0RlbHRhLnB1c2gob3ApOwogICAgfQogICAgY29uc3QgZm9ybWF0cyA9IHZhbHVlID8gewogICAgICBbZm9ybWF0XTogdmFsdWUKICAgIH0gOiB7fTsKICAgIHJldHVybiBuZXdEZWx0YS5pbnNlcnQob3AuaW5zZXJ0LCB7CiAgICAgIC4uLmZvcm1hdHMsCiAgICAgIC4uLm9wLmF0dHJpYnV0ZXMKICAgIH0pOwogIH0sIG5ldyBEZWx0YSgpKTsKfQpmdW5jdGlvbiBkZWx0YUVuZHNXaXRoKGRlbHRhLCB0ZXh0KSB7CiAgbGV0IGVuZFRleHQgPSAnJzsKICBmb3IgKGxldCBpID0gZGVsdGEub3BzLmxlbmd0aCAtIDE7IGkgPj0gMCAmJiBlbmRUZXh0Lmxlbmd0aCA8IHRleHQubGVuZ3RoOyAtLWkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1wbHVzcGx1cwogICkgewogICAgY29uc3Qgb3AgPSBkZWx0YS5vcHNbaV07CiAgICBpZiAodHlwZW9mIG9wLmluc2VydCAhPT0gJ3N0cmluZycpIGJyZWFrOwogICAgZW5kVGV4dCA9IG9wLmluc2VydCArIGVuZFRleHQ7CiAgfQogIHJldHVybiBlbmRUZXh0LnNsaWNlKC0xICogdGV4dC5sZW5ndGgpID09PSB0ZXh0Owp9CmZ1bmN0aW9uIGlzTGluZShub2RlLCBzY3JvbGwpIHsKICBpZiAoIShub2RlIGluc3RhbmNlb2YgRWxlbWVudCkpIHJldHVybiBmYWxzZTsKICBjb25zdCBtYXRjaCA9IHNjcm9sbC5xdWVyeShub2RlKTsKICAvLyBAdHMtZXhwZWN0LWVycm9yCiAgaWYgKG1hdGNoICYmIG1hdGNoLnByb3RvdHlwZSBpbnN0YW5jZW9mIEVtYmVkQmxvdCkgcmV0dXJuIGZhbHNlOwogIHJldHVybiBbJ2FkZHJlc3MnLCAnYXJ0aWNsZScsICdibG9ja3F1b3RlJywgJ2NhbnZhcycsICdkZCcsICdkaXYnLCAnZGwnLCAnZHQnLCAnZmllbGRzZXQnLCAnZmlnY2FwdGlvbicsICdmaWd1cmUnLCAnZm9vdGVyJywgJ2Zvcm0nLCAnaDEnLCAnaDInLCAnaDMnLCAnaDQnLCAnaDUnLCAnaDYnLCAnaGVhZGVyJywgJ2lmcmFtZScsICdsaScsICdtYWluJywgJ25hdicsICdvbCcsICdvdXRwdXQnLCAncCcsICdwcmUnLCAnc2VjdGlvbicsICd0YWJsZScsICd0ZCcsICd0cicsICd1bCcsICd2aWRlbyddLmluY2x1ZGVzKG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpKTsKfQpmdW5jdGlvbiBpc0JldHdlZW5JbmxpbmVFbGVtZW50cyhub2RlLCBzY3JvbGwpIHsKICByZXR1cm4gbm9kZS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nICYmIG5vZGUubmV4dEVsZW1lbnRTaWJsaW5nICYmICFpc0xpbmUobm9kZS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nLCBzY3JvbGwpICYmICFpc0xpbmUobm9kZS5uZXh0RWxlbWVudFNpYmxpbmcsIHNjcm9sbCk7Cn0KY29uc3QgcHJlTm9kZXMgPSBuZXcgV2Vha01hcCgpOwpmdW5jdGlvbiBpc1ByZShub2RlKSB7CiAgaWYgKG5vZGUgPT0gbnVsbCkgcmV0dXJuIGZhbHNlOwogIGlmICghcHJlTm9kZXMuaGFzKG5vZGUpKSB7CiAgICAvLyBAdHMtZXhwZWN0LWVycm9yCiAgICBpZiAobm9kZS50YWdOYW1lID09PSAnUFJFJykgewogICAgICBwcmVOb2Rlcy5zZXQobm9kZSwgdHJ1ZSk7CiAgICB9IGVsc2UgewogICAgICBwcmVOb2Rlcy5zZXQobm9kZSwgaXNQcmUobm9kZS5wYXJlbnROb2RlKSk7CiAgICB9CiAgfQogIHJldHVybiBwcmVOb2Rlcy5nZXQobm9kZSk7Cn0KZnVuY3Rpb24gdHJhdmVyc2Uoc2Nyb2xsLCBub2RlLCBlbGVtZW50TWF0Y2hlcnMsIHRleHRNYXRjaGVycywgbm9kZU1hdGNoZXMpIHsKICAvLyBQb3N0LW9yZGVyCiAgaWYgKG5vZGUubm9kZVR5cGUgPT09IG5vZGUuVEVYVF9OT0RFKSB7CiAgICByZXR1cm4gdGV4dE1hdGNoZXJzLnJlZHVjZSgoZGVsdGEsIG1hdGNoZXIpID0+IHsKICAgICAgcmV0dXJuIG1hdGNoZXIobm9kZSwgZGVsdGEsIHNjcm9sbCk7CiAgICB9LCBuZXcgRGVsdGEoKSk7CiAgfQogIGlmIChub2RlLm5vZGVUeXBlID09PSBub2RlLkVMRU1FTlRfTk9ERSkgewogICAgcmV0dXJuIEFycmF5LmZyb20obm9kZS5jaGlsZE5vZGVzIHx8IFtdKS5yZWR1Y2UoKGRlbHRhLCBjaGlsZE5vZGUpID0+IHsKICAgICAgbGV0IGNoaWxkcmVuRGVsdGEgPSB0cmF2ZXJzZShzY3JvbGwsIGNoaWxkTm9kZSwgZWxlbWVudE1hdGNoZXJzLCB0ZXh0TWF0Y2hlcnMsIG5vZGVNYXRjaGVzKTsKICAgICAgaWYgKGNoaWxkTm9kZS5ub2RlVHlwZSA9PT0gbm9kZS5FTEVNRU5UX05PREUpIHsKICAgICAgICBjaGlsZHJlbkRlbHRhID0gZWxlbWVudE1hdGNoZXJzLnJlZHVjZSgocmVkdWNlZERlbHRhLCBtYXRjaGVyKSA9PiB7CiAgICAgICAgICByZXR1cm4gbWF0Y2hlcihjaGlsZE5vZGUsIHJlZHVjZWREZWx0YSwgc2Nyb2xsKTsKICAgICAgICB9LCBjaGlsZHJlbkRlbHRhKTsKICAgICAgICBjaGlsZHJlbkRlbHRhID0gKG5vZGVNYXRjaGVzLmdldChjaGlsZE5vZGUpIHx8IFtdKS5yZWR1Y2UoKHJlZHVjZWREZWx0YSwgbWF0Y2hlcikgPT4gewogICAgICAgICAgcmV0dXJuIG1hdGNoZXIoY2hpbGROb2RlLCByZWR1Y2VkRGVsdGEsIHNjcm9sbCk7CiAgICAgICAgfSwgY2hpbGRyZW5EZWx0YSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGRlbHRhLmNvbmNhdChjaGlsZHJlbkRlbHRhKTsKICAgIH0sIG5ldyBEZWx0YSgpKTsKICB9CiAgcmV0dXJuIG5ldyBEZWx0YSgpOwp9CmZ1bmN0aW9uIGNyZWF0ZU1hdGNoQWxpYXMoZm9ybWF0KSB7CiAgcmV0dXJuIChfbm9kZSwgZGVsdGEsIHNjcm9sbCkgPT4gewogICAgcmV0dXJuIGFwcGx5Rm9ybWF0KGRlbHRhLCBmb3JtYXQsIHRydWUsIHNjcm9sbCk7CiAgfTsKfQpmdW5jdGlvbiBtYXRjaEF0dHJpYnV0b3Iobm9kZSwgZGVsdGEsIHNjcm9sbCkgewogIGNvbnN0IGF0dHJpYnV0ZXMgPSBBdHRyaWJ1dG9yLmtleXMobm9kZSk7CiAgY29uc3QgY2xhc3NlcyA9IENsYXNzQXR0cmlidXRvci5rZXlzKG5vZGUpOwogIGNvbnN0IHN0eWxlcyA9IFN0eWxlQXR0cmlidXRvci5rZXlzKG5vZGUpOwogIGNvbnN0IGZvcm1hdHMgPSB7fTsKICBhdHRyaWJ1dGVzLmNvbmNhdChjbGFzc2VzKS5jb25jYXQoc3R5bGVzKS5mb3JFYWNoKG5hbWUgPT4gewogICAgbGV0IGF0dHIgPSBzY3JvbGwucXVlcnkobmFtZSwgU2NvcGUuQVRUUklCVVRFKTsKICAgIGlmIChhdHRyICE9IG51bGwpIHsKICAgICAgZm9ybWF0c1thdHRyLmF0dHJOYW1lXSA9IGF0dHIudmFsdWUobm9kZSk7CiAgICAgIGlmIChmb3JtYXRzW2F0dHIuYXR0ck5hbWVdKSByZXR1cm47CiAgICB9CiAgICBhdHRyID0gQVRUUklCVVRFX0FUVFJJQlVUT1JTW25hbWVdOwogICAgaWYgKGF0dHIgIT0gbnVsbCAmJiAoYXR0ci5hdHRyTmFtZSA9PT0gbmFtZSB8fCBhdHRyLmtleU5hbWUgPT09IG5hbWUpKSB7CiAgICAgIGZvcm1hdHNbYXR0ci5hdHRyTmFtZV0gPSBhdHRyLnZhbHVlKG5vZGUpIHx8IHVuZGVmaW5lZDsKICAgIH0KICAgIGF0dHIgPSBTVFlMRV9BVFRSSUJVVE9SU1tuYW1lXTsKICAgIGlmIChhdHRyICE9IG51bGwgJiYgKGF0dHIuYXR0ck5hbWUgPT09IG5hbWUgfHwgYXR0ci5rZXlOYW1lID09PSBuYW1lKSkgewogICAgICBhdHRyID0gU1RZTEVfQVRUUklCVVRPUlNbbmFtZV07CiAgICAgIGZvcm1hdHNbYXR0ci5hdHRyTmFtZV0gPSBhdHRyLnZhbHVlKG5vZGUpIHx8IHVuZGVmaW5lZDsKICAgIH0KICB9KTsKICByZXR1cm4gT2JqZWN0LmVudHJpZXMoZm9ybWF0cykucmVkdWNlKChuZXdEZWx0YSwgX3JlZjQpID0+IHsKICAgIGxldCBbbmFtZSwgdmFsdWVdID0gX3JlZjQ7CiAgICByZXR1cm4gYXBwbHlGb3JtYXQobmV3RGVsdGEsIG5hbWUsIHZhbHVlLCBzY3JvbGwpOwogIH0sIGRlbHRhKTsKfQpmdW5jdGlvbiBtYXRjaEJsb3Qobm9kZSwgZGVsdGEsIHNjcm9sbCkgewogIGNvbnN0IG1hdGNoID0gc2Nyb2xsLnF1ZXJ5KG5vZGUpOwogIGlmIChtYXRjaCA9PSBudWxsKSByZXR1cm4gZGVsdGE7CiAgLy8gQHRzLWV4cGVjdC1lcnJvcgogIGlmIChtYXRjaC5wcm90b3R5cGUgaW5zdGFuY2VvZiBFbWJlZEJsb3QpIHsKICAgIGNvbnN0IGVtYmVkID0ge307CiAgICAvLyBAdHMtZXhwZWN0LWVycm9yCiAgICBjb25zdCB2YWx1ZSA9IG1hdGNoLnZhbHVlKG5vZGUpOwogICAgaWYgKHZhbHVlICE9IG51bGwpIHsKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvcgogICAgICBlbWJlZFttYXRjaC5ibG90TmFtZV0gPSB2YWx1ZTsKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvcgogICAgICByZXR1cm4gbmV3IERlbHRhKCkuaW5zZXJ0KGVtYmVkLCBtYXRjaC5mb3JtYXRzKG5vZGUsIHNjcm9sbCkpOwogICAgfQogIH0gZWxzZSB7CiAgICAvLyBAdHMtZXhwZWN0LWVycm9yCiAgICBpZiAobWF0Y2gucHJvdG90eXBlIGluc3RhbmNlb2YgQmxvY2tCbG90ICYmICFkZWx0YUVuZHNXaXRoKGRlbHRhLCAnXG4nKSkgewogICAgICBkZWx0YS5pbnNlcnQoJ1xuJyk7CiAgICB9CiAgICBpZiAoJ2Jsb3ROYW1lJyBpbiBtYXRjaCAmJiAnZm9ybWF0cycgaW4gbWF0Y2ggJiYgdHlwZW9mIG1hdGNoLmZvcm1hdHMgPT09ICdmdW5jdGlvbicpIHsKICAgICAgcmV0dXJuIGFwcGx5Rm9ybWF0KGRlbHRhLCBtYXRjaC5ibG90TmFtZSwgbWF0Y2guZm9ybWF0cyhub2RlLCBzY3JvbGwpLCBzY3JvbGwpOwogICAgfQogIH0KICByZXR1cm4gZGVsdGE7Cn0KZnVuY3Rpb24gbWF0Y2hCcmVhayhub2RlLCBkZWx0YSkgewogIGlmICghZGVsdGFFbmRzV2l0aChkZWx0YSwgJ1xuJykpIHsKICAgIGRlbHRhLmluc2VydCgnXG4nKTsKICB9CiAgcmV0dXJuIGRlbHRhOwp9CmZ1bmN0aW9uIG1hdGNoQ29kZUJsb2NrKG5vZGUsIGRlbHRhLCBzY3JvbGwpIHsKICBjb25zdCBtYXRjaCA9IHNjcm9sbC5xdWVyeSgnY29kZS1ibG9jaycpOwogIGNvbnN0IGxhbmd1YWdlID0gbWF0Y2ggJiYgJ2Zvcm1hdHMnIGluIG1hdGNoICYmIHR5cGVvZiBtYXRjaC5mb3JtYXRzID09PSAnZnVuY3Rpb24nID8gbWF0Y2guZm9ybWF0cyhub2RlLCBzY3JvbGwpIDogdHJ1ZTsKICByZXR1cm4gYXBwbHlGb3JtYXQoZGVsdGEsICdjb2RlLWJsb2NrJywgbGFuZ3VhZ2UsIHNjcm9sbCk7Cn0KZnVuY3Rpb24gbWF0Y2hJZ25vcmUoKSB7CiAgcmV0dXJuIG5ldyBEZWx0YSgpOwp9CmZ1bmN0aW9uIG1hdGNoSW5kZW50KG5vZGUsIGRlbHRhLCBzY3JvbGwpIHsKICBjb25zdCBtYXRjaCA9IHNjcm9sbC5xdWVyeShub2RlKTsKICBpZiAobWF0Y2ggPT0gbnVsbCB8fAogIC8vIEB0cy1leHBlY3QtZXJyb3IKICBtYXRjaC5ibG90TmFtZSAhPT0gJ2xpc3QnIHx8ICFkZWx0YUVuZHNXaXRoKGRlbHRhLCAnXG4nKSkgewogICAgcmV0dXJuIGRlbHRhOwogIH0KICBsZXQgaW5kZW50ID0gLTE7CiAgbGV0IHBhcmVudCA9IG5vZGUucGFyZW50Tm9kZTsKICB3aGlsZSAocGFyZW50ICE9IG51bGwpIHsKICAgIC8vIEB0cy1leHBlY3QtZXJyb3IKICAgIGlmIChbJ09MJywgJ1VMJ10uaW5jbHVkZXMocGFyZW50LnRhZ05hbWUpKSB7CiAgICAgIGluZGVudCArPSAxOwogICAgfQogICAgcGFyZW50ID0gcGFyZW50LnBhcmVudE5vZGU7CiAgfQogIGlmIChpbmRlbnQgPD0gMCkgcmV0dXJuIGRlbHRhOwogIHJldHVybiBkZWx0YS5yZWR1Y2UoKGNvbXBvc2VkLCBvcCkgPT4gewogICAgaWYgKCFvcC5pbnNlcnQpIHJldHVybiBjb21wb3NlZDsKICAgIGlmIChvcC5hdHRyaWJ1dGVzICYmIHR5cGVvZiBvcC5hdHRyaWJ1dGVzLmluZGVudCA9PT0gJ251bWJlcicpIHsKICAgICAgcmV0dXJuIGNvbXBvc2VkLnB1c2gob3ApOwogICAgfQogICAgcmV0dXJuIGNvbXBvc2VkLmluc2VydChvcC5pbnNlcnQsIHsKICAgICAgaW5kZW50LAogICAgICAuLi4ob3AuYXR0cmlidXRlcyB8fCB7fSkKICAgIH0pOwogIH0sIG5ldyBEZWx0YSgpKTsKfQpmdW5jdGlvbiBtYXRjaExpc3Qobm9kZSwgZGVsdGEsIHNjcm9sbCkgewogIGNvbnN0IGVsZW1lbnQgPSBub2RlOwogIGxldCBsaXN0ID0gZWxlbWVudC50YWdOYW1lID09PSAnT0wnID8gJ29yZGVyZWQnIDogJ2J1bGxldCc7CiAgY29uc3QgY2hlY2tlZEF0dHIgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnZGF0YS1jaGVja2VkJyk7CiAgaWYgKGNoZWNrZWRBdHRyKSB7CiAgICBsaXN0ID0gY2hlY2tlZEF0dHIgPT09ICd0cnVlJyA/ICdjaGVja2VkJyA6ICd1bmNoZWNrZWQnOwogIH0KICByZXR1cm4gYXBwbHlGb3JtYXQoZGVsdGEsICdsaXN0JywgbGlzdCwgc2Nyb2xsKTsKfQpmdW5jdGlvbiBtYXRjaE5ld2xpbmUobm9kZSwgZGVsdGEsIHNjcm9sbCkgewogIGlmICghZGVsdGFFbmRzV2l0aChkZWx0YSwgJ1xuJykpIHsKICAgIGlmIChpc0xpbmUobm9kZSwgc2Nyb2xsKSAmJiAobm9kZS5jaGlsZE5vZGVzLmxlbmd0aCA+IDAgfHwgbm9kZSBpbnN0YW5jZW9mIEhUTUxQYXJhZ3JhcGhFbGVtZW50KSkgewogICAgICByZXR1cm4gZGVsdGEuaW5zZXJ0KCdcbicpOwogICAgfQogICAgaWYgKGRlbHRhLmxlbmd0aCgpID4gMCAmJiBub2RlLm5leHRTaWJsaW5nKSB7CiAgICAgIGxldCBuZXh0U2libGluZyA9IG5vZGUubmV4dFNpYmxpbmc7CiAgICAgIHdoaWxlIChuZXh0U2libGluZyAhPSBudWxsKSB7CiAgICAgICAgaWYgKGlzTGluZShuZXh0U2libGluZywgc2Nyb2xsKSkgewogICAgICAgICAgcmV0dXJuIGRlbHRhLmluc2VydCgnXG4nKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbWF0Y2ggPSBzY3JvbGwucXVlcnkobmV4dFNpYmxpbmcpOwogICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IKICAgICAgICBpZiAobWF0Y2ggJiYgbWF0Y2gucHJvdG90eXBlIGluc3RhbmNlb2YgQmxvY2tFbWJlZCkgewogICAgICAgICAgcmV0dXJuIGRlbHRhLmluc2VydCgnXG4nKTsKICAgICAgICB9CiAgICAgICAgbmV4dFNpYmxpbmcgPSBuZXh0U2libGluZy5maXJzdENoaWxkOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiBkZWx0YTsKfQpmdW5jdGlvbiBtYXRjaFN0eWxlcyhub2RlLCBkZWx0YSwgc2Nyb2xsKSB7CiAgdmFyIF9zdHlsZSRmb250V2VpZ2h0OwogIGNvbnN0IGZvcm1hdHMgPSB7fTsKICBjb25zdCBzdHlsZSA9IG5vZGUuc3R5bGUgfHwge307CiAgaWYgKHN0eWxlLmZvbnRTdHlsZSA9PT0gJ2l0YWxpYycpIHsKICAgIGZvcm1hdHMuaXRhbGljID0gdHJ1ZTsKICB9CiAgaWYgKHN0eWxlLnRleHREZWNvcmF0aW9uID09PSAndW5kZXJsaW5lJykgewogICAgZm9ybWF0cy51bmRlcmxpbmUgPSB0cnVlOwogIH0KICBpZiAoc3R5bGUudGV4dERlY29yYXRpb24gPT09ICdsaW5lLXRocm91Z2gnKSB7CiAgICBmb3JtYXRzLnN0cmlrZSA9IHRydWU7CiAgfQogIGlmICgoX3N0eWxlJGZvbnRXZWlnaHQgPSBzdHlsZS5mb250V2VpZ2h0KSAhPT0gbnVsbCAmJiBfc3R5bGUkZm9udFdlaWdodCAhPT0gdm9pZCAwICYmIF9zdHlsZSRmb250V2VpZ2h0LnN0YXJ0c1dpdGgoJ2JvbGQnKSB8fAogIC8vIEB0cy1leHBlY3QtZXJyb3IgRml4IG1lIGxhdGVyCiAgcGFyc2VJbnQoc3R5bGUuZm9udFdlaWdodCwgMTApID49IDcwMCkgewogICAgZm9ybWF0cy5ib2xkID0gdHJ1ZTsKICB9CiAgZGVsdGEgPSBPYmplY3QuZW50cmllcyhmb3JtYXRzKS5yZWR1Y2UoKG5ld0RlbHRhLCBfcmVmNSkgPT4gewogICAgbGV0IFtuYW1lLCB2YWx1ZV0gPSBfcmVmNTsKICAgIHJldHVybiBhcHBseUZvcm1hdChuZXdEZWx0YSwgbmFtZSwgdmFsdWUsIHNjcm9sbCk7CiAgfSwgZGVsdGEpOwogIC8vIEB0cy1leHBlY3QtZXJyb3IKICBpZiAocGFyc2VGbG9hdChzdHlsZS50ZXh0SW5kZW50IHx8IDApID4gMCkgewogICAgLy8gQ291bGQgYmUgMC41aW4KICAgIHJldHVybiBuZXcgRGVsdGEoKS5pbnNlcnQoJ1x0JykuY29uY2F0KGRlbHRhKTsKICB9CiAgcmV0dXJuIGRlbHRhOwp9CmZ1bmN0aW9uIG1hdGNoVGFibGUobm9kZSwgZGVsdGEsIHNjcm9sbCkgewogIHZhciBfbm9kZSRwYXJlbnRFbGVtZW50LCBfbm9kZSRwYXJlbnRFbGVtZW50MjsKICBjb25zdCB0YWJsZSA9ICgoX25vZGUkcGFyZW50RWxlbWVudCA9IG5vZGUucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX25vZGUkcGFyZW50RWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX25vZGUkcGFyZW50RWxlbWVudC50YWdOYW1lKSA9PT0gJ1RBQkxFJyA/IG5vZGUucGFyZW50RWxlbWVudCA6IChfbm9kZSRwYXJlbnRFbGVtZW50MiA9IG5vZGUucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX25vZGUkcGFyZW50RWxlbWVudDIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9ub2RlJHBhcmVudEVsZW1lbnQyLnBhcmVudEVsZW1lbnQ7CiAgaWYgKHRhYmxlICE9IG51bGwpIHsKICAgIGNvbnN0IHJvd3MgPSBBcnJheS5mcm9tKHRhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyJykpOwogICAgY29uc3Qgcm93ID0gcm93cy5pbmRleE9mKG5vZGUpICsgMTsKICAgIHJldHVybiBhcHBseUZvcm1hdChkZWx0YSwgJ3RhYmxlJywgcm93LCBzY3JvbGwpOwogIH0KICByZXR1cm4gZGVsdGE7Cn0KZnVuY3Rpb24gbWF0Y2hUZXh0KG5vZGUsIGRlbHRhLCBzY3JvbGwpIHsKICB2YXIgX25vZGUkcGFyZW50RWxlbWVudDM7CiAgLy8gQHRzLWV4cGVjdC1lcnJvcgogIGxldCB0ZXh0ID0gbm9kZS5kYXRhOwogIC8vIFdvcmQgcmVwcmVzZW50cyBlbXB0eSBsaW5lIHdpdGggPG86cD4mbmJzcDs8L286cD4KICBpZiAoKChfbm9kZSRwYXJlbnRFbGVtZW50MyA9IG5vZGUucGFyZW50RWxlbWVudCkgPT09IG51bGwgfHwgX25vZGUkcGFyZW50RWxlbWVudDMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9ub2RlJHBhcmVudEVsZW1lbnQzLnRhZ05hbWUpID09PSAnTzpQJykgewogICAgcmV0dXJuIGRlbHRhLmluc2VydCh0ZXh0LnRyaW0oKSk7CiAgfQogIGlmICghaXNQcmUobm9kZSkpIHsKICAgIGlmICh0ZXh0LnRyaW0oKS5sZW5ndGggPT09IDAgJiYgdGV4dC5pbmNsdWRlcygnXG4nKSAmJiAhaXNCZXR3ZWVuSW5saW5lRWxlbWVudHMobm9kZSwgc2Nyb2xsKSkgewogICAgICByZXR1cm4gZGVsdGE7CiAgICB9CiAgICAvLyBjb252ZXJ0IGFsbCBub24tbmJzcCB3aGl0ZXNwYWNlIGludG8gcmVndWxhciBzcGFjZQogICAgdGV4dCA9IHRleHQucmVwbGFjZSgvW15cU1x1MDBhMF0vZywgJyAnKTsKICAgIC8vIGNvbGxhcHNlIGNvbnNlY3V0aXZlIHNwYWNlcyBpbnRvIG9uZQogICAgdGV4dCA9IHRleHQucmVwbGFjZSgvIHsyLH0vZywgJyAnKTsKICAgIGlmIChub2RlLnByZXZpb3VzU2libGluZyA9PSBudWxsICYmIG5vZGUucGFyZW50RWxlbWVudCAhPSBudWxsICYmIGlzTGluZShub2RlLnBhcmVudEVsZW1lbnQsIHNjcm9sbCkgfHwgbm9kZS5wcmV2aW91c1NpYmxpbmcgaW5zdGFuY2VvZiBFbGVtZW50ICYmIGlzTGluZShub2RlLnByZXZpb3VzU2libGluZywgc2Nyb2xsKSkgewogICAgICAvLyBibG9jayBzdHJ1Y3R1cmUgbWVhbnMgd2UgZG9uJ3QgbmVlZCBsZWFkaW5nIHNwYWNlCiAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoL14gLywgJycpOwogICAgfQogICAgaWYgKG5vZGUubmV4dFNpYmxpbmcgPT0gbnVsbCAmJiBub2RlLnBhcmVudEVsZW1lbnQgIT0gbnVsbCAmJiBpc0xpbmUobm9kZS5wYXJlbnRFbGVtZW50LCBzY3JvbGwpIHx8IG5vZGUubmV4dFNpYmxpbmcgaW5zdGFuY2VvZiBFbGVtZW50ICYmIGlzTGluZShub2RlLm5leHRTaWJsaW5nLCBzY3JvbGwpKSB7CiAgICAgIC8vIGJsb2NrIHN0cnVjdHVyZSBtZWFucyB3ZSBkb24ndCBuZWVkIHRyYWlsaW5nIHNwYWNlCiAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyAkLywgJycpOwogICAgfQogICAgLy8gZG9uZSByZW1vdmluZyB3aGl0ZXNwYWNlIGFuZCBjYW4gbm9ybWFsaXplIGFsbCB0byByZWd1bGFyIHNwYWNlCiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlQWxsKCdcdTAwYTAnLCAnICcpOwogIH0KICByZXR1cm4gZGVsdGEuaW5zZXJ0KHRleHQpOwp9CmV4cG9ydCB7IENsaXBib2FyZCBhcyBkZWZhdWx0LCBtYXRjaEF0dHJpYnV0b3IsIG1hdGNoQmxvdCwgbWF0Y2hOZXdsaW5lLCBtYXRjaFRleHQsIHRyYXZlcnNlIH07"},{"version":3,"names":["Attributor","BlockBlot","ClassAttributor","EmbedBlot","Scope","StyleAttributor","Delta","BlockEmbed","logger","Module","Quill","AlignAttribute","AlignStyle","BackgroundStyle","CodeBlock","ColorStyle","DirectionAttribute","DirectionStyle","FontStyle","SizeStyle","deleteRange","normalizeExternalHTML","debug","CLIPBOARD_CONFIG","Node","TEXT_NODE","matchText","matchNewline","matchBreak","ELEMENT_NODE","matchBlot","matchAttributor","matchStyles","matchIndent","matchList","matchCodeBlock","matchTable","createMatchAlias","matchIgnore","ATTRIBUTE_ATTRIBUTORS","reduce","memo","attr","keyName","STYLE_ATTRIBUTORS","Clipboard","constructor","quill","options","_this$options$matcher","root","addEventListener","e","onCaptureCopy","onCapturePaste","bind","matchers","concat","forEach","_ref","selector","matcher","addMatcher","push","convert","_ref2","html","text","formats","arguments","length","undefined","blotName","insert","delta","convertHTML","deltaEndsWith","ops","attributes","table","compose","retain","delete","normalizeHTML","doc","DOMParser","parseFromString","container","body","nodeMatches","WeakMap","elementMatchers","textMatchers","prepareMatching","traverse","scroll","dangerouslyPasteHTML","index","source","sources","API","setContents","setSelection","SILENT","paste","updateContents","_e$clipboardData","_e$clipboardData2","isCut","defaultPrevented","preventDefault","range","selection","getRange","onCopy","clipboardData","setData","normalizeURIList","urlList","split","filter","url","join","_e$clipboardData3","_e$clipboardData4","_e$clipboardData6","isEnabled","getSelection","getData","_e$clipboardData5","files","Array","from","uploader","upload","_doc$body$firstElemen","childElementCount","firstElementChild","tagName","onPaste","getText","getSemanticHTML","_ref3","getFormat","pastedDelta","log","USER","scrollSelectionIntoView","pair","querySelectorAll","node","has","matches","get","set","_defineProperty","applyFormat","format","value","query","newDelta","op","endText","i","slice","isLine","Element","match","prototype","includes","toLowerCase","isBetweenInlineElements","previousElementSibling","nextElementSibling","preNodes","isPre","parentNode","nodeType","childNodes","childNode","childrenDelta","reducedDelta","_node","keys","classes","styles","name","ATTRIBUTE","attrName","Object","entries","_ref4","embed","language","indent","parent","composed","element","list","checkedAttr","getAttribute","HTMLParagraphElement","nextSibling","firstChild","_style$fontWeight","style","fontStyle","italic","textDecoration","underline","strike","fontWeight","startsWith","parseInt","bold","_ref5","parseFloat","textIndent","_node$parentElement","_node$parentElement2","parentElement","rows","row","indexOf","_node$parentElement3","data","trim","replace","previousSibling","replaceAll","default"],"sources":["../../src/modules/clipboard.ts"],"sourcesContent":["import type { ScrollBlot } from 'parchment';\nimport {\n  Attributor,\n  BlockBlot,\n  ClassAttributor,\n  EmbedBlot,\n  Scope,\n  StyleAttributor,\n} from 'parchment';\nimport Delta from 'quill-delta';\nimport { BlockEmbed } from '../blots/block.js';\nimport type { EmitterSource } from '../core/emitter.js';\nimport logger from '../core/logger.js';\nimport Module from '../core/module.js';\nimport Quill from '../core/quill.js';\nimport type { Range } from '../core/selection.js';\nimport { AlignAttribute, AlignStyle } from '../formats/align.js';\nimport { BackgroundStyle } from '../formats/background.js';\nimport CodeBlock from '../formats/code.js';\nimport { ColorStyle } from '../formats/color.js';\nimport { DirectionAttribute, DirectionStyle } from '../formats/direction.js';\nimport { FontStyle } from '../formats/font.js';\nimport { SizeStyle } from '../formats/size.js';\nimport { deleteRange } from './keyboard.js';\nimport normalizeExternalHTML from './normalizeExternalHTML/index.js';\n\nconst debug = logger('quill:clipboard');\n\ntype Selector = string | Node['TEXT_NODE'] | Node['ELEMENT_NODE'];\ntype Matcher = (node: Node, delta: Delta, scroll: ScrollBlot) => Delta;\n\nconst CLIPBOARD_CONFIG: [Selector, Matcher][] = [\n  [Node.TEXT_NODE, matchText],\n  [Node.TEXT_NODE, matchNewline],\n  ['br', matchBreak],\n  [Node.ELEMENT_NODE, matchNewline],\n  [Node.ELEMENT_NODE, matchBlot],\n  [Node.ELEMENT_NODE, matchAttributor],\n  [Node.ELEMENT_NODE, matchStyles],\n  ['li', matchIndent],\n  ['ol, ul', matchList],\n  ['pre', matchCodeBlock],\n  ['tr', matchTable],\n  ['b', createMatchAlias('bold')],\n  ['i', createMatchAlias('italic')],\n  ['strike', createMatchAlias('strike')],\n  ['style', matchIgnore],\n];\n\nconst ATTRIBUTE_ATTRIBUTORS = [AlignAttribute, DirectionAttribute].reduce(\n  (memo: Record<string, Attributor>, attr) => {\n    memo[attr.keyName] = attr;\n    return memo;\n  },\n  {},\n);\n\nconst STYLE_ATTRIBUTORS = [\n  AlignStyle,\n  BackgroundStyle,\n  ColorStyle,\n  DirectionStyle,\n  FontStyle,\n  SizeStyle,\n].reduce((memo: Record<string, Attributor>, attr) => {\n  memo[attr.keyName] = attr;\n  return memo;\n}, {});\n\ninterface ClipboardOptions {\n  matchers: [Selector, Matcher][];\n}\n\nclass Clipboard extends Module<ClipboardOptions> {\n  static DEFAULTS: ClipboardOptions = {\n    matchers: [],\n  };\n\n  matchers: [Selector, Matcher][];\n\n  constructor(quill: Quill, options: Partial<ClipboardOptions>) {\n    super(quill, options);\n    this.quill.root.addEventListener('copy', (e) =>\n      this.onCaptureCopy(e, false),\n    );\n    this.quill.root.addEventListener('cut', (e) => this.onCaptureCopy(e, true));\n    this.quill.root.addEventListener('paste', this.onCapturePaste.bind(this));\n    this.matchers = [];\n    CLIPBOARD_CONFIG.concat(this.options.matchers ?? []).forEach(\n      ([selector, matcher]) => {\n        this.addMatcher(selector, matcher);\n      },\n    );\n  }\n\n  addMatcher(selector: Selector, matcher: Matcher) {\n    this.matchers.push([selector, matcher]);\n  }\n\n  convert(\n    { html, text }: { html?: string; text?: string },\n    formats: Record<string, unknown> = {},\n  ) {\n    if (formats[CodeBlock.blotName]) {\n      return new Delta().insert(text || '', {\n        [CodeBlock.blotName]: formats[CodeBlock.blotName],\n      });\n    }\n    if (!html) {\n      return new Delta().insert(text || '', formats);\n    }\n    const delta = this.convertHTML(html);\n    // Remove trailing newline\n    if (\n      deltaEndsWith(delta, '\\n') &&\n      (delta.ops[delta.ops.length - 1].attributes == null || formats.table)\n    ) {\n      return delta.compose(new Delta().retain(delta.length() - 1).delete(1));\n    }\n    return delta;\n  }\n\n  protected normalizeHTML(doc: Document) {\n    normalizeExternalHTML(doc);\n  }\n\n  protected convertHTML(html: string) {\n    const doc = new DOMParser().parseFromString(html, 'text/html');\n    this.normalizeHTML(doc);\n    const container = doc.body;\n    const nodeMatches = new WeakMap();\n    const [elementMatchers, textMatchers] = this.prepareMatching(\n      container,\n      nodeMatches,\n    );\n    return traverse(\n      this.quill.scroll,\n      container,\n      elementMatchers,\n      textMatchers,\n      nodeMatches,\n    );\n  }\n\n  dangerouslyPasteHTML(html: string, source?: EmitterSource): void;\n  dangerouslyPasteHTML(\n    index: number,\n    html: string,\n    source?: EmitterSource,\n  ): void;\n  dangerouslyPasteHTML(\n    index: number | string,\n    html?: string,\n    source: EmitterSource = Quill.sources.API,\n  ) {\n    if (typeof index === 'string') {\n      const delta = this.convert({ html: index, text: '' });\n      // @ts-expect-error\n      this.quill.setContents(delta, html);\n      this.quill.setSelection(0, Quill.sources.SILENT);\n    } else {\n      const paste = this.convert({ html, text: '' });\n      this.quill.updateContents(\n        new Delta().retain(index).concat(paste),\n        source,\n      );\n      this.quill.setSelection(index + paste.length(), Quill.sources.SILENT);\n    }\n  }\n\n  onCaptureCopy(e: ClipboardEvent, isCut = false) {\n    if (e.defaultPrevented) return;\n    e.preventDefault();\n    const [range] = this.quill.selection.getRange();\n    if (range == null) return;\n    const { html, text } = this.onCopy(range, isCut);\n    e.clipboardData?.setData('text/plain', text);\n    e.clipboardData?.setData('text/html', html);\n    if (isCut) {\n      deleteRange({ range, quill: this.quill });\n    }\n  }\n\n  /*\n   * https://www.iana.org/assignments/media-types/text/uri-list\n   */\n  private normalizeURIList(urlList: string) {\n    return (\n      urlList\n        .split(/\\r?\\n/)\n        // Ignore all comments\n        .filter((url) => url[0] !== '#')\n        .join('\\n')\n    );\n  }\n\n  onCapturePaste(e: ClipboardEvent) {\n    if (e.defaultPrevented || !this.quill.isEnabled()) return;\n    e.preventDefault();\n    const range = this.quill.getSelection(true);\n    if (range == null) return;\n    const html = e.clipboardData?.getData('text/html');\n    let text = e.clipboardData?.getData('text/plain');\n    if (!html && !text) {\n      const urlList = e.clipboardData?.getData('text/uri-list');\n      if (urlList) {\n        text = this.normalizeURIList(urlList);\n      }\n    }\n    const files = Array.from(e.clipboardData?.files || []);\n    if (!html && files.length > 0) {\n      this.quill.uploader.upload(range, files);\n      return;\n    }\n    if (html && files.length > 0) {\n      const doc = new DOMParser().parseFromString(html, 'text/html');\n      if (\n        doc.body.childElementCount === 1 &&\n        doc.body.firstElementChild?.tagName === 'IMG'\n      ) {\n        this.quill.uploader.upload(range, files);\n        return;\n      }\n    }\n    this.onPaste(range, { html, text });\n  }\n\n  onCopy(range: Range, isCut: boolean): { html: string; text: string };\n  onCopy(range: Range) {\n    const text = this.quill.getText(range);\n    const html = this.quill.getSemanticHTML(range);\n    return { html, text };\n  }\n\n  onPaste(range: Range, { text, html }: { text?: string; html?: string }) {\n    const formats = this.quill.getFormat(range.index);\n    const pastedDelta = this.convert({ text, html }, formats);\n    debug.log('onPaste', pastedDelta, { text, html });\n    const delta = new Delta()\n      .retain(range.index)\n      .delete(range.length)\n      .concat(pastedDelta);\n    this.quill.updateContents(delta, Quill.sources.USER);\n    // range.length contributes to delta.length()\n    this.quill.setSelection(\n      delta.length() - range.length,\n      Quill.sources.SILENT,\n    );\n    this.quill.scrollSelectionIntoView();\n  }\n\n  prepareMatching(container: Element, nodeMatches: WeakMap<Node, Matcher[]>) {\n    const elementMatchers: Matcher[] = [];\n    const textMatchers: Matcher[] = [];\n    this.matchers.forEach((pair) => {\n      const [selector, matcher] = pair;\n      switch (selector) {\n        case Node.TEXT_NODE:\n          textMatchers.push(matcher);\n          break;\n        case Node.ELEMENT_NODE:\n          elementMatchers.push(matcher);\n          break;\n        default:\n          Array.from(container.querySelectorAll(selector)).forEach((node) => {\n            if (nodeMatches.has(node)) {\n              const matches = nodeMatches.get(node);\n              matches?.push(matcher);\n            } else {\n              nodeMatches.set(node, [matcher]);\n            }\n          });\n          break;\n      }\n    });\n    return [elementMatchers, textMatchers];\n  }\n}\n\nfunction applyFormat(\n  delta: Delta,\n  format: string,\n  value: unknown,\n  scroll: ScrollBlot,\n): Delta {\n  if (!scroll.query(format)) {\n    return delta;\n  }\n\n  return delta.reduce((newDelta, op) => {\n    if (!op.insert) return newDelta;\n    if (op.attributes && op.attributes[format]) {\n      return newDelta.push(op);\n    }\n    const formats = value ? { [format]: value } : {};\n    return newDelta.insert(op.insert, { ...formats, ...op.attributes });\n  }, new Delta());\n}\n\nfunction deltaEndsWith(delta: Delta, text: string) {\n  let endText = '';\n  for (\n    let i = delta.ops.length - 1;\n    i >= 0 && endText.length < text.length;\n    --i // eslint-disable-line no-plusplus\n  ) {\n    const op = delta.ops[i];\n    if (typeof op.insert !== 'string') break;\n    endText = op.insert + endText;\n  }\n  return endText.slice(-1 * text.length) === text;\n}\n\nfunction isLine(node: Node, scroll: ScrollBlot) {\n  if (!(node instanceof Element)) return false;\n  const match = scroll.query(node);\n  // @ts-expect-error\n  if (match && match.prototype instanceof EmbedBlot) return false;\n\n  return [\n    'address',\n    'article',\n    'blockquote',\n    'canvas',\n    'dd',\n    'div',\n    'dl',\n    'dt',\n    'fieldset',\n    'figcaption',\n    'figure',\n    'footer',\n    'form',\n    'h1',\n    'h2',\n    'h3',\n    'h4',\n    'h5',\n    'h6',\n    'header',\n    'iframe',\n    'li',\n    'main',\n    'nav',\n    'ol',\n    'output',\n    'p',\n    'pre',\n    'section',\n    'table',\n    'td',\n    'tr',\n    'ul',\n    'video',\n  ].includes(node.tagName.toLowerCase());\n}\n\nfunction isBetweenInlineElements(node: HTMLElement, scroll: ScrollBlot) {\n  return (\n    node.previousElementSibling &&\n    node.nextElementSibling &&\n    !isLine(node.previousElementSibling, scroll) &&\n    !isLine(node.nextElementSibling, scroll)\n  );\n}\n\nconst preNodes = new WeakMap();\nfunction isPre(node: Node | null) {\n  if (node == null) return false;\n  if (!preNodes.has(node)) {\n    // @ts-expect-error\n    if (node.tagName === 'PRE') {\n      preNodes.set(node, true);\n    } else {\n      preNodes.set(node, isPre(node.parentNode));\n    }\n  }\n  return preNodes.get(node);\n}\n\nfunction traverse(\n  scroll: ScrollBlot,\n  node: ChildNode,\n  elementMatchers: Matcher[],\n  textMatchers: Matcher[],\n  nodeMatches: WeakMap<Node, Matcher[]>,\n): Delta {\n  // Post-order\n  if (node.nodeType === node.TEXT_NODE) {\n    return textMatchers.reduce((delta: Delta, matcher) => {\n      return matcher(node, delta, scroll);\n    }, new Delta());\n  }\n  if (node.nodeType === node.ELEMENT_NODE) {\n    return Array.from(node.childNodes || []).reduce((delta, childNode) => {\n      let childrenDelta = traverse(\n        scroll,\n        childNode,\n        elementMatchers,\n        textMatchers,\n        nodeMatches,\n      );\n      if (childNode.nodeType === node.ELEMENT_NODE) {\n        childrenDelta = elementMatchers.reduce((reducedDelta, matcher) => {\n          return matcher(childNode as HTMLElement, reducedDelta, scroll);\n        }, childrenDelta);\n        childrenDelta = (nodeMatches.get(childNode) || []).reduce(\n          (reducedDelta, matcher) => {\n            return matcher(childNode, reducedDelta, scroll);\n          },\n          childrenDelta,\n        );\n      }\n      return delta.concat(childrenDelta);\n    }, new Delta());\n  }\n  return new Delta();\n}\n\nfunction createMatchAlias(format: string) {\n  return (_node: Element, delta: Delta, scroll: ScrollBlot) => {\n    return applyFormat(delta, format, true, scroll);\n  };\n}\n\nfunction matchAttributor(node: HTMLElement, delta: Delta, scroll: ScrollBlot) {\n  const attributes = Attributor.keys(node);\n  const classes = ClassAttributor.keys(node);\n  const styles = StyleAttributor.keys(node);\n  const formats: Record<string, string | undefined> = {};\n  attributes\n    .concat(classes)\n    .concat(styles)\n    .forEach((name) => {\n      let attr = scroll.query(name, Scope.ATTRIBUTE) as Attributor;\n      if (attr != null) {\n        formats[attr.attrName] = attr.value(node);\n        if (formats[attr.attrName]) return;\n      }\n      attr = ATTRIBUTE_ATTRIBUTORS[name];\n      if (attr != null && (attr.attrName === name || attr.keyName === name)) {\n        formats[attr.attrName] = attr.value(node) || undefined;\n      }\n      attr = STYLE_ATTRIBUTORS[name];\n      if (attr != null && (attr.attrName === name || attr.keyName === name)) {\n        attr = STYLE_ATTRIBUTORS[name];\n        formats[attr.attrName] = attr.value(node) || undefined;\n      }\n    });\n\n  return Object.entries(formats).reduce(\n    (newDelta, [name, value]) => applyFormat(newDelta, name, value, scroll),\n    delta,\n  );\n}\n\nfunction matchBlot(node: Node, delta: Delta, scroll: ScrollBlot) {\n  const match = scroll.query(node);\n  if (match == null) return delta;\n  // @ts-expect-error\n  if (match.prototype instanceof EmbedBlot) {\n    const embed = {};\n    // @ts-expect-error\n    const value = match.value(node);\n    if (value != null) {\n      // @ts-expect-error\n      embed[match.blotName] = value;\n      // @ts-expect-error\n      return new Delta().insert(embed, match.formats(node, scroll));\n    }\n  } else {\n    // @ts-expect-error\n    if (match.prototype instanceof BlockBlot && !deltaEndsWith(delta, '\\n')) {\n      delta.insert('\\n');\n    }\n    if (\n      'blotName' in match &&\n      'formats' in match &&\n      typeof match.formats === 'function'\n    ) {\n      return applyFormat(\n        delta,\n        match.blotName,\n        match.formats(node, scroll),\n        scroll,\n      );\n    }\n  }\n  return delta;\n}\n\nfunction matchBreak(node: Node, delta: Delta) {\n  if (!deltaEndsWith(delta, '\\n')) {\n    delta.insert('\\n');\n  }\n  return delta;\n}\n\nfunction matchCodeBlock(node: Node, delta: Delta, scroll: ScrollBlot) {\n  const match = scroll.query('code-block');\n  const language =\n    match && 'formats' in match && typeof match.formats === 'function'\n      ? match.formats(node, scroll)\n      : true;\n  return applyFormat(delta, 'code-block', language, scroll);\n}\n\nfunction matchIgnore() {\n  return new Delta();\n}\n\nfunction matchIndent(node: Node, delta: Delta, scroll: ScrollBlot) {\n  const match = scroll.query(node);\n  if (\n    match == null ||\n    // @ts-expect-error\n    match.blotName !== 'list' ||\n    !deltaEndsWith(delta, '\\n')\n  ) {\n    return delta;\n  }\n  let indent = -1;\n  let parent = node.parentNode;\n  while (parent != null) {\n    // @ts-expect-error\n    if (['OL', 'UL'].includes(parent.tagName)) {\n      indent += 1;\n    }\n    parent = parent.parentNode;\n  }\n  if (indent <= 0) return delta;\n  return delta.reduce((composed, op) => {\n    if (!op.insert) return composed;\n    if (op.attributes && typeof op.attributes.indent === 'number') {\n      return composed.push(op);\n    }\n    return composed.insert(op.insert, { indent, ...(op.attributes || {}) });\n  }, new Delta());\n}\n\nfunction matchList(node: Node, delta: Delta, scroll: ScrollBlot) {\n  const element = node as Element;\n  let list = element.tagName === 'OL' ? 'ordered' : 'bullet';\n\n  const checkedAttr = element.getAttribute('data-checked');\n  if (checkedAttr) {\n    list = checkedAttr === 'true' ? 'checked' : 'unchecked';\n  }\n\n  return applyFormat(delta, 'list', list, scroll);\n}\n\nfunction matchNewline(node: Node, delta: Delta, scroll: ScrollBlot) {\n  if (!deltaEndsWith(delta, '\\n')) {\n    if (\n      isLine(node, scroll) &&\n      (node.childNodes.length > 0 || node instanceof HTMLParagraphElement)\n    ) {\n      return delta.insert('\\n');\n    }\n    if (delta.length() > 0 && node.nextSibling) {\n      let nextSibling: Node | null = node.nextSibling;\n      while (nextSibling != null) {\n        if (isLine(nextSibling, scroll)) {\n          return delta.insert('\\n');\n        }\n        const match = scroll.query(nextSibling);\n        // @ts-expect-error\n        if (match && match.prototype instanceof BlockEmbed) {\n          return delta.insert('\\n');\n        }\n        nextSibling = nextSibling.firstChild;\n      }\n    }\n  }\n  return delta;\n}\n\nfunction matchStyles(node: HTMLElement, delta: Delta, scroll: ScrollBlot) {\n  const formats: Record<string, unknown> = {};\n  const style: Partial<CSSStyleDeclaration> = node.style || {};\n  if (style.fontStyle === 'italic') {\n    formats.italic = true;\n  }\n  if (style.textDecoration === 'underline') {\n    formats.underline = true;\n  }\n  if (style.textDecoration === 'line-through') {\n    formats.strike = true;\n  }\n  if (\n    style.fontWeight?.startsWith('bold') ||\n    // @ts-expect-error Fix me later\n    parseInt(style.fontWeight, 10) >= 700\n  ) {\n    formats.bold = true;\n  }\n  delta = Object.entries(formats).reduce(\n    (newDelta, [name, value]) => applyFormat(newDelta, name, value, scroll),\n    delta,\n  );\n  // @ts-expect-error\n  if (parseFloat(style.textIndent || 0) > 0) {\n    // Could be 0.5in\n    return new Delta().insert('\\t').concat(delta);\n  }\n  return delta;\n}\n\nfunction matchTable(\n  node: HTMLTableRowElement,\n  delta: Delta,\n  scroll: ScrollBlot,\n) {\n  const table =\n    node.parentElement?.tagName === 'TABLE'\n      ? node.parentElement\n      : node.parentElement?.parentElement;\n  if (table != null) {\n    const rows = Array.from(table.querySelectorAll('tr'));\n    const row = rows.indexOf(node) + 1;\n    return applyFormat(delta, 'table', row, scroll);\n  }\n  return delta;\n}\n\nfunction matchText(node: HTMLElement, delta: Delta, scroll: ScrollBlot) {\n  // @ts-expect-error\n  let text = node.data as string;\n  // Word represents empty line with <o:p>&nbsp;</o:p>\n  if (node.parentElement?.tagName === 'O:P') {\n    return delta.insert(text.trim());\n  }\n  if (!isPre(node)) {\n    if (\n      text.trim().length === 0 &&\n      text.includes('\\n') &&\n      !isBetweenInlineElements(node, scroll)\n    ) {\n      return delta;\n    }\n    // convert all non-nbsp whitespace into regular space\n    text = text.replace(/[^\\S\\u00a0]/g, ' ');\n    // collapse consecutive spaces into one\n    text = text.replace(/ {2,}/g, ' ');\n    if (\n      (node.previousSibling == null &&\n        node.parentElement != null &&\n        isLine(node.parentElement, scroll)) ||\n      (node.previousSibling instanceof Element &&\n        isLine(node.previousSibling, scroll))\n    ) {\n      // block structure means we don't need leading space\n      text = text.replace(/^ /, '');\n    }\n    if (\n      (node.nextSibling == null &&\n        node.parentElement != null &&\n        isLine(node.parentElement, scroll)) ||\n      (node.nextSibling instanceof Element && isLine(node.nextSibling, scroll))\n    ) {\n      // block structure means we don't need trailing space\n      text = text.replace(/ $/, '');\n    }\n    // done removing whitespace and can normalize all to regular space\n    text = text.replaceAll('\\u00a0', ' ');\n  }\n  return delta.insert(text);\n}\n\nexport {\n  Clipboard as default,\n  matchAttributor,\n  matchBlot,\n  matchNewline,\n  matchText,\n  traverse,\n};\n"],"mappings":";;;;;;;;AACA,SACEA,UAAU,EACVC,SAAS,EACTC,eAAe,EACfC,SAAS,EACTC,KAAK,EACLC,eAAe,QACV,WAAW;AAClB,OAAOC,KAAK,MAAM,aAAa;AAC/B,SAASC,UAAU,QAAQ,mBAAmB;AAE9C,OAAOC,MAAM,MAAM,mBAAmB;AACtC,OAAOC,MAAM,MAAM,mBAAmB;AACtC,OAAOC,KAAK,MAAM,kBAAkB;AAEpC,SAASC,cAAc,EAAEC,UAAU,QAAQ,qBAAqB;AAChE,SAASC,eAAe,QAAQ,0BAA0B;AAC1D,OAAOC,SAAS,MAAM,oBAAoB;AAC1C,SAASC,UAAU,QAAQ,qBAAqB;AAChD,SAASC,kBAAkB,EAAEC,cAAc,QAAQ,yBAAyB;AAC5E,SAASC,SAAS,QAAQ,oBAAoB;AAC9C,SAASC,SAAS,QAAQ,oBAAoB;AAC9C,SAASC,WAAW,QAAQ,eAAe;AAC3C,OAAOC,qBAAqB,MAAM,kCAAkC;AAEpE,MAAMC,KAAK,GAAGd,MAAM,CAAC,iBAAiB,CAAC;AAKvC,MAAMe,gBAAuC,GAAG,CAC9C,CAACC,IAAI,CAACC,SAAS,EAAEC,SAAS,CAAC,EAC3B,CAACF,IAAI,CAACC,SAAS,EAAEE,YAAY,CAAC,EAC9B,CAAC,IAAI,EAAEC,UAAU,CAAC,EAClB,CAACJ,IAAI,CAACK,YAAY,EAAEF,YAAY,CAAC,EACjC,CAACH,IAAI,CAACK,YAAY,EAAEC,SAAS,CAAC,EAC9B,CAACN,IAAI,CAACK,YAAY,EAAEE,eAAe,CAAC,EACpC,CAACP,IAAI,CAACK,YAAY,EAAEG,WAAW,CAAC,EAChC,CAAC,IAAI,EAAEC,WAAW,CAAC,EACnB,CAAC,QAAQ,EAAEC,SAAS,CAAC,EACrB,CAAC,KAAK,EAAEC,cAAc,CAAC,EACvB,CAAC,IAAI,EAAEC,UAAU,CAAC,EAClB,CAAC,GAAG,EAAEC,gBAAgB,CAAC,MAAM,CAAC,CAAC,EAC/B,CAAC,GAAG,EAAEA,gBAAgB,CAAC,QAAQ,CAAC,CAAC,EACjC,CAAC,QAAQ,EAAEA,gBAAgB,CAAC,QAAQ,CAAC,CAAC,EACtC,CAAC,OAAO,EAAEC,WAAW,CAAC,CACvB;AAED,MAAMC,qBAAqB,GAAG,CAAC5B,cAAc,EAAEK,kBAAkB,CAAC,CAACwB,MAAM,CACvE,CAACC,IAAgC,EAAEC,IAAI,KAAK;EAC1CD,IAAI,CAACC,IAAI,CAACC,OAAO,CAAC,GAAGD,IAAI;EACzB,OAAOD,IAAI;AACb,CAAC,EACD,CAAC,CACH,CAAC;AAED,MAAMG,iBAAiB,GAAG,CACxBhC,UAAU,EACVC,eAAe,EACfE,UAAU,EACVE,cAAc,EACdC,SAAS,EACTC,SAAS,CACV,CAACqB,MAAM,CAAC,CAACC,IAAgC,EAAEC,IAAI,KAAK;EACnDD,IAAI,CAACC,IAAI,CAACC,OAAO,CAAC,GAAGD,IAAI;EACzB,OAAOD,IAAI;AACb,CAAC,EAAE,CAAC,CAAC,CAAC;AAMN,MAAMI,SAAS,SAASpC,MAAM,CAAmB;EAO/CqC,WAAWA,CAACC,KAAY,EAAEC,OAAkC,EAAE;IAAA,IAAAC,qBAAA;IAC5D,KAAK,CAACF,KAAK,EAAEC,OAAO,CAAC;IACrB,IAAI,CAACD,KAAK,CAACG,IAAI,CAACC,gBAAgB,CAAC,MAAM,EAAGC,CAAC,IACzC,IAAI,CAACC,aAAa,CAACD,CAAC,EAAE,KAAK,CAC7B,CAAC;IACD,IAAI,CAACL,KAAK,CAACG,IAAI,CAACC,gBAAgB,CAAC,KAAK,EAAGC,CAAC,IAAK,IAAI,CAACC,aAAa,CAACD,CAAC,EAAE,IAAI,CAAC,CAAC;IAC3E,IAAI,CAACL,KAAK,CAACG,IAAI,CAACC,gBAAgB,CAAC,OAAO,EAAE,IAAI,CAACG,cAAc,CAACC,IAAI,CAAC,IAAI,CAAC,CAAC;IACzE,IAAI,CAACC,QAAQ,GAAG,EAAE;IAClBjC,gBAAgB,CAACkC,MAAM,EAAAR,qBAAA,GAAC,IAAI,CAACD,OAAO,CAACQ,QAAQ,cAAAP,qBAAA,cAAAA,qBAAA,GAAI,EAAE,CAAC,CAACS,OAAO,CAC1DC,IAAA,IAAyB;MAAA,IAAxB,CAACC,QAAQ,EAAEC,OAAO,CAAC,GAAAF,IAAA;MAClB,IAAI,CAACG,UAAU,CAACF,QAAQ,EAAEC,OAAO,CAAC;IACpC,CACF,CAAC;EACH;EAEAC,UAAUA,CAACF,QAAkB,EAAEC,OAAgB,EAAE;IAC/C,IAAI,CAACL,QAAQ,CAACO,IAAI,CAAC,CAACH,QAAQ,EAAEC,OAAO,CAAC,CAAC;EACzC;EAEAG,OAAOA,CAAAC,KAAA,EAGL;IAAA,IAFA;MAAEC,IAAI;MAAEC;IAAuC,CAAC,GAAAF,KAAA;IAAA,IAChDG,OAAgC,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC,CAAC;IAErC,IAAID,OAAO,CAACtD,SAAS,CAAC0D,QAAQ,CAAC,EAAE;MAC/B,OAAO,IAAIlE,KAAK,CAAC,CAAC,CAACmE,MAAM,CAACN,IAAI,IAAI,EAAE,EAAE;QACpC,CAACrD,SAAS,CAAC0D,QAAQ,GAAGJ,OAAO,CAACtD,SAAS,CAAC0D,QAAQ;MAClD,CAAC,CAAC;IACJ;IACA,IAAI,CAACN,IAAI,EAAE;MACT,OAAO,IAAI5D,KAAK,CAAC,CAAC,CAACmE,MAAM,CAACN,IAAI,IAAI,EAAE,EAAEC,OAAO,CAAC;IAChD;IACA,MAAMM,KAAK,GAAG,IAAI,CAACC,WAAW,CAACT,IAAI,CAAC;IACpC;IACA,IACEU,aAAa,CAACF,KAAK,EAAE,IAAI,CAAC,KACzBA,KAAK,CAACG,GAAG,CAACH,KAAK,CAACG,GAAG,CAACP,MAAM,GAAG,CAAC,CAAC,CAACQ,UAAU,IAAI,IAAI,IAAIV,OAAO,CAACW,KAAK,CAAC,EACrE;MACA,OAAOL,KAAK,CAACM,OAAO,CAAC,IAAI1E,KAAK,CAAC,CAAC,CAAC2E,MAAM,CAACP,KAAK,CAACJ,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,CAACY,MAAM,CAAC,CAAC,CAAC,CAAC;IACxE;IACA,OAAOR,KAAK;EACd;EAEUS,aAAaA,CAACC,GAAa,EAAE;IACrC/D,qBAAqB,CAAC+D,GAAG,CAAC;EAC5B;EAEUT,WAAWA,CAACT,IAAY,EAAE;IAClC,MAAMkB,GAAG,GAAG,IAAIC,SAAS,CAAC,CAAC,CAACC,eAAe,CAACpB,IAAI,EAAE,WAAW,CAAC;IAC9D,IAAI,CAACiB,aAAa,CAACC,GAAG,CAAC;IACvB,MAAMG,SAAS,GAAGH,GAAG,CAACI,IAAI;IAC1B,MAAMC,WAAW,GAAG,IAAIC,OAAO,CAAC,CAAC;IACjC,MAAM,CAACC,eAAe,EAAEC,YAAY,CAAC,GAAG,IAAI,CAACC,eAAe,CAC1DN,SAAS,EACTE,WACF,CAAC;IACD,OAAOK,QAAQ,CACb,IAAI,CAAC/C,KAAK,CAACgD,MAAM,EACjBR,SAAS,EACTI,eAAe,EACfC,YAAY,EACZH,WACF,CAAC;EACH;EAQAO,oBAAoBA,CAClBC,KAAsB,EACtB/B,IAAa,EAEb;IAAA,IADAgC,MAAqB,GAAA7B,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG3D,KAAK,CAACyF,OAAO,CAACC,GAAG;IAEzC,IAAI,OAAOH,KAAK,KAAK,QAAQ,EAAE;MAC7B,MAAMvB,KAAK,GAAG,IAAI,CAACV,OAAO,CAAC;QAAEE,IAAI,EAAE+B,KAAK;QAAE9B,IAAI,EAAE;MAAG,CAAC,CAAC;MACrD;MACA,IAAI,CAACpB,KAAK,CAACsD,WAAW,CAAC3B,KAAK,EAAER,IAAI,CAAC;MACnC,IAAI,CAACnB,KAAK,CAACuD,YAAY,CAAC,CAAC,EAAE5F,KAAK,CAACyF,OAAO,CAACI,MAAM,CAAC;IAClD,CAAC,MAAM;MACL,MAAMC,KAAK,GAAG,IAAI,CAACxC,OAAO,CAAC;QAAEE,IAAI;QAAEC,IAAI,EAAE;MAAG,CAAC,CAAC;MAC9C,IAAI,CAACpB,KAAK,CAAC0D,cAAc,CACvB,IAAInG,KAAK,CAAC,CAAC,CAAC2E,MAAM,CAACgB,KAAK,CAAC,CAACxC,MAAM,CAAC+C,KAAK,CAAC,EACvCN,MACF,CAAC;MACD,IAAI,CAACnD,KAAK,CAACuD,YAAY,CAACL,KAAK,GAAGO,KAAK,CAAClC,MAAM,CAAC,CAAC,EAAE5D,KAAK,CAACyF,OAAO,CAACI,MAAM,CAAC;IACvE;EACF;EAEAlD,aAAaA,CAACD,CAAiB,EAAiB;IAAA,IAAAsD,gBAAA,EAAAC,iBAAA;IAAA,IAAfC,KAAK,GAAAvC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,KAAK;IAC5C,IAAIjB,CAAC,CAACyD,gBAAgB,EAAE;IACxBzD,CAAC,CAAC0D,cAAc,CAAC,CAAC;IAClB,MAAM,CAACC,KAAK,CAAC,GAAG,IAAI,CAAChE,KAAK,CAACiE,SAAS,CAACC,QAAQ,CAAC,CAAC;IAC/C,IAAIF,KAAK,IAAI,IAAI,EAAE;IACnB,MAAM;MAAE7C,IAAI;MAAEC;IAAK,CAAC,GAAG,IAAI,CAAC+C,MAAM,CAACH,KAAK,EAAEH,KAAK,CAAC;IAChD,CAAAF,gBAAA,GAAAtD,CAAC,CAAC+D,aAAa,cAAAT,gBAAA,uBAAfA,gBAAA,CAAiBU,OAAO,CAAC,YAAY,EAAEjD,IAAI,CAAC;IAC5C,CAAAwC,iBAAA,GAAAvD,CAAC,CAAC+D,aAAa,cAAAR,iBAAA,uBAAfA,iBAAA,CAAiBS,OAAO,CAAC,WAAW,EAAElD,IAAI,CAAC;IAC3C,IAAI0C,KAAK,EAAE;MACTxF,WAAW,CAAC;QAAE2F,KAAK;QAAEhE,KAAK,EAAE,IAAI,CAACA;MAAM,CAAC,CAAC;IAC3C;EACF;;EAEA;AACF;AACA;EACUsE,gBAAgBA,CAACC,OAAe,EAAE;IACxC,OACEA,OAAO,CACJC,KAAK,CAAC,OAAO;IACd;IAAA,CACCC,MAAM,CAAEC,GAAG,IAAKA,GAAG,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAC/BC,IAAI,CAAC,IAAI,CAAC;EAEjB;EAEApE,cAAcA,CAACF,CAAiB,EAAE;IAAA,IAAAuE,iBAAA,EAAAC,iBAAA,EAAAC,iBAAA;IAChC,IAAIzE,CAAC,CAACyD,gBAAgB,IAAI,CAAC,IAAI,CAAC9D,KAAK,CAAC+E,SAAS,CAAC,CAAC,EAAE;IACnD1E,CAAC,CAAC0D,cAAc,CAAC,CAAC;IAClB,MAAMC,KAAK,GAAG,IAAI,CAAChE,KAAK,CAACgF,YAAY,CAAC,IAAI,CAAC;IAC3C,IAAIhB,KAAK,IAAI,IAAI,EAAE;IACnB,MAAM7C,IAAI,IAAAyD,iBAAA,GAAGvE,CAAC,CAAC+D,aAAa,cAAAQ,iBAAA,uBAAfA,iBAAA,CAAiBK,OAAO,CAAC,WAAW,CAAC;IAClD,IAAI7D,IAAI,IAAAyD,iBAAA,GAAGxE,CAAC,CAAC+D,aAAa,cAAAS,iBAAA,uBAAfA,iBAAA,CAAiBI,OAAO,CAAC,YAAY,CAAC;IACjD,IAAI,CAAC9D,IAAI,IAAI,CAACC,IAAI,EAAE;MAAA,IAAA8D,iBAAA;MAClB,MAAMX,OAAO,IAAAW,iBAAA,GAAG7E,CAAC,CAAC+D,aAAa,cAAAc,iBAAA,uBAAfA,iBAAA,CAAiBD,OAAO,CAAC,eAAe,CAAC;MACzD,IAAIV,OAAO,EAAE;QACXnD,IAAI,GAAG,IAAI,CAACkD,gBAAgB,CAACC,OAAO,CAAC;MACvC;IACF;IACA,MAAMY,KAAK,GAAGC,KAAK,CAACC,IAAI,CAAC,EAAAP,iBAAA,GAAAzE,CAAC,CAAC+D,aAAa,cAAAU,iBAAA,uBAAfA,iBAAA,CAAiBK,KAAK,KAAI,EAAE,CAAC;IACtD,IAAI,CAAChE,IAAI,IAAIgE,KAAK,CAAC5D,MAAM,GAAG,CAAC,EAAE;MAC7B,IAAI,CAACvB,KAAK,CAACsF,QAAQ,CAACC,MAAM,CAACvB,KAAK,EAAEmB,KAAK,CAAC;MACxC;IACF;IACA,IAAIhE,IAAI,IAAIgE,KAAK,CAAC5D,MAAM,GAAG,CAAC,EAAE;MAAA,IAAAiE,qBAAA;MAC5B,MAAMnD,GAAG,GAAG,IAAIC,SAAS,CAAC,CAAC,CAACC,eAAe,CAACpB,IAAI,EAAE,WAAW,CAAC;MAC9D,IACEkB,GAAG,CAACI,IAAI,CAACgD,iBAAiB,KAAK,CAAC,IAChC,EAAAD,qBAAA,GAAAnD,GAAG,CAACI,IAAI,CAACiD,iBAAiB,cAAAF,qBAAA,uBAA1BA,qBAAA,CAA4BG,OAAO,MAAK,KAAK,EAC7C;QACA,IAAI,CAAC3F,KAAK,CAACsF,QAAQ,CAACC,MAAM,CAACvB,KAAK,EAAEmB,KAAK,CAAC;QACxC;MACF;IACF;IACA,IAAI,CAACS,OAAO,CAAC5B,KAAK,EAAE;MAAE7C,IAAI;MAAEC;IAAK,CAAC,CAAC;EACrC;EAGA+C,MAAMA,CAACH,KAAY,EAAE;IACnB,MAAM5C,IAAI,GAAG,IAAI,CAACpB,KAAK,CAAC6F,OAAO,CAAC7B,KAAK,CAAC;IACtC,MAAM7C,IAAI,GAAG,IAAI,CAACnB,KAAK,CAAC8F,eAAe,CAAC9B,KAAK,CAAC;IAC9C,OAAO;MAAE7C,IAAI;MAAEC;IAAK,CAAC;EACvB;EAEAwE,OAAOA,CAAC5B,KAAY,EAAA+B,KAAA,EAAoD;IAAA,IAAlD;MAAE3E,IAAI;MAAED;IAAuC,CAAC,GAAA4E,KAAA;IACpE,MAAM1E,OAAO,GAAG,IAAI,CAACrB,KAAK,CAACgG,SAAS,CAAChC,KAAK,CAACd,KAAK,CAAC;IACjD,MAAM+C,WAAW,GAAG,IAAI,CAAChF,OAAO,CAAC;MAAEG,IAAI;MAAED;IAAK,CAAC,EAAEE,OAAO,CAAC;IACzD9C,KAAK,CAAC2H,GAAG,CAAC,SAAS,EAAED,WAAW,EAAE;MAAE7E,IAAI;MAAED;IAAK,CAAC,CAAC;IACjD,MAAMQ,KAAK,GAAG,IAAIpE,KAAK,CAAC,CAAC,CACtB2E,MAAM,CAAC8B,KAAK,CAACd,KAAK,CAAC,CACnBf,MAAM,CAAC6B,KAAK,CAACzC,MAAM,CAAC,CACpBb,MAAM,CAACuF,WAAW,CAAC;IACtB,IAAI,CAACjG,KAAK,CAAC0D,cAAc,CAAC/B,KAAK,EAAEhE,KAAK,CAACyF,OAAO,CAAC+C,IAAI,CAAC;IACpD;IACA,IAAI,CAACnG,KAAK,CAACuD,YAAY,CACrB5B,KAAK,CAACJ,MAAM,CAAC,CAAC,GAAGyC,KAAK,CAACzC,MAAM,EAC7B5D,KAAK,CAACyF,OAAO,CAACI,MAChB,CAAC;IACD,IAAI,CAACxD,KAAK,CAACoG,uBAAuB,CAAC,CAAC;EACtC;EAEAtD,eAAeA,CAACN,SAAkB,EAAEE,WAAqC,EAAE;IACzE,MAAME,eAA0B,GAAG,EAAE;IACrC,MAAMC,YAAuB,GAAG,EAAE;IAClC,IAAI,CAACpC,QAAQ,CAACE,OAAO,CAAE0F,IAAI,IAAK;MAC9B,MAAM,CAACxF,QAAQ,EAAEC,OAAO,CAAC,GAAGuF,IAAI;MAChC,QAAQxF,QAAQ;QACd,KAAKpC,IAAI,CAACC,SAAS;UACjBmE,YAAY,CAAC7B,IAAI,CAACF,OAAO,CAAC;UAC1B;QACF,KAAKrC,IAAI,CAACK,YAAY;UACpB8D,eAAe,CAAC5B,IAAI,CAACF,OAAO,CAAC;UAC7B;QACF;UACEsE,KAAK,CAACC,IAAI,CAAC7C,SAAS,CAAC8D,gBAAgB,CAACzF,QAAQ,CAAC,CAAC,CAACF,OAAO,CAAE4F,IAAI,IAAK;YACjE,IAAI7D,WAAW,CAAC8D,GAAG,CAACD,IAAI,CAAC,EAAE;cACzB,MAAME,OAAO,GAAG/D,WAAW,CAACgE,GAAG,CAACH,IAAI,CAAC;cACrCE,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEzF,IAAI,CAACF,OAAO,CAAC;YACxB,CAAC,MAAM;cACL4B,WAAW,CAACiE,GAAG,CAACJ,IAAI,EAAE,CAACzF,OAAO,CAAC,CAAC;YAClC;UACF,CAAC,CAAC;UACF;MACJ;IACF,CAAC,CAAC;IACF,OAAO,CAAC8B,eAAe,EAAEC,YAAY,CAAC;EACxC;AACF;AAAA+D,eAAA,CA5MM9G,SAAS,cACuB;EAClCW,QAAQ,EAAE;AACZ,CAAC;AA2MH,SAASoG,WAAWA,CAClBlF,KAAY,EACZmF,MAAc,EACdC,KAAc,EACd/D,MAAkB,EACX;EACP,IAAI,CAACA,MAAM,CAACgE,KAAK,CAACF,MAAM,CAAC,EAAE;IACzB,OAAOnF,KAAK;EACd;EAEA,OAAOA,KAAK,CAAClC,MAAM,CAAC,CAACwH,QAAQ,EAAEC,EAAE,KAAK;IACpC,IAAI,CAACA,EAAE,CAACxF,MAAM,EAAE,OAAOuF,QAAQ;IAC/B,IAAIC,EAAE,CAACnF,UAAU,IAAImF,EAAE,CAACnF,UAAU,CAAC+E,MAAM,CAAC,EAAE;MAC1C,OAAOG,QAAQ,CAACjG,IAAI,CAACkG,EAAE,CAAC;IAC1B;IACA,MAAM7F,OAAO,GAAG0F,KAAK,GAAG;MAAE,CAACD,MAAM,GAAGC;IAAM,CAAC,GAAG,CAAC,CAAC;IAChD,OAAOE,QAAQ,CAACvF,MAAM,CAACwF,EAAE,CAACxF,MAAM,EAAE;MAAE,GAAGL,OAAO;MAAE,GAAG6F,EAAE,CAACnF;IAAW,CAAC,CAAC;EACrE,CAAC,EAAE,IAAIxE,KAAK,CAAC,CAAC,CAAC;AACjB;AAEA,SAASsE,aAAaA,CAACF,KAAY,EAAEP,IAAY,EAAE;EACjD,IAAI+F,OAAO,GAAG,EAAE;EAChB,KACE,IAAIC,CAAC,GAAGzF,KAAK,CAACG,GAAG,CAACP,MAAM,GAAG,CAAC,EAC5B6F,CAAC,IAAI,CAAC,IAAID,OAAO,CAAC5F,MAAM,GAAGH,IAAI,CAACG,MAAM,EACtC,EAAE6F,CAAC,CAAC;EAAA,EACJ;IACA,MAAMF,EAAE,GAAGvF,KAAK,CAACG,GAAG,CAACsF,CAAC,CAAC;IACvB,IAAI,OAAOF,EAAE,CAACxF,MAAM,KAAK,QAAQ,EAAE;IACnCyF,OAAO,GAAGD,EAAE,CAACxF,MAAM,GAAGyF,OAAO;EAC/B;EACA,OAAOA,OAAO,CAACE,KAAK,CAAC,CAAC,CAAC,GAAGjG,IAAI,CAACG,MAAM,CAAC,KAAKH,IAAI;AACjD;AAEA,SAASkG,MAAMA,CAACf,IAAU,EAAEvD,MAAkB,EAAE;EAC9C,IAAI,EAAEuD,IAAI,YAAYgB,OAAO,CAAC,EAAE,OAAO,KAAK;EAC5C,MAAMC,KAAK,GAAGxE,MAAM,CAACgE,KAAK,CAACT,IAAI,CAAC;EAChC;EACA,IAAIiB,KAAK,IAAIA,KAAK,CAACC,SAAS,YAAYrK,SAAS,EAAE,OAAO,KAAK;EAE/D,OAAO,CACL,SAAS,EACT,SAAS,EACT,YAAY,EACZ,QAAQ,EACR,IAAI,EACJ,KAAK,EACL,IAAI,EACJ,IAAI,EACJ,UAAU,EACV,YAAY,EACZ,QAAQ,EACR,QAAQ,EACR,MAAM,EACN,IAAI,EACJ,IAAI,EACJ,IAAI,EACJ,IAAI,EACJ,IAAI,EACJ,IAAI,EACJ,QAAQ,EACR,QAAQ,EACR,IAAI,EACJ,MAAM,EACN,KAAK,EACL,IAAI,EACJ,QAAQ,EACR,GAAG,EACH,KAAK,EACL,SAAS,EACT,OAAO,EACP,IAAI,EACJ,IAAI,EACJ,IAAI,EACJ,OAAO,CACR,CAACsK,QAAQ,CAACnB,IAAI,CAACZ,OAAO,CAACgC,WAAW,CAAC,CAAC,CAAC;AACxC;AAEA,SAASC,uBAAuBA,CAACrB,IAAiB,EAAEvD,MAAkB,EAAE;EACtE,OACEuD,IAAI,CAACsB,sBAAsB,IAC3BtB,IAAI,CAACuB,kBAAkB,IACvB,CAACR,MAAM,CAACf,IAAI,CAACsB,sBAAsB,EAAE7E,MAAM,CAAC,IAC5C,CAACsE,MAAM,CAACf,IAAI,CAACuB,kBAAkB,EAAE9E,MAAM,CAAC;AAE5C;AAEA,MAAM+E,QAAQ,GAAG,IAAIpF,OAAO,CAAC,CAAC;AAC9B,SAASqF,KAAKA,CAACzB,IAAiB,EAAE;EAChC,IAAIA,IAAI,IAAI,IAAI,EAAE,OAAO,KAAK;EAC9B,IAAI,CAACwB,QAAQ,CAACvB,GAAG,CAACD,IAAI,CAAC,EAAE;IACvB;IACA,IAAIA,IAAI,CAACZ,OAAO,KAAK,KAAK,EAAE;MAC1BoC,QAAQ,CAACpB,GAAG,CAACJ,IAAI,EAAE,IAAI,CAAC;IAC1B,CAAC,MAAM;MACLwB,QAAQ,CAACpB,GAAG,CAACJ,IAAI,EAAEyB,KAAK,CAACzB,IAAI,CAAC0B,UAAU,CAAC,CAAC;IAC5C;EACF;EACA,OAAOF,QAAQ,CAACrB,GAAG,CAACH,IAAI,CAAC;AAC3B;AAEA,SAASxD,QAAQA,CACfC,MAAkB,EAClBuD,IAAe,EACf3D,eAA0B,EAC1BC,YAAuB,EACvBH,WAAqC,EAC9B;EACP;EACA,IAAI6D,IAAI,CAAC2B,QAAQ,KAAK3B,IAAI,CAAC7H,SAAS,EAAE;IACpC,OAAOmE,YAAY,CAACpD,MAAM,CAAC,CAACkC,KAAY,EAAEb,OAAO,KAAK;MACpD,OAAOA,OAAO,CAACyF,IAAI,EAAE5E,KAAK,EAAEqB,MAAM,CAAC;IACrC,CAAC,EAAE,IAAIzF,KAAK,CAAC,CAAC,CAAC;EACjB;EACA,IAAIgJ,IAAI,CAAC2B,QAAQ,KAAK3B,IAAI,CAACzH,YAAY,EAAE;IACvC,OAAOsG,KAAK,CAACC,IAAI,CAACkB,IAAI,CAAC4B,UAAU,IAAI,EAAE,CAAC,CAAC1I,MAAM,CAAC,CAACkC,KAAK,EAAEyG,SAAS,KAAK;MACpE,IAAIC,aAAa,GAAGtF,QAAQ,CAC1BC,MAAM,EACNoF,SAAS,EACTxF,eAAe,EACfC,YAAY,EACZH,WACF,CAAC;MACD,IAAI0F,SAAS,CAACF,QAAQ,KAAK3B,IAAI,CAACzH,YAAY,EAAE;QAC5CuJ,aAAa,GAAGzF,eAAe,CAACnD,MAAM,CAAC,CAAC6I,YAAY,EAAExH,OAAO,KAAK;UAChE,OAAOA,OAAO,CAACsH,SAAS,EAAiBE,YAAY,EAAEtF,MAAM,CAAC;QAChE,CAAC,EAAEqF,aAAa,CAAC;QACjBA,aAAa,GAAG,CAAC3F,WAAW,CAACgE,GAAG,CAAC0B,SAAS,CAAC,IAAI,EAAE,EAAE3I,MAAM,CACvD,CAAC6I,YAAY,EAAExH,OAAO,KAAK;UACzB,OAAOA,OAAO,CAACsH,SAAS,EAAEE,YAAY,EAAEtF,MAAM,CAAC;QACjD,CAAC,EACDqF,aACF,CAAC;MACH;MACA,OAAO1G,KAAK,CAACjB,MAAM,CAAC2H,aAAa,CAAC;IACpC,CAAC,EAAE,IAAI9K,KAAK,CAAC,CAAC,CAAC;EACjB;EACA,OAAO,IAAIA,KAAK,CAAC,CAAC;AACpB;AAEA,SAAS+B,gBAAgBA,CAACwH,MAAc,EAAE;EACxC,OAAO,CAACyB,KAAc,EAAE5G,KAAY,EAAEqB,MAAkB,KAAK;IAC3D,OAAO6D,WAAW,CAAClF,KAAK,EAAEmF,MAAM,EAAE,IAAI,EAAE9D,MAAM,CAAC;EACjD,CAAC;AACH;AAEA,SAAShE,eAAeA,CAACuH,IAAiB,EAAE5E,KAAY,EAAEqB,MAAkB,EAAE;EAC5E,MAAMjB,UAAU,GAAG9E,UAAU,CAACuL,IAAI,CAACjC,IAAI,CAAC;EACxC,MAAMkC,OAAO,GAAGtL,eAAe,CAACqL,IAAI,CAACjC,IAAI,CAAC;EAC1C,MAAMmC,MAAM,GAAGpL,eAAe,CAACkL,IAAI,CAACjC,IAAI,CAAC;EACzC,MAAMlF,OAA2C,GAAG,CAAC,CAAC;EACtDU,UAAU,CACPrB,MAAM,CAAC+H,OAAO,CAAC,CACf/H,MAAM,CAACgI,MAAM,CAAC,CACd/H,OAAO,CAAEgI,IAAI,IAAK;IACjB,IAAIhJ,IAAI,GAAGqD,MAAM,CAACgE,KAAK,CAAC2B,IAAI,EAAEtL,KAAK,CAACuL,SAAS,CAAe;IAC5D,IAAIjJ,IAAI,IAAI,IAAI,EAAE;MAChB0B,OAAO,CAAC1B,IAAI,CAACkJ,QAAQ,CAAC,GAAGlJ,IAAI,CAACoH,KAAK,CAACR,IAAI,CAAC;MACzC,IAAIlF,OAAO,CAAC1B,IAAI,CAACkJ,QAAQ,CAAC,EAAE;IAC9B;IACAlJ,IAAI,GAAGH,qBAAqB,CAACmJ,IAAI,CAAC;IAClC,IAAIhJ,IAAI,IAAI,IAAI,KAAKA,IAAI,CAACkJ,QAAQ,KAAKF,IAAI,IAAIhJ,IAAI,CAACC,OAAO,KAAK+I,IAAI,CAAC,EAAE;MACrEtH,OAAO,CAAC1B,IAAI,CAACkJ,QAAQ,CAAC,GAAGlJ,IAAI,CAACoH,KAAK,CAACR,IAAI,CAAC,IAAI/E,SAAS;IACxD;IACA7B,IAAI,GAAGE,iBAAiB,CAAC8I,IAAI,CAAC;IAC9B,IAAIhJ,IAAI,IAAI,IAAI,KAAKA,IAAI,CAACkJ,QAAQ,KAAKF,IAAI,IAAIhJ,IAAI,CAACC,OAAO,KAAK+I,IAAI,CAAC,EAAE;MACrEhJ,IAAI,GAAGE,iBAAiB,CAAC8I,IAAI,CAAC;MAC9BtH,OAAO,CAAC1B,IAAI,CAACkJ,QAAQ,CAAC,GAAGlJ,IAAI,CAACoH,KAAK,CAACR,IAAI,CAAC,IAAI/E,SAAS;IACxD;EACF,CAAC,CAAC;EAEJ,OAAOsH,MAAM,CAACC,OAAO,CAAC1H,OAAO,CAAC,CAAC5B,MAAM,CACnC,CAACwH,QAAQ,EAAA+B,KAAA;IAAA,IAAE,CAACL,IAAI,EAAE5B,KAAK,CAAC,GAAAiC,KAAA;IAAA,OAAKnC,WAAW,CAACI,QAAQ,EAAE0B,IAAI,EAAE5B,KAAK,EAAE/D,MAAM,CAAC;EAAA,GACvErB,KACF,CAAC;AACH;AAEA,SAAS5C,SAASA,CAACwH,IAAU,EAAE5E,KAAY,EAAEqB,MAAkB,EAAE;EAC/D,MAAMwE,KAAK,GAAGxE,MAAM,CAACgE,KAAK,CAACT,IAAI,CAAC;EAChC,IAAIiB,KAAK,IAAI,IAAI,EAAE,OAAO7F,KAAK;EAC/B;EACA,IAAI6F,KAAK,CAACC,SAAS,YAAYrK,SAAS,EAAE;IACxC,MAAM6L,KAAK,GAAG,CAAC,CAAC;IAChB;IACA,MAAMlC,KAAK,GAAGS,KAAK,CAACT,KAAK,CAACR,IAAI,CAAC;IAC/B,IAAIQ,KAAK,IAAI,IAAI,EAAE;MACjB;MACAkC,KAAK,CAACzB,KAAK,CAAC/F,QAAQ,CAAC,GAAGsF,KAAK;MAC7B;MACA,OAAO,IAAIxJ,KAAK,CAAC,CAAC,CAACmE,MAAM,CAACuH,KAAK,EAAEzB,KAAK,CAACnG,OAAO,CAACkF,IAAI,EAAEvD,MAAM,CAAC,CAAC;IAC/D;EACF,CAAC,MAAM;IACL;IACA,IAAIwE,KAAK,CAACC,SAAS,YAAYvK,SAAS,IAAI,CAAC2E,aAAa,CAACF,KAAK,EAAE,IAAI,CAAC,EAAE;MACvEA,KAAK,CAACD,MAAM,CAAC,IAAI,CAAC;IACpB;IACA,IACE,UAAU,IAAI8F,KAAK,IACnB,SAAS,IAAIA,KAAK,IAClB,OAAOA,KAAK,CAACnG,OAAO,KAAK,UAAU,EACnC;MACA,OAAOwF,WAAW,CAChBlF,KAAK,EACL6F,KAAK,CAAC/F,QAAQ,EACd+F,KAAK,CAACnG,OAAO,CAACkF,IAAI,EAAEvD,MAAM,CAAC,EAC3BA,MACF,CAAC;IACH;EACF;EACA,OAAOrB,KAAK;AACd;AAEA,SAAS9C,UAAUA,CAAC0H,IAAU,EAAE5E,KAAY,EAAE;EAC5C,IAAI,CAACE,aAAa,CAACF,KAAK,EAAE,IAAI,CAAC,EAAE;IAC/BA,KAAK,CAACD,MAAM,CAAC,IAAI,CAAC;EACpB;EACA,OAAOC,KAAK;AACd;AAEA,SAASvC,cAAcA,CAACmH,IAAU,EAAE5E,KAAY,EAAEqB,MAAkB,EAAE;EACpE,MAAMwE,KAAK,GAAGxE,MAAM,CAACgE,KAAK,CAAC,YAAY,CAAC;EACxC,MAAMkC,QAAQ,GACZ1B,KAAK,IAAI,SAAS,IAAIA,KAAK,IAAI,OAAOA,KAAK,CAACnG,OAAO,KAAK,UAAU,GAC9DmG,KAAK,CAACnG,OAAO,CAACkF,IAAI,EAAEvD,MAAM,CAAC,GAC3B,IAAI;EACV,OAAO6D,WAAW,CAAClF,KAAK,EAAE,YAAY,EAAEuH,QAAQ,EAAElG,MAAM,CAAC;AAC3D;AAEA,SAASzD,WAAWA,CAAA,EAAG;EACrB,OAAO,IAAIhC,KAAK,CAAC,CAAC;AACpB;AAEA,SAAS2B,WAAWA,CAACqH,IAAU,EAAE5E,KAAY,EAAEqB,MAAkB,EAAE;EACjE,MAAMwE,KAAK,GAAGxE,MAAM,CAACgE,KAAK,CAACT,IAAI,CAAC;EAChC,IACEiB,KAAK,IAAI,IAAI;EACb;EACAA,KAAK,CAAC/F,QAAQ,KAAK,MAAM,IACzB,CAACI,aAAa,CAACF,KAAK,EAAE,IAAI,CAAC,EAC3B;IACA,OAAOA,KAAK;EACd;EACA,IAAIwH,MAAM,GAAG,CAAC,CAAC;EACf,IAAIC,MAAM,GAAG7C,IAAI,CAAC0B,UAAU;EAC5B,OAAOmB,MAAM,IAAI,IAAI,EAAE;IACrB;IACA,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC1B,QAAQ,CAAC0B,MAAM,CAACzD,OAAO,CAAC,EAAE;MACzCwD,MAAM,IAAI,CAAC;IACb;IACAC,MAAM,GAAGA,MAAM,CAACnB,UAAU;EAC5B;EACA,IAAIkB,MAAM,IAAI,CAAC,EAAE,OAAOxH,KAAK;EAC7B,OAAOA,KAAK,CAAClC,MAAM,CAAC,CAAC4J,QAAQ,EAAEnC,EAAE,KAAK;IACpC,IAAI,CAACA,EAAE,CAACxF,MAAM,EAAE,OAAO2H,QAAQ;IAC/B,IAAInC,EAAE,CAACnF,UAAU,IAAI,OAAOmF,EAAE,CAACnF,UAAU,CAACoH,MAAM,KAAK,QAAQ,EAAE;MAC7D,OAAOE,QAAQ,CAACrI,IAAI,CAACkG,EAAE,CAAC;IAC1B;IACA,OAAOmC,QAAQ,CAAC3H,MAAM,CAACwF,EAAE,CAACxF,MAAM,EAAE;MAAEyH,MAAM;MAAE,IAAIjC,EAAE,CAACnF,UAAU,IAAI,CAAC,CAAC;IAAE,CAAC,CAAC;EACzE,CAAC,EAAE,IAAIxE,KAAK,CAAC,CAAC,CAAC;AACjB;AAEA,SAAS4B,SAASA,CAACoH,IAAU,EAAE5E,KAAY,EAAEqB,MAAkB,EAAE;EAC/D,MAAMsG,OAAO,GAAG/C,IAAe;EAC/B,IAAIgD,IAAI,GAAGD,OAAO,CAAC3D,OAAO,KAAK,IAAI,GAAG,SAAS,GAAG,QAAQ;EAE1D,MAAM6D,WAAW,GAAGF,OAAO,CAACG,YAAY,CAAC,cAAc,CAAC;EACxD,IAAID,WAAW,EAAE;IACfD,IAAI,GAAGC,WAAW,KAAK,MAAM,GAAG,SAAS,GAAG,WAAW;EACzD;EAEA,OAAO3C,WAAW,CAAClF,KAAK,EAAE,MAAM,EAAE4H,IAAI,EAAEvG,MAAM,CAAC;AACjD;AAEA,SAASpE,YAAYA,CAAC2H,IAAU,EAAE5E,KAAY,EAAEqB,MAAkB,EAAE;EAClE,IAAI,CAACnB,aAAa,CAACF,KAAK,EAAE,IAAI,CAAC,EAAE;IAC/B,IACE2F,MAAM,CAACf,IAAI,EAAEvD,MAAM,CAAC,KACnBuD,IAAI,CAAC4B,UAAU,CAAC5G,MAAM,GAAG,CAAC,IAAIgF,IAAI,YAAYmD,oBAAoB,CAAC,EACpE;MACA,OAAO/H,KAAK,CAACD,MAAM,CAAC,IAAI,CAAC;IAC3B;IACA,IAAIC,KAAK,CAACJ,MAAM,CAAC,CAAC,GAAG,CAAC,IAAIgF,IAAI,CAACoD,WAAW,EAAE;MAC1C,IAAIA,WAAwB,GAAGpD,IAAI,CAACoD,WAAW;MAC/C,OAAOA,WAAW,IAAI,IAAI,EAAE;QAC1B,IAAIrC,MAAM,CAACqC,WAAW,EAAE3G,MAAM,CAAC,EAAE;UAC/B,OAAOrB,KAAK,CAACD,MAAM,CAAC,IAAI,CAAC;QAC3B;QACA,MAAM8F,KAAK,GAAGxE,MAAM,CAACgE,KAAK,CAAC2C,WAAW,CAAC;QACvC;QACA,IAAInC,KAAK,IAAIA,KAAK,CAACC,SAAS,YAAYjK,UAAU,EAAE;UAClD,OAAOmE,KAAK,CAACD,MAAM,CAAC,IAAI,CAAC;QAC3B;QACAiI,WAAW,GAAGA,WAAW,CAACC,UAAU;MACtC;IACF;EACF;EACA,OAAOjI,KAAK;AACd;AAEA,SAAS1C,WAAWA,CAACsH,IAAiB,EAAE5E,KAAY,EAAEqB,MAAkB,EAAE;EAAA,IAAA6G,iBAAA;EACxE,MAAMxI,OAAgC,GAAG,CAAC,CAAC;EAC3C,MAAMyI,KAAmC,GAAGvD,IAAI,CAACuD,KAAK,IAAI,CAAC,CAAC;EAC5D,IAAIA,KAAK,CAACC,SAAS,KAAK,QAAQ,EAAE;IAChC1I,OAAO,CAAC2I,MAAM,GAAG,IAAI;EACvB;EACA,IAAIF,KAAK,CAACG,cAAc,KAAK,WAAW,EAAE;IACxC5I,OAAO,CAAC6I,SAAS,GAAG,IAAI;EAC1B;EACA,IAAIJ,KAAK,CAACG,cAAc,KAAK,cAAc,EAAE;IAC3C5I,OAAO,CAAC8I,MAAM,GAAG,IAAI;EACvB;EACA,IACE,CAAAN,iBAAA,GAAAC,KAAK,CAACM,UAAU,cAAAP,iBAAA,eAAhBA,iBAAA,CAAkBQ,UAAU,CAAC,MAAM,CAAC;EACpC;EACAC,QAAQ,CAACR,KAAK,CAACM,UAAU,EAAE,EAAE,CAAC,IAAI,GAAG,EACrC;IACA/I,OAAO,CAACkJ,IAAI,GAAG,IAAI;EACrB;EACA5I,KAAK,GAAGmH,MAAM,CAACC,OAAO,CAAC1H,OAAO,CAAC,CAAC5B,MAAM,CACpC,CAACwH,QAAQ,EAAAuD,KAAA;IAAA,IAAE,CAAC7B,IAAI,EAAE5B,KAAK,CAAC,GAAAyD,KAAA;IAAA,OAAK3D,WAAW,CAACI,QAAQ,EAAE0B,IAAI,EAAE5B,KAAK,EAAE/D,MAAM,CAAC;EAAA,GACvErB,KACF,CAAC;EACD;EACA,IAAI8I,UAAU,CAACX,KAAK,CAACY,UAAU,IAAI,CAAC,CAAC,GAAG,CAAC,EAAE;IACzC;IACA,OAAO,IAAInN,KAAK,CAAC,CAAC,CAACmE,MAAM,CAAC,IAAI,CAAC,CAAChB,MAAM,CAACiB,KAAK,CAAC;EAC/C;EACA,OAAOA,KAAK;AACd;AAEA,SAAStC,UAAUA,CACjBkH,IAAyB,EACzB5E,KAAY,EACZqB,MAAkB,EAClB;EAAA,IAAA2H,mBAAA,EAAAC,oBAAA;EACA,MAAM5I,KAAK,GACT,EAAA2I,mBAAA,GAAApE,IAAI,CAACsE,aAAa,cAAAF,mBAAA,uBAAlBA,mBAAA,CAAoBhF,OAAO,MAAK,OAAO,GACnCY,IAAI,CAACsE,aAAa,IAAAD,oBAAA,GAClBrE,IAAI,CAACsE,aAAa,cAAAD,oBAAA,uBAAlBA,oBAAA,CAAoBC,aAAa;EACvC,IAAI7I,KAAK,IAAI,IAAI,EAAE;IACjB,MAAM8I,IAAI,GAAG1F,KAAK,CAACC,IAAI,CAACrD,KAAK,CAACsE,gBAAgB,CAAC,IAAI,CAAC,CAAC;IACrD,MAAMyE,GAAG,GAAGD,IAAI,CAACE,OAAO,CAACzE,IAAI,CAAC,GAAG,CAAC;IAClC,OAAOM,WAAW,CAAClF,KAAK,EAAE,OAAO,EAAEoJ,GAAG,EAAE/H,MAAM,CAAC;EACjD;EACA,OAAOrB,KAAK;AACd;AAEA,SAAShD,SAASA,CAAC4H,IAAiB,EAAE5E,KAAY,EAAEqB,MAAkB,EAAE;EAAA,IAAAiI,oBAAA;EACtE;EACA,IAAI7J,IAAI,GAAGmF,IAAI,CAAC2E,IAAc;EAC9B;EACA,IAAI,EAAAD,oBAAA,GAAA1E,IAAI,CAACsE,aAAa,cAAAI,oBAAA,uBAAlBA,oBAAA,CAAoBtF,OAAO,MAAK,KAAK,EAAE;IACzC,OAAOhE,KAAK,CAACD,MAAM,CAACN,IAAI,CAAC+J,IAAI,CAAC,CAAC,CAAC;EAClC;EACA,IAAI,CAACnD,KAAK,CAACzB,IAAI,CAAC,EAAE;IAChB,IACEnF,IAAI,CAAC+J,IAAI,CAAC,CAAC,CAAC5J,MAAM,KAAK,CAAC,IACxBH,IAAI,CAACsG,QAAQ,CAAC,IAAI,CAAC,IACnB,CAACE,uBAAuB,CAACrB,IAAI,EAAEvD,MAAM,CAAC,EACtC;MACA,OAAOrB,KAAK;IACd;IACA;IACAP,IAAI,GAAGA,IAAI,CAACgK,OAAO,CAAC,cAAc,EAAE,GAAG,CAAC;IACxC;IACAhK,IAAI,GAAGA,IAAI,CAACgK,OAAO,CAAC,QAAQ,EAAE,GAAG,CAAC;IAClC,IACG7E,IAAI,CAAC8E,eAAe,IAAI,IAAI,IAC3B9E,IAAI,CAACsE,aAAa,IAAI,IAAI,IAC1BvD,MAAM,CAACf,IAAI,CAACsE,aAAa,EAAE7H,MAAM,CAAC,IACnCuD,IAAI,CAAC8E,eAAe,YAAY9D,OAAO,IACtCD,MAAM,CAACf,IAAI,CAAC8E,eAAe,EAAErI,MAAM,CAAE,EACvC;MACA;MACA5B,IAAI,GAAGA,IAAI,CAACgK,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC;IAC/B;IACA,IACG7E,IAAI,CAACoD,WAAW,IAAI,IAAI,IACvBpD,IAAI,CAACsE,aAAa,IAAI,IAAI,IAC1BvD,MAAM,CAACf,IAAI,CAACsE,aAAa,EAAE7H,MAAM,CAAC,IACnCuD,IAAI,CAACoD,WAAW,YAAYpC,OAAO,IAAID,MAAM,CAACf,IAAI,CAACoD,WAAW,EAAE3G,MAAM,CAAE,EACzE;MACA;MACA5B,IAAI,GAAGA,IAAI,CAACgK,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC;IAC/B;IACA;IACAhK,IAAI,GAAGA,IAAI,CAACkK,UAAU,CAAC,QAAQ,EAAE,GAAG,CAAC;EACvC;EACA,OAAO3J,KAAK,CAACD,MAAM,CAACN,IAAI,CAAC;AAC3B;AAEA,SACEtB,SAAS,IAAIyL,OAAO,EACpBvM,eAAe,EACfD,SAAS,EACTH,YAAY,EACZD,SAAS,EACToE,QAAQ","ignoreList":[]}]}