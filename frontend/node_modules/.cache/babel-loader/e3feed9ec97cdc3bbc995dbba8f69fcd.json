{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\smartdoc\\Index.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\smartdoc\\Index.vue","mtime":1751962445525},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1746431219000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746431218000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZmluZC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3Iuc29tZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC5kaWZmZXJlbmNlLnYyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LmludGVyc2VjdGlvbi52Mi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC5pcy1kaXNqb2ludC1mcm9tLnYyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LmlzLXN1YnNldC1vZi52Mi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC5pcy1zdXBlcnNldC1vZi52Mi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC5zeW1tZXRyaWMtZGlmZmVyZW5jZS52Mi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldC51bmlvbi52Mi5qcyI7CmltcG9ydCB7IHJlZiwgY29tcHV0ZWQsIG9uTW91bnRlZCwgbmV4dFRpY2ssIGdldEN1cnJlbnRJbnN0YW5jZSwgcHJvdmlkZSwgb25BY3RpdmF0ZWQsIHdhdGNoIH0gZnJvbSAndnVlJzsKaW1wb3J0IHsgdXNlUm91dGVyLCB1c2VSb3V0ZSB9IGZyb20gJ3Z1ZS1yb3V0ZXInOwppbXBvcnQgeyBFbE1lc3NhZ2UsIEVsTWVzc2FnZUJveCwgRWxMb2FkaW5nIH0gZnJvbSAnZWxlbWVudC1wbHVzJzsKaW1wb3J0IHsgU2VhcmNoLCBQbHVzLCBFZGl0UGVuLCBTaGFyZSwgRm9sZGVyLCBDbG9zZSwgTW9yZSwgRG9jdW1lbnQsIENsb2NrLCBVcGxvYWQsIFVzZXIgfSBmcm9tICdAZWxlbWVudC1wbHVzL2ljb25zLXZ1ZSc7CmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7CmltcG9ydCB7IGdldERvY3VtZW50cywgZ2V0UmVjZW50RG9jdW1lbnRzLCBnZXRTaGFyZWREb2N1bWVudHMsIGdldERvY3VtZW50Q2F0ZWdvcmllcywgY3JlYXRlRG9jdW1lbnQsIGRlbGV0ZURvY3VtZW50IGFzIGFwaURlbGV0ZURvY3VtZW50LCBzaGFyZURvY3VtZW50IGFzIGFwaVNoYXJlRG9jdW1lbnQsIGNyZWF0ZURvY3VtZW50Q2F0ZWdvcnksIHVwZGF0ZURvY3VtZW50Q2F0ZWdvcnksIGRlbGV0ZURvY3VtZW50Q2F0ZWdvcnksIGFpR2VuZXJhdGVEb2N1bWVudCwgZ2V0RG9jdW1lbnREZXRhaWwsIHVwZGF0ZURvY3VtZW50LCBpbXBvcnRXb3JkRG9jdW1lbnQgfSBmcm9tICdAL2FwaS9zbWFydGRvYyc7CmltcG9ydCB1c2VyQXBpIGZyb20gJ0AvYXBpL3VzZXInOwppbXBvcnQgeyBjcmVhdGVDaGF0U2Vzc2lvbiwgZ2V0Q2hhdFNlc3Npb25zIH0gZnJvbSAnQC9hcGkvY2hhdCc7CmltcG9ydCByZXF1ZXN0IGZyb20gJ0AvdXRpbHMvcmVxdWVzdCc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnU21hcnREb2NIb21lJywKICBjb21wb25lbnRzOiB7CiAgICBTZWFyY2gsCiAgICBQbHVzLAogICAgRWRpdFBlbiwKICAgIFNoYXJlLAogICAgRm9sZGVyLAogICAgQ2xvc2UsCiAgICBNb3JlLAogICAgRG9jdW1lbnQsCiAgICBDbG9jaywKICAgIFVwbG9hZCwKICAgIFVzZXIKICB9LAogIHNldHVwKCkgewogICAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKCk7CiAgICBjb25zdCByb3V0ZSA9IHVzZVJvdXRlKCk7CiAgICBjb25zdCB7CiAgICAgIHByb3h5CiAgICB9ID0gZ2V0Q3VycmVudEluc3RhbmNlKCk7IC8vIOiOt+WPlue7hOS7tuWunuS+iwoKICAgIC8vIOWIpOaWreaYr+WQpuS4uuW8gOWPkeeOr+WigwogICAgY29uc3QgJF9pc0RldiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnOwoKICAgIC8vIOWIt+aWsOinpuWPkeWZqO+8jOeUqOS6juW8uuWItue7hOS7tuWIt+aWsAogICAgY29uc3QgcmVmcmVzaFRyaWdnZXIgPSByZWYoRGF0ZS5ub3coKSk7CgogICAgLy8g54q25oCB5pWw5o2uCiAgICBjb25zdCBkb2N1bWVudHMgPSByZWYoW10pOwogICAgY29uc3QgcmVjZW50RG9jdW1lbnRzID0gcmVmKFtdKTsKICAgIGNvbnN0IHNoYXJlZERvY3VtZW50cyA9IHJlZihbXSk7CiAgICBjb25zdCBkb2N1bWVudENhdGVnb3JpZXMgPSByZWYoW10pOwogICAgY29uc3Qgc2VhcmNoUXVlcnkgPSByZWYoJycpOwogICAgY29uc3Qgc2VhcmNoQ2F0ZWdvcnkgPSByZWYoJ2FsbCcpOwogICAgY29uc3QgbmV3RG9jdW1lbnREaWFsb2dWaXNpYmxlID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IHNoYXJlRGlhbG9nVmlzaWJsZSA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBkZWxldGVEaWFsb2dWaXNpYmxlID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IGRvY3VtZW50Q3JlYXRlVHlwZSA9IHJlZignYmxhbmsnKTsKICAgIGNvbnN0IHNlbGVjdGVkRG9jdW1lbnQgPSByZWYobnVsbCk7CiAgICBjb25zdCBzZWxlY3RlZFVzZXJzID0gcmVmKFtdKTsKICAgIGNvbnN0IHNlbGVjdGVkVXNlcnNXaXRoUGVybWlzc2lvbnMgPSByZWYoW10pOyAvLyDmt7vliqDmnYPpmZDmjqfliLbmlbDnu4QKICAgIGNvbnN0IGF2YWlsYWJsZVVzZXJzID0gcmVmKFtdKTsKICAgIGNvbnN0IGF2YWlsYWJsZUNoYXRVc2VycyA9IHJlZihbXSk7IC8vIOa3u+WKoOS4k+eUqOS6juiBiuWkqeeahOeUqOaIt+WIl+ihqAogICAgY29uc3QgY3JlYXRlTG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBzaGFyZUxvYWRpbmcgPSByZWYoZmFsc2UpOwogICAgY29uc3QgZGVsZXRlTG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBleGlzdGluZ1NoYXJlZFVzZXJzID0gcmVmKFtdKTsKCiAgICAvLyDmt7vliqDliIbkuqvnm7jlhbPlj5jph48KICAgIGNvbnN0IHNoYXJlTW9kZSA9IHJlZigncGVybWlzc2lvbicpOyAvLyDliIbkuqvmlrnlvI/vvJpwZXJtaXNzaW9uKOaOiOadgykg5oiWIGNoYXQo5Y+R6YCB5Yiw6IGK5aSpKQogICAgY29uc3Qgc2hhcmVGb3JtYXQgPSByZWYoJ3BkZicpOyAvLyDliIbkuqvmlofmoaPmoLzlvI/vvJpwZGYg5oiWIHdvcmQKICAgIGNvbnN0IHNlbGVjdGVkQ2hhdFVzZXJzID0gcmVmKFtdKTsgLy8g6YCJ5oup55qE6IGK5aSp55So5oi3CgogICAgLy8g5YiG6aG155u45YWz54q25oCBCiAgICBjb25zdCBwYWdlID0gcmVmKDEpOwogICAgY29uc3QgcGFnZVNpemUgPSAxMjsgLy8g5q+P6aG15pi+56S6MTLkuKrmlofmoaPvvIjkuI3ljIXlkKsi5paw5bu6IuWNoeeJh++8iQogICAgY29uc3QgdG90YWxDb3VudCA9IHJlZigwKTsKICAgIGNvbnN0IGdyYW5kVG90YWxDb3VudCA9IHJlZigwKTsgLy8g55So5LqO5a2Y5YKo55yf5a6e55qE5paH5qGj5oC75pWwCiAgICAvLyDmt7vliqDliqDovb3mm7TlpJrnm7jlhbPnirbmgIEKICAgIGNvbnN0IGhhc01vcmUgPSByZWYodHJ1ZSk7CiAgICBjb25zdCBsb2FkaW5nTW9yZSA9IHJlZihmYWxzZSk7CgogICAgLy8g5re75Yqg57yW6L6R5paH5qGj55u45YWz54q25oCBCiAgICBjb25zdCBlZGl0RGlhbG9nVmlzaWJsZSA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBlZGl0RG9jdW1lbnRGb3JtID0gcmVmKHsKICAgICAgaWQ6IG51bGwsCiAgICAgIHRpdGxlOiAnJywKICAgICAgdHlwZTogJycsCiAgICAgIGNhdGVnb3J5X2lkOiBudWxsCiAgICB9KTsKICAgIGNvbnN0IGVkaXRMb2FkaW5nID0gcmVmKGZhbHNlKTsKCiAgICAvLyDooajljZXmlbDmja4KICAgIGNvbnN0IG5ld0RvY3VtZW50Rm9ybSA9IHJlZih7CiAgICAgIHRpdGxlOiAnJywKICAgICAgdHlwZTogJycKICAgIH0pOwogICAgY29uc3QgYWlEb2N1bWVudEZvcm0gPSByZWYoewogICAgICB0aXRsZTogJycsCiAgICAgIHJlcXVpcmVtZW50czogJycKICAgIH0pOwoKICAgIC8vIOihqOWNleagoemqjOinhOWImQogICAgY29uc3QgYmxhbmtGb3JtUnVsZXMgPSB7CiAgICAgIHRpdGxlOiBbewogICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgIG1lc3NhZ2U6ICfor7fovpPlhaXmlofmoaPmoIfpopgnLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9LCB7CiAgICAgICAgbWluOiAyLAogICAgICAgIG1heDogNTAsCiAgICAgICAgbWVzc2FnZTogJ+mVv+W6puWcqCAyIOWIsCA1MCDkuKrlrZfnrKYnLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9XQogICAgfTsKICAgIGNvbnN0IGFpRm9ybVJ1bGVzID0gewogICAgICB0aXRsZTogW3sKICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICBtZXNzYWdlOiAn6K+36L6T5YWl5paH5qGj5Li76aKYJywKICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgfSwgewogICAgICAgIG1pbjogMiwKICAgICAgICBtYXg6IDUwLAogICAgICAgIG1lc3NhZ2U6ICfplb/luqblnKggMiDliLAgNTAg5Liq5a2X56ymJywKICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgfV0sCiAgICAgIHJlcXVpcmVtZW50czogW3sKICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICBtZXNzYWdlOiAn6K+36L6T5YWl5paH5qGj6KaB5rGCJywKICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgfSwgewogICAgICAgIG1pbjogMTAsCiAgICAgICAgbWF4OiA1MDAsCiAgICAgICAgbWVzc2FnZTogJ+mVv+W6puWcqCAxMCDliLAgNTAwIOS4quWtl+espicsCiAgICAgICAgdHJpZ2dlcjogJ2JsdXInCiAgICAgIH1dCiAgICB9OwoKICAgIC8vIOa3u+WKoOe8lui+keihqOWNlemqjOivgeinhOWImQogICAgY29uc3QgZWRpdEZvcm1SdWxlcyA9IHsKICAgICAgdGl0bGU6IFt7CiAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgbWVzc2FnZTogJ+ivt+i+k+WFpeaWh+aho+agh+mimCcsCiAgICAgICAgdHJpZ2dlcjogJ2JsdXInCiAgICAgIH0sIHsKICAgICAgICBtaW46IDIsCiAgICAgICAgbWF4OiA1MCwKICAgICAgICBtZXNzYWdlOiAn6ZW/5bqm5ZyoIDIg5YiwIDUwIOS4quWtl+espicsCiAgICAgICAgdHJpZ2dlcjogJ2JsdXInCiAgICAgIH1dCiAgICB9OwogICAgY29uc3QgYmxhbmtGb3JtUmVmID0gcmVmKG51bGwpOwogICAgY29uc3QgYWlGb3JtUmVmID0gcmVmKG51bGwpOwogICAgY29uc3QgZWRpdEZvcm1SZWYgPSByZWYobnVsbCk7CgogICAgLy8g6K6h566X5bGe5oCnCiAgICBjb25zdCB0b3RhbERvY3VtZW50cyA9IGNvbXB1dGVkKCgpID0+IHsKICAgICAgcmV0dXJuIGdyYW5kVG90YWxDb3VudC52YWx1ZTsKICAgIH0pOwogICAgY29uc3QgcmVjZW50RWRpdENvdW50ID0gY29tcHV0ZWQoKCkgPT4gewogICAgICByZXR1cm4gcmVjZW50RG9jdW1lbnRzLnZhbHVlLmxlbmd0aCB8fCAwOwogICAgfSk7CgogICAgLy8g5YiG57G7566h55CG55u45YWz54q25oCBCiAgICBjb25zdCBjYXRlZ29yeURpYWxvZ1Zpc2libGUgPSByZWYoZmFsc2UpOwogICAgY29uc3QgZWRpdGluZ0NhdGVnb3J5ID0gcmVmKHsKICAgICAgbmFtZTogJycsCiAgICAgIGNvbG9yOiAnIzQwOUVGRicsCiAgICAgIGRlc2NyaXB0aW9uOiAnJwogICAgfSk7CiAgICBjb25zdCBjYXRlZ29yeUZvcm1SZWYgPSByZWYobnVsbCk7CiAgICBjb25zdCBjYXRlZ29yeUxvYWRpbmcgPSByZWYoZmFsc2UpOwogICAgY29uc3QgY2F0ZWdvcnlGb3JtUnVsZXMgPSB7CiAgICAgIG5hbWU6IFt7CiAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgbWVzc2FnZTogJ+ivt+i+k+WFpeexu+Wei+WQjeensCcsCiAgICAgICAgdHJpZ2dlcjogJ2JsdXInCiAgICAgIH0sIHsKICAgICAgICBtaW46IDIsCiAgICAgICAgbWF4OiAyMCwKICAgICAgICBtZXNzYWdlOiAn6ZW/5bqm5ZyoMuWIsDIw5Liq5a2X56ymJywKICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgfV0sCiAgICAgIGNvbG9yOiBbewogICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgIG1lc3NhZ2U6ICfor7fpgInmi6npopzoibInLAogICAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnCiAgICAgIH1dCiAgICB9OwoKICAgIC8vIOi+heWKqeaWueazle+8muW8uuWItuWIt+aWsOinhuWbvgogICAgY29uc3QgZm9yY2VVcGRhdGUgPSBhc3luYyAoKSA9PiB7CiAgICAgIC8vIOWIm+W7uuS4tOaXtuaVsOaNru+8jOinpuWPkea3seW6puWTjeW6lOW8j+abtOaWsAogICAgICBkb2N1bWVudHMudmFsdWUgPSBbLi4uZG9jdW1lbnRzLnZhbHVlXTsKICAgICAgcmVjZW50RG9jdW1lbnRzLnZhbHVlID0gWy4uLnJlY2VudERvY3VtZW50cy52YWx1ZV07CiAgICAgIHNoYXJlZERvY3VtZW50cy52YWx1ZSA9IFsuLi5zaGFyZWREb2N1bWVudHMudmFsdWVdOwoKICAgICAgLy8g5L2/55SoVnVl5a6e5L6L55qEJGZvcmNlVXBkYXRl5pa55rOVCiAgICAgIGlmIChwcm94eSAmJiBwcm94eS4kZm9yY2VVcGRhdGUpIHsKICAgICAgICBwcm94eS4kZm9yY2VVcGRhdGUoKTsKICAgICAgfQoKICAgICAgLy8g562J5b6FRE9N5pu05pawCiAgICAgIGF3YWl0IG5leHRUaWNrKCk7CiAgICB9OwoKICAgIC8vIOaWueazlQogICAgY29uc3QgZmV0Y2hEb2N1bWVudHMgPSBhc3luYyAoZm9yY2VSZWZyZXNoID0gZmFsc2UsIGFwcGVuZCA9IGZhbHNlLCB0aW1lc3RhbXAgPSBudWxsKSA9PiB7CiAgICAgIGlmIChmb3JjZVJlZnJlc2gpIHsKICAgICAgICBwYWdlLnZhbHVlID0gMTsKICAgICAgICBoYXNNb3JlLnZhbHVlID0gdHJ1ZTsKICAgICAgfQoKICAgICAgLy8g5Y+q5pyJ5Zyo5Yqg6L295pu05aSa5qih5byP5LiL5omN5qOA5p+laGFzTW9yZQogICAgICBpZiAoYXBwZW5kICYmICFoYXNNb3JlLnZhbHVlICYmICFmb3JjZVJlZnJlc2gpIHsKICAgICAgICBjb25zb2xlLmxvZygn5rKh5pyJ5pu05aSa5paH5qGj77yM5Y+W5raI6I635Y+WJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICghYXBwZW5kKSB7CiAgICAgICAgY3JlYXRlTG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbG9hZGluZ01vcmUudmFsdWUgPSB0cnVlOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgLy8g5p6E5bu66L+H5ruk5p2h5Lu2CiAgICAgICAgY29uc3QgZmlsdGVycyA9IHt9OwoKICAgICAgICAvLyDmt7vliqDliIbnsbvov4fmu6QKICAgICAgICBpZiAoc2VhcmNoQ2F0ZWdvcnkudmFsdWUgJiYgc2VhcmNoQ2F0ZWdvcnkudmFsdWUgIT09ICdhbGwnKSB7CiAgICAgICAgICBmaWx0ZXJzLmNhdGVnb3J5ID0gc2VhcmNoQ2F0ZWdvcnkudmFsdWU7CiAgICAgICAgfQoKICAgICAgICAvLyDmt7vliqDmkJzntKLmn6Xor6IKICAgICAgICBpZiAoc2VhcmNoUXVlcnkudmFsdWUpIHsKICAgICAgICAgIGZpbHRlcnMuc2VhcmNoID0gc2VhcmNoUXVlcnkudmFsdWU7CiAgICAgICAgfQoKICAgICAgICAvLyBBUEnor7fmsYLlj4LmlbAgLSDkvb/nlKjkuI5EUkblhbzlrrnnmoRwYWdlX3NpemXlj4LmlbDlkI0KICAgICAgICBjb25zdCBwYXJhbXMgPSB7CiAgICAgICAgICBwYWdlOiBwYWdlLnZhbHVlLAogICAgICAgICAgcGFnZV9zaXplOiBwYWdlU2l6ZSwKICAgICAgICAgIC8vIOWwhnBhZ2VTaXpl5L2c5Li6cGFnZV9zaXpl5Y+C5pWw5Lyg6YCS77yM5LiO5ZCO56uvUkVTVCBmcmFtZXdvcmvlj4LmlbDkv53mjIHkuIDoh7QKICAgICAgICAgIF90OiB0aW1lc3RhbXAgfHwgbmV3IERhdGUoKS5nZXRUaW1lKCkgLy8g5re75Yqg5pe26Ze05oiz77yM56Gu5L+d5LiN5L2/55So57yT5a2YCiAgICAgICAgfTsKCiAgICAgICAgLy8g5ZCI5bm26L+H5ruk5p2h5Lu2CiAgICAgICAgT2JqZWN0LmFzc2lnbihwYXJhbXMsIGZpbHRlcnMpOwogICAgICAgIGNvbnNvbGUubG9nKGDojrflj5bmlofmoaPliJfooajvvIzpobXnoIE6ICR7cGFnZS52YWx1ZX3vvIzlj4LmlbA6YCwgcGFyYW1zKTsKICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBnZXREb2N1bWVudHMocGFyYW1zKTsKICAgICAgICBjb25zb2xlLmxvZygn5paH5qGj5YiX6KGoQVBJ5ZON5bqUOicsIHJlcyk7CiAgICAgICAgbGV0IG5ld0RvY3VtZW50cyA9IFtdOwogICAgICAgIGxldCBjdXJyZW50Vmlld0NvdW50ID0gMDsKCiAgICAgICAgLy8g5aSE55CGQVBJ5Y+v6IO96L+U5Zue55qE6K2m5ZGK5L+h5oGvCiAgICAgICAgaWYgKHJlcyAmJiByZXMud2FybmluZykgewogICAgICAgICAgY29uc29sZS53YXJuKCdBUEnov5Tlm57orablkYo6JywgcmVzLndhcm5pbmcpOwogICAgICAgICAgRWxNZXNzYWdlKHsKICAgICAgICAgICAgbWVzc2FnZTogcmVzLndhcm5pbmcsCiAgICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJywKICAgICAgICAgICAgZHVyYXRpb246IDUwMDAKICAgICAgICAgIH0pOwogICAgICAgICAgLy8g5aaC5p6c5piv6aG156CB6Zeu6aKY77yM6YeN572u5b2T5YmN6aG15Li6MQogICAgICAgICAgaWYgKHJlcy53YXJuaW5nLmluY2x1ZGVzKCfpobXnoIEnKSAmJiByZXMud2FybmluZy5pbmNsdWRlcygn5peg5pWI5oiW6LaF5Ye66IyD5Zu0JykpIHsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgcGFnZS52YWx1ZSA9IDE7CiAgICAgICAgICAgIH0sIDApOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g5aSE55CG5LiN5ZCM5qC85byP55qE5ZON5bqUCiAgICAgICAgaWYgKHJlcyAmJiByZXMuZGF0YSAmJiBBcnJheS5pc0FycmF5KHJlcy5kYXRhKSkgewogICAgICAgICAgLy8g5qCH5YeG5qC85byP5ZON5bqUCiAgICAgICAgICBuZXdEb2N1bWVudHMgPSByZXMuZGF0YTsKICAgICAgICAgIGN1cnJlbnRWaWV3Q291bnQgPSByZXMudG90YWwgfHwgcmVzLmNvdW50IHx8IDA7CiAgICAgICAgfSBlbHNlIGlmIChyZXMgJiYgcmVzLnJlc3VsdHMgJiYgQXJyYXkuaXNBcnJheShyZXMucmVzdWx0cykpIHsKICAgICAgICAgIC8vIERqYW5nbyBSRVNU5qC85byP5ZON5bqUCiAgICAgICAgICBuZXdEb2N1bWVudHMgPSByZXMucmVzdWx0czsKICAgICAgICAgIGN1cnJlbnRWaWV3Q291bnQgPSByZXMuY291bnQgfHwgMDsKICAgICAgICB9IGVsc2UgaWYgKHJlcyAmJiByZXMuZGF0YSAmJiByZXMuZGF0YS5yZXN1bHRzICYmIEFycmF5LmlzQXJyYXkocmVzLmRhdGEucmVzdWx0cykpIHsKICAgICAgICAgIC8vIOW1jOWll+agvOW8j+WTjeW6lAogICAgICAgICAgbmV3RG9jdW1lbnRzID0gcmVzLmRhdGEucmVzdWx0czsKICAgICAgICAgIGN1cnJlbnRWaWV3Q291bnQgPSByZXMuZGF0YS5jb3VudCB8fCAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ0FQSei/lOWbnueahOaWh+aho+aVsOaNruagvOW8j+aXoOaViDonLCByZXMpOwogICAgICAgICAgZG9jdW1lbnRzLnZhbHVlID0gW107CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyDmm7TmlrDnlKjkuo7liIbpobXnmoTmgLvmlbAKICAgICAgICB0b3RhbENvdW50LnZhbHVlID0gY3VycmVudFZpZXdDb3VudDsKCiAgICAgICAgLy8g5LuF5b2T5rKh5pyJ562b6YCJ5p2h5Lu25pe277yM5omN5pu05pawIuWFqOmDqOaWh+ahoyLnmoTnnJ/lrp7mgLvmlbAKICAgICAgICBpZiAoIWZpbHRlcnMuY2F0ZWdvcnkgJiYgIWZpbHRlcnMuc2VhcmNoKSB7CiAgICAgICAgICBncmFuZFRvdGFsQ291bnQudmFsdWUgPSBjdXJyZW50Vmlld0NvdW50OwogICAgICAgIH0KCiAgICAgICAgLy8g5aaC5p6c5piv6L+95Yqg5qih5byPCiAgICAgICAgaWYgKGFwcGVuZCkgewogICAgICAgICAgLy8g5qOA5p+l5bm26YG/5YWN5re75Yqg6YeN5aSN55qE5paH5qGjCiAgICAgICAgICBjb25zdCBleGlzdGluZ0lkcyA9IG5ldyBTZXQoZG9jdW1lbnRzLnZhbHVlLm1hcChkb2MgPT4gZG9jLmlkKSk7CiAgICAgICAgICBjb25zdCB1bmlxdWVOZXdEb2NzID0gbmV3RG9jdW1lbnRzLmZpbHRlcihkb2MgPT4gIWV4aXN0aW5nSWRzLmhhcyhkb2MuaWQpKTsKICAgICAgICAgIGlmICh1bmlxdWVOZXdEb2NzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZG9jdW1lbnRzLnZhbHVlID0gWy4uLmRvY3VtZW50cy52YWx1ZSwgLi4udW5pcXVlTmV3RG9jc107CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDov73liqDkuoYgJHt1bmlxdWVOZXdEb2NzLmxlbmd0aH0g5Liq5paw5paH5qGj77yM5b2T5YmN5YWxICR7ZG9jdW1lbnRzLnZhbHVlLmxlbmd0aH0g5LiqYCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZygn5rKh5pyJ5paw55qE5paH5qGj6KKr6L+95YqgJyk7CiAgICAgICAgICAgIC8vIOWNs+S9v+ayoeacieaWsOaWh+aho++8jOS5n+WPr+iDveaYr+WboOS4uuaIkeS7rOWcqOS4jeWQjOeahOmhteeggeS4iuiOt+WPluS6humHjeWkjeaVsOaNrgogICAgICAgICAgICBoYXNNb3JlLnZhbHVlID0gbmV3RG9jdW1lbnRzLmxlbmd0aCA+IDA7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIOmdnui/veWKoOaooeW8j++8jOebtOaOpeabv+aNogogICAgICAgICAgZG9jdW1lbnRzLnZhbHVlID0gbmV3RG9jdW1lbnRzOwogICAgICAgICAgY29uc29sZS5sb2coYOiuvue9ruS6hiAke2RvY3VtZW50cy52YWx1ZS5sZW5ndGh9IOS4quaWh+aho2ApOwogICAgICAgIH0KICAgICAgICBjb25zb2xlLmxvZyhg5b2T5YmN5paH5qGjSUTliJfooag6IFske2RvY3VtZW50cy52YWx1ZS5tYXAoZCA9PiBkLmlkKS5qb2luKCcsICcpfV1gKTsKCiAgICAgICAgLy8g6K6h566X5oC76aG15pWwCiAgICAgICAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbChjdXJyZW50Vmlld0NvdW50IC8gcGFnZVNpemUpOwogICAgICAgIGNvbnNvbGUubG9nKGDliIbpobXnirbmgIEgLSDlvZPliY3pobU6ICR7cGFnZS52YWx1ZX0sIOaAu+mhteaVsDogJHt0b3RhbFBhZ2VzfSwg5oC75paH5qGj5pWwOiAke2N1cnJlbnRWaWV3Q291bnR9YCk7CgogICAgICAgIC8vIOajgOafpeW9k+WJjemhteaYr+WQpui2heWHuuiMg+WbtAogICAgICAgIGlmIChwYWdlLnZhbHVlID4gdG90YWxQYWdlcyAmJiB0b3RhbFBhZ2VzID4gMCAmJiAhYXBwZW5kKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oYOW9k+WJjemhtSAke3BhZ2UudmFsdWV9IOi2heWHuuiMg+WbtO+8jOiHquWKqOS/ruato+S4uuacgOWQjuS4gOmhtSAke3RvdGFsUGFnZXN9YCk7CgogICAgICAgICAgLy8g5L2/55Soc2V0VGltZW91dOmBv+WFjeinpuWPkXdhdGNo5LqL5Lu2CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgcGFnZS52YWx1ZSA9IHRvdGFsUGFnZXM7CiAgICAgICAgICB9LCAwKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIOabtOaWsOaYr+WQpuacieabtOWkmumhteagh+W/lwogICAgICAgIGhhc01vcmUudmFsdWUgPSBwYWdlLnZhbHVlIDwgdG90YWxQYWdlczsKCiAgICAgICAgLy8g5aaC5p6c5Yy56YWN55qE5paH5qGj5aSq5bCR77yI5q+U5aaC5L2O5LqO5LiA5bGP77yJ77yM5bm25LiU5pyJ5pu05aSa5pWw5o2u77yM6Ieq5Yqo5Yqg6L295pu05aSaCiAgICAgICAgaWYgKCFhcHBlbmQgJiYgZG9jdW1lbnRzLnZhbHVlLmxlbmd0aCA8IDggJiYgaGFzTW9yZS52YWx1ZSkgewogICAgICAgICAgY29uc29sZS5sb2coJ+aWh+aho+aVsOmHj+i+g+Wwke+8jOiHquWKqOWKoOi9veS4i+S4gOmhtScpOwogICAgICAgICAgLy8g5bu26L+fMTAwbXPpgb/lhY3or7fmsYLov4fkuo7popHnuYEKICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTsKICAgICAgICAgIGF3YWl0IGZldGNoRG9jdW1lbnRzKGZhbHNlLCB0cnVlLCB0aW1lc3RhbXApOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bmlofmoaPliJfooajlpLHotKUnLCBlcnJvcik7CiAgICAgICAgZG9jdW1lbnRzLnZhbHVlID0gW107CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfojrflj5bmlofmoaPliJfooajlpLHotKUnKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBpZiAoIWFwcGVuZCkgewogICAgICAgICAgY3JlYXRlTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsb2FkaW5nTW9yZS52YWx1ZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIGNvbnN0IGZldGNoUmVjZW50RG9jdW1lbnRzID0gYXN5bmMgKGZvcmNlUmVmcmVzaCA9IGZhbHNlLCB0aW1lc3RhbXAgPSBudWxsKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCflvIDlp4vojrflj5bmnIDov5HmlofmoaMuLi4nKTsKICAgICAgdHJ5IHsKICAgICAgICAvLyDlh4blpIflj4LmlbDvvIzlpoLmnpzlvLrliLbliLfmlrDmt7vliqDml7bpl7TmiLMKICAgICAgICBjb25zdCBwYXJhbXMgPSBmb3JjZVJlZnJlc2ggPyB7CiAgICAgICAgICBfdDogdGltZXN0YW1wIHx8IG5ldyBEYXRlKCkuZ2V0VGltZSgpCiAgICAgICAgfSA6IHt9OwogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGdldFJlY2VudERvY3VtZW50cyhwYXJhbXMpOwogICAgICAgIGNvbnNvbGUubG9nKCfmnIDov5HmlofmoaNBUEnlk43lupQ6JywgcmVzKTsKICAgICAgICBpZiAocmVzICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICAvLyDlrozlhajmm7/mjaLmlbDnu4TogIzkuI3mmK/kv67mlLnlvJXnlKgKICAgICAgICAgIHJlY2VudERvY3VtZW50cy52YWx1ZSA9IEFycmF5LmlzQXJyYXkocmVzLmRhdGEpID8gWy4uLnJlcy5kYXRhXSA6IFtdOwogICAgICAgICAgY29uc29sZS5sb2coYOiuvue9ruacgOi/keaWh+ahozogJHtyZWNlbnREb2N1bWVudHMudmFsdWUubGVuZ3RofeadoeiusOW9lWApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ0FQSei/lOWbnueahOacgOi/keaWh+aho+aVsOaNruaXoOaViDonLCByZXMpOwogICAgICAgICAgcmVjZW50RG9jdW1lbnRzLnZhbHVlID0gW107CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPluacgOi/keaWh+aho+Wksei0pTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfojrflj5bmnIDov5HmlofmoaPlpLHotKUnKTsKICAgICAgICByZWNlbnREb2N1bWVudHMudmFsdWUgPSBbXTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IGZldGNoU2hhcmVkRG9jdW1lbnRzID0gYXN5bmMgKHRpbWVzdGFtcCA9IG51bGwpID0+IHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBwYXJhbXMgPSB0aW1lc3RhbXAgPyB7CiAgICAgICAgICBfdDogdGltZXN0YW1wCiAgICAgICAgfSA6IHt9OwogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0U2hhcmVkRG9jdW1lbnRzKHBhcmFtcyk7CiAgICAgICAgc2hhcmVkRG9jdW1lbnRzLnZhbHVlID0gcmVzcG9uc2UuZGF0YTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5blhbHkuqvmlofmoaPlpLHotKUnLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfojrflj5blhbHkuqvmlofmoaPlpLHotKUnKTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IGZldGNoRG9jdW1lbnRDYXRlZ29yaWVzID0gYXN5bmMgKHRpbWVzdGFtcCA9IG51bGwsIHJldHJ5Q291bnQgPSAwKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCflvIDlp4vojrflj5bmlofmoaPliIbnsbsuLi4nKTsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBwYXJhbXMgPSB0aW1lc3RhbXAgPyB7CiAgICAgICAgICBfdDogdGltZXN0YW1wCiAgICAgICAgfSA6IHt9OwogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGdldERvY3VtZW50Q2F0ZWdvcmllcyhwYXJhbXMpOwogICAgICAgIGNvbnNvbGUubG9nKCfmlofmoaPliIbnsbtBUEnlk43lupQ6JywgcmVzKTsKICAgICAgICBpZiAocmVzICYmIHJlcy5kYXRhKSB7CiAgICAgICAgICBkb2N1bWVudENhdGVnb3JpZXMudmFsdWUgPSByZXMuZGF0YTsKICAgICAgICAgIGNvbnNvbGUubG9nKGDorr7nva7mlofmoaPliIbnsbs6ICR7ZG9jdW1lbnRDYXRlZ29yaWVzLnZhbHVlLmxlbmd0aH3mnaHorrDlvZUsIOaVsOaNrjpgLCBkb2N1bWVudENhdGVnb3JpZXMudmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ0FQSei/lOWbnueahOaWh+aho+WIhuexu+aVsOaNruaXoOaViDonLCByZXMpOwogICAgICAgICAgZG9jdW1lbnRDYXRlZ29yaWVzLnZhbHVlID0gW107CgogICAgICAgICAgLy8g5aaC5p6c6L+U5Zue56m65pWw5o2u5LiU5pyq6L6+5Yiw5pyA5aSn6YeN6K+V5qyh5pWw77yM5bCd6K+V6YeN6K+VCiAgICAgICAgICBpZiAoZG9jdW1lbnRDYXRlZ29yaWVzLnZhbHVlLmxlbmd0aCA9PT0gMCAmJiByZXRyeUNvdW50IDwgMikgewogICAgICAgICAgICBjb25zb2xlLmxvZyhg5paH5qGj5YiG57G75pWw5o2u5Li656m677yMJHtyZXRyeUNvdW50ICsgMX3np5LlkI7ph43or5UuLi5gKTsKICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBmZXRjaERvY3VtZW50Q2F0ZWdvcmllcyh0aW1lc3RhbXAsIHJldHJ5Q291bnQgKyAxKSwgKHJldHJ5Q291bnQgKyAxKSAqIDEwMDApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bmlofmoaPliIbnsbvlpLHotKU6JywgZXJyb3IpOwoKICAgICAgICAvLyDlpoLmnpzmmK/mnI3liqHlmajplJnor6/kuJTmnKrovr7liLDmnIDlpKfph43or5XmrKHmlbDvvIzlsJ3or5Xph43or5UKICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UgJiYgZXJyb3IucmVzcG9uc2Uuc3RhdHVzID49IDUwMCAmJiByZXRyeUNvdW50IDwgMikgewogICAgICAgICAgY29uc29sZS5sb2coYOacjeWKoeWZqOmUmeivr++8jCR7cmV0cnlDb3VudCArIDF956eS5ZCO6YeN6K+VLi4uYCk7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGZldGNoRG9jdW1lbnRDYXRlZ29yaWVzKHRpbWVzdGFtcCwgcmV0cnlDb3VudCArIDEpLCAocmV0cnlDb3VudCArIDEpICogMTAwMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign6I635Y+W5paH5qGj5YiG57G75aSx6LSl77yM6K+35Yi35paw6aG16Z2i6YeN6K+VJyk7CiAgICAgICAgICAvLyDliJ3lp4vljJbnqbrmlbDnu4QKICAgICAgICAgIGRvY3VtZW50Q2F0ZWdvcmllcy52YWx1ZSA9IFtdOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICAvLyDnm5HlkKzmkJzntKLmn6Xor6Llj5jljJbvvIzlrp7njrDlrp7ml7bmkJzntKIKICAgIHdhdGNoKHNlYXJjaFF1ZXJ5LCBfLmRlYm91bmNlKGFzeW5jICgpID0+IHsKICAgICAgLy8g6YeN572u5YiG6aG1CiAgICAgIHBhZ2UudmFsdWUgPSAxOwogICAgICBoYXNNb3JlLnZhbHVlID0gdHJ1ZTsKCiAgICAgIC8vIOa4heepuueOsOacieaWh+aho+WIl+ihqO+8jOaYvuekuuWKoOi9veeKtuaAgQogICAgICBkb2N1bWVudHMudmFsdWUgPSBbXTsKICAgICAgY3JlYXRlTG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgIHRyeSB7CiAgICAgICAgLy8g6I635Y+W5paw55qE5pCc57Si57uT5p6cCiAgICAgICAgYXdhaXQgZmV0Y2hEb2N1bWVudHModHJ1ZSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5pCc57Si5aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+aQnOe0ouaWh+aho+Wksei0pe+8jOivt+mHjeivlScpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGNyZWF0ZUxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgfQogICAgfSwgMzAwKSk7CiAgICBjb25zdCBjcmVhdGVOZXdEb2N1bWVudCA9ICgpID0+IHsKICAgICAgLy8g6YeN572u6KGo5Y2VCiAgICAgIG5ld0RvY3VtZW50Rm9ybS52YWx1ZSA9IHsKICAgICAgICB0aXRsZTogJycsCiAgICAgICAgdHlwZTogJycKICAgICAgfTsKICAgICAgYWlEb2N1bWVudEZvcm0udmFsdWUgPSB7CiAgICAgICAgdGl0bGU6ICcnLAogICAgICAgIHJlcXVpcmVtZW50czogJycKICAgICAgfTsKICAgICAgZG9jdW1lbnRDcmVhdGVUeXBlLnZhbHVlID0gJ2JsYW5rJzsKICAgICAgbmV3RG9jdW1lbnREaWFsb2dWaXNpYmxlLnZhbHVlID0gdHJ1ZTsKCiAgICAgIC8vIOebkeWQrOWvueivneahhuWFs+mXreS6i+S7tu+8jOa4heeQhuihqOWNlQogICAgICBuZXh0VGljaygoKSA9PiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IGRpYWxvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lbC1kaWFsb2cnKTsKICAgICAgICAgIGlmIChkaWFsb2cpIHsKICAgICAgICAgICAgZGlhbG9nLmFkZEV2ZW50TGlzdGVuZXIoJ2Nsb3NlZCcsICgpID0+IHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKGJsYW5rRm9ybVJlZi52YWx1ZSkgewogICAgICAgICAgICAgICAgICBibGFua0Zvcm1SZWYudmFsdWUuY2xlYXJWYWxpZGF0ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGFpRm9ybVJlZi52YWx1ZSkgewogICAgICAgICAgICAgICAgICBhaUZvcm1SZWYudmFsdWUuY2xlYXJWYWxpZGF0ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2xlYXJpbmcgZm9ybSB2YWxpZGF0aW9uOicsIGVycik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgb25jZTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNldHRpbmcgdXAgZGlhbG9nIGV2ZW50IGxpc3RlbmVyOicsIGVycik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CiAgICBjb25zdCBzdWJtaXROZXdEb2N1bWVudCA9IGFzeW5jICgpID0+IHsKICAgICAgaWYgKGRvY3VtZW50Q3JlYXRlVHlwZS52YWx1ZSA9PT0gJ2JsYW5rJykgewogICAgICAgIGlmICghYmxhbmtGb3JtUmVmLnZhbHVlKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ+ihqOWNleW8leeUqOS4jeWtmOWcqCcpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgY29uc3QgdmFsaWQgPSBhd2FpdCBibGFua0Zvcm1SZWYudmFsdWUudmFsaWRhdGUoKS5jYXRjaChlcnIgPT4gewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCfooajljZXpqozor4HlpLHotKU6JywgZXJyKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgICAgY3JlYXRlTG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+W8gOWni+WIm+W7uuaWh+ahozonLCB7CiAgICAgICAgICAgICAgICB0aXRsZTogbmV3RG9jdW1lbnRGb3JtLnZhbHVlLnRpdGxlLAogICAgICAgICAgICAgICAgdHlwZTogbmV3RG9jdW1lbnRGb3JtLnZhbHVlLnR5cGUgfHwgJ+mAmueUqCcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNyZWF0ZURvY3VtZW50KHsKICAgICAgICAgICAgICAgIHRpdGxlOiBuZXdEb2N1bWVudEZvcm0udmFsdWUudGl0bGUsCiAgICAgICAgICAgICAgICB0eXBlOiBuZXdEb2N1bWVudEZvcm0udmFsdWUudHlwZSB8fCAn6YCa55SoJywKICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICcnCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+WIm+W7uuaWh+aho+WTjeW6lOaVsOaNru+8micsIEpTT04uc3RyaW5naWZ5KHJlc3BvbnNlKSk7CgogICAgICAgICAgICAgIC8vIOWFs+mXreWvueivneahhgogICAgICAgICAgICAgIG5ld0RvY3VtZW50RGlhbG9nVmlzaWJsZS52YWx1ZSA9IGZhbHNlOwogICAgICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCfmlofmoaPliJvlu7rmiJDlip8nKTsKCiAgICAgICAgICAgICAgLy8g6Kej5p6Q6L+U5Zue55qE5paH5qGjSUQKICAgICAgICAgICAgICBsZXQgZG9jSWQgPSBudWxsOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS5pZCkgewogICAgICAgICAgICAgICAgICBkb2NJZCA9IHJlc3BvbnNlLmRhdGEuaWQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocmVzcG9uc2UuZGF0YSkgJiYgcmVzcG9uc2UuZGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIGRvY0lkID0gcmVzcG9uc2UuZGF0YVswXS5pZDsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXN1bHRzICYmIEFycmF5LmlzQXJyYXkocmVzcG9uc2UuZGF0YS5yZXN1bHRzKSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICBkb2NJZCA9IHJlc3BvbnNlLmRhdGEucmVzdWx0c1swXS5pZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIC8vIOetieW+heWvueivneahhuWFs+mXreWujOaIkOWQjuWGjeaJp+ihjOi3s+i9rO+8jOmBv+WFjURPTemUmeivrwogICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKGRvY0lkKSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGDlh4blpIfot7PovazliLDmlofmoaPor6bmg4XpobXvvIxJRDogJHtkb2NJZH1gKTsKCiAgICAgICAgICAgICAgICAgIC8vIOWFiOWIt+aWsOaWh+aho+WIl+ihqO+8jOehruS/neaVsOaNruaYr+acgOaWsOeahAogICAgICAgICAgICAgICAgICBmZXRjaERvY3VtZW50cygpOwogICAgICAgICAgICAgICAgICBmZXRjaFJlY2VudERvY3VtZW50cygpOwoKICAgICAgICAgICAgICAgICAgLy8g54S25ZCO5YaN5omn6KGM5a+86IiqCiAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIHJvdXRlci5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdTbWFydERvY0RldGFpbCcsCiAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGRvY0lkCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyID0+IHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+i3r+eUseWvvOiIquWksei0pTonLCBlcnIpOwogICAgICAgICAgICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfot7PovazmlofmoaPor6bmg4XpobXlpLHotKXvvIzor7fmiYvliqjliLfmlrDpobXpnaInKTsKICAgICAgICAgICAgICAgICAgICAgIC8vIOWwneivlei3r+W+hOi3s+i9rAogICAgICAgICAgICAgICAgICAgICAgcm91dGVyLnB1c2goYC9zbWFydGRvYy8ke2RvY0lkfWApLmNhdGNoKG5hdkVyciA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+i3r+W+hOWvvOiIquS5n+Wksei0pTonLCBuYXZFcnIpOwogICAgICAgICAgICAgICAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+i3r+W+hOi3s+i9rOivpuaDhemhteS5n+Wksei0pScpOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0sIDMwMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ+WIm+W7uuaWh+aho+aIkOWKn++8jOS9hui/lOWbnueahOaVsOaNruagvOW8j+S4jeato+ehricsIHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgLy8g5Yi35paw5paH5qGj5YiX6KGoCiAgICAgICAgICAgICAgICAgIGZldGNoRG9jdW1lbnRzKCk7CiAgICAgICAgICAgICAgICAgIGZldGNoUmVjZW50RG9jdW1lbnRzKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgMTAwKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfliJvlu7rmlofmoaPlpLHotKUnLCBlcnJvcik7CiAgICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfliJvlu7rmlofmoaPlpLHotKUnKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICBjcmVhdGVMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcign5o+Q5Lqk6KGo5Y2V5pe25Y+R55Sf6ZSZ6K+vOicsIGVycm9yKTsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign6KGo5Y2V5o+Q5Lqk5aSx6LSlJyk7CiAgICAgICAgICBjcmVhdGVMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGRvY3VtZW50Q3JlYXRlVHlwZS52YWx1ZSA9PT0gJ2FpJykgewogICAgICAgIGlmICghYWlGb3JtUmVmLnZhbHVlKSB7CiAgICAgICAgICBjb25zb2xlLndhcm4oJ0FJ6KGo5Y2V5byV55So5LiN5a2Y5ZyoJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCB2YWxpZCA9IGF3YWl0IGFpRm9ybVJlZi52YWx1ZS52YWxpZGF0ZSgpLmNhdGNoKGVyciA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0FJ6KGo5Y2V6aqM6K+B5aSx6LSlOicsIGVycik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICAgIGNyZWF0ZUxvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIC8vIOiwg+eUqEFJ55Sf5oiQ5paH5qGjQVBJCiAgICAgICAgICAgICAgY29uc3QgY2F0ZWdvcnlJZCA9IHNlYXJjaENhdGVnb3J5LnZhbHVlICE9PSAnYWxsJyA/IHNlYXJjaENhdGVnb3J5LnZhbHVlIDogbnVsbDsKICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFpR2VuZXJhdGVEb2N1bWVudCh7CiAgICAgICAgICAgICAgICB0aXRsZTogYWlEb2N1bWVudEZvcm0udmFsdWUudGl0bGUsCiAgICAgICAgICAgICAgICByZXF1aXJlbWVudDogYWlEb2N1bWVudEZvcm0udmFsdWUucmVxdWlyZW1lbnRzLAogICAgICAgICAgICAgICAgY2F0ZWdvcnlfaWQ6IGNhdGVnb3J5SWQsCiAgICAgICAgICAgICAgICBkb2NfdHlwZTogJ0FJJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBSeeUn+aIkOaWh+aho+WTjeW6lOaVsOaNru+8micsIHJlc3BvbnNlKTsKICAgICAgICAgICAgICAvLyDmo4Dmn6XotoXml7YKICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3RhdHVzID09PSA1MDQpIHsKICAgICAgICAgICAgICAgIHZhciBfcmVzcG9uc2UkZGF0YTsKICAgICAgICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcigoKF9yZXNwb25zZSRkYXRhID0gcmVzcG9uc2UuZGF0YSkgPT09IG51bGwgfHwgX3Jlc3BvbnNlJGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yZXNwb25zZSRkYXRhLmRldGFpbCkgfHwgJ0FJ55Sf5oiQ6LaF5pe277yM6K+3566A5YyW6ZyA5rGC5oiW56iN5ZCO6YeN6K+VJyk7CiAgICAgICAgICAgICAgICBjcmVhdGVMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHR5cGVvZiByZXNwb25zZS5kYXRhLmRldGFpbCA9PT0gJ3N0cmluZycgJiYgcmVzcG9uc2UuZGF0YS5kZXRhaWwuaW5jbHVkZXMoJ+i2heaXticpKSB7CiAgICAgICAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IocmVzcG9uc2UuZGF0YS5kZXRhaWwpOwogICAgICAgICAgICAgICAgY3JlYXRlTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBuZXdEb2N1bWVudERpYWxvZ1Zpc2libGUudmFsdWUgPSBmYWxzZTsKICAgICAgICAgICAgICBFbE1lc3NhZ2Uuc3VjY2VzcygnQUnnlJ/miJDmlofmoaPmiJDlip8nKTsKICAgICAgICAgICAgICBsZXQgZG9jSWQgPSBudWxsOwogICAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuaWQpIHsKICAgICAgICAgICAgICAgIGRvY0lkID0gcmVzcG9uc2UuZGF0YS5pZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGRvY0lkKSB7CiAgICAgICAgICAgICAgICAvLyDot7PovazliY3miZPljbDml6Xlv5cKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCflh4blpIfot7PovazliLDmlofmoaPor6bmg4XpobXvvIzot6/nlLHlkI06IFNtYXJ0RG9jRGV0YWlsLCBpZDonLCBkb2NJZCk7CiAgICAgICAgICAgICAgICByb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgICAgIG5hbWU6ICdTbWFydERvY0RldGFpbCcsCiAgICAgICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgICAgIGlkOiBTdHJpbmcoZG9jSWQpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgICAgICBjcmVhdGVMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9KS5jYXRjaChlcnIgPT4gewogICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfot6/nlLHlr7zoiKrlpLHotKU6JywgZXJyKTsKICAgICAgICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfot7PovazmlofmoaPor6bmg4XpobXlpLHotKXvvIzor7fmiYvliqjliLfmlrDpobXpnaInKTsKICAgICAgICAgICAgICAgICAgLy8g5bCd6K+V6Lev5b6E6Lez6L2sCiAgICAgICAgICAgICAgICAgIHJvdXRlci5wdXNoKGAvc21hcnRkb2MvJHtkb2NJZH1gKS5jYXRjaChuYXZFcnIgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+i3r+W+hOWvvOiIquS5n+Wksei0pTonLCBuYXZFcnIpOwogICAgICAgICAgICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign6Lev5b6E6Lez6L2s6K+m5oOF6aG15Lmf5aSx6LSlJyk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBjcmVhdGVMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIC8vIOW8guatpeWIt+aWsOaVsOaNrgogICAgICAgICAgICAgICAgZmV0Y2hEb2N1bWVudHMoKTsKICAgICAgICAgICAgICAgIGZldGNoUmVjZW50RG9jdW1lbnRzKCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZldGNoRG9jdW1lbnRzKCk7CiAgICAgICAgICAgICAgICBmZXRjaFJlY2VudERvY3VtZW50cygpOwogICAgICAgICAgICAgICAgY3JlYXRlTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBSeeUn+aIkOaWh+aho+Wksei0pScsIGVycm9yKTsKICAgICAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ0FJ55Sf5oiQ5paH5qGj5aSx6LSlJyk7CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgY3JlYXRlTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+aPkOS6pEFJ6KGo5Y2V5pe25Y+R55Sf6ZSZ6K+vOicsIGVycm9yKTsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign6KGo5Y2V5o+Q5Lqk5aSx6LSlJyk7CiAgICAgICAgICBjcmVhdGVMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgY29uc3Qgb3BlbkRvY3VtZW50ID0gZG9jID0+IHsKICAgICAgcm91dGVyLnB1c2goewogICAgICAgIG5hbWU6ICdTbWFydERvY0RldGFpbCcsCiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICBpZDogZG9jLmlkCiAgICAgICAgfQogICAgICB9KTsKICAgIH07CiAgICBjb25zdCBlZGl0RG9jdW1lbnQgPSAoZG9jLCBldmVudCkgPT4gewogICAgICAvLyDpmLvmraLkuovku7blhpLms6HvvIzpmLLmraLop6blj5HljaHniYfngrnlh7vkuovku7YKICAgICAgaWYgKGV2ZW50KSB7CiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgIH0KCiAgICAgIC8vIOehruS/neWIhuexu0lE5piv5pWw5a2X57G75Z6LCiAgICAgIGxldCBjYXRlZ29yeUlkID0gbnVsbDsKICAgICAgaWYgKGRvYy5jYXRlZ29yeSAmJiBkb2MuY2F0ZWdvcnkuaWQpIHsKICAgICAgICBjYXRlZ29yeUlkID0gTnVtYmVyKGRvYy5jYXRlZ29yeS5pZCk7CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coJ+e8lui+keaWh+ahozonLCBkb2MuaWQsICflvZPliY3liIbnsbs6JywgY2F0ZWdvcnlJZCk7CgogICAgICAvLyDorr7nva7ooajljZXmlbDmja4KICAgICAgZWRpdERvY3VtZW50Rm9ybS52YWx1ZSA9IHsKICAgICAgICBpZDogZG9jLmlkLAogICAgICAgIHRpdGxlOiBkb2MudGl0bGUsCiAgICAgICAgdHlwZTogZG9jLnR5cGUgfHwgJycsCiAgICAgICAgY2F0ZWdvcnlfaWQ6IGNhdGVnb3J5SWQKICAgICAgfTsKCiAgICAgIC8vIOaYvuekuue8lui+keWvueivneahhgogICAgICBlZGl0RGlhbG9nVmlzaWJsZS52YWx1ZSA9IHRydWU7CiAgICB9OwoKICAgIC8vIOaPkOS6pOe8lui+keaWh+ahowogICAgY29uc3Qgc3VibWl0RWRpdERvY3VtZW50ID0gYXN5bmMgKCkgPT4gewogICAgICBpZiAoIWVkaXRGb3JtUmVmLnZhbHVlKSByZXR1cm47CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgdmFsaWQgPSBhd2FpdCBlZGl0Rm9ybVJlZi52YWx1ZS52YWxpZGF0ZSgpOwogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgZWRpdExvYWRpbmcudmFsdWUgPSB0cnVlOwoKICAgICAgICAgIC8vIOWHhuWkh+abtOaWsOeahOaVsOaNrgogICAgICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHsKICAgICAgICAgICAgdGl0bGU6IGVkaXREb2N1bWVudEZvcm0udmFsdWUudGl0bGUsCiAgICAgICAgICAgIHR5cGU6IGVkaXREb2N1bWVudEZvcm0udmFsdWUudHlwZSB8fCAn6YCa55SoJywKICAgICAgICAgICAgY2F0ZWdvcnlfaWQ6IGVkaXREb2N1bWVudEZvcm0udmFsdWUuY2F0ZWdvcnlfaWQKICAgICAgICAgIH07CgogICAgICAgICAgLy8g6LCD55SoQVBJ5pu05paw5paH5qGjCiAgICAgICAgICBhd2FpdCB1cGRhdGVEb2N1bWVudChlZGl0RG9jdW1lbnRGb3JtLnZhbHVlLmlkLCB1cGRhdGVEYXRhKTsKICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCfmlofmoaPmm7TmlrDmiJDlip8nKTsKICAgICAgICAgIGVkaXREaWFsb2dWaXNpYmxlLnZhbHVlID0gZmFsc2U7CgogICAgICAgICAgLy8g5by65Yi25Yi35paw5omA5pyJ5pWw5o2u5Lul56Gu5L+d6KeG5Zu+5ZCM5q2lCiAgICAgICAgICBhd2FpdCByZWxvYWRBbGxEYXRhKCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+abtOaWsOaWh+aho+Wksei0pScsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+abtOaWsOaWh+aho+Wksei0pScpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGVkaXRMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgIH0KICAgIH07CiAgICBjb25zdCBleHBvcnREb2N1bWVudCA9IGRvYyA9PiB7CiAgICAgIEVsTWVzc2FnZUJveCh7CiAgICAgICAgdGl0bGU6ICflr7zlh7rmlofmoaMnLAogICAgICAgIG1lc3NhZ2U6ICfor7fpgInmi6nlr7zlh7rmoLzlvI8nLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICflr7zlh7rkuLpQREYnLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICflr7zlh7rkuLpXb3JkJywKICAgICAgICBjbG9zZU9uQ2xpY2tNb2RhbDogdHJ1ZSwKICAgICAgICBjYWxsYmFjazogYWN0aW9uID0+IHsKICAgICAgICAgIGlmIChhY3Rpb24gPT09ICdjb25maXJtJykgewogICAgICAgICAgICBleHBvcnRUb1BkZihkb2MpOwogICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdjYW5jZWwnKSB7CiAgICAgICAgICAgIGV4cG9ydFRvV29yZChkb2MpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIC8vIOWvvOWHuuS4ulBERgogICAgY29uc3QgZXhwb3J0VG9QZGYgPSBhc3luYyBkb2MgPT4gewogICAgICBpZiAoIWRvYykgewogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5rKh5pyJ5Y+v5a+85Ye655qE5paH5qGjJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyDlhYjojrflj5bmlofmoaPor6bmg4XlhoXlrrkKICAgICAgY29uc3QgbG9hZGluZyA9IEVsTG9hZGluZy5zZXJ2aWNlKHsKICAgICAgICBsb2NrOiB0cnVlLAogICAgICAgIHRleHQ6ICfmraPlnKjliqDovb3mlofmoaPlhoXlrrkuLi4nLAogICAgICAgIGJhY2tncm91bmQ6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNyknCiAgICAgIH0pOwogICAgICB0cnkgewogICAgICAgIC8vIOiOt+WPluaWh+aho+ivpuaDhQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0RG9jdW1lbnREZXRhaWwoZG9jLmlkKTsKICAgICAgICBjb25zdCBkb2N1bWVudENvbnRlbnQgPSByZXNwb25zZS5kYXRhLmNvbnRlbnQ7CiAgICAgICAgaWYgKCFkb2N1bWVudENvbnRlbnQpIHsKICAgICAgICAgIGxvYWRpbmcuY2xvc2UoKTsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5paH5qGj5YaF5a655Li656m677yM5peg5rOV5a+85Ye6Jyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGRvY1RpdGxlID0gZG9jLnRpdGxlIHx8ICfmnKrlkb3lkI3mlofmoaMnOwogICAgICAgIGNvbnN0IGZpbGVuYW1lID0gYCR7ZG9jVGl0bGV9LnBkZmA7CgogICAgICAgIC8vIOWIm+W7uuS4tOaXtuWuueWZqOeUqOS6juWvvOWHugogICAgICAgIGNvbnN0IHRlbXBDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB0ZW1wQ29udGFpbmVyLmlubmVySFRNTCA9IGRvY3VtZW50Q29udGVudDsKICAgICAgICB0ZW1wQ29udGFpbmVyLmNsYXNzTmFtZSA9ICd0ZW1wLWV4cG9ydC1jb250YWluZXInOwogICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGVtcENvbnRhaW5lcik7CiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgICAgIG1hcmdpbjogWzE1LCAxNSwgMTUsIDE1XSwKICAgICAgICAgIGZpbGVuYW1lOiBmaWxlbmFtZSwKICAgICAgICAgIGltYWdlOiB7CiAgICAgICAgICAgIHR5cGU6ICdqcGVnJywKICAgICAgICAgICAgcXVhbGl0eTogMC45OAogICAgICAgICAgfSwKICAgICAgICAgIGh0bWwyY2FudmFzOiB7CiAgICAgICAgICAgIHNjYWxlOiAyLAogICAgICAgICAgICB1c2VDT1JTOiB0cnVlCiAgICAgICAgICB9LAogICAgICAgICAganNQREY6IHsKICAgICAgICAgICAgdW5pdDogJ21tJywKICAgICAgICAgICAgZm9ybWF0OiAnYTQnLAogICAgICAgICAgICBvcmllbnRhdGlvbjogJ3BvcnRyYWl0JwogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIC8vIOabtOaWsOWKoOi9veaPkOekugogICAgICAgIGxvYWRpbmcuc2V0VGV4dCgn5q2j5Zyo55Sf5oiQUERGLi4uJyk7CgogICAgICAgIC8vIOWKqOaAgeWvvOWFpWh0bWwycGRmLmpzCiAgICAgICAgY29uc3QgaHRtbDJwZGZNb2R1bGUgPSBhd2FpdCBpbXBvcnQoJ2h0bWwycGRmLmpzJyk7CiAgICAgICAgY29uc3QgaHRtbDJwZGYgPSBodG1sMnBkZk1vZHVsZS5kZWZhdWx0OwogICAgICAgIGF3YWl0IGh0bWwycGRmKCkuZnJvbSh0ZW1wQ29udGFpbmVyKS5zZXQob3B0aW9ucykuc2F2ZSgpOwoKICAgICAgICAvLyDmuIXnkIbkuLTml7blhYPntKAKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRlbXBDb250YWluZXIpOwogICAgICAgIGxvYWRpbmcuY2xvc2UoKTsKICAgICAgICBFbE1lc3NhZ2Uuc3VjY2VzcygnUERG5a+85Ye65oiQ5YqfJyk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignUERG5a+85Ye65aSx6LSlOicsIGVycm9yKTsKICAgICAgICBsb2FkaW5nLmNsb3NlKCk7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCdQREblr7zlh7rlpLHotKU6ICcgKyAoZXJyb3IubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJykpOwogICAgICB9CiAgICB9OwoKICAgIC8vIOWvvOWHuuS4uldvcmTvvIjkv53nlZnlm77niYfvvIkKICAgIGNvbnN0IGV4cG9ydFRvV29yZCA9IGFzeW5jIGRvYyA9PiB7CiAgICAgIGlmICghZG9jKSB7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfmsqHmnInlj6/lr7zlh7rnmoTmlofmoaMnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgbG9hZGluZyA9IEVsTG9hZGluZy5zZXJ2aWNlKHsKICAgICAgICBsb2NrOiB0cnVlLAogICAgICAgIHRleHQ6ICfmraPlnKjliqDovb3mlofmoaPlhoXlrrkuLi4nLAogICAgICAgIGJhY2tncm91bmQ6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNyknCiAgICAgIH0pOwogICAgICB0cnkgewogICAgICAgIC8vIOiOt+WPluaWh+aho+ivpuaDhQogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0RG9jdW1lbnREZXRhaWwoZG9jLmlkKTsKICAgICAgICBjb25zdCBkb2N1bWVudENvbnRlbnQgPSByZXNwb25zZS5kYXRhLmNvbnRlbnQ7CiAgICAgICAgaWYgKCFkb2N1bWVudENvbnRlbnQpIHsKICAgICAgICAgIGxvYWRpbmcuY2xvc2UoKTsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5paH5qGj5YaF5a655Li656m677yM5peg5rOV5a+85Ye6Jyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGRvY1RpdGxlID0gZG9jLnRpdGxlIHx8ICfmnKrlkb3lkI3mlofmoaMnOwogICAgICAgIGNvbnN0IGZpbGVuYW1lID0gYCR7ZG9jVGl0bGV9LmRvY2A7CgogICAgICAgIC8vIOWIm+W7uuS4gOS4quS4tOaXtuaWh+aho+WuueWZqOWkhOeQhuWGheWuuQogICAgICAgIGNvbnN0IGNvbnRlbnRDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBjb250ZW50Q29udGFpbmVyLmlubmVySFRNTCA9IGRvY3VtZW50Q29udGVudDsKCiAgICAgICAgLy8g5pu05paw5Yqg6L295o+Q56S6CiAgICAgICAgbG9hZGluZy5zZXRUZXh0KCfmraPlnKjnlJ/miJBXb3Jk5paH5qGjLi4uJyk7CgogICAgICAgIC8vIOWIm+W7uuW+rui9r1dvcmTlhbzlrrnnmoRIVE1M5paH5qGjCiAgICAgICAgY29uc3QgbXNXb3JkSHRtbCA9IGAKICAgICAgICAgIDxodG1sIHhtbG5zOm89InVybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206b2ZmaWNlOm9mZmljZSIgCiAgICAgICAgICAgICAgICB4bWxuczp3PSJ1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOm9mZmljZTp3b3JkIiAKICAgICAgICAgICAgICAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy9UUi9SRUMtaHRtbDQwIj4KICAgICAgICAgIDxoZWFkPgogICAgICAgICAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICAgICAgICAgIDx0aXRsZT4ke2RvY1RpdGxlfTwvdGl0bGU+CiAgICAgICAgICAgIDxzdHlsZT4KICAgICAgICAgICAgICBib2R5IHsgZm9udC1mYW1pbHk6IFNpbVN1biwgQXJpYWwsIHNhbnMtc2VyaWY7IG1hcmdpbjogMWNtOyB9CiAgICAgICAgICAgICAgaW1nIHsgbWF4LXdpZHRoOiAxMDAlOyBoZWlnaHQ6IGF1dG87IH0KICAgICAgICAgICAgICBwIHsgbWFyZ2luOiAwOyBwYWRkaW5nOiAwOyB9CiAgICAgICAgICAgICAgaDEgeyBmb250LXNpemU6IDE4cHQ7IH0KICAgICAgICAgICAgICBoMiB7IGZvbnQtc2l6ZTogMTZwdDsgfQogICAgICAgICAgICAgIGgzIHsgZm9udC1zaXplOiAxNHB0OyB9CiAgICAgICAgICAgICAgdGFibGUgeyBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOyB3aWR0aDogMTAwJTsgfQogICAgICAgICAgICAgIHRkLCB0aCB7IGJvcmRlcjogMXB4IHNvbGlkICMwMDA7IHBhZGRpbmc6IDVweDsgfQogICAgICAgICAgICA8L3N0eWxlPgogICAgICAgICAgPC9oZWFkPgogICAgICAgICAgPGJvZHk+CiAgICAgICAgICAgIDxoMT4ke2RvY1RpdGxlfTwvaDE+CiAgICAgICAgICAgICR7Y29udGVudENvbnRhaW5lci5pbm5lckhUTUx9CiAgICAgICAgICA8L2JvZHk+CiAgICAgICAgICA8L2h0bWw+CiAgICAgICAgYDsKCiAgICAgICAgLy8g5L2/55SoZmlsZS1zYXZlcuS/neWtmOaWh+S7tgogICAgICAgIGNvbnN0IEZpbGVTYXZlciA9IGF3YWl0IGltcG9ydCgnZmlsZS1zYXZlcicpOwogICAgICAgIGNvbnN0IHNhdmVBcyA9IEZpbGVTYXZlci5zYXZlQXMgfHwgRmlsZVNhdmVyLmRlZmF1bHQ7CiAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFttc1dvcmRIdG1sXSwgewogICAgICAgICAgdHlwZTogJ2FwcGxpY2F0aW9uL21zd29yZCcKICAgICAgICB9KTsKICAgICAgICBzYXZlQXMoYmxvYiwgZmlsZW5hbWUpOwogICAgICAgIGxvYWRpbmcuY2xvc2UoKTsKICAgICAgICBFbE1lc3NhZ2Uuc3VjY2VzcygnV29yZOaWh+aho+WvvOWHuuaIkOWKnycpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ1dvcmTlr7zlh7rlpLHotKU6JywgZXJyb3IpOwogICAgICAgIGxvYWRpbmcuY2xvc2UoKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoYFdvcmTlr7zlh7rlpLHotKU6ICR7ZXJyb3IubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJ31gKTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHNoYXJlRG9jdW1lbnQgPSBhc3luYyBkb2MgPT4gewogICAgICBzZWxlY3RlZERvY3VtZW50LnZhbHVlID0gZG9jOwogICAgICBzaGFyZUxvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICB0cnkgewogICAgICAgIGNvbnNvbGUubG9nKCfojrflj5bmlofmoaPor6bmg4XvvIxJRDonLCBkb2MuaWQpOwogICAgICAgIC8vIEZldGNoIGRvY3VtZW50IGRldGFpbHMgdG8gZ2V0IGV4aXN0aW5nIHBlcm1pc3Npb25zCiAgICAgICAgY29uc3QgZGV0YWlsUmVzID0gYXdhaXQgZ2V0RG9jdW1lbnREZXRhaWwoZG9jLmlkKTsKICAgICAgICBjb25zb2xlLmxvZygn5paH5qGj6K+m5oOF5ZON5bqUOicsIGRldGFpbFJlcyk7CgogICAgICAgIC8vIOWwneivleS7juS4jeWQjOWPr+iDveeahOWTjeW6lOe7k+aehOS4reaPkOWPlnNoYXJlZF93aXRo5pWw5o2uCiAgICAgICAgbGV0IHNoYXJlZFdpdGhEYXRhID0gW107CiAgICAgICAgaWYgKGRldGFpbFJlcyAmJiBkZXRhaWxSZXMuZGF0YSkgewogICAgICAgICAgaWYgKGRldGFpbFJlcy5kYXRhLnNoYXJlZF93aXRoICYmIEFycmF5LmlzQXJyYXkoZGV0YWlsUmVzLmRhdGEuc2hhcmVkX3dpdGgpKSB7CiAgICAgICAgICAgIHNoYXJlZFdpdGhEYXRhID0gZGV0YWlsUmVzLmRhdGEuc2hhcmVkX3dpdGg7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfku45kYXRhLnNoYXJlZF93aXRo5o+Q5Y+W5YWx5Lqr55So5oi3OicsIHNoYXJlZFdpdGhEYXRhKTsKICAgICAgICAgIH0gZWxzZSBpZiAoZGV0YWlsUmVzLmRhdGEucGVybWlzc2lvbnMgJiYgQXJyYXkuaXNBcnJheShkZXRhaWxSZXMuZGF0YS5wZXJtaXNzaW9ucykpIHsKICAgICAgICAgICAgc2hhcmVkV2l0aERhdGEgPSBkZXRhaWxSZXMuZGF0YS5wZXJtaXNzaW9uczsKICAgICAgICAgICAgY29uc29sZS5sb2coJ+S7jmRhdGEucGVybWlzc2lvbnPmj5Dlj5blhbHkuqvnlKjmiLc6Jywgc2hhcmVkV2l0aERhdGEpOwogICAgICAgICAgfSBlbHNlIGlmIChkZXRhaWxSZXMuc2hhcmVkX3dpdGggJiYgQXJyYXkuaXNBcnJheShkZXRhaWxSZXMuc2hhcmVkX3dpdGgpKSB7CiAgICAgICAgICAgIHNoYXJlZFdpdGhEYXRhID0gZGV0YWlsUmVzLnNoYXJlZF93aXRoOwogICAgICAgICAgICBjb25zb2xlLmxvZygn5LuO55u05o6l55qEc2hhcmVkX3dpdGjmj5Dlj5blhbHkuqvnlKjmiLc6Jywgc2hhcmVkV2l0aERhdGEpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g5aSE55CG5LiN5ZCM5qC85byP55qE55So5oi35pWw5o2uCiAgICAgICAgaWYgKHNoYXJlZFdpdGhEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGV4aXN0aW5nU2hhcmVkVXNlcnMudmFsdWUgPSBzaGFyZWRXaXRoRGF0YS5tYXAoaXRlbSA9PiB7CiAgICAgICAgICAgIC8vIOWkhOeQhuWPr+iDveeahOS4jeWQjOaVsOaNrue7k+aehAogICAgICAgICAgICBpZiAoaXRlbS51c2VyICYmIChpdGVtLnVzZXIuaWQgfHwgaXRlbS51c2VyLnVzZXJfaWQpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHVzZXJfaWQ6IGl0ZW0udXNlci5pZCB8fCBpdGVtLnVzZXIudXNlcl9pZCwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBpdGVtLnVzZXIudXNlcm5hbWUgfHwgaXRlbS51c2VyLm5hbWUgfHwgaXRlbS51c2VyLmVtYWlsIHx8IGDnlKjmiLcke2l0ZW0udXNlci5pZH1gLAogICAgICAgICAgICAgICAgcGVybWlzc2lvbjogaXRlbS5wZXJtaXNzaW9uIHx8ICdlZGl0JwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXRlbS51c2VyX2lkIHx8IGl0ZW0udXNlcklkKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHVzZXJfaWQ6IGl0ZW0udXNlcl9pZCB8fCBpdGVtLnVzZXJJZCwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBpdGVtLnVzZXJuYW1lIHx8IGl0ZW0ubmFtZSB8fCBpdGVtLmVtYWlsIHx8IGDnlKjmiLcke2l0ZW0udXNlcl9pZCB8fCBpdGVtLnVzZXJJZH1gLAogICAgICAgICAgICAgICAgcGVybWlzc2lvbjogaXRlbS5wZXJtaXNzaW9uIHx8ICdlZGl0JwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g6buY6K6k5oOF5Ya177yM5bCd6K+V5L2/55SoaXRlbeacrOi6qwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHVzZXJfaWQ6IGl0ZW0uaWQgfHwgaXRlbS51c2VyX2lkIHx8IDAsCiAgICAgICAgICAgICAgdXNlcm5hbWU6IGl0ZW0udXNlcm5hbWUgfHwgaXRlbS5uYW1lIHx8IGl0ZW0uZW1haWwgfHwgJ+acquefpeeUqOaItycsCiAgICAgICAgICAgICAgcGVybWlzc2lvbjogaXRlbS5wZXJtaXNzaW9uIHx8ICdlZGl0JwogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCfmsqHmnInmib7liLDlt7LliIbkuqvnlKjmiLfmlbDmja4nKTsKICAgICAgICAgIGV4aXN0aW5nU2hhcmVkVXNlcnMudmFsdWUgPSBbXTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coJ+WkhOeQhuWQjueahOW3suWIhuS6q+eUqOaIt+WIl+ihqDonLCBleGlzdGluZ1NoYXJlZFVzZXJzLnZhbHVlKTsKICAgICAgICBjb25zdCBleGlzdGluZ1VzZXJJZHMgPSBuZXcgU2V0KGV4aXN0aW5nU2hhcmVkVXNlcnMudmFsdWUubWFwKHUgPT4gdS51c2VyX2lkKSk7CiAgICAgICAgY29uc29sZS5sb2coJ+W3suWIhuS6q+eUqOaIt0lE6ZuG5ZCIOicsIEFycmF5LmZyb20oZXhpc3RpbmdVc2VySWRzKSk7CgogICAgICAgIC8vIEdldCBjdXJyZW50IHVzZXIgYW5kIGNvbXBhbnkgaW5mbwogICAgICAgIGNvbnN0IGN1cnJlbnRVc2VySnNvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VyJyk7CiAgICAgICAgbGV0IGN1cnJlbnRVc2VySWQgPSBudWxsOwogICAgICAgIGxldCBjb21wYW55SWQgPSBudWxsOwogICAgICAgIGlmIChjdXJyZW50VXNlckpzb24pIHsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gSlNPTi5wYXJzZShjdXJyZW50VXNlckpzb24pOwogICAgICAgICAgY3VycmVudFVzZXJJZCA9IGN1cnJlbnRVc2VyLmlkOwogICAgICAgICAgY29tcGFueUlkID0gY3VycmVudFVzZXIuY29tcGFueV9pZDsKICAgICAgICAgIGNvbnNvbGUubG9nKCflvZPliY3nlKjmiLdJRDonLCBjdXJyZW50VXNlcklkLCAn5YWs5Y+4SUQ6JywgY29tcGFueUlkKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgaXNDcmVhdG9yID0gZG9jLmNyZWF0b3IgJiYgY3VycmVudFVzZXJJZCAmJiBkb2MuY3JlYXRvci5pZCA9PT0gY3VycmVudFVzZXJJZDsKICAgICAgICBzaGFyZU1vZGUudmFsdWUgPSBpc0NyZWF0b3IgPyAncGVybWlzc2lvbicgOiAnY2hhdCc7CiAgICAgICAgY29uc29sZS5sb2coJ+aYr+WQpuS4uuWIm+W7uuiAhTonLCBpc0NyZWF0b3IsICfliIbkuqvmqKHlvI86Jywgc2hhcmVNb2RlLnZhbHVlKTsKCiAgICAgICAgLy8gRmV0Y2ggYWxsIGNvbXBhbnkgdXNlcnMKICAgICAgICBjb25zdCB1c2Vyc1JlcyA9IGF3YWl0IHVzZXJBcGkuZ2V0Q29tcGFueVVzZXJzKCk7CiAgICAgICAgY29uc29sZS5sb2coJ+WFrOWPuOeUqOaIt+WIl+ihqOWTjeW6lDonLCB1c2Vyc1Jlcyk7CiAgICAgICAgaWYgKHVzZXJzUmVzLnN1Y2Nlc3MgJiYgQXJyYXkuaXNBcnJheSh1c2Vyc1Jlcy5kYXRhKSkgewogICAgICAgICAgLy8g5p2D6ZmQ5qih5byP5LiL55qE55So5oi35YiX6KGo77yI5o6S6Zmk5bey5pyJ5p2D6ZmQ55qE55So5oi377yJCiAgICAgICAgICBhdmFpbGFibGVVc2Vycy52YWx1ZSA9IHVzZXJzUmVzLmRhdGEuZmlsdGVyKHVzZXIgPT4gdXNlci5pZCAhPT0gY3VycmVudFVzZXJJZCAmJiAoIWNvbXBhbnlJZCB8fCB1c2VyLmNvbXBhbnlfaWQgPT09IGNvbXBhbnlJZCkgJiYgIWV4aXN0aW5nVXNlcklkcy5oYXModXNlci5pZCkgLy8g5o6S6Zmk5bey5pyJ5p2D6ZmQ55qE55So5oi3CiAgICAgICAgICApLm1hcCh1c2VyID0+ICh7CiAgICAgICAgICAgIGlkOiB1c2VyLmlkLAogICAgICAgICAgICB1c2VybmFtZTogdXNlci5uYW1lIHx8IHVzZXIudXNlcm5hbWUgfHwgdXNlci5lbWFpbCB8fCBg55So5oi3JHt1c2VyLmlkfWAKICAgICAgICAgIH0pKTsKCiAgICAgICAgICAvLyDogYrlpKnmqKHlvI/kuIvnmoTnlKjmiLfliJfooajvvIjljIXlkKvmiYDmnInnlKjmiLfvvIzljIXmi6zlt7LmnInmnYPpmZDnmoTnlKjmiLfvvIkKICAgICAgICAgIGF2YWlsYWJsZUNoYXRVc2Vycy52YWx1ZSA9IHVzZXJzUmVzLmRhdGEuZmlsdGVyKHVzZXIgPT4gdXNlci5pZCAhPT0gY3VycmVudFVzZXJJZCAmJiAoIWNvbXBhbnlJZCB8fCB1c2VyLmNvbXBhbnlfaWQgPT09IGNvbXBhbnlJZCkKICAgICAgICAgIC8vIOS4jeaOkumZpOW3suacieadg+mZkOeahOeUqOaItwogICAgICAgICAgKS5tYXAodXNlciA9PiAoewogICAgICAgICAgICBpZDogdXNlci5pZCwKICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXIubmFtZSB8fCB1c2VyLnVzZXJuYW1lIHx8IHVzZXIuZW1haWwgfHwgYOeUqOaItyR7dXNlci5pZH1gCiAgICAgICAgICB9KSk7CiAgICAgICAgICBjb25zb2xlLmxvZygn5o6I5p2D5qih5byP5Y+v6YCJ55So5oi35YiX6KGoOicsIGF2YWlsYWJsZVVzZXJzLnZhbHVlKTsKICAgICAgICAgIGNvbnNvbGUubG9nKCfogYrlpKnmqKHlvI/lj6/pgInnlKjmiLfliJfooag6JywgYXZhaWxhYmxlQ2hhdFVzZXJzLnZhbHVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCfojrflj5blhazlj7jnlKjmiLfliJfooajlpLHotKU6JywgdXNlcnNSZXMpOwogICAgICAgICAgYXZhaWxhYmxlVXNlcnMudmFsdWUgPSBbXTsKICAgICAgICAgIGF2YWlsYWJsZUNoYXRVc2Vycy52YWx1ZSA9IFtdOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfmiZPlvIDliIbkuqvlr7nor53moYblpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign6I635Y+W5YiG5Lqr5L+h5oGv5aSx6LSlJyk7CiAgICAgICAgZXhpc3RpbmdTaGFyZWRVc2Vycy52YWx1ZSA9IFtdOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHNoYXJlTG9hZGluZy52YWx1ZSA9IGZhbHNlOwoKICAgICAgICAvLyBSZXNldCB2YXJpYWJsZXMgZm9yIGFkZGluZyBuZXcgdXNlcnMKICAgICAgICBzaGFyZUZvcm1hdC52YWx1ZSA9ICdwZGYnOwogICAgICAgIHNlbGVjdGVkVXNlcnMudmFsdWUgPSBbXTsKICAgICAgICBzZWxlY3RlZFVzZXJzV2l0aFBlcm1pc3Npb25zLnZhbHVlID0gW107CiAgICAgICAgc2VsZWN0ZWRDaGF0VXNlcnMudmFsdWUgPSBbXTsKICAgICAgICBzaGFyZURpYWxvZ1Zpc2libGUudmFsdWUgPSB0cnVlOwogICAgICB9CiAgICB9OwoKICAgIC8vIOmAmui/h0lE6I635Y+W55So5oi35ZCNCiAgICBjb25zdCBnZXRVc2VybmFtZUJ5SWQgPSB1c2VySWQgPT4gewogICAgICBjb25zdCB1c2VyID0gYXZhaWxhYmxlVXNlcnMudmFsdWUuZmluZCh1ID0+IHUuaWQgPT09IHVzZXJJZCk7CiAgICAgIHJldHVybiB1c2VyID8gdXNlci51c2VybmFtZSA6ICfmnKrnn6XnlKjmiLcnOwogICAgfTsKCiAgICAvLyDojrflj5blvZPliY3nlKjmiLdJRAogICAgY29uc3QgZ2V0Q3VycmVudFVzZXJJZCA9ICgpID0+IHsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBjdXJyZW50VXNlckpzb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlcicpOwogICAgICAgIGlmIChjdXJyZW50VXNlckpzb24pIHsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gSlNPTi5wYXJzZShjdXJyZW50VXNlckpzb24pOwogICAgICAgICAgcmV0dXJuIGN1cnJlbnRVc2VyLmlkOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5blvZPliY3nlKjmiLdJROWksei0pTonLCBlcnJvcik7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH07CgogICAgLy8g5aSE55CG55So5oi36YCJ5oup5Y+Y5YyWCiAgICBjb25zdCBoYW5kbGVVc2VyU2VsZWN0aW9uQ2hhbmdlID0gdmFsID0+IHsKICAgICAgY29uc29sZS5sb2coJ+mAieaLqeWPmOWMliAtIOWOn+Wni+WAvDonLCB2YWwpOwogICAgICBjb25zb2xlLmxvZygn6YCJ5oup5Y+Y5YyWIC0gc2VsZWN0ZWRVc2VyczonLCBzZWxlY3RlZFVzZXJzLnZhbHVlKTsKICAgICAgY29uc29sZS5sb2coJ+mAieaLqeWPmOWMliAtIOexu+WeizonLCB0eXBlb2Ygc2VsZWN0ZWRVc2Vycy52YWx1ZSwgQXJyYXkuaXNBcnJheShzZWxlY3RlZFVzZXJzLnZhbHVlKSk7CgogICAgICAvLyDnoa7kv51zZWxlY3RlZFVzZXJz5piv5pWw57uECiAgICAgIGlmICghQXJyYXkuaXNBcnJheShzZWxlY3RlZFVzZXJzLnZhbHVlKSkgewogICAgICAgIGNvbnNvbGUud2Fybignc2VsZWN0ZWRVc2Vyc+S4jeaYr+aVsOe7hO+8jOW8uuWItui9rOaNouS4uuaVsOe7hCcpOwogICAgICAgIHNlbGVjdGVkVXNlcnMudmFsdWUgPSBBcnJheS5pc0FycmF5KHZhbCkgPyB2YWwgOiBbXTsKICAgICAgfQoKICAgICAgLy8g5pu05paw5p2D6ZmQ5o6n5Yi25pWw57uECiAgICAgIHNlbGVjdGVkVXNlcnNXaXRoUGVybWlzc2lvbnMudmFsdWUgPSBzZWxlY3RlZFVzZXJzLnZhbHVlLm1hcCh1c2VySWQgPT4gewogICAgICAgIGNvbnNvbGUubG9nKCflpITnkIbnlKjmiLdJRDonLCB1c2VySWQsICfnsbvlnos6JywgdHlwZW9mIHVzZXJJZCk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCwKICAgICAgICAgIHBlcm1pc3Npb246ICdlZGl0JyAvLyDpu5jorqTkuLrlj6ror7vmnYPpmZAKICAgICAgICB9OwogICAgICB9KTsKICAgICAgY29uc29sZS5sb2coJ+eUqOaIt+mAieaLqeWPmOWMlu+8jOW3sumAieaLqeeUqOaItzonLCBzZWxlY3RlZFVzZXJzLnZhbHVlKTsKICAgICAgY29uc29sZS5sb2coJ+eUqOaIt+adg+mZkOaVsOe7hDonLCBzZWxlY3RlZFVzZXJzV2l0aFBlcm1pc3Npb25zLnZhbHVlKTsKICAgIH07CgogICAgLy8g5aSE55CG5YiG5Lqr5qih5byP5Y+Y5YyWCiAgICBjb25zdCBoYW5kbGVTaGFyZU1vZGVDaGFuZ2UgPSAoKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCfliIbkuqvmqKHlvI/lj5jmm7TkuLo6Jywgc2hhcmVNb2RlLnZhbHVlKTsKICAgICAgLy8g5YiH5o2i5YiG5Lqr5qih5byP5pe25riF56m65LmL5YmN6YCJ5oup55qE55So5oi3CiAgICAgIGlmIChzaGFyZU1vZGUudmFsdWUgPT09ICdwZXJtaXNzaW9uJykgewogICAgICAgIC8vIOWIh+aNouWIsOadg+mZkOaooeW8j++8jOa4heepuuiBiuWkqeebuOWFs+eahOmAieaLqQogICAgICAgIHNlbGVjdGVkQ2hhdFVzZXJzLnZhbHVlID0gW107CiAgICAgICAgY29uc29sZS5sb2coJ+W3sua4heepuuiBiuWkqeeUqOaIt+mAieaLqScpOwogICAgICB9IGVsc2UgaWYgKHNoYXJlTW9kZS52YWx1ZSA9PT0gJ2NoYXQnKSB7CiAgICAgICAgLy8g5YiH5o2i5Yiw6IGK5aSp5qih5byP77yM5riF56m65p2D6ZmQ55u45YWz55qE6YCJ5oupCiAgICAgICAgc2VsZWN0ZWRVc2Vycy52YWx1ZSA9IFtdOwogICAgICAgIHNlbGVjdGVkVXNlcnNXaXRoUGVybWlzc2lvbnMudmFsdWUgPSBbXTsKICAgICAgICBjb25zb2xlLmxvZygn5bey5riF56m65p2D6ZmQ55So5oi36YCJ5oupJyk7CiAgICAgIH0KICAgIH07CiAgICBjb25zdCBjb25maXJtU2hhcmUgPSBhc3luYyAoKSA9PiB7CiAgICAgIC8vIOadg+mZkOWIhuS6q+aWueW8jwogICAgICBpZiAoc2hhcmVNb2RlLnZhbHVlID09PSAncGVybWlzc2lvbicpIHsKICAgICAgICAvLyDmo4Dmn6XmmK/lkKbkuLrmlofmoaPliJvlu7rogIUKICAgICAgICBjb25zdCBjdXJyZW50VXNlcklkID0gZ2V0Q3VycmVudFVzZXJJZCgpOwogICAgICAgIGNvbnN0IGlzQ3JlYXRvciA9IHNlbGVjdGVkRG9jdW1lbnQudmFsdWUgJiYgc2VsZWN0ZWREb2N1bWVudC52YWx1ZS5jcmVhdG9yICYmIGN1cnJlbnRVc2VySWQgJiYgc2VsZWN0ZWREb2N1bWVudC52YWx1ZS5jcmVhdG9yLmlkID09PSBjdXJyZW50VXNlcklkOwogICAgICAgIGlmICghaXNDcmVhdG9yKSB7CiAgICAgICAgICBFbE1lc3NhZ2Uud2FybmluZygn5Y+q5pyJ5paH5qGj5Yib5bu66ICF5omN6IO95o6I5LqI5p2D6ZmQJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGZpbmFsUGVybWlzc2lvbnMgPSBbLi4uZXhpc3RpbmdTaGFyZWRVc2Vycy52YWx1ZS5tYXAodSA9PiAoewogICAgICAgICAgdXNlcl9pZDogdS51c2VyX2lkLAogICAgICAgICAgcGVybWlzc2lvbjogJ2VkaXQnCiAgICAgICAgfSkpLCAuLi5zZWxlY3RlZFVzZXJzV2l0aFBlcm1pc3Npb25zLnZhbHVlXTsKICAgICAgICBzaGFyZUxvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICAgIHRyeSB7CiAgICAgICAgICBhd2FpdCBhcGlTaGFyZURvY3VtZW50KHNlbGVjdGVkRG9jdW1lbnQudmFsdWUuaWQsIGZpbmFsUGVybWlzc2lvbnMpOwogICAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+adg+mZkOabtOaWsOaIkOWKnycpOwogICAgICAgICAgc2hhcmVEaWFsb2dWaXNpYmxlLnZhbHVlID0gZmFsc2U7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIhuS6q+aWh+aho+Wksei0pScsIGVycm9yKTsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5p2D6ZmQ5pu05paw5aSx6LSlJyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIHNoYXJlTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICAvLyDogYrlpKnliIbkuqvmlrnlvI8KICAgICAgZWxzZSBpZiAoc2hhcmVNb2RlLnZhbHVlID09PSAnY2hhdCcpIHsKICAgICAgICBpZiAoIXNlbGVjdGVkRG9jdW1lbnQudmFsdWUgfHwgc2VsZWN0ZWRDaGF0VXNlcnMudmFsdWUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBFbE1lc3NhZ2Uud2FybmluZygn6K+36YCJ5oup6Iez5bCR5LiA5Liq5o6l5pS255So5oi3Jyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHNoYXJlTG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIC8vIOiOt+WPluW9k+WJjeeUqOaIt+S/oeaBrwogICAgICAgICAgY29uc3QgY3VycmVudFVzZXJKc29uID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXInKTsKICAgICAgICAgIGxldCBjdXJyZW50VXNlcklkID0gbnVsbDsKICAgICAgICAgIGlmIChjdXJyZW50VXNlckpzb24pIHsKICAgICAgICAgICAgY29uc3QgY3VycmVudFVzZXIgPSBKU09OLnBhcnNlKGN1cnJlbnRVc2VySnNvbik7CiAgICAgICAgICAgIGN1cnJlbnRVc2VySWQgPSBjdXJyZW50VXNlci5pZDsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghY3VycmVudFVzZXJJZCkgewogICAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+aXoOazleiOt+WPluW9k+WJjeeUqOaIt+S/oeaBrycpOwogICAgICAgICAgICBzaGFyZUxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOmcgOimgeiOt+WPluaWh+aho+WGheWuuQogICAgICAgICAgY29uc3QgZG9jUmVzcG9uc2UgPSBhd2FpdCBnZXREb2N1bWVudERldGFpbChzZWxlY3RlZERvY3VtZW50LnZhbHVlLmlkKTsKICAgICAgICAgIGNvbnN0IGN1cnJlbnREb2MgPSBkb2NSZXNwb25zZS5kYXRhOwogICAgICAgICAgaWYgKCFjdXJyZW50RG9jIHx8ICFjdXJyZW50RG9jLmNvbnRlbnQpIHsKICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfml6Dms5Xojrflj5bmlofmoaPlhoXlrrknKTsKICAgICAgICAgICAgc2hhcmVMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyDkvb/nlKjliY3nq6/lr7zlh7rmlofku7bnmoTmlrnlvI/ojrflj5bmlofku7YKICAgICAgICAgIGNvbnN0IGxvYWRpbmcgPSBFbExvYWRpbmcuc2VydmljZSh7CiAgICAgICAgICAgIGxvY2s6IHRydWUsCiAgICAgICAgICAgIHRleHQ6IGDmraPlnKjlh4blpIcke3NoYXJlRm9ybWF0LnZhbHVlID09PSAncGRmJyA/ICdQREYnIDogJ1dvcmQnfeaWh+S7ti4uLmAsCiAgICAgICAgICAgIGJhY2tncm91bmQ6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNyknCiAgICAgICAgICB9KTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIOWHhuWkh+aWh+aho+WGheWuuQogICAgICAgICAgICBjb25zdCBkb2NUaXRsZSA9IGN1cnJlbnREb2MudGl0bGUgfHwgJ+acquWRveWQjeaWh+ahoyc7CiAgICAgICAgICAgIGNvbnN0IGRvY3VtZW50Q29udGVudCA9IGN1cnJlbnREb2MuY29udGVudDsKCiAgICAgICAgICAgIC8vIOWIm+W7uuS4tOaXtuWuueWZqOeUqOS6juWvvOWHugogICAgICAgICAgICBjb25zdCB0ZW1wQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHRlbXBDb250YWluZXIuaW5uZXJIVE1MID0gZG9jdW1lbnRDb250ZW50OwogICAgICAgICAgICB0ZW1wQ29udGFpbmVyLmNsYXNzTmFtZSA9ICd0ZW1wLWV4cG9ydC1jb250YWluZXInOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRlbXBDb250YWluZXIpOwogICAgICAgICAgICBsZXQgZG9jdW1lbnRGaWxlID0gbnVsbDsKICAgICAgICAgICAgbGV0IGZpbGVOYW1lID0gZG9jVGl0bGU7CiAgICAgICAgICAgIGxldCBmaWxlVHlwZSA9ICcnOwogICAgICAgICAgICBpZiAoc2hhcmVGb3JtYXQudmFsdWUgPT09ICdwZGYnKSB7CiAgICAgICAgICAgICAgZmlsZU5hbWUgKz0gJy5wZGYnOwogICAgICAgICAgICAgIGZpbGVUeXBlID0gJ2FwcGxpY2F0aW9uL3BkZic7CiAgICAgICAgICAgICAgbG9hZGluZy5zZXRUZXh0KCfmraPlnKjnlJ/miJBQREbmlofku7YuLi4nKTsKCiAgICAgICAgICAgICAgLy8g5Yqo5oCB5a+85YWlaHRtbDJwZGYuanMKICAgICAgICAgICAgICBjb25zdCBodG1sMnBkZk1vZHVsZSA9IGF3YWl0IGltcG9ydCgnaHRtbDJwZGYuanMnKTsKICAgICAgICAgICAgICBjb25zdCBodG1sMnBkZiA9IGh0bWwycGRmTW9kdWxlLmRlZmF1bHQ7CiAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgIG1hcmdpbjogWzE1LCAxNSwgMTUsIDE1XSwKICAgICAgICAgICAgICAgIGZpbGVuYW1lOiBmaWxlTmFtZSwKICAgICAgICAgICAgICAgIGltYWdlOiB7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICdqcGVnJywKICAgICAgICAgICAgICAgICAgcXVhbGl0eTogMC45OAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGh0bWwyY2FudmFzOiB7CiAgICAgICAgICAgICAgICAgIHNjYWxlOiAyLAogICAgICAgICAgICAgICAgICB1c2VDT1JTOiB0cnVlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAganNQREY6IHsKICAgICAgICAgICAgICAgICAgdW5pdDogJ21tJywKICAgICAgICAgICAgICAgICAgZm9ybWF0OiAnYTQnLAogICAgICAgICAgICAgICAgICBvcmllbnRhdGlvbjogJ3BvcnRyYWl0JwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIC8vIOeUn+aIkFBERuW5tuiOt+WPlkJsb2IKICAgICAgICAgICAgICBkb2N1bWVudEZpbGUgPSBhd2FpdCBodG1sMnBkZigpLmZyb20odGVtcENvbnRhaW5lcikuc2V0KG9wdGlvbnMpLm91dHB1dFBkZignYmxvYicpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGZpbGVOYW1lICs9ICcuZG9jJzsKICAgICAgICAgICAgICBmaWxlVHlwZSA9ICdhcHBsaWNhdGlvbi9tc3dvcmQnOwogICAgICAgICAgICAgIGxvYWRpbmcuc2V0VGV4dCgn5q2j5Zyo55Sf5oiQV29yZOaWh+S7ti4uLicpOwoKICAgICAgICAgICAgICAvLyDliJvlu7rlvq7ova9Xb3Jk5YW85a6555qESFRNTOaWh+ahowogICAgICAgICAgICAgIGNvbnN0IG1zV29yZEh0bWwgPSBgCiAgICAgICAgICAgICAgICA8aHRtbCB4bWxuczpvPSJ1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOm9mZmljZTpvZmZpY2UiIAogICAgICAgICAgICAgICAgICAgICAgeG1sbnM6dz0idXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTpvZmZpY2U6d29yZCIgCiAgICAgICAgICAgICAgICAgICAgICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvVFIvUkVDLWh0bWw0MCI+CiAgICAgICAgICAgICAgICA8aGVhZD4KICAgICAgICAgICAgICAgICAgPG1ldGEgY2hhcnNldD0idXRmLTgiPgogICAgICAgICAgICAgICAgICA8dGl0bGU+JHtkb2NUaXRsZX08L3RpdGxlPgogICAgICAgICAgICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgICAgICAgICAgYm9keSB7IGZvbnQtZmFtaWx5OiBTaW1TdW4sIEFyaWFsLCBzYW5zLXNlcmlmOyBtYXJnaW46IDFjbTsgfQogICAgICAgICAgICAgICAgICAgIGltZyB7IG1heC13aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyB9CiAgICAgICAgICAgICAgICAgICAgcCB7IG1hcmdpbjogMDsgcGFkZGluZzogMDsgfQogICAgICAgICAgICAgICAgICAgIGgxIHsgZm9udC1zaXplOiAxOHB0OyB9CiAgICAgICAgICAgICAgICAgICAgaDIgeyBmb250LXNpemU6IDE2cHQ7IH0KICAgICAgICAgICAgICAgICAgICBoMyB7IGZvbnQtc2l6ZTogMTRwdDsgfQogICAgICAgICAgICAgICAgICAgIHRhYmxlIHsgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsgd2lkdGg6IDEwMCU7IH0KICAgICAgICAgICAgICAgICAgICB0ZCwgdGggeyBib3JkZXI6IDFweCBzb2xpZCAjMDAwOyBwYWRkaW5nOiA1cHg7IH0KICAgICAgICAgICAgICAgICAgPC9zdHlsZT4KICAgICAgICAgICAgICAgIDwvaGVhZD4KICAgICAgICAgICAgICAgIDxib2R5PgogICAgICAgICAgICAgICAgICA8aDE+JHtkb2NUaXRsZX08L2gxPgogICAgICAgICAgICAgICAgICAke3RlbXBDb250YWluZXIuaW5uZXJIVE1MfQogICAgICAgICAgICAgICAgPC9ib2R5PgogICAgICAgICAgICAgICAgPC9odG1sPgogICAgICAgICAgICAgIGA7CgogICAgICAgICAgICAgIC8vIOWIm+W7ukJsb2IKICAgICAgICAgICAgICBkb2N1bWVudEZpbGUgPSBuZXcgQmxvYihbbXNXb3JkSHRtbF0sIHsKICAgICAgICAgICAgICAgIHR5cGU6IGZpbGVUeXBlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOa4heeQhuS4tOaXtuWFg+e0oAogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRlbXBDb250YWluZXIpOwoKICAgICAgICAgICAgLy8g5YWI6I635Y+W5omA5pyJ6IGK5aSp5Lya6K+d5YiX6KGo77yM5Y+q6I635Y+W5LiA5qyhCiAgICAgICAgICAgIGxvYWRpbmcuc2V0VGV4dCgn5q2j5Zyo5p+l5om+6IGK5aSp5Lya6K+dLi4uJyk7CiAgICAgICAgICAgIGNvbnN0IHNlc3Npb25zUmVzcG9uc2UgPSBhd2FpdCBnZXRDaGF0U2Vzc2lvbnMoKTsKICAgICAgICAgICAgbGV0IGNoYXRTZXNzaW9ucyA9IFtdOwoKICAgICAgICAgICAgLy8g5aSE55CG5LiN5ZCM5qC85byP55qEQVBJ6L+U5Zue57uT5p6cCiAgICAgICAgICAgIGlmIChzZXNzaW9uc1Jlc3BvbnNlICYmIHNlc3Npb25zUmVzcG9uc2UuZGF0YSAmJiBBcnJheS5pc0FycmF5KHNlc3Npb25zUmVzcG9uc2UuZGF0YSkpIHsKICAgICAgICAgICAgICBjaGF0U2Vzc2lvbnMgPSBzZXNzaW9uc1Jlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2Vzc2lvbnNSZXNwb25zZSAmJiBzZXNzaW9uc1Jlc3BvbnNlLnJlc3VsdHMgJiYgQXJyYXkuaXNBcnJheShzZXNzaW9uc1Jlc3BvbnNlLnJlc3VsdHMpKSB7CiAgICAgICAgICAgICAgY2hhdFNlc3Npb25zID0gc2Vzc2lvbnNSZXNwb25zZS5yZXN1bHRzOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNlc3Npb25zUmVzcG9uc2UgJiYgQXJyYXkuaXNBcnJheShzZXNzaW9uc1Jlc3BvbnNlKSkgewogICAgICAgICAgICAgIGNoYXRTZXNzaW9ucyA9IHNlc3Npb25zUmVzcG9uc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc29sZS5sb2coYOiOt+WPluWIsCAke2NoYXRTZXNzaW9ucy5sZW5ndGh9IOS4quS8muivnWApOwogICAgICAgICAgICBsb2FkaW5nLnNldFRleHQoJ+ato+WcqOWHhuWkh+WPkemAgS4uLicpOwoKICAgICAgICAgICAgLy8g5Li65q+P5Liq55So5oi35YeG5aSH5Lya6K+dSUTvvIzkvb/nlKhNYXDlrZjlgqh1c2VySWQgLT4gY2hhdElk55qE5pig5bCECiAgICAgICAgICAgIGNvbnN0IHVzZXJTZXNzaW9uTWFwID0gbmV3IE1hcCgpOwoKICAgICAgICAgICAgLy8g5YWI5om56YeP5p+l5om+546w5pyJ5Lya6K+d77yM5YeP5bCR6YeN5aSN5qOA5p+lCiAgICAgICAgICAgIGZvciAoY29uc3QgdXNlcklkIG9mIHNlbGVjdGVkQ2hhdFVzZXJzLnZhbHVlKSB7CiAgICAgICAgICAgICAgLy8g5p+l5om+5piv5ZCm5pyJ5LiO6K+l55So5oi355qE5Lya6K+dCiAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdTZXNzaW9uID0gY2hhdFNlc3Npb25zLmZpbmQoc2Vzc2lvbiA9PiB7CiAgICAgICAgICAgICAgICAvLyDmo4Dmn6XkvJror53mmK/lkKbkuLrlj4zkurrkvJror50KICAgICAgICAgICAgICAgIGlmICghc2Vzc2lvbi5wYXJ0aWNpcGFudHMgfHwgIUFycmF5LmlzQXJyYXkoc2Vzc2lvbi5wYXJ0aWNpcGFudHMpKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyDmo4Dmn6XkvJror53mmK/lkKblj6rmnInkuKTkuKrlj4LkuI7ogIUKICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uLnBhcnRpY2lwYW50cy5sZW5ndGggIT09IDIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIOajgOafpeS8muivneWPguS4juiAheaYr+WQpuWMheWQq+W9k+WJjeeUqOaIt+WSjOebruagh+eUqOaItwogICAgICAgICAgICAgICAgY29uc3QgaGFzQ3VycmVudFVzZXIgPSBzZXNzaW9uLnBhcnRpY2lwYW50cy5zb21lKHAgPT4gcC5pZCA9PT0gY3VycmVudFVzZXJJZCB8fCBwLnVzZXIgJiYgcC51c2VyLmlkID09PSBjdXJyZW50VXNlcklkKTsKICAgICAgICAgICAgICAgIGNvbnN0IGhhc1RhcmdldFVzZXIgPSBzZXNzaW9uLnBhcnRpY2lwYW50cy5zb21lKHAgPT4gcC5pZCA9PT0gdXNlcklkIHx8IHAudXNlciAmJiBwLnVzZXIuaWQgPT09IHVzZXJJZCk7CiAgICAgICAgICAgICAgICByZXR1cm4gaGFzQ3VycmVudFVzZXIgJiYgaGFzVGFyZ2V0VXNlcjsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdTZXNzaW9uKSB7CiAgICAgICAgICAgICAgICB1c2VyU2Vzc2lvbk1hcC5zZXQodXNlcklkLCBleGlzdGluZ1Nlc3Npb24uaWQpOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYOeUqOaItyR7dXNlcklkfeacieeOsOacieS8muivnTogJHtleGlzdGluZ1Nlc3Npb24uaWR9YCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDkuLrmsqHmnInkvJror53nmoTnlKjmiLfliJvlu7rmlrDkvJror50KICAgICAgICAgICAgY29uc3QgbmV3U2Vzc2lvblByb21pc2VzID0gW107CiAgICAgICAgICAgIGZvciAoY29uc3QgdXNlcklkIG9mIHNlbGVjdGVkQ2hhdFVzZXJzLnZhbHVlKSB7CiAgICAgICAgICAgICAgaWYgKCF1c2VyU2Vzc2lvbk1hcC5oYXModXNlcklkKSkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coYOS4uueUqOaItyR7dXNlcklkfeWIm+W7uuaWsOS8muivnS4uLmApOwogICAgICAgICAgICAgICAgbmV3U2Vzc2lvblByb21pc2VzLnB1c2goY3JlYXRlQ2hhdFNlc3Npb24oewogICAgICAgICAgICAgICAgICBwYXJ0aWNpcGFudF9pZHM6IFtjdXJyZW50VXNlcklkLCB1c2VySWRdLAogICAgICAgICAgICAgICAgICB0aXRsZTogJ+aWh+aho+WIhuS6qycKICAgICAgICAgICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgdXNlclNlc3Npb25NYXAuc2V0KHVzZXJJZCwgcmVzcG9uc2UuZGF0YS5pZCk7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYOS4uueUqOaItyR7dXNlcklkfeWIm+W7uuaWsOS8muivneaIkOWKnzogJHtyZXNwb25zZS5kYXRhLmlkfWApOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgdXNlclNlc3Npb25NYXAuc2V0KHVzZXJJZCwgcmVzcG9uc2UuaWQpOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGDkuLrnlKjmiLcke3VzZXJJZH3liJvlu7rmlrDkvJror53miJDlip86ICR7cmVzcG9uc2UuaWR9YCk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcign5Yib5bu66IGK5aSp5Lya6K+d5aSx6LSl77yM6L+U5Zue5pWw5o2u5qC85byP5LiN5q2j56GuOicsIHJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGDkuLrnlKjmiLcke3VzZXJJZH3liJvlu7rkvJror53lpLHotKU6YCwgZXJyb3IpOwogICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOetieW+heaJgOacieaWsOS8muivneWIm+W7uuWujOaIkAogICAgICAgICAgICBpZiAobmV3U2Vzc2lvblByb21pc2VzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBsb2FkaW5nLnNldFRleHQoYOato+WcqOWIm+W7uiAke25ld1Nlc3Npb25Qcm9taXNlcy5sZW5ndGh9IOS4quaWsOS8muivnS4uLmApOwogICAgICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKG5ld1Nlc3Npb25Qcm9taXNlcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOWHhuWkh+WPkemAgeaWh+S7tgogICAgICAgICAgICBsb2FkaW5nLnNldFRleHQoJ+ato+WcqOWPkemAgeaWh+S7ti4uLicpOwogICAgICAgICAgICBjb25zdCBzZW5kUHJvbWlzZXMgPSBbXTsKICAgICAgICAgICAgY29uc3QgZmFpbGVkVXNlcnMgPSBbXTsKCiAgICAgICAgICAgIC8vIOmBjeWOhueUqOaIt+WPkemAgeaWh+S7tgogICAgICAgICAgICBmb3IgKGNvbnN0IHVzZXJJZCBvZiBzZWxlY3RlZENoYXRVc2Vycy52YWx1ZSkgewogICAgICAgICAgICAgIGNvbnN0IGNoYXRJZCA9IHVzZXJTZXNzaW9uTWFwLmdldCh1c2VySWQpOwogICAgICAgICAgICAgIGlmICghY2hhdElkKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGDmnKrog73mib7liLDmiJbliJvlu7rnlKjmiLcke3VzZXJJZH3nmoTkvJror51gKTsKICAgICAgICAgICAgICAgIGZhaWxlZFVzZXJzLnB1c2godXNlcklkKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg5YeG5aSH5ZCR5Lya6K+dICR7Y2hhdElkfSDlj5HpgIHmlofmoaMuLi5gKTsKCiAgICAgICAgICAgICAgLy8g5Yib5bu6Rm9ybURhdGHlr7nosaHvvIzmt7vliqDmlofku7blkoznm7jlhbPkv6Hmga8KICAgICAgICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnY2hhdCcsIGNoYXRJZCk7CiAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdtZXNzYWdlX3R5cGUnLCAnZmlsZScpOwogICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnY29udGVudCcsIGDliIbkuqvkuobkuIDkuKoke3NoYXJlRm9ybWF0LnZhbHVlID09PSAncGRmJyA/ICdQREYnIDogJ1dvcmQnfeaWh+ahozogJHtkb2NUaXRsZX1gKTsKCiAgICAgICAgICAgICAgLy8g5bCG5paH5Lu2QmxvYui9rOaNouS4ukZpbGXlr7nosaEgLSDkuLrmr4/kuKrnlKjmiLfliJvlu7rmlrDnmoRGaWxl5a+56LGhCiAgICAgICAgICAgICAgY29uc3QgZmlsZSA9IG5ldyBGaWxlKFtkb2N1bWVudEZpbGVdLCBmaWxlTmFtZSwgewogICAgICAgICAgICAgICAgdHlwZTogZmlsZVR5cGUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlKTsKCiAgICAgICAgICAgICAgLy8g5Y+R6YCB5paH5Lu25raI5oGvCiAgICAgICAgICAgICAgc2VuZFByb21pc2VzLnB1c2gocmVxdWVzdCh7CiAgICAgICAgICAgICAgICB1cmw6ICcvYXBpL2NoYXQvbWVzc2FnZXMvJywKICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLAogICAgICAgICAgICAgICAgZGF0YTogZm9ybURhdGEsCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnbXVsdGlwYXJ0L2Zvcm0tZGF0YScKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB0aW1lb3V0OiAzMDAwMCAvLyDlop7liqDotoXml7bml7bpl7QKICAgICAgICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGDlkJHnlKjmiLcgJHt1c2VySWR9IOWPkemAgeaWh+aho+aIkOWKnzpgLCByZXNwb25zZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICB1c2VySWQsCiAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihg5ZCR55So5oi3ICR7dXNlcklkfSDlj5HpgIHmlofmoaPlpLHotKU6YCwgZXJyb3IpOwogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgdXNlcklkLAogICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgZXJyb3IKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDnrYnlvoXmiYDmnInlj5HpgIHmk43kvZzlrozmiJAKICAgICAgICAgICAgY29uc3Qgc2VuZFJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChzZW5kUHJvbWlzZXMpOwogICAgICAgICAgICBjb25zdCBzdWNjZXNzQ291bnQgPSBzZW5kUmVzdWx0cy5maWx0ZXIocmVzdWx0ID0+IHJlc3VsdC5zdWNjZXNzKS5sZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsQXR0ZW1wdGVkID0gc2VuZFJlc3VsdHMubGVuZ3RoOwogICAgICAgICAgICBjb25zdCB0b3RhbFNlbGVjdGVkID0gc2VsZWN0ZWRDaGF0VXNlcnMudmFsdWUubGVuZ3RoOwogICAgICAgICAgICBpZiAoc3VjY2Vzc0NvdW50ID4gMCkgewogICAgICAgICAgICAgIGlmIChzdWNjZXNzQ291bnQgPT09IHRvdGFsU2VsZWN0ZWQpIHsKICAgICAgICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKGDmiJDlip/lj5HpgIHmlofmoaPliLDmiYDmnIkgJHtzdWNjZXNzQ291bnR9IOS4queUqOaIt+eahOiBiuWkqWApOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBFbE1lc3NhZ2Uud2FybmluZyhg6YOo5YiG5Y+R6YCB5oiQ5YqfOiAke3N1Y2Nlc3NDb3VudH0vJHt0b3RhbFNlbGVjdGVkfSDkuKrnlKjmiLfmjqXmlLbliLDmlofmoaNgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgc2hhcmVEaWFsb2dWaXNpYmxlLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodG90YWxBdHRlbXB0ZWQgPiAwKSB7CiAgICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCflj5HpgIHmlofmoaPlpLHotKXvvIzor7fph43or5UnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+acquiDveWIm+W7uuS7u+S9leiBiuWkqeS8muivne+8jOivt+mHjeivlScpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCfnlJ/miJDmlofmoaPmlofku7blpLHotKU6JywgZXJyb3IpOwogICAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+eUn+aIkOaWh+aho+aWh+S7tuWksei0pScpOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgbG9hZGluZy5jbG9zZSgpOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfliIbkuqvmlofmoaPliLDogYrlpKnlpLHotKU6JywgZXJyb3IpOwogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfliIbkuqvmlofmoaPliLDogYrlpKnlpLHotKUnKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgc2hhcmVMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgY29uc3QgZGVsZXRlRG9jdW1lbnQgPSBkb2MgPT4gewogICAgICBzZWxlY3RlZERvY3VtZW50LnZhbHVlID0gZG9jOwogICAgICBkZWxldGVEaWFsb2dWaXNpYmxlLnZhbHVlID0gdHJ1ZTsKICAgIH07CiAgICBjb25zdCBjb25maXJtRGVsZXRlID0gYXN5bmMgKCkgPT4gewogICAgICBpZiAoIXNlbGVjdGVkRG9jdW1lbnQudmFsdWUpIHJldHVybjsKICAgICAgZGVsZXRlTG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIF9zZWxlY3RlZERvY3VtZW50JHZhbDsKICAgICAgICAvLyDorrDlvZXopoHliKDpmaTnmoTmlofmoaNJROWSjOexu+WIqwogICAgICAgIGNvbnN0IGRlbGV0ZWREb2NJZCA9IHNlbGVjdGVkRG9jdW1lbnQudmFsdWUuaWQ7CiAgICAgICAgY29uc3QgZGVsZXRlZERvY0NhdGVnb3J5SWQgPSAoX3NlbGVjdGVkRG9jdW1lbnQkdmFsID0gc2VsZWN0ZWREb2N1bWVudC52YWx1ZS5jYXRlZ29yeSkgPT09IG51bGwgfHwgX3NlbGVjdGVkRG9jdW1lbnQkdmFsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfc2VsZWN0ZWREb2N1bWVudCR2YWwuaWQ7CgogICAgICAgIC8vIOWFiOWFs+mXreWvueivneahhu+8jOaPkOmrmOeUqOaIt+S9k+mqjAogICAgICAgIGRlbGV0ZURpYWxvZ1Zpc2libGUudmFsdWUgPSBmYWxzZTsKCiAgICAgICAgLy8g5omn6KGM5Yig6Zmk5pON5L2cCiAgICAgICAgYXdhaXQgYXBpRGVsZXRlRG9jdW1lbnQoZGVsZXRlZERvY0lkKTsKICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5paH5qGj5Yig6Zmk5oiQ5YqfJyk7CgogICAgICAgIC8vIOW8uuWItua4hemZpOmAieS4reeahOaWh+ahowogICAgICAgIHNlbGVjdGVkRG9jdW1lbnQudmFsdWUgPSBudWxsOwoKICAgICAgICAvLyDmuIXpmaTlj6/og73nmoTnvJPlrZjmlbDmja4KICAgICAgICBpZiAod2luZG93LmxvY2FsU3RvcmFnZSkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8g56e76Zmk5Y+v6IO95a2Y5Zyo55qE55u45YWz57yT5a2YCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGBkb2NfY2FjaGVfJHtkZWxldGVkRG9jSWR9YCk7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGByZWNlbnRfZG9jc19jYWNoZWApOwogICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShgZG9jX2xpc3RfY2FjaGVgKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcign5riF6Zmk5pys5Zyw57yT5a2Y5aSx6LSlOicsIGUpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g5pu05paw5Yi35paw6Kem5Y+R5ZmoCiAgICAgICAgcmVmcmVzaFRyaWdnZXIudmFsdWUgPSBEYXRlLm5vdygpOwoKICAgICAgICAvLyDkvb/nlKjmlrDmlbDnu4Tmm7/mjaLljp/mlbDnu4TvvIznoa7kv51WdWXog73mo4DmtYvliLDlj5jljJYgCiAgICAgICAgZG9jdW1lbnRzLnZhbHVlID0gWy4uLmRvY3VtZW50cy52YWx1ZS5maWx0ZXIoZG9jID0+IGRvYy5pZCAhPT0gZGVsZXRlZERvY0lkKV07CiAgICAgICAgcmVjZW50RG9jdW1lbnRzLnZhbHVlID0gWy4uLnJlY2VudERvY3VtZW50cy52YWx1ZS5maWx0ZXIoZG9jID0+IGRvYy5pZCAhPT0gZGVsZXRlZERvY0lkKV07CiAgICAgICAgc2hhcmVkRG9jdW1lbnRzLnZhbHVlID0gWy4uLnNoYXJlZERvY3VtZW50cy52YWx1ZS5maWx0ZXIoZG9jID0+IGRvYy5pZCAhPT0gZGVsZXRlZERvY0lkKV07CgogICAgICAgIC8vIOW8uuWItuabtOaWsOinhuWbvgogICAgICAgIGF3YWl0IGZvcmNlVXBkYXRlKCk7CgogICAgICAgIC8vIOabtOaWsOWIhuexu+S4reeahOaWh+aho+iuoeaVsAogICAgICAgIGlmIChkZWxldGVkRG9jQ2F0ZWdvcnlJZCkgewogICAgICAgICAgY29uc3QgY2F0ZWdvcnkgPSBkb2N1bWVudENhdGVnb3JpZXMudmFsdWUuZmluZChjID0+IGMuaWQgPT09IGRlbGV0ZWREb2NDYXRlZ29yeUlkKTsKICAgICAgICAgIGlmIChjYXRlZ29yeSAmJiBjYXRlZ29yeS5kb2N1bWVudF9jb3VudCA+IDApIHsKICAgICAgICAgICAgY2F0ZWdvcnkuZG9jdW1lbnRfY291bnQtLTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIOetieW+hURPTeabtOaWsAogICAgICAgIGF3YWl0IG5leHRUaWNrKCk7CgogICAgICAgIC8vIOmHjeaWsOWvvOiIquWIsOaWh+aho+mmlumhte+8jOehruS/neeKtuaAgeWFqOmDqOWIt+aWsAogICAgICAgIGlmIChyb3V0ZXIuY3VycmVudFJvdXRlLnZhbHVlLm5hbWUgPT09ICdTbWFydERvY0RldGFpbCcpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCfku47or6bmg4XpobXliKDpmaTmlofmoaPvvIzph43mlrDlr7zoiKrliLDmlofmoaPpppbpobUnKTsKCiAgICAgICAgICAvLyDlhYjlvLrliLbliLfmlrDmlbDmja7vvIznoa7kv53lr7zoiKrlkI7mlbDmja7mmK/mnIDmlrDnmoQKICAgICAgICAgIGF3YWl0IHJlbG9hZEFsbERhdGEoKTsKCiAgICAgICAgICAvLyDkvb/nlKhyZXBsYWNl5qih5byP6Lez6L2s77yM5LiN55WZ5LiL5Y6G5Y+y6K6w5b2V77yM5bm25re75Yqg5by65Yi25Yi35paw5Y+C5pWwCiAgICAgICAgICByb3V0ZXIucmVwbGFjZSh7CiAgICAgICAgICAgIG5hbWU6ICdTbWFydERvYycsCiAgICAgICAgICAgIHF1ZXJ5OiB7CiAgICAgICAgICAgICAgX3JlZnJlc2g6IERhdGUubm93KCkKICAgICAgICAgICAgfSAvLyDmt7vliqDml7bpl7TmiLPlj4LmlbDpmLLmraLnvJPlrZgKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyDlpoLmnpzlt7Lnu4/lnKjmlofmoaPpppbpobXvvIznq4vljbPph43ovb3mlbDmja7lubblvLrliLbliLfmlrDpobXpnaIKICAgICAgICAgIGF3YWl0IHJlZnJlc2hEYXRhKCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIoOmZpOaWh+aho+Wksei0pScsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WIoOmZpOaWh+aho+Wksei0pScpOwogICAgICAgIC8vIOWmguaenOWIoOmZpOWksei0pe+8jOWFs+mXreWvueivneahhgogICAgICAgIGRlbGV0ZURpYWxvZ1Zpc2libGUudmFsdWUgPSBmYWxzZTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBkZWxldGVMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgIH0KICAgIH07CiAgICBjb25zdCB2aWV3QWxsRG9jdW1lbnRzID0gdHlwZSA9PiB7CiAgICAgIGlmICh0eXBlID09PSAncmVjZW50JykgewogICAgICAgIC8vIOi3r+eUseS4reayoeaciVNtYXJ0RG9jTGlzdO+8jOebtOaOpei3s+i9rOWIsOaZuuiDveaWh+aho+mmlumhteW5tua7muWKqOWIsOaWh+aho+WIl+ihqAogICAgICAgIHJvdXRlci5wdXNoKHsKICAgICAgICAgIG5hbWU6ICdTbWFydERvYycKICAgICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBjb25zdCBkb2NTZWN0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNlY3Rpb24nKTsKICAgICAgICAgICAgaWYgKGRvY1NlY3Rpb24pIHsKICAgICAgICAgICAgICBkb2NTZWN0aW9uLnNjcm9sbEludG9WaWV3KHsKICAgICAgICAgICAgICAgIGJlaGF2aW9yOiAnc21vb3RoJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCAzMDApOwogICAgICAgIH0pOwogICAgICB9CiAgICB9OwogICAgY29uc3Qgc2VsZWN0Q2F0ZWdvcnkgPSBjYXRlZ29yeSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCfpgInmi6nliIbnsbs6JywgY2F0ZWdvcnkpOwoKICAgICAgLy8g5aSE55CG5LiN5ZCM57G75Z6L55qEY2F0ZWdvcnnlj4LmlbAKICAgICAgbGV0IGNhdGVnb3J5SWQ7CiAgICAgIGlmIChjYXRlZ29yeSA9PT0gJ2FsbCcpIHsKICAgICAgICBjYXRlZ29yeUlkID0gJ2FsbCc7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGNhdGVnb3J5ID09PSAnc3RyaW5nJykgewogICAgICAgIGNhdGVnb3J5SWQgPSBjYXRlZ29yeTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY2F0ZWdvcnkgPT09ICdvYmplY3QnICYmIGNhdGVnb3J5ICE9PSBudWxsKSB7CiAgICAgICAgY2F0ZWdvcnlJZCA9IGNhdGVnb3J5LmlkLnRvU3RyaW5nKCk7CiAgICAgIH0KICAgICAgY29uc29sZS5sb2coJ+WkhOeQhuWQjueahOWIhuexu0lEOicsIGNhdGVnb3J5SWQpOwoKICAgICAgLy8g5aaC5p6c6YCJ5oup55qE5YiG57G75LiO5b2T5YmN5YiG57G755u45ZCM77yM5YiZ5LiN5YGa5Lu75L2V5pON5L2cCiAgICAgIGlmIChjYXRlZ29yeUlkID09PSBzZWFyY2hDYXRlZ29yeS52YWx1ZSkgewogICAgICAgIGNvbnNvbGUubG9nKCfliIbnsbvmnKrlj5jljJbvvIzkuI3ph43mlrDliqDovb0nKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIOiuvue9ruaWsOeahOWIhuexuwogICAgICBzZWFyY2hDYXRlZ29yeS52YWx1ZSA9IGNhdGVnb3J5SWQ7CgogICAgICAvLyDmt7vliqDliqjnlLvmlYjmnpwKICAgICAgZG9jdW1lbnRzLnZhbHVlID0gW107CiAgICAgIGNyZWF0ZUxvYWRpbmcudmFsdWUgPSB0cnVlOwoKICAgICAgLy8g6YeN572u5YiG6aG15ZKM5Yqg6L2954q25oCBCiAgICAgIHBhZ2UudmFsdWUgPSAxOwogICAgICBoYXNNb3JlLnZhbHVlID0gdHJ1ZTsKCiAgICAgIC8vIOW7tui/n+iOt+WPlu+8jOWunueOsOi/h+a4oeaViOaenAogICAgICBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgLy8g5by65Yi25Yi35paw5paH5qGj5YiX6KGoCiAgICAgICAgICBhd2FpdCBmZXRjaERvY3VtZW50cyh0cnVlKTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W5paH5qGj5aSx6LSlOicsIGVycm9yKTsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign6I635Y+W5paH5qGj5YiX6KGo5aSx6LSl77yM6K+35Yi35paw6aG16Z2i6YeN6K+VJyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIGNyZWF0ZUxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8vIOinpuWPkeS4gOS4queugOWNleeahOWKqOeUu+aViOaenO+8jOeqgeWHuuaYvuekuuW3suetm+mAieeahOaWh+ahowogICAgICAgIGNvbnN0IGRvY0NhcmRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRvYy1jYXJkJyk7CiAgICAgICAgaWYgKGRvY0NhcmRzICYmIGRvY0NhcmRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGRvY0NhcmRzLmZvckVhY2goKGNhcmQsIGluZGV4KSA9PiB7CiAgICAgICAgICAgIGlmIChjYXJkKSB7CiAgICAgICAgICAgICAgY2FyZC5zdHlsZS5hbmltYXRpb25EZWxheSA9IGAke2luZGV4ICogNTB9bXNgOwogICAgICAgICAgICAgIGNhcmQuY2xhc3NMaXN0LnJlbW92ZSgnZmFkZUluJyk7CiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoY2FyZCkgewogICAgICAgICAgICAgICAgICBjYXJkLmNsYXNzTGlzdC5hZGQoJ2ZhZGVJbicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIDEwKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LCAzMDApOwogICAgfTsKCiAgICAvLyDojrflj5bpgInkuK3liIbnsbvnmoTpopzoibIKICAgIGNvbnN0IGdldFNlbGVjdGVkQ2F0ZWdvcnlDb2xvciA9ICgpID0+IHsKICAgICAgaWYgKHNlYXJjaENhdGVnb3J5LnZhbHVlID09PSAnYWxsJykgcmV0dXJuICcjNDA5RUZGJzsKICAgICAgY29uc3Qgc2VsZWN0ZWRDYXRlZ29yeSA9IGRvY3VtZW50Q2F0ZWdvcmllcy52YWx1ZS5maW5kKGMgPT4gYy5pZC50b1N0cmluZygpID09PSBzZWFyY2hDYXRlZ29yeS52YWx1ZSk7CiAgICAgIHJldHVybiAoc2VsZWN0ZWRDYXRlZ29yeSA9PT0gbnVsbCB8fCBzZWxlY3RlZENhdGVnb3J5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZENhdGVnb3J5LmNvbG9yKSB8fCAnIzY3QzIzQSc7CiAgICB9OwoKICAgIC8vIOiOt+WPlumAieS4reWIhuexu+eahOWQjeensAogICAgY29uc3QgZ2V0U2VsZWN0ZWRDYXRlZ29yeU5hbWUgPSAoKSA9PiB7CiAgICAgIGlmIChzZWFyY2hDYXRlZ29yeS52YWx1ZSA9PT0gJ2FsbCcpIHJldHVybiAn5YWo6YOo5paH5qGjJzsKICAgICAgY29uc3Qgc2VsZWN0ZWRDYXRlZ29yeSA9IGRvY3VtZW50Q2F0ZWdvcmllcy52YWx1ZS5maW5kKGMgPT4gYy5pZC50b1N0cmluZygpID09PSBzZWFyY2hDYXRlZ29yeS52YWx1ZSk7CiAgICAgIHJldHVybiAoc2VsZWN0ZWRDYXRlZ29yeSA9PT0gbnVsbCB8fCBzZWxlY3RlZENhdGVnb3J5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZWxlY3RlZENhdGVnb3J5Lm5hbWUpIHx8ICfmnKrnn6XliIbnsbsnOwogICAgfTsKICAgIGNvbnN0IG1hbmFnZUNhdGVnb3JpZXMgPSAoKSA9PiB7CiAgICAgIGNhdGVnb3J5RGlhbG9nVmlzaWJsZS52YWx1ZSA9IHRydWU7CiAgICAgIHJlc2V0Q2F0ZWdvcnlGb3JtKCk7CiAgICB9OwogICAgY29uc3QgZWRpdENhdGVnb3J5ID0gY2F0ZWdvcnkgPT4gewogICAgICBlZGl0aW5nQ2F0ZWdvcnkudmFsdWUgPSB7CiAgICAgICAgLi4uY2F0ZWdvcnkKICAgICAgfTsKICAgIH07CiAgICBjb25zdCByZXNldENhdGVnb3J5Rm9ybSA9ICgpID0+IHsKICAgICAgZWRpdGluZ0NhdGVnb3J5LnZhbHVlID0gewogICAgICAgIGlkOiAnJywKICAgICAgICBuYW1lOiAnJywKICAgICAgICBjb2xvcjogJyM0MDlFRkYnLAogICAgICAgIGRlc2NyaXB0aW9uOiAnJwogICAgICB9OwogICAgICBpZiAoY2F0ZWdvcnlGb3JtUmVmLnZhbHVlKSB7CiAgICAgICAgY2F0ZWdvcnlGb3JtUmVmLnZhbHVlLnJlc2V0RmllbGRzKCk7CiAgICAgIH0KICAgIH07CiAgICBjb25zdCBzdWJtaXRDYXRlZ29yeSA9IGFzeW5jICgpID0+IHsKICAgICAgaWYgKCFjYXRlZ29yeUZvcm1SZWYudmFsdWUpIHJldHVybjsKICAgICAgYXdhaXQgY2F0ZWdvcnlGb3JtUmVmLnZhbHVlLnZhbGlkYXRlKGFzeW5jIHZhbGlkID0+IHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIGNhdGVnb3J5TG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCBjYXRlZ29yeURhdGEgPSB7CiAgICAgICAgICAgICAgbmFtZTogZWRpdGluZ0NhdGVnb3J5LnZhbHVlLm5hbWUsCiAgICAgICAgICAgICAgY29sb3I6IGVkaXRpbmdDYXRlZ29yeS52YWx1ZS5jb2xvciwKICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogZWRpdGluZ0NhdGVnb3J5LnZhbHVlLmRlc2NyaXB0aW9uIHx8ICcnCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChlZGl0aW5nQ2F0ZWdvcnkudmFsdWUuaWQpIHsKICAgICAgICAgICAgICAvLyDmm7TmlrDliIbnsbsKICAgICAgICAgICAgICBhd2FpdCB1cGRhdGVEb2N1bWVudENhdGVnb3J5KGVkaXRpbmdDYXRlZ29yeS52YWx1ZS5pZCwgY2F0ZWdvcnlEYXRhKTsKICAgICAgICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5YiG57G75pu05paw5oiQ5YqfJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8g5Yib5bu65YiG57G7CiAgICAgICAgICAgICAgYXdhaXQgY3JlYXRlRG9jdW1lbnRDYXRlZ29yeShjYXRlZ29yeURhdGEpOwogICAgICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCfliIbnsbvliJvlu7rmiJDlip8nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g6YeN5paw6I635Y+W5YiG57G75YiX6KGoCiAgICAgICAgICAgIGZldGNoRG9jdW1lbnRDYXRlZ29yaWVzKCk7CiAgICAgICAgICAgIHJlc2V0Q2F0ZWdvcnlGb3JtKCk7CiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCfkv53lrZjliIbnsbvlpLHotKU6JywgZXJyb3IpOwogICAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+S/neWtmOWIhuexu+Wksei0pScpOwogICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgY2F0ZWdvcnlMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CiAgICBjb25zdCBkZWxldGVDYXRlZ29yeSA9IGNhdGVnb3J5ID0+IHsKICAgICAgaWYgKGNhdGVnb3J5LmRvY3VtZW50X2NvdW50ID4gMCkgewogICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfor6XliIbnsbvkuIvmnInmlofmoaPvvIzml6Dms5XliKDpmaQnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgRWxNZXNzYWdlQm94LmNvbmZpcm0oYOehruWumuimgeWIoOmZpOWIhuexuyIke2NhdGVnb3J5Lm5hbWV9IuWQl++8n2AsICfliKDpmaTliIbnsbsnLCB7CiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfnoa7lrponLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICflj5bmtognLAogICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICB9KS50aGVuKGFzeW5jICgpID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgYXdhaXQgZGVsZXRlRG9jdW1lbnRDYXRlZ29yeShjYXRlZ29yeS5pZCk7CiAgICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5YiG57G75Yig6Zmk5oiQ5YqfJyk7CiAgICAgICAgICBmZXRjaERvY3VtZW50Q2F0ZWdvcmllcygpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfliKDpmaTliIbnsbvlpLHotKU6JywgZXJyb3IpOwogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfliKDpmaTliIbnsbvlpLHotKUnKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKCgpID0+IHt9KTsKICAgIH07CiAgICBjb25zdCBmb3JtYXREYXRlID0gZGF0ZVN0cmluZyA9PiB7CiAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShkYXRlU3RyaW5nKTsKICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTsKCiAgICAgIC8vIOWQjOS4gOWkqeaYvuekuuaXtumXtAogICAgICBpZiAoZGF0ZS50b0RhdGVTdHJpbmcoKSA9PT0gbm93LnRvRGF0ZVN0cmluZygpKSB7CiAgICAgICAgcmV0dXJuIGRhdGUudG9Mb2NhbGVUaW1lU3RyaW5nKCd6aC1DTicsIHsKICAgICAgICAgIGhvdXI6ICcyLWRpZ2l0JywKICAgICAgICAgIG1pbnV0ZTogJzItZGlnaXQnCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIC8vIOaYqOWkqQogICAgICBjb25zdCB5ZXN0ZXJkYXkgPSBuZXcgRGF0ZShub3cpOwogICAgICB5ZXN0ZXJkYXkuc2V0RGF0ZShub3cuZ2V0RGF0ZSgpIC0gMSk7CiAgICAgIGlmIChkYXRlLnRvRGF0ZVN0cmluZygpID09PSB5ZXN0ZXJkYXkudG9EYXRlU3RyaW5nKCkpIHsKICAgICAgICByZXR1cm4gJ+aYqOWkqSc7CiAgICAgIH0KCiAgICAgIC8vIOS4gOWRqOWGheaYvuekuuaYn+acnwogICAgICBjb25zdCB3ZWVrRGF5cyA9IFsn5ZGo5pelJywgJ+WRqOS4gCcsICflkajkuownLCAn5ZGo5LiJJywgJ+WRqOWbmycsICflkajkupQnLCAn5ZGo5YWtJ107CiAgICAgIGNvbnN0IGRpZmZEYXlzID0gTWF0aC5yb3VuZCgobm93IC0gZGF0ZSkgLyAoMTAwMCAqIDYwICogNjAgKiAyNCkpOwogICAgICBpZiAoZGlmZkRheXMgPCA3KSB7CiAgICAgICAgcmV0dXJuIHdlZWtEYXlzW2RhdGUuZ2V0RGF5KCldOwogICAgICB9CgogICAgICAvLyDlhbbku5bmg4XlhrXmmL7npLrml6XmnJ8KICAgICAgcmV0dXJuIGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCd6aC1DTicsIHsKICAgICAgICBtb250aDogJ251bWVyaWMnLAogICAgICAgIGRheTogJ251bWVyaWMnCiAgICAgIH0pOwogICAgfTsKICAgIGNvbnN0IHJlc2V0Q2F0ZWdvcnlGaWx0ZXIgPSAoKSA9PiB7CiAgICAgIHNlYXJjaENhdGVnb3J5LnZhbHVlID0gJ2FsbCc7CiAgICAgIHBhZ2UudmFsdWUgPSAxOwogICAgICBmZXRjaERvY3VtZW50cyh0cnVlKTsKICAgIH07CgogICAgLy8g5re75Yqg6aG16Z2i5r+A5rS76ZKp5a2Q77yM56Gu5L+d5LuO5YW25LuW6aG16Z2i6L+U5Zue5pe26YeN5paw6I635Y+W5pWw5o2uCiAgICBvbkFjdGl2YXRlZCgoKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCdTbWFydERvY+e7hOS7tuiiq+a/gOa0u++8jOmHjeaWsOiOt+WPluaVsOaNricpOwogICAgICByZWxvYWRBbGxEYXRhKCk7CiAgICB9KTsKCiAgICAvLyDpobXpnaLmv4DmtLvlkI7ph43mlrDliqDovb3miYDmnInmlbDmja7nmoTlh73mlbAKICAgIGNvbnN0IHJlbG9hZEFsbERhdGEgPSBhc3luYyAoKSA9PiB7CiAgICAgIHBhZ2UudmFsdWUgPSAxOwogICAgICB0cnkgewogICAgICAgIGNvbnNvbGUubG9nKCfph43mlrDliqDovb3miYDmnInmlofmoaPmlbDmja4uLi4nKTsKICAgICAgICBjcmVhdGVMb2FkaW5nLnZhbHVlID0gdHJ1ZTsKCiAgICAgICAgLy8g5re75Yqg5pe26Ze05oiz6Ziy5q2i57yT5a2YCiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTsKCiAgICAgICAgLy8g5riF6Zmk5pys5Zyw57yT5a2YCiAgICAgICAgdHJ5IHsKICAgICAgICAgIGlmICh3aW5kb3cubG9jYWxTdG9yYWdlKSB7CiAgICAgICAgICAgIC8vIOa4hemZpOaWh+aho+ebuOWFs+eahOe8k+WtmAogICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgnZG9jX2xpc3RfY2FjaGUnKTsKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ3JlY2VudF9kb2NzX2NhY2hlJyk7CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdkb2NfY2F0ZWdvcmllc19jYWNoZScpOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+a4hemZpOe8k+WtmOWksei0pTonLCBlKTsKICAgICAgICB9CgogICAgICAgIC8vIOWFiOiOt+WPluWIhuexu++8jOWboOS4uuaYvuekuuaWh+aho+aXtumcgOimgeWIhuexu+S/oeaBrwogICAgICAgIGF3YWl0IGZldGNoRG9jdW1lbnRDYXRlZ29yaWVzKHRpbWVzdGFtcCk7CgogICAgICAgIC8vIOeEtuWQjuW5tuihjOiOt+WPluWFtuS7luaVsOaNru+8jOS9huS4jemcgOimgeS/neWtmOi/lOWbnuWAvAogICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFtmZXRjaERvY3VtZW50cyh0cnVlLCBmYWxzZSwgdGltZXN0YW1wKSwgZmV0Y2hSZWNlbnREb2N1bWVudHModHJ1ZSwgdGltZXN0YW1wKSwgZmV0Y2hTaGFyZWREb2N1bWVudHModGltZXN0YW1wKV0pOwogICAgICAgIGNvbnNvbGUubG9nKCfmlbDmja7ph43mlrDliqDovb3lrozmiJAnLCB7CiAgICAgICAgICDliIbnsbvmlbDph486IGRvY3VtZW50Q2F0ZWdvcmllcy52YWx1ZS5sZW5ndGgsCiAgICAgICAgICDmlofmoaPmlbDph486IGRvY3VtZW50cy52YWx1ZS5sZW5ndGgsCiAgICAgICAgICDmnIDov5HmlofmoaM6IHJlY2VudERvY3VtZW50cy52YWx1ZS5sZW5ndGgsCiAgICAgICAgICDlhbHkuqvmlofmoaM6IHNoYXJlZERvY3VtZW50cy52YWx1ZS5sZW5ndGgsCiAgICAgICAgICDmgLvorqHmlbA6IHRvdGFsQ291bnQudmFsdWUKICAgICAgICB9KTsKCiAgICAgICAgLy8g5by65Yi25pu05paw6KeG5Zu+CiAgICAgICAgYXdhaXQgZm9yY2VVcGRhdGUoKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfmlbDmja7ph43mlrDliqDovb3lpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Yqg6L295pWw5o2u5aSx6LSl77yM6K+35Yi35paw6aG16Z2iJyk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgY3JlYXRlTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICB9CiAgICB9OwoKICAgIC8vIOaPkOS+m+mHjei9veWHveaVsOe7meWtkOe7hOS7tuaIlueItue7hOS7tuS9v+eUqAogICAgcHJvdmlkZSgncmVsb2FkRG9jdW1lbnRzJywgcmVsb2FkQWxsRGF0YSk7CgogICAgLy8g55uR5ZCs6Lev55Sx5Y+Y5YyW77yM5by65Yi25Yi35paw5pWw5o2uCiAgICB3YXRjaCgoKSA9PiByb3V0ZS5xdWVyeS5fcmVmcmVzaCwgbmV3VmFsID0+IHsKICAgICAgaWYgKG5ld1ZhbCkgewogICAgICAgIGNvbnNvbGUubG9nKCfmo4DmtYvliLDot6/nlLHliLfmlrDlj4LmlbA6JywgbmV3VmFsKTsKICAgICAgICByZWZyZXNoVHJpZ2dlci52YWx1ZSA9IERhdGUubm93KCk7CiAgICAgICAgcmVsb2FkQWxsRGF0YSgpOwogICAgICB9CiAgICB9KTsKCiAgICAvLyDnm5HlkKzot6/nlLHlj4LmlbDvvIzlpITnkIbkuI3lkIzmg4XlhrUKICAgIHdhdGNoKCgpID0+IHJvdXRlLnBhdGgsIChuZXdQYXRoLCBvbGRQYXRoKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCfot6/nlLHlj5jljJY6Jywgb2xkUGF0aCwgJy0+JywgbmV3UGF0aCk7CiAgICAgIGlmIChuZXdQYXRoID09PSAnL3NtYXJ0ZG9jJyAmJiBvbGRQYXRoICYmIG9sZFBhdGguc3RhcnRzV2l0aCgnL3NtYXJ0ZG9jLycpKSB7CiAgICAgICAgLy8g5LuO5paH5qGj6K+m5oOF6aG16L+U5Zue5paH5qGj5YiX6KGo6aG177yM5by65Yi25Yi35pawCiAgICAgICAgY29uc29sZS5sb2coJ+S7juivpuaDhemhtei/lOWbnuWIl+ihqOmhte+8jOW8uuWItuWIt+aWsOaVsOaNricpOwogICAgICAgIHJlZnJlc2hUcmlnZ2VyLnZhbHVlID0gRGF0ZS5ub3coKTsKICAgICAgICByZWxvYWRBbGxEYXRhKCk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIOaJi+WKqOW8uuWItuWIt+aWsOaWueazlQogICAgY29uc3QgcmVmcmVzaERhdGEgPSBhc3luYyAoKSA9PiB7CiAgICAgIHBhZ2UudmFsdWUgPSAxOwogICAgICBhd2FpdCByZWxvYWRBbGxEYXRhKCk7CiAgICAgIGlmIChwcm94eSAmJiBwcm94eS4kZm9yY2VVcGRhdGUpIHsKICAgICAgICBwcm94eS4kZm9yY2VVcGRhdGUoKTsKICAgICAgfQogICAgfTsKCiAgICAvLyDlpITnkIbliIbpobXlj5jljJbnmoTmlrnms5UgLSDnroDljZXorrDlvZXkuovku7YKICAgIGNvbnN0IG9uUGFnZUNoYW5nZSA9IG5ld1BhZ2UgPT4gewogICAgICBjb25zb2xlLmxvZyhg5YiG6aG154K55Ye75LqL5Lu2IC0g5YiH5o2i5Yiw6aG16Z2iOiAke25ld1BhZ2V9YCk7CgogICAgICAvLyDmo4Dmn6XpobXnoIHojIPlm7QKICAgICAgY29uc3QgbWF4UGFnZSA9IE1hdGguY2VpbCh0b3RhbENvdW50LnZhbHVlIC8gcGFnZVNpemUpOwogICAgICBpZiAobmV3UGFnZSA+IG1heFBhZ2UgJiYgbWF4UGFnZSA+IDApIHsKICAgICAgICBjb25zb2xlLndhcm4oYOivt+axgueahOmhteeggSAke25ld1BhZ2V9IOi2heWHuuacgOWkp+mhteeggSAke21heFBhZ2V977yM6Ieq5Yqo6LCD5pW05Li65pyA5aSn6aG156CBYCk7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICBwYWdlLnZhbHVlID0gbWF4UGFnZTsKICAgICAgICB9LCAwKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH07CgogICAgLy8g55uR5ZCs6aG156CB5Y+Y5YyW77yM5Yqg6L295a+55bqU6aG16Z2i5pWw5o2uCiAgICB3YXRjaCgoKSA9PiBwYWdlLnZhbHVlLCBhc3luYyAobmV3UGFnZSwgb2xkUGFnZSkgPT4gewogICAgICBjb25zb2xlLmxvZyhg6aG156CB5Y+Y5YyWOiAke29sZFBhZ2V9IC0+ICR7bmV3UGFnZX1gKTsKICAgICAgaWYgKG5ld1BhZ2UgPT09IG9sZFBhZ2UpIHJldHVybjsKCiAgICAgIC8vIOajgOafpemhteeggeiMg+WbtAogICAgICBjb25zdCBtYXhQYWdlID0gTWF0aC5jZWlsKHRvdGFsQ291bnQudmFsdWUgLyBwYWdlU2l6ZSk7CiAgICAgIGlmIChuZXdQYWdlID4gbWF4UGFnZSAmJiBtYXhQYWdlID4gMCkgewogICAgICAgIGNvbnNvbGUud2Fybihg6aG156CBICR7bmV3UGFnZX0g6LaF5Ye65pyA5aSn6aG156CBICR7bWF4UGFnZX3vvIzoh6rliqjosIPmlbTkuLrmnIDlpKfpobXnoIFgKTsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHBhZ2UudmFsdWUgPSBtYXhQYWdlOwogICAgICAgIH0sIDApOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIC8vIOaYvuekuuWKoOi9veeKtuaAgQogICAgICAgIGNyZWF0ZUxvYWRpbmcudmFsdWUgPSB0cnVlOwoKICAgICAgICAvLyDph43nva5oYXNNb3Jl5qCH5b+X77yM56Gu5L+d5Y+v5Lul5Yqg6L295pWw5o2uCiAgICAgICAgaGFzTW9yZS52YWx1ZSA9IHRydWU7CgogICAgICAgIC8vIOiOt+WPluaWsOmhtemdouaVsOaNrgogICAgICAgIGF3YWl0IGZldGNoRG9jdW1lbnRzKGZhbHNlLCBmYWxzZSwgRGF0ZS5ub3coKSk7CgogICAgICAgIC8vIOa7muWKqOWIsOWIl+ihqOmhtumDqAogICAgICAgIGNvbnN0IGRvY1NlY3Rpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VjdGlvbicpOwogICAgICAgIGlmIChkb2NTZWN0aW9uKSB7CiAgICAgICAgICBkb2NTZWN0aW9uLnNjcm9sbEludG9WaWV3KHsKICAgICAgICAgICAgYmVoYXZpb3I6ICdzbW9vdGgnCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign6aG156CB5Y+Y5YyW5Yqg6L295aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WKoOi9veaVsOaNruWksei0pe+8jOivt+mHjeivlScpOwoKICAgICAgICAvLyDlpoLmnpzmmK80MDTplJnor6/vvIzoh6rliqjov5Tlm57mnInmlYjpobXnoIEKICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UgJiYgZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgIGNvbnNvbGUud2Fybign6aG156CB5LiN5a2Y5Zyo77yM6L+U5Zue56ys5LiA6aG1Jyk7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgcGFnZS52YWx1ZSA9IDE7CiAgICAgICAgICB9LCAwKTsKICAgICAgICB9CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgY3JlYXRlTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICB9CiAgICB9KTsKCiAgICAvLyDmt7vliqDliqDovb3mm7TlpJrmlofmoaPnmoTmlrnms5UKICAgIGNvbnN0IGxvYWRNb3JlRG9jdW1lbnRzID0gKCkgPT4gewogICAgICBpZiAobG9hZGluZ01vcmUudmFsdWUgfHwgIWhhc01vcmUudmFsdWUpIHJldHVybjsKICAgICAgcGFnZS52YWx1ZSsrOwogICAgICBmZXRjaERvY3VtZW50cyhmYWxzZSwgdHJ1ZSk7CiAgICB9OwoKICAgIC8vIOeUn+WRveWRqOacn+mSqeWtkAogICAgb25Nb3VudGVkKCgpID0+IHsKICAgICAgY29uc29sZS5sb2coJ1NtYXJ0RG9j57uE5Lu2bW91bnRlZO+8jOWKoOi9veaVsOaNricpOwoKICAgICAgLy8g5qOA5p+lVVJM5Lit5piv5ZCm5pyJX3JlZnJlc2jlj4LmlbAKICAgICAgY29uc3QgcmVmcmVzaFBhcmFtID0gcm91dGUucXVlcnkuX3JlZnJlc2g7CiAgICAgIGlmIChyZWZyZXNoUGFyYW0pIHsKICAgICAgICBjb25zb2xlLmxvZygn5qOA5rWL5YiwVVJM5Lit55qE5Yi35paw5Y+C5pWwOicsIHJlZnJlc2hQYXJhbSk7CiAgICAgICAgLy8g5by65Yi25Yi35paw77yM56Gu5L+d5paH5qGj5YiX6KGo5piv5pyA5paw55qECiAgICAgICAgcmVmcmVzaFRyaWdnZXIudmFsdWUgPSBEYXRlLm5vdygpOwogICAgICAgIC8vIOiuvue9ruS4gOS4qui2heefreW7tui/n++8jOehruS/nURPTeW3sue7j+WujOWFqOaMgui9vQogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgcmVsb2FkQWxsRGF0YSgpOwogICAgICAgIH0sIDEwKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDmraPluLjliqDovb3mlbDmja4KICAgICAgICByZWxvYWRBbGxEYXRhKCk7CiAgICAgIH0KICAgIH0pOwogICAgY29uc3QgaGFuZGxlSW1wb3J0V29yZCA9ICgpID0+IHsKICAgICAgLy8g5Yib5bu65LiA5Liq6ZqQ6JeP55qE5paH5Lu25LiK5LygaW5wdXQKICAgICAgY29uc3QgZmlsZUlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7CiAgICAgIGZpbGVJbnB1dC5hY2NlcHQgPSAnLmRvY3gsLmRvYyc7CiAgICAgIGZpbGVJbnB1dC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZpbGVJbnB1dCk7CgogICAgICAvLyDnm5HlkKzmlofku7bpgInmi6nkuovku7YKICAgICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGFzeW5jIGV2ZW50ID0+IHsKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0LmZpbGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGNvbnN0IGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXNbMF07CgogICAgICAgICAgLy8g5pi+56S65Yqg6L295Lit77yM5L2/55So5YWo5bGP5Yqg6L2977yM56aB5q2i55So5oi35pON5L2cCiAgICAgICAgICBjb25zdCBsb2FkaW5nSW5zdGFuY2UgPSBFbExvYWRpbmcuc2VydmljZSh7CiAgICAgICAgICAgIGZ1bGxzY3JlZW46IHRydWUsCiAgICAgICAgICAgIHRleHQ6ICfmraPlnKjlr7zlhaVXb3Jk5paH5qGjLi4uJywKICAgICAgICAgICAgYmFja2dyb3VuZDogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC44KScsCiAgICAgICAgICAgIGxvY2s6IHRydWUgLy8g6ZSB5a6a5bGP5bmV77yM6Ziy5q2i55So5oi35pON5L2cCiAgICAgICAgICB9KTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIOWIm+W7ukZvcm1EYXRh5a+56LGhCiAgICAgICAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGUpOwoKICAgICAgICAgICAgLy8g5Y+R6YCB6K+35rGC77yM6LCD55SoQVBJCiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaW1wb3J0V29yZERvY3VtZW50KGZvcm1EYXRhKTsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmlkKSB7CiAgICAgICAgICAgICAgLy8g5YWI5Yi35paw5paH5qGj6aaW6aG1CiAgICAgICAgICAgICAgYXdhaXQgcmVsb2FkQWxsRGF0YSgpOwoKICAgICAgICAgICAgICAvLyDmmL7npLrmiJDlip/mtojmga8KICAgICAgICAgICAgICBFbE1lc3NhZ2Uuc3VjY2VzcygnV29yZOaWh+aho+WvvOWFpeaIkOWKnycpOwoKICAgICAgICAgICAgICAvLyDlu7bov5/kuIDnp5LlkI7ot7PovazvvIznoa7kv53nlKjmiLfnnIvliLDliLfmlrDmlYjmnpzlkozmiJDlip/mj5DnpLoKICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIC8vIOWvvOWFpeaIkOWKn+WQjui3s+i9rOWIsOaWh+aho+ivpuaDhemhtQogICAgICAgICAgICAgICAgcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgICBuYW1lOiAnU21hcnREb2NEZXRhaWwnLAogICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICBpZDogcmVzcG9uc2UuaWQKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgcXVlcnk6IHsKICAgICAgICAgICAgICAgICAgICBfcmVmcmVzaDogRGF0ZS5ub3coKQogICAgICAgICAgICAgICAgICB9IC8vIOa3u+WKoOWIt+aWsOWPguaVsO+8jOehruS/neivpuaDhemhteWIt+aWsAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSwgMTAwMCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCflr7zlhaXlpLHotKXvvJonICsgKChyZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2UuZGV0YWlsKSB8fCAn5pyq55+l6ZSZ6K+vJykpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCflr7zlhaVXb3Jk5paH5qGj5Ye66ZSZOicsIGVycm9yKTsKICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCflr7zlhaVXb3Jk5paH5qGj5aSx6LSlOiAnICsgKGVycm9yLm1lc3NhZ2UgfHwgJ+acquefpemUmeivrycpKTsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIC8vIOehruS/neS4gOWumuaXtumXtOWQjuWFs+mXreWKoOi9veaPkOekuu+8jOmYsuatoueVjOmdouWNoeatuwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICBsb2FkaW5nSW5zdGFuY2UuY2xvc2UoKTsKICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGZpbGVJbnB1dCk7CiAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIC8vIOinpuWPkeaWh+S7tumAieaLqeWvueivneahhgogICAgICBmaWxlSW5wdXQuY2xpY2soKTsKICAgIH07CiAgICBjb25zdCByZW1vdmVTaGFyZWRVc2VyID0gdXNlcklkVG9SZW1vdmUgPT4gewogICAgICBjb25zb2xlLmxvZygn5bCd6K+V56e76Zmk55So5oi35p2D6ZmQOicsIHVzZXJJZFRvUmVtb3ZlKTsKICAgICAgY29uc3QgdXNlclRvUmVtb3ZlID0gZXhpc3RpbmdTaGFyZWRVc2Vycy52YWx1ZS5maW5kKHUgPT4gdS51c2VyX2lkID09PSB1c2VySWRUb1JlbW92ZSk7CiAgICAgIGlmICh1c2VyVG9SZW1vdmUpIHsKICAgICAgICBjb25zb2xlLmxvZygn5om+5Yiw6KaB56e76Zmk5p2D6ZmQ55qE55So5oi3OicsIHVzZXJUb1JlbW92ZSk7CiAgICAgICAgLy8g5bCG55So5oi35re75Yqg5Zue5Y+v6YCJ5YiX6KGoCiAgICAgICAgYXZhaWxhYmxlVXNlcnMudmFsdWUucHVzaCh7CiAgICAgICAgICBpZDogdXNlclRvUmVtb3ZlLnVzZXJfaWQsCiAgICAgICAgICB1c2VybmFtZTogdXNlclRvUmVtb3ZlLnVzZXJuYW1lCiAgICAgICAgfSk7CgogICAgICAgIC8vIOS7juW3suWIhuS6q+WIl+ihqOS4reenu+mZpAogICAgICAgIGV4aXN0aW5nU2hhcmVkVXNlcnMudmFsdWUgPSBleGlzdGluZ1NoYXJlZFVzZXJzLnZhbHVlLmZpbHRlcih1ID0+IHUudXNlcl9pZCAhPT0gdXNlcklkVG9SZW1vdmUpOwogICAgICAgIGNvbnNvbGUubG9nKCfnp7vpmaTlkI7nmoTlt7LliIbkuqvnlKjmiLfliJfooag6JywgZXhpc3RpbmdTaGFyZWRVc2Vycy52YWx1ZSk7CgogICAgICAgIC8vIOaYvuekuuaPkOekugogICAgICAgIEVsTWVzc2FnZSh7CiAgICAgICAgICBtZXNzYWdlOiBg5bey56e76Zmk55So5oi3ICR7dXNlclRvUmVtb3ZlLnVzZXJuYW1lfSDnmoTmnYPpmZDvvIzngrnlh7vliIbkuqvmjInpkq7kv53lrZjmm7TmlLlgLAogICAgICAgICAgdHlwZTogJ3dhcm5pbmcnCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc29sZS53YXJuKCfmnKrmib7liLDopoHnp7vpmaTnmoTnlKjmiLc6JywgdXNlcklkVG9SZW1vdmUpOwogICAgICB9CiAgICB9OwogICAgcmV0dXJuIHsKICAgICAgZG9jdW1lbnRzLAogICAgICByZWNlbnREb2N1bWVudHMsCiAgICAgIHNoYXJlZERvY3VtZW50cywKICAgICAgZG9jdW1lbnRDYXRlZ29yaWVzLAogICAgICBzZWFyY2hRdWVyeSwKICAgICAgc2VhcmNoQ2F0ZWdvcnksCiAgICAgIHRvdGFsRG9jdW1lbnRzLAogICAgICByZWNlbnRFZGl0Q291bnQsCiAgICAgIG5ld0RvY3VtZW50RGlhbG9nVmlzaWJsZSwKICAgICAgc2hhcmVEaWFsb2dWaXNpYmxlLAogICAgICBkZWxldGVEaWFsb2dWaXNpYmxlLAogICAgICBkb2N1bWVudENyZWF0ZVR5cGUsCiAgICAgIG5ld0RvY3VtZW50Rm9ybSwKICAgICAgYWlEb2N1bWVudEZvcm0sCiAgICAgIGJsYW5rRm9ybVJ1bGVzLAogICAgICBhaUZvcm1SdWxlcywKICAgICAgYmxhbmtGb3JtUmVmLAogICAgICBhaUZvcm1SZWYsCiAgICAgIHNlbGVjdGVkRG9jdW1lbnQsCiAgICAgIHNlbGVjdGVkVXNlcnMsCiAgICAgIHNlbGVjdGVkVXNlcnNXaXRoUGVybWlzc2lvbnMsCiAgICAgIGF2YWlsYWJsZVVzZXJzLAogICAgICBhdmFpbGFibGVDaGF0VXNlcnMsCiAgICAgIGNyZWF0ZUxvYWRpbmcsCiAgICAgIHNoYXJlTG9hZGluZywKICAgICAgZGVsZXRlTG9hZGluZywKICAgICAgY3JlYXRlTmV3RG9jdW1lbnQsCiAgICAgIHN1Ym1pdE5ld0RvY3VtZW50LAogICAgICBvcGVuRG9jdW1lbnQsCiAgICAgIGVkaXREb2N1bWVudCwKICAgICAgc3VibWl0RWRpdERvY3VtZW50LAogICAgICBleHBvcnREb2N1bWVudCwKICAgICAgc2hhcmVEb2N1bWVudCwKICAgICAgY29uZmlybVNoYXJlLAogICAgICBkZWxldGVEb2N1bWVudCwKICAgICAgY29uZmlybURlbGV0ZSwKICAgICAgdmlld0FsbERvY3VtZW50cywKICAgICAgZm9ybWF0RGF0ZSwKICAgICAgY2F0ZWdvcnlEaWFsb2dWaXNpYmxlLAogICAgICBlZGl0aW5nQ2F0ZWdvcnksCiAgICAgIGNhdGVnb3J5Rm9ybVJlZiwKICAgICAgY2F0ZWdvcnlMb2FkaW5nLAogICAgICBjYXRlZ29yeUZvcm1SdWxlcywKICAgICAgZWRpdENhdGVnb3J5LAogICAgICByZXNldENhdGVnb3J5Rm9ybSwKICAgICAgc3VibWl0Q2F0ZWdvcnksCiAgICAgIGRlbGV0ZUNhdGVnb3J5LAogICAgICByZXNldENhdGVnb3J5RmlsdGVyLAogICAgICBzZWxlY3RDYXRlZ29yeSwKICAgICAgZ2V0U2VsZWN0ZWRDYXRlZ29yeUNvbG9yLAogICAgICBnZXRTZWxlY3RlZENhdGVnb3J5TmFtZSwKICAgICAgbWFuYWdlQ2F0ZWdvcmllcywKICAgICAgcmVsb2FkQWxsRGF0YSwKICAgICAgcmVmcmVzaERhdGEsCiAgICAgIHJlZnJlc2hUcmlnZ2VyLAogICAgICBoYXNNb3JlLAogICAgICBsb2FkaW5nTW9yZSwKICAgICAgbG9hZE1vcmVEb2N1bWVudHMsCiAgICAgIGV4cG9ydFRvUGRmLAogICAgICBleHBvcnRUb1dvcmQsCiAgICAgIC8vIOa3u+WKoOe8lui+keWvueivneahhuebuOWFs+WPmOmHjwogICAgICBlZGl0RGlhbG9nVmlzaWJsZSwKICAgICAgZWRpdERvY3VtZW50Rm9ybSwKICAgICAgZWRpdEZvcm1SZWYsCiAgICAgIGVkaXRMb2FkaW5nLAogICAgICBlZGl0Rm9ybVJ1bGVzLAogICAgICAvLyDmt7vliqDliIbpobXlpITnkIbmlrnms5UKICAgICAgb25QYWdlQ2hhbmdlLAogICAgICBwYWdlLAogICAgICBwYWdlU2l6ZSwKICAgICAgdG90YWxDb3VudCwKICAgICAgLy8g5byA5Y+R546v5aKD5qCH5b+XCiAgICAgICRfaXNEZXYsCiAgICAgIC8vIOa3u+WKoOebtOaOpUFQSeiwg+eUqOWHveaVsAogICAgICBmZXRjaERvY3VtZW50cywKICAgICAgLy8g5re75Yqg5YiG5Lqr5pa55byP55u45YWz5Y+Y6YePCiAgICAgIHNoYXJlTW9kZSwKICAgICAgc2hhcmVGb3JtYXQsCiAgICAgIHNlbGVjdGVkQ2hhdFVzZXJzLAogICAgICBoYW5kbGVJbXBvcnRXb3JkLAogICAgICBnZXRVc2VybmFtZUJ5SWQsCiAgICAgIGhhbmRsZVVzZXJTZWxlY3Rpb25DaGFuZ2UsCiAgICAgIGhhbmRsZVNoYXJlTW9kZUNoYW5nZSwKICAgICAgZ2V0Q3VycmVudFVzZXJJZCwKICAgICAgZXhpc3RpbmdTaGFyZWRVc2VycywKICAgICAgcmVtb3ZlU2hhcmVkVXNlcgogICAgfTsKICB9Cn07"},{"version":3,"names":["ref","computed","onMounted","nextTick","getCurrentInstance","provide","onActivated","watch","useRouter","useRoute","ElMessage","ElMessageBox","ElLoading","Search","Plus","EditPen","Share","Folder","Close","More","Document","Clock","Upload","User","_","getDocuments","getRecentDocuments","getSharedDocuments","getDocumentCategories","createDocument","deleteDocument","apiDeleteDocument","shareDocument","apiShareDocument","createDocumentCategory","updateDocumentCategory","deleteDocumentCategory","aiGenerateDocument","getDocumentDetail","updateDocument","importWordDocument","userApi","createChatSession","getChatSessions","request","name","components","setup","router","route","proxy","$_isDev","process","env","NODE_ENV","refreshTrigger","Date","now","documents","recentDocuments","sharedDocuments","documentCategories","searchQuery","searchCategory","newDocumentDialogVisible","shareDialogVisible","deleteDialogVisible","documentCreateType","selectedDocument","selectedUsers","selectedUsersWithPermissions","availableUsers","availableChatUsers","createLoading","shareLoading","deleteLoading","existingSharedUsers","shareMode","shareFormat","selectedChatUsers","page","pageSize","totalCount","grandTotalCount","hasMore","loadingMore","editDialogVisible","editDocumentForm","id","title","type","category_id","editLoading","newDocumentForm","aiDocumentForm","requirements","blankFormRules","required","message","trigger","min","max","aiFormRules","editFormRules","blankFormRef","aiFormRef","editFormRef","totalDocuments","value","recentEditCount","length","categoryDialogVisible","editingCategory","color","description","categoryFormRef","categoryLoading","categoryFormRules","forceUpdate","$forceUpdate","fetchDocuments","forceRefresh","append","timestamp","console","log","filters","category","search","params","page_size","_t","getTime","Object","assign","res","newDocuments","currentViewCount","warning","warn","duration","includes","setTimeout","data","Array","isArray","total","count","results","existingIds","Set","map","doc","uniqueNewDocs","filter","has","d","join","totalPages","Math","ceil","Promise","resolve","error","fetchRecentDocuments","fetchSharedDocuments","response","fetchDocumentCategories","retryCount","status","debounce","createNewDocument","dialog","document","querySelector","addEventListener","clearValidate","err","once","submitNewDocument","valid","validate","catch","content","JSON","stringify","success","docId","push","then","navErr","categoryId","requirement","doc_type","_response$data","detail","String","openDocument","editDocument","event","stopPropagation","Number","submitEditDocument","updateData","reloadAllData","exportDocument","showCancelButton","confirmButtonText","cancelButtonText","closeOnClickModal","callback","action","exportToPdf","exportToWord","loading","service","lock","text","background","documentContent","close","docTitle","filename","tempContainer","createElement","innerHTML","className","body","appendChild","options","margin","image","quality","html2canvas","scale","useCORS","jsPDF","unit","format","orientation","setText","html2pdfModule","html2pdf","default","from","set","save","removeChild","contentContainer","msWordHtml","FileSaver","saveAs","blob","Blob","detailRes","sharedWithData","shared_with","permissions","item","user","user_id","username","email","permission","userId","existingUserIds","u","currentUserJson","localStorage","getItem","currentUserId","companyId","currentUser","parse","company_id","isCreator","creator","usersRes","getCompanyUsers","getUsernameById","find","getCurrentUserId","handleUserSelectionChange","val","handleShareModeChange","confirmShare","finalPermissions","docResponse","currentDoc","documentFile","fileName","fileType","outputPdf","sessionsResponse","chatSessions","userSessionMap","Map","existingSession","session","participants","hasCurrentUser","some","p","hasTargetUser","newSessionPromises","participant_ids","all","sendPromises","failedUsers","chatId","get","formData","FormData","file","File","url","method","headers","timeout","sendResults","successCount","result","totalAttempted","totalSelected","confirmDelete","_selectedDocument$val","deletedDocId","deletedDocCategoryId","window","removeItem","e","c","document_count","currentRoute","replace","query","_refresh","refreshData","viewAllDocuments","docSection","scrollIntoView","behavior","selectCategory","toString","docCards","querySelectorAll","forEach","card","index","style","animationDelay","classList","remove","add","getSelectedCategoryColor","selectedCategory","getSelectedCategoryName","manageCategories","resetCategoryForm","editCategory","resetFields","submitCategory","categoryData","deleteCategory","confirm","formatDate","dateString","date","toDateString","toLocaleTimeString","hour","minute","yesterday","setDate","getDate","weekDays","diffDays","round","getDay","toLocaleDateString","month","day","resetCategoryFilter","","","","","","newVal","path","newPath","oldPath","startsWith","onPageChange","newPage","maxPage","oldPage","loadMoreDocuments","refreshParam","handleImportWord","fileInput","accept","display","target","files","loadingInstance","fullscreen","click","removeSharedUser","userIdToRemove","userToRemove"],"sources":["C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\smartdoc\\Index.vue"],"sourcesContent":["<template>\n  <div class=\"smartdoc-home-container\">\n    <!--  -->\n    <div style=\"display: none;\">{{ refreshTrigger }}</div>\n    \n    <!--  -->\n    <div class=\"page-header\">\n      <div class=\"left-section\">\n        <h2 class=\"page-title\"></h2>\n        <p class=\"page-description\"></p>\n        </div>\n      <div class=\"right-section\">\n        <div class=\"search-controls\">\n          <el-select \n            v-model=\"searchCategory\" \n            placeholder=\"\" \n            @change=\"selectCategory(searchCategory)\" \n            class=\"category-select\"\n          >\n            <el-option label=\"\" value=\"all\" />\n            <el-option \n              v-for=\"category in documentCategories\" \n              :key=\"category.id\" \n              :label=\"category.name\" \n              :value=\"category.id.toString()\"\n            />\n          </el-select>\n          \n          <el-input\n            placeholder=\"...\"\n            v-model=\"searchQuery\"\n          class=\"search-input\"\n            clearable\n          >\n            <template #prefix>\n              <el-icon><Search /></el-icon>\n            </template>\n          </el-input>\n        </div>\n        \n        <el-button type=\"success\" @click=\"handleImportWord\" style=\"margin-right: 10px;\">\n          <el-icon><Upload /></el-icon> Word\n        </el-button>\n        <el-button type=\"primary\" @click=\"createNewDocument\">\n          <el-icon><Plus /></el-icon> \n        </el-button>\n          </div>\n        </div>\n\n    <!--  -->\n    <div class=\"stats-cards\">\n      <el-card class=\"stat-card\" shadow=\"hover\" @click=\"selectCategory('all')\">\n        <div class=\"stat-content\">\n          <div class=\"stat-icon doc-icon\">\n                <el-icon><Document /></el-icon>\n              </div>\n          <div class=\"stat-info\">\n            <div class=\"stat-value\">{{ totalDocuments }}</div>\n            <div class=\"stat-label\"></div>\n                </div>\n              </div>\n      </el-card>\n      \n      <el-card class=\"stat-card\" shadow=\"hover\">\n        <div class=\"stat-content\">\n          <div class=\"stat-icon edit-icon\">\n            <el-icon><EditPen /></el-icon>\n            </div>\n          <div class=\"stat-info\">\n            <div class=\"stat-value\">{{ recentEditCount }}</div>\n            <div class=\"stat-label\"></div>\n          </div>\n        </div>\n      </el-card>\n      \n      <el-card class=\"stat-card\" shadow=\"hover\">\n        <div class=\"stat-content\">\n          <div class=\"stat-icon share-icon\">\n            <el-icon><Share /></el-icon>\n          </div>\n          <div class=\"stat-info\">\n            <div class=\"stat-value\">{{ sharedDocuments.length }}</div>\n            <div class=\"stat-label\"></div>\n            </div>\n        </div>\n      </el-card>\n    </div>\n\n    <!--  -->\n    <div v-if=\"searchCategory !== 'all'\" class=\"filter-status-bar\">\n      <div class=\"filter-bar-content\">\n        <div class=\"filter-title\">\n          <span>: </span>\n          <span class=\"filter-category\" :style=\"{ backgroundColor: getSelectedCategoryColor() }\">\n            {{ getSelectedCategoryName() }}\n          </span>\n        </div>\n        <div class=\"filter-actions\">\n          <el-button type=\"primary\" link @click=\"resetCategoryFilter\">\n            <el-icon><Close /></el-icon> \n          </el-button>\n        </div>\n      </div>\n    </div>\n\n    <!--  -  -->\n    <div class=\"section category-section\">\n      <div class=\"section-header\">\n        <h3></h3>\n        <div class=\"section-actions\">\n          <el-button text @click=\"manageCategories\"></el-button>\n        </div>\n      </div>\n      \n      <div class=\"category-cards\">\n        <!--  -->\n        <div \n          class=\"category-card\" \n          :class=\"{ 'category-active': searchCategory === 'all' }\"\n          @click=\"selectCategory('all')\"\n        >\n          <div class=\"category-icon\" :style=\"{ backgroundColor: '#409EFF' }\">\n            <el-icon><Document /></el-icon>\n          </div>\n          <div class=\"category-info\">\n            <h4></h4>\n            <div class=\"category-count\">{{ totalDocuments }} </div>\n          </div>\n          <div v-if=\"searchCategory === 'all'\" class=\"category-selected-indicator\"></div>\n        </div>\n        \n        <!--  -->\n        <div \n          v-for=\"category in documentCategories\" \n          :key=\"category.id\" \n          class=\"category-card\" \n          :class=\"{ 'category-active': searchCategory === category.id.toString() }\"\n          @click=\"selectCategory(category)\"\n        >\n          <div class=\"category-icon\" :style=\"{ backgroundColor: category.color }\">\n            <el-icon><Folder /></el-icon>\n          </div>\n          <div class=\"category-info\">\n            <h4>{{ category.name }}</h4>\n            <div class=\"category-count\">{{ category.document_count }} </div>\n          </div>\n          <div v-if=\"searchCategory === category.id.toString()\" class=\"category-selected-indicator\"></div>\n        </div>\n      </div>\n    </div>\n\n    <!--  -->\n    <div class=\"section\">\n      <div class=\"section-header\">\n        <h3></h3>\n        <div class=\"filter-controls\">\n          <el-button text @click=\"() => fetchDocuments(true)\"></el-button>\n        </div>\n              </div>\n      \n      <div class=\"document-cards\">\n        <el-card \n          v-for=\"doc in documents\" \n          :key=\"doc.id\" \n          class=\"doc-card\" \n          shadow=\"hover\"\n          @click=\"openDocument(doc)\"\n        >\n          <div class=\"doc-card-header\">\n            <div class=\"doc-info\">\n              <div class=\"doc-type-tag\">{{ doc.type }}</div>\n              <div v-if=\"doc.category\" \n                   class=\"doc-category-tag\" \n                   :style=\"{ backgroundColor: doc.category.color || '#67C23A' }\"\n              >\n                {{ doc.category.name }}\n              </div>\n              <!--  -->\n              <div v-if=\"doc.is_shared\" class=\"doc-shared-tag\">\n                <el-icon><User /></el-icon>\n                <span></span>\n              </div>\n            </div>\n            <div class=\"doc-menu btn-container\" @click.stop>\n              <el-dropdown trigger=\"click\" @click.stop>\n                <el-icon><More /></el-icon>\n                <template #dropdown>\n                  <el-dropdown-menu>\n                    <el-dropdown-item @click.stop=\"openDocument(doc)\"></el-dropdown-item>\n                    <el-dropdown-item @click.stop=\"editDocument(doc, $event)\"></el-dropdown-item>\n                    <el-dropdown-item @click.stop=\"exportDocument(doc)\"></el-dropdown-item>\n                    <el-dropdown-item @click.stop=\"shareDocument(doc)\"></el-dropdown-item>\n                    <el-dropdown-item divided @click.stop=\"deleteDocument(doc)\" type=\"danger\"></el-dropdown-item>\n                  </el-dropdown-menu>\n                </template>\n              </el-dropdown>\n            </div>\n          </div>\n          \n          <div class=\"card-content-area\">\n            <h4 class=\"doc-title\" :title=\"doc.title\">{{ doc.title }}</h4>\n            <div class=\"doc-preview\" v-html=\"doc.preview || ''\"></div>\n          </div>\n          \n          <div class=\"doc-footer\">\n            <div class=\"doc-time\">\n              <el-icon><Clock /></el-icon>\n              <span>{{ formatDate(doc.update_time) }}</span>\n            </div>\n            <div class=\"doc-actions btn-container\">\n              <el-tooltip content=\"\" placement=\"top\">\n                <el-button link circle size=\"small\" @click.stop=\"editDocument(doc, $event)\">\n                  <el-icon><EditPen /></el-icon>\n                </el-button>\n              </el-tooltip>\n              <el-tooltip content=\"\" placement=\"top\">\n                <el-button link circle size=\"small\" @click.stop=\"shareDocument(doc)\">\n                  <el-icon><Share /></el-icon>\n                </el-button>\n              </el-tooltip>\n            </div>\n          </div>\n        </el-card>\n        \n        <!--  -->\n        <div class=\"doc-card new-doc-card\" @click=\"createNewDocument\">\n          <div class=\"new-doc-content\">\n            <el-icon><Plus /></el-icon>\n            <span></span>\n          </div>\n        </div>\n      </div>\n      \n      <!--  -->\n      <div v-if=\"totalCount > 0\" class=\"pagination-container\">\n        <el-pagination\n          background\n          layout=\"prev, pager, next, jumper\"\n          :total=\"totalCount\"\n          :page-size=\"pageSize\"\n          v-model:current-page=\"page\"\n          @current-change=\"onPageChange\"\n          :pager-count=\"5\"\n          :disabled=\"createLoading\"\n        />\n        <!-- () -->\n        <div v-if=\"$_isDev\" class=\"pagination-debug\">\n          <small>: {{ page }} / : {{ Math.ceil(totalCount / pageSize) || 0 }} ({{ totalCount }})</small>\n        </div>\n      </div>\n    </div>\n\n    <!--  -->\n    <div class=\"section\">\n      <div class=\"section-header\">\n        <h3></h3>\n        <div class=\"section-actions\">\n          <el-button text @click=\"viewAllDocuments('recent')\"></el-button>\n        </div>\n      </div>\n      \n      <div class=\"document-cards\">\n        <el-card \n          v-for=\"doc in recentDocuments\" \n          :key=\"doc.id\" \n          class=\"doc-card\" \n          shadow=\"hover\"\n          @click=\"openDocument(doc)\"\n        >\n          <div class=\"doc-card-header\">\n            <div class=\"doc-info\">\n              <div class=\"doc-type-tag\">{{ doc.type }}</div>\n              <div v-if=\"doc.category\" \n                   class=\"doc-category-tag\" \n                   :style=\"{ backgroundColor: doc.category.color || '#67C23A' }\"\n              >\n                {{ doc.category.name }}\n              </div>\n              <!--  -->\n              <div v-if=\"doc.is_shared\" class=\"doc-shared-tag\">\n                <el-icon><User /></el-icon>\n                <span></span>\n              </div>\n            </div>\n            <div class=\"doc-menu btn-container\" @click.stop>\n              <el-dropdown trigger=\"click\" @click.stop>\n                <el-icon><More /></el-icon>\n                <template #dropdown>\n                  <el-dropdown-menu>\n                    <el-dropdown-item @click.stop=\"openDocument(doc)\"></el-dropdown-item>\n                    <el-dropdown-item @click.stop=\"editDocument(doc, $event)\"></el-dropdown-item>\n                    <el-dropdown-item @click.stop=\"exportDocument(doc)\"></el-dropdown-item>\n                    <el-dropdown-item @click.stop=\"shareDocument(doc)\"></el-dropdown-item>\n                    <el-dropdown-item divided @click.stop=\"deleteDocument(doc)\" type=\"danger\"></el-dropdown-item>\n                  </el-dropdown-menu>\n                </template>\n              </el-dropdown>\n            </div>\n          </div>\n          \n          <div class=\"card-content-area\">\n            <h4 class=\"doc-title\" :title=\"doc.title\">{{ doc.title }}</h4>\n            <div class=\"doc-preview\" v-html=\"doc.preview || ''\"></div>\n          </div>\n          \n          <div class=\"doc-footer\">\n            <div class=\"doc-time\">\n              <el-icon><Clock /></el-icon>\n              <span>{{ formatDate(doc.update_time) }}</span>\n            </div>\n            <div class=\"doc-actions btn-container\">\n              <el-tooltip content=\"\" placement=\"top\">\n                <el-button link circle size=\"small\" @click.stop=\"editDocument(doc, $event)\">\n                  <el-icon><EditPen /></el-icon>\n                </el-button>\n              </el-tooltip>\n              <el-tooltip content=\"\" placement=\"top\">\n                <el-button link circle size=\"small\" @click.stop=\"shareDocument(doc)\">\n                  <el-icon><Share /></el-icon>\n                </el-button>\n              </el-tooltip>\n            </div>\n          </div>\n        </el-card>\n        \n        <!--  -->\n        <div class=\"doc-card new-doc-card\" @click=\"createNewDocument\">\n          <div class=\"new-doc-content\">\n            <el-icon><Plus /></el-icon>\n            <span></span>\n          </div>\n        </div>\n      </div>\n      \n      <div v-if=\"recentDocuments.length === 0\" class=\"empty-state\">\n        <!--  -->\n    </div>\n  </div>\n\n    <!--  -->\n  <el-dialog\n      v-model=\"newDocumentDialogVisible\"\n      title=\"\"\n      width=\"35%\"\n    >\n      <el-tabs v-model=\"documentCreateType\">\n        <el-tab-pane label=\"\" name=\"blank\" />\n        <el-tab-pane label=\"AI\" name=\"ai\" />\n      </el-tabs>\n\n      <div v-if=\"documentCreateType === 'blank'\">\n        <el-form\n          :model=\"newDocumentForm\"\n          label-width=\"80px\"\n          class=\"mt-4\"\n          :rules=\"blankFormRules\"\n          ref=\"blankFormRef\"\n        >\n          <el-form-item label=\"\" prop=\"title\">\n            <el-input v-model=\"newDocumentForm.title\" placeholder=\"\" />\n          </el-form-item>\n          <el-form-item label=\"\">\n            <el-input v-model=\"newDocumentForm.type\" placeholder=\"\" />\n            <div class=\"form-tip\"></div>\n          </el-form-item>\n        </el-form>\n      </div>\n\n      <div v-if=\"documentCreateType === 'ai'\">\n        <el-form\n          :model=\"aiDocumentForm\"\n          label-width=\"80px\"\n          class=\"mt-4\"\n          :rules=\"aiFormRules\"\n          ref=\"aiFormRef\"\n        >\n          <el-form-item label=\"\" prop=\"title\">\n            <el-input v-model=\"aiDocumentForm.title\" placeholder=\"\" />\n          </el-form-item>\n          <el-form-item label=\"\" prop=\"requirements\">\n            <el-input\n              v-model=\"aiDocumentForm.requirements\"\n              type=\"textarea\"\n              :rows=\"3\"\n              placeholder=\"\"\n            />\n            <div class=\"form-tip\"></div>\n          </el-form-item>\n        </el-form>\n      </div>\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"newDocumentDialogVisible = false\"></el-button>\n          <el-button type=\"primary\" @click=\"submitNewDocument\" :loading=\"createLoading\">\n            \n          </el-button>\n        </span>\n      </template>\n    </el-dialog>\n    \n    <!--  -->\n    <el-dialog\n      v-model=\"shareDialogVisible\"\n      title=\"\"\n      width=\"30%\"\n      class=\"share-dialog\"\n    >\n      <div v-if=\"selectedDocument\">\n        <p>: <strong>{{ selectedDocument.title }}</strong></p>\n        <el-form label-width=\"120px\" class=\"mt-4\">\n          <el-form-item label=\"\">\n            <el-radio-group v-model=\"shareMode\" @change=\"handleShareModeChange\">\n              <el-radio v-if=\"selectedDocument.creator && selectedDocument.creator.id === getCurrentUserId()\" :label=\"'permission'\"></el-radio>\n              <el-radio :label=\"'chat'\"></el-radio>\n            </el-radio-group>\n          </el-form-item>\n          \n          <!--  -->\n          <template v-if=\"shareMode === 'permission'\">\n            <el-form-item label=\"\" v-if=\"existingSharedUsers.length > 0\">\n              <div class=\"user-permissions-list\">\n                <div v-for=\"user in existingSharedUsers\" :key=\"user.user_id\" class=\"user-permission-item\">\n                  <span class=\"user-name\">{{ user.username }}</span>\n                  <div class=\"permission-info\">\n                    <el-tag type=\"info\" size=\"small\"></el-tag>\n                    <el-button type=\"danger\" link @click=\"removeSharedUser(user.user_id)\" style=\"margin-left: 10px;\"></el-button>\n                  </div>\n                </div>\n              </div>\n              <div class=\"form-tip\"> {{ existingSharedUsers.length }} </div>\n            </el-form-item>\n            \n            <el-form-item label=\"\">\n              <el-select\n                v-model.number=\"selectedUsers\"\n                multiple\n                placeholder=\"\"\n                style=\"width: 100%\"\n                popper-class=\"share-dialog-popper\"\n                @change=\"handleUserSelectionChange\"\n              >\n                <el-option\n                  v-for=\"user in availableUsers\"\n                  :key=\"user.id\"\n                  :label=\"user.username\"\n                  :value=\"user.id\"\n                />\n              </el-select>\n              <div class=\"form-tip\" v-if=\"availableUsers.length === 0\"></div>\n            </el-form-item>\n            \n            <template v-if=\"selectedUsers.length > 0\">\n              <el-form-item label=\"\">\n                <div class=\"user-permissions-list\">\n                  <div v-for=\"userPerm in selectedUsersWithPermissions\" :key=\"userPerm.user_id\" class=\"user-permission-item\">\n                    <span class=\"user-name\">{{ getUsernameById(userPerm.user_id) }}</span>\n                    <el-tag type=\"success\"></el-tag>\n                  </div>\n                </div>\n              </el-form-item>\n            </template>\n          </template>\n          \n          <!--  -->\n          <template v-if=\"shareMode === 'chat'\">\n            <el-form-item label=\"\">\n              <el-radio-group v-model=\"shareFormat\">\n                <el-radio label=\"pdf\">PDF</el-radio>\n                <el-radio label=\"word\">Word</el-radio>\n              </el-radio-group>\n            </el-form-item>\n            \n            <el-form-item label=\"\">\n              <el-select\n                v-model=\"selectedChatUsers\"\n                multiple\n                placeholder=\"\"\n                style=\"width: 100%\"\n                popper-class=\"share-dialog-popper\"\n              >\n                <el-option\n                  v-for=\"user in availableChatUsers\"\n                  :key=\"user.id\"\n                  :label=\"user.username\"\n                  :value=\"user.id\"\n                />\n              </el-select>\n              <div class=\"form-tip\"></div>\n            </el-form-item>\n          </template>\n        </el-form>\n      </div>\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"shareDialogVisible = false\"></el-button>\n          <el-button type=\"primary\" @click=\"confirmShare\" :loading=\"shareLoading\">\n            {{ shareMode === 'permission' ? '' : '' }}\n          </el-button>\n        </span>\n    </template>\n  </el-dialog>\n    \n    <!--  -->\n    <el-dialog\n      v-model=\"deleteDialogVisible\"\n      title=\"\"\n      width=\"30%\"\n    >\n      <div v-if=\"selectedDocument\">\n        <p> <strong>{{ selectedDocument.title }}</strong> ?</p>\n        <p class=\"warning-text\">!</p>\n  </div>\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"deleteDialogVisible = false\"></el-button>\n          <el-button type=\"danger\" @click=\"confirmDelete\" :loading=\"deleteLoading\">\n            \n          </el-button>\n        </span>\n      </template>\n    </el-dialog>\n    \n    <!--  -->\n    <el-dialog\n      v-model=\"categoryDialogVisible\"\n      title=\"\"\n      width=\"40%\"\n    >\n      <div class=\"category-management\">\n        <div class=\"category-list\">\n          <h4></h4>\n          <el-table :data=\"documentCategories\" style=\"width: 100%\">\n            <el-table-column prop=\"name\" label=\"\" />\n            <el-table-column label=\"\" width=\"120\">\n              <template #default=\"scope\">\n                <div class=\"color-preview\" :style=\"{ backgroundColor: scope.row.color }\"></div>\n                {{ scope.row.color }}\n              </template>\n            </el-table-column>\n            <el-table-column label=\"\" width=\"100\">\n              <template #default=\"scope\">\n                {{ scope.row.document_count || 0 }}\n              </template>\n            </el-table-column>\n            <el-table-column label=\"\" width=\"150\">\n              <template #default=\"scope\">\n                <el-button type=\"primary\" link @click=\"editCategory(scope.row)\"></el-button>\n                <el-button \n                  type=\"danger\" \n                  link \n                  @click=\"deleteCategory(scope.row)\"\n                  :disabled=\"scope.row.document_count > 0\"\n                ></el-button>\n              </template>\n            </el-table-column>\n          </el-table>\n        </div>\n        \n        <el-divider />\n        \n        <div class=\"category-form\">\n          <h4>{{ editingCategory.id ? '' : '' }}</h4>\n          <el-form \n            :model=\"editingCategory\" \n            :rules=\"categoryFormRules\" \n            label-width=\"80px\"\n            ref=\"categoryFormRef\"\n          >\n            <el-form-item label=\"\" prop=\"name\">\n              <el-input v-model=\"editingCategory.name\" placeholder=\"\" />\n            </el-form-item>\n            <el-form-item label=\"\" prop=\"color\">\n              <el-color-picker v-model=\"editingCategory.color\" />\n              <span class=\"color-value\">{{ editingCategory.color }}</span>\n            </el-form-item>\n            <el-form-item label=\"\">\n              <el-input \n                v-model=\"editingCategory.description\" \n                type=\"textarea\" \n                :rows=\"3\" \n                placeholder=\"\" \n              />\n            </el-form-item>\n            <el-form-item>\n              <el-button type=\"primary\" @click=\"submitCategory\" :loading=\"categoryLoading\">\n                {{ editingCategory.id ? '' : '' }}\n              </el-button>\n              <el-button @click=\"resetCategoryForm\"></el-button>\n            </el-form-item>\n          </el-form>\n        </div>\n      </div>\n    </el-dialog>\n\n    <!--  -->\n    <el-dialog\n      v-model=\"editDialogVisible\"\n      title=\"\"\n      width=\"35%\"\n    >\n      <el-form \n        :model=\"editDocumentForm\" \n        label-width=\"80px\" \n        class=\"mt-4\"\n        :rules=\"editFormRules\"\n        ref=\"editFormRef\"\n      >\n        <el-form-item label=\"\" prop=\"title\">\n          <el-input v-model=\"editDocumentForm.title\" placeholder=\"\" />\n        </el-form-item>\n        <el-form-item label=\"\">\n          <el-input v-model=\"editDocumentForm.type\" placeholder=\"\" />\n          <div class=\"form-tip\"></div>\n        </el-form-item>\n        <el-form-item label=\"\">\n          <el-select v-model=\"editDocumentForm.category_id\" placeholder=\"\" style=\"width: 100%\">\n            <el-option label=\"\" :value=\"null\" />\n            <el-option \n              v-for=\"category in documentCategories\" \n              :key=\"category.id\" \n              :label=\"category.name\" \n              :value=\"category.id\"\n            />\n          </el-select>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"editDialogVisible = false\"></el-button>\n          <el-button type=\"primary\" @click=\"submitEditDocument\" :loading=\"editLoading\">\n            \n          </el-button>\n        </span>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, onMounted, nextTick, getCurrentInstance, provide, onActivated, watch } from 'vue'\nimport { useRouter, useRoute } from 'vue-router'\nimport { ElMessage, ElMessageBox, ElLoading } from 'element-plus'\nimport { Search, Plus, EditPen, Share, Folder, Close, More, Document, Clock, Upload, User } from '@element-plus/icons-vue'\nimport _ from 'lodash'\nimport { \n  getDocuments,\n  getRecentDocuments,\n  getSharedDocuments,\n  getDocumentCategories,\n  createDocument,\n  deleteDocument as apiDeleteDocument,\n  shareDocument as apiShareDocument,\n  createDocumentCategory,\n  updateDocumentCategory,\n  deleteDocumentCategory,\n  aiGenerateDocument,\n  getDocumentDetail,\n  updateDocument,\n  importWordDocument\n} from '@/api/smartdoc'\nimport userApi from '@/api/user';\nimport { createChatSession, getChatSessions } from '@/api/chat';\nimport request from '@/utils/request';\n\nexport default {\n  name: 'SmartDocHome',\n  components: {\n    Search,\n    Plus,\n    EditPen,\n    Share,\n    Folder,\n    Close,\n    More,\n    Document,\n    Clock,\n    Upload,\n    User\n  },\n  setup() {\n    const router = useRouter()\n    const route = useRoute()\n    const { proxy } = getCurrentInstance() // \n    \n    // \n    const $_isDev = process.env.NODE_ENV === 'development'\n    \n    // \n    const refreshTrigger = ref(Date.now())\n    \n    // \n    const documents = ref([])\n    const recentDocuments = ref([])\n    const sharedDocuments = ref([])\n    const documentCategories = ref([])\n    const searchQuery = ref('')\n    const searchCategory = ref('all')\n    const newDocumentDialogVisible = ref(false)\n    const shareDialogVisible = ref(false)\n    const deleteDialogVisible = ref(false)\n    const documentCreateType = ref('blank')\n    const selectedDocument = ref(null)\n    const selectedUsers = ref([])\n    const selectedUsersWithPermissions = ref([]) // \n    const availableUsers = ref([])\n    const availableChatUsers = ref([]) // \n    const createLoading = ref(false)\n    const shareLoading = ref(false)\n    const deleteLoading = ref(false)\n    const existingSharedUsers = ref([])\n    \n    // \n    const shareMode = ref('permission') // permission()  chat()\n    const shareFormat = ref('pdf') // pdf  word\n    const selectedChatUsers = ref([]) // \n    \n    // \n    const page = ref(1)\n    const pageSize = 12 // 12\"\"\n    const totalCount = ref(0)\n    const grandTotalCount = ref(0) // \n    // \n    const hasMore = ref(true)\n    const loadingMore = ref(false)\n    \n    // \n    const editDialogVisible = ref(false)\n    const editDocumentForm = ref({\n      id: null,\n      title: '',\n      type: '',\n      category_id: null\n    })\n    const editLoading = ref(false)\n    \n    // \n    const newDocumentForm = ref({\n        title: '',\n        type: ''\n    })\n    \n    const aiDocumentForm = ref({\n        title: '',\n      requirements: ''\n    })\n    \n    // \n    const blankFormRules = {\n        title: [\n        { required: true, message: '', trigger: 'blur' },\n        { min: 2, max: 50, message: ' 2  50 ', trigger: 'blur' }\n        ]\n    }\n    \n    const aiFormRules = {\n        title: [\n        { required: true, message: '', trigger: 'blur' },\n        { min: 2, max: 50, message: ' 2  50 ', trigger: 'blur' }\n        ],\n        requirements: [\n        { required: true, message: '', trigger: 'blur' },\n        { min: 10, max: 500, message: ' 10  500 ', trigger: 'blur' }\n      ]\n    }\n    \n    // \n    const editFormRules = {\n      title: [\n        { required: true, message: '', trigger: 'blur' },\n        { min: 2, max: 50, message: ' 2  50 ', trigger: 'blur' }\n      ]\n    }\n    \n    const blankFormRef = ref(null)\n    const aiFormRef = ref(null)\n    const editFormRef = ref(null)\n    \n    // \n    const totalDocuments = computed(() => {\n      return grandTotalCount.value;\n    });\n    \n    const recentEditCount = computed(() => {\n      return recentDocuments.value.length || 0;\n    });\n    \n    // \n    const categoryDialogVisible = ref(false)\n    const editingCategory = ref({\n      name: '',\n      color: '#409EFF',\n      description: '',\n    })\n    const categoryFormRef = ref(null)\n    const categoryLoading = ref(false)\n    const categoryFormRules = {\n      name: [\n        { required: true, message: '', trigger: 'blur' },\n        { min: 2, max: 20, message: '220', trigger: 'blur' }\n      ],\n      color: [\n        { required: true, message: '', trigger: 'change' }\n      ]\n    }\n    \n    // \n    const forceUpdate = async () => {\n      // \n      documents.value = [...documents.value];\n      recentDocuments.value = [...recentDocuments.value]; \n      sharedDocuments.value = [...sharedDocuments.value];\n      \n      // Vue$forceUpdate\n      if (proxy && proxy.$forceUpdate) {\n        proxy.$forceUpdate();\n      }\n      \n      // DOM\n      await nextTick();\n    };\n    \n    // \n    const fetchDocuments = async (forceRefresh = false, append = false, timestamp = null) => {\n      if (forceRefresh) {\n        page.value = 1\n        hasMore.value = true\n      }\n      \n      // hasMore\n      if (append && !hasMore.value && !forceRefresh) {\n        console.log('')\n        return\n      }\n      \n      if (!append) {\n        createLoading.value = true\n      } else {\n        loadingMore.value = true\n      }\n      \n      try {\n        // \n        const filters = {}\n        \n        // \n        if (searchCategory.value && searchCategory.value !== 'all') {\n          filters.category = searchCategory.value\n        }\n        \n        // \n        if (searchQuery.value) {\n          filters.search = searchQuery.value\n        }\n        \n        // API - DRFpage_size\n        const params = {\n          page: page.value,\n          page_size: pageSize, // pageSizepage_sizeREST framework\n          _t: timestamp || new Date().getTime() // \n        }\n        \n        // \n        Object.assign(params, filters)\n        \n        console.log(`: ${page.value}:`, params)\n        \n        const res = await getDocuments(params)\n        console.log('API:', res)\n        \n        let newDocuments = []\n        let currentViewCount = 0;\n        \n        // API\n        if (res && res.warning) {\n          console.warn('API:', res.warning)\n          ElMessage({\n            message: res.warning,\n            type: 'warning',\n            duration: 5000\n          })\n          // 1\n          if (res.warning.includes('') && res.warning.includes('')) {\n            setTimeout(() => {\n              page.value = 1;\n            }, 0);\n          }\n        }\n        \n        // \n        if (res && res.data && Array.isArray(res.data)) {\n          // \n          newDocuments = res.data\n          currentViewCount = res.total || res.count || 0\n        } else if (res && res.results && Array.isArray(res.results)) {\n          // Django REST\n          newDocuments = res.results\n          currentViewCount = res.count || 0\n        } else if (res && res.data && res.data.results && Array.isArray(res.data.results)) {\n          // \n          newDocuments = res.data.results\n          currentViewCount = res.data.count || 0\n        } else {\n          console.warn('API:', res)\n          documents.value = []\n          return\n        }\n          \n        // \n        totalCount.value = currentViewCount;\n\n        // \"\"\n        if (!filters.category && !filters.search) {\n            grandTotalCount.value = currentViewCount;\n        }\n\n        // \n        if (append) {\n          // \n          const existingIds = new Set(documents.value.map(doc => doc.id))\n          const uniqueNewDocs = newDocuments.filter(doc => !existingIds.has(doc.id))\n          \n          if (uniqueNewDocs.length > 0) {\n            documents.value = [...documents.value, ...uniqueNewDocs]\n            console.log(` ${uniqueNewDocs.length}  ${documents.value.length} `)\n          } else {\n            console.log('')\n            // \n            hasMore.value = newDocuments.length > 0\n          }\n        } else {\n          // \n          documents.value = newDocuments\n          console.log(` ${documents.value.length} `)\n        }\n        \n        console.log(`ID: [${documents.value.map(d => d.id).join(', ')}]`)\n        \n        // \n        const totalPages = Math.ceil(currentViewCount / pageSize);\n        console.log(` - : ${page.value}, : ${totalPages}, : ${currentViewCount}`);\n        \n        // \n        if (page.value > totalPages && totalPages > 0 && !append) {\n          console.warn(` ${page.value}  ${totalPages}`);\n          \n          // setTimeoutwatch\n          setTimeout(() => {\n            page.value = totalPages;\n          }, 0);\n          \n          return;\n        }\n        \n        // \n        hasMore.value = page.value < totalPages;\n        \n        // \n        if (!append && documents.value.length < 8 && hasMore.value) {\n          console.log('')\n          // 100ms\n          await new Promise(resolve => setTimeout(resolve, 100));\n          await fetchDocuments(false, true, timestamp);\n        }\n          \n      } catch (error) {\n        console.error('', error)\n        documents.value = []\n        ElMessage.error('')\n      } finally {\n        if (!append) {\n          createLoading.value = false\n        } else {\n          loadingMore.value = false\n        }\n      }\n    }\n    \n    const fetchRecentDocuments = async (forceRefresh = false, timestamp = null) => {\n      console.log('...');\n      try {\n        // \n        const params = forceRefresh ? { _t: timestamp || new Date().getTime() } : {};\n        \n        const res = await getRecentDocuments(params);\n        console.log('API:', res);\n        \n        if (res && res.data) {\n          // \n          recentDocuments.value = Array.isArray(res.data) ? [...res.data] : [];\n          console.log(`: ${recentDocuments.value.length}`);\n        } else {\n          console.warn('API:', res);\n          recentDocuments.value = [];\n        }\n      } catch (error) {\n        console.error(':', error);\n        ElMessage.error('');\n        recentDocuments.value = [];\n      }\n    }\n    \n    const fetchSharedDocuments = async (timestamp = null) => {\n      try {\n        const params = timestamp ? { _t: timestamp } : {};\n        const response = await getSharedDocuments(params)\n        sharedDocuments.value = response.data\n      } catch (error) {\n        console.error('', error)\n        ElMessage.error('')\n      }\n    }\n    \n    const fetchDocumentCategories = async (timestamp = null, retryCount = 0) => {\n      console.log('...');\n      try {\n        const params = timestamp ? { _t: timestamp } : {};\n        const res = await getDocumentCategories(params);\n        console.log('API:', res);\n        \n        if (res && res.data) {\n          documentCategories.value = res.data;\n          console.log(`: ${documentCategories.value.length}, :`, documentCategories.value);\n        } else {\n          console.warn('API:', res);\n          documentCategories.value = [];\n          \n          // \n          if (documentCategories.value.length === 0 && retryCount < 2) {\n            console.log(`${retryCount + 1}...`);\n            setTimeout(() => fetchDocumentCategories(timestamp, retryCount + 1), (retryCount + 1) * 1000);\n          }\n        }\n      } catch (error) {\n        console.error(':', error);\n        \n        // \n        if (error.response && error.response.status >= 500 && retryCount < 2) {\n          console.log(`${retryCount + 1}...`);\n          setTimeout(() => fetchDocumentCategories(timestamp, retryCount + 1), (retryCount + 1) * 1000);\n        } else {\n          ElMessage.error('');\n          // \n          documentCategories.value = [];\n        }\n      }\n    }\n    \n    // \n    watch(searchQuery, _.debounce(async () => {\n      // \n      page.value = 1\n      hasMore.value = true\n      \n      // \n      documents.value = []\n      createLoading.value = true\n      \n      try {\n        // \n        await fetchDocuments(true)\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error('')\n      } finally {\n        createLoading.value = false\n      }\n    }, 300))\n    \n    const createNewDocument = () => {\n      // \n      newDocumentForm.value = { title: '', type: '' }\n      aiDocumentForm.value = { title: '', requirements: '' }\n      documentCreateType.value = 'blank'\n      newDocumentDialogVisible.value = true\n      \n      // \n      nextTick(() => {\n        try {\n          const dialog = document.querySelector('.el-dialog');\n          if (dialog) {\n            dialog.addEventListener('closed', () => {\n              try {\n                if (blankFormRef.value) {\n                  blankFormRef.value.clearValidate();\n                }\n                if (aiFormRef.value) {\n                  aiFormRef.value.clearValidate();\n                }\n              } catch (err) {\n                console.error('Error clearing form validation:', err);\n              }\n            }, { once: true });\n          }\n        } catch (err) {\n          console.error('Error setting up dialog event listener:', err);\n        }\n      });\n    }\n    \n    const submitNewDocument = async () => {\n      if (documentCreateType.value === 'blank') {\n        if (!blankFormRef.value) {\n          console.warn('');\n          return;\n        }\n        \n        try {\n          const valid = await blankFormRef.value.validate()\n            .catch(err => {\n              console.error(':', err);\n              return false;\n            });\n          \n          if (valid) {\n            createLoading.value = true;\n            try {\n              console.log(':', {\n                title: newDocumentForm.value.title,\n                type: newDocumentForm.value.type || ''\n              });\n              \n              const response = await createDocument({ \n                title: newDocumentForm.value.title,\n                type: newDocumentForm.value.type || '',\n                content: ''\n              });\n              \n              console.log('', JSON.stringify(response));\n              \n              // \n              newDocumentDialogVisible.value = false;\n              ElMessage.success('');\n              \n              // ID\n              let docId = null;\n              if (response && response.data) {\n                if (response.data.id) {\n                  docId = response.data.id;\n                } else if (Array.isArray(response.data) && response.data.length > 0) {\n                  docId = response.data[0].id;\n                } else if (response.data.results && Array.isArray(response.data.results) && response.data.results.length > 0) {\n                  docId = response.data.results[0].id;\n                }\n              }\n              \n              // DOM\n              setTimeout(() => {\n                if (docId) {\n                  console.log(`ID: ${docId}`);\n                  \n                  // \n                  fetchDocuments();\n                  fetchRecentDocuments();\n                  \n                  // \n                  setTimeout(() => {\n                    router.push({\n                      name: 'SmartDocDetail',\n                      params: { id: docId }\n                    }).then(() => {\n                      createLoading.value = false;\n                    }).catch(err => {\n                      console.error(':', err);\n                      ElMessage.error('');\n                      // \n                      router.push(`/smartdoc/${docId}`).catch(navErr => {\n                        console.error(':', navErr);\n                        ElMessage.error('');\n                      });\n                      createLoading.value = false;\n                    });\n                  }, 300);\n                } else {\n                  console.warn('', response);\n                  // \n                  fetchDocuments();\n                  fetchRecentDocuments();\n                }\n              }, 100);\n            } catch (error) {\n              console.error('', error);\n              ElMessage.error('');\n            } finally {\n              createLoading.value = false;\n            }\n          }\n        } catch (error) {\n          console.error(':', error);\n          ElMessage.error('');\n          createLoading.value = false;\n        }\n      } else if (documentCreateType.value === 'ai') {\n        if (!aiFormRef.value) {\n          console.warn('AI');\n          return;\n        }\n        \n        try {\n          const valid = await aiFormRef.value.validate()\n            .catch(err => {\n              console.error('AI:', err);\n              return false;\n            });\n          \n          if (valid) {\n            createLoading.value = true;\n            try {\n              // AIAPI\n              const categoryId = searchCategory.value !== 'all' ? searchCategory.value : null;\n              const response = await aiGenerateDocument({\n                title: aiDocumentForm.value.title,\n                requirement: aiDocumentForm.value.requirements,\n                category_id: categoryId,\n                doc_type: 'AI'\n              });\n              console.log('AI', response);\n              // \n              if (response && response.status === 504) {\n                ElMessage.error(response.data?.detail || 'AI');\n                createLoading.value = false;\n                return;\n              }\n              if (response && response.data && typeof response.data.detail === 'string' && response.data.detail.includes('')) {\n                ElMessage.error(response.data.detail);\n                createLoading.value = false;\n                return;\n              }\n              newDocumentDialogVisible.value = false;\n              ElMessage.success('AI');\n              let docId = null;\n              if (response && response.data && response.data.id) {\n                docId = response.data.id;\n              }\n              if (docId) {\n                // \n                console.log(': SmartDocDetail, id:', docId);\n                router.push({\n                  name: 'SmartDocDetail',\n                  params: { id: String(docId) }\n                }).then(() => {\n                  createLoading.value = false;\n                }).catch(err => {\n                  console.error(':', err);\n                  ElMessage.error('');\n                  // \n                  router.push(`/smartdoc/${docId}`).catch(navErr => {\n                    console.error(':', navErr);\n                    ElMessage.error('');\n                  });\n                  createLoading.value = false;\n                });\n                // \n                fetchDocuments();\n                fetchRecentDocuments();\n              } else {\n                fetchDocuments();\n                fetchRecentDocuments();\n                createLoading.value = false;\n              }\n            } catch (error) {\n              console.error('AI', error);\n              ElMessage.error('AI');\n            } finally {\n              createLoading.value = false;\n            }\n          }\n        } catch (error) {\n          console.error('AI:', error);\n          ElMessage.error('');\n          createLoading.value = false;\n        }\n      }\n    }\n    \n    const openDocument = (doc) => {\n      router.push({ name: 'SmartDocDetail', params: { id: doc.id } })\n    }\n    \n    const editDocument = (doc, event) => {\n      // \n      if (event) {\n        event.stopPropagation();\n      }\n      \n      // ID\n      let categoryId = null;\n      if (doc.category && doc.category.id) {\n        categoryId = Number(doc.category.id);\n      }\n      \n      console.log(':', doc.id, ':', categoryId);\n      \n      // \n      editDocumentForm.value = {\n        id: doc.id,\n        title: doc.title,\n        type: doc.type || '',\n        category_id: categoryId\n      };\n      \n      // \n      editDialogVisible.value = true;\n    };\n    \n    // \n    const submitEditDocument = async () => {\n      if (!editFormRef.value) return;\n      \n      try {\n        const valid = await editFormRef.value.validate();\n        \n        if (valid) {\n          editLoading.value = true;\n          \n          // \n          const updateData = {\n            title: editDocumentForm.value.title,\n            type: editDocumentForm.value.type || '',\n            category_id: editDocumentForm.value.category_id\n          };\n          \n          // API\n          await updateDocument(editDocumentForm.value.id, updateData);\n          \n          ElMessage.success('');\n          editDialogVisible.value = false;\n          \n          // \n          await reloadAllData();\n        }\n      } catch (error) {\n        console.error('', error);\n        ElMessage.error('');\n      } finally {\n        editLoading.value = false;\n      }\n    };\n    \n    const exportDocument = (doc) => {\n      ElMessageBox({\n        title: '',\n        message: '',\n        showCancelButton: true,\n        confirmButtonText: 'PDF',\n        cancelButtonText: 'Word',\n        closeOnClickModal: true,\n        callback: (action) => {\n          if (action === 'confirm') {\n            exportToPdf(doc)\n          } else if (action === 'cancel') {\n            exportToWord(doc)\n          }\n        }\n      })\n    }\n    \n    // PDF\n    const exportToPdf = async (doc) => {\n      if (!doc) {\n        ElMessage.error('')\n        return\n      }\n      \n      // \n      const loading = ElLoading.service({\n        lock: true,\n        text: '...',\n        background: 'rgba(255, 255, 255, 0.7)'\n      })\n      \n      try {\n        // \n        const response = await getDocumentDetail(doc.id)\n        const documentContent = response.data.content\n        \n        if (!documentContent) {\n          loading.close()\n          ElMessage.error('')\n          return\n        }\n        \n        const docTitle = doc.title || ''\n        const filename = `${docTitle}.pdf`\n        \n        // \n        const tempContainer = document.createElement('div')\n        tempContainer.innerHTML = documentContent\n        tempContainer.className = 'temp-export-container'\n        document.body.appendChild(tempContainer)\n        \n        const options = {\n          margin: [15, 15, 15, 15],\n          filename: filename,\n          image: { type: 'jpeg', quality: 0.98 },\n          html2canvas: { scale: 2, useCORS: true },\n          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }\n        }\n        \n        // \n        loading.setText('PDF...')\n        \n        // html2pdf.js\n        const html2pdfModule = await import('html2pdf.js')\n        const html2pdf = html2pdfModule.default\n        \n        await html2pdf().from(tempContainer).set(options).save()\n        \n        // \n        document.body.removeChild(tempContainer)\n        \n        loading.close()\n        ElMessage.success('PDF')\n      } catch (error) {\n        console.error('PDF:', error)\n        loading.close()\n        ElMessage.error('PDF: ' + (error.message || ''))\n      }\n    }\n    \n    // Word\n    const exportToWord = async (doc) => {\n      if (!doc) {\n        ElMessage.error('')\n        return\n      }\n      \n      const loading = ElLoading.service({\n        lock: true,\n        text: '...',\n        background: 'rgba(255, 255, 255, 0.7)'\n      })\n      \n      try {\n        // \n        const response = await getDocumentDetail(doc.id)\n        const documentContent = response.data.content\n        \n        if (!documentContent) {\n          loading.close()\n          ElMessage.error('')\n          return\n        }\n        \n        const docTitle = doc.title || ''\n        const filename = `${docTitle}.doc`\n        \n        // \n        const contentContainer = document.createElement('div')\n        contentContainer.innerHTML = documentContent\n        \n        // \n        loading.setText('Word...')\n        \n        // WordHTML\n        const msWordHtml = `\n          <html xmlns:o=\"urn:schemas-microsoft-com:office:office\" \n                xmlns:w=\"urn:schemas-microsoft-com:office:word\" \n                xmlns=\"http://www.w3.org/TR/REC-html40\">\n          <head>\n            <meta charset=\"utf-8\">\n            <title>${docTitle}</title>\n            <style>\n              body { font-family: SimSun, Arial, sans-serif; margin: 1cm; }\n              img { max-width: 100%; height: auto; }\n              p { margin: 0; padding: 0; }\n              h1 { font-size: 18pt; }\n              h2 { font-size: 16pt; }\n              h3 { font-size: 14pt; }\n              table { border-collapse: collapse; width: 100%; }\n              td, th { border: 1px solid #000; padding: 5px; }\n            </style>\n          </head>\n          <body>\n            <h1>${docTitle}</h1>\n            ${contentContainer.innerHTML}\n          </body>\n          </html>\n        `\n        \n        // file-saver\n        const FileSaver = await import('file-saver')\n        const saveAs = FileSaver.saveAs || FileSaver.default\n        const blob = new Blob([msWordHtml], { type: 'application/msword' })\n        saveAs(blob, filename)\n        \n        loading.close()\n        ElMessage.success('Word')\n      } catch (error) {\n        console.error('Word:', error)\n        loading.close()\n        ElMessage.error(`Word: ${error.message || ''}`)\n      }\n    }\n    \n    const shareDocument = async (doc) => {\n      selectedDocument.value = doc\n      shareLoading.value = true\n      \n      try {\n        console.log('ID:', doc.id);\n        // Fetch document details to get existing permissions\n        const detailRes = await getDocumentDetail(doc.id)\n        console.log(':', detailRes);\n        \n        // shared_with\n        let sharedWithData = [];\n        if (detailRes && detailRes.data) {\n          if (detailRes.data.shared_with && Array.isArray(detailRes.data.shared_with)) {\n            sharedWithData = detailRes.data.shared_with;\n            console.log('data.shared_with:', sharedWithData);\n          } else if (detailRes.data.permissions && Array.isArray(detailRes.data.permissions)) {\n            sharedWithData = detailRes.data.permissions;\n            console.log('data.permissions:', sharedWithData);\n          } else if (detailRes.shared_with && Array.isArray(detailRes.shared_with)) {\n            sharedWithData = detailRes.shared_with;\n            console.log('shared_with:', sharedWithData);\n          }\n        }\n        \n        // \n        if (sharedWithData.length > 0) {\n          existingSharedUsers.value = sharedWithData.map(item => {\n            // \n            if (item.user && (item.user.id || item.user.user_id)) {\n              return {\n                user_id: item.user.id || item.user.user_id,\n                username: item.user.username || item.user.name || item.user.email || `${item.user.id}`,\n                permission: item.permission || 'edit'\n              };\n            } else if (item.user_id || item.userId) {\n              return {\n                user_id: item.user_id || item.userId,\n                username: item.username || item.name || item.email || `${item.user_id || item.userId}`,\n                permission: item.permission || 'edit'\n              };\n            }\n            // item\n            return {\n              user_id: item.id || item.user_id || 0,\n              username: item.username || item.name || item.email || '',\n              permission: item.permission || 'edit'\n            };\n          });\n        } else {\n          console.log('');\n          existingSharedUsers.value = [];\n        }\n        \n        console.log(':', existingSharedUsers.value);\n        const existingUserIds = new Set(existingSharedUsers.value.map(u => u.user_id));\n        console.log('ID:', Array.from(existingUserIds));\n        \n        // Get current user and company info\n        const currentUserJson = localStorage.getItem('user')\n        let currentUserId = null\n        let companyId = null\n        if (currentUserJson) {\n          const currentUser = JSON.parse(currentUserJson)\n          currentUserId = currentUser.id\n          companyId = currentUser.company_id\n          console.log('ID:', currentUserId, 'ID:', companyId);\n        }\n        \n        const isCreator = doc.creator && currentUserId && doc.creator.id === currentUserId\n        shareMode.value = isCreator ? 'permission' : 'chat'\n        console.log(':', isCreator, ':', shareMode.value);\n        \n        // Fetch all company users\n        const usersRes = await userApi.getCompanyUsers()\n        console.log(':', usersRes);\n        if (usersRes.success && Array.isArray(usersRes.data)) {\n          // \n          availableUsers.value = usersRes.data\n            .filter(user => \n              user.id !== currentUserId && \n              (!companyId || user.company_id === companyId) &&\n              !existingUserIds.has(user.id) // \n            )\n            .map(user => ({\n              id: user.id,\n              username: user.name || user.username || user.email || `${user.id}`\n            }));\n          \n          // \n          availableChatUsers.value = usersRes.data\n            .filter(user => \n              user.id !== currentUserId && \n              (!companyId || user.company_id === companyId)\n              // \n            )\n            .map(user => ({\n              id: user.id,\n              username: user.name || user.username || user.email || `${user.id}`\n            }));\n          \n          console.log(':', availableUsers.value);\n          console.log(':', availableChatUsers.value);\n        } else {\n          console.warn(':', usersRes);\n          availableUsers.value = [];\n          availableChatUsers.value = [];\n        }\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error('')\n        existingSharedUsers.value = []\n      } finally {\n        shareLoading.value = false\n        \n        // Reset variables for adding new users\n        shareFormat.value = 'pdf'\n        selectedUsers.value = []\n        selectedUsersWithPermissions.value = []\n        selectedChatUsers.value = []\n        \n        shareDialogVisible.value = true\n      }\n    }\n    \n    // ID\n    const getUsernameById = (userId) => {\n      const user = availableUsers.value.find(u => u.id === userId)\n      return user ? user.username : ''\n    }\n    \n    // ID\n    const getCurrentUserId = () => {\n      try {\n        const currentUserJson = localStorage.getItem('user')\n        if (currentUserJson) {\n          const currentUser = JSON.parse(currentUserJson)\n          return currentUser.id\n        }\n        return null\n      } catch (error) {\n        console.error('ID:', error)\n        return null\n      }\n    }\n\n    // \n    const handleUserSelectionChange = (val) => {\n      console.log(' - :', val);\n      console.log(' - selectedUsers:', selectedUsers.value);\n      console.log(' - :', typeof selectedUsers.value, Array.isArray(selectedUsers.value));\n      \n      // selectedUsers\n      if (!Array.isArray(selectedUsers.value)) {\n        console.warn('selectedUsers');\n        selectedUsers.value = Array.isArray(val) ? val : [];\n      }\n      \n      // \n      selectedUsersWithPermissions.value = selectedUsers.value.map(userId => {\n        console.log('ID:', userId, ':', typeof userId);\n        return {\n          user_id: userId,\n          permission: 'edit' // \n        };\n      });\n      \n      console.log(':', selectedUsers.value);\n      console.log(':', selectedUsersWithPermissions.value);\n    }\n\n    // \n    const handleShareModeChange = () => {\n      console.log(':', shareMode.value);\n      // \n      if (shareMode.value === 'permission') {\n        // \n        selectedChatUsers.value = [];\n        console.log('');\n      } else if (shareMode.value === 'chat') {\n        // \n        selectedUsers.value = [];\n        selectedUsersWithPermissions.value = [];\n        console.log('');\n      }\n    }\n    \n    const confirmShare = async () => {\n      // \n      if (shareMode.value === 'permission') {\n        // \n        const currentUserId = getCurrentUserId();\n        const isCreator = selectedDocument.value && selectedDocument.value.creator && \n                          currentUserId && selectedDocument.value.creator.id === currentUserId;\n        \n        if (!isCreator) {\n          ElMessage.warning('')\n          return\n        }\n        \n        const finalPermissions = [\n          ...existingSharedUsers.value.map(u => ({ user_id: u.user_id, permission: 'edit' })),\n          ...selectedUsersWithPermissions.value\n        ];\n        \n        shareLoading.value = true\n        try {\n          await apiShareDocument(selectedDocument.value.id, finalPermissions)\n          ElMessage.success('')\n          shareDialogVisible.value = false\n        } catch (error) {\n          console.error('', error)\n          ElMessage.error('')\n        } finally {\n          shareLoading.value = false\n        }\n      } \n      // \n      else if (shareMode.value === 'chat') {\n        if (!selectedDocument.value || selectedChatUsers.value.length === 0) {\n          ElMessage.warning('')\n          return\n        }\n        \n        shareLoading.value = true\n        try {\n          // \n          const currentUserJson = localStorage.getItem('user')\n          let currentUserId = null\n          if (currentUserJson) {\n            const currentUser = JSON.parse(currentUserJson)\n            currentUserId = currentUser.id\n          }\n          \n          if (!currentUserId) {\n            ElMessage.error('')\n            shareLoading.value = false\n            return\n          }\n          \n          // \n          const docResponse = await getDocumentDetail(selectedDocument.value.id);\n          const currentDoc = docResponse.data;\n          \n          if (!currentDoc || !currentDoc.content) {\n            ElMessage.error('')\n            shareLoading.value = false\n            return\n          }\n          \n          // \n          const loading = ElLoading.service({\n            lock: true,\n            text: `${shareFormat.value === 'pdf' ? 'PDF' : 'Word'}...`,\n            background: 'rgba(255, 255, 255, 0.7)'\n          });\n          \n          try {\n            // \n            const docTitle = currentDoc.title || '';\n            const documentContent = currentDoc.content;\n            \n            // \n            const tempContainer = document.createElement('div');\n            tempContainer.innerHTML = documentContent;\n            tempContainer.className = 'temp-export-container';\n            document.body.appendChild(tempContainer);\n            \n            let documentFile = null;\n            let fileName = docTitle;\n            let fileType = '';\n            \n            if (shareFormat.value === 'pdf') {\n              fileName += '.pdf';\n              fileType = 'application/pdf';\n              \n              loading.setText('PDF...');\n              \n              // html2pdf.js\n              const html2pdfModule = await import('html2pdf.js');\n              const html2pdf = html2pdfModule.default;\n              \n              const options = {\n                margin: [15, 15, 15, 15],\n                filename: fileName,\n                image: { type: 'jpeg', quality: 0.98 },\n                html2canvas: { scale: 2, useCORS: true },\n                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }\n              };\n              \n              // PDFBlob\n              documentFile = await html2pdf().from(tempContainer).set(options).outputPdf('blob');\n            }\n            else {\n              fileName += '.doc';\n              fileType = 'application/msword';\n              \n              loading.setText('Word...');\n              \n              // WordHTML\n              const msWordHtml = `\n                <html xmlns:o=\"urn:schemas-microsoft-com:office:office\" \n                      xmlns:w=\"urn:schemas-microsoft-com:office:word\" \n                      xmlns=\"http://www.w3.org/TR/REC-html40\">\n                <head>\n                  <meta charset=\"utf-8\">\n                  <title>${docTitle}</title>\n                  <style>\n                    body { font-family: SimSun, Arial, sans-serif; margin: 1cm; }\n                    img { max-width: 100%; height: auto; }\n                    p { margin: 0; padding: 0; }\n                    h1 { font-size: 18pt; }\n                    h2 { font-size: 16pt; }\n                    h3 { font-size: 14pt; }\n                    table { border-collapse: collapse; width: 100%; }\n                    td, th { border: 1px solid #000; padding: 5px; }\n                  </style>\n                </head>\n                <body>\n                  <h1>${docTitle}</h1>\n                  ${tempContainer.innerHTML}\n                </body>\n                </html>\n              `;\n              \n              // Blob\n              documentFile = new Blob([msWordHtml], { type: fileType });\n            }\n            \n            // \n            document.body.removeChild(tempContainer);\n            \n            // \n            loading.setText('...');\n            const sessionsResponse = await getChatSessions();\n            let chatSessions = [];\n            \n            // API\n            if (sessionsResponse && sessionsResponse.data && Array.isArray(sessionsResponse.data)) {\n              chatSessions = sessionsResponse.data;\n            } else if (sessionsResponse && sessionsResponse.results && Array.isArray(sessionsResponse.results)) {\n              chatSessions = sessionsResponse.results;\n            } else if (sessionsResponse && Array.isArray(sessionsResponse)) {\n              chatSessions = sessionsResponse;\n            }\n            \n            console.log(` ${chatSessions.length} `);\n            loading.setText('...');\n            \n            // IDMapuserId -> chatId\n            const userSessionMap = new Map();\n            \n            // \n            for (const userId of selectedChatUsers.value) {\n              // \n              const existingSession = chatSessions.find(session => {\n                // \n                if (!session.participants || !Array.isArray(session.participants)) {\n                  return false;\n                }\n                \n                // \n                if (session.participants.length !== 2) {\n                  return false;\n                }\n                \n                // \n                const hasCurrentUser = session.participants.some(p => \n                  (p.id === currentUserId) || (p.user && p.user.id === currentUserId)\n                );\n                \n                const hasTargetUser = session.participants.some(p => \n                  (p.id === userId) || (p.user && p.user.id === userId)\n                );\n                \n                return hasCurrentUser && hasTargetUser;\n              });\n              \n              if (existingSession) {\n                userSessionMap.set(userId, existingSession.id);\n                console.log(`${userId}: ${existingSession.id}`);\n              }\n            }\n            \n            // \n            const newSessionPromises = [];\n            for (const userId of selectedChatUsers.value) {\n              if (!userSessionMap.has(userId)) {\n                console.log(`${userId}...`);\n                newSessionPromises.push(\n                  createChatSession({\n                    participant_ids: [currentUserId, userId],\n                    title: ''\n                  }).then(response => {\n                    if (response && response.data && response.data.id) {\n                      userSessionMap.set(userId, response.data.id);\n                      console.log(`${userId}: ${response.data.id}`);\n                    } else if (response && response.id) {\n                      userSessionMap.set(userId, response.id);\n                      console.log(`${userId}: ${response.id}`);\n                    } else {\n                      console.error(':', response);\n                      return null;\n                    }\n                  }).catch(error => {\n                    console.error(`${userId}:`, error);\n                    return null;\n                  })\n                );\n              }\n            }\n            \n            // \n            if (newSessionPromises.length > 0) {\n              loading.setText(` ${newSessionPromises.length} ...`);\n              await Promise.all(newSessionPromises);\n            }\n            \n            // \n            loading.setText('...');\n            const sendPromises = [];\n            const failedUsers = [];\n            \n            // \n            for (const userId of selectedChatUsers.value) {\n              const chatId = userSessionMap.get(userId);\n              if (!chatId) {\n                console.error(`${userId}`);\n                failedUsers.push(userId);\n                continue;\n              }\n              \n              console.log(` ${chatId} ...`);\n              \n              // FormData\n              const formData = new FormData();\n              formData.append('chat', chatId);\n              formData.append('message_type', 'file');\n              formData.append('content', `${shareFormat.value === 'pdf' ? 'PDF' : 'Word'}: ${docTitle}`);\n              \n              // BlobFile - File\n              const file = new File([documentFile], fileName, { type: fileType });\n              formData.append('file', file);\n              \n              // \n              sendPromises.push(\n                request({\n                  url: '/api/chat/messages/',\n                  method: 'post',\n                  data: formData,\n                  headers: {\n                    'Content-Type': 'multipart/form-data'\n                  },\n                  timeout: 30000 // \n                }).then(response => {\n                  console.log(` ${userId} :`, response);\n                  return { userId, success: true };\n                }).catch(error => {\n                  console.error(` ${userId} :`, error);\n                  return { userId, success: false, error };\n                })\n              );\n            }\n            \n            // \n            const sendResults = await Promise.all(sendPromises);\n            const successCount = sendResults.filter(result => result.success).length;\n            const totalAttempted = sendResults.length;\n            const totalSelected = selectedChatUsers.value.length;\n            \n            if (successCount > 0) {\n              if (successCount === totalSelected) {\n                ElMessage.success(` ${successCount} `);\n              } else {\n                ElMessage.warning(`: ${successCount}/${totalSelected} `);\n              }\n              shareDialogVisible.value = false;\n            } else if (totalAttempted > 0) {\n              ElMessage.error('');\n            } else {\n              ElMessage.error('');\n            }\n          } catch (error) {\n            console.error(':', error);\n            ElMessage.error('');\n          } finally {\n            loading.close();\n          }\n        } catch (error) {\n          console.error(':', error);\n          ElMessage.error('');\n        } finally {\n          shareLoading.value = false;\n        }\n      }\n    }\n    \n    const deleteDocument = (doc) => {\n      selectedDocument.value = doc\n      deleteDialogVisible.value = true\n    }\n    \n    const confirmDelete = async () => {\n      if (!selectedDocument.value) return\n      \n      deleteLoading.value = true\n      try {\n        // ID\n        const deletedDocId = selectedDocument.value.id;\n        const deletedDocCategoryId = selectedDocument.value.category?.id;\n        \n        // \n        deleteDialogVisible.value = false;\n        \n        // \n        await apiDeleteDocument(deletedDocId)\n        ElMessage.success('')\n        \n        // \n        selectedDocument.value = null;\n        \n        // \n        if (window.localStorage) {\n          try {\n            // \n            localStorage.removeItem(`doc_cache_${deletedDocId}`);\n            localStorage.removeItem(`recent_docs_cache`);\n            localStorage.removeItem(`doc_list_cache`);\n          } catch (e) {\n            console.error(':', e);\n          }\n        }\n        \n        // \n        refreshTrigger.value = Date.now();\n        \n        // Vue \n        documents.value = [...documents.value.filter(doc => doc.id !== deletedDocId)];\n        recentDocuments.value = [...recentDocuments.value.filter(doc => doc.id !== deletedDocId)];\n        sharedDocuments.value = [...sharedDocuments.value.filter(doc => doc.id !== deletedDocId)];\n        \n        // \n        await forceUpdate();\n        \n        // \n        if (deletedDocCategoryId) {\n          const category = documentCategories.value.find(c => c.id === deletedDocCategoryId);\n          if (category && category.document_count > 0) {\n            category.document_count--;\n          }\n        }\n        \n        // DOM\n        await nextTick();\n        \n        // \n        if (router.currentRoute.value.name === 'SmartDocDetail') {\n          console.log('');\n          \n          // \n          await reloadAllData();\n          \n          // replace\n          router.replace({ \n            name: 'SmartDoc',\n            query: { _refresh: Date.now() } // \n          });\n        } else {\n          // \n          await refreshData();\n        }\n      } catch (error) {\n        console.error('', error);\n        ElMessage.error('');\n        // \n        deleteDialogVisible.value = false;\n      } finally {\n        deleteLoading.value = false;\n      }\n    }\n    \n    const viewAllDocuments = (type) => {\n      if (type === 'recent') {\n        // SmartDocList\n        router.push({ name: 'SmartDoc' }).then(() => {\n          setTimeout(() => {\n            const docSection = document.querySelector('.section');\n            if (docSection) {\n              docSection.scrollIntoView({ behavior: 'smooth' });\n            }\n          }, 300);\n        });\n      }\n    }\n    \n    const selectCategory = (category) => {\n      console.log(':', category);\n      \n      // category\n      let categoryId;\n      if (category === 'all') {\n        categoryId = 'all';\n      } else if (typeof category === 'string') {\n        categoryId = category;\n      } else if (typeof category === 'object' && category !== null) {\n        categoryId = category.id.toString();\n      }\n      \n      console.log('ID:', categoryId);\n      \n      // \n      if (categoryId === searchCategory.value) {\n        console.log('');\n        return;\n      }\n      \n      // \n      searchCategory.value = categoryId;\n      \n      // \n      documents.value = [];\n      createLoading.value = true;\n      \n      // \n      page.value = 1;\n      hasMore.value = true;\n      \n      // \n      setTimeout(async () => {\n        try {\n          // \n          await fetchDocuments(true);\n        } catch (error) {\n          console.error(':', error);\n          ElMessage.error('');\n        } finally {\n          createLoading.value = false;\n        }\n        \n        // \n        const docCards = document.querySelectorAll('.doc-card');\n        if (docCards && docCards.length > 0) {\n          docCards.forEach((card, index) => {\n            if (card) {\n              card.style.animationDelay = `${index * 50}ms`;\n              card.classList.remove('fadeIn');\n              setTimeout(() => {\n                if (card) {\n                  card.classList.add('fadeIn');\n                }\n              }, 10);\n            }\n          });\n        }\n      }, 300);\n    };\n\n    // \n    const getSelectedCategoryColor = () => {\n      if (searchCategory.value === 'all') return '#409EFF';\n      const selectedCategory = documentCategories.value.find(c => c.id.toString() === searchCategory.value);\n      return selectedCategory?.color || '#67C23A';\n    };\n\n    // \n    const getSelectedCategoryName = () => {\n      if (searchCategory.value === 'all') return '';\n      const selectedCategory = documentCategories.value.find(c => c.id.toString() === searchCategory.value);\n      return selectedCategory?.name || '';\n    };\n    \n    const manageCategories = () => {\n      categoryDialogVisible.value = true\n      resetCategoryForm()\n    }\n    \n    const editCategory = (category) => {\n      editingCategory.value = { ...category }\n    }\n    \n    const resetCategoryForm = () => {\n      editingCategory.value = {\n        id: '',\n        name: '',\n        color: '#409EFF',\n        description: ''\n      }\n      if (categoryFormRef.value) {\n        categoryFormRef.value.resetFields()\n      }\n    }\n    \n    const submitCategory = async () => {\n      if (!categoryFormRef.value) return\n      \n      await categoryFormRef.value.validate(async (valid) => {\n        if (valid) {\n          categoryLoading.value = true\n          try {\n            const categoryData = {\n              name: editingCategory.value.name,\n              color: editingCategory.value.color,\n              description: editingCategory.value.description || ''\n            }\n            \n            if (editingCategory.value.id) {\n              // \n              await updateDocumentCategory(editingCategory.value.id, categoryData)\n              ElMessage.success('')\n            } else {\n              // \n              await createDocumentCategory(categoryData)\n              ElMessage.success('')\n            }\n            \n            // \n            fetchDocumentCategories()\n            resetCategoryForm()\n          } catch (error) {\n            console.error(':', error)\n            ElMessage.error('')\n          } finally {\n            categoryLoading.value = false\n          }\n        }\n      })\n    }\n    \n    const deleteCategory = (category) => {\n      if (category.document_count > 0) {\n        ElMessage.warning('')\n        return\n      }\n      \n      ElMessageBox.confirm(\n        `\"${category.name}\"`,\n        '',\n        {\n          confirmButtonText: '',\n          cancelButtonText: '',\n          type: 'warning'\n        }\n      ).then(async () => {\n        try {\n          await deleteDocumentCategory(category.id)\n          ElMessage.success('')\n          fetchDocumentCategories()\n        } catch (error) {\n          console.error(':', error)\n          ElMessage.error('')\n        }\n      }).catch(() => {})\n    }\n    \n    const formatDate = (dateString) => {\n      const date = new Date(dateString)\n      const now = new Date()\n      \n      // \n      if (date.toDateString() === now.toDateString()) {\n        return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })\n      }\n      \n      // \n      const yesterday = new Date(now)\n      yesterday.setDate(now.getDate() - 1)\n      if (date.toDateString() === yesterday.toDateString()) {\n        return ''\n      }\n      \n      // \n      const weekDays = ['', '', '', '', '', '', '']\n      const diffDays = Math.round((now - date) / (1000 * 60 * 60 * 24))\n      if (diffDays < 7) {\n        return weekDays[date.getDay()]\n      }\n      \n      // \n      return date.toLocaleDateString('zh-CN', { month: 'numeric', day: 'numeric' })\n    }\n    \n    const resetCategoryFilter = () => {\n      searchCategory.value = 'all'\n      page.value = 1\n      fetchDocuments(true)\n    }\n    \n    // \n    onActivated(() => {\n      console.log('SmartDoc');\n      reloadAllData();\n    });\n\n    // \n    const reloadAllData = async () => {\n      page.value = 1\n      try {\n        console.log('...')\n        createLoading.value = true\n        \n        // \n        const timestamp = Date.now();\n        \n        // \n        try {\n          if (window.localStorage) {\n            // \n            localStorage.removeItem('doc_list_cache');\n            localStorage.removeItem('recent_docs_cache');\n            localStorage.removeItem('doc_categories_cache');\n          }\n        } catch (e) {\n          console.error(':', e);\n        }\n        \n        // \n        await fetchDocumentCategories(timestamp)\n        \n        // \n        await Promise.all([\n          fetchDocuments(true, false, timestamp),\n          fetchRecentDocuments(true, timestamp),\n          fetchSharedDocuments(timestamp)\n        ])\n        \n        console.log('', {\n          : documentCategories.value.length,\n          : documents.value.length,\n          : recentDocuments.value.length,\n          : sharedDocuments.value.length,\n          : totalCount.value,\n        })\n        \n        // \n        await forceUpdate()\n        \n      } catch (error) {\n        console.error(':', error)\n        ElMessage.error('')\n      } finally {\n        createLoading.value = false\n      }\n    }\n\n    // \n    provide('reloadDocuments', reloadAllData);\n    \n    // \n    watch(() => route.query._refresh, (newVal) => {\n      if (newVal) {\n        console.log(':', newVal);\n        refreshTrigger.value = Date.now();\n        reloadAllData();\n      }\n    });\n\n    // \n    watch(() => route.path, (newPath, oldPath) => {\n      console.log(':', oldPath, '->', newPath);\n      if (newPath === '/smartdoc' && oldPath && oldPath.startsWith('/smartdoc/')) {\n        // \n        console.log('');\n        refreshTrigger.value = Date.now();\n        reloadAllData();\n      }\n    });\n\n    // \n    const refreshData = async () => {\n      page.value = 1\n      await reloadAllData()\n      if (proxy && proxy.$forceUpdate) {\n        proxy.$forceUpdate()\n      }\n    }\n\n    //  - \n    const onPageChange = (newPage) => {\n      console.log(` - : ${newPage}`);\n      \n      // \n      const maxPage = Math.ceil(totalCount.value / pageSize);\n      if (newPage > maxPage && maxPage > 0) {\n        console.warn(` ${newPage}  ${maxPage}`);\n        setTimeout(() => {\n          page.value = maxPage;\n        }, 0);\n        return;\n      }\n    }\n    \n    // \n    watch(() => page.value, async (newPage, oldPage) => {\n      console.log(`: ${oldPage} -> ${newPage}`);\n      \n      if (newPage === oldPage) return;\n      \n      // \n      const maxPage = Math.ceil(totalCount.value / pageSize);\n      if (newPage > maxPage && maxPage > 0) {\n        console.warn(` ${newPage}  ${maxPage}`);\n        setTimeout(() => {\n          page.value = maxPage;\n        }, 0);\n        return;\n      }\n      \n      try {\n        // \n        createLoading.value = true;\n        \n        // hasMore\n        hasMore.value = true;\n        \n        // \n        await fetchDocuments(false, false, Date.now());\n        \n        // \n        const docSection = document.querySelector('.section');\n        if (docSection) {\n          docSection.scrollIntoView({ behavior: 'smooth' });\n        }\n      } catch (error) {\n        console.error(':', error);\n        ElMessage.error('');\n        \n        // 404\n        if (error.response && error.response.status === 404) {\n          console.warn('');\n          setTimeout(() => {\n            page.value = 1;\n          }, 0);\n        }\n      } finally {\n        createLoading.value = false;\n      }\n    });\n\n    // \n    const loadMoreDocuments = () => {\n      if (loadingMore.value || !hasMore.value) return\n      page.value++\n      fetchDocuments(false, true)\n    }\n\n    // \n    onMounted(() => {\n      console.log('SmartDocmounted');\n      \n      // URL_refresh\n      const refreshParam = route.query._refresh;\n      if (refreshParam) {\n        console.log('URL:', refreshParam);\n        // \n        refreshTrigger.value = Date.now();\n        // DOM\n        setTimeout(() => {\n          reloadAllData();\n        }, 10);\n      } else {\n        // \n        reloadAllData();\n      }\n    })\n    \n    const handleImportWord = () => {\n      // input\n      const fileInput = document.createElement('input');\n      fileInput.type = 'file';\n      fileInput.accept = '.docx,.doc';\n      fileInput.style.display = 'none';\n      document.body.appendChild(fileInput);\n      \n      // \n      fileInput.addEventListener('change', async (event) => {\n        if (event.target.files.length > 0) {\n          const file = event.target.files[0];\n          \n          // \n          const loadingInstance = ElLoading.service({\n            fullscreen: true,\n            text: 'Word...',\n            background: 'rgba(255, 255, 255, 0.8)',\n            lock: true // \n          });\n          \n          try {\n            // FormData\n            const formData = new FormData();\n            formData.append('file', file);\n            \n            // API\n            const response = await importWordDocument(formData);\n            \n            if (response && response.id) {\n              // \n              await reloadAllData();\n              \n              // \n              ElMessage.success('Word');\n              \n              // \n              setTimeout(() => {\n                // \n                router.push({\n                  name: 'SmartDocDetail',\n                  params: { id: response.id },\n                  query: { _refresh: Date.now() } // \n                });\n              }, 1000);\n            } else {\n              ElMessage.error('' + (response?.detail || ''));\n            }\n          } catch (error) {\n            console.error('Word:', error);\n            ElMessage.error('Word: ' + (error.message || ''));\n          } finally {\n            // \n            setTimeout(() => {\n              loadingInstance.close();\n              document.body.removeChild(fileInput);\n            }, 500);\n          }\n        }\n      });\n      \n      // \n      fileInput.click();\n    }\n    \n    const removeSharedUser = (userIdToRemove) => {\n      console.log(':', userIdToRemove);\n      const userToRemove = existingSharedUsers.value.find(u => u.user_id === userIdToRemove);\n      if (userToRemove) {\n        console.log(':', userToRemove);\n        // \n        availableUsers.value.push({ \n          id: userToRemove.user_id, \n          username: userToRemove.username \n        });\n        \n        // \n        existingSharedUsers.value = existingSharedUsers.value.filter(u => u.user_id !== userIdToRemove);\n        console.log(':', existingSharedUsers.value);\n        \n        // \n        ElMessage({\n          message: ` ${userToRemove.username} `,\n          type: 'warning'\n        });\n      } else {\n        console.warn(':', userIdToRemove);\n      }\n    };\n    \n    return {\n      documents,\n      recentDocuments,\n      sharedDocuments,\n      documentCategories,\n      searchQuery,\n      searchCategory,\n      totalDocuments,\n      recentEditCount,\n      newDocumentDialogVisible,\n      shareDialogVisible,\n      deleteDialogVisible,\n      documentCreateType,\n      newDocumentForm,\n      aiDocumentForm,\n      blankFormRules,\n      aiFormRules,\n      blankFormRef,\n      aiFormRef,\n      selectedDocument,\n      selectedUsers,\n      selectedUsersWithPermissions,\n      availableUsers,\n      availableChatUsers,\n      createLoading,\n      shareLoading,\n      deleteLoading,\n      createNewDocument,\n      submitNewDocument,\n      openDocument,\n      editDocument,\n      submitEditDocument,\n      exportDocument,\n      shareDocument,\n      confirmShare,\n      deleteDocument,\n      confirmDelete,\n      viewAllDocuments,\n      formatDate,\n      categoryDialogVisible,\n      editingCategory,\n      categoryFormRef,\n      categoryLoading,\n      categoryFormRules,\n      editCategory,\n      resetCategoryForm,\n      submitCategory,\n      deleteCategory,\n      resetCategoryFilter,\n      selectCategory,\n      getSelectedCategoryColor,\n      getSelectedCategoryName,\n      manageCategories,\n      reloadAllData,\n      refreshData,\n      refreshTrigger,\n      hasMore,\n      loadingMore,\n      loadMoreDocuments,\n      exportToPdf,\n      exportToWord,\n      // \n      editDialogVisible,\n      editDocumentForm,\n      editFormRef,\n      editLoading,\n      editFormRules,\n      // \n      onPageChange,\n      page,\n      pageSize,\n      totalCount,\n      // \n      $_isDev,\n      // API\n      fetchDocuments,\n      // \n      shareMode,\n      shareFormat,\n      selectedChatUsers,\n      handleImportWord,\n      getUsernameById,\n      handleUserSelectionChange,\n      handleShareModeChange,\n      getCurrentUserId,\n      existingSharedUsers,\n      removeSharedUser\n    }\n  }\n}\n</script>\n\n<style scoped>\n.smartdoc-home-container {\n  padding: 20px;\n  background-color: var(--el-bg-color-page);\n}\n\n/*  */\n.page-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 24px;\n}\n\n.page-title {\n  font-size: 24px;\n  font-weight: 600;\n  margin: 0;\n  color: var(--el-text-color-primary);\n}\n\n.page-description {\n  color: var(--el-text-color-secondary);\n  margin: 4px 0 0 0;\n}\n\n.right-section {\n  display: flex;\n  gap: 16px;\n  align-items: center;\n}\n\n.search-controls {\n  display: flex;\n  gap: 16px;\n  align-items: center;\n}\n\n.search-input {\n  width: 240px;\n}\n\n/*  */\n.stats-cards {\n  display: flex;\n  gap: 16px;\n  margin-bottom: 24px;\n}\n\n.stat-card {\n  flex: 1;\n  transition: all 0.3s;\n  background-color: var(--el-bg-color-overlay);\n  border-color: var(--el-border-color-lighter);\n}\n\n.stat-card:hover {\n  transform: translateY(-5px);\n  box-shadow: var(--el-box-shadow-light);\n}\n\n.stat-content {\n  display: flex;\n  align-items: center;\n  padding: 8px;\n}\n\n.stat-icon {\n  width: 48px;\n  height: 48px;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 16px;\n  font-size: 24px;\n  color: white;\n}\n\n.doc-icon {\n  background-color: #409EFF;\n}\n\n.edit-icon {\n  background-color: #67C23A;\n}\n\n.share-icon {\n  background-color: #E6A23C;\n}\n\n.stat-info {\n  display: flex;\n  flex-direction: column;\n}\n\n.stat-value {\n  font-size: 24px;\n  font-weight: 600;\n  margin-bottom: 4px;\n  color: var(--el-text-color-primary);\n}\n\n.stat-label {\n  font-size: 14px;\n  color: var(--el-text-color-secondary);\n}\n\n/*  */\n.section {\n  margin-bottom: 32px;\n}\n\n/*  */\n.category-section {\n  margin-bottom: 16px;\n}\n\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 16px;\n}\n\n.section-header h3 {\n  font-size: 18px;\n  font-weight: 600;\n  margin: 0;\n  color: #303133;\n}\n\n.section-actions {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n.filter-tag {\n  background-color: #f0f2f5;\n  padding: 4px 8px;\n  border-radius: 4px;\n  font-size: 13px;\n  color: #606266;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n/*  */\n.document-cards {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n  gap: 20px;\n  margin-bottom: 30px;\n}\n\n.doc-card {\n  transition: all 0.3s ease;\n  height: 230px; /*  */\n  display: flex;\n  flex-direction: column;\n}\n\n.doc-card :deep(.el-card__body) {\n  display: flex;\n  flex-direction: column;\n  flex-grow: 1;\n  padding: 16px;\n  min-height: 0;\n}\n\n.doc-card:hover {\n  transform: translateY(-5px);\n  box-shadow: var(--el-box-shadow-light);\n}\n\n/*  */\n.doc-card:hover .doc-actions {\n  opacity: 1;\n  transform: translateY(0);\n}\n\n.doc-card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n  margin-bottom: 12px;\n}\n\n.doc-info {\n  display: inline-flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.doc-type-tag {\n  font-size: 12px;\n  color: #606266;\n  background-color: #f5f7fa;\n  padding: 2px 8px;\n  border-radius: 4px;\n  white-space: nowrap;\n}\n\n.doc-category-tag {\n  font-size: 12px;\n  color: white;\n  padding: 2px 8px;\n  border-radius: 4px;\n  white-space: nowrap;\n  display: inline-flex;\n  align-items: center;\n}\n\n/*  */\n.doc-shared-tag {\n  display: inline-flex;\n  align-items: center;\n  gap: 4px;\n  font-size: 12px;\n  color: #E6A23C;\n  background-color: #fdf6ec;\n  padding: 2px 8px;\n  border-radius: 4px;\n  white-space: nowrap;\n  border: 1px solid #f5dab1;\n}\n\n\n:deep([data-theme=\"dark\"]) .doc-shared-tag span,\n:deep(body.is-dark) .doc-shared-tag span,\n[data-theme=\"dark\"] .doc-shared-tag span,\nhtml[data-theme=\"dark\"] .doc-shared-tag span {\n  color: #000000 !important; \n  font-weight: 400; \n}\n\n.doc-title {\n  margin: 0 0 8px 0;\n  font-size: 16px;\n  font-weight: 600;\n  color: var(--el-text-color-primary);\n  line-height: 1.5;\n  height: calc(1.5em * 2); /*  */\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  word-break: break-all;\n}\n\n.doc-preview {\n  font-size: 14px;\n  color: var(--el-text-color-secondary);\n  line-height: 1.6;\n  height: calc(1.6em * 3); /*  */\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 3;\n  -webkit-box-orient: vertical;\n  word-break: break-all;\n  margin-bottom: 12px;\n}\n\n.doc-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 12px 0 4px;\n  border-top: 1px solid var(--el-border-color-lighter);\n  margin-top: auto;\n  position: relative;\n  z-index: 2;\n}\n\n.doc-time {\n  font-size: 13px;\n  color: var(--el-text-color-secondary);\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-weight: 500;\n}\n\n.doc-actions {\n  display: flex;\n  gap: 8px;\n  position: relative;\n  opacity: 0;\n  transform: translateY(10px);\n  transition: all 0.2s ease-in-out;\n}\n\n.new-doc-card {\n  border: 2px dashed var(--el-border-color);\n  background-color: var(--el-fill-color-light);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.3s;\n  animation: fadeIn 0.4s ease-in-out;\n}\n\n.new-doc-card:hover {\n  border-color: var(--el-color-primary);\n  color: var(--el-color-primary);\n  background-color: var(--el-color-primary-light-9);\n}\n\n.new-doc-content {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  color: var(--el-text-color-secondary);\n}\n\n.new-doc-content .el-icon {\n  font-size: 32px;\n}\n\n/*  */\n.category-cards {\n  display: flex;\n  gap: 16px;\n  overflow-x: auto;\n  padding-bottom: 8px;\n}\n\n.category-card {\n  min-width: 180px;\n  height: 80px;\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  transition: all 0.3s;\n  border-radius: 8px;\n  padding: 12px 16px;\n  border: 2px solid transparent;\n  position: relative;\n  overflow: hidden;\n  background-color: var(--el-fill-color-light);\n}\n\n.category-card:hover {\n  transform: translateY(-4px);\n  box-shadow: var(--el-box-shadow-light);\n  background-color: var(--el-color-primary-light-9);\n}\n\n.category-active {\n  transform: translateY(-2px);\n  box-shadow: var(--el-box-shadow-light);\n  border-color: var(--el-color-primary);\n  background-color: var(--el-color-primary-light-9);\n}\n\n.category-selected-indicator {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  width: 100%;\n  height: 3px;\n  background-color: var(--el-color-primary);\n  transition: all 0.3s;\n}\n\n.category-icon {\n  width: 36px;\n  height: 36px;\n  border-radius: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 18px;\n  color: white;\n  margin-right: 12px;\n  transition: all 0.3s;\n}\n\n.category-active .category-icon {\n  transform: scale(1.1);\n}\n\n.category-info {\n  display: flex;\n  flex-direction: column;\n}\n\n.category-info h4 {\n  margin: 0 0 4px 0;\n  font-size: 15px;\n  font-weight: 500;\n  color: var(--el-text-color-primary);\n  transition: all 0.3s;\n}\n\n.category-active .category-info h4 {\n  color: var(--el-color-primary);\n  font-weight: 600;\n}\n\n.category-count {\n  font-size: 12px;\n  color: var(--el-text-color-secondary);\n}\n\n.mt-4 {\n  margin-top: 16px;\n}\n\n.form-tip {\n  font-size: 12px;\n  color: var(--el-text-color-secondary);\n  margin-top: 4px;\n}\n\n.category-management {\n  display: flex;\n  flex-direction: column;\n  gap: 20px;\n}\n\n.category-list {\n  margin-bottom: 20px;\n}\n\n.category-form {\n  margin-top: 20px;\n}\n\n.color-preview {\n  display: inline-block;\n  width: 20px;\n  height: 20px;\n  border-radius: 4px;\n  margin-right: 8px;\n  vertical-align: middle;\n}\n\n.color-value {\n  margin-left: 12px;\n  color: var(--el-text-color-regular);\n}\n\n.category-select {\n  width: 200px;\n}\n\n.doc-menu {\n  color: var(--el-text-color-secondary);\n  cursor: pointer;\n  position: relative;\n}\n\n/*  */\n.filter-status-bar {\n  background-color: var(--el-color-primary-light-9);\n  padding: 12px 20px;\n  margin-bottom: 20px;\n  border-radius: 8px;\n  transition: all 0.3s ease;\n  animation: slideDown 0.3s ease-in-out;\n  box-shadow: var(--el-box-shadow-light);\n  border-left: 4px solid var(--el-color-primary);\n  position: relative;\n  overflow: hidden;\n}\n\n/*  */\n:deep(.dark .filter-status-bar) {\n  background-color: var(--el-color-primary-dark-2);\n  border-left-color: var(--el-color-primary-light-3);\n}\n\n.filter-bar-content {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.filter-title {\n  font-weight: 500;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: var(--el-text-color-primary);\n}\n\n.filter-category {\n  padding: 4px 10px;\n  border-radius: 4px;\n  color: white;\n  font-size: 14px;\n  font-weight: 600;\n}\n\n.filter-actions {\n  display: flex;\n  align-items: center;\n}\n\n.section {\n  margin-bottom: 32px;\n}\n\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 16px;\n}\n\n.section-header h3 {\n  font-size: 18px;\n  font-weight: 600;\n  margin: 0;\n  color: var(--el-text-color-primary);\n}\n\n.section-actions {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n/*  */\n@keyframes slideDown {\n  from {\n    opacity: 0;\n    transform: translateY(-10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.empty-state {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 200px;\n}\n\n.loading-state {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 200px;\n}\n\n.pagination-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 24px;\n  flex-direction: column;\n  align-items: center;\n  position: relative;\n  z-index: 20;\n}\n\n.pagination-container :deep(.el-pagination) {\n  user-select: none;\n}\n\n.pagination-container :deep(.el-pagination button),\n.pagination-container :deep(.el-pagination .el-pager li) {\n  cursor: pointer !important;\n  z-index: 30;\n  position: relative;\n}\n\n.pagination-debug {\n  margin-top: 8px;\n  color: #909399;\n  font-size: 12px;\n  background-color: #f5f7fa;\n  padding: 4px 8px;\n  border-radius: 4px;\n}\n\n/* CSS */\n.btn-container {\n  position: relative;\n  z-index: 5;\n}\n\n.doc-actions .el-button {\n  position: relative;\n  z-index: 5;\n}\n\n/*  */\n:deep(.el-dropdown-menu) {\n  z-index: 3000 !important;\n}\n\n/*  */\n.card-content-area {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  position: relative;\n  z-index: 1;\n  min-height: 0;\n}\n\n.filter-controls {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n}\n\n/*  */\n.document-cards {\n  display: grid;\n  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));\n  gap: 20px;\n  margin-bottom: 30px;\n}\n\n.doc-card {\n  animation: fadeIn 0.4s ease-in-out;\n}\n\n.fadeIn {\n  animation: fadeIn 0.4s ease-in-out;\n}\n\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n/*  */\n.temp-export-container {\n  position: fixed;\n  top: -9999px;\n  left: -9999px;\n  width: 210mm; /* A4 */\n  background: var(--el-bg-color);\n  padding: 20px;\n  z-index: -1;\n  font-family: SimSun, Arial, sans-serif;\n  font-size: 12pt;\n  line-height: 1.5;\n}\n\n.temp-export-container img {\n  max-width: 100%;\n  height: auto;\n}\n\n.user-permissions-list {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  width: 100%;\n  margin-top: 8px;\n}\n\n.user-permission-item {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background-color: #f9f9f9;\n  padding: 10px;\n  border-radius: 4px;\n  border: 1px solid #eaeaea;\n}\n\n.user-name {\n  min-width: 60px;\n  margin-right: 12px;\n  font-weight: 500;\n}\n\n.permission-info {\n  display: flex;\n  align-items: center;\n}\n\n/*  */\n.form-tip {\n  font-size: 12px;\n  color: var(--el-text-color-secondary);\n  margin-top: 4px;\n}\n\n.dialog-tabs {\n  position: absolute;\n  top: 55px; /* Adjust this value to position the tabs correctly */\n  left: 20px;\n}\n</style> \n\n<style>\n/* ---  --- */\nhtml[data-theme=\"dark\"] .share-dialog .el-dialog {\n  background-color: #2c2c2c;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .el-dialog__header {\n  border-bottom: 1px solid #4f4f4f;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .el-dialog__title {\n  color: #e0e0e0;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .el-dialog__body {\n  color: #cccccc;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog p {\n  color: #cccccc;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .el-form-item__label {\n  color: #cccccc;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .el-radio__label {\n  color: #cccccc;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .el-radio__input .el-radio__inner {\n    background-color: transparent;\n    border-color: #8c8c8c;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .el-radio__input.is-checked .el-radio__inner {\n    border-color: var(--el-color-primary);\n    background-color: var(--el-color-primary);\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .user-permission-item {\n  background-color: #383838;\n  border-color: #4f4f4f;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .user-permission-item .user-name {\n  color: #e0e0e0;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .el-tag {\n    background-color: #4f4f4f;\n    border-color: #6a6a6a;\n    color: #cccccc;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .user-permission-item .el-button--danger.is-link {\n  color: #ff7b7b;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .user-permission-item .el-button--danger.is-link:hover {\n  color: #ff5252;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .form-tip {\n  color: #a0a0a0;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .el-select .el-input__wrapper {\n  background-color: #383838;\n  box-shadow: none;\n  border: 1px solid #4f4f4f;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog .el-select .el-input__inner {\n  color: #e0e0e0;\n}\n\n/* Select dropdown panel */\nhtml[data-theme=\"dark\"] .share-dialog-popper.el-popper {\n  background-color: #2c2c2c;\n  border: 1px solid #4f4f4f;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog-popper .el-select-dropdown__item {\n  color: #cccccc;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog-popper .el-select-dropdown__item.is-selected {\n  color: var(--el-color-primary);\n}\n\nhtml[data-theme=\"dark\"] .share-dialog-popper .el-select-dropdown__item.hover,\nhtml[data-theme=\"dark\"] .share-dialog-popper .el-select-dropdown__item:hover {\n  background-color: #383838;\n}\n\nhtml[data-theme=\"dark\"] .share-dialog-popper .el-popper__arrow::before {\n  background: #2c2c2c;\n  border-right-color: #4f4f4f !important;\n  border-bottom-color: #4f4f4f !important;\n}\n</style>"],"mappings":"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","ignoreList":[]}]}