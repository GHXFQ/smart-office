{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\admin\\UserManagement.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\admin\\UserManagement.vue","mtime":1750381694811},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746431218000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgcmVmLCBvbk1vdW50ZWQgfSBmcm9tICd2dWUnOwppbXBvcnQgYWRtaW5BcGkgZnJvbSAnQC9hcGkvYWRtaW4nOwppbXBvcnQgeyBFbE1lc3NhZ2UsIEVsTWVzc2FnZUJveCB9IGZyb20gJ2VsZW1lbnQtcGx1cyc7CgovLyBTaW1wbGUgZGVib3VuY2UgZnVuY3Rpb24KZnVuY3Rpb24gZGVib3VuY2UoZm4sIGRlbGF5KSB7CiAgbGV0IHRpbWVvdXRJRCA9IG51bGw7CiAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7CiAgICBjbGVhclRpbWVvdXQodGltZW91dElEKTsKICAgIHRpbWVvdXRJRCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICBmbiguLi5hcmdzKTsKICAgIH0sIGRlbGF5KTsKICB9Owp9CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnVXNlck1hbmFnZW1lbnQnLAogIHNldHVwKCkgewogICAgY29uc3QgdXNlcnMgPSByZWYoW10pOwogICAgY29uc3QgY29tcGFuaWVzID0gcmVmKFtdKTsKICAgIGNvbnN0IGNvbXBhbnlEZXBhcnRtZW50cyA9IHJlZihbXSk7IC8vIERlcGFydG1lbnRzIGZvciB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGNvbXBhbnkKICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0gcmVmKCcnKTsKICAgIGNvbnN0IGlzTW9kYWxPcGVuID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVmKHt9KTsKICAgIGNvbnN0IGZldGNoVXNlcnMgPSBhc3luYyAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcGFyYW1zID0gewogICAgICAgICAgc2VhcmNoOiBzZWFyY2hRdWVyeS52YWx1ZQogICAgICAgIH07CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhZG1pbkFwaS5nZXRVc2VycyhwYXJhbXMpOwogICAgICAgIHVzZXJzLnZhbHVlID0gcmVzcG9uc2UuZGF0YS5yZXN1bHRzOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIuiOt+WPlueUqOaIt+WIl+ihqOWksei0pToiLCBlcnJvcik7CiAgICAgIH0KICAgIH07CiAgICBjb25zdCBkZWJvdW5jZWRGZXRjaFVzZXJzID0gZGVib3VuY2UoZmV0Y2hVc2VycywgMzAwKTsKICAgIGNvbnN0IGZldGNoQ29tcGFuaWVzID0gYXN5bmMgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWRtaW5BcGkuZ2V0Q29tcGFuaWVzKHsKICAgICAgICAgIGFsbDogJ3RydWUnCiAgICAgICAgfSk7CiAgICAgICAgY29tcGFuaWVzLnZhbHVlID0gcmVzcG9uc2UuZGF0YTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCLojrflj5blhazlj7jliJfooajlpLHotKU6IiwgZXJyb3IpOwogICAgICB9CiAgICB9OwogICAgY29uc3QgZmV0Y2hEZXBhcnRtZW50c0ZvckNvbXBhbnkgPSBhc3luYyBjb21wYW55SWQgPT4gewogICAgICBpZiAoIWNvbXBhbnlJZCkgewogICAgICAgIGNvbXBhbnlEZXBhcnRtZW50cy52YWx1ZSA9IFtdOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGNvbnN0IHBhcmFtcyA9IHsKICAgICAgICAgIGFsbDogJ3RydWUnLAogICAgICAgICAgY29tcGFueV9pZDogY29tcGFueUlkCiAgICAgICAgfTsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFkbWluQXBpLmdldERlcGFydG1lbnRzKHBhcmFtcyk7CiAgICAgICAgY29tcGFueURlcGFydG1lbnRzLnZhbHVlID0gcmVzcG9uc2UuZGF0YTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGDojrflj5blhazlj7ggJHtjb21wYW55SWR9IOeahOmDqOmXqOWIl+ihqOWksei0pTpgLCBlcnJvcik7CiAgICAgICAgY29tcGFueURlcGFydG1lbnRzLnZhbHVlID0gW107CiAgICAgIH0KICAgIH07CiAgICBjb25zdCBvbkNvbXBhbnlDaGFuZ2UgPSBhc3luYyAoKSA9PiB7CiAgICAgIC8vIFJlc2V0IGRlcGFydG1lbnQgd2hlbiBjb21wYW55IGNoYW5nZXMKICAgICAgY3VycmVudFVzZXIudmFsdWUuZGVwYXJ0bWVudCA9IG51bGw7CiAgICAgIGF3YWl0IGZldGNoRGVwYXJ0bWVudHNGb3JDb21wYW55KGN1cnJlbnRVc2VyLnZhbHVlLmNvbXBhbnkpOwogICAgfTsKICAgIGNvbnN0IG9wZW5Vc2VyTW9kYWwgPSBhc3luYyAodXNlciA9IHt9KSA9PiB7CiAgICAgIGF3YWl0IGZldGNoQ29tcGFuaWVzKCk7CiAgICAgIGN1cnJlbnRVc2VyLnZhbHVlID0gewogICAgICAgIC4uLnVzZXIKICAgICAgfTsKICAgICAgY29tcGFueURlcGFydG1lbnRzLnZhbHVlID0gW107IC8vIFJlc2V0IGRlcGFydG1lbnRzIGxpc3QKICAgICAgaWYgKHVzZXIuY29tcGFueSkgewogICAgICAgIGF3YWl0IGZldGNoRGVwYXJ0bWVudHNGb3JDb21wYW55KHVzZXIuY29tcGFueSk7CiAgICAgIH0KICAgICAgaWYgKCF1c2VyLmlkKSB7CiAgICAgICAgY3VycmVudFVzZXIudmFsdWUucGFzc3dvcmQgPSAnJzsKICAgICAgfQogICAgICBpc01vZGFsT3Blbi52YWx1ZSA9IHRydWU7CiAgICB9OwogICAgY29uc3QgY2xvc2VVc2VyTW9kYWwgPSAoKSA9PiB7CiAgICAgIGlzTW9kYWxPcGVuLnZhbHVlID0gZmFsc2U7CiAgICAgIGN1cnJlbnRVc2VyLnZhbHVlID0ge307CiAgICAgIGNvbXBhbnlEZXBhcnRtZW50cy52YWx1ZSA9IFtdOwogICAgfTsKICAgIGNvbnN0IHNhdmVVc2VyID0gYXN5bmMgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHVzZXJEYXRhID0gewogICAgICAgICAgLi4uY3VycmVudFVzZXIudmFsdWUKICAgICAgICB9OwoKICAgICAgICAvLyDlpoLmnpzlr4bnoIHlrZfmrrXkuLrnqbrvvIzliJnku47mj5DkuqTmlbDmja7kuK3liKDpmaTvvIzku6Xpgb/lhY3lkI7nq6/pqozor4HplJnor68KICAgICAgICBpZiAoIXVzZXJEYXRhLnBhc3N3b3JkKSB7CiAgICAgICAgICBkZWxldGUgdXNlckRhdGEucGFzc3dvcmQ7CiAgICAgICAgfQoKICAgICAgICAvLyDlpoLmnpzpg6jpl6jmnKrpgInmi6nvvIjkuLpudWxs77yJ77yM5YiZ5LuO5o+Q5Lqk5pWw5o2u5Lit5Yig6ZmkCiAgICAgICAgaWYgKHVzZXJEYXRhLmRlcGFydG1lbnQgPT09IG51bGwpIHsKICAgICAgICAgIGRlbGV0ZSB1c2VyRGF0YS5kZXBhcnRtZW50OwogICAgICAgIH0KICAgICAgICBpZiAodXNlckRhdGEuaWQpIHsKICAgICAgICAgIGF3YWl0IGFkbWluQXBpLnVwZGF0ZVVzZXIodXNlckRhdGEuaWQsIHVzZXJEYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXdhaXQgYWRtaW5BcGkuY3JlYXRlVXNlcih1c2VyRGF0YSk7CiAgICAgICAgfQogICAgICAgIGNsb3NlVXNlck1vZGFsKCk7CiAgICAgICAgZmV0Y2hVc2VycygpOwogICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCfnlKjmiLfkv53lrZjmiJDlip/vvIEnKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICB2YXIgX2Vycm9yJHJlc3BvbnNlLCBfZXJyb3IkcmVzcG9uc2UyOwogICAgICAgIGNvbnNvbGUuZXJyb3IoIuS/neWtmOeUqOaIt+Wksei0pToiLCAoKF9lcnJvciRyZXNwb25zZSA9IGVycm9yLnJlc3BvbnNlKSA9PT0gbnVsbCB8fCBfZXJyb3IkcmVzcG9uc2UgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lcnJvciRyZXNwb25zZS5kYXRhKSB8fCBlcnJvci5tZXNzYWdlKTsKICAgICAgICBjb25zdCBlcnJvck1zZyA9IChfZXJyb3IkcmVzcG9uc2UyID0gZXJyb3IucmVzcG9uc2UpICE9PSBudWxsICYmIF9lcnJvciRyZXNwb25zZTIgIT09IHZvaWQgMCAmJiBfZXJyb3IkcmVzcG9uc2UyLmRhdGEgPyBKU09OLnN0cmluZ2lmeShlcnJvci5yZXNwb25zZS5kYXRhKSA6ICfor7fmo4Dmn6XnvZHnu5zmiJbogZTns7vmioDmnK/mlK/mjIEnOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcihg5L+d5a2Y55So5oi35aSx6LSlOiAke2Vycm9yTXNnfWApOwogICAgICB9CiAgICB9OwogICAgY29uc3QgY29uZmlybURlbGV0ZVVzZXIgPSB1c2VyID0+IHsKICAgICAgRWxNZXNzYWdlQm94LmNvbmZpcm0oYOehruWumuimgeWIoOmZpOeUqOaIt+OAkCR7dXNlci5uYW1lIHx8IHVzZXIudXNlcm5hbWV944CR5ZCX77yf5q2k5pON5L2c5peg5rOV5pKk6ZSA44CCYCwgJ+itpuWRiicsIHsKICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruWumuWIoOmZpCcsCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+WPlua2iCcsCiAgICAgICAgdHlwZTogJ3dhcm5pbmcnCiAgICAgIH0pLnRoZW4oYXN5bmMgKCkgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICBhd2FpdCBhZG1pbkFwaS5kZWxldGVVc2VyKHVzZXIuaWQpOwogICAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+eUqOaIt+WIoOmZpOaIkOWKnycpOwogICAgICAgICAgZmV0Y2hVc2VycygpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WIoOmZpOeUqOaIt+Wksei0pScpOwogICAgICAgICAgY29uc29sZS5lcnJvcigi5Yig6Zmk55So5oi35aSx6LSlOiIsIGVycm9yKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKCgpID0+IHsKICAgICAgICBFbE1lc3NhZ2UuaW5mbygn5bey5Y+W5raI5Yig6ZmkJyk7CiAgICAgIH0pOwogICAgfTsKICAgIG9uTW91bnRlZCgoKSA9PiB7CiAgICAgIGZldGNoVXNlcnMoKTsKICAgICAgZmV0Y2hDb21wYW5pZXMoKTsKICAgIH0pOwogICAgcmV0dXJuIHsKICAgICAgdXNlcnMsCiAgICAgIGNvbXBhbmllcywKICAgICAgY29tcGFueURlcGFydG1lbnRzLAogICAgICBvbkNvbXBhbnlDaGFuZ2UsCiAgICAgIHNlYXJjaFF1ZXJ5LAogICAgICBpc01vZGFsT3BlbiwKICAgICAgY3VycmVudFVzZXIsCiAgICAgIGZldGNoVXNlcnMsCiAgICAgIGRlYm91bmNlZEZldGNoVXNlcnMsCiAgICAgIG9wZW5Vc2VyTW9kYWwsCiAgICAgIGNsb3NlVXNlck1vZGFsLAogICAgICBzYXZlVXNlciwKICAgICAgY29uZmlybURlbGV0ZVVzZXIKICAgIH07CiAgfQp9Ow=="},{"version":3,"names":["ref","onMounted","adminApi","ElMessage","ElMessageBox","debounce","fn","delay","timeoutID","args","clearTimeout","setTimeout","name","setup","users","companies","companyDepartments","searchQuery","isModalOpen","currentUser","fetchUsers","params","search","value","response","getUsers","data","results","error","console","debouncedFetchUsers","fetchCompanies","getCompanies","all","fetchDepartmentsForCompany","companyId","company_id","getDepartments","onCompanyChange","department","company","openUserModal","user","id","password","closeUserModal","saveUser","userData","updateUser","createUser","success","_error$response","_error$response2","message","errorMsg","JSON","stringify","confirmDeleteUser","confirm","username","confirmButtonText","cancelButtonText","type","then","deleteUser","catch","info"],"sources":["C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\admin\\UserManagement.vue"],"sourcesContent":["<template>\n  <div class=\"management-container\">\n    <div class=\"header\">\n      <h2>用户管理</h2>\n      <div class=\"actions\">\n        <input \n          type=\"text\" \n          placeholder=\"搜索用户...\" \n          class=\"search-input\"\n          v-model=\"searchQuery\"\n          @input=\"debouncedFetchUsers\" \n        />\n        <button class=\"btn-primary\" @click=\"openUserModal()\">添加用户</button>\n      </div>\n    </div>\n    <div class=\"table-container\">\n      <table>\n        <thead>\n          <tr>\n            <th>序号</th>\n            <th>用户名</th>\n            <th>邮箱</th>\n            <th>公司</th>\n            <th>部门</th>\n            <th>职位</th>\n            <th>角色</th>\n            <th>操作</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for=\"(user, index) in users\" :key=\"user.id\">\n            <td>{{ index + 1 }}</td>\n            <td>{{ user.name || user.username }}</td>\n            <td>{{ user.email }}</td>\n            <td>{{ user.company_name || '未分配' }}</td>\n            <td>{{ user.department_name || '未分配' }}</td>\n            <td>{{ user.position || '未指定' }}</td>\n            <td>\n              <span v-if=\"user.is_staff\" class=\"role-tag role-admin\">管理员</span>\n              <span v-else-if=\"user.is_department_manager\" class=\"role-tag role-manager\">部门主管</span>\n              <span v-else class=\"role-tag role-user\">员工</span>\n            </td>\n            <td class=\"action-buttons\">\n              <button class=\"btn-edit\" @click=\"openUserModal(user)\">编辑</button>\n              <button class=\"btn-delete\" @click=\"confirmDeleteUser(user)\">删除</button>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n\n    <!-- 添加/编辑用户模态框 -->\n    <div v-if=\"isModalOpen\" class=\"modal-overlay\">\n      <div class=\"modal-content\">\n        <h3>{{ currentUser.id ? '编辑用户' : '添加用户' }}</h3>\n        <form @submit.prevent=\"saveUser\">\n          <div class=\"form-group\">\n            <label>用户名:</label>\n            <input type=\"text\" v-model=\"currentUser.username\" required />\n          </div>\n           <div class=\"form-group\">\n            <label>姓名:</label>\n            <input type=\"text\" v-model=\"currentUser.name\" />\n          </div>\n          <div class=\"form-group\">\n            <label>邮箱:</label>\n            <input type=\"email\" v-model=\"currentUser.email\" required />\n          </div>\n          <div class=\"form-group\">\n            <label>密码:</label>\n            <input type=\"password\" :placeholder=\"currentUser.id ? '留空则不修改' : ''\" v-model=\"currentUser.password\" :required=\"!currentUser.id\" />\n          </div>\n          <div class=\"form-group\">\n            <label>职位:</label>\n            <input type=\"text\" v-model=\"currentUser.position\" />\n          </div>\n          <div class=\"form-group\">\n            <label>所属公司:</label>\n            <select v-model=\"currentUser.company\" @change=\"onCompanyChange\" required>\n              <option :value=\"null\" disabled>-- 请选择公司 --</option>\n              <option v-for=\"company in companies\" :key=\"company.id\" :value=\"company.id\">\n                {{ company.name }}\n              </option>\n            </select>\n          </div>\n          <div class=\"form-group\" v-if=\"currentUser.company\">\n            <label>所属部门:</label>\n            <select v-model=\"currentUser.department\" :disabled=\"!currentUser.company\">\n              <option :value=\"null\">-- 未分配 --</option>\n              <option v-for=\"dept in companyDepartments\" :key=\"dept.id\" :value=\"dept.id\">\n                {{ dept.name }}\n              </option>\n            </select>\n          </div>\n          <div class=\"form-actions\">\n            <button type=\"submit\" class=\"btn-primary\">保存</button>\n            <button type=\"button\" @click=\"closeUserModal\" class=\"btn-secondary\">取消</button>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, onMounted } from 'vue';\nimport adminApi from '@/api/admin';\nimport { ElMessage, ElMessageBox } from 'element-plus';\n\n// Simple debounce function\nfunction debounce(fn, delay) {\n  let timeoutID = null;\n  return function(...args) {\n    clearTimeout(timeoutID);\n    timeoutID = setTimeout(() => {\n      fn(...args);\n    }, delay);\n  };\n}\n\nexport default {\n  name: 'UserManagement',\n  setup() {\n    const users = ref([]);\n    const companies = ref([]);\n    const companyDepartments = ref([]); // Departments for the currently selected company\n    const searchQuery = ref('');\n    const isModalOpen = ref(false);\n    const currentUser = ref({});\n\n    const fetchUsers = async () => {\n      try {\n        const params = { search: searchQuery.value };\n        const response = await adminApi.getUsers(params);\n        users.value = response.data.results;\n      } catch (error) {\n        console.error(\"获取用户列表失败:\", error);\n      }\n    };\n\n    const debouncedFetchUsers = debounce(fetchUsers, 300);\n\n    const fetchCompanies = async () => {\n        try {\n            const response = await adminApi.getCompanies({ all: 'true' });\n            companies.value = response.data;\n        } catch (error) {\n            console.error(\"获取公司列表失败:\", error);\n        }\n    };\n\n    const fetchDepartmentsForCompany = async (companyId) => {\n      if (!companyId) {\n        companyDepartments.value = [];\n        return;\n      }\n      try {\n        const params = { all: 'true', company_id: companyId };\n        const response = await adminApi.getDepartments(params);\n        companyDepartments.value = response.data;\n      } catch (error) {\n        console.error(`获取公司 ${companyId} 的部门列表失败:`, error);\n        companyDepartments.value = [];\n      }\n    };\n\n    const onCompanyChange = async () => {\n      // Reset department when company changes\n      currentUser.value.department = null;\n      await fetchDepartmentsForCompany(currentUser.value.company);\n    };\n    \n    const openUserModal = async (user = {}) => {\n      await fetchCompanies();\n      currentUser.value = { ...user };\n      companyDepartments.value = []; // Reset departments list\n      if (user.company) {\n        await fetchDepartmentsForCompany(user.company);\n      }\n      if (!user.id) {\n        currentUser.value.password = '';\n      }\n      isModalOpen.value = true;\n    };\n\n    const closeUserModal = () => {\n      isModalOpen.value = false;\n      currentUser.value = {};\n      companyDepartments.value = [];\n    };\n\n    const saveUser = async () => {\n      try {\n        const userData = { ...currentUser.value };\n        \n        // 如果密码字段为空，则从提交数据中删除，以避免后端验证错误\n        if (!userData.password) {\n          delete userData.password;\n        }\n\n        // 如果部门未选择（为null），则从提交数据中删除\n        if (userData.department === null) {\n          delete userData.department;\n        }\n\n        if (userData.id) {\n          await adminApi.updateUser(userData.id, userData);\n        } else {\n          await adminApi.createUser(userData);\n        }\n        closeUserModal();\n        fetchUsers();\n        ElMessage.success('用户保存成功！');\n      } catch (error) {\n        console.error(\"保存用户失败:\", error.response?.data || error.message);\n        const errorMsg = error.response?.data ? JSON.stringify(error.response.data) : '请检查网络或联系技术支持';\n        ElMessage.error(`保存用户失败: ${errorMsg}`);\n      }\n    };\n\n    const confirmDeleteUser = (user) => {\n      ElMessageBox.confirm(\n        `确定要删除用户【${user.name || user.username}】吗？此操作无法撤销。`,\n        '警告',\n        {\n          confirmButtonText: '确定删除',\n          cancelButtonText: '取消',\n          type: 'warning',\n        }\n      ).then(async () => {\n        try {\n          await adminApi.deleteUser(user.id);\n          ElMessage.success('用户删除成功');\n          fetchUsers();\n        } catch (error) {\n          ElMessage.error('删除用户失败');\n          console.error(\"删除用户失败:\", error);\n        }\n      }).catch(() => {\n        ElMessage.info('已取消删除');\n      });\n    };\n\n    onMounted(() => {\n        fetchUsers();\n        fetchCompanies();\n    });\n\n    return {\n      users,\n      companies,\n      companyDepartments,\n      onCompanyChange,\n      searchQuery,\n      isModalOpen,\n      currentUser,\n      fetchUsers,\n      debouncedFetchUsers,\n      openUserModal,\n      closeUserModal,\n      saveUser,\n      confirmDeleteUser,\n    };\n  },\n};\n</script>\n\n<style scoped>\n.management-container {\n  background-color: white;\n  padding: 24px;\n  border-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0,0,0,0.09);\n}\n\n.header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 20px;\n}\n\n.header h2 {\n  margin: 0;\n  font-size: 20px;\n}\n\n.actions {\n  display: flex;\n  gap: 10px;\n}\n\n.search-input {\n  padding: 8px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 4px;\n  font-size: 14px;\n}\n\n.btn-primary {\n  background-color: #1890ff;\n  color: white;\n  border: none;\n  padding: 8px 16px;\n  border-radius: 4px;\n  cursor: pointer;\n  font-size: 14px;\n}\n.btn-primary:hover {\n  background-color: #40a9ff;\n}\n\n.table-container {\n  overflow-x: auto;\n}\n\ntable {\n  width: 100%;\n  border-collapse: collapse;\n  font-size: 14px;\n}\n\nth, td {\n  padding: 12px 16px;\n  text-align: left;\n  border-bottom: 1px solid #f0f0f0;\n}\n\nthead th {\n  background-color: #fafafa;\n  font-weight: 500;\n  color: #000000d9;\n}\n\n.role-tag {\n  padding: 4px 8px;\n  border-radius: 12px;\n  font-size: 12px;\n  color: white;\n}\n\n.role-admin {\n  background-color: #f5222d;\n}\n\n.role-user {\n  background-color: #52c41a;\n}\n\n.role-manager {\n  background-color: #1890ff;\n}\n\n.action-buttons button {\n  border: none;\n  background: none;\n  cursor: pointer;\n  font-size: 14px;\n  margin-right: 8px;\n}\n\n.btn-edit {\n  color: #1890ff;\n}\n\n.btn-delete {\n  color: #f5222d;\n}\n\n.modal-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 1000;\n}\n\n.modal-content {\n  background-color: white;\n  padding: 20px 30px;\n  border-radius: 8px;\n  width: 400px;\n  box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n}\n\n.modal-content h3 {\n  margin-top: 0;\n  margin-bottom: 20px;\n}\n\n.form-group {\n  margin-bottom: 15px;\n}\n\n.form-group label {\n  display: block;\n  margin-bottom: 5px;\n}\n\n.form-group input[type=\"text\"],\n.form-group input[type=\"email\"],\n.form-group input[type=\"password\"] {\n  width: 100%;\n  padding: 8px;\n  border: 1px solid #ccc;\n  border-radius: 4px;\n}\n\n.form-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 10px;\n  margin-top: 20px;\n}\n.btn-secondary {\n    background-color: #f0f2f5;\n    border: 1px solid #d9d9d9;\n    color: #595959;\n    padding: 8px 16px;\n    border-radius: 4px;\n    cursor: pointer;\n}\n\n.form-group input[type=\"checkbox\"] {\n    width: auto;\n    height: auto;\n    margin-right: 10px;\n}\n</style> "],"mappings":"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","ignoreList":[]}]}