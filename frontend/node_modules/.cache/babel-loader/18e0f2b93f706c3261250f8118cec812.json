{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\components\\GlobalSearch.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\components\\GlobalSearch.vue","mtime":1750500514885},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746431218000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJlZHVjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IucmVkdWNlLmpzIjsKaW1wb3J0IHsgcmVmIH0gZnJvbSAndnVlJzsKaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSAndnVlLXJvdXRlcic7CmltcG9ydCB7IGdsb2JhbFNlYXJjaCB9IGZyb20gJ0AvYXBpL3NlYXJjaCc7IC8vIOmcgOimgeWcqGFwaeS4reWIm+W7uuatpOaWueazlQppbXBvcnQgeyBkZWJvdW5jZSB9IGZyb20gJ2xvZGFzaCc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnR2xvYmFsU2VhcmNoJywKICBzZXR1cChwcm9wcywgewogICAgZXhwb3NlCiAgfSkgewogICAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKCk7CiAgICBjb25zdCBzZWxlY3RlZFZhbHVlID0gcmVmKCcnKTsKICAgIGNvbnN0IGN1cnJlbnRRdWVyeSA9IHJlZignJyk7CiAgICBjb25zdCBzZWFyY2hSZXN1bHRzID0gcmVmKFtdKTsKICAgIGNvbnN0IGxvYWRpbmcgPSByZWYoZmFsc2UpOwogICAgY29uc3Qgc2VhcmNoQ291bnRlciA9IHJlZigwKTsgLy8g55So5LqO5aSE55CG56ue5oCB5p2h5Lu255qE6K6h5pWw5ZmoCgogICAgLy8g5bCB6KOF5LiA5Liq5riF5pmw55qE5riF6Zmk54q25oCB55qE5Ye95pWwCiAgICBjb25zdCBjbGVhclNlYXJjaFN0YXRlID0gKCkgPT4gewogICAgICBzZWxlY3RlZFZhbHVlLnZhbHVlID0gJyc7CiAgICAgIGN1cnJlbnRRdWVyeS52YWx1ZSA9ICcnOwogICAgICBzZWFyY2hSZXN1bHRzLnZhbHVlID0gW107CiAgICAgIGxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgIH07CiAgICBjb25zdCBzZWFyY2ggPSBkZWJvdW5jZShhc3luYyBxdWVyeSA9PiB7CiAgICAgIGN1cnJlbnRRdWVyeS52YWx1ZSA9IHF1ZXJ5OwogICAgICBzZWFyY2hDb3VudGVyLnZhbHVlKys7IC8vIOS4uuavj+S4quaWsOaQnOe0ouWinuWKoOiuoeaVsOWZqAogICAgICBjb25zdCBsb2NhbENvdW50ZXIgPSBzZWFyY2hDb3VudGVyLnZhbHVlOwogICAgICBpZiAocXVlcnkgJiYgcXVlcnkudHJpbSgpLmxlbmd0aCA+PSAyKSB7CiAgICAgICAgbG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgZGF0YQogICAgICAgICAgfSA9IGF3YWl0IGdsb2JhbFNlYXJjaChxdWVyeSk7CiAgICAgICAgICAvLyDku4XlvZPov5nmmK/mnIDmlrDnmoTmkJzntKLml7bmiY3mm7TmlrDnu5PmnpwKICAgICAgICAgIGlmIChsb2NhbENvdW50ZXIgPT09IHNlYXJjaENvdW50ZXIudmFsdWUpIHsKICAgICAgICAgICAgY29uc3QgZ3JvdXBlZCA9IGRhdGEucmVkdWNlKChhY2MsIGl0ZW0pID0+IHsKICAgICAgICAgICAgICBpZiAoIWFjY1tpdGVtLnR5cGVdKSB7CiAgICAgICAgICAgICAgICBhY2NbaXRlbS50eXBlXSA9IHsKICAgICAgICAgICAgICAgICAgdHlwZTogaXRlbS50eXBlLAogICAgICAgICAgICAgICAgICBpdGVtczogW10KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGFjY1tpdGVtLnR5cGVdLml0ZW1zLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgcmV0dXJuIGFjYzsKICAgICAgICAgICAgfSwge30pOwogICAgICAgICAgICBzZWFyY2hSZXN1bHRzLnZhbHVlID0gT2JqZWN0LnZhbHVlcyhncm91cGVkKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgLy8g5LuF5Li65pyA5paw55qE5pCc57Si5oql5ZGK6ZSZ6K+vCiAgICAgICAgICBpZiAobG9jYWxDb3VudGVyID09PSBzZWFyY2hDb3VudGVyLnZhbHVlKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0dsb2JhbCBzZWFyY2ggZmFpbGVkOicsIGVycm9yKTsKICAgICAgICAgICAgc2VhcmNoUmVzdWx0cy52YWx1ZSA9IFtdOwogICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAvLyDku4XkuLrmnIDmlrDnmoTmkJzntKLmm7TmlrDliqDovb3nirbmgIEKICAgICAgICAgIGlmIChsb2NhbENvdW50ZXIgPT09IHNlYXJjaENvdW50ZXIudmFsdWUpIHsKICAgICAgICAgICAgbG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzZWFyY2hSZXN1bHRzLnZhbHVlID0gW107CiAgICAgICAgbG9hZGluZy52YWx1ZSA9IGZhbHNlOyAvLyDlpoLmnpzovpPlhaXml6DmlYjvvIznoa7kv53lgZzmraLliqDovb0KICAgICAgfQogICAgfSwgMzAwKTsKICAgIGNvbnN0IGhhbmRsZVNlbGVjdCA9IHVybCA9PiB7CiAgICAgIGlmICh1cmwpIHsKICAgICAgICByb3V0ZXIucHVzaCh1cmwpOwogICAgICAgIHNlYXJjaENvdW50ZXIudmFsdWUrKzsgLy8g5L2/5omA5pyJ5b6F5aSE55CG55qE6K+35rGC5peg5pWICiAgICAgICAgY2xlYXJTZWFyY2hTdGF0ZSgpOwogICAgICB9CiAgICB9OwoKICAgIC8vIOS7juWklumDqOiwg+eUqOeahOa4hemZpOaWueazlQogICAgY29uc3QgY2xlYXJTZWFyY2ggPSAoKSA9PiB7CiAgICAgIHNlYXJjaENvdW50ZXIudmFsdWUrKzsgLy8g5L2/5omA5pyJ5b6F5aSE55CG55qE6K+35rGC5peg5pWICiAgICAgIGNsZWFyU2VhcmNoU3RhdGUoKTsKICAgIH07CiAgICBleHBvc2UoewogICAgICBjbGVhclNlYXJjaAogICAgfSk7CiAgICByZXR1cm4gewogICAgICBzZWxlY3RlZFZhbHVlLAogICAgICBjdXJyZW50UXVlcnksCiAgICAgIHNlYXJjaFJlc3VsdHMsCiAgICAgIGxvYWRpbmcsCiAgICAgIHNlYXJjaCwKICAgICAgaGFuZGxlU2VsZWN0CiAgICB9OwogIH0KfTs="},{"version":3,"names":["ref","useRouter","globalSearch","debounce","name","setup","props","expose","router","selectedValue","currentQuery","searchResults","loading","searchCounter","clearSearchState","value","search","query","localCounter","trim","length","data","grouped","reduce","acc","item","type","items","push","Object","values","error","console","handleSelect","url","clearSearch"],"sources":["C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\components\\GlobalSearch.vue"],"sourcesContent":["<template>\n  <div class=\"global-search-container\">\n    <el-select\n      v-model=\"selectedValue\"\n      filterable\n      remote\n      reserve-keyword\n      placeholder=\"在所有应用中搜索...\"\n      :remote-method=\"search\"\n      :loading=\"loading\"\n      @change=\"handleSelect\"\n      class=\"global-search-input\"\n      size=\"large\"\n    >\n      <el-option-group\n        v-for=\"group in searchResults\"\n        :key=\"group.type\"\n        :label=\"group.type\"\n      >\n        <el-option\n          v-for=\"item in group.items\"\n          :key=\"item.id + item.type\"\n          :label=\"item.title\"\n          :value=\"item.url\"\n        >\n          <div class=\"search-result-item\">\n            <span class=\"title\">{{ item.title }}</span>\n            <span class=\"summary\">{{ item.summary }}</span>\n          </div>\n        </el-option>\n      </el-option-group>\n      <template #empty>\n        <div class=\"search-empty-state\">\n          <span v-if=\"currentQuery && currentQuery.trim().length > 0 && currentQuery.trim().length < 2\">请输入至少两个字符进行搜索</span>\n          <span v-else-if=\"!loading\">没有找到匹配的结果</span>\n        </div>\n      </template>\n    </el-select>\n  </div>\n</template>\n\n<script>\nimport { ref } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { globalSearch } from '@/api/search'; // 需要在api中创建此方法\nimport { debounce } from 'lodash';\n\nexport default {\n  name: 'GlobalSearch',\n  setup(props, { expose }) {\n    const router = useRouter();\n    const selectedValue = ref('');\n    const currentQuery = ref('');\n    const searchResults = ref([]);\n    const loading = ref(false);\n    const searchCounter = ref(0); // 用于处理竞态条件的计数器\n\n    // 封装一个清晰的清除状态的函数\n    const clearSearchState = () => {\n      selectedValue.value = '';\n      currentQuery.value = '';\n      searchResults.value = [];\n      loading.value = false;\n    };\n\n    const search = debounce(async (query) => {\n      currentQuery.value = query;\n      searchCounter.value++; // 为每个新搜索增加计数器\n      const localCounter = searchCounter.value;\n\n      if (query && query.trim().length >= 2) {\n        loading.value = true;\n        try {\n          const { data } = await globalSearch(query);\n          // 仅当这是最新的搜索时才更新结果\n          if (localCounter === searchCounter.value) {\n            const grouped = data.reduce((acc, item) => {\n              if (!acc[item.type]) {\n                acc[item.type] = { type: item.type, items: [] };\n              }\n              acc[item.type].items.push(item);\n              return acc;\n            }, {});\n            searchResults.value = Object.values(grouped);\n          }\n        } catch (error) {\n          // 仅为最新的搜索报告错误\n          if (localCounter === searchCounter.value) {\n            console.error('Global search failed:', error);\n            searchResults.value = [];\n          }\n        } finally {\n          // 仅为最新的搜索更新加载状态\n          if (localCounter === searchCounter.value) {\n            loading.value = false;\n          }\n        }\n      } else {\n        searchResults.value = [];\n        loading.value = false; // 如果输入无效，确保停止加载\n      }\n    }, 300);\n\n    const handleSelect = (url) => {\n      if (url) {\n        router.push(url);\n        searchCounter.value++; // 使所有待处理的请求无效\n        clearSearchState();\n      }\n    };\n\n    // 从外部调用的清除方法\n    const clearSearch = () => {\n      searchCounter.value++; // 使所有待处理的请求无效\n      clearSearchState();\n    };\n\n    expose({\n      clearSearch\n    });\n\n    return {\n      selectedValue,\n      currentQuery,\n      searchResults,\n      loading,\n      search,\n      handleSelect,\n    };\n  },\n};\n</script>\n\n<style scoped>\n.global-search-container {\n  width: 400px;\n}\n.global-search-input {\n  width: 100%;\n}\n.search-result-item {\n  display: flex;\n  flex-direction: column;\n}\n.title {\n  font-weight: 500;\n}\n.summary {\n  font-size: 0.8rem;\n  color: #888;\n}\n.search-empty-state {\n  padding: 10px;\n  text-align: center;\n  color: #999;\n}\n</style> "],"mappings":"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","ignoreList":[]}]}