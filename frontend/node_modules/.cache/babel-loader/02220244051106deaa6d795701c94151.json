{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\chat\\Index.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\chat\\Index.vue","mtime":1752066136042},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746431218000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5zb21lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybC1zZWFyY2gtcGFyYW1zLmRlbGV0ZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwtc2VhcmNoLXBhcmFtcy5oYXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLXNlYXJjaC1wYXJhbXMuc2l6ZS5qcyI7CmltcG9ydCB7IHJlZiwgcmVhY3RpdmUsIGNvbXB1dGVkLCBuZXh0VGljaywgb25Nb3VudGVkLCBvbkJlZm9yZVVubW91bnQsIHdhdGNoIH0gZnJvbSAndnVlJzsKaW1wb3J0IHsgdXNlU3RvcmUgfSBmcm9tICd2dWV4JzsKaW1wb3J0IHsgdXNlUm91dGUgfSBmcm9tICd2dWUtcm91dGVyJzsKaW1wb3J0IHsgRWxNZXNzYWdlLCBFbE1lc3NhZ2VCb3ggfSBmcm9tICdlbGVtZW50LXBsdXMnOwppbXBvcnQgeyBTZWFyY2gsIFJlZnJlc2gsIENoYXREb3RTcXVhcmUsIFVzZXJGaWxsZWQsIENoYXRMaW5lU3F1YXJlLCBQaWN0dXJlRmlsbGVkLCBGb2xkZXJPcGVuZWQsIFJlYWRpbmcsIE1pY3JvcGhvbmUsIFBvc2l0aW9uLCBEb2N1bWVudCwgQ2FsZW5kYXIsIERvY3VtZW50Q29weSB9IGZyb20gJ0BlbGVtZW50LXBsdXMvaWNvbnMtdnVlJzsKaW1wb3J0IHsgZ2V0Q2hhdFNlc3Npb25zLCBnZXRDaGF0U2Vzc2lvbiwgc2VuZFRleHRNZXNzYWdlLCBzZW5kSW1hZ2VNZXNzYWdlLCBzZW5kS25vd2xlZGdlTWVzc2FnZSwgZG93bmxvYWRNZXNzYWdlRmlsZSwgc2VuZEZpbGVNZXNzYWdlLCBzdW1tYXJpemVDaGF0LCBhbmFseXplRm9yQ2FsZW5kYXIsIGNyZWF0ZUNhbGVuZGFyRXZlbnQgfSBmcm9tICdAL2FwaS9jaGF0JzsKaW1wb3J0IHsgZ2V0S25vd2xlZGdlTGlzdCB9IGZyb20gJ0AvYXBpL2tub3dsZWRnZSc7Ci8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFycwppbXBvcnQgeyBmb3JtYXREYXRlIH0gZnJvbSAnQC91dGlscy9kYXRlJzsKaW1wb3J0IHJlcXVlc3QgZnJvbSAnQC91dGlscy9yZXF1ZXN0JzsKaW1wb3J0IHsgYWlDaGF0V2l0aERvY3VtZW50cyB9IGZyb20gJ0AvYXBpL2FpJzsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdDaGF0JywKICBjb21wb25lbnRzOiB7CiAgICBDYWxlbmRhciwKICAgIERvY3VtZW50Q29weQogIH0sCiAgc2V0dXAoKSB7CiAgICBjb25zdCBzdG9yZSA9IHVzZVN0b3JlKCk7CiAgICBjb25zdCBjdXJyZW50VXNlciA9IGNvbXB1dGVkKCgpID0+IHN0b3JlLmdldHRlcnMudXNlcik7CgogICAgLy8g5re75Yqg5pys5Zyw55So5oi35pWw5o2u5a2Y5YKoCiAgICBjb25zdCB1c2VySW5mbyA9IHJlZihudWxsKTsKICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0gcmVmKCcnKTsKICAgIGNvbnN0IGFjdGl2ZVRhYiA9IHJlZigwKTsKICAgIGNvbnN0IHNlbGVjdGVkQ29udGFjdCA9IHJlZihudWxsKTsKICAgIGNvbnN0IG1lc3NhZ2VJbnB1dCA9IHJlZignJyk7CiAgICBjb25zdCBtZXNzYWdlQ29udGFpbmVyID0gcmVmKG51bGwpOwogICAgY29uc3QgZmlsZUlucHV0ID0gcmVmKG51bGwpOwogICAgY29uc3QgaW1hZ2VJbnB1dCA9IHJlZihudWxsKTsKICAgIGNvbnN0IG1lc3NhZ2VzID0gcmVmKFtdKTsKICAgIGNvbnN0IHNlc3Npb25zTG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBtZXNzYWdlc0xvYWRpbmcgPSByZWYoZmFsc2UpOwogICAgY29uc3QgY2hhdFNlc3Npb25zID0gcmVmKFtdKTsKICAgIGNvbnN0IGN1cnJlbnRDaGF0SWQgPSByZWYobnVsbCk7CgogICAgLy8g55+l6K+G5bqT55u45YWzCiAgICBjb25zdCBrbm93bGVkZ2VEaWFsb2dWaXNpYmxlID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IGtub3dsZWRnZUxvYWRpbmcgPSByZWYoZmFsc2UpOwogICAgY29uc3Qga25vd2xlZGdlTGlzdCA9IHJlZihbXSk7CiAgICBjb25zdCBzZWxlY3RlZEtub3dsZWRnZSA9IHJlZihudWxsKTsKCiAgICAvLyDmoIfnrb7pobUKICAgIGNvbnN0IHRhYnMgPSByZWYoWyfmnIDov5HogYrlpKknLCAn5ZCM5LqLJ10pOwoKICAgIC8vIOiBlOezu+S6uuWIl+ihqAogICAgY29uc3QgY29udGFjdHMgPSByZWYoW10pOwogICAgLy8g5omA5pyJ5ZCM5LqL55So5oi35YiX6KGoCiAgICBjb25zdCBhbGxDb2xsZWFndWVzID0gcmVmKFtdKTsKCiAgICAvLyDpg6jpl6jliJfooagKICAgIGNvbnN0IGRlcGFydG1lbnRzID0gcmVmKFtdKTsKCiAgICAvLyDlvZPliY3pgInkuK3nmoTogZTns7vkuroKICAgIGNvbnN0IGN1cnJlbnRDb250YWN0ID0gY29tcHV0ZWQoKCkgPT4gewogICAgICBpZiAoc2VsZWN0ZWRDb250YWN0LnZhbHVlID09PSBudWxsKSByZXR1cm4ge307CiAgICAgIHJldHVybiBjb250YWN0cy52YWx1ZS5maW5kKGMgPT4gYy5pZCA9PT0gc2VsZWN0ZWRDb250YWN0LnZhbHVlKSB8fCB7fTsKICAgIH0pOwoKICAgIC8vIOWuieWFqOWcsOiOt+WPlueUqOaIt0lE77yM6YG/5YWN5qih5p2/5Lit55qEbnVsbOmUmeivrwogICAgY29uc3QgdXNlcklkID0gY29tcHV0ZWQoKCkgPT4gewogICAgICB2YXIgX3VzZXJJbmZvJHZhbHVlOwogICAgICByZXR1cm4gKChfdXNlckluZm8kdmFsdWUgPSB1c2VySW5mby52YWx1ZSkgPT09IG51bGwgfHwgX3VzZXJJbmZvJHZhbHVlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdXNlckluZm8kdmFsdWUuaWQpIHx8IG51bGw7CiAgICB9KTsKCiAgICAvLyDmoLnmja7mkJzntKLov4fmu6TogZTns7vkuroKICAgIGNvbnN0IGZpbHRlcmVkQ29udGFjdHMgPSBjb21wdXRlZCgoKSA9PiB7CiAgICAgIGlmICghc2VhcmNoUXVlcnkudmFsdWUpIHJldHVybiBjb250YWN0cy52YWx1ZTsKICAgICAgcmV0dXJuIGNvbnRhY3RzLnZhbHVlLmZpbHRlcihjb250YWN0ID0+IGNvbnRhY3QubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaFF1ZXJ5LnZhbHVlLnRvTG93ZXJDYXNlKCkpKTsKICAgIH0pOwoKICAgIC8vIOagueaNruW9k+WJjea/gOa0u+eahOagh+etvumhteiOt+WPluimgeaYvuekuueahOiBlOezu+S6ugogICAgY29uc3QgZ2V0QWN0aXZlQ29udGFjdHMgPSBjb21wdXRlZCgoKSA9PiB7CiAgICAgIGlmIChhY3RpdmVUYWIudmFsdWUgPT09IDApIHsKICAgICAgICByZXR1cm4gZmlsdGVyZWRDb250YWN0cy52YWx1ZTsKICAgICAgfSBlbHNlIGlmIChhY3RpdmVUYWIudmFsdWUgPT09IDEpIHsKICAgICAgICByZXR1cm4gZmlsdGVyZWRDb250YWN0cy52YWx1ZS5maWx0ZXIoY29udGFjdCA9PiAhY29udGFjdC5pc0dyb3VwKTsKICAgICAgfQogICAgICByZXR1cm4gZmlsdGVyZWRDb250YWN0cy52YWx1ZTsKICAgIH0pOwoKICAgIC8vIOaMiemDqOmXqOWIhue7hOeahOeUqOaItwogICAgY29uc3QgZ3JvdXBlZFVzZXJzQnlEZXBhcnRtZW50ID0gY29tcHV0ZWQoKCkgPT4gewogICAgICAvLyDlkIjlubbogYrlpKnogZTns7vkurrlkozmiYDmnInlkIzkuosKICAgICAgY29uc3QgdXNlcnNNYXAgPSBuZXcgTWFwKCk7CgogICAgICAvLyDlhYjmt7vliqDogYrlpKnogZTns7vkurrvvIjpnZ7nvqTnu4TvvIkKICAgICAgZmlsdGVyZWRDb250YWN0cy52YWx1ZS5maWx0ZXIoY29udGFjdCA9PiAhY29udGFjdC5pc0dyb3VwKS5mb3JFYWNoKGNvbnRhY3QgPT4gewogICAgICAgIC8vIOi3s+i/h+iHquW3sQogICAgICAgIGlmICh1c2VySW5mby52YWx1ZSAmJiBjb250YWN0LnVzZXJJZCA9PT0gdXNlckluZm8udmFsdWUuaWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8g5L2/55SoSUTkvZzkuLrllK/kuIDplK4KICAgICAgICB1c2Vyc01hcC5zZXQoY29udGFjdC51c2VySWQgfHwgY29udGFjdC5pZCwgY29udGFjdCk7CiAgICAgIH0pOwoKICAgICAgLy8g5YaN5re75Yqg5omA5pyJ5ZCM5LqL77yM5L2G6YG/5YWN6YeN5aSNCiAgICAgIGFsbENvbGxlYWd1ZXMudmFsdWUuZm9yRWFjaChjb2xsZWFndWUgPT4gewogICAgICAgIC8vIOi3s+i/h+iHquW3sQogICAgICAgIGlmICh1c2VySW5mby52YWx1ZSAmJiBjb2xsZWFndWUuaWQgPT09IHVzZXJJbmZvLnZhbHVlLmlkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyDlj6rmnInlnKjkuI3lrZjlnKjml7bmiY3mt7vliqDvvIjpgb/lhY3opobnm5bnjrDmnInogZTns7vkurrvvIkKICAgICAgICBpZiAoIXVzZXJzTWFwLmhhcyhjb2xsZWFndWUuaWQpKSB7CiAgICAgICAgICAvLyDmnoTpgKDlhbzlrrnmoLzlvI/nmoTnlKjmiLflr7nosaEKICAgICAgICAgIGNvbnN0IGNvbnRhY3QgPSB7CiAgICAgICAgICAgIGlkOiAndXNlcl8nICsgY29sbGVhZ3VlLmlkLAogICAgICAgICAgICAvLyDmt7vliqDliY3nvIDku6Xpgb/lhY3kuI7njrDmnInkvJror51JROWGsueqgQogICAgICAgICAgICB1c2VySWQ6IGNvbGxlYWd1ZS5pZCwKICAgICAgICAgICAgbmFtZTogKGNvbGxlYWd1ZS5uYW1lIHx8IGNvbGxlYWd1ZS51c2VybmFtZSB8fCAn5pyq5ZG95ZCN6IGU57O75Lq6JykudHJpbSgpLAogICAgICAgICAgICBpbml0aWFsOiAoY29sbGVhZ3VlLm5hbWUgfHwgY29sbGVhZ3VlLnVzZXJuYW1lIHx8ICfmnKrlkb3lkI3ogZTns7vkuronKVswXSwKICAgICAgICAgICAgYXZhdGFyOiBjb2xsZWFndWUuYXZhdGFyIHx8ICcnLAogICAgICAgICAgICBjb2xvcjogZ2V0UmFuZG9tQ29sb3IoY29sbGVhZ3VlLmlkKSwKICAgICAgICAgICAgc3RhdHVzOiAnb25saW5lJywKICAgICAgICAgICAgbGFzdE1lc3NhZ2U6ICcnLAogICAgICAgICAgICBsYXN0VGltZTogJycsCiAgICAgICAgICAgIHVucmVhZDogMCwKICAgICAgICAgICAgaXNHcm91cDogZmFsc2UsCiAgICAgICAgICAgIGRlcGFydG1lbnQ6IGNvbGxlYWd1ZS5kZXBhcnRtZW50IHx8ICflhbblroMnCiAgICAgICAgICB9OwogICAgICAgICAgdXNlcnNNYXAuc2V0KGNvbGxlYWd1ZS5pZCwgY29udGFjdCk7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIC8vIOWIm+W7uuS4gOS4qumDqOmXqElE5Yiw5ZCN56ew55qE5pig5bCECiAgICAgIGNvbnN0IGRlcGFydG1lbnRNYXAgPSBuZXcgTWFwKGRlcGFydG1lbnRzLnZhbHVlLm1hcChkZXB0ID0+IFtkZXB0LmlkLCBkZXB0Lm5hbWVdKSk7CgogICAgICAvLyDmjInpg6jpl6jliIbnu4QKICAgICAgY29uc3QgZ3JvdXBlZFVzZXJzID0ge307CgogICAgICAvLyDlsIZNYXDovazkuLpBcnJheeWQjuWIhue7hAogICAgICBBcnJheS5mcm9tKHVzZXJzTWFwLnZhbHVlcygpKS5mb3JFYWNoKHVzZXIgPT4gewogICAgICAgIGNvbnN0IGRlcGFydG1lbnROYW1lID0gZGVwYXJ0bWVudE1hcC5nZXQodXNlci5kZXBhcnRtZW50KSB8fCAn5YW25LuWJzsKICAgICAgICBpZiAoIWdyb3VwZWRVc2Vyc1tkZXBhcnRtZW50TmFtZV0pIHsKICAgICAgICAgIGdyb3VwZWRVc2Vyc1tkZXBhcnRtZW50TmFtZV0gPSBbXTsKICAgICAgICB9CiAgICAgICAgZ3JvdXBlZFVzZXJzW2RlcGFydG1lbnROYW1lXS5wdXNoKHVzZXIpOwogICAgICB9KTsKICAgICAgcmV0dXJuIGdyb3VwZWRVc2VyczsKICAgIH0pOwoKICAgIC8vIOi3r+eUsQogICAgY29uc3Qgcm91dGUgPSB1c2VSb3V0ZSgpOwoKICAgIC8vIOWumuS5ieS4gOS4qnJlZnJlc2hJbnRlcnZhbOeahOW8leeUqO+8jOS7peS+v+WcqOe7hOS7tuWNuOi9veaXtua4hemZpAogICAgbGV0IHJlZnJlc2hJbnRlcnZhbCA9IG51bGw7CgogICAgLy8g57uE5Lu25Y246L295pe25riF6Zmk5a6a5pe25ZmoCiAgICBvbkJlZm9yZVVubW91bnQoKCkgPT4gewogICAgICBpZiAocmVmcmVzaEludGVydmFsKSB7CiAgICAgICAgY2xlYXJJbnRlcnZhbChyZWZyZXNoSW50ZXJ2YWwpOwogICAgICB9CiAgICB9KTsKCiAgICAvLyDot6/nlLHnm7jlhbPmk43kvZwKICAgIG9uTW91bnRlZChhc3luYyAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgLy8g5YWI5Yqg6L2955So5oi35pWw5o2uCiAgICAgICAgY29uc3QgdXNlckRhdGEgPSBhd2FpdCBmZXRjaEN1cnJlbnRVc2VyKCk7CgogICAgICAgIC8vIOWmguaenOiOt+WPlueUqOaIt+S/oeaBr+Wksei0pe+8jOaYvuekuumUmeivr+W5tui/lOWbngogICAgICAgIGlmICghdXNlckRhdGEpIHsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5peg5rOV5Yqg6L2955So5oi35L+h5oGv77yM6K+35Yi35paw6aG16Z2i6YeN6K+VJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnNvbGUubG9nKCfnu4Tku7bmjILovb3ml7bojrflj5bnmoTnlKjmiLfkv6Hmga86JywgdXNlckRhdGEpOwoKICAgICAgICAvLyDnoa7kv53nlKjmiLfmlbDmja7lt7Lnu4/mm7TmlrAKICAgICAgICBpZiAoIXVzZXJJbmZvLnZhbHVlIHx8ICF1c2VySW5mby52YWx1ZS5pZCkgewogICAgICAgICAgY29uc29sZS5lcnJvcign55So5oi35pWw5o2u5pyq5q2j56Gu5Yqg6L29OicsIHVzZXJJbmZvLnZhbHVlKTsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign55So5oi35pWw5o2u5Yqg6L295byC5bi477yM6K+35Yi35paw6aG16Z2i6YeN6K+VJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCflvZPliY3nlKjmiLfmlbDmja7lt7LmraPnoa7liqDovb06JywgdXNlckluZm8udmFsdWUpOwogICAgICAgIH0KCiAgICAgICAgLy8g5Yqg6L295omA5pyJ55So5oi35YiX6KGoCiAgICAgICAgYXdhaXQgbG9hZEFsbFVzZXJzKCk7CgogICAgICAgIC8vIOWKoOi9vemDqOmXqOWIl+ihqAogICAgICAgIGF3YWl0IGxvYWREZXBhcnRtZW50cygpOwoKICAgICAgICAvLyDlho3liqDovb3ogYrlpKnkvJror53liJfooagKICAgICAgICBhd2FpdCBsb2FkQ2hhdFNlc3Npb25zKCk7CgogICAgICAgIC8vIOajgOafpVVSTOWPguaVsOS4reaYr+WQpuacieS8muivnUlECiAgICAgICAgY29uc3Qgc2Vzc2lvbklkID0gcm91dGUucXVlcnkuc2Vzc2lvbiB8fCByb3V0ZS5xdWVyeS5pZDsKICAgICAgICBpZiAoc2Vzc2lvbklkKSB7CiAgICAgICAgICAvLyDmn6Xmib7lr7nlupTnmoTogZTns7vkuroKICAgICAgICAgIGNvbnN0IGZvdW5kQ29udGFjdCA9IGNvbnRhY3RzLnZhbHVlLmZpbmQoYyA9PiBjLmlkID09PSBwYXJzZUludChzZXNzaW9uSWQpKTsKICAgICAgICAgIGlmIChmb3VuZENvbnRhY3QpIHsKICAgICAgICAgICAgLy8g6YCJ5Lit6K+l6IGU57O75Lq6CiAgICAgICAgICAgIHNlbGVjdGVkQ29udGFjdC52YWx1ZSA9IGZvdW5kQ29udGFjdC5pZDsKICAgICAgICAgICAgLy8g5Yqg6L296IGK5aSp6K6w5b2VCiAgICAgICAgICAgIGF3YWl0IGxvYWRDaGF0TWVzc2FnZXMoc2Vzc2lvbklkKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOWmguaenOacquaJvuWIsOWvueW6lOiBlOezu+S6uu+8jOWwneivleebtOaOpeWKoOi9veS8muivnQogICAgICAgICAgICBjb25zb2xlLmxvZygn6YCa6L+HSUTnm7TmjqXliqDovb3ogYrlpKnkvJror506Jywgc2Vzc2lvbklkKTsKICAgICAgICAgICAgYXdhaXQgbG9hZENoYXRNZXNzYWdlcyhzZXNzaW9uSWQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g6K6+572u5a6a5pe25Yi35pawCiAgICAgICAgcmVmcmVzaEludGVydmFsID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4gewogICAgICAgICAgaWYgKHNlbGVjdGVkQ29udGFjdC52YWx1ZSkgewogICAgICAgICAgICBhd2FpdCBsb2FkQ2hhdE1lc3NhZ2VzKHNlbGVjdGVkQ29udGFjdC52YWx1ZSwgdHJ1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBhd2FpdCBsb2FkQ2hhdFNlc3Npb25zKHRydWUpOwogICAgICAgIH0sIDMwMDAwKTsKCiAgICAgICAgLy8g5Yid5aeL5rua5Yqo5Yiw5bqV6YOoCiAgICAgICAgYXdhaXQgbmV4dFRpY2soKTsKICAgICAgICBzY3JvbGxUb0JvdHRvbSgpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIneWni+WMluiBiuWkqee7hOS7tuWksei0pTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfliJ3lp4vljJbogYrlpKnnu4Tku7blpLHotKU6ICcgKyBlcnJvci5tZXNzYWdlKTsKICAgICAgfQogICAgfSk7CgogICAgLy8g6I635Y+W5b2T5YmN55So5oi35L+h5oGvCiAgICBjb25zdCBmZXRjaEN1cnJlbnRVc2VyID0gYXN5bmMgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnNvbGUubG9nKCflvIDlp4vojrflj5blvZPliY3nlKjmiLfkv6Hmga8uLi4nKTsKCiAgICAgICAgLy8g5qOA5p+lbG9jYWxTdG9yYWdl5Lit5piv5ZCm5pyJdG9rZW4KICAgICAgICBjb25zdCB0b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpOwogICAgICAgIGlmICghdG9rZW4pIHsKICAgICAgICAgIGNvbnNvbGUud2Fybign5pys5Zyw5a2Y5YKo5Lit5rKh5pyJ5om+5Yiw6K6k6K+BdG9rZW4nKTsKICAgICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfmnKrnmbvlvZXmiJbnmbvlvZXlt7Lov4fmnJ/vvIzor7fph43mlrDnmbvlvZUnKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoewogICAgICAgICAgdXJsOiAnL2FwaS9hdXRoL3VzZXJzL21lLycsCiAgICAgICAgICBtZXRob2Q6ICdnZXQnCiAgICAgICAgfSk7CiAgICAgICAgY29uc29sZS5sb2coJ+iOt+WPlueUqOaIt+S/oeaBr+WTjeW6lDonLCByZXNwb25zZSk7CgogICAgICAgIC8vIOajgOafpeWTjeW6lOagvOW8j+W5tuiOt+WPlueUqOaIt+aVsOaNrgogICAgICAgIGxldCB1c2VyRGF0YSA9IG51bGw7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5pZCkgewogICAgICAgICAgLy8g55u05o6l5LuOZGF0YeWtl+auteiOt+WPlueUqOaIt+aVsOaNrgogICAgICAgICAgdXNlckRhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgY29uc29sZS5sb2coJ+S7jmRhdGHlrZfmrrXojrflj5bnlKjmiLfmlbDmja46JywgdXNlckRhdGEpOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5kYXRhLmlkKSB7CiAgICAgICAgICAvLyDku47ltYzlpZdkYXRh5a2X5q616I635Y+W55So5oi35pWw5o2uCiAgICAgICAgICB1c2VyRGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgIGNvbnNvbGUubG9nKCfku47ltYzlpZdkYXRh5a2X5q616I635Y+W55So5oi35pWw5o2uOicsIHVzZXJEYXRhKTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmlkKSB7CiAgICAgICAgICAvLyDnm7TmjqXlk43lupTlsLHmmK/nlKjmiLfmlbDmja4KICAgICAgICAgIHVzZXJEYXRhID0gcmVzcG9uc2U7CiAgICAgICAgICBjb25zb2xlLmxvZygn55u05o6l6I635Y+W55So5oi35pWw5o2uOicsIHVzZXJEYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W55So5oi35L+h5oGv5ZON5bqU5qC85byP5byC5bi4OicsIHJlc3BvbnNlKTsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcign55So5oi35L+h5oGv5qC85byP5byC5bi4Jyk7CiAgICAgICAgfQogICAgICAgIGlmICghdXNlckRhdGEgfHwgIXVzZXJEYXRhLmlkKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bnmoTnlKjmiLfmlbDmja7ml6DmlYg6JywgdXNlckRhdGEpOwogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfml6DmlYjnmoTnlKjmiLfmlbDmja4nKTsKICAgICAgICB9CgogICAgICAgIC8vIOS4jeS9v+eUqOacquWumuS5ieeahG11dGF0aW9u77yM6ICM5piv55u05o6l5pu05paw5pys5Zyw54q25oCBCiAgICAgICAgdXNlckluZm8udmFsdWUgPSB1c2VyRGF0YTsKCiAgICAgICAgLy8g5L+d5a2Y5YiwbG9jYWxTdG9yYWdl5Lul5L6/5oyB5LmF5YyWCiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3VzZXInLCBKU09OLnN0cmluZ2lmeSh1c2VyRGF0YSkpOwogICAgICAgIGNvbnNvbGUubG9nKCfnlKjmiLfmlbDmja7lt7Lmm7TmlrA6JywgdXNlckluZm8udmFsdWUpOwogICAgICAgIHJldHVybiB1c2VyRGF0YTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5blvZPliY3nlKjmiLfkv6Hmga/lpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign6I635Y+W55So5oi35L+h5oGv5aSx6LSlOiAnICsgKGVycm9yLm1lc3NhZ2UgfHwgJ+acquefpemUmeivrycpKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfTsKCiAgICAvLyDliqDovb3ogYrlpKnkvJror53liJfooagKICAgIGNvbnN0IGxvYWRDaGF0U2Vzc2lvbnMgPSBhc3luYyAoaXNCYWNrZ3JvdW5kUmVmcmVzaCA9IGZhbHNlKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKCFpc0JhY2tncm91bmRSZWZyZXNoKSB7CiAgICAgICAgICBzZXNzaW9uc0xvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICAgIH0KICAgICAgICBjb25zb2xlLmxvZygn5q2j5Zyo5Yqg6L296IGK5aSp5Lya6K+d5YiX6KGoLi4uJyk7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZXRDaGF0U2Vzc2lvbnMoKTsKICAgICAgICBjb25zb2xlLmxvZygn6I635Y+W6IGK5aSp5Lya6K+d5ZON5bqUOicsIHJlc3BvbnNlKTsKCiAgICAgICAgLy8g56Gu5L+d5oiR5Lus5pyJ5ZON5bqU5pWw5o2uCiAgICAgICAgaWYgKCFyZXNwb25zZSkgewogICAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W6IGK5aSp5Lya6K+d6L+U5Zue56m65ZON5bqUJyk7CiAgICAgICAgICBjb250YWN0cy52YWx1ZSA9IFtdOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBsZXQgZGF0YTsKICAgICAgICBpZiAocmVzcG9uc2Uuc3VjY2VzcyAmJiByZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICBkYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgIGNvbnNvbGUubG9nKCfkvb/nlKjljIXoo4XmoLzlvI/nmoTogYrlpKnmlbDmja46JywgZGF0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRhdGEgPSByZXNwb25zZTsKICAgICAgICAgIGNvbnNvbGUubG9nKCfkvb/nlKjnm7TmjqXov5Tlm57nmoTogYrlpKnmlbDmja46JywgZGF0YSk7CiAgICAgICAgfQoKICAgICAgICAvLyDovazmjaLmlbDmja7moLzlvI8KICAgICAgICBjaGF0U2Vzc2lvbnMudmFsdWUgPSBkYXRhOwoKICAgICAgICAvLyDmnoTlu7rogZTns7vkurrliJfooagKICAgICAgICBpZiAoZGF0YSAmJiBBcnJheS5pc0FycmF5KGRhdGEucmVzdWx0cykpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCflpITnkIbliIbpobXmlbDmja7nu5PmnoQsIOWFseacieS8muivneaVsDonLCBkYXRhLnJlc3VsdHMubGVuZ3RoKTsKICAgICAgICAgIC8vIOWkhOeQhuWIhumhteaVsOaNrue7k+aehAogICAgICAgICAgY29udGFjdHMudmFsdWUgPSBkYXRhLnJlc3VsdHMubWFwKHNlc3Npb24gPT4gewogICAgICAgICAgICAvLyDmib7liLDlr7nmlrnnlKjmiLfvvIjpnZ7lvZPliY3nlKjmiLfvvIkKICAgICAgICAgICAgbGV0IG90aGVyUGFydGljaXBhbnQgPSBudWxsOwogICAgICAgICAgICBpZiAoc2Vzc2lvbi5wYXJ0aWNpcGFudHMgJiYgQXJyYXkuaXNBcnJheShzZXNzaW9uLnBhcnRpY2lwYW50cykpIHsKICAgICAgICAgICAgICBpZiAodXNlckluZm8udmFsdWUgJiYgdXNlckluZm8udmFsdWUuaWQpIHsKICAgICAgICAgICAgICAgIG90aGVyUGFydGljaXBhbnQgPSBzZXNzaW9uLnBhcnRpY2lwYW50cy5maW5kKHAgPT4gcC51c2VyICYmIHAudXNlci5pZCAhPT0gdXNlckluZm8udmFsdWUuaWQpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyDlpoLmnpzmsqHmnInlvZPliY3nlKjmiLfkv6Hmga/vvIzkvb/nlKjnrKzkuIDkuKrlj4LkuI7ogIUKICAgICAgICAgICAgICAgIG90aGVyUGFydGljaXBhbnQgPSBzZXNzaW9uLnBhcnRpY2lwYW50c1swXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOWmguaenOaYr+e+pOiBiu+8jOS9v+eUqOe+pOiBiuS/oeaBrwogICAgICAgICAgICBpZiAoc2Vzc2lvbi5pc19ncm91cCkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDogc2Vzc2lvbi5pZCwKICAgICAgICAgICAgICAgIG5hbWU6IHNlc3Npb24udGl0bGUgfHwgJ+e+pOiBiicsCiAgICAgICAgICAgICAgICBpbml0aWFsOiAoc2Vzc2lvbi50aXRsZSB8fCAn576k6IGKJylbMF0sCiAgICAgICAgICAgICAgICBhdmF0YXI6ICcnLAogICAgICAgICAgICAgICAgYXZhdGFyX3VybDogJycsCiAgICAgICAgICAgICAgICBjb2xvcjogZ2V0UmFuZG9tQ29sb3Ioc2Vzc2lvbi5pZCksCiAgICAgICAgICAgICAgICBzdGF0dXM6ICdvbmxpbmUnLAogICAgICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IHNlc3Npb24ubGFzdF9tZXNzYWdlID8gc2Vzc2lvbi5sYXN0X21lc3NhZ2UuY29udGVudCA6ICcnLAogICAgICAgICAgICAgICAgbGFzdFRpbWU6IHNlc3Npb24ubGFzdF9tZXNzYWdlID8gZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi5sYXN0X21lc3NhZ2UuY3JlYXRlZF9hdCkgOiBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLnVwZGF0ZWRfYXQpLAogICAgICAgICAgICAgICAgdW5yZWFkOiBzZXNzaW9uLnVucmVhZF9jb3VudCwKICAgICAgICAgICAgICAgIGlzR3JvdXA6IHRydWUKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDljZXogYrvvIzkvb/nlKjlr7nmlrnkv6Hmga8KICAgICAgICAgICAgaWYgKG90aGVyUGFydGljaXBhbnQpIHsKICAgICAgICAgICAgICBjb25zdCB1c2VyID0gb3RoZXJQYXJ0aWNpcGFudC51c2VyOwogICAgICAgICAgICAgIC8vIOWkhOeQhuWktOWDj+i3r+W+hAogICAgICAgICAgICAgIGxldCBhdmF0YXJfdXJsID0gJyc7CiAgICAgICAgICAgICAgaWYgKHVzZXIuYXZhdGFyKSB7CiAgICAgICAgICAgICAgICBjb25zdCBhdmF0YXIgPSB1c2VyLmF2YXRhcjsKICAgICAgICAgICAgICAgIGlmIChhdmF0YXIuc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IGF2YXRhci5zdGFydHNXaXRoKCdodHRwczovLycpKSB7CiAgICAgICAgICAgICAgICAgIGF2YXRhcl91cmwgPSBhdmF0YXI7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGF2YXRhci5zdGFydHNXaXRoKCcvJykpIHsKICAgICAgICAgICAgICAgICAgYXZhdGFyX3VybCA9IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQkFTRV9BUEkgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6ODAwMCd9JHthdmF0YXJ9YDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGF2YXRhcl91cmwgPSBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJIHx8ICdodHRwOi8vbG9jYWxob3N0OjgwMDAnfS8ke2F2YXRhcn1gOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IHNlc3Npb24uaWQsCiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXIuaWQsCiAgICAgICAgICAgICAgICAvLyDmt7vliqDnlKjmiLdJRO+8jOeUqOS6juajgOafpeaYr+WQpuaYr+iHquW3sQogICAgICAgICAgICAgICAgbmFtZTogKHVzZXIubmFtZSB8fCAoKHVzZXIuZmlyc3RfbmFtZSB8fCAnJykgKyAnICcgKyAodXNlci5sYXN0X25hbWUgfHwgJycpKS50cmltKCkgfHwgdXNlci51c2VybmFtZSB8fCAn5pyq5ZG95ZCN6IGU57O75Lq6JykudHJpbSgpLAogICAgICAgICAgICAgICAgaW5pdGlhbDogKHVzZXIubmFtZSB8fCB1c2VyLmZpcnN0X25hbWUgfHwgdXNlci51c2VybmFtZSB8fCAn5pyq5ZG95ZCN6IGU57O75Lq6JylbMF0sCiAgICAgICAgICAgICAgICBhdmF0YXI6IHVzZXIuYXZhdGFyIHx8ICcnLAogICAgICAgICAgICAgICAgYXZhdGFyX3VybDogYXZhdGFyX3VybCwKICAgICAgICAgICAgICAgIGNvbG9yOiBnZXRSYW5kb21Db2xvcih1c2VyLmlkKSwKICAgICAgICAgICAgICAgIHN0YXR1czogJ29ubGluZScsCiAgICAgICAgICAgICAgICBsYXN0TWVzc2FnZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBzZXNzaW9uLmxhc3RfbWVzc2FnZS5jb250ZW50IDogJycsCiAgICAgICAgICAgICAgICBsYXN0VGltZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLmxhc3RfbWVzc2FnZS5jcmVhdGVkX2F0KSA6IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24udXBkYXRlZF9hdCksCiAgICAgICAgICAgICAgICB1bnJlYWQ6IHNlc3Npb24udW5yZWFkX2NvdW50LAogICAgICAgICAgICAgICAgaXNHcm91cDogZmFsc2UsCiAgICAgICAgICAgICAgICBkZXBhcnRtZW50OiB1c2VyLmRlcGFydG1lbnQgfHwgJ+WFtuS7licgLy8g56Gu5L+d5pyJ6buY6K6k6YOo6ZeoCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g5aaC5p6c5rKh5pyJ5YW25LuW5Y+C5LiO6ICF77yI55CG6K665LiK5LiN5bqU6K+l5Y+R55Sf77yJCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgaWQ6IHNlc3Npb24uaWQsCiAgICAgICAgICAgICAgbmFtZTogc2Vzc2lvbi50aXRsZSB8fCAn6IGK5aSpJywKICAgICAgICAgICAgICBpbml0aWFsOiAoc2Vzc2lvbi50aXRsZSB8fCAn6IGK5aSpJylbMF0sCiAgICAgICAgICAgICAgYXZhdGFyOiAnJywKICAgICAgICAgICAgICBhdmF0YXJfdXJsOiAnJywKICAgICAgICAgICAgICBjb2xvcjogZ2V0UmFuZG9tQ29sb3Ioc2Vzc2lvbi5pZCksCiAgICAgICAgICAgICAgc3RhdHVzOiAnb25saW5lJywKICAgICAgICAgICAgICBsYXN0TWVzc2FnZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBzZXNzaW9uLmxhc3RfbWVzc2FnZS5jb250ZW50IDogJycsCiAgICAgICAgICAgICAgbGFzdFRpbWU6IHNlc3Npb24ubGFzdF9tZXNzYWdlID8gZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi5sYXN0X21lc3NhZ2UuY3JlYXRlZF9hdCkgOiBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLnVwZGF0ZWRfYXQpLAogICAgICAgICAgICAgIHVucmVhZDogc2Vzc2lvbi51bnJlYWRfY291bnQsCiAgICAgICAgICAgICAgaXNHcm91cDogc2Vzc2lvbi5pc19ncm91cCwKICAgICAgICAgICAgICBkZXBhcnRtZW50OiAn5YW25LuWJwogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChkYXRhICYmIEFycmF5LmlzQXJyYXkoZGF0YSkpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCflpITnkIbpnZ7liIbpobXmlbDmja7nu5PmnoQsIOWFseacieS8muivneaVsDonLCBkYXRhLmxlbmd0aCk7CiAgICAgICAgICAvLyDlpITnkIbpnZ7liIbpobXmlbDmja7nu5PmnoQKICAgICAgICAgIGNvbnRhY3RzLnZhbHVlID0gZGF0YS5tYXAoc2Vzc2lvbiA9PiB7CiAgICAgICAgICAgIC8vIOaJvuWIsOWvueaWueeUqOaIt++8iOmdnuW9k+WJjeeUqOaIt++8iQogICAgICAgICAgICBsZXQgb3RoZXJQYXJ0aWNpcGFudCA9IG51bGw7CiAgICAgICAgICAgIGlmIChzZXNzaW9uLnBhcnRpY2lwYW50cyAmJiBBcnJheS5pc0FycmF5KHNlc3Npb24ucGFydGljaXBhbnRzKSkgewogICAgICAgICAgICAgIGlmICh1c2VySW5mby52YWx1ZSAmJiB1c2VySW5mby52YWx1ZS5pZCkgewogICAgICAgICAgICAgICAgb3RoZXJQYXJ0aWNpcGFudCA9IHNlc3Npb24ucGFydGljaXBhbnRzLmZpbmQocCA9PiBwLnVzZXIgJiYgcC51c2VyLmlkICE9PSB1c2VySW5mby52YWx1ZS5pZCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIOWmguaenOayoeacieW9k+WJjeeUqOaIt+S/oeaBr++8jOS9v+eUqOesrOS4gOS4quWPguS4juiAhQogICAgICAgICAgICAgICAgb3RoZXJQYXJ0aWNpcGFudCA9IHNlc3Npb24ucGFydGljaXBhbnRzWzBdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g5aaC5p6c5piv576k6IGK77yM5L2/55So576k6IGK5L+h5oGvCiAgICAgICAgICAgIGlmIChzZXNzaW9uLmlzX2dyb3VwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBzZXNzaW9uLmlkLAogICAgICAgICAgICAgICAgbmFtZTogc2Vzc2lvbi50aXRsZSB8fCAn576k6IGKJywKICAgICAgICAgICAgICAgIGluaXRpYWw6IChzZXNzaW9uLnRpdGxlIHx8ICfnvqTogYonKVswXSwKICAgICAgICAgICAgICAgIGF2YXRhcjogJycsCiAgICAgICAgICAgICAgICBhdmF0YXJfdXJsOiAnJywKICAgICAgICAgICAgICAgIGNvbG9yOiBnZXRSYW5kb21Db2xvcihzZXNzaW9uLmlkKSwKICAgICAgICAgICAgICAgIHN0YXR1czogJ29ubGluZScsCiAgICAgICAgICAgICAgICBsYXN0TWVzc2FnZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBzZXNzaW9uLmxhc3RfbWVzc2FnZS5jb250ZW50IDogJycsCiAgICAgICAgICAgICAgICBsYXN0VGltZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLmxhc3RfbWVzc2FnZS5jcmVhdGVkX2F0KSA6IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24udXBkYXRlZF9hdCksCiAgICAgICAgICAgICAgICB1bnJlYWQ6IHNlc3Npb24udW5yZWFkX2NvdW50LAogICAgICAgICAgICAgICAgaXNHcm91cDogdHJ1ZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOWNleiBiu+8jOS9v+eUqOWvueaWueS/oeaBrwogICAgICAgICAgICBpZiAob3RoZXJQYXJ0aWNpcGFudCkgewogICAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBvdGhlclBhcnRpY2lwYW50LnVzZXI7CiAgICAgICAgICAgICAgLy8g5aSE55CG5aS05YOP6Lev5b6ECiAgICAgICAgICAgICAgbGV0IGF2YXRhcl91cmwgPSAnJzsKICAgICAgICAgICAgICBpZiAodXNlci5hdmF0YXIpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IHVzZXIuYXZhdGFyOwogICAgICAgICAgICAgICAgaWYgKGF2YXRhci5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgYXZhdGFyLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHsKICAgICAgICAgICAgICAgICAgYXZhdGFyX3VybCA9IGF2YXRhcjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYXZhdGFyLnN0YXJ0c1dpdGgoJy8nKSkgewogICAgICAgICAgICAgICAgICBhdmF0YXJfdXJsID0gYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9CQVNFX0FQSSB8fCAnaHR0cDovL2xvY2FsaG9zdDo4MDAwJ30ke2F2YXRhcn1gOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgYXZhdGFyX3VybCA9IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQkFTRV9BUEkgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6ODAwMCd9LyR7YXZhdGFyfWA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDogc2Vzc2lvbi5pZCwKICAgICAgICAgICAgICAgIG5hbWU6ICh1c2VyLm5hbWUgfHwgKCh1c2VyLmZpcnN0X25hbWUgfHwgJycpICsgJyAnICsgKHVzZXIubGFzdF9uYW1lIHx8ICcnKSkudHJpbSgpIHx8IHVzZXIudXNlcm5hbWUgfHwgJ+acquWRveWQjeiBlOezu+S6uicpLnRyaW0oKSwKICAgICAgICAgICAgICAgIGluaXRpYWw6ICh1c2VyLm5hbWUgfHwgdXNlci5maXJzdF9uYW1lIHx8IHVzZXIudXNlcm5hbWUgfHwgJ+acquWRveWQjeiBlOezu+S6uicpWzBdLAogICAgICAgICAgICAgICAgYXZhdGFyOiB1c2VyLmF2YXRhciB8fCAnJywKICAgICAgICAgICAgICAgIGF2YXRhcl91cmw6IGF2YXRhcl91cmwsCiAgICAgICAgICAgICAgICBjb2xvcjogZ2V0UmFuZG9tQ29sb3IodXNlci5pZCksCiAgICAgICAgICAgICAgICBzdGF0dXM6ICdvbmxpbmUnLAogICAgICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IHNlc3Npb24ubGFzdF9tZXNzYWdlID8gc2Vzc2lvbi5sYXN0X21lc3NhZ2UuY29udGVudCA6ICcnLAogICAgICAgICAgICAgICAgbGFzdFRpbWU6IHNlc3Npb24ubGFzdF9tZXNzYWdlID8gZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi5sYXN0X21lc3NhZ2UuY3JlYXRlZF9hdCkgOiBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLnVwZGF0ZWRfYXQpLAogICAgICAgICAgICAgICAgdW5yZWFkOiBzZXNzaW9uLnVucmVhZF9jb3VudCwKICAgICAgICAgICAgICAgIGlzR3JvdXA6IGZhbHNlLAogICAgICAgICAgICAgICAgZGVwYXJ0bWVudDogdXNlci5kZXBhcnRtZW50IHx8ICflhbbku5YnCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g5aaC5p6c5rKh5pyJ5YW25LuW5Y+C5LiO6ICF77yI55CG6K665LiK5LiN5bqU6K+l5Y+R55Sf77yJCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgaWQ6IHNlc3Npb24uaWQsCiAgICAgICAgICAgICAgbmFtZTogc2Vzc2lvbi50aXRsZSB8fCAn6IGK5aSpJywKICAgICAgICAgICAgICBpbml0aWFsOiAoc2Vzc2lvbi50aXRsZSB8fCAn6IGK5aSpJylbMF0sCiAgICAgICAgICAgICAgYXZhdGFyOiAnJywKICAgICAgICAgICAgICBhdmF0YXJfdXJsOiAnJywKICAgICAgICAgICAgICBjb2xvcjogZ2V0UmFuZG9tQ29sb3Ioc2Vzc2lvbi5pZCksCiAgICAgICAgICAgICAgc3RhdHVzOiAnb25saW5lJywKICAgICAgICAgICAgICBsYXN0TWVzc2FnZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBzZXNzaW9uLmxhc3RfbWVzc2FnZS5jb250ZW50IDogJycsCiAgICAgICAgICAgICAgbGFzdFRpbWU6IHNlc3Npb24ubGFzdF9tZXNzYWdlID8gZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi5sYXN0X21lc3NhZ2UuY3JlYXRlZF9hdCkgOiBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLnVwZGF0ZWRfYXQpLAogICAgICAgICAgICAgIHVucmVhZDogc2Vzc2lvbi51bnJlYWRfY291bnQsCiAgICAgICAgICAgICAgaXNHcm91cDogc2Vzc2lvbi5pc19ncm91cCwKICAgICAgICAgICAgICBkZXBhcnRtZW50OiAn5YW25LuWJwogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIOWmguaenOayoeacieacieaViOaVsOaNrgogICAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W6IGK5aSp5Lya6K+d5qC85byP5byC5bi45oiW5Li656m6OicsIGRhdGEpOwogICAgICAgICAgY29udGFjdHMudmFsdWUgPSBbXTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coJ+WkhOeQhuWQjueahOiBlOezu+S6uuWIl+ihqDonLCBjb250YWN0cy52YWx1ZSk7CgogICAgICAgIC8vIOWmguaenOacieacquivu+a2iOaBr++8jOaMieacquivu+aVsOmHj+aOkuW6jwogICAgICAgIGlmIChjb250YWN0cy52YWx1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICBjb250YWN0cy52YWx1ZS5zb3J0KChhLCBiKSA9PiBiLnVucmVhZCAtIGEudW5yZWFkKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Yqg6L296IGK5aSp5Lya6K+d5aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WKoOi9veiBiuWkqeS8muivneWksei0pTogJyArIChlcnJvci5tZXNzYWdlIHx8ICfmnKrnn6XplJnor68nKSk7CiAgICAgICAgY29udGFjdHMudmFsdWUgPSBbXTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBpZiAoIWlzQmFja2dyb3VuZFJlZnJlc2gpIHsKICAgICAgICAgIHNlc3Npb25zTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICAvLyDliqDovb3ogYrlpKnmtojmga8KICAgIGNvbnN0IGxvYWRDaGF0TWVzc2FnZXMgPSBhc3luYyAoY2hhdElkLCBpc0JhY2tncm91bmRSZWZyZXNoID0gZmFsc2UpID0+IHsKICAgICAgaWYgKCFjaGF0SWQpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfml6Dms5XliqDovb3mtojmga86IGNoYXRJZOS4uuepuicpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGlmICghaXNCYWNrZ3JvdW5kUmVmcmVzaCkgewogICAgICAgICAgbWVzc2FnZXNMb2FkaW5nLnZhbHVlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coYOato+WcqOWKoOi9veiBiuWkqeS8muivnSAke2NoYXRJZH0g55qE5raI5oGvLi4uYCk7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZXRDaGF0U2Vzc2lvbihjaGF0SWQpOwogICAgICAgIGNvbnNvbGUubG9nKCfogYrlpKnkvJror53or6bmg4Xlk43lupQ6JywgcmVzcG9uc2UpOwogICAgICAgIGlmICghcmVzcG9uc2UpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPluiBiuWkqeS8muivneivpuaDhei/lOWbnuepuuWTjeW6lCcpOwogICAgICAgICAgbWVzc2FnZXMudmFsdWUgPSBbXTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIOWkhOeQhuS4jeWQjOeahOWTjeW6lOagvOW8jwogICAgICAgIGxldCBtZXNzYWdlRGF0YSA9IFtdOwogICAgICAgIGxldCBzZXNzaW9uRGF0YSA9IG51bGw7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5tZXNzYWdlcykgewogICAgICAgICAgLy8g5qCH5YeG5qC85byP77ya5ZON5bqU55u05o6l5YyF5ZCrbWVzc2FnZXPlrZfmrrUKICAgICAgICAgIG1lc3NhZ2VEYXRhID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlczsKICAgICAgICAgIHNlc3Npb25EYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgIGNvbnNvbGUubG9nKCfmoIflh4bmoLzlvI/mtojmga/mlbDmja7vvIzmtojmga/mlbDph486JywgbWVzc2FnZURhdGEubGVuZ3RoKTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuZGF0YS5tZXNzYWdlcykgewogICAgICAgICAgLy8g5YyF6KOF5qC85byP77yae3N1Y2Nlc3M6IHRydWUsIGRhdGE6IHttZXNzYWdlczogWy4uLl19fQogICAgICAgICAgbWVzc2FnZURhdGEgPSByZXNwb25zZS5kYXRhLmRhdGEubWVzc2FnZXM7CiAgICAgICAgICBzZXNzaW9uRGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgIGNvbnNvbGUubG9nKCfljIXoo4XmoLzlvI/mtojmga/mlbDmja7vvIzmtojmga/mlbDph486JywgbWVzc2FnZURhdGEubGVuZ3RoKTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLm1lc3NhZ2VzKSB7CiAgICAgICAgICAvLyDnm7TmjqXov5Tlm57moLzlvI86IHttZXNzYWdlczogWy4uLl19CiAgICAgICAgICBtZXNzYWdlRGF0YSA9IHJlc3BvbnNlLm1lc3NhZ2VzOwogICAgICAgICAgc2Vzc2lvbkRhdGEgPSByZXNwb25zZTsKICAgICAgICAgIGNvbnNvbGUubG9nKCfnm7TmjqXov5Tlm57moLzlvI/mtojmga/mlbDmja7vvIzmtojmga/mlbDph486JywgbWVzc2FnZURhdGEubGVuZ3RoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCfml6Dms5Xor4bliKvnmoTmtojmga/mlbDmja7moLzlvI86JywgcmVzcG9uc2UpOwogICAgICAgICAgY29uc29sZS5sb2coJ+WwneivleajgOafpeaYr+WQpuacieWFtuS7luWPr+iDveeahOa2iOaBr+Wtl+autS4uLicpOwoKICAgICAgICAgIC8vIOWwneivleafpeaJvuWFtuS7luWPr+iDveeahOa2iOaBr+Wtl+autQogICAgICAgICAgY29uc3QgcG9zc2libGVNZXNzYWdlRmllbGRzID0gWydtZXNzYWdlJywgJ2NoYXRfbWVzc2FnZXMnLCAnY2hhdHMnLCAnY29udGVudCddOwogICAgICAgICAgZm9yIChjb25zdCBmaWVsZCBvZiBwb3NzaWJsZU1lc3NhZ2VGaWVsZHMpIHsKICAgICAgICAgICAgaWYgKHJlc3BvbnNlW2ZpZWxkXSAmJiBBcnJheS5pc0FycmF5KHJlc3BvbnNlW2ZpZWxkXSkpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg5om+5Yiw5Y+v6IO955qE5raI5oGv5a2X5q61ICR7ZmllbGR977yM5L2/55So5q2k5a2X5q615pWw5o2uYCk7CiAgICAgICAgICAgICAgbWVzc2FnZURhdGEgPSByZXNwb25zZVtmaWVsZF07CiAgICAgICAgICAgICAgc2Vzc2lvbkRhdGEgPSByZXNwb25zZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGFbZmllbGRdICYmIEFycmF5LmlzQXJyYXkocmVzcG9uc2UuZGF0YVtmaWVsZF0pKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coYOWcqGRhdGHlrZfmrrXkuK3mib7liLDlj6/og73nmoTmtojmga/lrZfmrrUgJHtmaWVsZH3vvIzkvb/nlKjmraTlrZfmrrXmlbDmja5gKTsKICAgICAgICAgICAgICBtZXNzYWdlRGF0YSA9IHJlc3BvbnNlLmRhdGFbZmllbGRdOwogICAgICAgICAgICAgIHNlc3Npb25EYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKG1lc3NhZ2VEYXRhLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICBjb25zb2xlLndhcm4oJ+acquaJvuWIsOS7u+S9lea2iOaBr+aVsOaNru+8jOS9v+eUqOepuuaVsOe7hCcpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g5aSE55CG5raI5oGv5Y+R6YCB6ICF55qE5aS05YOPCiAgICAgICAgbWVzc2FnZURhdGEuZm9yRWFjaChtZXNzYWdlID0+IHsKICAgICAgICAgIGlmIChtZXNzYWdlLnNlbmRlciAmJiBtZXNzYWdlLnNlbmRlci5hdmF0YXIpIHsKICAgICAgICAgICAgY29uc3QgYXZhdGFyID0gbWVzc2FnZS5zZW5kZXIuYXZhdGFyOwogICAgICAgICAgICBpZiAoYXZhdGFyLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBhdmF0YXIuc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkgewogICAgICAgICAgICAgIG1lc3NhZ2Uuc2VuZGVyLmF2YXRhcl91cmwgPSBhdmF0YXI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoYXZhdGFyLnN0YXJ0c1dpdGgoJy8nKSkgewogICAgICAgICAgICAgIG1lc3NhZ2Uuc2VuZGVyLmF2YXRhcl91cmwgPSBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJIHx8ICdodHRwOi8vbG9jYWxob3N0OjgwMDAnfSR7YXZhdGFyfWA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbWVzc2FnZS5zZW5kZXIuYXZhdGFyX3VybCA9IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQkFTRV9BUEkgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6ODAwMCd9LyR7YXZhdGFyfWA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8g6K6w5b2V5Lya6K+d5ZKM5raI5oGv5pWw5o2uCiAgICAgICAgY29uc29sZS5sb2coJ+WkhOeQhuWQjueahOS8muivneaVsOaNrjonLCBzZXNzaW9uRGF0YSk7CiAgICAgICAgY29uc29sZS5sb2coJ+WkhOeQhuWQjueahOa2iOaBr+aVsOaNrjonLCBtZXNzYWdlRGF0YSk7CgogICAgICAgIC8vIOWmguaenOS8muivneS4jeWcqOiBlOezu+S6uuWIl+ihqOS4re+8jOa3u+WKoOWugwogICAgICAgIGlmIChzZXNzaW9uRGF0YSAmJiAhY29udGFjdHMudmFsdWUuc29tZShjID0+IGMuaWQgPT09IHBhcnNlSW50KGNoYXRJZCkpKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygn5Lya6K+d5LiN5Zyo6IGU57O75Lq65YiX6KGo5Lit77yM5re75Yqg5a6DOicsIHNlc3Npb25EYXRhKTsKCiAgICAgICAgICAvLyDliJvlu7rkuLTml7bogZTns7vkurrlr7nosaEKICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSBzZXNzaW9uRGF0YTsKICAgICAgICAgIC8vIOaJvuWIsOWvueaWueeUqOaIt++8iOmdnuW9k+WJjeeUqOaIt++8iQogICAgICAgICAgbGV0IG90aGVyUGFydGljaXBhbnQgPSBudWxsOwoKICAgICAgICAgIC8vIOehruS/nSBzZXNzaW9uLnBhcnRpY2lwYW50cyDlrZjlnKjkuJTmmK/mlbDnu4QKICAgICAgICAgIGlmIChzZXNzaW9uLnBhcnRpY2lwYW50cyAmJiBBcnJheS5pc0FycmF5KHNlc3Npb24ucGFydGljaXBhbnRzKSAmJiBzZXNzaW9uLnBhcnRpY2lwYW50cy5sZW5ndGggPiAwICYmIHVzZXJJbmZvLnZhbHVlKSB7CiAgICAgICAgICAgIG90aGVyUGFydGljaXBhbnQgPSBzZXNzaW9uLnBhcnRpY2lwYW50cy5maW5kKHAgPT4gcC51c2VyICYmIHAudXNlci5pZCAhPT0gdXNlckluZm8udmFsdWUuaWQpOwogICAgICAgICAgfQogICAgICAgICAgbGV0IHRlbXBDb250YWN0ID0gbnVsbDsKCiAgICAgICAgICAvLyDlpoLmnpzmmK/nvqTogYrvvIzkvb/nlKjnvqTogYrkv6Hmga8KICAgICAgICAgIGlmIChzZXNzaW9uLmlzX2dyb3VwKSB7CiAgICAgICAgICAgIHRlbXBDb250YWN0ID0gewogICAgICAgICAgICAgIGlkOiBwYXJzZUludChjaGF0SWQpLAogICAgICAgICAgICAgIG5hbWU6IHNlc3Npb24udGl0bGUgfHwgJ+e+pOiBiicsCiAgICAgICAgICAgICAgaW5pdGlhbDogKHNlc3Npb24udGl0bGUgfHwgJ+e+pOiBiicpWzBdLAogICAgICAgICAgICAgIGF2YXRhcjogJycsCiAgICAgICAgICAgICAgYXZhdGFyX3VybDogJycsCiAgICAgICAgICAgICAgY29sb3I6IGdldFJhbmRvbUNvbG9yKHBhcnNlSW50KGNoYXRJZCkpLAogICAgICAgICAgICAgIHN0YXR1czogJ29ubGluZScsCiAgICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IHNlc3Npb24ubGFzdF9tZXNzYWdlID8gc2Vzc2lvbi5sYXN0X21lc3NhZ2UuY29udGVudCA6ICcnLAogICAgICAgICAgICAgIGxhc3RUaW1lOiBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLnVwZGF0ZWRfYXQpLAogICAgICAgICAgICAgIHVucmVhZDogMCwKICAgICAgICAgICAgICBpc0dyb3VwOiB0cnVlCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIC8vIOWNleiBiu+8jOS9v+eUqOWvueaWueS/oeaBrwogICAgICAgICAgfSBlbHNlIGlmIChvdGhlclBhcnRpY2lwYW50ICYmIG90aGVyUGFydGljaXBhbnQudXNlcikgewogICAgICAgICAgICBjb25zdCB1c2VyID0gb3RoZXJQYXJ0aWNpcGFudC51c2VyOwogICAgICAgICAgICAvLyDlpITnkIblpLTlg4/ot6/lvoQKICAgICAgICAgICAgbGV0IGF2YXRhcl91cmwgPSAnJzsKICAgICAgICAgICAgaWYgKHVzZXIuYXZhdGFyKSB7CiAgICAgICAgICAgICAgY29uc3QgYXZhdGFyID0gdXNlci5hdmF0YXI7CiAgICAgICAgICAgICAgaWYgKGF2YXRhci5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgYXZhdGFyLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHsKICAgICAgICAgICAgICAgIGF2YXRhcl91cmwgPSBhdmF0YXI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChhdmF0YXIuc3RhcnRzV2l0aCgnLycpKSB7CiAgICAgICAgICAgICAgICBhdmF0YXJfdXJsID0gYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9CQVNFX0FQSSB8fCAnaHR0cDovL2xvY2FsaG9zdDo4MDAwJ30ke2F2YXRhcn1gOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhdmF0YXJfdXJsID0gYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9CQVNFX0FQSSB8fCAnaHR0cDovL2xvY2FsaG9zdDo4MDAwJ30vJHthdmF0YXJ9YDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGVtcENvbnRhY3QgPSB7CiAgICAgICAgICAgICAgaWQ6IHBhcnNlSW50KGNoYXRJZCksCiAgICAgICAgICAgICAgbmFtZTogKHVzZXIubmFtZSB8fCAoKHVzZXIuZmlyc3RfbmFtZSB8fCAnJykgKyAnICcgKyAodXNlci5sYXN0X25hbWUgfHwgJycpKS50cmltKCkgfHwgdXNlci51c2VybmFtZSB8fCAn5pyq5ZG95ZCN6IGU57O75Lq6JykudHJpbSgpLAogICAgICAgICAgICAgIGluaXRpYWw6ICh1c2VyLm5hbWUgfHwgdXNlci5maXJzdF9uYW1lIHx8IHVzZXIudXNlcm5hbWUgfHwgJ+acquWRveWQjeiBlOezu+S6uicpWzBdLAogICAgICAgICAgICAgIGF2YXRhcjogdXNlci5hdmF0YXIgfHwgJycsCiAgICAgICAgICAgICAgYXZhdGFyX3VybDogYXZhdGFyX3VybCwKICAgICAgICAgICAgICBjb2xvcjogZ2V0UmFuZG9tQ29sb3IodXNlci5pZCksCiAgICAgICAgICAgICAgc3RhdHVzOiAnb25saW5lJywKICAgICAgICAgICAgICBsYXN0TWVzc2FnZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBzZXNzaW9uLmxhc3RfbWVzc2FnZS5jb250ZW50IDogJycsCiAgICAgICAgICAgICAgbGFzdFRpbWU6IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24udXBkYXRlZF9hdCksCiAgICAgICAgICAgICAgdW5yZWFkOiAwLAogICAgICAgICAgICAgIGlzR3JvdXA6IGZhbHNlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyDlpoLmnpzml6Dms5Xmib7liLDlr7nmlrnkv6Hmga/vvIzkvb/nlKjpu5jorqTlgLwKICAgICAgICAgICAgdGVtcENvbnRhY3QgPSB7CiAgICAgICAgICAgICAgaWQ6IHBhcnNlSW50KGNoYXRJZCksCiAgICAgICAgICAgICAgbmFtZTogc2Vzc2lvbi50aXRsZSB8fCAn6IGK5aSpJywKICAgICAgICAgICAgICBpbml0aWFsOiAoc2Vzc2lvbi50aXRsZSB8fCAn6IGK5aSpJylbMF0sCiAgICAgICAgICAgICAgYXZhdGFyOiAnJywKICAgICAgICAgICAgICBhdmF0YXJfdXJsOiAnJywKICAgICAgICAgICAgICBjb2xvcjogZ2V0UmFuZG9tQ29sb3IocGFyc2VJbnQoY2hhdElkKSksCiAgICAgICAgICAgICAgc3RhdHVzOiAnb25saW5lJywKICAgICAgICAgICAgICBsYXN0TWVzc2FnZTogJycsCiAgICAgICAgICAgICAgbGFzdFRpbWU6IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24udXBkYXRlZF9hdCksCiAgICAgICAgICAgICAgdW5yZWFkOiAwLAogICAgICAgICAgICAgIGlzR3JvdXA6IHNlc3Npb24uaXNfZ3JvdXAKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyDmt7vliqDkuLTml7bogZTns7vkurrliLDliJfooagKICAgICAgICAgIGlmICh0ZW1wQ29udGFjdCkgewogICAgICAgICAgICBjb250YWN0cy52YWx1ZS51bnNoaWZ0KHRlbXBDb250YWN0KTsKICAgICAgICAgICAgY29uc29sZS5sb2coJ+a3u+WKoOS4tOaXtuiBlOezu+S6ujonLCB0ZW1wQ29udGFjdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyDmm7TmlrDnu4Tku7bmlbDmja4KICAgICAgICBtZXNzYWdlcy52YWx1ZSA9IG1lc3NhZ2VEYXRhIHx8IFtdOwogICAgICAgIGN1cnJlbnRDaGF0SWQudmFsdWUgPSBwYXJzZUludChjaGF0SWQpOwogICAgICAgIHNlbGVjdGVkQ29udGFjdC52YWx1ZSA9IHBhcnNlSW50KGNoYXRJZCk7CgogICAgICAgIC8vIOWKoOi9veW9k+WJjeS8muivneW3suS4iuS8oOeahOaWh+aho0lECiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoewogICAgICAgICAgICB1cmw6ICcvYXBpL2FpL2RvY3VtZW50cy8nLAogICAgICAgICAgICBtZXRob2Q6ICdnZXQnLAogICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICBjaGF0OiBjaGF0SWQKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAocmVzICYmIHJlcy5kYXRhICYmIEFycmF5LmlzQXJyYXkocmVzLmRhdGEucmVzdWx0cykpIHsKICAgICAgICAgICAgc2VsZWN0ZWREb2N1bWVudElkcy52YWx1ZSA9IHJlcy5kYXRhLnJlc3VsdHMubWFwKGRvYyA9PiBkb2MuaWQpOwogICAgICAgICAgICBjb25zb2xlLmxvZygn5b2T5YmN5Lya6K+d5paH5qGjSUQ6Jywgc2VsZWN0ZWREb2N1bWVudElkcy52YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgc2VsZWN0ZWREb2N1bWVudElkcy52YWx1ZSA9IFtdOwogICAgICAgIH0KCiAgICAgICAgLy8g5rua5Yqo5Yiw5bqV6YOoCiAgICAgICAgbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgc2Nyb2xsVG9Cb3R0b20oKTsKICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfliqDovb3kvJror53or6bmg4XlpLHotKU6JywgZXJyb3IpOwogICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSAn5Yqg6L296IGK5aSp5raI5oGv5aSx6LSlJzsKICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UpIHsKICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IGVycm9yLnJlc3BvbnNlLnN0YXR1czsKICAgICAgICAgIGlmIChzdGF0dXMgPT09IDQwNCkgewogICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAn6IGK5aSp5Lya6K+d5LiN5a2Y5Zyo5oiW5bey6KKr5Yig6ZmkJzsKICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSA0MDMpIHsKICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gJ+aXoOadg+iuv+mXruatpOiBiuWkqeS8muivnSc7CiAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnJlc3BvbnNlLmRhdGEgJiYgZXJyb3IucmVzcG9uc2UuZGF0YS5tZXNzYWdlKSB7CiAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IGVycm9yLnJlc3BvbnNlLmRhdGEubWVzc2FnZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGVycm9yLm1lc3NhZ2UpIHsKICAgICAgICAgIGVycm9yTWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U7CiAgICAgICAgfQogICAgICAgIEVsTWVzc2FnZS5lcnJvcihlcnJvck1lc3NhZ2UpOwogICAgICAgIG1lc3NhZ2VzLnZhbHVlID0gW107CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgaWYgKCFpc0JhY2tncm91bmRSZWZyZXNoKSB7CiAgICAgICAgICBtZXNzYWdlc0xvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgLy8g5Yi35paw6IGK5aSp5Lya6K+d5YiX6KGoCiAgICBjb25zdCByZWZyZXNoQ2hhdFNlc3Npb25zID0gYXN5bmMgKCkgPT4gewogICAgICAvLyDmm7TmlrDnlKjmiLfliJfooagKICAgICAgYXdhaXQgbG9hZEFsbFVzZXJzKCk7CgogICAgICAvLyDmm7TmlrDpg6jpl6jliJfooagKICAgICAgYXdhaXQgbG9hZERlcGFydG1lbnRzKCk7CgogICAgICAvLyDmm7TmlrDogYrlpKnkvJror50KICAgICAgYXdhaXQgbG9hZENoYXRTZXNzaW9ucygpOwoKICAgICAgLy8g5aaC5p6c5pyJ5b2T5YmN6IGK5aSpSUTvvIznoa7kv53pgInkuK3mraPnoa7nmoTogZTns7vkuroKICAgICAgaWYgKGN1cnJlbnRDaGF0SWQudmFsdWUpIHsKICAgICAgICBjb25zdCBjb250YWN0ID0gY29udGFjdHMudmFsdWUuZmluZChjID0+IGMuaWQgPT09IGN1cnJlbnRDaGF0SWQudmFsdWUpOwogICAgICAgIGlmIChjb250YWN0KSB7CiAgICAgICAgICBzZWxlY3RlZENvbnRhY3QudmFsdWUgPSBjb250YWN0LmlkOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICAvLyDnoa7kv53mtojmga/lrrnlmajmu5rliqjliLDlupXpg6gKICAgIGNvbnN0IHNjcm9sbFRvQm90dG9tID0gKCkgPT4gewogICAgICBpZiAobWVzc2FnZUNvbnRhaW5lci52YWx1ZSkgewogICAgICAgIG1lc3NhZ2VDb250YWluZXIudmFsdWUuc2Nyb2xsVG9wID0gbWVzc2FnZUNvbnRhaW5lci52YWx1ZS5zY3JvbGxIZWlnaHQ7CiAgICAgIH0KICAgIH07CgogICAgLy8g5Zyo6YCJ5oup6IGU57O75Lq65ZCO77yM5rua5Yqo5Yiw5bqV6YOoCiAgICBjb25zdCBzZWxlY3RDb250YWN0ID0gYXN5bmMgY29udGFjdCA9PiB7CiAgICAgIC8vIOajgOafpeaYr+WQpuWwneivleS4juiHquW3seiBiuWkqQogICAgICBpZiAoIWNvbnRhY3QuaXNHcm91cCAmJiB1c2VySW5mby52YWx1ZSAmJiBjb250YWN0LnVzZXJJZCA9PT0gdXNlckluZm8udmFsdWUuaWQpIHsKICAgICAgICBFbE1lc3NhZ2Uud2FybmluZygn5LiN6IO95LiO6Ieq5bex6IGK5aSpJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnNvbGUubG9nKCfpgInmi6nogZTns7vkuro6JywgY29udGFjdCk7CgogICAgICAvLyDlpITnkIbkuKTnp43nsbvlnovnmoRJRO+8mueOsOacieWvueivnUlE5ZKM55So5oi3SUTliY3nvIDnmoTmg4XlhrUKICAgICAgbGV0IGNvbnRhY3RJZCA9IGNvbnRhY3QuaWQ7CgogICAgICAvLyDmo4Dmn6XmmK/lkKblt7LmnInor6XogZTns7vkurrnmoTlr7nor50KICAgICAgaWYgKHR5cGVvZiBjb250YWN0SWQgPT09ICdzdHJpbmcnICYmIGNvbnRhY3RJZC5zdGFydHNXaXRoKCd1c2VyXycpKSB7CiAgICAgICAgLy8g6L+Z5piv55u05o6l6YCJ5oup5LqG55So5oi377yM6ICM5LiN5piv546w5pyJ55qE6IGK5aSp5Lya6K+dCiAgICAgICAgbGV0IHVzZXJJZCA9IGNvbnRhY3QudXNlcklkIHx8IGNvbnRhY3QuaWQucmVwbGFjZSgndXNlcl8nLCAnJyk7CiAgICAgICAgY29uc29sZS5sb2coJ+WwneivleafpeaJvuS4jueUqOaIt+eahOeOsOacieWvueivnTonLCB1c2VySWQpOwoKICAgICAgICAvLyDlsJ3or5XlnKjnjrDmnInkvJror53kuK3mn6Xmib7kuI7or6XnlKjmiLfnmoTlr7nor50KICAgICAgICBjb25zdCBleGlzdGluZ0NoYXQgPSBjb250YWN0cy52YWx1ZS5maW5kKGMgPT4gIWMuaXNHcm91cCAmJiAoYy51c2VySWQgJiYgYy51c2VySWQgPT0gdXNlcklkIHx8IGMudXNlciAmJiBjLnVzZXIuaWQgPT0gdXNlcklkKSk7CiAgICAgICAgaWYgKGV4aXN0aW5nQ2hhdCkgewogICAgICAgICAgY29uc29sZS5sb2coJ+aJvuWIsOS4jueUqOaIt+eahOeOsOacieWvueivnTonLCBleGlzdGluZ0NoYXQpOwogICAgICAgICAgY29udGFjdElkID0gZXhpc3RpbmdDaGF0LmlkOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmxvZygn5pyq5om+5Yiw5LiO55So5oi355qE546w5pyJ5a+56K+d77yM5Yib5bu65paw5a+56K+dJyk7CgogICAgICAgICAgLy8g5Yib5bu65paw55qE6IGK5aSp5Lya6K+dCiAgICAgICAgICB0cnkgewogICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoewogICAgICAgICAgICAgIHVybDogJy9hcGkvY2hhdC9zZXNzaW9ucy8nLAogICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLAogICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgIHBhcnRpY2lwYW50X2lkczogW3VzZXJJZF0sCiAgICAgICAgICAgICAgICBpc19ncm91cDogZmFsc2UKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25zb2xlLmxvZygn5Yib5bu65Lya6K+d5ZON5bqUOicsIHJlc3BvbnNlKTsKCiAgICAgICAgICAgIC8vIOWkhOeQhkFQSeWTjeW6lAogICAgICAgICAgICBsZXQgbmV3U2Vzc2lvbiA9IG51bGw7CiAgICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgICAgbmV3U2Vzc2lvbiA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuaWQpIHsKICAgICAgICAgICAgICBuZXdTZXNzaW9uID0gcmVzcG9uc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG5ld1Nlc3Npb24gJiYgbmV3U2Vzc2lvbi5pZCkgewogICAgICAgICAgICAgIC8vIOWIm+W7uuS4tOaXtuiBlOezu+S6uuWvueixoQogICAgICAgICAgICAgIGNvbnN0IHRlbXBDb250YWN0ID0gewogICAgICAgICAgICAgICAgaWQ6IG5ld1Nlc3Npb24uaWQsCiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZCwKICAgICAgICAgICAgICAgIG5hbWU6IGNvbnRhY3QubmFtZSwKICAgICAgICAgICAgICAgIGluaXRpYWw6IGNvbnRhY3QuaW5pdGlhbCwKICAgICAgICAgICAgICAgIGF2YXRhcjogY29udGFjdC5hdmF0YXIsCiAgICAgICAgICAgICAgICBhdmF0YXJfdXJsOiBjb250YWN0LmF2YXRhcl91cmwgfHwgJycsCiAgICAgICAgICAgICAgICBjb2xvcjogY29udGFjdC5jb2xvciB8fCBnZXRSYW5kb21Db2xvcih1c2VySWQpLAogICAgICAgICAgICAgICAgc3RhdHVzOiAnb25saW5lJywKICAgICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiAnJywKICAgICAgICAgICAgICAgIGxhc3RUaW1lOiBmb3JtYXRNZXNzYWdlVGltZShuZXcgRGF0ZSgpKSwKICAgICAgICAgICAgICAgIHVucmVhZDogMCwKICAgICAgICAgICAgICAgIGlzR3JvdXA6IGZhbHNlLAogICAgICAgICAgICAgICAgZGVwYXJ0bWVudDogY29udGFjdC5kZXBhcnRtZW50CiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgLy8g5re75Yqg5Yiw6IGU57O75Lq65YiX6KGoCiAgICAgICAgICAgICAgY29udGFjdHMudmFsdWUudW5zaGlmdCh0ZW1wQ29udGFjdCk7CgogICAgICAgICAgICAgIC8vIOabtOaWsOmAieS4reeahOiBlOezu+S6ugogICAgICAgICAgICAgIGNvbnRhY3RJZCA9IG5ld1Nlc3Npb24uaWQ7CiAgICAgICAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+W3suWIm+W7uuaWsOeahOWvueivnScpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcign5Yib5bu65Lya6K+d6L+U5Zue5peg5pWI5pWw5o2uJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIm+W7uuaWsOS8muivneWksei0pTonLCBlcnJvcik7CiAgICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5peg5rOV5Yib5bu65paw5a+56K+dOiAnICsgKGVycm9yLm1lc3NhZ2UgfHwgJ+acquefpemUmeivrycpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8g5Yqg6L296YCJ5Lit55qE6IGU57O75Lq6CiAgICAgIHNlbGVjdGVkQ29udGFjdC52YWx1ZSA9IGNvbnRhY3RJZDsKICAgICAgbWVzc2FnZUlucHV0LnZhbHVlID0gJyc7CiAgICAgIG1lc3NhZ2VzLnZhbHVlID0gW107CgogICAgICAvLyDliqDovb3mtojmga8KICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCBsb2FkQ2hhdE1lc3NhZ2VzKGNvbnRhY3RJZCk7CgogICAgICAgIC8vIOa7muWKqOWIsOW6lemDqAogICAgICAgIG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIHNjcm9sbFRvQm90dG9tKCk7CiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Yqg6L296IGK5aSp5raI5oGv5aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+aXoOazleWKoOi9veWvueivneWGheWuue+8micgKyAoZXJyb3IubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJykpOwogICAgICB9CiAgICB9OwoKICAgIC8vIOWcqOa2iOaBr+WIl+ihqOabtOaWsOWQju+8jOa7muWKqOWIsOW6lemDqAogICAgd2F0Y2gobWVzc2FnZXMsICgpID0+IHsKICAgICAgbmV4dFRpY2soKCkgPT4gewogICAgICAgIHNjcm9sbFRvQm90dG9tKCk7CiAgICAgIH0pOwogICAgfSk7CgogICAgLy8g5Y+R6YCB5raI5oGvCiAgICBjb25zdCBzZW5kTWVzc2FnZSA9IGFzeW5jICgpID0+IHsKICAgICAgaWYgKCFtZXNzYWdlSW5wdXQudmFsdWUudHJpbSgpIHx8ICFjdXJyZW50Q2hhdElkLnZhbHVlKSByZXR1cm47CiAgICAgIHRyeSB7CiAgICAgICAgY29uc29sZS5sb2coJ+WPkemAgea2iOaBr+aXtuaWh+aho0lEczonLCBzZWxlY3RlZERvY3VtZW50SWRzLnZhbHVlKTsKICAgICAgICBpZiAoIXVzZXJJbmZvLnZhbHVlIHx8ICF1c2VySW5mby52YWx1ZS5pZCkgewogICAgICAgICAgY29uc3QgdXNlckRhdGEgPSBhd2FpdCBmZXRjaEN1cnJlbnRVc2VyKCk7CiAgICAgICAgICBpZiAoIXVzZXJEYXRhIHx8ICF1c2VyRGF0YS5pZCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+aXoOazleiOt+WPluW9k+WJjeeUqOaIt+S/oeaBr++8jOivt+WIt+aWsOmhtemdoumHjeivlScpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCB0ZW1wTWVzc2FnZSA9IHsKICAgICAgICAgIGlkOiAndGVtcC0nICsgRGF0ZS5ub3coKSwKICAgICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2VJbnB1dC52YWx1ZS50cmltKCksCiAgICAgICAgICBzZW5kZXI6IHsKICAgICAgICAgICAgaWQ6IHVzZXJJbmZvLnZhbHVlLmlkLAogICAgICAgICAgICB1c2VybmFtZTogdXNlckluZm8udmFsdWUudXNlcm5hbWUgfHwgJ+eUqOaItycsCiAgICAgICAgICAgIGZpcnN0X25hbWU6IHVzZXJJbmZvLnZhbHVlLmZpcnN0X25hbWUgfHwgJycsCiAgICAgICAgICAgIGxhc3RfbmFtZTogdXNlckluZm8udmFsdWUubGFzdF9uYW1lIHx8ICcnCiAgICAgICAgICB9LAogICAgICAgICAgbWVzc2FnZV90eXBlOiAndGV4dCcsCiAgICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICBpc190ZW1wOiB0cnVlCiAgICAgICAgfTsKICAgICAgICBtZXNzYWdlcy52YWx1ZS5wdXNoKHRlbXBNZXNzYWdlKTsKICAgICAgICBjb25zdCBtZXNzYWdlQ29weSA9IG1lc3NhZ2VJbnB1dC52YWx1ZTsKICAgICAgICBtZXNzYWdlSW5wdXQudmFsdWUgPSAnJzsKICAgICAgICBhd2FpdCBuZXh0VGljaygpOwogICAgICAgIHNjcm9sbFRvQm90dG9tKCk7CiAgICAgICAgbGV0IHJlc3BvbnNlLCBhaU1zZzsKICAgICAgICBpZiAoc2VsZWN0ZWREb2N1bWVudElkcy52YWx1ZSAmJiBzZWxlY3RlZERvY3VtZW50SWRzLnZhbHVlLmxlbmd0aCA+IDApIHsKICAgICAgICAgIC8vIOaWh+aho+WinuW8ukFJ5a+56K+dCiAgICAgICAgICByZXNwb25zZSA9IGF3YWl0IGFpQ2hhdFdpdGhEb2N1bWVudHMoewogICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlQ29weSwKICAgICAgICAgICAgY2hhdF9pZDogY3VycmVudENoYXRJZC52YWx1ZSwKICAgICAgICAgICAgZG9jdW1lbnRfaWRzOiBzZWxlY3RlZERvY3VtZW50SWRzLnZhbHVlCiAgICAgICAgICB9KTsKICAgICAgICAgIC8vIOWFvOWuuea1geW8j+aWh+acrOWTjeW6lAogICAgICAgICAgbGV0IGFpQ29udGVudCA9ICcnOwogICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHR5cGVvZiByZXNwb25zZS5kYXRhID09PSAnc3RyaW5nJykgewogICAgICAgICAgICBhaUNvbnRlbnQgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEubWVzc2FnZSkgewogICAgICAgICAgICBhaUNvbnRlbnQgPSByZXNwb25zZS5kYXRhLm1lc3NhZ2U7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYWlDb250ZW50KSB7CiAgICAgICAgICAgIGFpTXNnID0gewogICAgICAgICAgICAgIGlkOiAnYWktJyArIERhdGUubm93KCksCiAgICAgICAgICAgICAgY29udGVudDogYWlDb250ZW50LAogICAgICAgICAgICAgIHNlbmRlcjogewogICAgICAgICAgICAgICAgaWQ6IDAsCiAgICAgICAgICAgICAgICB1c2VybmFtZTogJ0FJ5Yqp5omLJwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgbWVzc2FnZV90eXBlOiAndGV4dCcsCiAgICAgICAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIC8vIOeUqEFJ5Zue5aSN5pu/5o2i5Li05pe25raI5oGvCiAgICAgICAgICAgIGNvbnN0IHRlbXBJbmRleCA9IG1lc3NhZ2VzLnZhbHVlLmZpbmRJbmRleChtID0+IG0uaWQgPT09IHRlbXBNZXNzYWdlLmlkKTsKICAgICAgICAgICAgaWYgKHRlbXBJbmRleCAhPT0gLTEpIHsKICAgICAgICAgICAgICBtZXNzYWdlcy52YWx1ZS5zcGxpY2UodGVtcEluZGV4LCAxLCBhaU1zZyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbWVzc2FnZXMudmFsdWUucHVzaChhaU1zZyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8g5Y6f5pyJ5pmu6YCa5raI5oGvCiAgICAgICAgICByZXNwb25zZSA9IGF3YWl0IHNlbmRUZXh0TWVzc2FnZSh7CiAgICAgICAgICAgIGNoYXQ6IGN1cnJlbnRDaGF0SWQudmFsdWUsCiAgICAgICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2VDb3B5CiAgICAgICAgICB9KTsKICAgICAgICAgIGxldCBtZXNzYWdlRGF0YSA9IG51bGw7CiAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3VjY2VzcyAmJiByZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgIG1lc3NhZ2VEYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuaWQpIHsKICAgICAgICAgICAgbWVzc2FnZURhdGEgPSByZXNwb25zZTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuY2hhdCkgewogICAgICAgICAgICBtZXNzYWdlRGF0YSA9IHsKICAgICAgICAgICAgICBpZDogcmVzcG9uc2UuaWQgfHwgJ21zZy0nICsgRGF0ZS5ub3coKSwKICAgICAgICAgICAgICBjb250ZW50OiByZXNwb25zZS5jb250ZW50LAogICAgICAgICAgICAgIG1lc3NhZ2VfdHlwZTogcmVzcG9uc2UubWVzc2FnZV90eXBlLAogICAgICAgICAgICAgIGZpbGU6IHJlc3BvbnNlLmZpbGUsCiAgICAgICAgICAgICAgY3JlYXRlZF9hdDogcmVzcG9uc2UuY3JlYXRlZF9hdCB8fCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgICAgc2VuZGVyOiB7CiAgICAgICAgICAgICAgICBpZDogdXNlckluZm8udmFsdWUuaWQsCiAgICAgICAgICAgICAgICB1c2VybmFtZTogdXNlckluZm8udmFsdWUudXNlcm5hbWUgfHwgJ+eUqOaItycsCiAgICAgICAgICAgICAgICBmaXJzdF9uYW1lOiB1c2VySW5mby52YWx1ZS5maXJzdF9uYW1lIHx8ICcnLAogICAgICAgICAgICAgICAgbGFzdF9uYW1lOiB1c2VySW5mby52YWx1ZS5sYXN0X25hbWUgfHwgJycKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCB0ZW1wSW5kZXggPSBtZXNzYWdlcy52YWx1ZS5maW5kSW5kZXgobSA9PiBtLmlkID09PSB0ZW1wTWVzc2FnZS5pZCk7CiAgICAgICAgICBpZiAodGVtcEluZGV4ICE9PSAtMSAmJiBtZXNzYWdlRGF0YSkgewogICAgICAgICAgICBtZXNzYWdlcy52YWx1ZS5zcGxpY2UodGVtcEluZGV4LCAxLCBtZXNzYWdlRGF0YSk7CiAgICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2VEYXRhKSB7CiAgICAgICAgICAgIG1lc3NhZ2VzLnZhbHVlLnB1c2gobWVzc2FnZURhdGEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhd2FpdCBuZXh0VGljaygpOwogICAgICAgIHNjcm9sbFRvQm90dG9tKCk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Y+R6YCB5raI5oGv5aSx6LSlOicsIGVycm9yKTsKICAgICAgICBtZXNzYWdlcy52YWx1ZSA9IG1lc3NhZ2VzLnZhbHVlLmZpbHRlcihtID0+ICFtLmlzX3RlbXApOwogICAgICAgIG1lc3NhZ2VJbnB1dC52YWx1ZSA9IGVycm9yLnNhdmVkTWVzc2FnZSB8fCBtZXNzYWdlSW5wdXQudmFsdWU7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCflj5HpgIHmtojmga/lpLHotKXvvIzor7fph43or5UnKTsKICAgICAgfQogICAgfTsKCiAgICAvLyDmiZPlvIDmlofku7bkuIrkvKAKICAgIGNvbnN0IG9wZW5GaWxlVXBsb2FkID0gKCkgPT4gewogICAgICBmaWxlSW5wdXQudmFsdWUuY2xpY2soKTsKICAgIH07CgogICAgLy8g5omT5byA5Zu+54mH5LiK5LygCiAgICBjb25zdCBvcGVuSW1hZ2VVcGxvYWQgPSAoKSA9PiB7CiAgICAgIGltYWdlSW5wdXQudmFsdWUuY2xpY2soKTsKICAgIH07CgogICAgLy8g5re75Yqg5paH5Lu25ZKM5Zu+54mH5LiK5Lyg5Yqg6L2954q25oCBCiAgICBjb25zdCBmaWxlVXBsb2FkaW5nID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IGltYWdlVXBsb2FkaW5nID0gcmVmKGZhbHNlKTsKCiAgICAvLyDlpITnkIbmlofku7bkuIrkvKAKICAgIGNvbnN0IGhhbmRsZUZpbGVVcGxvYWQgPSBhc3luYyBldmVudCA9PiB7CiAgICAgIGNvbnN0IGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXNbMF07CiAgICAgIGlmICghZmlsZSB8fCAhY3VycmVudENoYXRJZC52YWx1ZSkgcmV0dXJuOwogICAgICB0cnkgewogICAgICAgIC8vIOaYvuekuuWKoOi9veWKqOeUuwogICAgICAgIGZpbGVVcGxvYWRpbmcudmFsdWUgPSB0cnVlOwoKICAgICAgICAvLyDnm7TmjqXkvb/nlKhzZW5kRmlsZU1lc3NhZ2Xlj5HpgIHmlofku7bmtojmga8KICAgICAgICBhd2FpdCBzZW5kRmlsZU1lc3NhZ2UoY3VycmVudENoYXRJZC52YWx1ZSwgYOWPkemAgeaWh+S7tjogJHtmaWxlLm5hbWV9YCwgZmlsZSk7CgogICAgICAgIC8vIOWQjOaXtuS4iuS8oOWIsEFJ5paH5qGj57O757uf77yI5aaC5p6c6ZyA6KaB77yJCiAgICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlKTsKICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2NoYXQnLCBjdXJyZW50Q2hhdElkLnZhbHVlKTsKICAgICAgICBhd2FpdCByZXF1ZXN0KHsKICAgICAgICAgIHVybDogJy9hcGkvYWkvZG9jdW1lbnRzL3VwbG9hZC8nLAogICAgICAgICAgbWV0aG9kOiAncG9zdCcsCiAgICAgICAgICBkYXRhOiBmb3JtRGF0YSwKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdtdWx0aXBhcnQvZm9ybS1kYXRhJwogICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyDkuIrkvKDlkI7lvLrliLbliLfmlrDmlofmoaNJROWIl+ihqAogICAgICAgIGNvbnN0IGRvY1JlcyA9IGF3YWl0IHJlcXVlc3QoewogICAgICAgICAgdXJsOiAnL2FwaS9haS9kb2N1bWVudHMvJywKICAgICAgICAgIG1ldGhvZDogJ2dldCcsCiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgY2hhdDogY3VycmVudENoYXRJZC52YWx1ZQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmIChkb2NSZXMgJiYgZG9jUmVzLmRhdGEgJiYgQXJyYXkuaXNBcnJheShkb2NSZXMuZGF0YS5yZXN1bHRzKSkgewogICAgICAgICAgc2VsZWN0ZWREb2N1bWVudElkcy52YWx1ZSA9IGRvY1Jlcy5kYXRhLnJlc3VsdHMubWFwKGRvYyA9PiBkb2MuaWQpOwogICAgICAgICAgY29uc29sZS5sb2coJ+S4iuS8oOWQjuWIt+aWsOaWh+aho0lEczonLCBzZWxlY3RlZERvY3VtZW50SWRzLnZhbHVlKTsKICAgICAgICB9CiAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+aWh+S7tuWPkemAgeaIkOWKnycpOwoKICAgICAgICAvLyDph43mlrDliqDovb3mtojmga8KICAgICAgICBsb2FkQ2hhdE1lc3NhZ2VzKGN1cnJlbnRDaGF0SWQudmFsdWUsIHRydWUpOwogICAgICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9ICcnOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WPkemAgeaWh+S7tuWksei0pTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCflj5HpgIHmlofku7blpLHotKUnKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAvLyDml6DorrrmiJDlip/lpLHotKXvvIzpg73lhbPpl63liqDovb3liqjnlLsKICAgICAgICBmaWxlVXBsb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgIH0KICAgIH07CgogICAgLy8g5aSE55CG5Zu+54mH5LiK5LygCiAgICBjb25zdCBoYW5kbGVJbWFnZVVwbG9hZCA9IGFzeW5jIGV2ZW50ID0+IHsKICAgICAgY29uc3QgZmlsZSA9IGV2ZW50LnRhcmdldC5maWxlc1swXTsKICAgICAgaWYgKCFmaWxlIHx8ICFjdXJyZW50Q2hhdElkLnZhbHVlKSByZXR1cm47CiAgICAgIHRyeSB7CiAgICAgICAgLy8g5qOA5p+l5paH5Lu257G75Z6LCiAgICAgICAgaWYgKCFmaWxlLnR5cGUuc3RhcnRzV2l0aCgnaW1hZ2UvJykpIHsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Y+q6IO95LiK5Lyg5Zu+54mH5paH5Lu2Jyk7CiAgICAgICAgICBldmVudC50YXJnZXQudmFsdWUgPSAnJzsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIOajgOafpeaWh+S7tuWkp+Wwj++8iOacgOWkpzEwTULvvIkKICAgICAgICBjb25zdCBtYXhTaXplID0gMTAgKiAxMDI0ICogMTAyNDsgLy8gMTBNQgogICAgICAgIGlmIChmaWxlLnNpemUgPiBtYXhTaXplKSB7CiAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WbvueJh+Wkp+Wwj+S4jeiDvei2hei/hzEwTUInKTsKICAgICAgICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9ICcnOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g5pi+56S65Yqg6L295Yqo55S7CiAgICAgICAgaW1hZ2VVcGxvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICAgIGNvbnNvbGUubG9nKCflh4blpIflj5HpgIHlm77niYfvvIzogYrlpKlJRDonLCBjdXJyZW50Q2hhdElkLnZhbHVlLCAn5paH5Lu2OicsIGZpbGUubmFtZSwgJ+Wkp+WwjzonLCBmaWxlLnNpemUpOwoKICAgICAgICAvLyDkvb/nlKjkv67mlLnlkI7nmoRBUEnlj4LmlbAKICAgICAgICBhd2FpdCBzZW5kSW1hZ2VNZXNzYWdlKGN1cnJlbnRDaGF0SWQudmFsdWUsIGDlj5HpgIHlm77niYdgLCBmaWxlKTsKCiAgICAgICAgLy8g6YeN5paw5Yqg6L295raI5oGvCiAgICAgICAgbG9hZENoYXRNZXNzYWdlcyhjdXJyZW50Q2hhdElkLnZhbHVlLCB0cnVlKTsKCiAgICAgICAgLy8g5riF56m65paH5Lu26L6T5YWlCiAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gJyc7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Y+R6YCB5Zu+54mH5aSx6LSlOicsIGVycm9yKTsKCiAgICAgICAgLy8g5pu06K+m57uG55qE6ZSZ6K+v5L+h5oGvCiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9ICflj5HpgIHlm77niYflpLHotKUnOwogICAgICAgIGlmIChlcnJvci5yZXNwb25zZSkgewogICAgICAgICAgY29uc29sZS5lcnJvcign6ZSZ6K+v54q25oCB56CBOicsIGVycm9yLnJlc3BvbnNlLnN0YXR1cyk7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfplJnor6/or6bmg4U6JywgZXJyb3IucmVzcG9uc2UuZGF0YSk7CiAgICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UuZGF0YSAmJiBlcnJvci5yZXNwb25zZS5kYXRhLmVycm9yKSB7CiAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IGVycm9yLnJlc3BvbnNlLmRhdGEuZXJyb3I7CiAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnJlc3BvbnNlLmRhdGEgJiYgdHlwZW9mIGVycm9yLnJlc3BvbnNlLmRhdGEgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IGVycm9yLnJlc3BvbnNlLmRhdGE7CiAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDEzKSB7CiAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICflm77niYflpKrlpKfvvIzmnI3liqHlmajmi5Lnu53mjqXmlLYnOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoZXJyb3JNZXNzYWdlKTsKICAgICAgICBldmVudC50YXJnZXQudmFsdWUgPSAnJzsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAvLyDml6DorrrmiJDlip/lpLHotKXvvIzpg73lhbPpl63liqDovb3liqjnlLsKICAgICAgICBpbWFnZVVwbG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICB9CiAgICB9OwoKICAgIC8vIOaJk+W8gOefpeivhuW6k+WvueivneahhgogICAgY29uc3Qgb3Blbktub3dsZWRnZURpYWxvZyA9IGFzeW5jICgpID0+IHsKICAgICAga25vd2xlZGdlRGlhbG9nVmlzaWJsZS52YWx1ZSA9IHRydWU7CiAgICAgIGF3YWl0IGxvYWRLbm93bGVkZ2VMaXN0KCk7CiAgICB9OwoKICAgIC8vIOWKoOi9veefpeivhuW6k+WIl+ihqAogICAgY29uc3QgbG9hZEtub3dsZWRnZUxpc3QgPSBhc3luYyAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAga25vd2xlZGdlTG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgICAgY29uc3QgewogICAgICAgICAgZGF0YQogICAgICAgIH0gPSBhd2FpdCBnZXRLbm93bGVkZ2VMaXN0KCk7CiAgICAgICAga25vd2xlZGdlTGlzdC52YWx1ZSA9IGRhdGE7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Yqg6L2955+l6K+G5bqT5YiX6KGo5aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WKoOi9veefpeivhuW6k+WIl+ihqOWksei0pScpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIGtub3dsZWRnZUxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgfQogICAgfTsKCiAgICAvLyDpgInmi6nnn6Xor4blupPmlofku7YKICAgIGNvbnN0IHNlbGVjdEtub3dsZWRnZSA9IHJvdyA9PiB7CiAgICAgIHNlbGVjdGVkS25vd2xlZGdlLnZhbHVlID0gcm93OwogICAgfTsKCiAgICAvLyDliIbkuqvnn6Xor4blupPmlofku7YKICAgIGNvbnN0IHNoYXJlS25vd2xlZGdlID0gYXN5bmMga25vd2xlZGdlID0+IHsKICAgICAgaWYgKCFjdXJyZW50Q2hhdElkLnZhbHVlKSByZXR1cm47CiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgc2VuZEtub3dsZWRnZU1lc3NhZ2UoY3VycmVudENoYXRJZC52YWx1ZSwgYOWIhuS6q+efpeivhuW6k+aWh+S7tjogJHtrbm93bGVkZ2UudGl0bGV9YCwga25vd2xlZGdlLmlkKTsKCiAgICAgICAgLy8g5YWz6Zet5a+56K+d5qGGCiAgICAgICAga25vd2xlZGdlRGlhbG9nVmlzaWJsZS52YWx1ZSA9IGZhbHNlOwoKICAgICAgICAvLyDph43mlrDliqDovb3mtojmga8KICAgICAgICBsb2FkQ2hhdE1lc3NhZ2VzKGN1cnJlbnRDaGF0SWQudmFsdWUsIHRydWUpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIhuS6q+efpeivhuW6k+aWh+S7tuWksei0pTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfliIbkuqvnn6Xor4blupPmlofku7blpLHotKUnKTsKICAgICAgfQogICAgfTsKCiAgICAvLyDkuIvovb3mlofku7YKICAgIGNvbnN0IGRvd25sb2FkRmlsZSA9IGFzeW5jIG1lc3NhZ2UgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZG93bmxvYWRNZXNzYWdlRmlsZShtZXNzYWdlLmlkKTsKCiAgICAgICAgLy8g5Yib5bu65LiL6L296ZO+5o6lCiAgICAgICAgY29uc3QgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW3Jlc3BvbnNlLmRhdGFdKSk7CiAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgICAgICBsaW5rLmhyZWYgPSB1cmw7CiAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgbWVzc2FnZS5maWxlX25hbWUgfHwgJ2Rvd25sb2FkJyk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICBsaW5rLmNsaWNrKCk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaW5rKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfkuIvovb3mlofku7blpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5LiL6L295paH5Lu25aSx6LSlJyk7CiAgICAgIH0KICAgIH07CgogICAgLy8g5p+l55yL55+l6K+G5bqT5paH5Lu2CiAgICBjb25zdCB2aWV3S25vd2xlZGdlID0gbWVzc2FnZSA9PiB7CiAgICAgIGlmIChtZXNzYWdlLmtub3dsZWRnZV9kZXRhaWwpIHsKICAgICAgICAvLyDlj6/ku6Xot7PovazliLDnn6Xor4blupPor6bmg4XpobXpnaIKICAgICAgICBFbE1lc3NhZ2VCb3guYWxlcnQoYOagh+mimDogJHttZXNzYWdlLmtub3dsZWRnZV9kZXRhaWwudGl0bGV9PGJyPuaPj+i/sDogJHttZXNzYWdlLmtub3dsZWRnZV9kZXRhaWwuZGVzY3JpcHRpb24gfHwgJ+aXoCd9YCwgJ+efpeivhuW6k+aWh+S7ticsIHsKICAgICAgICAgIGRhbmdlcm91c2x5VXNlSFRNTFN0cmluZzogdHJ1ZSwKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu5a6aJwogICAgICAgIH0pOwogICAgICB9CiAgICB9OwoKICAgIC8vIOiOt+WPluWPkemAgeiAheminOiJsgogICAgY29uc3QgZ2V0U2VuZGVyQ29sb3IgPSBzZW5kZXIgPT4gewogICAgICByZXR1cm4gZ2V0UmFuZG9tQ29sb3Ioc2VuZGVyLmlkKTsKICAgIH07CgogICAgLy8g6I635Y+W5Y+R6YCB6ICF6aaW5a2X5q+NCiAgICBjb25zdCBnZXRTZW5kZXJJbml0aWFsID0gc2VuZGVyID0+IHsKICAgICAgcmV0dXJuIChzZW5kZXIuZmlyc3RfbmFtZSB8fCBzZW5kZXIudXNlcm5hbWUpWzBdOwogICAgfTsKCiAgICAvLyDmoLnmja5JROeUn+aIkOmaj+acuuminOiJsgogICAgY29uc3QgZ2V0UmFuZG9tQ29sb3IgPSBpZCA9PiB7CiAgICAgIGNvbnN0IGNvbG9ycyA9IFsnIzAwN2JmZicsICcjMjhhNzQ1JywgJyNkYzM1NDUnLCAnI2ZkN2UxNCcsICcjNmY0MmMxJywgJyMyMGM5OTcnLCAnIzE3YTJiOCcsICcjNmM3NTdkJ107CgogICAgICAvLyDkvb/nlKhJROS9nOS4uue0ouW8le+8jOehruS/neWQjOS4gOeUqOaIt+minOiJsuS4gOiHtAogICAgICBjb25zdCBpbmRleCA9IHR5cGVvZiBpZCA9PT0gJ251bWJlcicgPyBpZCAlIGNvbG9ycy5sZW5ndGggOiAwOwogICAgICByZXR1cm4gY29sb3JzW2luZGV4XTsKICAgIH07CgogICAgLy8g5qC85byP5YyW5raI5oGv5pe26Ze0CiAgICBjb25zdCBmb3JtYXRNZXNzYWdlVGltZSA9IHRpbWVzdGFtcCA9PiB7CiAgICAgIGlmICghdGltZXN0YW1wKSByZXR1cm4gJyc7CiAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh0aW1lc3RhbXApOwogICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpOwogICAgICBjb25zdCBkaWZmID0gbm93IC0gZGF0ZTsKCiAgICAgIC8vIOS7iuWkqeWGheeahOa2iOaBr+aYvuekuuaXtumXtAogICAgICBpZiAoZGlmZiA8IDI0ICogNjAgKiA2MCAqIDEwMDApIHsKICAgICAgICBjb25zdCBob3VycyA9IGRhdGUuZ2V0SG91cnMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgY29uc3QgbWludXRlcyA9IGRhdGUuZ2V0TWludXRlcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsKICAgICAgICByZXR1cm4gYCR7aG91cnN9OiR7bWludXRlc31gOwogICAgICB9CgogICAgICAvLyDkuIDlkajlhoXnmoTmtojmga/mmL7npLrmmJ/mnJ/lh6AKICAgICAgaWYgKGRpZmYgPCA3ICogMjQgKiA2MCAqIDYwICogMTAwMCkgewogICAgICAgIGNvbnN0IGRheXMgPSBbJ+WRqOaXpScsICflkajkuIAnLCAn5ZGo5LqMJywgJ+WRqOS4iScsICflkajlm5snLCAn5ZGo5LqUJywgJ+WRqOWFrSddOwogICAgICAgIHJldHVybiBkYXlzW2RhdGUuZ2V0RGF5KCldOwogICAgICB9CgogICAgICAvLyDmm7Tml6nnmoTmtojmga/mmL7npLrml6XmnJ8KICAgICAgcmV0dXJuIGAke2RhdGUuZ2V0TW9udGgoKSArIDF95pyIJHtkYXRlLmdldERhdGUoKX3ml6VgOwogICAgfTsKCiAgICAvLyDmoLzlvI/ljJbml6XmnJ8KICAgIGNvbnN0IGZvcm1hdERhdGUgPSB0aW1lc3RhbXAgPT4gewogICAgICBpZiAoIXRpbWVzdGFtcCkgcmV0dXJuICcnOwogICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodGltZXN0YW1wKTsKICAgICAgcmV0dXJuIGAke2RhdGUuZ2V0RnVsbFllYXIoKX0tJHsoZGF0ZS5nZXRNb250aCgpICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfS0ke2RhdGUuZ2V0RGF0ZSgpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX1gOwogICAgfTsKCiAgICAvLyDmoLzlvI/ljJbmlofku7blpKflsI8KICAgIGNvbnN0IGZvcm1hdEZpbGVTaXplID0gc2l6ZUluS0IgPT4gewogICAgICBpZiAoc2l6ZUluS0IgPCAxMDI0KSB7CiAgICAgICAgcmV0dXJuIGAke3NpemVJbktCfSBLQmA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGAkeyhzaXplSW5LQiAvIDEwMjQpLnRvRml4ZWQoMil9IE1CYDsKICAgICAgfQogICAgfTsKCiAgICAvLyDojrflj5bnirbmgIHmloflrZcKICAgIGNvbnN0IGdldFN0YXR1c1RleHQgPSBzdGF0dXMgPT4gewogICAgICBjb25zdCBzdGF0dXNNYXAgPSB7CiAgICAgICAgJ29ubGluZSc6ICflnKjnur8nLAogICAgICAgICdvZmZsaW5lJzogJ+emu+e6vycsCiAgICAgICAgJ2J1c3knOiAn5b+Z56KMJywKICAgICAgICAnYXdheSc6ICfnprvlvIAnCiAgICAgIH07CiAgICAgIHJldHVybiBzdGF0dXNNYXBbc3RhdHVzXSB8fCBzdGF0dXM7CiAgICB9OwoKICAgIC8vIOa3u+WKoOW8uuWItuWIt+aWsOaWueazlQogICAgY29uc3QgZm9yY2VSZWZyZXNoID0gYXN5bmMgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIEVsTWVzc2FnZS5pbmZvKCfmraPlnKjlvLrliLbliLfmlrDmlbDmja4uLi4nKTsKCiAgICAgICAgLy8g6YeN5paw6I635Y+W55So5oi35L+h5oGvCiAgICAgICAgY29uc3QgdXNlckRhdGEgPSBhd2FpdCBmZXRjaEN1cnJlbnRVc2VyKCk7CiAgICAgICAgaWYgKCF1c2VyRGF0YSkgewogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfml6Dms5Xojrflj5bnlKjmiLfkv6Hmga/vvIzor7flsJ3or5Xph43mlrDnmbvlvZUnKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIOmHjeaWsOWKoOi9veiBiuWkqeS8muivnQogICAgICAgIGF3YWl0IGxvYWRDaGF0U2Vzc2lvbnMoKTsKICAgICAgICBpZiAoY29udGFjdHMudmFsdWUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBFbE1lc3NhZ2Uud2FybmluZygn5pyq5om+5Yiw5Lu75L2V6IGK5aSp5Lya6K+d77yM5oKo5Y+v6IO96L+Y5rKh5pyJ5byA5aeL5Lu75L2V5a+56K+dJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCfliLfmlrDmiJDlip/vvIHmib7liLAgJyArIGNvbnRhY3RzLnZhbHVlLmxlbmd0aCArICcg5Liq6IGK5aSp5Lya6K+dJyk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+W8uuWItuWIt+aWsOWksei0pTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfliLfmlrDlpLHotKU6ICcgKyAoZXJyb3IubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJykpOwogICAgICB9CiAgICB9OwoKICAgIC8vIOWKoOi9veaJgOacieeUqOaItwogICAgY29uc3QgbG9hZEFsbFVzZXJzID0gYXN5bmMgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnNvbGUubG9nKCfmraPlnKjliqDovb3miYDmnInnlKjmiLfliJfooaguLi4nKTsKCiAgICAgICAgLy8g56Gu5L+d5bey6I635Y+W5b2T5YmN55So5oi35L+h5oGv5Y+K5YW25YWs5Y+4SUQKICAgICAgICBpZiAoIXVzZXJJbmZvLnZhbHVlIHx8ICF1c2VySW5mby52YWx1ZS5jb21wYW55KSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfml6Dms5XliqDovb3lkIzkuovliJfooajvvJrnvLrlsJHnlKjmiLfmiJblhazlj7jkv6Hmga/jgIInKTsKICAgICAgICAgIC8vIOWwneivlemHjeaWsOiOt+WPlueUqOaIt+S/oeaBrwogICAgICAgICAgY29uc3QgdXNlckRhdGEgPSBhd2FpdCBmZXRjaEN1cnJlbnRVc2VyKCk7CiAgICAgICAgICBpZiAoIXVzZXJEYXRhIHx8ICF1c2VyRGF0YS5jb21wYW55KSB7CiAgICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5peg5rOV6I635Y+W5oKo55qE5YWs5Y+45L+h5oGv77yM5peg5rOV5Yqg6L295ZCM5LqL5YiX6KGo44CCJyk7CiAgICAgICAgICAgIGFsbENvbGxlYWd1ZXMudmFsdWUgPSBbXTsgLy8g5riF56m65YiX6KGoCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc3QgY29tcGFueUlkID0gdXNlckluZm8udmFsdWUuY29tcGFueTsKICAgICAgICBjb25zb2xlLmxvZygn5byA5aeL6I635Y+W5YWs5Y+45ZCM5LqL5YiX6KGo77yM5YWs5Y+4SUQ6JywgY29tcGFueUlkKTsKCiAgICAgICAgLy8g5L2/55SoL2FwaS9hdXRoL2NvbnRhY3RzL+W5tuS8oOWFpeWFrOWPuElE5p2l6I635Y+W5ZCM5LqL5YiX6KGoCiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KHsKICAgICAgICAgIHVybDogJy9hcGkvYXV0aC9jb250YWN0cy8nLAogICAgICAgICAgbWV0aG9kOiAnZ2V0JywKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBjb21wYW55OiBjb21wYW55SWQKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBjb25zb2xlLmxvZygn5YWs5Y+45ZCM5LqL5YiX6KGoQVBJ5ZON5bqUOicsIHJlc3BvbnNlKTsKICAgICAgICBsZXQgdXNlcnMgPSBbXTsKICAgICAgICAvLyDmoLnmja7pgJrorq/lvZXpobXpnaLnmoTnu4/pqozvvIzlk43lupTlj6/og73lnKggcmVzcG9uc2UuZGF0YSDkuK0KICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2Uuc3VjY2VzcyAmJiBBcnJheS5pc0FycmF5KHJlc3BvbnNlLmRhdGEpKSB7CiAgICAgICAgICB1c2VycyA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZSAmJiBBcnJheS5pc0FycmF5KHJlc3BvbnNlLmRhdGEpKSB7CiAgICAgICAgICB1c2VycyA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZSAmJiBBcnJheS5pc0FycmF5KHJlc3BvbnNlKSkgewogICAgICAgICAgdXNlcnMgPSByZXNwb25zZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCfojrflj5blkIzkuovliJfooajnmoTlk43lupTmoLzlvI/mnKrnn6XmiJbmlbDmja7kuLrnqbo6JywgcmVzcG9uc2UpOwogICAgICAgIH0KICAgICAgICBpZiAodXNlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgY29uc29sZS5sb2coYOaIkOWKn+iOt+WPluWIsCAke3VzZXJzLmxlbmd0aH0g5Liq5ZCM5LqLYCk7CiAgICAgICAgICAvLyDlkI7nq6/ov5Tlm57nmoRjb250YWN0c+WPr+iDvemcgOimgeagvOW8j+WMluS7peWMuemFjWFsbENvbGxlYWd1ZXPnmoTmnJ/mnJvnu5PmnoQKICAgICAgICAgIGFsbENvbGxlYWd1ZXMudmFsdWUgPSB1c2Vycy5tYXAodSA9PiAoewogICAgICAgICAgICBpZDogdS5pZCwKICAgICAgICAgICAgdXNlcm5hbWU6IHUudXNlcm5hbWUsCiAgICAgICAgICAgIG5hbWU6IHUubmFtZSwKICAgICAgICAgICAgLy8g55u05o6l5L2/55So6YCa6K6v5b2V5o6l5Y+j5o+Q5L6b55qEbmFtZeWtl+autQogICAgICAgICAgICBkZXBhcnRtZW50OiB1LmRlcGFydG1lbnQsCiAgICAgICAgICAgIGF2YXRhcjogdS5hdmF0YXJfdXJsIHx8IHUuYXZhdGFyCiAgICAgICAgICB9KSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFsbENvbGxlYWd1ZXMudmFsdWUgPSBbXTsgLy8g5aaC5p6c5rKh5pyJ55So5oi377yM5YiZ5riF56m6CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WKoOi9veWFrOWPuOWQjOS6i+WIl+ihqOi/h+eoi+S4reWHuumUmTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfliqDovb3lkIzkuovliJfooajlpLHotKXvvIzor7fnqI3lkI7ph43or5XjgIInKTsKICAgICAgICBhbGxDb2xsZWFndWVzLnZhbHVlID0gW107IC8vIOWHuumUmeaXtua4heepuuWIl+ihqAogICAgICB9CiAgICB9OwoKICAgIC8vIOiOt+WPlumDqOmXqOWIl+ihqAogICAgY29uc3QgbG9hZERlcGFydG1lbnRzID0gYXN5bmMgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnNvbGUubG9nKCfmraPlnKjliqDovb3pg6jpl6jliJfooaguLi4nKTsKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoewogICAgICAgICAgdXJsOiAnL2FwaS9hdXRoL2RlcGFydG1lbnRzLycsCiAgICAgICAgICBtZXRob2Q6ICdnZXQnCiAgICAgICAgfSk7CiAgICAgICAgY29uc29sZS5sb2coJ+iOt+WPlumDqOmXqOWTjeW6lDonLCByZXNwb25zZSk7CgogICAgICAgIC8vIOWkhOeQhuWTjeW6lOaVsOaNrgogICAgICAgIGxldCBkZXB0cyA9IFtdOwogICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5yZXN1bHRzKSB7CiAgICAgICAgICBkZXB0cyA9IHJlc3BvbnNlLnJlc3VsdHM7CiAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHJlc3BvbnNlKSkgewogICAgICAgICAgZGVwdHMgPSByZXNwb25zZTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlc3BvbnNlLmRhdGEpKSB7CiAgICAgICAgICAgIGRlcHRzID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YS5yZXN1bHRzKSB7CiAgICAgICAgICAgIGRlcHRzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHRzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoZGVwdHMgJiYgZGVwdHMubGVuZ3RoID4gMCkgewogICAgICAgICAgY29uc29sZS5sb2coYOaIkOWKn+iOt+WPluWIsCR7ZGVwdHMubGVuZ3RofeS4qumDqOmXqGApOwogICAgICAgICAgZGVwYXJ0bWVudHMudmFsdWUgPSBkZXB0czsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W6YOo6Zeo5YiX6KGo5aSx6LSlOicsIGVycm9yKTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHNlbGVjdGVkRG9jdW1lbnRJZHMgPSByZWYoW10pOyAvLyDlvZPliY3kvJror53lhbPogZTmlofmoaNJRAoKICAgIC8vIEFJ5oC757uT55u45YWzCiAgICBjb25zdCBzdW1tYXJ5RGlhbG9nVmlzaWJsZSA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBzdW1tYXJ5RGF0ZVJhbmdlID0gcmVmKFtuZXcgRGF0ZShuZXcgRGF0ZSgpLnNldERhdGUobmV3IERhdGUoKS5nZXREYXRlKCkgLSA3KSksIG5ldyBEYXRlKCldKTsKICAgIGNvbnN0IHN1bW1hcnlDb250ZW50ID0gcmVmKCcnKTsKICAgIGNvbnN0IHN1bW1hcnlMb2FkaW5nID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IHBpY2tlck9wdGlvbnMgPSByZWYoewogICAgICBzaG9ydGN1dHM6IFt7CiAgICAgICAgdGV4dDogJ+acgOi/keS4gOWRqCcsCiAgICAgICAgb25DbGljayhwaWNrZXIpIHsKICAgICAgICAgIGNvbnN0IGVuZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICBzdGFydC5zZXRUaW1lKHN0YXJ0LmdldFRpbWUoKSAtIDM2MDAgKiAxMDAwICogMjQgKiA3KTsKICAgICAgICAgIHBpY2tlci4kZW1pdCgncGljaycsIFtzdGFydCwgZW5kXSk7CiAgICAgICAgfQogICAgICB9LCB7CiAgICAgICAgdGV4dDogJ+acgOi/keS4gOS4quaciCcsCiAgICAgICAgb25DbGljayhwaWNrZXIpIHsKICAgICAgICAgIGNvbnN0IGVuZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICBzdGFydC5zZXRUaW1lKHN0YXJ0LmdldFRpbWUoKSAtIDM2MDAgKiAxMDAwICogMjQgKiAzMCk7CiAgICAgICAgICBwaWNrZXIuJGVtaXQoJ3BpY2snLCBbc3RhcnQsIGVuZF0pOwogICAgICAgIH0KICAgICAgfSwgewogICAgICAgIHRleHQ6ICfmnIDov5HkuInkuKrmnIgnLAogICAgICAgIG9uQ2xpY2socGlja2VyKSB7CiAgICAgICAgICBjb25zdCBlbmQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZSgpOwogICAgICAgICAgc3RhcnQuc2V0VGltZShzdGFydC5nZXRUaW1lKCkgLSAzNjAwICogMTAwMCAqIDI0ICogOTApOwogICAgICAgICAgcGlja2VyLiRlbWl0KCdwaWNrJywgW3N0YXJ0LCBlbmRdKTsKICAgICAgICB9CiAgICAgIH1dCiAgICB9KTsKICAgIGNvbnN0IG9wZW5TdW1tYXJ5RGlhbG9nID0gKCkgPT4gewogICAgICAvLyDph43nva7lhoXlrrnvvIzkvYbkv53nlZnml6XmnJ/ojIPlm7QKICAgICAgc3VtbWFyeUNvbnRlbnQudmFsdWUgPSAnJzsKICAgICAgc3VtbWFyeURpYWxvZ1Zpc2libGUudmFsdWUgPSB0cnVlOwogICAgfTsKICAgIGNvbnN0IGhhbmRsZUNsb3NlU3VtbWFyeURpYWxvZyA9ICgpID0+IHsKICAgICAgc3VtbWFyeURpYWxvZ1Zpc2libGUudmFsdWUgPSBmYWxzZTsKICAgIH07CiAgICBjb25zdCBoYW5kbGVTdW1tYXJpemUgPSBhc3luYyAoKSA9PiB7CiAgICAgIGlmICghc2VsZWN0ZWRDb250YWN0LnZhbHVlKSB7CiAgICAgICAgRWxNZXNzYWdlLndhcm5pbmcoJ+ivt+WFiOmAieaLqeS4gOS4quiBiuWkqScpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoIXN1bW1hcnlEYXRlUmFuZ2UudmFsdWUgfHwgc3VtbWFyeURhdGVSYW5nZS52YWx1ZS5sZW5ndGggIT09IDIpIHsKICAgICAgICBFbE1lc3NhZ2Uud2FybmluZygn6K+36YCJ5oup5LiA5Liq5pyJ5pWI55qE5pe26Ze06IyD5Zu0Jyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHN1bW1hcnlMb2FkaW5nLnZhbHVlID0gdHJ1ZTsKICAgICAgc3VtbWFyeUNvbnRlbnQudmFsdWUgPSAnJzsgLy8gUmVzZXQgYmVmb3JlIGZldGNoaW5nCgogICAgICBjb25zdCBbc3RhcnREYXRlLCBlbmREYXRlXSA9IHN1bW1hcnlEYXRlUmFuZ2UudmFsdWU7CiAgICAgIHRyeSB7CiAgICAgICAgLy8gJ3N1bW1hcml6ZUNoYXQnIHJldHVybnMgdGhlIGZ1bGwgYXhpb3MgcmVzcG9uc2UKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHN1bW1hcml6ZUNoYXQoc2VsZWN0ZWRDb250YWN0LnZhbHVlLCBzdGFydERhdGUudG9JU09TdHJpbmcoKSwgZW5kRGF0ZS50b0lTT1N0cmluZygpKTsKCiAgICAgICAgLy8gVGhlIGFjdHVhbCBkYXRhIGZyb20gdGhlIGJhY2tlbmQgaXMgaW4gcmVzcG9uc2UuZGF0YQogICAgICAgIGNvbnN0IHN1bW1hcnkgPSByZXNwb25zZS5kYXRhLnN1bW1hcnk7CiAgICAgICAgaWYgKHN1bW1hcnkpIHsKICAgICAgICAgIC8vIElmIHdlIGhhdmUgYSBzdW1tYXJ5LCBkaXNwbGF5IGl0CiAgICAgICAgICBzdW1tYXJ5Q29udGVudC52YWx1ZSA9IHN1bW1hcnk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIElmIHRoZSBzdW1tYXJ5IGlzIGVtcHR5IG9yIG5vdCBwcmVzZW50LCBkaXNwbGF5IGEgY2xlYXIgbWVzc2FnZQogICAgICAgICAgc3VtbWFyeUNvbnRlbnQudmFsdWUgPSAn5Zyo6YCJ5a6a5pe26Ze06IyD5Zu05YaF5rKh5pyJ5Y+v5oC757uT55qE5raI5oGv77yM5oiWQUnmnKrog73nlJ/miJDmkZjopoHjgIInOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdTdW1tYXJpemF0aW9uIGVycm9yOicsIGVycm9yKTsKICAgICAgICBzdW1tYXJ5Q29udGVudC52YWx1ZSA9ICfnlJ/miJDmkZjopoHml7bpgYfliLDplJnor6/vvIzor7fmo4Dmn6XlkI7lj7Dml6Xlv5fmiJbnqI3lkI7lho3or5XjgIInOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign55Sf5oiQ5pGY6KaB5aSx6LSl77yM6K+356iN5ZCO5YaN6K+VJyk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgc3VtbWFyeUxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgfQogICAgfTsKCiAgICAvLyDmm7/mjaLlm77niYfpooTop4jmlrnms5UKICAgIGNvbnN0IGV4cGFuZGVkSW1hZ2UgPSByZWYobnVsbCk7CgogICAgLy8g5YiH5o2i5Zu+54mH5pS+5aSn5pi+56S6CiAgICBjb25zdCB0b2dnbGVJbWFnZUV4cGFuZCA9IGltYWdlVXJsID0+IHsKICAgICAgZXhwYW5kZWRJbWFnZS52YWx1ZSA9IGltYWdlVXJsOwogICAgfTsKICAgIGNvbnN0IGdldEZpbGVOYW1lID0gZnVsbE5hbWUgPT4gewogICAgICBpZiAoIWZ1bGxOYW1lKSByZXR1cm4gJyc7CiAgICAgIGNvbnN0IGxhc3REb3QgPSBmdWxsTmFtZS5sYXN0SW5kZXhPZignLicpOwogICAgICBpZiAobGFzdERvdCA9PT0gLTEgfHwgbGFzdERvdCA9PT0gMCkgewogICAgICAgIHJldHVybiBmdWxsTmFtZTsKICAgICAgfQogICAgICByZXR1cm4gZnVsbE5hbWUuc3Vic3RyaW5nKDAsIGxhc3REb3QpOwogICAgfTsKICAgIGNvbnN0IGdldEZpbGVFeHRlbnNpb24gPSBmdWxsTmFtZSA9PiB7CiAgICAgIGlmICghZnVsbE5hbWUpIHJldHVybiAnJzsKICAgICAgY29uc3QgbGFzdERvdCA9IGZ1bGxOYW1lLmxhc3RJbmRleE9mKCcuJyk7CiAgICAgIGlmIChsYXN0RG90ID09PSAtMSB8fCBsYXN0RG90ID09PSAwIHx8IGxhc3REb3QgPj0gZnVsbE5hbWUubGVuZ3RoIC0gMSkgewogICAgICAgIHJldHVybiAnJzsKICAgICAgfQogICAgICByZXR1cm4gZnVsbE5hbWUuc3Vic3RyaW5nKGxhc3REb3QpOyAvLyBpbmNsdWRlcyB0aGUgZG90CiAgICB9OwoKICAgIC8vIOWPs+mUruiPnOWNleebuOWFswogICAgY29uc3QgY29udGV4dE1lbnVWaXNpYmxlID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IGNvbnRleHRNZW51U3R5bGUgPSByZWYoewogICAgICB0b3A6ICcwcHgnLAogICAgICBsZWZ0OiAnMHB4JwogICAgfSk7CiAgICBjb25zdCBzZWxlY3RlZE1lc3NhZ2UgPSByZWYobnVsbCk7CgogICAgLy8g5aSE55CG5Y+z6ZSu6I+c5Y2V5omT5byACiAgICBjb25zdCBvcGVuQ29udGV4dE1lbnUgPSAoZXZlbnQsIG1lc3NhZ2UpID0+IHsKICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgLy8g5L+d5a2Y54K55Ye75L2N572uCiAgICAgIGNvbnRleHRNZW51U3R5bGUudmFsdWUgPSB7CiAgICAgICAgdG9wOiBgJHtldmVudC5jbGllbnRZfXB4YCwKICAgICAgICBsZWZ0OiBgJHtldmVudC5jbGllbnRYfXB4YAogICAgICB9OwogICAgICAvLyDkv53lrZjpgInkuK3nmoTmtojmga8KICAgICAgc2VsZWN0ZWRNZXNzYWdlLnZhbHVlID0gbWVzc2FnZTsKICAgICAgLy8g5pi+56S66I+c5Y2VCiAgICAgIGNvbnRleHRNZW51VmlzaWJsZS52YWx1ZSA9IHRydWU7CgogICAgICAvLyDmt7vliqDlhajlsYDngrnlh7vkuovku7bnm5HlkKzlmajlhbPpl63oj5zljZUKICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbG9zZUNvbnRleHRNZW51LCB7CiAgICAgICAgb25jZTogdHJ1ZQogICAgICB9KTsKICAgIH07CgogICAgLy8g5YWz6Zet5Y+z6ZSu6I+c5Y2VCiAgICBjb25zdCBjbG9zZUNvbnRleHRNZW51ID0gKCkgPT4gewogICAgICBjb250ZXh0TWVudVZpc2libGUudmFsdWUgPSBmYWxzZTsKICAgIH07CgogICAgLy8g5aSN5Yi25raI5oGv5YaF5a65CiAgICBjb25zdCBjb3B5TWVzc2FnZUNvbnRlbnQgPSAoKSA9PiB7CiAgICAgIGlmICghc2VsZWN0ZWRNZXNzYWdlLnZhbHVlKSByZXR1cm47CiAgICAgIGNvbnN0IGNvbnRlbnQgPSBzZWxlY3RlZE1lc3NhZ2UudmFsdWUuY29udGVudCB8fCAnJzsKICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoY29udGVudCkudGhlbigoKSA9PiB7CiAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+WGheWuueW3suWkjeWItuWIsOWJqui0tOadvycpOwogICAgICAgIGNsb3NlQ29udGV4dE1lbnUoKTsKICAgICAgfSkuY2F0Y2goZXJyID0+IHsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WkjeWItuWksei0pTogJyArIGVycik7CiAgICAgIH0pOwogICAgfTsKCiAgICAvLyDml6XnqIvlr7nor53moYbnm7jlhbMKICAgIGNvbnN0IGNhbGVuZGFyRGlhbG9nVmlzaWJsZSA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBpc0FuYWx5emluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBpc1N1Ym1pdHRpbmcgPSByZWYoZmFsc2UpOwogICAgY29uc3QgY2FsZW5kYXJGb3JtUmVmID0gcmVmKG51bGwpOyAvLyBSZWYgZm9yIHRoZSBmb3JtCiAgICBjb25zdCBjYWxlbmRhckV2ZW50ID0gcmVhY3RpdmUoewogICAgICB0aXRsZTogJycsCiAgICAgIHN0YXJ0OiAnJywKICAgICAgZW5kOiAnJywKICAgICAgbG9jYXRpb246ICcnLAogICAgICB0eXBlOiAnYmx1ZScsCiAgICAgIHJlbWluZGVyOiAnMzBtaW4nLAogICAgICBkZXNjcmlwdGlvbjogJycKICAgIH0pOwoKICAgIC8vIFZhbGlkYXRpb24gcnVsZXMgZm9yIHRoZSBjYWxlbmRhciBmb3JtCiAgICBjb25zdCBjYWxlbmRhclJ1bGVzID0gcmVhY3RpdmUoewogICAgICB0aXRsZTogW3sKICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICBtZXNzYWdlOiAn6K+36L6T5YWl5pel56iL5qCH6aKYJywKICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgfV0sCiAgICAgIHN0YXJ0OiBbewogICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgIG1lc3NhZ2U6ICfor7fpgInmi6nlvIDlp4vml7bpl7QnLAogICAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnCiAgICAgIH1dLAogICAgICBlbmQ6IFt7CiAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgbWVzc2FnZTogJ+ivt+mAieaLqee7k+adn+aXtumXtCcsCiAgICAgICAgdHJpZ2dlcjogJ2NoYW5nZScKICAgICAgfV0sCiAgICAgIGxvY2F0aW9uOiBbewogICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgIG1lc3NhZ2U6ICfor7fovpPlhaXlnLDngrknLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9XSwKICAgICAgdHlwZTogW3sKICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICBtZXNzYWdlOiAn6K+36YCJ5oup5pel56iL57G75Z6LJywKICAgICAgICB0cmlnZ2VyOiAnY2hhbmdlJwogICAgICB9XSwKICAgICAgcmVtaW5kZXI6IFt7CiAgICAgICAgcmVxdWlyZWQ6IHRydWUsCiAgICAgICAgbWVzc2FnZTogJ+ivt+mAieaLqeaPkOmGkuaXtumXtCcsCiAgICAgICAgdHJpZ2dlcjogJ2NoYW5nZScKICAgICAgfV0sCiAgICAgIGRlc2NyaXB0aW9uOiBbewogICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgIG1lc3NhZ2U6ICfor7fovpPlhaXmj4/ov7Dkv6Hmga8nLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9XQogICAgfSk7CgogICAgLy8g6Ieq5a6a5LmJ6aqM6K+B6KeE5YiZCiAgICBjb25zdCB2YWxpZGF0ZUVuZFRpbWUgPSAocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSA9PiB7CiAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICAvLyAncmVxdWlyZWQnIHJ1bGUgd2lsbCBoYW5kbGUgdGhpcwogICAgICAgIGNhbGxiYWNrKCk7CiAgICAgIH0gZWxzZSBpZiAoY2FsZW5kYXJFdmVudC5zdGFydCkgewogICAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKGNhbGVuZGFyRXZlbnQuc3RhcnQpOwogICAgICAgIGNvbnN0IGVuZERhdGUgPSBuZXcgRGF0ZSh2YWx1ZSk7CiAgICAgICAgaWYgKGVuZERhdGUgPD0gc3RhcnREYXRlKSB7CiAgICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoJ+e7k+adn+aXtumXtOW/hemhu+aZmuS6juW8gOWni+aXtumXtCcpKTsKICAgICAgICB9IGVsc2UgaWYgKHN0YXJ0RGF0ZS50b0RhdGVTdHJpbmcoKSAhPT0gZW5kRGF0ZS50b0RhdGVTdHJpbmcoKSkgewogICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKCflvIDlp4vlkoznu5PmnZ/ml7bpl7Tlv4XpobvmmK/lkIzkuIDlpKknKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNhbGxiYWNrKCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNhbGxiYWNrKCk7CiAgICAgIH0KICAgIH07CgogICAgLy8g55uR5ZCs5byA5aeL5pe26Ze05Y+Y5YyW77yM5Lul6Kem5Y+R57uT5p2f5pe26Ze055qE6aqM6K+BCiAgICB3YXRjaCgoKSA9PiBjYWxlbmRhckV2ZW50LnN0YXJ0LCBuZXdWYWx1ZSA9PiB7CiAgICAgIGlmIChuZXdWYWx1ZSAmJiBjYWxlbmRhckZvcm1SZWYudmFsdWUpIHsKICAgICAgICBjYWxlbmRhckZvcm1SZWYudmFsdWUudmFsaWRhdGVGaWVsZCgnZW5kJyk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIOabtOaWsOmqjOivgeinhOWImQogICAgY2FsZW5kYXJSdWxlcy5lbmQgPSBbewogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgbWVzc2FnZTogJ+ivt+mAieaLqee7k+adn+aXtumXtCcsCiAgICAgIHRyaWdnZXI6ICdjaGFuZ2UnCiAgICB9LCB7CiAgICAgIHZhbGlkYXRvcjogdmFsaWRhdGVFbmRUaW1lLAogICAgICB0cmlnZ2VyOiAnY2hhbmdlJwogICAgfV07CgogICAgLy8g5LuO5raI5oGv5re75Yqg5Yiw5pel56iLCiAgICBjb25zdCBhZGRUb0NhbGVuZGFyRnJvbU1lc3NhZ2UgPSBhc3luYyAoKSA9PiB7CiAgICAgIGlmICghc2VsZWN0ZWRNZXNzYWdlLnZhbHVlKSB7CiAgICAgICAgRWxNZXNzYWdlLndhcm5pbmcoJ+aXoOazleivhuWIq+a2iOaBrycpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpc0FuYWx5emluZy52YWx1ZSA9IHRydWU7CiAgICAgIGNhbGVuZGFyRGlhbG9nVmlzaWJsZS52YWx1ZSA9IHRydWU7CiAgICAgIHRyeSB7CiAgICAgICAgdmFyIF9yZXNwb25zZSRkYXRhOwogICAgICAgIGNvbnN0IG1lc3NhZ2VDb250ZW50ID0gc2VsZWN0ZWRNZXNzYWdlLnZhbHVlLmNvbnRlbnQ7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhbmFseXplRm9yQ2FsZW5kYXIobWVzc2FnZUNvbnRlbnQpOwogICAgICAgIGNvbnNvbGUubG9nKCdBSeaXpeeoi+WIhuaekOWTjeW6lDonLCByZXNwb25zZSk7CgogICAgICAgIC8vIOS/ruWkjeaVsOaNrue7k+aehOWkhOeQhuaWueW8jwogICAgICAgIGNvbnN0IGV2ZW50RGF0YSA9IChyZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9yZXNwb25zZSRkYXRhID0gcmVzcG9uc2UuZGF0YSkgPT09IG51bGwgfHwgX3Jlc3BvbnNlJGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yZXNwb25zZSRkYXRhLmRhdGEpIHx8IChyZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2UuZGF0YSk7CiAgICAgICAgaWYgKCFldmVudERhdGEgfHwgdHlwZW9mIGV2ZW50RGF0YSAhPT0gJ29iamVjdCcpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkFJ5YiG5p6Q5pyq6IO96L+U5Zue5pyJ5pWI55qE5pel56iL5pWw5o2u44CCIiwgcmVzcG9uc2UpOwogICAgICAgICAgRWxNZXNzYWdlLndhcm5pbmcoJ0FJ5pyq6IO96Ieq5Yqo6K+G5Yir5pel56iL77yM6K+35omL5Yqo5aGr5YaZ44CCJyk7CiAgICAgICAgICAvLyBQb3B1bGF0ZSB3aXRoIGRlZmF1bHQgdmFsdWVzIGZvciBtYW51YWwgZW50cnkKICAgICAgICAgIGNhbGVuZGFyRXZlbnQudGl0bGUgPSAnJzsKICAgICAgICAgIGNhbGVuZGFyRXZlbnQuc3RhcnQgPSBmb3JtYXREYXRlKG5ldyBEYXRlKCksICdZWVlZLU1NLUREIEhIOm1tOnNzJyk7CiAgICAgICAgICBjYWxlbmRhckV2ZW50LmVuZCA9IGZvcm1hdERhdGUobmV3IERhdGUoRGF0ZS5ub3coKSArIDYwICogNjAgKiAxMDAwKSwgJ1lZWVktTU0tREQgSEg6bW06c3MnKTsKICAgICAgICAgIGNhbGVuZGFyRXZlbnQubG9jYXRpb24gPSAnJzsKICAgICAgICAgIGNhbGVuZGFyRXZlbnQudHlwZSA9ICdibHVlJzsKICAgICAgICAgIGNhbGVuZGFyRXZlbnQucmVtaW5kZXIgPSAnMzBtaW4nOwogICAgICAgICAgY2FsZW5kYXJFdmVudC5kZXNjcmlwdGlvbiA9IG1lc3NhZ2VDb250ZW50IHx8ICcnOwogICAgICAgICAgY2FsZW5kYXJFdmVudC5pc19hbGxfZGF5ID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCdBSeaIkOWKn+ivhuWIq+aXpeeoi+aVsOaNrjonLCBldmVudERhdGEpOwogICAgICAgICAgLy8gUG9wdWxhdGUgd2l0aCBkYXRhIGZyb20gQUkKICAgICAgICAgIGNhbGVuZGFyRXZlbnQudGl0bGUgPSBldmVudERhdGEudGl0bGUgfHwgJyc7CiAgICAgICAgICBjYWxlbmRhckV2ZW50LnN0YXJ0ID0gZXZlbnREYXRhLnN0YXJ0IHx8IGZvcm1hdERhdGUobmV3IERhdGUoKSwgJ1lZWVktTU0tREQgSEg6bW06c3MnKTsKICAgICAgICAgIGNhbGVuZGFyRXZlbnQuZW5kID0gZXZlbnREYXRhLmVuZCB8fCBmb3JtYXREYXRlKG5ldyBEYXRlKERhdGUubm93KCkgKyA2MCAqIDYwICogMTAwMCksICdZWVlZLU1NLUREIEhIOm1tOnNzJyk7CiAgICAgICAgICBjYWxlbmRhckV2ZW50LmxvY2F0aW9uID0gZXZlbnREYXRhLmxvY2F0aW9uIHx8ICcnOwogICAgICAgICAgY2FsZW5kYXJFdmVudC50eXBlID0gZXZlbnREYXRhLnR5cGUgfHwgJ2JsdWUnOwogICAgICAgICAgY2FsZW5kYXJFdmVudC5yZW1pbmRlciA9IGV2ZW50RGF0YS5yZW1pbmRlciB8fCAnMzBtaW4nOwogICAgICAgICAgY2FsZW5kYXJFdmVudC5kZXNjcmlwdGlvbiA9IGV2ZW50RGF0YS5kZXNjcmlwdGlvbiB8fCBtZXNzYWdlQ29udGVudCB8fCAnJzsKICAgICAgICAgIGNhbGVuZGFyRXZlbnQuaXNfYWxsX2RheSA9IGV2ZW50RGF0YS5pc19hbGxfZGF5IHx8IGZhbHNlOwoKICAgICAgICAgIC8vIOa3u+WKoOWPguS4juiAheWkhOeQhgogICAgICAgICAgaWYgKGV2ZW50RGF0YS5wYXJ0aWNpcGFudHMgJiYgQXJyYXkuaXNBcnJheShldmVudERhdGEucGFydGljaXBhbnRzKSkgewogICAgICAgICAgICBjYWxlbmRhckV2ZW50LnBhcnRpY2lwYW50cyA9IGV2ZW50RGF0YS5wYXJ0aWNpcGFudHM7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjYWxlbmRhckV2ZW50LnBhcnRpY2lwYW50cyA9IHVzZXJJZC52YWx1ZSA/IFt1c2VySWQudmFsdWVdIDogW107CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHZhciBfc2VsZWN0ZWRNZXNzYWdlJHZhbHU7CiAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W5pel56iL5L+h5oGv5aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ0FJ5YiG5p6Q5aSx6LSl77yM6K+35omL5Yqo5aGr5YaZ5pel56iL44CCJyk7CiAgICAgICAgLy8gUG9wdWxhdGUgd2l0aCBkZWZhdWx0IHZhbHVlcyBvbiBBUEkgZXJyb3IKICAgICAgICBjYWxlbmRhckV2ZW50LnRpdGxlID0gJyc7CiAgICAgICAgY2FsZW5kYXJFdmVudC5zdGFydCA9IGZvcm1hdERhdGUobmV3IERhdGUoKSwgJ1lZWVktTU0tREQgSEg6bW06c3MnKTsKICAgICAgICBjYWxlbmRhckV2ZW50LmVuZCA9IGZvcm1hdERhdGUobmV3IERhdGUoRGF0ZS5ub3coKSArIDYwICogNjAgKiAxMDAwKSwgJ1lZWVktTU0tREQgSEg6bW06c3MnKTsKICAgICAgICBjYWxlbmRhckV2ZW50LmxvY2F0aW9uID0gJyc7CiAgICAgICAgY2FsZW5kYXJFdmVudC50eXBlID0gJ2JsdWUnOwogICAgICAgIGNhbGVuZGFyRXZlbnQucmVtaW5kZXIgPSAnMzBtaW4nOwogICAgICAgIGNhbGVuZGFyRXZlbnQuZGVzY3JpcHRpb24gPSAoKF9zZWxlY3RlZE1lc3NhZ2UkdmFsdSA9IHNlbGVjdGVkTWVzc2FnZS52YWx1ZSkgPT09IG51bGwgfHwgX3NlbGVjdGVkTWVzc2FnZSR2YWx1ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfc2VsZWN0ZWRNZXNzYWdlJHZhbHUuY29udGVudCkgfHwgJyc7CiAgICAgICAgY2FsZW5kYXJFdmVudC5pc19hbGxfZGF5ID0gZmFsc2U7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgaXNBbmFseXppbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICBjbG9zZUNvbnRleHRNZW51KCk7CiAgICAgIH0KICAgIH07CgogICAgLy8g5re75Yqg5pel56iLCiAgICBjb25zdCBzdWJtaXRDYWxlbmRhckV2ZW50ID0gYXN5bmMgKCkgPT4gewogICAgICBpZiAoIWNhbGVuZGFyRm9ybVJlZi52YWx1ZSkgcmV0dXJuOwogICAgICBhd2FpdCBjYWxlbmRhckZvcm1SZWYudmFsdWUudmFsaWRhdGUoYXN5bmMgdmFsaWQgPT4gewogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgaXNTdWJtaXR0aW5nLnZhbHVlID0gdHJ1ZTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IGV2ZW50RGF0YSA9IHsKICAgICAgICAgICAgICAuLi5jYWxlbmRhckV2ZW50CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmICghZXZlbnREYXRhLnBhcnRpY2lwYW50cykgewogICAgICAgICAgICAgIGV2ZW50RGF0YS5wYXJ0aWNpcGFudHMgPSBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodXNlcklkLnZhbHVlICYmICFldmVudERhdGEucGFydGljaXBhbnRzLmluY2x1ZGVzKHVzZXJJZC52YWx1ZSkpIHsKICAgICAgICAgICAgICBldmVudERhdGEucGFydGljaXBhbnRzLnB1c2godXNlcklkLnZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhd2FpdCBjcmVhdGVDYWxlbmRhckV2ZW50KGV2ZW50RGF0YSk7CiAgICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCfml6XnqIvmt7vliqDmiJDlip8nKTsKICAgICAgICAgICAgY2FsZW5kYXJEaWFsb2dWaXNpYmxlLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICB2YXIgX2Vycm9yJHJlc3BvbnNlLCBfZXJyb3IkcmVzcG9uc2UkZGF0YTsKICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfmt7vliqDml6XnqIvlpLHotKU6ICcgKyAoKChfZXJyb3IkcmVzcG9uc2UgPSBlcnJvci5yZXNwb25zZSkgPT09IG51bGwgfHwgX2Vycm9yJHJlc3BvbnNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2Vycm9yJHJlc3BvbnNlJGRhdGEgPSBfZXJyb3IkcmVzcG9uc2UuZGF0YSkgPT09IG51bGwgfHwgX2Vycm9yJHJlc3BvbnNlJGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lcnJvciRyZXNwb25zZSRkYXRhLmVycm9yKSB8fCBlcnJvci5tZXNzYWdlKSk7CiAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpc1N1Ym1pdHRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfor7floavlhpnmiYDmnInlv4XloavpobknKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKCiAgICAvLyDlhajlsYDngrnlh7vkuovku7bnm5HlkKwgLSDnlKjkuo7lpITnkIbnu4Tku7blpJbpg6jngrnlh7vlhbPpl63lj7PplK7oj5zljZUKICAgIG9uTW91bnRlZCgoKSA9PiB7CiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZXZlbnQgPT4gewogICAgICAgIC8vIOWmguaenOeCueWHu+S9jee9ruS4jeWcqOWPs+mUruiPnOWNleWGhe+8jOWFs+mXreiPnOWNlQogICAgICAgIGlmIChjb250ZXh0TWVudVZpc2libGUudmFsdWUpIHsKICAgICAgICAgIGNvbnN0IG1lbnVFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jaGF0LWNvbnRleHQtbWVudScpOwogICAgICAgICAgaWYgKG1lbnVFbCAmJiAhbWVudUVsLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHsKICAgICAgICAgICAgY29udGV4dE1lbnVWaXNpYmxlLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogICAgcmV0dXJuIHsKICAgICAgc2VhcmNoUXVlcnksCiAgICAgIGFjdGl2ZVRhYiwKICAgICAgc2VsZWN0ZWRDb250YWN0LAogICAgICB0YWJzLAogICAgICBjb250YWN0cywKICAgICAgY3VycmVudENvbnRhY3QsCiAgICAgIGZpbHRlcmVkQ29udGFjdHMsCiAgICAgIG1lc3NhZ2VzLAogICAgICBtZXNzYWdlSW5wdXQsCiAgICAgIG1lc3NhZ2VDb250YWluZXIsCiAgICAgIGZpbGVJbnB1dCwKICAgICAgaW1hZ2VJbnB1dCwKICAgICAgY3VycmVudFVzZXIsCiAgICAgIHVzZXJJbmZvLAogICAgICB1c2VySWQsCiAgICAgIGtub3dsZWRnZURpYWxvZ1Zpc2libGUsCiAgICAgIGtub3dsZWRnZUxvYWRpbmcsCiAgICAgIGtub3dsZWRnZUxpc3QsCiAgICAgIHNlc3Npb25zTG9hZGluZywKICAgICAgbWVzc2FnZXNMb2FkaW5nLAogICAgICAvLyDlm77moIcKICAgICAgU2VhcmNoLAogICAgICBEb2N1bWVudCwKICAgICAgUGljdHVyZUZpbGxlZCwKICAgICAgRm9sZGVyT3BlbmVkLAogICAgICBNaWNyb3Bob25lLAogICAgICBQb3NpdGlvbiwKICAgICAgQ2hhdERvdFNxdWFyZSwKICAgICAgUmVhZGluZywKICAgICAgVXNlckZpbGxlZCwKICAgICAgQ2hhdExpbmVTcXVhcmUsCiAgICAgIFJlZnJlc2gsCiAgICAgIC8vIOaWueazlQogICAgICBzZW5kTWVzc2FnZSwKICAgICAgZ2V0U3RhdHVzVGV4dCwKICAgICAgc2VsZWN0Q29udGFjdCwKICAgICAgb3BlbkZpbGVVcGxvYWQsCiAgICAgIG9wZW5JbWFnZVVwbG9hZCwKICAgICAgaGFuZGxlRmlsZVVwbG9hZCwKICAgICAgaGFuZGxlSW1hZ2VVcGxvYWQsCiAgICAgIG9wZW5Lbm93bGVkZ2VEaWFsb2csCiAgICAgIHNlbGVjdEtub3dsZWRnZSwKICAgICAgc2hhcmVLbm93bGVkZ2UsCiAgICAgIGRvd25sb2FkRmlsZSwKICAgICAgdmlld0tub3dsZWRnZSwKICAgICAgZ2V0U2VuZGVyQ29sb3IsCiAgICAgIGdldFNlbmRlckluaXRpYWwsCiAgICAgIGZvcm1hdE1lc3NhZ2VUaW1lLAogICAgICBmb3JtYXREYXRlLAogICAgICBmb3JtYXRGaWxlU2l6ZSwKICAgICAgcmVmcmVzaENoYXRTZXNzaW9ucywKICAgICAgZm9yY2VSZWZyZXNoLAogICAgICBncm91cGVkVXNlcnNCeURlcGFydG1lbnQsCiAgICAgIGdldEFjdGl2ZUNvbnRhY3RzLAogICAgICBsb2FkQWxsVXNlcnMsCiAgICAgIGxvYWREZXBhcnRtZW50cywKICAgICAgc2VsZWN0ZWREb2N1bWVudElkcywKICAgICAgZmlsZVVwbG9hZGluZywKICAgICAgaW1hZ2VVcGxvYWRpbmcsCiAgICAgIHN1bW1hcnlEaWFsb2dWaXNpYmxlLAogICAgICBzdW1tYXJ5RGF0ZVJhbmdlLAogICAgICBzdW1tYXJ5Q29udGVudCwKICAgICAgc3VtbWFyeUxvYWRpbmcsCiAgICAgIHBpY2tlck9wdGlvbnMsCiAgICAgIG9wZW5TdW1tYXJ5RGlhbG9nLAogICAgICBoYW5kbGVDbG9zZVN1bW1hcnlEaWFsb2csCiAgICAgIGhhbmRsZVN1bW1hcml6ZSwKICAgICAgZXhwYW5kZWRJbWFnZSwKICAgICAgdG9nZ2xlSW1hZ2VFeHBhbmQsCiAgICAgIGdldEZpbGVOYW1lLAogICAgICBnZXRGaWxlRXh0ZW5zaW9uLAogICAgICBjb250ZXh0TWVudVZpc2libGUsCiAgICAgIGNvbnRleHRNZW51U3R5bGUsCiAgICAgIG9wZW5Db250ZXh0TWVudSwKICAgICAgY29weU1lc3NhZ2VDb250ZW50LAogICAgICBhZGRUb0NhbGVuZGFyRnJvbU1lc3NhZ2UsCiAgICAgIGNhbGVuZGFyRGlhbG9nVmlzaWJsZSwKICAgICAgY2FsZW5kYXJFdmVudCwKICAgICAgaXNBbmFseXppbmcsCiAgICAgIGlzU3VibWl0dGluZywKICAgICAgc3VibWl0Q2FsZW5kYXJFdmVudCwKICAgICAgY2FsZW5kYXJGb3JtUmVmLAogICAgICBjYWxlbmRhclJ1bGVzCiAgICB9OwogIH0KfTs="},{"version":3,"names":["ref","reactive","computed","nextTick","onMounted","onBeforeUnmount","watch","useStore","useRoute","ElMessage","ElMessageBox","Search","Refresh","ChatDotSquare","UserFilled","ChatLineSquare","PictureFilled","FolderOpened","Reading","Microphone","Position","Document","Calendar","DocumentCopy","getChatSessions","getChatSession","sendTextMessage","sendImageMessage","sendKnowledgeMessage","downloadMessageFile","sendFileMessage","summarizeChat","analyzeForCalendar","createCalendarEvent","getKnowledgeList","formatDate","request","aiChatWithDocuments","name","components","setup","store","currentUser","getters","user","userInfo","searchQuery","activeTab","selectedContact","messageInput","messageContainer","fileInput","imageInput","messages","sessionsLoading","messagesLoading","chatSessions","currentChatId","knowledgeDialogVisible","knowledgeLoading","knowledgeList","selectedKnowledge","tabs","contacts","allColleagues","departments","currentContact","value","find","c","id","userId","_userInfo$value","filteredContacts","filter","contact","toLowerCase","includes","getActiveContacts","isGroup","groupedUsersByDepartment","usersMap","Map","forEach","set","colleague","has","username","trim","initial","avatar","color","getRandomColor","status","lastMessage","lastTime","unread","department","departmentMap","map","dept","groupedUsers","Array","from","values","departmentName","get","push","route","refreshInterval","clearInterval","userData","fetchCurrentUser","error","console","log","loadAllUsers","loadDepartments","loadChatSessions","sessionId","query","session","foundContact","parseInt","loadChatMessages","setInterval","scrollToBottom","message","token","localStorage","getItem","warn","warning","response","url","method","data","Error","setItem","JSON","stringify","isBackgroundRefresh","success","isArray","results","length","otherParticipant","participants","p","is_group","title","avatar_url","last_message","content","formatMessageTime","created_at","updated_at","unread_count","startsWith","process","env","VUE_APP_BASE_API","first_name","last_name","sort","a","b","chatId","messageData","sessionData","possibleMessageFields","field","sender","some","tempContact","unshift","res","params","chat","selectedDocumentIds","doc","e","errorMessage","refreshChatSessions","scrollTop","scrollHeight","selectContact","contactId","replace","existingChat","participant_ids","newSession","Date","sendMessage","tempMessage","now","message_type","toISOString","is_temp","messageCopy","aiMsg","chat_id","document_ids","aiContent","tempIndex","findIndex","m","splice","file","savedMessage","openFileUpload","click","openImageUpload","fileUploading","imageUploading","handleFileUpload","event","target","files","formData","FormData","append","headers","docRes","handleImageUpload","type","maxSize","size","openKnowledgeDialog","loadKnowledgeList","selectKnowledge","row","shareKnowledge","knowledge","downloadFile","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","file_name","body","appendChild","removeChild","viewKnowledge","knowledge_detail","alert","description","dangerouslyUseHTMLString","confirmButtonText","getSenderColor","getSenderInitial","colors","index","timestamp","date","diff","hours","getHours","toString","padStart","minutes","getMinutes","days","getDay","getMonth","getDate","getFullYear","formatFileSize","sizeInKB","toFixed","getStatusText","statusMap","forceRefresh","info","company","companyId","users","u","depts","summaryDialogVisible","summaryDateRange","setDate","summaryContent","summaryLoading","pickerOptions","shortcuts","text","onClick","picker","end","start","setTime","getTime","$emit","openSummaryDialog","handleCloseSummaryDialog","handleSummarize","startDate","endDate","summary","expandedImage","toggleImageExpand","imageUrl","getFileName","fullName","lastDot","lastIndexOf","substring","getFileExtension","contextMenuVisible","contextMenuStyle","top","left","selectedMessage","openContextMenu","preventDefault","clientY","clientX","addEventListener","closeContextMenu","once","copyMessageContent","navigator","clipboard","writeText","then","catch","err","calendarDialogVisible","isAnalyzing","isSubmitting","calendarFormRef","calendarEvent","location","reminder","calendarRules","required","trigger","validateEndTime","rule","callback","toDateString","newValue","validateField","validator","addToCalendarFromMessage","_response$data","messageContent","eventData","is_all_day","_selectedMessage$valu","submitCalendarEvent","validate","valid","_error$response","_error$response$data","menuEl","querySelector","contains"],"sources":["C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\chat\\Index.vue"],"sourcesContent":["<template>\n  <div class=\"chat-container\">\n        <el-card class=\"chat-card\" :body-style=\"{backgroundColor: 'transparent', padding: 0}\">\n          <div class=\"chat-header-actions\" v-if=\"sessionsLoading\">\n            <el-alert\n              title=\"正在加载数据...\"\n              type=\"info\"\n              :closable=\"false\"\n              show-icon\n            />\n          </div>\n          <div class=\"chat-layout\">\n            <!-- 左侧联系人列表 -->\n            <div class=\"chat-sidebar\">\n              <!-- 搜索框 -->\n              <div class=\"search-box\">\n                <div class=\"search-header\">\n                  <el-input \n                    v-model=\"searchQuery\" \n                    placeholder=\"搜索联系人...\"\n                    clearable\n                    :prefix-icon=\"Search\"\n                  ></el-input>\n                  <el-button circle size=\"small\" @click=\"refreshChatSessions\" title=\"刷新列表\">\n                    <el-icon><Refresh /></el-icon>\n                  </el-button>\n                </div>\n              </div>\n              \n              <!-- 聊天标签页 -->\n              <div class=\"chat-tabs\">\n                <div \n                  v-for=\"(tab, index) in tabs\" \n                  :key=\"index\"\n                  class=\"chat-tab\"\n                  :class=\"{'active': activeTab === index}\"\n                  @click=\"activeTab = index\"\n                >\n                  {{ tab }}\n                </div>\n              </div>\n              \n              <!-- 联系人列表 -->\n              <div class=\"contacts-list\">\n                <!-- 部门分组显示 (仅在同事标签页显示) -->\n                <template v-if=\"activeTab === 1\">\n                  <div v-if=\"!sessionsLoading && Object.keys(groupedUsersByDepartment).length > 0\">\n                    <div v-for=\"(departmentUsers, deptName) in groupedUsersByDepartment\" :key=\"deptName\" class=\"department-group\">\n                      <div class=\"department-header\">{{ deptName }}</div>\n                      <div \n                        v-for=\"contact in departmentUsers\" \n                        :key=\"contact.id\"\n                        class=\"contact-item\"\n                        :class=\"{'active': selectedContact === contact.id}\"\n                        @click=\"selectContact(contact)\"\n                      >\n                        <div class=\"contact-avatar\">\n                          <div \n                            v-if=\"!contact.avatar && !contact.avatar_url\" \n                            class=\"avatar\" \n                            :style=\"{backgroundColor: contact.color}\"\n                          >\n                            <span class=\"avatar-initial\">{{ contact.initial }}</span>\n                          </div>\n                          <img v-else :src=\"contact.avatar_url || contact.avatar\" alt=\"avatar\" class=\"avatar\" />\n                          <div \n                            class=\"contact-status\" \n                            :class=\"'status-' + contact.status\"\n                          ></div>\n                        </div>\n                        <div class=\"contact-info\">\n                          <div class=\"contact-name\">\n                            <span>{{ contact.name }}</span>\n                            <span class=\"time\">{{ contact.lastTime }}</span>\n                          </div>\n                          <div class=\"contact-message\">\n                            <span>{{ contact.lastMessage }}</span>\n                            <el-badge \n                              v-if=\"contact.unread\" \n                              :value=\"contact.unread\" \n                              class=\"message-badge\"\n                            />\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div v-else-if=\"!sessionsLoading\" class=\"loading-container\">\n                    <el-skeleton :rows=\"5\" animated />\n                  </div>\n                </template>\n                \n                <!-- 最近聊天标签页 -->\n                <template v-else>\n                  <div \n                    v-for=\"contact in filteredContacts\" \n                    :key=\"contact.id\"\n                    class=\"contact-item\"\n                    :class=\"{'active': selectedContact === contact.id}\"\n                    @click=\"selectContact(contact)\"\n                  >\n                    <div class=\"contact-avatar\">\n                      <div \n                        v-if=\"!contact.avatar && !contact.avatar_url\" \n                        class=\"avatar\" \n                        :style=\"{backgroundColor: contact.color}\"\n                      >\n                        <span class=\"avatar-initial\">{{ contact.initial }}</span>\n                      </div>\n                      <img v-else :src=\"contact.avatar_url || contact.avatar\" alt=\"avatar\" class=\"avatar\" />\n                      <div \n                        class=\"contact-status\" \n                        :class=\"'status-' + contact.status\"\n                      ></div>\n                    </div>\n                    <div class=\"contact-info\">\n                      <div class=\"contact-name\">\n                        <span>{{ contact.name }}</span>\n                        <span class=\"time\">{{ contact.lastTime }}</span>\n                      </div>\n                      <div class=\"contact-message\">\n                        <span>{{ contact.lastMessage }}</span>\n                        <el-badge \n                          v-if=\"contact.unread\" \n                          :value=\"contact.unread\" \n                          class=\"message-badge\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <!-- 在最近聊天标签页，如果没有聊天记录，显示提示 -->\n                  <div v-if=\"!sessionsLoading && filteredContacts.length === 0\" class=\"empty-contacts\">\n                    <el-empty \n                      description=\"暂无联系人\" \n                      :image-size=\"100\"\n                    >\n                      <template #image>\n                        <el-icon :size=\"64\" class=\"empty-icon\"><UserFilled /></el-icon>\n                      </template>\n                    </el-empty>\n                  </div>\n                </template>\n\n                <!-- 无联系人提示 -->\n                <div v-if=\"sessionsLoading\" class=\"loading-container\">\n                  <el-skeleton :rows=\"5\" animated />\n                </div>\n              </div>\n            </div>\n            \n            <!-- 右侧聊天内容 -->\n            <div class=\"chat-content\">\n              <!-- 聊天头部 -->\n              <div class=\"chat-header\" v-if=\"selectedContact !== null\">\n                <div class=\"contact-avatar\">\n                  <div \n                    v-if=\"!currentContact.avatar && !currentContact.avatar_url\" \n                    class=\"avatar\" \n                    :style=\"{backgroundColor: currentContact.color}\"\n                  >\n                    <span class=\"avatar-initial\">{{ currentContact.initial || '?' }}</span>\n                  </div>\n                  <img \n                    v-else \n                    :src=\"currentContact.avatar_url || currentContact.avatar\" \n                    alt=\"avatar\" \n                    class=\"avatar\" \n                  />\n                  <div \n                    class=\"contact-status\" \n                    :class=\"'status-' + (currentContact.status || 'online')\"\n                  ></div>\n                </div>\n                <div class=\"contact-info\">\n              <h6>{{ currentContact.name || '未命名联系人' }}</h6>\n              <p>{{ getStatusText(currentContact.status || 'online') }}</p>\n                </div>\n                <div class=\"chat-actions\">\n                  <el-tooltip content=\"AI总结\" placement=\"bottom\">\n                    <el-button @click=\"openSummaryDialog\" circle>\n                      <el-icon><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-robot\" viewBox=\"0 0 16 16\">\n                        <path d=\"M6 12.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5M3 8.062C3 6.76 4.235 5.765 5.53 5.886a26.6 26.6 0 0 0 4.94 0C11.765 5.765 13 6.76 13 8.062v1.157a.93.93 0 0 1-.765.935c-.845.147-2.34.346-4.235.346s-3.39-.2-4.235-.346A.93.93 0 0 1 3 9.22z\"/>\n                        <path d=\"M4 1.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5M12 1a2 2 0 0 1 2 2v10.5a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2zM4 0a1 1 0 0 0-1 1v10.5a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1z\"/>\n                      </svg></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                </div>\n              </div>\n              \n              <!-- 聊天消息区域 -->\n              <div class=\"chat-messages\" v-if=\"selectedContact !== null\" ref=\"messageContainer\">\n                <!-- 有消息时显示消息列表 -->\n                <template v-if=\"messages.length > 0\">\n                  <div \n                    v-for=\"(message, index) in messages\" \n                    :key=\"message.id || index\"\n                    class=\"message\"\n                    :class=\"message.sender.id === userId ? 'message-sent' : 'message-received'\"\n                  >\n                    <div class=\"message-container\">\n                      <div v-if=\"message.sender.id !== userId\" class=\"message-avatar\">\n                        <div \n                          v-if=\"!message.sender.avatar && !message.sender.avatar_url\" \n                          class=\"avatar small\" \n                          :style=\"{backgroundColor: getSenderColor(message.sender)}\"\n                        >\n                          <span class=\"avatar-initial\">{{ getSenderInitial(message.sender) }}</span>\n                        </div>\n                        <img \n                          v-else \n                          :src=\"message.sender.avatar_url || message.sender.avatar\" \n                          alt=\"avatar\" \n                          class=\"avatar small\" \n                        />\n                      </div>\n                      <div class=\"message-content-wrapper\" @contextmenu.prevent=\"openContextMenu($event, message)\">\n                        <div \n                          class=\"message-content\"\n                          :class=\"message.sender.id === userId ? 'sent' : 'received'\"\n                        >\n                          <div v-if=\"message.message_type === 'text'\" class=\"text-card\">\n                            <div class=\"text-card-inner\">\n                              {{ message.content }}\n                            </div>\n                          </div>\n                      \n                          <div v-else-if=\"message.message_type === 'image'\" class=\"image-card\">\n                            <div class=\"image-card-inner\">\n                              <div class=\"image-preview\" @click=\"toggleImageExpand(message.file)\">\n                                <img :src=\"message.file\" alt=\"image\" />\n                              </div>\n                            </div>\n                          </div>\n                      \n                          <div v-else-if=\"message.message_type === 'file'\" class=\"file-card\" @click=\"downloadFile(message)\">\n                            <div class=\"file-card-inner\">\n                              <div class=\"file-icon\">\n                                <el-icon><Document /></el-icon>\n                              </div>\n                              <div class=\"file-info\">\n                                <div class=\"file-name\">\n                                  <span class=\"file-name-main\">{{ getFileName(message.file_name) }}</span><!--\n                                --><span class=\"file-name-ext\">{{ getFileExtension(message.file_name) }}</span>\n                                </div>\n                                <div class=\"file-meta\">\n                                  <span class=\"file-size\">{{ formatFileSize(message.file_size) }}</span>\n                                  <span class=\"file-download-hint\">点击下载</span>\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                      \n                          <div v-else-if=\"message.message_type === 'knowledge'\" class=\"knowledge-card\" @click=\"viewKnowledge(message)\">\n                            <div class=\"knowledge-card-inner\">\n                              <div class=\"knowledge-icon\">\n                                <el-icon><Reading /></el-icon>\n                              </div>\n                              <div class=\"knowledge-content\">\n                                <div class=\"knowledge-title\">{{ message.knowledge_detail.title }}</div>\n                                <div class=\"knowledge-desc\">{{ message.knowledge_detail.description }}</div>\n                                <div class=\"knowledge-footer\">\n                                  <span class=\"knowledge-type\">{{ message.knowledge_detail.file_type }}</span>\n                                  <span class=\"knowledge-view\">查看详情</span>\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                        <div class=\"message-time\">{{ formatMessageTime(message.created_at) }}</div>\n                      </div>\n                    </div>\n                  </div>\n                </template>\n                \n                <!-- 没有消息时显示空提示 -->\n                <template v-else-if=\"!messagesLoading\">\n                  <div class=\"empty-messages\">\n                    <el-empty description=\"暂无消息记录\">\n                      <template #image>\n                        <el-icon :size=\"64\" class=\"empty-icon\"><ChatLineSquare /></el-icon>\n                      </template>\n                      <p>发送第一条消息开始对话吧</p>\n                    </el-empty>\n                  </div>\n                </template>\n                \n                <!-- 加载中显示骨架屏 -->\n                <template v-else>\n                  <div class=\"loading-messages\">\n                    <el-skeleton :rows=\"3\" animated />\n                    <el-skeleton style=\"margin-top: 20px\" :rows=\"2\" animated />\n                    <div style=\"text-align: right; margin-top: 20px\">\n                      <el-skeleton :rows=\"2\" animated />\n                    </div>\n                  </div>\n                </template>\n              </div>\n              \n              <!-- 聊天输入框 -->\n              <div class=\"chat-input\" v-if=\"selectedContact !== null\">\n                <div class=\"chat-tools\">\n                  <el-tooltip content=\"发送图片\" placement=\"top\">\n                    <el-button circle @click=\"openImageUpload\" :loading=\"imageUploading\">\n                      <el-icon><PictureFilled /></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                  <el-tooltip content=\"发送文件\" placement=\"top\">\n                    <el-button circle @click=\"openFileUpload\" :loading=\"fileUploading\">\n                      <el-icon><FolderOpened /></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                  <!-- <el-tooltip content=\"分享知识库文件\" placement=\"top\">\n                    <el-button circle @click=\"openKnowledgeDialog\">\n                      <el-icon><Reading /></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                  <el-tooltip content=\"语音消息\" placement=\"top\">\n                    <el-button circle>\n                      <el-icon><Microphone /></el-icon>\n                    </el-button>\n                  </el-tooltip> -->\n                </div>\n                <div class=\"input-area\">\n                  <el-input\n                    v-model=\"messageInput\"\n                    type=\"textarea\"\n                    :rows=\"3\"\n                    placeholder=\"输入消息...\"\n                    resize=\"none\"\n                    @keyup.enter.prevent=\"sendMessage\"\n                  ></el-input>\n                </div>\n                <div class=\"send-button\">\n                  <el-button type=\"primary\" @click=\"sendMessage\">\n                    <el-icon><Position /></el-icon>\n                    发送\n                  </el-button>\n                </div>\n              </div>\n              \n              <!-- 无选中联系人提示 -->\n              <div class=\"empty-chat\" v-if=\"selectedContact === null\">\n                <div class=\"empty-illustration\">\n                  <el-icon :size=\"64\"><ChatDotSquare /></el-icon>\n                </div>\n                <h4>选择一个联系人开始聊天</h4>\n                <p>从左侧列表选择联系人开始对话</p>\n              </div>\n            </div>\n          </div>\n        </el-card>\n  \n  <!-- 隐藏的文件上传输入 -->\n  <input \n    type=\"file\" \n    ref=\"fileInput\" \n    style=\"display: none\" \n    @change=\"handleFileUpload\" \n  />\n  \n  <!-- 隐藏的图片上传输入 -->\n  <input \n    type=\"file\" \n    ref=\"imageInput\" \n    style=\"display: none\" \n    accept=\"image/*\" \n    @change=\"handleImageUpload\" \n  />\n  \n  <!-- 知识库选择对话框 -->\n  <el-dialog\n    v-model=\"knowledgeDialogVisible\"\n    title=\"选择知识库文件\"\n    width=\"50%\"\n  >\n    <el-table\n      v-loading=\"knowledgeLoading\"\n      :data=\"knowledgeList\"\n      style=\"width: 100%\"\n      @row-click=\"selectKnowledge\"\n    >\n      <el-table-column prop=\"title\" label=\"标题\"></el-table-column>\n      <el-table-column prop=\"file_type\" label=\"类型\">\n        <template #default=\"scope\">\n          <el-tag>{{ scope.row.file_type }}</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"created_at\" label=\"创建时间\">\n        <template #default=\"scope\">\n          {{ formatDate(scope.row.created_at) }}\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\">\n        <template #default=\"scope\">\n          <el-button type=\"primary\" size=\"small\" @click.stop=\"shareKnowledge(scope.row)\">\n            分享\n          </el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"knowledgeDialogVisible = false\">取消</el-button>\n      </span>\n    </template>\n  </el-dialog>\n\n  <!-- AI总结对话框 -->\n  <el-dialog\n    v-model=\"summaryDialogVisible\"\n    title=\"AI 聊天总结\"\n    width=\"50%\"\n    @close=\"handleCloseSummaryDialog\"\n    top=\"5vh\"\n  >\n    <div v-loading=\"summaryLoading\" element-loading-text=\"正在生成摘要，请稍候...\">\n      <el-form label-position=\"top\" style=\"margin-bottom: 20px;\">\n        <el-form-item label=\"选择要总结的消息时间范围\">\n          <el-date-picker\n            v-model=\"summaryDateRange\"\n            type=\"datetimerange\"\n            range-separator=\"至\"\n            start-placeholder=\"开始日期\"\n            end-placeholder=\"结束日期\"\n            :picker-options=\"pickerOptions\"\n            style=\"width: 100%;\"\n          />\n        </el-form-item>\n      </el-form>\n      <div v-if=\"summaryContent\" class=\"summary-content-wrapper\">\n        <el-alert title=\"AI 总结要点\" type=\"info\" :closable=\"false\" show-icon class=\"summary-title\"></el-alert>\n        <div class=\"summary-content\">\n          <p style=\"white-space: pre-wrap;\">{{ summaryContent }}</p>\n        </div>\n      </div>\n       <el-empty v-if=\"!summaryContent && !summaryLoading\" description=\"暂无摘要，请选择时间范围后点击\" />\n    </div>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"handleCloseSummaryDialog\">关闭</el-button>\n        <el-button type=\"primary\" @click=\"handleSummarize\" :disabled=\"summaryLoading\">\n          {{ summaryLoading ? '生成中...' : '生成摘要' }}\n        </el-button>\n      </span>\n    </template>\n  </el-dialog>\n\n  <!-- 替换图片预览对话框为内联展示 -->\n  <div class=\"fullscreen-image-preview\" v-if=\"expandedImage\" @click=\"expandedImage = null\">\n    <img :src=\"expandedImage\" alt=\"预览图片\" class=\"fullscreen-preview-image\" />\n  </div>\n  \n  <!-- 移除原有的图片预览对话框 -->\n  <!-- <el-dialog\n    v-model=\"imagePreviewVisible\"\n    :title=\"false\"\n    width=\"80%\"\n    center\n    append-to-body\n    :show-close=\"true\"\n    class=\"image-preview-dialog\"\n  >\n    <img :src=\"previewImageUrl\" alt=\"预览图片\" class=\"preview-image\" />\n  </el-dialog> -->\n\n  <!-- 聊天右键菜单 -->\n  <div class=\"chat-context-menu\" v-show=\"contextMenuVisible\" :style=\"contextMenuStyle\">\n    <div class=\"context-menu-item\" @click=\"addToCalendarFromMessage\">\n      <el-icon><Calendar /></el-icon>\n      <span>添加到日程</span>\n    </div>\n    <div class=\"context-menu-item\" @click=\"copyMessageContent\">\n      <el-icon><DocumentCopy /></el-icon>\n      <span>复制内容</span>\n    </div>\n  </div>\n\n  <!-- 添加日程对话框 -->\n  <el-dialog\n    v-model=\"calendarDialogVisible\"\n    title=\"添加日程\"\n    width=\"500px\"\n  >\n    <div v-loading=\"isAnalyzing\" element-loading-text=\"AI分析中...\">\n      <el-form :model=\"calendarEvent\" :rules=\"calendarRules\" ref=\"calendarFormRef\" label-width=\"80px\">\n        <el-form-item label=\"标题\" prop=\"title\">\n          <el-input v-model=\"calendarEvent.title\" placeholder=\"请输入日程标题\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"开始时间\" prop=\"start\">\n          <el-date-picker\n            v-model=\"calendarEvent.start\"\n            type=\"datetime\"\n            placeholder=\"选择开始时间\"\n            format=\"YYYY-MM-DD HH:mm\"\n            value-format=\"YYYY-MM-DD HH:mm:ss\"\n          ></el-date-picker>\n        </el-form-item>\n        <el-form-item label=\"结束时间\" prop=\"end\">\n          <el-date-picker\n            v-model=\"calendarEvent.end\"\n            type=\"datetime\"\n            placeholder=\"选择结束时间\"\n            format=\"YYYY-MM-DD HH:mm\"\n            value-format=\"YYYY-MM-DD HH:mm:ss\"\n          ></el-date-picker>\n        </el-form-item>\n        <el-form-item label=\"地点\" prop=\"location\">\n          <el-input v-model=\"calendarEvent.location\" placeholder=\"请输入地点\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"类型\" prop=\"type\">\n          <el-select v-model=\"calendarEvent.type\" placeholder=\"请选择日程类型\">\n            <el-option label=\"会议\" value=\"blue\"></el-option>\n            <el-option label=\"出差\" value=\"orange\"></el-option>\n            <el-option label=\"假期\" value=\"green\"></el-option>\n            <el-option label=\"截止日期\" value=\"red\"></el-option>\n            <el-option label=\"其他\" value=\"purple\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"提醒\" prop=\"reminder\">\n          <el-select v-model=\"calendarEvent.reminder\" placeholder=\"请选择提醒时间\">\n            <el-option label=\"不提醒\" value=\"none\"></el-option>\n            <el-option label=\"10分钟前\" value=\"10min\"></el-option>\n            <el-option label=\"30分钟前\" value=\"30min\"></el-option>\n            <el-option label=\"1小时前\" value=\"1hour\"></el-option>\n            <el-option label=\"1天前\" value=\"1day\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"描述\" prop=\"description\">\n          <el-input \n            v-model=\"calendarEvent.description\" \n            type=\"textarea\" \n            :rows=\"3\"\n            placeholder=\"请输入描述信息\"\n          ></el-input>\n        </el-form-item>\n      </el-form>\n    </div>\n    <template #footer>\n      <div class=\"dialog-footer\">\n        <el-button @click=\"calendarDialogVisible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"submitCalendarEvent\" :loading=\"isSubmitting\">确认添加</el-button>\n      </div>\n    </template>\n  </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { ref, reactive, computed, nextTick, onMounted, onBeforeUnmount, watch } from 'vue'\nimport { useStore } from 'vuex'\nimport { useRoute } from 'vue-router'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport { \n  Search, \n  Refresh, \n  ChatDotSquare, \n  UserFilled, \n  ChatLineSquare,\n  PictureFilled,\n  FolderOpened,\n  Reading,\n  Microphone,\n  Position,\n  Document,\n  Calendar,\n  DocumentCopy\n} from '@element-plus/icons-vue'\nimport { \n  getChatSessions, \n  getChatSession, \n  sendTextMessage, \n  sendImageMessage,\n  sendKnowledgeMessage,\n  downloadMessageFile,\n  sendFileMessage,\n  summarizeChat,\n  analyzeForCalendar,\n  createCalendarEvent\n} from '@/api/chat'\nimport { getKnowledgeList } from '@/api/knowledge'\n// eslint-disable-next-line no-unused-vars\nimport { formatDate } from '@/utils/date'\nimport request from '@/utils/request'\nimport { aiChatWithDocuments } from '@/api/ai'\n\nexport default {\n  name: 'Chat',\n  components: {\n    Calendar,\n    DocumentCopy\n  },\n  \n  setup() {\n    const store = useStore()\n    const currentUser = computed(() => store.getters.user)\n    \n    // 添加本地用户数据存储\n    const userInfo = ref(null)\n    \n    const searchQuery = ref('')\n    const activeTab = ref(0)\n    const selectedContact = ref(null)\n    const messageInput = ref('')\n    const messageContainer = ref(null)\n    const fileInput = ref(null)\n    const imageInput = ref(null)\n    const messages = ref([])\n    const sessionsLoading = ref(false)\n    const messagesLoading = ref(false)\n    const chatSessions = ref([])\n    const currentChatId = ref(null)\n    \n    // 知识库相关\n    const knowledgeDialogVisible = ref(false)\n    const knowledgeLoading = ref(false)\n    const knowledgeList = ref([])\n    const selectedKnowledge = ref(null)\n    \n    // 标签页\n    const tabs = ref(['最近聊天', '同事'])\n    \n    // 联系人列表\n    const contacts = ref([])\n    // 所有同事用户列表\n    const allColleagues = ref([])\n    \n    // 部门列表\n    const departments = ref([])\n    \n    // 当前选中的联系人\n    const currentContact = computed(() => {\n      if (selectedContact.value === null) return {}\n      return contacts.value.find(c => c.id === selectedContact.value) || {}\n    })\n    \n    // 安全地获取用户ID，避免模板中的null错误\n    const userId = computed(() => {\n      return userInfo.value?.id || null\n    })\n    \n    // 根据搜索过滤联系人\n    const filteredContacts = computed(() => {\n      if (!searchQuery.value) return contacts.value\n      return contacts.value.filter(contact =>\n        contact.name.toLowerCase().includes(searchQuery.value.toLowerCase())\n      )\n    })\n    \n    // 根据当前激活的标签页获取要显示的联系人\n    const getActiveContacts = computed(() => {\n      if (activeTab.value === 0) {\n        return filteredContacts.value\n      } else if (activeTab.value === 1) {\n        return filteredContacts.value.filter(contact => !contact.isGroup)\n      }\n      return filteredContacts.value\n    })\n    \n    \n    // 按部门分组的用户\n    const groupedUsersByDepartment = computed(() => {\n      // 合并聊天联系人和所有同事\n      const usersMap = new Map();\n      \n      // 先添加聊天联系人（非群组）\n      filteredContacts.value\n        .filter(contact => !contact.isGroup)\n        .forEach(contact => {\n          // 跳过自己\n          if (userInfo.value && contact.userId === userInfo.value.id) {\n            return;\n          }\n          // 使用ID作为唯一键\n          usersMap.set(contact.userId || contact.id, contact);\n        });\n      \n      // 再添加所有同事，但避免重复\n      allColleagues.value.forEach(colleague => {\n        // 跳过自己\n        if (userInfo.value && colleague.id === userInfo.value.id) {\n          return;\n        }\n        \n        // 只有在不存在时才添加（避免覆盖现有联系人）\n        if (!usersMap.has(colleague.id)) {\n          // 构造兼容格式的用户对象\n          const contact = {\n            id: 'user_' + colleague.id, // 添加前缀以避免与现有会话ID冲突\n            userId: colleague.id,\n            name: (colleague.name || colleague.username || '未命名联系人').trim(),\n            initial: ((colleague.name || colleague.username || '未命名联系人')[0]),\n            avatar: colleague.avatar || '',\n            color: getRandomColor(colleague.id),\n            status: 'online',\n            lastMessage: '',\n            lastTime: '',\n            unread: 0,\n            isGroup: false,\n            department: colleague.department || '其它'\n          };\n          usersMap.set(colleague.id, contact);\n        }\n      });\n      \n      // 创建一个部门ID到名称的映射\n      const departmentMap = new Map(departments.value.map(dept => [dept.id, dept.name]))\n      \n      // 按部门分组\n      const groupedUsers = {};\n      \n      // 将Map转为Array后分组\n      Array.from(usersMap.values()).forEach(user => {\n        const departmentName = departmentMap.get(user.department) || '其他';\n        if (!groupedUsers[departmentName]) {\n          groupedUsers[departmentName] = [];\n        }\n        groupedUsers[departmentName].push(user);\n      });\n      \n      return groupedUsers;\n    })\n    \n    // 路由\n    const route = useRoute()\n    \n    // 定义一个refreshInterval的引用，以便在组件卸载时清除\n    let refreshInterval = null\n    \n    // 组件卸载时清除定时器\n    onBeforeUnmount(() => {\n      if (refreshInterval) {\n        clearInterval(refreshInterval)\n      }\n    })\n    \n    // 路由相关操作\n    onMounted(async () => {\n      try {\n        // 先加载用户数据\n        const userData = await fetchCurrentUser()\n        \n        // 如果获取用户信息失败，显示错误并返回\n        if (!userData) {\n          ElMessage.error('无法加载用户信息，请刷新页面重试')\n          return\n        }\n        \n        console.log('组件挂载时获取的用户信息:', userData)\n        \n        // 确保用户数据已经更新\n        if (!userInfo.value || !userInfo.value.id) {\n          console.error('用户数据未正确加载:', userInfo.value)\n          ElMessage.error('用户数据加载异常，请刷新页面重试')\n          return\n        } else {\n          console.log('当前用户数据已正确加载:', userInfo.value)\n        }\n        \n        // 加载所有用户列表\n        await loadAllUsers()\n        \n        // 加载部门列表\n        await loadDepartments()\n        \n        // 再加载聊天会话列表\n        await loadChatSessions()\n        \n        // 检查URL参数中是否有会话ID\n        const sessionId = route.query.session || route.query.id\n        if (sessionId) {\n          // 查找对应的联系人\n          const foundContact = contacts.value.find(c => c.id === parseInt(sessionId))\n          if (foundContact) {\n            // 选中该联系人\n            selectedContact.value = foundContact.id\n            // 加载聊天记录\n            await loadChatMessages(sessionId)\n          } else {\n            // 如果未找到对应联系人，尝试直接加载会话\n            console.log('通过ID直接加载聊天会话:', sessionId)\n            await loadChatMessages(sessionId)\n          }\n        }\n      \n        // 设置定时刷新\n        refreshInterval = setInterval(async () => {\n          if (selectedContact.value) {\n            await loadChatMessages(selectedContact.value, true)\n          }\n          await loadChatSessions(true)\n        }, 30000)\n        \n        // 初始滚动到底部\n        await nextTick()\n        scrollToBottom()\n      } catch (error) {\n        console.error('初始化聊天组件失败:', error)\n        ElMessage.error('初始化聊天组件失败: ' + error.message)\n      }\n    })\n    \n    // 获取当前用户信息\n    const fetchCurrentUser = async () => {\n      try {\n        console.log('开始获取当前用户信息...')\n        \n        // 检查localStorage中是否有token\n        const token = localStorage.getItem('token')\n        if (!token) {\n          console.warn('本地存储中没有找到认证token')\n          ElMessage.warning('未登录或登录已过期，请重新登录')\n          return null\n        }\n        \n        const response = await request({\n          url: '/api/auth/users/me/',\n          method: 'get'\n        })\n        \n        console.log('获取用户信息响应:', response)\n        \n        // 检查响应格式并获取用户数据\n        let userData = null\n        if (response.data && response.data.id) {\n          // 直接从data字段获取用户数据\n          userData = response.data\n          console.log('从data字段获取用户数据:', userData)\n        } else if (response.data && response.data.data && response.data.data.id) {\n          // 从嵌套data字段获取用户数据\n          userData = response.data.data\n          console.log('从嵌套data字段获取用户数据:', userData)\n        } else if (response.id) {\n          // 直接响应就是用户数据\n          userData = response\n          console.log('直接获取用户数据:', userData)\n        } else {\n          console.error('获取用户信息响应格式异常:', response)\n          throw new Error('用户信息格式异常')\n        }\n        \n        if (!userData || !userData.id) {\n          console.error('获取的用户数据无效:', userData)\n          throw new Error('无效的用户数据')\n        }\n        \n        // 不使用未定义的mutation，而是直接更新本地状态\n        userInfo.value = userData\n        \n        // 保存到localStorage以便持久化\n        localStorage.setItem('user', JSON.stringify(userData))\n        \n        console.log('用户数据已更新:', userInfo.value)\n        return userData\n      } catch (error) {\n        console.error('获取当前用户信息失败:', error)\n        ElMessage.error('获取用户信息失败: ' + (error.message || '未知错误'))\n        return null\n      }\n    }\n    \n    // 加载聊天会话列表\n    const loadChatSessions = async (isBackgroundRefresh = false) => {\n      try {\n        if (!isBackgroundRefresh) {\n          sessionsLoading.value = true\n        }\n        console.log('正在加载聊天会话列表...')\n        \n        const response = await getChatSessions()\n        console.log('获取聊天会话响应:', response)\n        \n        // 确保我们有响应数据\n        if (!response) {\n          console.error('获取聊天会话返回空响应')\n          contacts.value = []\n          return\n        }\n        \n        let data\n        if (response.success && response.data) {\n          data = response.data\n          console.log('使用包装格式的聊天数据:', data)\n        } else {\n          data = response\n          console.log('使用直接返回的聊天数据:', data)\n        }\n        \n        // 转换数据格式\n        chatSessions.value = data\n        \n        // 构建联系人列表\n        if (data && Array.isArray(data.results)) {\n          console.log('处理分页数据结构, 共有会话数:', data.results.length)\n          // 处理分页数据结构\n          contacts.value = data.results.map(session => {\n            // 找到对方用户（非当前用户）\n            let otherParticipant = null\n            if (session.participants && Array.isArray(session.participants)) {\n              if (userInfo.value && userInfo.value.id) {\n                otherParticipant = session.participants.find(\n                  p => p.user && p.user.id !== userInfo.value.id\n                )\n              } else {\n                // 如果没有当前用户信息，使用第一个参与者\n                otherParticipant = session.participants[0]\n              }\n            }\n            \n            // 如果是群聊，使用群聊信息\n            if (session.is_group) {\n              return {\n                id: session.id,\n                name: session.title || '群聊',\n                initial: (session.title || '群聊')[0],\n                avatar: '',\n                avatar_url: '',\n                color: getRandomColor(session.id),\n                status: 'online',\n                lastMessage: session.last_message ? session.last_message.content : '',\n                lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n                unread: session.unread_count,\n                isGroup: true\n              }\n            }\n            \n            // 单聊，使用对方信息\n            if (otherParticipant) {\n              const user = otherParticipant.user\n              // 处理头像路径\n              let avatar_url = '';\n              if (user.avatar) {\n                const avatar = user.avatar;\n                if (avatar.startsWith('http://') || avatar.startsWith('https://')) {\n                  avatar_url = avatar;\n                } else if (avatar.startsWith('/')) {\n                  avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}${avatar}`;\n                } else {\n                  avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}/${avatar}`;\n                }\n              }\n              \n              return {\n                id: session.id,\n                userId: user.id, // 添加用户ID，用于检查是否是自己\n                name: (user.name || (((user.first_name || '') + ' ' + (user.last_name || '')).trim() || user.username) || '未命名联系人').trim(),\n                initial: ((user.name || user.first_name || user.username || '未命名联系人')[0]),\n                avatar: user.avatar || '',\n                avatar_url: avatar_url,\n                color: getRandomColor(user.id),\n                status: 'online',\n                lastMessage: session.last_message ? session.last_message.content : '',\n                lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n                unread: session.unread_count,\n                isGroup: false,\n                department: user.department || '其他' // 确保有默认部门\n              }\n            }\n            \n            // 如果没有其他参与者（理论上不应该发生）\n            return {\n              id: session.id,\n              name: session.title || '聊天',\n              initial: (session.title || '聊天')[0],\n              avatar: '',\n              avatar_url: '',\n              color: getRandomColor(session.id),\n              status: 'online',\n              lastMessage: session.last_message ? session.last_message.content : '',\n              lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n              unread: session.unread_count,\n              isGroup: session.is_group,\n              department: '其他'\n            }\n          })\n        } else if (data && Array.isArray(data)) {\n          console.log('处理非分页数据结构, 共有会话数:', data.length)\n          // 处理非分页数据结构\n          contacts.value = data.map(session => {\n            // 找到对方用户（非当前用户）\n            let otherParticipant = null\n            if (session.participants && Array.isArray(session.participants)) {\n              if (userInfo.value && userInfo.value.id) {\n                otherParticipant = session.participants.find(\n                  p => p.user && p.user.id !== userInfo.value.id\n                )\n              } else {\n                // 如果没有当前用户信息，使用第一个参与者\n                otherParticipant = session.participants[0]\n              }\n            }\n            \n            // 如果是群聊，使用群聊信息\n            if (session.is_group) {\n              return {\n                id: session.id,\n                name: session.title || '群聊',\n                initial: (session.title || '群聊')[0],\n                avatar: '',\n                avatar_url: '',\n                color: getRandomColor(session.id),\n                status: 'online',\n                lastMessage: session.last_message ? session.last_message.content : '',\n                lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n                unread: session.unread_count,\n                isGroup: true\n              }\n            }\n            \n            // 单聊，使用对方信息\n            if (otherParticipant) {\n              const user = otherParticipant.user\n              // 处理头像路径\n              let avatar_url = '';\n              if (user.avatar) {\n                const avatar = user.avatar;\n                if (avatar.startsWith('http://') || avatar.startsWith('https://')) {\n                  avatar_url = avatar;\n                } else if (avatar.startsWith('/')) {\n                  avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}${avatar}`;\n                } else {\n                  avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}/${avatar}`;\n                }\n              }\n              \n              return {\n                id: session.id,\n                name: (user.name || (((user.first_name || '') + ' ' + (user.last_name || '')).trim() || user.username) || '未命名联系人').trim(),\n                initial: ((user.name || user.first_name || user.username || '未命名联系人')[0]),\n                avatar: user.avatar || '',\n                avatar_url: avatar_url,\n                color: getRandomColor(user.id),\n                status: 'online',\n                lastMessage: session.last_message ? session.last_message.content : '',\n                lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n                unread: session.unread_count,\n                isGroup: false,\n                department: user.department || '其他'\n              }\n            }\n            \n            // 如果没有其他参与者（理论上不应该发生）\n            return {\n              id: session.id,\n              name: session.title || '聊天',\n              initial: (session.title || '聊天')[0],\n              avatar: '',\n              avatar_url: '',\n              color: getRandomColor(session.id),\n              status: 'online',\n              lastMessage: session.last_message ? session.last_message.content : '',\n              lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n              unread: session.unread_count,\n              isGroup: session.is_group,\n              department: '其他'\n            }\n          })\n        } else {\n          // 如果没有有效数据\n          console.error('获取聊天会话格式异常或为空:', data)\n          contacts.value = []\n        }\n        \n        console.log('处理后的联系人列表:', contacts.value)\n        \n        // 如果有未读消息，按未读数量排序\n        if (contacts.value.length > 0) {\n          contacts.value.sort((a, b) => b.unread - a.unread)\n        }\n      } catch (error) {\n        console.error('加载聊天会话失败:', error)\n        ElMessage.error('加载聊天会话失败: ' + (error.message || '未知错误'))\n        contacts.value = []\n      } finally {\n        if (!isBackgroundRefresh) {\n          sessionsLoading.value = false\n        }\n      }\n    }\n    \n    // 加载聊天消息\n    const loadChatMessages = async (chatId, isBackgroundRefresh = false) => {\n      if (!chatId) {\n        console.error('无法加载消息: chatId为空')\n        return\n      }\n      \n      try {\n        if (!isBackgroundRefresh) {\n          messagesLoading.value = true\n        }\n        console.log(`正在加载聊天会话 ${chatId} 的消息...`)\n        \n        const response = await getChatSession(chatId)\n        console.log('聊天会话详情响应:', response)\n        \n        if (!response) {\n          console.error('获取聊天会话详情返回空响应')\n          messages.value = []\n          return\n        }\n        \n        // 处理不同的响应格式\n        let messageData = []\n        let sessionData = null\n        \n        if (response.data && response.data.messages) {\n          // 标准格式：响应直接包含messages字段\n          messageData = response.data.messages\n          sessionData = response.data\n          console.log('标准格式消息数据，消息数量:', messageData.length)\n        } else if (response.data && response.data.data && response.data.data.messages) {\n          // 包装格式：{success: true, data: {messages: [...]}}\n          messageData = response.data.data.messages\n          sessionData = response.data.data\n          console.log('包装格式消息数据，消息数量:', messageData.length)\n        } else if (response.messages) {\n          // 直接返回格式: {messages: [...]}\n          messageData = response.messages\n          sessionData = response\n          console.log('直接返回格式消息数据，消息数量:', messageData.length)\n        } else {\n          console.warn('无法识别的消息数据格式:', response)\n          console.log('尝试检查是否有其他可能的消息字段...')\n          \n          // 尝试查找其他可能的消息字段\n          const possibleMessageFields = ['message', 'chat_messages', 'chats', 'content']\n          for (const field of possibleMessageFields) {\n            if (response[field] && Array.isArray(response[field])) {\n              console.log(`找到可能的消息字段 ${field}，使用此字段数据`)\n              messageData = response[field]\n              sessionData = response\n              break\n            } else if (response.data && response.data[field] && Array.isArray(response.data[field])) {\n              console.log(`在data字段中找到可能的消息字段 ${field}，使用此字段数据`)\n              messageData = response.data[field]\n              sessionData = response.data\n              break\n            }\n          }\n          \n          if (messageData.length === 0) {\n            console.warn('未找到任何消息数据，使用空数组')\n          }\n        }\n        \n        // 处理消息发送者的头像\n        messageData.forEach(message => {\n          if (message.sender && message.sender.avatar) {\n            const avatar = message.sender.avatar;\n            if (avatar.startsWith('http://') || avatar.startsWith('https://')) {\n              message.sender.avatar_url = avatar;\n            } else if (avatar.startsWith('/')) {\n              message.sender.avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}${avatar}`;\n            } else {\n              message.sender.avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}/${avatar}`;\n            }\n          }\n        });\n        \n        // 记录会话和消息数据\n        console.log('处理后的会话数据:', sessionData)\n        console.log('处理后的消息数据:', messageData)\n        \n        // 如果会话不在联系人列表中，添加它\n        if (sessionData && !contacts.value.some(c => c.id === parseInt(chatId))) {\n          console.log('会话不在联系人列表中，添加它:', sessionData)\n          \n          // 创建临时联系人对象\n          const session = sessionData\n          // 找到对方用户（非当前用户）\n          let otherParticipant = null\n          \n          // 确保 session.participants 存在且是数组\n          if (session.participants && Array.isArray(session.participants) && session.participants.length > 0 && userInfo.value) {\n            otherParticipant = session.participants.find(p => p.user && p.user.id !== userInfo.value.id)\n          }\n          \n          let tempContact = null\n          \n          // 如果是群聊，使用群聊信息\n          if (session.is_group) {\n            tempContact = {\n              id: parseInt(chatId),\n              name: session.title || '群聊',\n              initial: (session.title || '群聊')[0],\n              avatar: '',\n              avatar_url: '',\n              color: getRandomColor(parseInt(chatId)),\n              status: 'online',\n              lastMessage: session.last_message ? session.last_message.content : '',\n              lastTime: formatMessageTime(session.updated_at),\n              unread: 0,\n              isGroup: true\n            }\n          // 单聊，使用对方信息\n          } else if (otherParticipant && otherParticipant.user) {\n            const user = otherParticipant.user\n            // 处理头像路径\n            let avatar_url = '';\n            if (user.avatar) {\n              const avatar = user.avatar;\n              if (avatar.startsWith('http://') || avatar.startsWith('https://')) {\n                avatar_url = avatar;\n              } else if (avatar.startsWith('/')) {\n                avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}${avatar}`;\n              } else {\n                avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}/${avatar}`;\n              }\n            }\n            \n            tempContact = {\n              id: parseInt(chatId),\n              name: (user.name || (((user.first_name || '') + ' ' + (user.last_name || '')).trim() || user.username) || '未命名联系人').trim(),\n              initial: ((user.name || user.first_name || user.username || '未命名联系人')[0]),\n              avatar: user.avatar || '',\n              avatar_url: avatar_url,\n              color: getRandomColor(user.id),\n              status: 'online',\n              lastMessage: session.last_message ? session.last_message.content : '',\n              lastTime: formatMessageTime(session.updated_at),\n              unread: 0,\n              isGroup: false\n            }\n          } else {\n            // 如果无法找到对方信息，使用默认值\n            tempContact = {\n              id: parseInt(chatId),\n              name: session.title || '聊天',\n              initial: (session.title || '聊天')[0],\n              avatar: '',\n              avatar_url: '',\n              color: getRandomColor(parseInt(chatId)),\n              status: 'online',\n              lastMessage: '',\n              lastTime: formatMessageTime(session.updated_at),\n              unread: 0,\n              isGroup: session.is_group\n            }\n          }\n          \n          // 添加临时联系人到列表\n          if (tempContact) {\n            contacts.value.unshift(tempContact)\n            console.log('添加临时联系人:', tempContact)\n          }\n        }\n        \n        // 更新组件数据\n        messages.value = messageData || []\n        currentChatId.value = parseInt(chatId)\n        selectedContact.value = parseInt(chatId)\n        \n        // 加载当前会话已上传的文档ID\n        try {\n          const res = await request({\n            url: '/api/ai/documents/',\n            method: 'get',\n            params: { chat: chatId }\n          })\n          if (res && res.data && Array.isArray(res.data.results)) {\n            selectedDocumentIds.value = res.data.results.map(doc => doc.id)\n            console.log('当前会话文档ID:', selectedDocumentIds.value)\n          }\n        } catch (e) {\n          selectedDocumentIds.value = []\n        }\n        \n        // 滚动到底部\n        nextTick(() => {\n          scrollToBottom()\n        })\n      } catch (error) {\n        console.error('加载会话详情失败:', error)\n        \n        let errorMessage = '加载聊天消息失败'\n        if (error.response) {\n          const status = error.response.status\n          if (status === 404) {\n            errorMessage = '聊天会话不存在或已被删除'\n          } else if (status === 403) {\n            errorMessage = '无权访问此聊天会话'\n          } else if (error.response.data && error.response.data.message) {\n            errorMessage = error.response.data.message\n          }\n        } else if (error.message) {\n          errorMessage = error.message\n        }\n        \n        ElMessage.error(errorMessage)\n        messages.value = []\n      } finally {\n        if (!isBackgroundRefresh) {\n          messagesLoading.value = false\n        }\n      }\n    }\n    \n    // 刷新聊天会话列表\n    const refreshChatSessions = async () => {\n      // 更新用户列表\n      await loadAllUsers()\n      \n      // 更新部门列表\n      await loadDepartments()\n      \n      // 更新聊天会话\n      await loadChatSessions()\n      \n      // 如果有当前聊天ID，确保选中正确的联系人\n      if (currentChatId.value) {\n        const contact = contacts.value.find(c => c.id === currentChatId.value)\n        if (contact) {\n          selectedContact.value = contact.id\n        }\n      }\n    }\n    \n    // 确保消息容器滚动到底部\n    const scrollToBottom = () => {\n      if (messageContainer.value) {\n        messageContainer.value.scrollTop = messageContainer.value.scrollHeight\n      }\n    }\n    \n    // 在选择联系人后，滚动到底部\n    const selectContact = async (contact) => {\n      // 检查是否尝试与自己聊天\n      if (!contact.isGroup && userInfo.value && contact.userId === userInfo.value.id) {\n        ElMessage.warning('不能与自己聊天')\n        return\n      }\n      \n      console.log('选择联系人:', contact)\n      \n      // 处理两种类型的ID：现有对话ID和用户ID前缀的情况\n      let contactId = contact.id\n      \n      // 检查是否已有该联系人的对话\n      if (typeof contactId === 'string' && contactId.startsWith('user_')) {\n        // 这是直接选择了用户，而不是现有的聊天会话\n        let userId = contact.userId || contact.id.replace('user_', '')\n        console.log('尝试查找与用户的现有对话:', userId)\n        \n        // 尝试在现有会话中查找与该用户的对话\n        const existingChat = contacts.value.find(c => \n          !c.isGroup && \n          ((c.userId && c.userId == userId) || \n          (c.user && c.user.id == userId))\n        )\n        \n        if (existingChat) {\n          console.log('找到与用户的现有对话:', existingChat)\n          contactId = existingChat.id\n        } else {\n          console.log('未找到与用户的现有对话，创建新对话')\n          \n          // 创建新的聊天会话\n          try {\n            const response = await request({\n              url: '/api/chat/sessions/',\n              method: 'post',\n              data: {\n                participant_ids: [userId],\n                is_group: false\n              }\n            })\n            \n            console.log('创建会话响应:', response)\n            \n            // 处理API响应\n            let newSession = null\n            \n            if (response && response.data) {\n              newSession = response.data\n            } else if (response && response.id) {\n              newSession = response\n            }\n            \n            if (newSession && newSession.id) {\n              // 创建临时联系人对象\n              const tempContact = {\n                id: newSession.id,\n                userId: userId,\n                name: contact.name,\n                initial: contact.initial,\n                avatar: contact.avatar,\n                avatar_url: contact.avatar_url || '',\n                color: contact.color || getRandomColor(userId),\n                status: 'online',\n                lastMessage: '',\n                lastTime: formatMessageTime(new Date()),\n                unread: 0,\n                isGroup: false,\n                department: contact.department\n              }\n              \n              // 添加到联系人列表\n              contacts.value.unshift(tempContact)\n              \n              // 更新选中的联系人\n              contactId = newSession.id\n              ElMessage.success('已创建新的对话')\n            } else {\n              throw new Error('创建会话返回无效数据')\n            }\n          } catch (error) {\n            console.error('创建新会话失败:', error)\n            ElMessage.error('无法创建新对话: ' + (error.message || '未知错误'))\n            return\n          }\n        }\n      }\n      \n      // 加载选中的联系人\n      selectedContact.value = contactId\n      messageInput.value = ''\n      messages.value = []\n      \n      // 加载消息\n      try {\n        await loadChatMessages(contactId)\n        \n        // 滚动到底部\n        nextTick(() => {\n          scrollToBottom()\n        })\n      } catch (error) {\n        console.error('加载聊天消息失败:', error)\n        ElMessage.error('无法加载对话内容：' + (error.message || '未知错误'))\n      }\n    }\n    \n    // 在消息列表更新后，滚动到底部\n    watch(messages, () => {\n      nextTick(() => {\n        scrollToBottom()\n      })\n    })\n    \n    // 发送消息\n    const sendMessage = async () => {\n      if (!messageInput.value.trim() || !currentChatId.value) return\n\n      try {\n        console.log('发送消息时文档IDs:', selectedDocumentIds.value)\n        if (!userInfo.value || !userInfo.value.id) {\n          const userData = await fetchCurrentUser()\n          if (!userData || !userData.id) {\n            throw new Error('无法获取当前用户信息，请刷新页面重试')\n          }\n        }\n\n        const tempMessage = {\n          id: 'temp-' + Date.now(),\n          content: messageInput.value.trim(),\n          sender: {\n            id: userInfo.value.id,\n            username: userInfo.value.username || '用户',\n            first_name: userInfo.value.first_name || '',\n            last_name: userInfo.value.last_name || ''\n          },\n          message_type: 'text',\n          created_at: new Date().toISOString(),\n          is_temp: true\n        }\n\n        messages.value.push(tempMessage)\n        const messageCopy = messageInput.value\n        messageInput.value = ''\n        await nextTick()\n        scrollToBottom()\n\n        let response, aiMsg\n        if (selectedDocumentIds.value && selectedDocumentIds.value.length > 0) {\n          // 文档增强AI对话\n          response = await aiChatWithDocuments({\n            message: messageCopy,\n            chat_id: currentChatId.value,\n            document_ids: selectedDocumentIds.value\n          })\n          // 兼容流式文本响应\n          let aiContent = ''\n          if (response && typeof response.data === 'string') {\n            aiContent = response.data\n          } else if (response && response.data && response.data.message) {\n            aiContent = response.data.message\n          }\n          if (aiContent) {\n            aiMsg = {\n              id: 'ai-' + Date.now(),\n              content: aiContent,\n              sender: { id: 0, username: 'AI助手' },\n              message_type: 'text',\n              created_at: new Date().toISOString()\n            }\n            // 用AI回复替换临时消息\n            const tempIndex = messages.value.findIndex(m => m.id === tempMessage.id)\n            if (tempIndex !== -1) {\n              messages.value.splice(tempIndex, 1, aiMsg)\n            } else {\n              messages.value.push(aiMsg)\n            }\n          }\n        } else {\n          // 原有普通消息\n          response = await sendTextMessage({\n            chat: currentChatId.value,\n            content: messageCopy\n          })\n          let messageData = null\n          if (response && response.success && response.data) {\n            messageData = response.data\n          } else if (response && response.id) {\n            messageData = response\n          } else if (response && response.chat) {\n            messageData = {\n              id: response.id || 'msg-' + Date.now(),\n              content: response.content,\n              message_type: response.message_type,\n              file: response.file,\n              created_at: response.created_at || new Date().toISOString(),\n              sender: {\n                id: userInfo.value.id,\n                username: userInfo.value.username || '用户',\n                first_name: userInfo.value.first_name || '',\n                last_name: userInfo.value.last_name || ''\n              }\n            }\n          }\n          const tempIndex = messages.value.findIndex(m => m.id === tempMessage.id)\n          if (tempIndex !== -1 && messageData) {\n            messages.value.splice(tempIndex, 1, messageData)\n          } else if (messageData) {\n            messages.value.push(messageData)\n          }\n        }\n        await nextTick()\n        scrollToBottom()\n      } catch (error) {\n        console.error('发送消息失败:', error)\n        messages.value = messages.value.filter(m => !m.is_temp)\n        messageInput.value = error.savedMessage || messageInput.value\n        ElMessage.error('发送消息失败，请重试')\n      }\n    }\n    \n    // 打开文件上传\n    const openFileUpload = () => {\n      fileInput.value.click()\n    }\n    \n    // 打开图片上传\n    const openImageUpload = () => {\n      imageInput.value.click()\n    }\n    \n    // 添加文件和图片上传加载状态\n    const fileUploading = ref(false)\n    const imageUploading = ref(false)\n    \n    // 处理文件上传\n    const handleFileUpload = async (event) => {\n      const file = event.target.files[0]\n      if (!file || !currentChatId.value) return\n      try {\n        // 显示加载动画\n        fileUploading.value = true\n        \n        // 直接使用sendFileMessage发送文件消息\n        await sendFileMessage(\n          currentChatId.value,\n          `发送文件: ${file.name}`,\n          file\n        )\n        \n        // 同时上传到AI文档系统（如果需要）\n        const formData = new FormData()\n        formData.append('file', file)\n        formData.append('chat', currentChatId.value)\n        await request({\n          url: '/api/ai/documents/upload/',\n          method: 'post',\n          data: formData,\n          headers: { 'Content-Type': 'multipart/form-data' }\n        })\n        \n        // 上传后强制刷新文档ID列表\n        const docRes = await request({\n          url: '/api/ai/documents/',\n          method: 'get',\n          params: { chat: currentChatId.value }\n        })\n        if (docRes && docRes.data && Array.isArray(docRes.data.results)) {\n          selectedDocumentIds.value = docRes.data.results.map(doc => doc.id)\n          console.log('上传后刷新文档IDs:', selectedDocumentIds.value)\n        }\n        \n        ElMessage.success('文件发送成功')\n        \n        // 重新加载消息\n        loadChatMessages(currentChatId.value, true)\n        event.target.value = ''\n      } catch (error) {\n        console.error('发送文件失败:', error)\n        ElMessage.error('发送文件失败')\n      } finally {\n        // 无论成功失败，都关闭加载动画\n        fileUploading.value = false\n      }\n    }\n    \n    // 处理图片上传\n    const handleImageUpload = async (event) => {\n      const file = event.target.files[0]\n      if (!file || !currentChatId.value) return\n      \n      try {\n        // 检查文件类型\n        if (!file.type.startsWith('image/')) {\n          ElMessage.error('只能上传图片文件')\n          event.target.value = ''\n          return\n        }\n        \n        // 检查文件大小（最大10MB）\n        const maxSize = 10 * 1024 * 1024 // 10MB\n        if (file.size > maxSize) {\n          ElMessage.error('图片大小不能超过10MB')\n          event.target.value = ''\n          return\n        }\n        \n        // 显示加载动画\n        imageUploading.value = true\n        \n        console.log('准备发送图片，聊天ID:', currentChatId.value, '文件:', file.name, '大小:', file.size)\n        \n        // 使用修改后的API参数\n        await sendImageMessage(\n          currentChatId.value, \n          `发送图片`, \n          file\n        )\n        \n        // 重新加载消息\n        loadChatMessages(currentChatId.value, true)\n        \n        // 清空文件输入\n        event.target.value = ''\n      } catch (error) {\n        console.error('发送图片失败:', error)\n        \n        // 更详细的错误信息\n        let errorMessage = '发送图片失败'\n        if (error.response) {\n          console.error('错误状态码:', error.response.status)\n          console.error('错误详情:', error.response.data)\n          \n          if (error.response.data && error.response.data.error) {\n            errorMessage = error.response.data.error\n          } else if (error.response.data && typeof error.response.data === 'string') {\n            errorMessage = error.response.data\n          } else if (error.response.status === 413) {\n            errorMessage = '图片太大，服务器拒绝接收'\n          }\n        }\n        \n        ElMessage.error(errorMessage)\n        event.target.value = ''\n      } finally {\n        // 无论成功失败，都关闭加载动画\n        imageUploading.value = false\n      }\n    }\n    \n    // 打开知识库对话框\n    const openKnowledgeDialog = async () => {\n      knowledgeDialogVisible.value = true\n      await loadKnowledgeList()\n    }\n    \n    // 加载知识库列表\n    const loadKnowledgeList = async () => {\n      try {\n        knowledgeLoading.value = true\n        const { data } = await getKnowledgeList()\n        knowledgeList.value = data\n      } catch (error) {\n        console.error('加载知识库列表失败:', error)\n        ElMessage.error('加载知识库列表失败')\n      } finally {\n        knowledgeLoading.value = false\n      }\n    }\n    \n    // 选择知识库文件\n    const selectKnowledge = (row) => {\n      selectedKnowledge.value = row\n    }\n    \n    // 分享知识库文件\n    const shareKnowledge = async (knowledge) => {\n      if (!currentChatId.value) return\n      \n      try {\n        await sendKnowledgeMessage(\n          currentChatId.value,\n          `分享知识库文件: ${knowledge.title}`,\n          knowledge.id\n        )\n        \n        // 关闭对话框\n        knowledgeDialogVisible.value = false\n        \n        // 重新加载消息\n        loadChatMessages(currentChatId.value, true)\n      } catch (error) {\n        console.error('分享知识库文件失败:', error)\n        ElMessage.error('分享知识库文件失败')\n      }\n    }\n    \n    // 下载文件\n    const downloadFile = async (message) => {\n      try {\n        const response = await downloadMessageFile(message.id)\n        \n        // 创建下载链接\n        const url = window.URL.createObjectURL(new Blob([response.data]))\n        const link = document.createElement('a')\n        link.href = url\n        link.setAttribute('download', message.file_name || 'download')\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      } catch (error) {\n        console.error('下载文件失败:', error)\n        ElMessage.error('下载文件失败')\n      }\n    }\n    \n    // 查看知识库文件\n    const viewKnowledge = (message) => {\n      if (message.knowledge_detail) {\n        // 可以跳转到知识库详情页面\n        ElMessageBox.alert(\n          `标题: ${message.knowledge_detail.title}<br>描述: ${message.knowledge_detail.description || '无'}`, \n          '知识库文件', \n          {\n            dangerouslyUseHTMLString: true,\n            confirmButtonText: '确定'\n          }\n        )\n      }\n    }\n    \n    // 获取发送者颜色\n    const getSenderColor = (sender) => {\n      return getRandomColor(sender.id)\n    }\n    \n    // 获取发送者首字母\n    const getSenderInitial = (sender) => {\n      return (sender.first_name || sender.username)[0]\n    }\n    \n    // 根据ID生成随机颜色\n    const getRandomColor = (id) => {\n      const colors = [\n        '#007bff', '#28a745', '#dc3545', '#fd7e14', \n        '#6f42c1', '#20c997', '#17a2b8', '#6c757d'\n      ]\n      \n      // 使用ID作为索引，确保同一用户颜色一致\n      const index = typeof id === 'number' ? id % colors.length : 0\n      return colors[index]\n    }\n    \n    // 格式化消息时间\n    const formatMessageTime = (timestamp) => {\n      if (!timestamp) return ''\n      \n      const date = new Date(timestamp)\n      const now = new Date()\n      const diff = now - date\n      \n      // 今天内的消息显示时间\n      if (diff < 24 * 60 * 60 * 1000) {\n      const hours = date.getHours().toString().padStart(2, '0')\n      const minutes = date.getMinutes().toString().padStart(2, '0')\n      return `${hours}:${minutes}`\n      }\n      \n      // 一周内的消息显示星期几\n      if (diff < 7 * 24 * 60 * 60 * 1000) {\n        const days = ['周日', '周一', '周二', '周三', '周四', '周五', '周六']\n        return days[date.getDay()]\n      }\n      \n      // 更早的消息显示日期\n      return `${date.getMonth() + 1}月${date.getDate()}日`\n    }\n    \n    // 格式化日期\n    const formatDate = (timestamp) => {\n      if (!timestamp) return ''\n      \n      const date = new Date(timestamp)\n      return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`\n    }\n    \n    // 格式化文件大小\n    const formatFileSize = (sizeInKB) => {\n      if (sizeInKB < 1024) {\n        return `${sizeInKB} KB`\n      } else {\n        return `${(sizeInKB / 1024).toFixed(2)} MB`\n      }\n    }\n    \n    // 获取状态文字\n    const getStatusText = (status) => {\n      const statusMap = {\n        'online': '在线',\n        'offline': '离线',\n        'busy': '忙碌',\n        'away': '离开'\n      }\n      return statusMap[status] || status\n    }\n    \n    // 添加强制刷新方法\n    const forceRefresh = async () => {\n      try {\n        ElMessage.info('正在强制刷新数据...')\n        \n        // 重新获取用户信息\n        const userData = await fetchCurrentUser()\n        \n        if (!userData) {\n          ElMessage.error('无法获取用户信息，请尝试重新登录')\n          return\n        }\n        \n        // 重新加载聊天会话\n        await loadChatSessions()\n        \n        if (contacts.value.length === 0) {\n          ElMessage.warning('未找到任何聊天会话，您可能还没有开始任何对话')\n        } else {\n          ElMessage.success('刷新成功！找到 ' + contacts.value.length + ' 个聊天会话')\n        }\n      } catch (error) {\n        console.error('强制刷新失败:', error)\n        ElMessage.error('刷新失败: ' + (error.message || '未知错误'))\n      }\n    }\n    \n    // 加载所有用户\n    const loadAllUsers = async () => {\n      try {\n        console.log('正在加载所有用户列表...')\n        \n        // 确保已获取当前用户信息及其公司ID\n        if (!userInfo.value || !userInfo.value.company) {\n          console.error('无法加载同事列表：缺少用户或公司信息。')\n          // 尝试重新获取用户信息\n          const userData = await fetchCurrentUser();\n          if (!userData || !userData.company) {\n            ElMessage.error('无法获取您的公司信息，无法加载同事列表。');\n            allColleagues.value = []; // 清空列表\n            return;\n          }\n        }\n        \n        const companyId = userInfo.value.company;\n        console.log('开始获取公司同事列表，公司ID:', companyId);\n\n        // 使用/api/auth/contacts/并传入公司ID来获取同事列表\n        const response = await request({\n          url: '/api/auth/contacts/',\n          method: 'get',\n          params: { company: companyId }\n        });\n\n        console.log('公司同事列表API响应:', response);\n\n        let users = [];\n        // 根据通讯录页面的经验，响应可能在 response.data 中\n        if (response && response.success && Array.isArray(response.data)) {\n          users = response.data;\n        } else if (response && Array.isArray(response.data)) {\n           users = response.data;\n        } else if (response && Array.isArray(response)) {\n           users = response;\n        } else {\n          console.warn('获取同事列表的响应格式未知或数据为空:', response);\n        }\n\n        if (users.length > 0) {\n          console.log(`成功获取到 ${users.length} 个同事`);\n          // 后端返回的contacts可能需要格式化以匹配allColleagues的期望结构\n          allColleagues.value = users.map(u => ({\n            id: u.id,\n            username: u.username,\n            name: u.name, // 直接使用通讯录接口提供的name字段\n            department: u.department,\n            avatar: u.avatar_url || u.avatar\n          }));\n        } else {\n          allColleagues.value = []; // 如果没有用户，则清空\n        }\n\n      } catch (error) {\n        console.error('加载公司同事列表过程中出错:', error);\n        ElMessage.error('加载同事列表失败，请稍后重试。');\n        allColleagues.value = []; // 出错时清空列表\n      }\n    }\n    \n    // 获取部门列表\n    const loadDepartments = async () => {\n      try {\n        console.log('正在加载部门列表...')\n        const response = await request({\n          url: '/api/auth/departments/',\n          method: 'get'\n        })\n        \n        console.log('获取部门响应:', response)\n        \n        // 处理响应数据\n        let depts = []\n        if (response && response.results) {\n          depts = response.results\n        } else if (Array.isArray(response)) {\n          depts = response\n        } else if (response && response.data) {\n          if (Array.isArray(response.data)) {\n            depts = response.data\n          } else if (response.data.results) {\n            depts = response.data.results\n          }\n        }\n        \n        if (depts && depts.length > 0) {\n          console.log(`成功获取到${depts.length}个部门`)\n          departments.value = depts\n        }\n      } catch (error) {\n        console.error('获取部门列表失败:', error)\n      }\n    }\n    \n    const selectedDocumentIds = ref([]) // 当前会话关联文档ID\n    \n    // AI总结相关\n    const summaryDialogVisible = ref(false)\n    const summaryDateRange = ref([new Date(new Date().setDate(new Date().getDate() - 7)), new Date()])\n    const summaryContent = ref('')\n    const summaryLoading = ref(false)\n    const pickerOptions = ref({\n      shortcuts: [{\n        text: '最近一周',\n        onClick(picker) {\n          const end = new Date();\n          const start = new Date();\n          start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);\n          picker.$emit('pick', [start, end]);\n        }\n      }, {\n        text: '最近一个月',\n        onClick(picker) {\n          const end = new Date();\n          const start = new Date();\n          start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);\n          picker.$emit('pick', [start, end]);\n        }\n      }, {\n        text: '最近三个月',\n        onClick(picker) {\n          const end = new Date();\n          const start = new Date();\n          start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);\n          picker.$emit('pick', [start, end]);\n        }\n      }]\n    })\n    \n    const openSummaryDialog = () => {\n      // 重置内容，但保留日期范围\n      summaryContent.value = ''\n      summaryDialogVisible.value = true\n    }\n    \n    const handleCloseSummaryDialog = () => {\n      summaryDialogVisible.value = false\n    }\n    \n    const handleSummarize = async () => {\n      if (!selectedContact.value) {\n        ElMessage.warning('请先选择一个聊天');\n        return;\n      }\n      if (!summaryDateRange.value || summaryDateRange.value.length !== 2) {\n        ElMessage.warning('请选择一个有效的时间范围');\n        return;\n      }\n\n      summaryLoading.value = true;\n      summaryContent.value = ''; // Reset before fetching\n\n      const [startDate, endDate] = summaryDateRange.value;\n\n      try {\n        // 'summarizeChat' returns the full axios response\n        const response = await summarizeChat(selectedContact.value, startDate.toISOString(), endDate.toISOString());\n        \n        // The actual data from the backend is in response.data\n        const summary = response.data.summary;\n\n        if (summary) {\n          // If we have a summary, display it\n          summaryContent.value = summary;\n        } else {\n          // If the summary is empty or not present, display a clear message\n          summaryContent.value = '在选定时间范围内没有可总结的消息，或AI未能生成摘要。';\n        }\n      } catch (error) {\n        console.error('Summarization error:', error);\n        summaryContent.value = '生成摘要时遇到错误，请检查后台日志或稍后再试。';\n        ElMessage.error('生成摘要失败，请稍后再试');\n      } finally {\n        summaryLoading.value = false;\n      }\n    };\n    \n    // 替换图片预览方法\n    const expandedImage = ref(null)\n\n    // 切换图片放大显示\n    const toggleImageExpand = (imageUrl) => {\n      expandedImage.value = imageUrl\n    }\n    \n    const getFileName = (fullName) => {\n      if (!fullName) return '';\n      const lastDot = fullName.lastIndexOf('.');\n      if (lastDot === -1 || lastDot === 0) {\n        return fullName;\n      }\n      return fullName.substring(0, lastDot);\n    };\n\n    const getFileExtension = (fullName) => {\n      if (!fullName) return '';\n      const lastDot = fullName.lastIndexOf('.');\n      if (lastDot === -1 || lastDot === 0 || lastDot >= fullName.length - 1) {\n        return '';\n      }\n      return fullName.substring(lastDot); // includes the dot\n    };\n    \n    // 右键菜单相关\n    const contextMenuVisible = ref(false)\n    const contextMenuStyle = ref({\n      top: '0px',\n      left: '0px'\n    })\n    const selectedMessage = ref(null)\n    \n    // 处理右键菜单打开\n    const openContextMenu = (event, message) => {\n      event.preventDefault()\n      // 保存点击位置\n      contextMenuStyle.value = {\n        top: `${event.clientY}px`,\n        left: `${event.clientX}px`\n      }\n      // 保存选中的消息\n      selectedMessage.value = message\n      // 显示菜单\n      contextMenuVisible.value = true\n      \n      // 添加全局点击事件监听器关闭菜单\n      document.addEventListener('click', closeContextMenu, { once: true })\n    }\n    \n    // 关闭右键菜单\n    const closeContextMenu = () => {\n      contextMenuVisible.value = false\n    }\n    \n    // 复制消息内容\n    const copyMessageContent = () => {\n      if (!selectedMessage.value) return\n      \n      const content = selectedMessage.value.content || ''\n      navigator.clipboard.writeText(content)\n        .then(() => {\n          ElMessage.success('内容已复制到剪贴板')\n          closeContextMenu()\n        })\n        .catch(err => {\n          ElMessage.error('复制失败: ' + err)\n        })\n    }\n    \n    // 日程对话框相关\n    const calendarDialogVisible = ref(false);\n    const isAnalyzing = ref(false);\n    const isSubmitting = ref(false);\n    const calendarFormRef = ref(null); // Ref for the form\n    const calendarEvent = reactive({\n      title: '',\n      start: '',\n      end: '',\n      location: '',\n      type: 'blue',\n      reminder: '30min',\n      description: '',\n    });\n    \n    // Validation rules for the calendar form\n    const calendarRules = reactive({\n      title: [{ required: true, message: '请输入日程标题', trigger: 'blur' }],\n      start: [{ required: true, message: '请选择开始时间', trigger: 'change' }],\n      end: [{ required: true, message: '请选择结束时间', trigger: 'change' }],\n      location: [{ required: true, message: '请输入地点', trigger: 'blur' }],\n      type: [{ required: true, message: '请选择日程类型', trigger: 'change' }],\n      reminder: [{ required: true, message: '请选择提醒时间', trigger: 'change' }],\n      description: [{ required: true, message: '请输入描述信息', trigger: 'blur' }],\n    });\n    \n    // 自定义验证规则\n    const validateEndTime = (rule, value, callback) => {\n      if (!value) {\n        // 'required' rule will handle this\n        callback();\n      } else if (calendarEvent.start) {\n        const startDate = new Date(calendarEvent.start);\n        const endDate = new Date(value);\n        if (endDate <= startDate) {\n          callback(new Error('结束时间必须晚于开始时间'));\n        } else if (startDate.toDateString() !== endDate.toDateString()) {\n          callback(new Error('开始和结束时间必须是同一天'));\n        } else {\n          callback();\n        }\n      } else {\n        callback();\n      }\n    };\n\n    // 监听开始时间变化，以触发结束时间的验证\n    watch(() => calendarEvent.start, (newValue) => {\n      if (newValue && calendarFormRef.value) {\n        calendarFormRef.value.validateField('end');\n      }\n    });\n\n    // 更新验证规则\n    calendarRules.end = [\n      { required: true, message: '请选择结束时间', trigger: 'change' },\n      { validator: validateEndTime, trigger: 'change' }\n    ];\n    \n    // 从消息添加到日程\n    const addToCalendarFromMessage = async () => {\n      if (!selectedMessage.value) {\n        ElMessage.warning('无法识别消息');\n        return;\n      }\n      \n      isAnalyzing.value = true;\n      calendarDialogVisible.value = true;\n      \n      try {\n        const messageContent = selectedMessage.value.content;\n        const response = await analyzeForCalendar(messageContent);\n        \n        console.log('AI日程分析响应:', response);\n        \n        // 修复数据结构处理方式\n        const eventData = response?.data?.data || response?.data;\n        \n        if (!eventData || typeof eventData !== 'object') {\n            console.error(\"AI分析未能返回有效的日程数据。\", response);\n            ElMessage.warning('AI未能自动识别日程，请手动填写。');\n            // Populate with default values for manual entry\n            calendarEvent.title = '';\n            calendarEvent.start = formatDate(new Date(), 'YYYY-MM-DD HH:mm:ss');\n            calendarEvent.end = formatDate(new Date(Date.now() + 60*60*1000), 'YYYY-MM-DD HH:mm:ss');\n            calendarEvent.location = '';\n            calendarEvent.type = 'blue';\n            calendarEvent.reminder = '30min';\n            calendarEvent.description = messageContent || '';\n            calendarEvent.is_all_day = false;\n        } else {\n            console.log('AI成功识别日程数据:', eventData);\n            // Populate with data from AI\n            calendarEvent.title = eventData.title || '';\n            calendarEvent.start = eventData.start || formatDate(new Date(), 'YYYY-MM-DD HH:mm:ss');\n            calendarEvent.end = eventData.end || formatDate(new Date(Date.now() + 60*60*1000), 'YYYY-MM-DD HH:mm:ss');\n            calendarEvent.location = eventData.location || '';\n            calendarEvent.type = eventData.type || 'blue';\n            calendarEvent.reminder = eventData.reminder || '30min';\n            calendarEvent.description = eventData.description || messageContent || '';\n            calendarEvent.is_all_day = eventData.is_all_day || false;\n            \n            // 添加参与者处理\n            if (eventData.participants && Array.isArray(eventData.participants)) {\n                calendarEvent.participants = eventData.participants;\n            } else {\n                calendarEvent.participants = userId.value ? [userId.value] : [];\n            }\n        }\n      } catch (error) {\n        console.error('获取日程信息失败:', error);\n        ElMessage.error('AI分析失败，请手动填写日程。');\n        // Populate with default values on API error\n        calendarEvent.title = '';\n        calendarEvent.start = formatDate(new Date(), 'YYYY-MM-DD HH:mm:ss');\n        calendarEvent.end = formatDate(new Date(Date.now() + 60*60*1000), 'YYYY-MM-DD HH:mm:ss');\n        calendarEvent.location = '';\n        calendarEvent.type = 'blue';\n        calendarEvent.reminder = '30min';\n        calendarEvent.description = selectedMessage.value?.content || '';\n        calendarEvent.is_all_day = false;\n      } finally {\n        isAnalyzing.value = false;\n        closeContextMenu();\n      }\n    };\n    \n    // 添加日程\n    const submitCalendarEvent = async () => {\n      if (!calendarFormRef.value) return;\n      await calendarFormRef.value.validate(async (valid) => {\n        if (valid) {\n          isSubmitting.value = true;\n          try {\n            const eventData = { ...calendarEvent };\n            if (!eventData.participants) {\n                eventData.participants = [];\n            }\n            if (userId.value && !eventData.participants.includes(userId.value)) {\n                eventData.participants.push(userId.value);\n            }\n\n            await createCalendarEvent(eventData);\n            \n            ElMessage.success('日程添加成功');\n            calendarDialogVisible.value = false;\n          } catch (error) {\n            ElMessage.error('添加日程失败: ' + (error.response?.data?.error || error.message));\n          } finally {\n            isSubmitting.value = false;\n          }\n        } else {\n          ElMessage.error('请填写所有必填项');\n          return false;\n        }\n      });\n    };\n    \n    // 全局点击事件监听 - 用于处理组件外部点击关闭右键菜单\n    onMounted(() => {\n      document.addEventListener('click', (event) => {\n        // 如果点击位置不在右键菜单内，关闭菜单\n        if (contextMenuVisible.value) {\n          const menuEl = document.querySelector('.chat-context-menu')\n          if (menuEl && !menuEl.contains(event.target)) {\n            contextMenuVisible.value = false\n          }\n        }\n      })\n    })\n    \n    return {\n      searchQuery,\n      activeTab,\n      selectedContact,\n      tabs,\n      contacts,\n      currentContact,\n      filteredContacts,\n      messages,\n      messageInput,\n      messageContainer,\n      fileInput,\n      imageInput,\n      currentUser,\n      userInfo,\n      userId,\n      knowledgeDialogVisible,\n      knowledgeLoading,\n      knowledgeList,\n      sessionsLoading,\n      messagesLoading,\n      // 图标\n      Search,\n      Document,\n      PictureFilled,\n      FolderOpened,\n      Microphone,\n      Position,\n      ChatDotSquare,\n      Reading,\n      UserFilled,\n      ChatLineSquare,\n      Refresh,\n      // 方法\n      sendMessage,\n      getStatusText,\n      selectContact,\n      openFileUpload,\n      openImageUpload,\n      handleFileUpload,\n      handleImageUpload,\n      openKnowledgeDialog,\n      selectKnowledge,\n      shareKnowledge,\n      downloadFile,\n      viewKnowledge,\n      getSenderColor,\n      getSenderInitial,\n      formatMessageTime,\n      formatDate,\n      formatFileSize,\n      refreshChatSessions,\n      forceRefresh,\n      groupedUsersByDepartment,\n      getActiveContacts,\n      loadAllUsers,\n      loadDepartments,\n      selectedDocumentIds,\n      fileUploading,\n      imageUploading,\n      summaryDialogVisible,\n      summaryDateRange,\n      summaryContent,\n      summaryLoading,\n      pickerOptions,\n      openSummaryDialog,\n      handleCloseSummaryDialog,\n      handleSummarize,\n      expandedImage,\n      toggleImageExpand,\n      getFileName,\n      getFileExtension,\n      contextMenuVisible,\n      contextMenuStyle,\n      openContextMenu,\n      copyMessageContent,\n      addToCalendarFromMessage,\n      calendarDialogVisible,\n      calendarEvent,\n      isAnalyzing,\n      isSubmitting,\n      submitCalendarEvent,\n      calendarFormRef,\n      calendarRules\n    }\n  }\n}\n</script>\n\n<style scoped>\n.chat-container {\n  height: calc(100vh - 64px); /* 减去顶部导航栏的高度 */\n  width: 100%;\n  padding: 20px;\n  overflow: hidden;\n  box-sizing: border-box;\n  background-color: transparent;\n}\n\n.chat-card {\n  height: 100%;\n  width: 100%;\n  border-radius: 8px;\n  margin: 0;\n  overflow: hidden;\n  box-shadow: 0 2px 12px var(--shadow-color) !important;\n  background-color: transparent;\n}\n\n.chat-card :deep(.el-card__body) {\n  height: 100%;\n  padding: 0;\n  background-color: transparent;\n}\n\n.chat-layout {\n  display: flex;\n  height: 100%;\n  width: 100%;\n  background-color: transparent;\n}\n\n/* 侧边栏样式 */\n.chat-sidebar {\n  width: 280px;\n  border-right: 1px solid var(--border-color);\n  display: flex;\n  flex-direction: column;\n  background-color: var(--bg-color);\n  height: 100%;\n  overflow: hidden;\n}\n\n.search-box {\n  padding: 15px;\n  border-bottom: 1px solid var(--border-color);\n}\n\n.chat-tabs {\n  display: flex;\n  border-bottom: 1px solid var(--border-color);\n}\n\n.chat-tab {\n  flex: 1;\n  text-align: center;\n  padding: 12px;\n  cursor: pointer;\n  font-weight: 500;\n  color: var(--text-color-secondary);\n  transition: all 0.3s ease;\n}\n\n.chat-tab.active {\n  color: var(--el-color-primary);\n  border-bottom: 2px solid var(--el-color-primary);\n}\n\n.contacts-list {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0;\n}\n\n.contact-item {\n  display: flex;\n  padding: 15px;\n  border-bottom: 1px solid var(--border-color-light);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  border-color: var(--border-color);\n}\n\n.contact-item:hover {\n  background-color: var(--hover-color);\n}\n\n.contact-item.active {\n  background-color: var(--primary-color-light, #f0f7ff);\n}\n\n.contact-avatar {\n  position: relative;\n  margin-right: 12px;\n}\n\n.avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  font-weight: bold;\n}\n\n.avatar.small {\n  width: 32px;\n  height: 32px;\n  font-size: 12px;\n}\n\n.avatar-initial {\n  font-size: 16px;\n}\n\n.contact-status {\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  border: 2px solid var(--bg-color);\n}\n\n.status-online {\n  background-color: #28a745;\n}\n\n.status-offline {\n  background-color: #6c757d;\n}\n\n.status-busy {\n  background-color: #dc3545;\n}\n\n.status-away {\n  background-color: #fd7e14;\n}\n\n.contact-info {\n  flex: 1;\n  overflow: hidden;\n}\n\n.contact-name {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 5px;\n}\n\n.contact-name span {\n  font-weight: 500;\n}\n\n.time {\n  font-size: 12px;\n  color: var(--text-color-tertiary);\n}\n\n.contact-message {\n  display: flex;\n  justify-content: space-between;\n  color: var(--text-color-secondary);\n  font-size: 13px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  position: relative;\n  padding-right: 30px; \n}\n\n.message-badge {\n  position: absolute;\n  right: 5px;\n  top: 0;\n  height: 100%;\n  display: flex;\n  align-items: center;\n}\n\n.message-badge :deep(.el-badge__content) {\n  position: static !important;\n  transform: none !important;\n}\n\n/* 聊天内容样式 */\n.chat-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  overflow: hidden;\n  background-color: transparent;\n}\n\n.chat-header {\n  display: flex;\n  align-items: center;\n  padding: 15px;\n  border-bottom: 1px solid var(--border-color);\n  background-color: var(--bg-color);\n}\n\n.chat-header .contact-info {\n  margin-right: auto;\n}\n\n.chat-header h6 {\n  margin: 0;\n  font-size: 16px;\n  color: var(--text-color);\n}\n\n.chat-header p {\n  margin: 0;\n  font-size: 12px;\n  color: var(--text-color-tertiary);\n}\n\n.chat-actions {\n  display: flex;\n  gap: 10px;\n  align-items: center;\n  margin-left: auto;\n  padding-right: 15px;\n}\n\n.chat-messages {\n  flex: 1;\n  overflow-y: auto;\n  padding: 20px;\n  max-height: calc(100% - 150px); \n  display: flex;\n  flex-direction: column;\n  background-color: transparent;\n}\n\n.message {\n  margin-bottom: 15px;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  background-color: transparent;\n}\n\n.message-container {\n  width: 100%;\n  display: flex;\n  background-color: transparent;\n}\n\n.message-sent .message-container {\n  flex-direction: row-reverse;\n}\n\n.message-avatar {\n  margin-right: 10px;\n  flex-shrink: 0;\n}\n\n.message-sent .message-avatar {\n  margin-right: 0;\n  margin-left: 10px;\n}\n\n.message-content-wrapper {\n  max-width: 100%;\n  width: auto;\n}\n\n.message-content {\n  padding: 0;\n  border-radius: 0;\n  background-color: transparent;\n  max-width: 280px;\n  width: 100%;\n}\n\n.message-content.received {\n  background-color: transparent;\n  border: none;\n}\n\n.message-content.sent {\n  background-color: transparent;\n  border: none;\n}\n\n.message-time {\n  font-size: 12px;\n  color: var(--text-color-tertiary);\n  margin-top: 5px;\n  text-align: right;\n}\n\n.message-sent .message-time {\n  text-align: right;\n}\n\n.message-received .message-time {\n  text-align: left;\n}\n\n.image-card {\n  width: 100%;\n  max-width: 280px;\n  background-color: transparent;\n  border-radius: 8px;\n  margin: 5px 0;\n  overflow: hidden;\n}\n\n.message-sent .image-card {\n  margin-left: auto;\n}\n\n.image-card-inner {\n  display: flex;\n  flex-direction: column;\n}\n\n.image-preview {\n  width: 100%;\n  height: 180px;\n  overflow: hidden;\n  border-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.image-preview img {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  cursor: pointer;\n  transition: transform 0.3s ease;\n}\n\n.image-preview img:hover {\n  transform: scale(1.03);\n}\n\n.file-card {\n  width: 100%;\n  max-width: 280px;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  margin: 5px 0;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  border: none;\n}\n\n.message-sent .file-card {\n  margin-left: auto;\n}\n\n.file-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.file-card-inner {\n  display: flex;\n  align-items: center;\n  padding: 15px;\n}\n\n.file-icon {\n  width: 40px;\n  height: 40px;\n  border-radius: 8px;\n  background-color: var(--el-color-primary-light-9);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 12px;\n}\n\n.file-icon .el-icon {\n  font-size: 24px;\n  color: var(--el-color-primary);\n}\n\n/* 增强深色模式下的文件图标可见性 */\n:root[data-theme=\"dark\"] .file-icon .el-icon,\nbody[data-theme=\"dark\"] .file-icon .el-icon {\n  color: #4db8ff !important;\n  font-size: 26px !important;\n  filter: drop-shadow(0 0 2px rgba(77, 184, 255, 0.5)) !important;\n}\n\n.file-info {\n  flex: 1;\n  overflow: hidden;\n}\n\n.file-name {\n  font-weight: 500;\n  color: var(--text-color);\n  margin-bottom: 4px;\n  display: flex;\n  align-items: baseline;\n  overflow: hidden;\n}\n\n.file-name-main {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  flex-shrink: 1;\n}\n\n.file-name-ext {\n  white-space: nowrap;\n  flex-shrink: 0;\n}\n\n.file-meta {\n  display: flex;\n  justify-content: space-between;\n  font-size: 12px;\n}\n\n.file-size {\n  color: var(--text-color-secondary);\n}\n\n.file-download-hint {\n  color: var(--el-color-primary);\n}\n\n.knowledge-card {\n  width: 100%;\n  max-width: 280px;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  margin: 5px 0;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  border: none;\n}\n\n.message-sent .knowledge-card {\n  margin-left: auto;\n}\n\n.knowledge-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.knowledge-card-inner {\n  display: flex;\n  padding: 15px;\n}\n\n.knowledge-icon {\n  width: 40px;\n  height: 40px;\n  border-radius: 8px;\n  background-color: var(--el-color-success-light-9);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 12px;\n  flex-shrink: 0;\n}\n\n.knowledge-icon .el-icon {\n  font-size: 24px;\n  color: var(--el-color-success);\n}\n\n.knowledge-content {\n  flex: 1;\n  overflow: hidden;\n}\n\n.knowledge-title {\n  font-weight: 500;\n  color: var(--text-color);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin-bottom: 4px;\n}\n\n.knowledge-desc {\n  color: var(--text-color-secondary);\n  font-size: 12px;\n  margin-bottom: 8px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n}\n\n.knowledge-footer {\n  display: flex;\n  justify-content: space-between;\n  font-size: 12px;\n}\n\n.knowledge-type {\n  color: var(--text-color-tertiary);\n  background-color: var(--bg-color-tertiary);\n  padding: 2px 8px;\n  border-radius: 4px;\n}\n\n.knowledge-view {\n  color: var(--el-color-primary);\n}\n\n.chat-input {\n  padding: 15px;\n  background-color: var(--bg-color);\n  border-top: 1px solid var(--border-color);\n  display: flex;\n  flex-direction: column;\n  min-height: 150px; /* 确保输入框有足够高度 */\n}\n\n.chat-tools {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 10px;\n}\n\n.input-area {\n  margin-bottom: 10px;\n  flex: 1;\n}\n\n.send-button {\n  display: flex;\n  justify-content: flex-end;\n}\n\n.empty-chat {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: #999;\n}\n\n.empty-illustration {\n  margin-bottom: 20px;\n  color: #ddd;\n}\n\n.empty-chat h4 {\n  margin: 0 0 10px;\n}\n\n.empty-chat p {\n  margin: 0;\n  font-size: 14px;\n}\n\n.empty-contacts {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: #999;\n}\n\n.empty-icon {\n  margin-bottom: 20px;\n  color: #ddd;\n}\n\n.empty-contacts h4 {\n  margin: 0 0 10px;\n}\n\n.empty-contacts p {\n  margin: 0;\n  font-size: 14px;\n}\n\n.loading-container {\n  flex: 1;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.empty-messages {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n}\n\n.loading-messages {\n  flex: 1;\n  padding: 20px;\n}\n\n.mt-3 {\n  margin-top: 15px;\n}\n\n.search-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.search-header .el-input {\n  flex: 1;\n}\n\n.chat-header-actions {\n  margin-bottom: 10px;\n}\n\n.refresh-action {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-top: 5px;\n}\n\n.department-group {\n  margin-bottom: 10px;\n  border-color: var(--border-color);\n}\n\n.department-header {\n  padding: 5px 15px;\n  font-size: 13px;\n  color: var(--text-color-secondary);\n  background-color: var(--bg-color-tertiary);\n  border-radius: 4px;\n  margin-bottom: 5px;\n  font-weight: 500;\n  background-color: var(--bg-color-tertiary) !important;\n}\n\n.group-actions {\n  display: flex;\n  align-items: center;\n  margin-left: auto;\n  margin-right: 5px;\n}\n\n.group-action-btn {\n  padding: 6px;\n  color: #909399;\n}\n\n.group-action-btn:hover {\n  color: #409EFF;\n}\n\n/* 添加对话框全局样式以适配深色模式 */\n:deep(.el-dialog) {\n  background-color: var(--bg-color);\n  color: var(--text-color);\n}\n\n:deep(.el-dialog__title) {\n  color: var(--text-color);\n}\n\n:deep(.el-dialog__body) {\n  color: var(--text-color);\n}\n\n/* 表格样式适配深色模式 */\n:deep(.el-table) {\n  background-color: var(--bg-color);\n  color: var(--text-color);\n}\n\n:deep(.el-table th.el-table__cell) {\n  background-color: var(--bg-color-tertiary);\n}\n\n:deep(.el-table tr) {\n  background-color: var(--bg-color);\n}\n\n:deep(.el-table td.el-table__cell) {\n  background-color: var(--bg-color);\n  border-bottom: 1px solid var(--border-color);\n}\n\n/* 修复输入框和下拉菜单 */\n:deep(.el-select .el-input__wrapper) {\n  background-color: var(--bg-color-secondary);\n}\n\n:deep(.el-select-dropdown) {\n  background-color: var(--bg-color-secondary);\n  border-color: var(--border-color);\n}\n\n:deep(.el-select-dropdown__item) {\n  color: var(--text-color);\n}\n\n:deep(.el-select-dropdown__item.hover),\n:deep(.el-select-dropdown__item:hover) {\n  background-color: var(--hover-color);\n}\n\n:deep(.el-input__wrapper) {\n  background-color: var(--bg-color-secondary) !important;\n  box-shadow: 0 0 0 1px var(--border-color) inset;\n}\n\n:deep(.el-input__inner) {\n  color: var(--text-color);\n}\n\n:deep(.el-select__input) {\n  color: var(--text-color) !important;\n}\n\n:deep(.el-textarea__inner) {\n  background-color: var(--bg-color-secondary);\n  color: var(--text-color);\n  border-color: var(--border-color);\n}\n\n/* 修复空白提示和图标颜色 */\n.empty-icon {\n  color: var(--text-color-tertiary);\n}\n\n:deep(.el-icon) {\n  color: inherit;\n}\n\n:deep(.el-button--primary) {\n  color: white;\n}\n\n.chat-header h6 {\n  color: var(--text-color);\n}\n\n/* 修复badge和标签 */\n:deep(.el-badge__content) {\n  background-color: var(--error-color, #ef4444);\n}\n\n:deep(.el-tag) {\n  background-color: var(--primary-color-light);\n  border-color: var(--primary-color-light);\n  color: var(--primary-color);\n}\n\n/* 修复下拉菜单的样式 */\n:deep(.el-popper.is-light) {\n  background-color: var(--bg-color-tertiary);\n  border-color: var(--border-color);\n}\n\n:deep(.el-popper__arrow::before) {\n  background-color: var(--bg-color-tertiary);\n  border-color: var(--border-color);\n}\n\n/* 修复搜索框内图标颜色 */\n.search-box :deep(.el-input__prefix-inner) {\n  color: var(--text-color-tertiary);\n}\n\n/* 修复表单组件 */\n:deep(.el-input),\n:deep(.el-select) {\n  --el-fill-color-blank: var(--bg-color-tertiary);\n  --el-text-color-regular: var(--text-color);\n  --el-border-color: var(--border-color);\n  --el-border-color-hover: var(--primary-color);\n  --el-fill-color-light: var(--bg-color-tertiary);\n}\n\n/* 修复部门组标题 */\n.department-header {\n  background-color: var(--bg-color-tertiary) !important;\n}\n\n/* 修复El-Card组件样式 */\n:deep(.el-card) {\n  --el-card-bg-color: var(--bg-color);\n  background-color: var(--bg-color);\n  color: var(--text-color);\n  border-color: var(--border-color);\n}\n\n/* 修复El-Alert样式 */\n:deep(.el-alert) {\n  --el-alert-bg-color: var(--bg-color-tertiary);\n  color: var(--text-color);\n}\n\n:deep(.el-alert--info) {\n  --el-alert-bg-color: var(--bg-color-tertiary);\n}\n\n:deep(.el-empty__image svg) {\n  fill: var(--text-color-tertiary);\n}\n\n/* 修复下拉菜单 */\n:deep(.el-dropdown-menu) {\n  background-color: var(--bg-color-tertiary);\n  border-color: var(--border-color);\n}\n\n:deep(.el-dropdown-menu__item) {\n  color: var(--text-color);\n}\n\n:deep(.el-dropdown-menu__item:hover) {\n  background-color: var(--hover-color);\n}\n\n:deep(.el-dropdown-menu__item--divided:before) {\n  background-color: var(--border-color);\n}\n\n:deep(.el-dropdown-menu__item.is-disabled) {\n  color: var(--text-color-tertiary);\n}\n\n:deep(.el-divider) {\n  background-color: var(--border-color);\n}\n\n/* 修复消息框 */\n:deep(.el-message-box) {\n  background-color: var(--bg-color);\n  border-color: var(--border-color);\n}\n\n:deep(.el-message-box__title) {\n  color: var(--text-color);\n}\n\n:deep(.el-message-box__message) {\n  color: var(--text-color);\n}\n\n:deep(.el-message) {\n  background-color: var(--bg-color);\n  border-color: var(--border-color);\n}\n\n:deep(.el-message__content) {\n  color: var(--text-color);\n}\n\n/* 修复输入区域的阴影 */\n.el-textarea__wrapper {\n  box-shadow: 0 0 0 1px var(--border-color) inset !important;\n}\n\n.summary-content-wrapper {\n  margin-top: 10px;\n  border: 1px solid #e4e7ed;\n  border-radius: 8px;\n  overflow: hidden;\n}\n\n.summary-title {\n  border-radius: 0;\n  border-bottom: 1px solid #e4e7ed;\n}\n\n.summary-content {\n  padding: 15px;\n  background-color: #fafafa;\n  min-height: 150px;\n  max-height: 40vh;\n  overflow-y: auto;\n}\n\n/* 全屏图片预览样式 */\n.fullscreen-image-preview {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.9);\n  z-index: 20003; /* 确保在导航栏之上 */\n  overflow: auto;\n  text-align: center;\n  padding: 0;\n  font-size: 0; /* 消除因行高导致的垂直间隙 */\n  cursor: pointer;\n}\n\n.fullscreen-preview-image {\n  margin: 0; /* 确保图片没有外边距 */\n  /* 图片将使用其自然尺寸 */\n}\n\n/* 文本卡片样式 */\n.text-card {\n  max-width: 280px;\n  margin: 5px 0;\n  overflow: hidden;\n  border-radius: 8px;\n  background-color: #fff;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}\n\n.message-sent .text-card {\n  margin-left: auto;\n}\n\n.text-card-inner {\n  padding: 12px 15px;\n  word-break: break-word;\n}\n\n.received .text-card {\n  background-color: #fff;\n}\n\n.sent .text-card {\n  background-color: var(--el-color-primary);\n  color: white;\n}\n\n/* 消息内容样式 */\n.message-content {\n  padding: 0;\n  border-radius: 0;\n  background-color: transparent;\n  max-width: 280px;\n  width: 100%;\n}\n\n.message-content-wrapper {\n  max-width: 100%;\n  width: auto;\n}\n\n/* 统一所有卡片样式 */\n.image-card, .file-card, .knowledge-card, .text-card {\n  width: 100%;\n  max-width: 280px;\n  margin: 5px 0;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  border-radius: 8px;\n}\n\n.message-sent .image-card,\n.message-sent .file-card,\n.message-sent .knowledge-card,\n.message-sent .text-card {\n  margin-left: auto;\n}\n\n/* 文件卡片深色模式样式增强 */\n.file-card {\n  width: 100%;\n  max-width: 280px;\n  background-color: #fff;\n  color: #333;\n  border-radius: 8px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n  margin: 5px 0;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  border: none;\n}\n\n/* 深色模式下的文件卡片样式 */\n:root[data-theme=\"dark\"] .file-card,\nbody[data-theme=\"dark\"] .file-card {\n  background-color: #2a2a2a !important;\n  border: 1px solid #3a3a3a !important;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25) !important;\n}\n\n:root[data-theme=\"dark\"] .file-name,\nbody[data-theme=\"dark\"] .file-name {\n  color: #e0e0e0 !important;\n}\n\n:root[data-theme=\"dark\"] .file-size,\nbody[data-theme=\"dark\"] .file-size {\n  color: #aaa !important;\n}\n\n:root[data-theme=\"dark\"] .file-download-hint,\nbody[data-theme=\"dark\"] .file-download-hint {\n  color: #4db8ff !important;\n  font-weight: 500 !important;\n}\n\n:root[data-theme=\"dark\"] .file-icon,\nbody[data-theme=\"dark\"] .file-icon {\n  background-color: #3a3a3a !important;\n}\n\n:root[data-theme=\"dark\"] .file-card:hover,\nbody[data-theme=\"dark\"] .file-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4) !important;\n  background-color: #323232 !important;\n}\n\n/* 确保文件名称在深色模式下高对比度 */\n:root[data-theme=\"dark\"] .file-name-main,\n:root[data-theme=\"dark\"] .file-name-ext,\nbody[data-theme=\"dark\"] .file-name-main,\nbody[data-theme=\"dark\"] .file-name-ext {\n  color: #fff !important;\n  text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5) !important;\n}\n\n/* 移除旧的文本消息样式 */\n.message-content span {\n  padding: 0;\n  border-radius: 0;\n  display: inline;\n  background-color: transparent;\n  color: inherit;\n}\n\n.file-name-ext {\n  white-space: nowrap;\n  flex-shrink: 0;\n}\n\n.file-card,\n.knowledge-card {\n  min-height: 80px;\n  display: flex;\n  align-items: center;\n}\n\n.file-card-inner,\n.knowledge-card-inner {\n  width: 100%;\n}\n\n/* 右键菜单样式 */\n.chat-context-menu {\n  position: fixed;\n  background: #fff;\n  border-radius: 4px;\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n  min-width: 150px;\n  z-index: 9999;\n  padding: 5px 0;\n}\n\n.context-menu-item {\n  padding: 8px 15px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n}\n\n.context-menu-item:hover {\n  background-color: #f5f7fa;\n}\n\n.context-menu-item .el-icon {\n  margin-right: 8px;\n  font-size: 16px;\n}\n</style> "],"mappings":"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","ignoreList":[]}]}