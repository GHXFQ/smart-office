{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\dashboard\\Index.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\dashboard\\Index.vue","mtime":1752411437079},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746431218000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5zb21lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybC1zZWFyY2gtcGFyYW1zLmRlbGV0ZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwtc2VhcmNoLXBhcmFtcy5oYXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLXNlYXJjaC1wYXJhbXMuc2l6ZS5qcyI7CmltcG9ydCB7IHJlZiwgbmV4dFRpY2ssIGNvbXB1dGVkLCBvbk1vdW50ZWQsIHdhdGNoIH0gZnJvbSAndnVlJzsKaW1wb3J0IHsgVXBsb2FkRmlsbGVkLCBEb2N1bWVudCwgQ2xvc2UsIENoZWNrLCBEZWxldGUsIERhdGFBbmFseXNpcywgQ3B1LCBNYWdpY1N0aWNrLCBDaGF0TGluZVNxdWFyZSwgRm9sZCwgRXhwYW5kLCBDYWxlbmRhciwgQ2hhdERvdFJvdW5kLCBDb2xsZWN0aW9uLCBEb2N1bWVudENvcHksIEdyaWQsIENvbm5lY3Rpb24sIENpcmNsZUNoZWNrRmlsbGVkLCBJbmZvRmlsbGVkLCBDaXJjbGVDbG9zZUZpbGxlZCwgV2FybmluZ0ZpbGxlZCwgRWRpdFBlbiB9IGZyb20gJ0BlbGVtZW50LXBsdXMvaWNvbnMtdnVlJzsKaW1wb3J0IHJlcXVlc3QgZnJvbSAnQC91dGlscy9yZXF1ZXN0JzsKaW1wb3J0IHsgbWFya2VkIH0gZnJvbSAnbWFya2VkJzsKaW1wb3J0IHsgRWxNZXNzYWdlLCBFbE1lc3NhZ2VCb3ggfSBmcm9tICdlbGVtZW50LXBsdXMnOwppbXBvcnQgeyBhaUNoYXRXaXRoRG9jdW1lbnRzU3RyZWFtLCBnZXRBSUNoYXRTZXNzaW9ucywgZ2V0QUlDaGF0U2Vzc2lvbiwgZGVsZXRlQUlDaGF0U2Vzc2lvbiB9IGZyb20gJ0AvYXBpL2FpJzsKaW1wb3J0IHsgZGVsZXRlQ2FsZW5kYXJFdmVudCB9IGZyb20gJ0AvYXBpL2NhbGVuZGFyJzsgLy8g5paw5aKe5a+85YWlCmltcG9ydCB7IGdldEN1cnJlbnRJbnN0YW5jZSB9IGZyb20gJ3Z1ZSc7CmltcG9ydCB7IGdldENhbGVuZGFyRXZlbnQsIHVwZGF0ZUV2ZW50IH0gZnJvbSAnQC9hcGkvY2FsZW5kYXInOyAvLyDmlrDlop7lr7zlhaUKCmZ1bmN0aW9uIGZvcm1hdFNpemUoc2l6ZSkgewogIGlmIChzaXplIDwgMTAyNCkgcmV0dXJuIHNpemUgKyAnQic7CiAgaWYgKHNpemUgPCAxMDI0ICogMTAyNCkgcmV0dXJuIChzaXplIC8gMTAyNCkudG9GaXhlZCgxKSArICdLQic7CiAgcmV0dXJuIChzaXplIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMSkgKyAnTUInOwp9CmZ1bmN0aW9uIGdldEV4dChuYW1lKSB7CiAgY29uc3QgYXJyID0gbmFtZS5zcGxpdCgnLicpOwogIHJldHVybiBhcnIubGVuZ3RoID4gMSA/IGFyclthcnIubGVuZ3RoIC0gMV0udG9Mb3dlckNhc2UoKSA6ICcnOwp9CmZ1bmN0aW9uIGdldEZpbGVMYWJlbCh0eXBlLCBleHQpIHsKICBjb25zdCBleHRfbG93ZXIgPSBleHQudG9Mb3dlckNhc2UoKTsKICBpZiAodHlwZS5zdGFydHNXaXRoKCdpbWFnZS8nKSkgcmV0dXJuICflm77niYcnOwogIGlmIChleHRfbG93ZXIgPT09ICdwZGYnKSByZXR1cm4gJ1BERic7CiAgaWYgKFsnY3N2JywgJ3hscycsICd4bHN4J10uaW5jbHVkZXMoZXh0X2xvd2VyKSkgcmV0dXJuICfooajmoLwnOwogIGlmIChbJ2RvYycsICdkb2N4J10uaW5jbHVkZXMoZXh0X2xvd2VyKSkgcmV0dXJuICfmlofmoaMnOwogIGlmIChleHRfbG93ZXIgPT09ICdtZCcpIHJldHVybiAnTWFya2Rvd24nOwogIGlmIChleHRfbG93ZXIgPT09ICd0eHQnKSByZXR1cm4gJ+aWh+acrCc7CiAgcmV0dXJuIGV4dF9sb3dlci50b1VwcGVyQ2FzZSgpOwp9CmZ1bmN0aW9uIGdldEZpbGVCZyhleHQpIHsKICBjb25zdCBleHRfbG93ZXIgPSBleHQudG9Mb3dlckNhc2UoKTsKICBpZiAoZXh0X2xvd2VyID09PSAncGRmJykgcmV0dXJuICcjZjg3MTcxJzsgLy8g57qi6ImyCiAgaWYgKFsnY3N2JywgJ3hscycsICd4bHN4J10uaW5jbHVkZXMoZXh0X2xvd2VyKSkgcmV0dXJuICcjMzRkMzk5JzsgLy8g57u/6ImyCiAgaWYgKFsnZG9jJywgJ2RvY3gnXS5pbmNsdWRlcyhleHRfbG93ZXIpKSByZXR1cm4gJyM2MGE1ZmEnOyAvLyDok53oibIKICBpZiAoZXh0X2xvd2VyID09PSAnbWQnKSByZXR1cm4gJyNhNzhiZmEnOyAvLyDntKvoibIKICBpZiAoZXh0X2xvd2VyID09PSAndHh0JykgcmV0dXJuICcjZmJiZjI0JzsgLy8g6buE6ImyCiAgcmV0dXJuICcjYTViNGZjJzsgLy8g6buY6K6k5reh57Sr6ImyCn0KZnVuY3Rpb24gZXNjYXBlSHRtbChodG1sKSB7CiAgcmV0dXJuIGh0bWwucmVwbGFjZSgvWyY8PiInXS9nLCBmdW5jdGlvbiAobSkgewogICAgcmV0dXJuIHsKICAgICAgJyYnOiAnJmFtcDsnLAogICAgICAnPCc6ICcmbHQ7JywKICAgICAgJz4nOiAnJmd0OycsCiAgICAgICciJzogJyZxdW90OycsCiAgICAgICInIjogJyYjMzk7JwogICAgfVttXTsKICB9KTsKfQoKLy8g5qC85byP5YyW5pel5pyf5pe26Ze0CmZ1bmN0aW9uIGZvcm1hdFRpbWUoZGF0ZVRpbWVTdHIpIHsKICBpZiAoIWRhdGVUaW1lU3RyKSByZXR1cm4gJyc7CiAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGRhdGVUaW1lU3RyKTsKICByZXR1cm4gYCR7ZGF0ZS5nZXRNb250aCgpICsgMX3mnIgke2RhdGUuZ2V0RGF0ZSgpfeaXpSAke2RhdGUuZ2V0SG91cnMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9OiR7ZGF0ZS5nZXRNaW51dGVzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWA7Cn0KCi8vIElTT+aXpeacn+agvOW8j+WMluS4uuWPr+ivu+agvOW8jwpmdW5jdGlvbiBmb3JtYXRJU09EYXRlKGlzb0RhdGVTdHIpIHsKICBpZiAoIWlzb0RhdGVTdHIpIHJldHVybiAnJzsKICB0cnkgewogICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGlzb0RhdGVTdHIpOwogICAgcmV0dXJuIGRhdGUudG9Mb2NhbGVTdHJpbmcoJ3poLUNOJywgewogICAgICB5ZWFyOiAnbnVtZXJpYycsCiAgICAgIG1vbnRoOiAnMi1kaWdpdCcsCiAgICAgIGRheTogJzItZGlnaXQnLAogICAgICBob3VyOiAnMi1kaWdpdCcsCiAgICAgIG1pbnV0ZTogJzItZGlnaXQnCiAgICB9KTsKICB9IGNhdGNoIChlcnJvcikgewogICAgY29uc29sZS5lcnJvcign5pel5pyf5qC85byP5YyW6ZSZ6K+vOicsIGVycm9yKTsKICAgIHJldHVybiBpc29EYXRlU3RyOyAvLyDov5Tlm57ljp/lp4vlgLwKICB9Cn0KZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdEYXNoYm9hcmQnLAogIGNvbXBvbmVudHM6IHsKICAgIFVwbG9hZEZpbGxlZCwKICAgIERvY3VtZW50LAogICAgQ2xvc2UsCiAgICBDaGVjaywKICAgIERlbGV0ZSwKICAgIERhdGFBbmFseXNpcywKICAgIENwdSwKICAgIE1hZ2ljU3RpY2ssCiAgICBDaGF0TGluZVNxdWFyZSwKICAgIEZvbGQsCiAgICBFeHBhbmQsCiAgICBDYWxlbmRhciwKICAgIENoYXREb3RSb3VuZCwKICAgIENvbGxlY3Rpb24sCiAgICBEb2N1bWVudENvcHksCiAgICBHcmlkLAogICAgQ29ubmVjdGlvbiwKICAgIENpcmNsZUNoZWNrRmlsbGVkLAogICAgSW5mb0ZpbGxlZCwKICAgIENpcmNsZUNsb3NlRmlsbGVkLAogICAgV2FybmluZ0ZpbGxlZCwKICAgIEVkaXRQZW4KICB9LAogIHNldHVwKCkgewogICAgY29uc3QgewogICAgICBwcm94eQogICAgfSA9IGdldEN1cnJlbnRJbnN0YW5jZSgpOwogICAgY29uc3QgdXNlckF2YXRhclVybCA9IHJlZihwcm94eS4kc3RvcmUuc3RhdGUudXNlci5hdmF0YXIpOwogICAgY29uc3QgaGFuZGxlQXZhdGFyRXJyb3IgPSAoKSA9PiB7CiAgICAgIHVzZXJBdmF0YXJVcmwudmFsdWUgPSAnJzsgLy8g5Yqg6L295aSx6LSl5pe25riF56m677yM5Lya5pi+56S66buY6K6kU1ZHCiAgICB9OwogICAgY29uc3QgaW5wdXQgPSByZWYoJycpOwogICAgY29uc3QgbWVzc2FnZXMgPSByZWYoW3sKICAgICAgcm9sZTogJ2Fzc2lzdGFudCcsCiAgICAgIGNvbnRlbnQ6IGA8ZGl2IGNsYXNzPSJ3ZWxjb21lLW1lc3NhZ2UiPgogICAgICAgICAgPGgzPuasoui/juadpeWIsOaZuuihjOiIn+W5s+WPsDwvaDM+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJwbGF0Zm9ybS1pbnRybyI+CiAgICAgICAgICAgIDxwPuaZuuihjOiIn+W5s+WPsOaYr+aCqOeahOaZuuiDveWNj+S9nOS4reW/g++8jOiejeWQiOS6humhueebrueuoeeQhuOAgeWNs+aXtumAmuiur+OAgeaZuuiDveaWh+aho+WSjEFJ5Yqp5omL562J44CC5oiR5Lus6Ie05Yqb5LqO6YCa6L+H5YmN5rK/QUnmioDmnK/otYvog73mgqjnmoTlm6LpmJ/vvIzkvJjljJbkuJrliqHmtYHnqIvvvIzkuLrmgqjmiZPpgKDml6DnvJ3ov57mjqXnmoTmnKrmnaXlip7lhazmlrDojIPlvI/vvIzmoLjlv4PkvJjlir/lpoLkuIvvvJo8L3A+CiAgICAgICAgICAgIAogICAgICAgICAgICA8dWwgY2xhc3M9InBsYXRmb3JtLWZlYXR1cmVzIj4KICAgICAgICAgICAgICA8bGk+PHNwYW4gY2xhc3M9ImZlYXR1cmUtaGlnaGxpZ2h0Ij5BSeaZuuiDveW8leaTjjwvc3Bhbj4gLSDmiJHku6znmoRBSeWKqeaJi+iDveWkn+eQhuino+iHqueEtuivreiogO+8jOWkhOeQhuWkjeadguaWh+aho++8jOWIm+W7uuaXpeeoi++8jOaIkOS4uuaCqDI05bCP5pe255qE5pm66IO95bel5L2c5LyZ5Ly044CCPC9saT4KICAgICAgICAgICAgICA8bGk+PHNwYW4gY2xhc3M9ImZlYXR1cmUtaGlnaGxpZ2h0Ij7kuIDkvZPljJbljY/kvZw8L3NwYW4+IC0g5peg57yd5pW05ZCI6aG555uu44CB5pel56iL5LiO5rKf6YCa5bel5YW377yM5omT56C05L+h5oGv5a2k5bKb77yM6K6p5Zui6Zif5Y2P5L2c5aaC6KGM5LqR5rWB5rC06Iis6aG655WF77yM5pi+6JGX5o+Q5Y2H5pWI546H44CCPC9saT4KICAgICAgICAgICAgICA8bGk+PHNwYW4gY2xhc3M9ImZlYXR1cmUtaGlnaGxpZ2h0Ij7mmbrmhafmlofmoaPlpITnkIY8L3NwYW4+IC0g5LuO5pm66IO95ZCI5ZCM55Sf5oiQ5Yiw55+l6K+G5bqT566h55CG77yM6Ieq5Yqo5YyW5aSE55CG57mB5p2C55qE5paH5qGj5bel5L2c5rWB77yM6K6p5oKo55qE5Zui6Zif6IGa54Sm5LqO5qC45b+D5Yib5paw44CCPC9saT4KICAgICAgICAgICAgICA8bGk+PHNwYW4gY2xhc3M9ImZlYXR1cmUtaGlnaGxpZ2h0Ij7lronlhajlj6/pnaDkv53pmpw8L3NwYW4+IC0g6YeH55So5LyB5Lia57qn5pWw5o2u5Yqg5a+G5LiO57K+57uG5YyW5p2D6ZmQ566h55CG77yM5YWo5pa55L2N5a6I5oqk5oKo55qE5qC45b+D5pWw5o2u6LWE5Lqn5a6J5YWo44CCPC9saT4KICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgCiAgICAgICAgICAgIDxwPuWAn+WKqeaZuuihjOiIn+W5s+WPsO+8jOaCqOeahOS8geS4muWwhui/iOWFpeabtOaVj+aNt+OAgemrmOaViOOAgeaZuuiDveeahOWNj+S9nOaWsOe6quWFg++8jOa/gOWPkeWboumYn+a9nOWKm++8jOaPkOWNh+aVtOS9k+ernuS6ieWKm+OAgjwvcD4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPHA+6YCJ5oup5Lul5LiL5Yqf6IO95qih5Z2X77yM5oiW55u05o6l5ZCR5oiR5o+Q6Zeu77yM5oiR5bCG5Li65oKo5o+Q5L6b5pm66IO95Yqp5omL5pyN5Yqh44CCPC9wPgogICAgICAgICAgPGRpdiBjbGFzcz0icXVpY2stbmF2LWNhcmRzIj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQiIG9uY2xpY2s9IndpbmRvdy5sb2NhdGlvbi5ocmVmPScvcHJvamVjdCciPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLWljb24iPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImJpIGJpLWthbmJhbiI+PC9pPgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLWNvbnRlbnQiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtdGl0bGUiPumhueebruWNj+S9nDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtZGVzYyI+5Lu75Yqh5YiG6YWN44CB6L+b5bqm6Lef6Liq44CB5Zui6Zif5Y2P5L2cPC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtYXJyb3ciPjxpIGNsYXNzPSJuYXYtYXJyb3ctaWNvbiI+4oaSPC9pPjwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQiIG9uY2xpY2s9IndpbmRvdy5sb2NhdGlvbi5ocmVmPScvY2FsZW5kYXInIj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1pY29uIj4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJiaSBiaS1jYWxlbmRhci13ZWVrIj48L2k+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtY29udGVudCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC10aXRsZSI+5pel56iL5a6J5o6SPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1kZXNjIj7kvJrorq7pooTnuqbjgIHml6XnqIvmj5DphpLjgIHml7bpl7TnrqHnkIY8L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1hcnJvdyI+PGkgY2xhc3M9Im5hdi1hcnJvdy1pY29uIj7ihpI8L2k+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZCIgb25jbGljaz0id2luZG93LmxvY2F0aW9uLmhyZWY9Jy9jaGF0JyI+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtaWNvbiI+CiAgICAgICAgICAgICAgICA8aSBjbGFzcz0iYmkgYmktY2hhdC1kb3RzIj48L2k+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtY29udGVudCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC10aXRsZSI+5Y2z5pe25rKf6YCaPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1kZXNjIj7lm6LpmJ/ogYrlpKnjgIHmlofku7blhbHkuqvjgIHmtojmga/pgJrnn6U8L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1hcnJvdyI+PGkgY2xhc3M9Im5hdi1hcnJvdy1pY29uIj7ihpI8L2k+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZCIgb25jbGljaz0id2luZG93LmxvY2F0aW9uLmhyZWY9Jy9zbWFydGRvYyciPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLWljb24iPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImJpIGJpLWZpbGUtZWFybWFyay10ZXh0Ij48L2k+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtY29udGVudCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC10aXRsZSI+5pm66IO95paH5qGjPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1kZXNjIj7lhoXlrrnliJvkvZzjgIHmmbrog73pl67nrZTjgIHmlofmoaPlhbHkuqs8L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1hcnJvdyI+PGkgY2xhc3M9Im5hdi1hcnJvdy1pY29uIj7ihpI8L2k+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZCIgb25jbGljaz0id2luZG93LmxvY2F0aW9uLmhyZWY9Jy9rbm93bGVkZ2UnIj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1pY29uIj4KICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJiaSBiaS1ib29rIj48L2k+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtY29udGVudCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC10aXRsZSI+55+l6K+G5bqTPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1kZXNjIj7lm6LpmJ/nn6Xor4blhbHkuqvjgIHmo4DntKLjgIHlrZjlgqjlubPlj7A8L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1hcnJvdyI+PGkgY2xhc3M9Im5hdi1hcnJvdy1pY29uIj7ihpI8L2k+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZCIgb25jbGljaz0id2luZG93LmxvY2F0aW9uLmhyZWY9Jy9jb250cmFjdCciPgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLWljb24iPgogICAgICAgICAgICAgICAgPGkgY2xhc3M9ImJpIGJpLWZpbGUtZWFybWFyay1ydWxlZCI+PC9pPgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLWNvbnRlbnQiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtdGl0bGUiPuaZuuiDveWQiOWQjDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtZGVzYyI+5ZCI5ZCM5qih5p2/44CBQUnlrqHmn6XjgIHmmbrog73nlJ/miJA8L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1hcnJvdyI+PGkgY2xhc3M9Im5hdi1hcnJvdy1pY29uIj7ihpI8L2k+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+YCwKICAgICAgcmF3Q29udGVudDogJ+aCqOWlve+8jOaIkeaYr+aCqOeahEFJ5Yqp5omL77yM5pyJ5LuA5LmI5Y+v5Lul5biu5oKo77yfJywKICAgICAgdHlwZTogJ3RleHQnCiAgICB9XSk7CiAgICBjb25zdCBjaGF0Qm9keSA9IHJlZihudWxsKTsKICAgIGNvbnN0IGZpbGVJbnB1dCA9IHJlZihudWxsKTsKICAgIGNvbnN0IHNlbGVjdGVkRmlsZXMgPSByZWYoW10pOwogICAgY29uc3QgbG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBwcm9jZXNzaW5nRmlsZXMgPSBjb21wdXRlZCgoKSA9PiB7CiAgICAgIHJldHVybiBzZWxlY3RlZEZpbGVzLnZhbHVlLnNvbWUoZmlsZSA9PiBmaWxlLnN0YXR1cyAhPT0gJ2NvbXBsZXRlZCcgJiYgZmlsZS5zdGF0dXMgIT09ICdmYWlsZWQnKTsKICAgIH0pOwogICAgY29uc3QgY2hhdElkID0gcmVmKG51bGwpOyAvLyDlrZjlgqjlvZPliY3ogYrlpKlJRO+8jOeUqOS6jue7tOaMgeWvueivneS4iuS4i+aWhwogICAgY29uc3Qgc2hvd0NvbnRleHRCYXIgPSBjb21wdXRlZCgoKSA9PiBjaGF0SWQudmFsdWUgIT09IG51bGwpOwogICAgY29uc3Qgc2VhcmNoTWV0aG9kID0gcmVmKCdiYXNpYycpOyAvLyDmlrDlop7vvJrmkJzntKLmlrnms5UsIOm7mOiupOS4umJhc2ljCiAgICBjb25zdCBjaGF0TW9kZSA9IHJlZignYWdlbnQnKTsgLy8gYWdlbnQg5oiWIGtub3dsZWRnZV9iYXNlCiAgICBjb25zdCByZXRyaWV2YWxTY29wZSA9IHJlZignbG9jYWwnKTsgLy8gJ2xvY2FsJyDmiJYgJ2Jhc2ljJwoKICAgIC8vIOa3u+WKoOWPmOmHj+adpeWtmOWCqOW9k+WJjeivt+axgueahOaOp+WItuWZqAogICAgY29uc3QgY3VycmVudFJlcXVlc3RDb250cm9sbGVyID0gcmVmKG51bGwpOwoKICAgIC8vIOWPs+S+p+mdouadv+ebuOWFs+eKtuaAgQogICAgY29uc3QgcmlnaHRQYW5lbENvbGxhcHNlZCA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBjaGF0U2Vzc2lvbnMgPSByZWYoW10pOwoKICAgIC8vIOe8lui+keWvueivneahhuebuOWFs+eKtuaAgQogICAgY29uc3QgZWRpdEV2ZW50RGlhbG9nVmlzaWJsZSA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBlZGl0aW5nRXZlbnQgPSByZWYobnVsbCk7CiAgICBjb25zdCBjdXJyZW50RWRpdGluZ01lc3NhZ2UgPSByZWYobnVsbCk7CgogICAgLy8g6I635Y+WIGVtaXR0ZXIg5a6e5L6LCiAgICBjb25zdCBlbWl0dGVyID0gcHJveHkuZW1pdHRlcjsKCiAgICAvLyDojrflj5bogYrlpKnkvJror53liJfooagKICAgIGNvbnN0IGZldGNoQ2hhdFNlc3Npb25zID0gYXN5bmMgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGdldEFJQ2hhdFNlc3Npb25zKCk7CiAgICAgICAgaWYgKHJlcy5kYXRhICYmIEFycmF5LmlzQXJyYXkocmVzLmRhdGEpKSB7CiAgICAgICAgICBjaGF0U2Vzc2lvbnMudmFsdWUgPSByZXMuZGF0YTsKICAgICAgICB9IGVsc2UgaWYgKHJlcy5kYXRhICYmIHJlcy5kYXRhLnJlc3VsdHMgJiYgQXJyYXkuaXNBcnJheShyZXMuZGF0YS5yZXN1bHRzKSkgewogICAgICAgICAgY2hhdFNlc3Npb25zLnZhbHVlID0gcmVzLmRhdGEucmVzdWx0czsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNoYXRTZXNzaW9ucy52YWx1ZTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bogYrlpKnkvJror53liJfooajlpLHotKU6JywgZXJyb3IpOwogICAgICAgIGNoYXRTZXNzaW9ucy52YWx1ZSA9IFtdOwogICAgICAgIHJldHVybiBbXTsKICAgICAgfQogICAgfTsKCiAgICAvLyDliIfmjaLogYrlpKnkvJror50KICAgIGNvbnN0IHN3aXRjaENoYXRTZXNzaW9uID0gYXN5bmMgc2Vzc2lvbklkID0+IHsKICAgICAgaWYgKHNlc3Npb25JZCA9PT0gY2hhdElkLnZhbHVlKSByZXR1cm47CiAgICAgIHRyeSB7CiAgICAgICAgbG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0QUlDaGF0U2Vzc2lvbihzZXNzaW9uSWQpOwogICAgICAgIGlmIChyZXMuZGF0YSkgewogICAgICAgICAgY2hhdElkLnZhbHVlID0gc2Vzc2lvbklkOwogICAgICAgICAgLy8g5Yqg6L296IGK5aSp5Y6G5Y+yCiAgICAgICAgICBpZiAocmVzLmRhdGEubWVzc2FnZXMgJiYgQXJyYXkuaXNBcnJheShyZXMuZGF0YS5tZXNzYWdlcykpIHsKICAgICAgICAgICAgbWVzc2FnZXMudmFsdWUgPSByZXMuZGF0YS5tZXNzYWdlcy5tYXAobXNnID0+IHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgcm9sZTogbXNnLnJvbGUsCiAgICAgICAgICAgICAgICBjb250ZW50OiBtc2cuY29udGVudCwKICAgICAgICAgICAgICAgIHJhd0NvbnRlbnQ6IG1zZy5jb250ZW50LAogICAgICAgICAgICAgICAgdHlwZTogbXNnLnR5cGUgfHwgJ3RleHQnLAogICAgICAgICAgICAgICAgc291cmNlOiBtc2cucm9sZSA9PT0gJ3VzZXInID8gJycgOiBtc2cuc291cmNlIHx8IChtc2cucm9sZSA9PT0gJ2Fzc2lzdGFudCcgPyAnZ2VuZXJhbF9haScgOiAnJykgLy8g56Gu5L+d55So5oi35raI5oGv5rKh5pyJc291cmNl5bGe5oCnCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPluiBiuWkqeS8muivneivpuaDheWksei0pTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfliIfmjaLogYrlpKnkvJror53lpLHotKUnKTsKCiAgICAgICAgLy8g5aaC5p6c5YiH5o2i5aSx6LSl77yM5qOA5p+l5b2T5YmN5Lya6K+d5YiX6KGo5Lit5piv5ZCm6L+Y5pyJ6L+Z5Liq5Lya6K+dCiAgICAgICAgY29uc3Qgc2Vzc2lvbkV4aXN0cyA9IGNoYXRTZXNzaW9ucy52YWx1ZS5zb21lKHNlc3Npb24gPT4gc2Vzc2lvbi5pZCA9PT0gc2Vzc2lvbklkKTsKICAgICAgICBpZiAoIXNlc3Npb25FeGlzdHMpIHsKICAgICAgICAgIC8vIOWmguaenOS8muivneW3suS4jeWtmOWcqO+8jOWwneivleWIh+aNouWIsOesrOS4gOS4quWPr+eUqOS8muivneaIluWIm+W7uuaWsOS8muivnQogICAgICAgICAgaWYgKGNoYXRTZXNzaW9ucy52YWx1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIGF3YWl0IHN3aXRjaENoYXRTZXNzaW9uKGNoYXRTZXNzaW9ucy52YWx1ZVswXS5pZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjbGVhckNoYXQoKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgbG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICB9CiAgICB9OwoKICAgIC8vIOebkeWQrOiBiuWkqUlE5Y+Y5YyW77yM5pu05paw5Lya6K+d5YiX6KGoCiAgICB3YXRjaChjaGF0SWQsIG5ld0NoYXRJZCA9PiB7CiAgICAgIGlmIChuZXdDaGF0SWQpIHsKICAgICAgICBmZXRjaENoYXRTZXNzaW9ucygpOwogICAgICB9CiAgICB9KTsKCiAgICAvLyDojrflj5bnlKjmiLfkv6Hmga8KICAgIGNvbnN0IGdldFVzZXJJbmZvID0gYXN5bmMgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoewogICAgICAgICAgdXJsOiAnL2FwaS9hdXRoL3VzZXJzL21lLycsCiAgICAgICAgICBtZXRob2Q6ICdnZXQnCiAgICAgICAgfSk7CiAgICAgICAgY29uc29sZS5sb2coJ+eUqOaIt+S/oeaBr+WujOaVtOWTjeW6lDonLCByZXMpOwoKICAgICAgICAvLyDlsJ3or5Xku47lk43lupTnmoTkuI3lkIzkvY3nva7ojrflj5blpLTlg49VUkwKICAgICAgICBsZXQgYXZhdGFyVXJsID0gbnVsbDsKICAgICAgICBpZiAocmVzLmRhdGEgJiYgcmVzLmRhdGEuZGF0YSAmJiByZXMuZGF0YS5kYXRhLmF2YXRhcikgewogICAgICAgICAgYXZhdGFyVXJsID0gcmVzLmRhdGEuZGF0YS5hdmF0YXI7CiAgICAgICAgfSBlbHNlIGlmIChyZXMuZGF0YSAmJiByZXMuZGF0YS5hdmF0YXIpIHsKICAgICAgICAgIGF2YXRhclVybCA9IHJlcy5kYXRhLmF2YXRhcjsKICAgICAgICB9IGVsc2UgaWYgKHJlcy5kYXRhKSB7CiAgICAgICAgICAvLyDpgY3ljoZyZXMuZGF0YeafpeaJvmF2YXRhcuWtl+autQogICAgICAgICAgY29uc3QgZmluZEF2YXRhciA9IG9iaiA9PiB7CiAgICAgICAgICAgIGlmICghb2JqIHx8IHR5cGVvZiBvYmogIT09ICdvYmplY3QnKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgaWYgKCdhdmF0YXInIGluIG9iaikgcmV0dXJuIG9iai5hdmF0YXI7CgogICAgICAgICAgICAvLyDpgJLlvZLmkJzntKLmiYDmnInlrZDlr7nosaEKICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7CiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmpba2V5XSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGZpbmRBdmF0YXIob2JqW2tleV0pOwogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9OwogICAgICAgICAgYXZhdGFyVXJsID0gZmluZEF2YXRhcihyZXMuZGF0YSk7CiAgICAgICAgfQogICAgICAgIGNvbnNvbGUubG9nKCfmib7liLDnmoTlpLTlg49VUkw6JywgYXZhdGFyVXJsKTsKICAgICAgICBpZiAoYXZhdGFyVXJsKSB7CiAgICAgICAgICAvLyDlpoLmnpzmmK/nm7jlr7not6/lvoTvvIzmt7vliqDln7rnoYBVUkwKICAgICAgICAgIGlmICghYXZhdGFyVXJsLnN0YXJ0c1dpdGgoJ2h0dHAnKSAmJiAhYXZhdGFyVXJsLnN0YXJ0c1dpdGgoJ2RhdGE6JykpIHsKICAgICAgICAgICAgLy8g56Gu5L+d5aqS5L2TVVJM5q2j56Gu5ou85o6lCiAgICAgICAgICAgIGNvbnN0IGJhc2VVcmwgPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luOwogICAgICAgICAgICBpZiAoYXZhdGFyVXJsLnN0YXJ0c1dpdGgoJy8nKSkgewogICAgICAgICAgICAgIHVzZXJBdmF0YXJVcmwudmFsdWUgPSBgJHtiYXNlVXJsfSR7YXZhdGFyVXJsfWA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdXNlckF2YXRhclVybC52YWx1ZSA9IGAke2Jhc2VVcmx9LyR7YXZhdGFyVXJsfWA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVzZXJBdmF0YXJVcmwudmFsdWUgPSBhdmF0YXJVcmw7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zb2xlLmxvZygn5aSE55CG5ZCO55qE55So5oi35aS05YOPVVJMOicsIHVzZXJBdmF0YXJVcmwudmFsdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmxvZygn55So5oi35L+h5oGv5Lit5rKh5pyJ5om+5Yiw5aS05YOPOicsIHJlcy5kYXRhKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W55So5oi35L+h5oGv5aSx6LSlOicsIGVycm9yKTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHNjcm9sbFRvQm90dG9tID0gKCkgPT4gewogICAgICBuZXh0VGljaygoKSA9PiB7CiAgICAgICAgaWYgKGNoYXRCb2R5LnZhbHVlKSBjaGF0Qm9keS52YWx1ZS5zY3JvbGxUb3AgPSBjaGF0Qm9keS52YWx1ZS5zY3JvbGxIZWlnaHQ7CiAgICAgIH0pOwogICAgfTsKICAgIGNvbnN0IHVwbG9hZEZpbGVBbmRHZXRJZCA9IGFzeW5jIGZpbGUgPT4gewogICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlLnJhd0ZpbGUpOwogICAgICB0cnkgewogICAgICAgIC8vIOagh+iusOaWh+S7tuS4uuS4iuS8oOS4rQogICAgICAgIGZpbGUucHJvZ3Jlc3MgPSAwOwogICAgICAgIGZpbGUuc3RhdHVzID0gJ3BlbmRpbmcnOwogICAgICAgIGxldCBzbW9vdGhUaW1lciA9IG51bGw7CiAgICAgICAgbGV0IGxhc3RQcm9ncmVzcyA9IDA7CiAgICAgICAgbGV0IHVwbG9hZEZpbmlzaGVkID0gZmFsc2U7CiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdCh7CiAgICAgICAgICB1cmw6ICcvYXBpL2FpL2RvY3VtZW50cy91cGxvYWQvJywKICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLAogICAgICAgICAgZGF0YTogZm9ybURhdGEsCiAgICAgICAgICBvblVwbG9hZFByb2dyZXNzOiBwcm9ncmVzc0V2ZW50ID0+IHsKICAgICAgICAgICAgY29uc3QgcGVyY2VudENvbXBsZXRlZCA9IE1hdGgucm91bmQocHJvZ3Jlc3NFdmVudC5sb2FkZWQgKiAxMDAgLyBwcm9ncmVzc0V2ZW50LnRvdGFsKTsKICAgICAgICAgICAgaWYgKHBlcmNlbnRDb21wbGV0ZWQgPCAxMDApIHsKICAgICAgICAgICAgICBmaWxlLnByb2dyZXNzID0gcGVyY2VudENvbXBsZXRlZDsKICAgICAgICAgICAgICBsYXN0UHJvZ3Jlc3MgPSBwZXJjZW50Q29tcGxldGVkOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIOS4iuS8oOeerOmXtOWujOaIkO+8jOW5s+a7kemAkuWinuWIsDk1JQogICAgICAgICAgICAgIGlmICghdXBsb2FkRmluaXNoZWQpIHsKICAgICAgICAgICAgICAgIHVwbG9hZEZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGxldCBmYWtlUHJvZ3Jlc3MgPSBsYXN0UHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBzbW9vdGhUaW1lciA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICAgICAgICAgICAgZmFrZVByb2dyZXNzICs9IDM7CiAgICAgICAgICAgICAgICAgIGlmIChmYWtlUHJvZ3Jlc3MgPj0gOTUpIHsKICAgICAgICAgICAgICAgICAgICBmYWtlUHJvZ3Jlc3MgPSA5NTsKICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHNtb290aFRpbWVyKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBmaWxlLnByb2dyZXNzID0gZmFrZVByb2dyZXNzOwogICAgICAgICAgICAgICAgfSwgMjApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIC8vIOS4iuS8oOWujOaIkOWQju+8jOeKtuaAgeaUueS4uuWkhOeQhuS4re+8jOS4jemHjee9rui/m+W6puadoQogICAgICAgIGlmIChzbW9vdGhUaW1lcikgY2xlYXJJbnRlcnZhbChzbW9vdGhUaW1lcik7CiAgICAgICAgaWYgKGZpbGUucHJvZ3Jlc3MgPCA5NSkgZmlsZS5wcm9ncmVzcyA9IDk1OwogICAgICAgIGZpbGUuc3RhdHVzID0gJ3Byb2Nlc3NpbmcnOwogICAgICAgIGZpbGUuZG9jdW1lbnRJZCA9IHJlcy5kYXRhLmlkOwogICAgICAgIHBvbGxEb2N1bWVudFN0YXR1cyhmaWxlKTsKICAgICAgICByZXR1cm4gcmVzLmRhdGEuaWQ7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgZmlsZS5zdGF0dXMgPSAnZmFpbGVkJzsKICAgICAgICBjb25zb2xlLmVycm9yKCfmlofku7bkuIrkvKDlpLHotKU6JywgZXJyb3IpOwogICAgICAgIHRocm93IG5ldyBFcnJvcihg5LiK5Lyg5paH5Lu2ICR7ZmlsZS5uYW1lfSDlpLHotKU6ICR7ZXJyb3IubWVzc2FnZSB8fCAn5pyN5Yqh5Zmo6ZSZ6K+vJ31gKTsKICAgICAgfQogICAgfTsKCiAgICAvLyDova7or6LmlofmoaPlpITnkIbnirbmgIEKICAgIGNvbnN0IHBvbGxEb2N1bWVudFN0YXR1cyA9IGFzeW5jIChmaWxlLCBpbnRlcnZhbCA9IDEwMDApID0+IHsKICAgICAgaWYgKCFmaWxlLmRvY3VtZW50SWQpIHJldHVybjsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KHsKICAgICAgICAgIHVybDogYC9hcGkvYWkvZG9jdW1lbnRzLyR7ZmlsZS5kb2N1bWVudElkfS9gLAogICAgICAgICAgbWV0aG9kOiAnZ2V0JwogICAgICAgIH0pOwogICAgICAgIGlmIChyZXMuZGF0YS5zdGF0dXMgPT09ICdjb21wbGV0ZWQnKSB7CiAgICAgICAgICBmaWxlLnByb2dyZXNzID0gMTAwOwogICAgICAgICAgZmlsZS5zdGF0dXMgPSAnY29tcGxldGVkJzsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgaWYgKHJlcy5kYXRhLnN0YXR1cyA9PT0gJ2ZhaWxlZCcpIHsKICAgICAgICAgIGZpbGUuc3RhdHVzID0gJ2ZhaWxlZCc7CiAgICAgICAgICBmaWxlLnByb2dyZXNzID0gMDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgaWYgKHJlcy5kYXRhLnN0YXR1cyA9PT0gJ3Byb2Nlc3NpbmcnKSB7CiAgICAgICAgICAvLyDlpITnkIbkuK3vvIzlop7liqDov5vluqbvvIjku4XlnKjlsI/kuo45NeaXtumAkuWinu+8iQogICAgICAgICAgaWYgKGZpbGUucHJvZ3Jlc3MgPCA5NSkgewogICAgICAgICAgICBmaWxlLnByb2dyZXNzID0gTWF0aC5taW4oZmlsZS5wcm9ncmVzcyArIDUsIDk1KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIOe7p+e7rei9ruivogogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gcG9sbERvY3VtZW50U3RhdHVzKGZpbGUsIGludGVydmFsKSwgaW50ZXJ2YWwpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLy8g5Ye66ZSZ5pe277yM57un57ut6L2u6K+i77yM5L2G5LiN5pu05paw6L+b5bqmCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBwb2xsRG9jdW1lbnRTdGF0dXMoZmlsZSwgaW50ZXJ2YWwpLCBpbnRlcnZhbCk7CiAgICAgIH0KICAgIH07CiAgICBjb25zdCBjbGVhckNoYXQgPSAoKSA9PiB7CiAgICAgIC8vIOa4heepuuWvueivneWOhuWPsu+8jOW8gOWni+aWsOeahOWvueivnQogICAgICBjaGF0SWQudmFsdWUgPSBudWxsOwoKICAgICAgLy8g6YeN572u5raI5oGv5YiX6KGo77yM5Y+q5L+d55WZ5qyi6L+O5raI5oGvCiAgICAgIG1lc3NhZ2VzLnZhbHVlID0gW3sKICAgICAgICByb2xlOiAnYXNzaXN0YW50JywKICAgICAgICBjb250ZW50OiBgPGRpdiBjbGFzcz0id2VsY29tZS1tZXNzYWdlIj4KICAgICAgICAgICAgPGgzPuasoui/juadpeWIsOaZuuihjOiIn+W5s+WPsDwvaDM+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InBsYXRmb3JtLWludHJvIj4KICAgICAgICAgICAgICA8cD7mmbrooYzoiJ/lubPlj7DmmK/mgqjnmoTmmbrog73ljY/kvZzkuK3lv4PvvIzono3lkIjkuobpobnnm67nrqHnkIbjgIHljbPml7bpgJrorq/jgIHmmbrog73mlofmoaPlkoxBSeWKqeaJi+OAguaIkeS7rOiHtOWKm+S6jumAmui/h+WJjeayv0FJ5oqA5pyv6LWL6IO95oKo55qE5Zui6Zif77yM5LyY5YyW5Lia5Yqh5rWB56iL77yM5Li65oKo5omT6YCg5peg57yd6L+e5o6l55qE5pyq5p2l5Yqe5YWs5paw6IyD5byP77yM5qC45b+D5LyY5Yq/5aaC5LiL77yaPC9wPgogICAgICAgICAgICAgIAogICAgICAgICAgICAgIDx1bCBjbGFzcz0icGxhdGZvcm0tZmVhdHVyZXMiPgogICAgICAgICAgICAgICAgPGxpPjxzcGFuIGNsYXNzPSJmZWF0dXJlLWhpZ2hsaWdodCI+QUnmmbrog73lvJXmk448L3NwYW4+IC0g5oiR5Lus55qEQUnliqnmiYvog73lpJ/nkIbop6Poh6rnhLbor63oqIDvvIzlpITnkIblpI3mnYLmlofmoaPvvIzoh6rliqjliJvlu7rml6XnqIvvvIzmiJDkuLrmgqgyNOWwj+aXtueahOaZuuiDveW3peS9nOS8meS8tOOAgjwvbGk+CiAgICAgICAgICAgICAgICA8bGk+PHNwYW4gY2xhc3M9ImZlYXR1cmUtaGlnaGxpZ2h0Ij7kuIDkvZPljJbljY/kvZw8L3NwYW4+IC0g5peg57yd5pW05ZCI6aG555uu44CB5pel56iL5LiO5rKf6YCa5bel5YW377yM5omT56C05L+h5oGv5a2k5bKb77yM6K6p5Zui6Zif5Y2P5L2c5aaC6KGM5LqR5rWB5rC06Iis6aG655WF77yM5pi+6JGX5o+Q5Y2H5pWI546H44CCPC9saT4KICAgICAgICAgICAgICAgIDxsaT48c3BhbiBjbGFzcz0iZmVhdHVyZS1oaWdobGlnaHQiPuaZuuaFp+aWh+aho+WkhOeQhjwvc3Bhbj4gLSDku47mmbrog73lkIjlkIznlJ/miJDliLDnn6Xor4blupPnrqHnkIbvvIzoh6rliqjljJblpITnkIbnuYHmnYLnmoTmlofmoaPlt6XkvZzmtYHvvIzorqnmgqjnmoTlm6LpmJ/ogZrnhKbkuo7moLjlv4PliJvmlrDjgII8L2xpPgogICAgICAgICAgICAgICAgPGxpPjxzcGFuIGNsYXNzPSJmZWF0dXJlLWhpZ2hsaWdodCI+5a6J5YWo5Y+v6Z2g5L+d6ZqcPC9zcGFuPiAtIOmHh+eUqOS8geS4mue6p+aVsOaNruWKoOWvhuS4jueyvue7huWMluadg+mZkOeuoeeQhu+8jOWFqOaWueS9jeWuiOaKpOaCqOeahOaguOW/g+aVsOaNrui1hOS6p+WuieWFqOOAgjwvbGk+CiAgICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgICAKICAgICAgICAgICAgICA8cD7lgJ/liqnmmbrooYzoiJ/lubPlj7DvvIzmgqjnmoTkvIHkuJrlsIbov4jlhaXmm7TmlY/mjbfjgIHpq5jmlYjjgIHmmbrog73nmoTljY/kvZzmlrDnuqrlhYPvvIzmv4Dlj5Hlm6LpmJ/mvZzlipvvvIzmj5DljYfmlbTkvZPnq57kuonlipvjgII8L3A+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8cD7pgInmi6nku6XkuIvlip/og73mqKHlnZfvvIzmiJbnm7TmjqXlkJHmiJHmj5Dpl67vvIzmiJHlsIbkuLrmgqjmj5Dkvpvmmbrog73liqnmiYvmnI3liqHjgII8L3A+CiAgICAgICAgICAgIDxkaXYgY2xhc3M9InF1aWNrLW5hdi1jYXJkcyI+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQiIG9uY2xpY2s9IndpbmRvdy5sb2NhdGlvbi5ocmVmPScvcHJvamVjdCciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtaWNvbiI+CiAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJiaSBiaS1rYW5iYW4iPjwvaT4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtY29udGVudCI+CiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLXRpdGxlIj7pobnnm67ljY/kvZw8L2Rpdj4KICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtZGVzYyI+5Lu75Yqh5YiG6YWN44CB6L+b5bqm6Lef6Liq44CB5Zui6Zif5Y2P5L2cPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLWFycm93Ij48aSBjbGFzcz0ibmF2LWFycm93LWljb24iPuKGkjwvaT48L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZCIgb25jbGljaz0id2luZG93LmxvY2F0aW9uLmhyZWY9Jy9jYWxlbmRhciciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtaWNvbiI+CiAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJiaSBiaS1jYWxlbmRhci13ZWVrIj48L2k+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLWNvbnRlbnQiPgogICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC10aXRsZSI+5pel56iL5a6J5o6SPC9kaXY+CiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLWRlc2MiPuS8muiurumihOe6puOAgeaXpeeoi+aPkOmGkuOAgeaXtumXtOeuoeeQhjwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1hcnJvdyI+PGkgY2xhc3M9Im5hdi1hcnJvdy1pY29uIj7ihpI8L2k+PC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQiIG9uY2xpY2s9IndpbmRvdy5sb2NhdGlvbi5ocmVmPScvY2hhdCciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtaWNvbiI+CiAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJiaSBiaS1jaGF0LWRvdHMiPjwvaT4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtY29udGVudCI+CiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLXRpdGxlIj7ljbPml7bmsp/pgJo8L2Rpdj4KICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtZGVzYyI+5Zui6Zif6IGK5aSp44CB5paH5Lu25YWx5Lqr44CB5raI5oGv6YCa55+lPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLWFycm93Ij48aSBjbGFzcz0ibmF2LWFycm93LWljb24iPuKGkjwvaT48L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZCIgb25jbGljaz0id2luZG93LmxvY2F0aW9uLmhyZWY9Jy9zbWFydGRvYyciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtaWNvbiI+CiAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJiaSBiaS1maWxlLWVhcm1hcmstdGV4dCI+PC9pPgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1jb250ZW50Ij4KICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtdGl0bGUiPkFJ5paH5qGjPC9kaXY+CiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLWRlc2MiPuaWh+aho+aRmOimgeOAgeaZuuiDvemXruetlOOAgeWGheWuueWIm+S9nDwvZGl2PgogICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1hcnJvdyI+PGkgY2xhc3M9Im5hdi1hcnJvdy1pY29uIj7ihpI8L2k+PC9kaXY+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQiIG9uY2xpY2s9IndpbmRvdy5sb2NhdGlvbi5ocmVmPScva25vd2xlZGdlJyI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZC1pY29uIj4KICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImJpIGJpLWJvb2siPjwvaT4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtY29udGVudCI+CiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLXRpdGxlIj7nn6Xor4blupM8L2Rpdj4KICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtZGVzYyI+5Zui6Zif55+l6K+G5YWx5Lqr44CB5qOA57Si44CB5a2Y5YKo5bmz5Y+wPC9kaXY+CiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLWFycm93Ij48aSBjbGFzcz0ibmF2LWFycm93LWljb24iPuKGkjwvaT48L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJuYXYtY2FyZCIgb25jbGljaz0id2luZG93LmxvY2F0aW9uLmhyZWY9Jy9jb250cmFjdCciPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtaWNvbiI+CiAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJiaSBiaS1maWxlLWVhcm1hcmstcnVsZWQiPjwvaT4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtY29udGVudCI+CiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9Im5hdi1jYXJkLXRpdGxlIj7mmbrog73lkIjlkIw8L2Rpdj4KICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtZGVzYyI+5ZCI5ZCM5qih5p2/44CBQUnlrqHmn6XjgIHmmbrog73nlJ/miJA8L2Rpdj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ibmF2LWNhcmQtYXJyb3ciPjxpIGNsYXNzPSJuYXYtYXJyb3ctaWNvbiI+4oaSPC9pPjwvZGl2PgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZGl2PmAsCiAgICAgICAgcmF3Q29udGVudDogJ+aCqOWlve+8jOaIkeaYr+aCqOeahEFJ5Yqp5omL77yM5pyJ5LuA5LmI5Y+v5Lul5biu5oKo77yfJywKICAgICAgICB0eXBlOiAndGV4dCcKICAgICAgfV07CgogICAgICAvLyDmuIXnqbrpgInmi6nnmoTmlofku7YKICAgICAgc2VsZWN0ZWRGaWxlcy52YWx1ZSA9IFtdOwoKICAgICAgLy8g5riF56m66L6T5YWl5qGGCiAgICAgIGlucHV0LnZhbHVlID0gJyc7CgogICAgICAvLyDlpoLmnpzmnInmraPlnKjov5vooYznmoTor7fmsYLvvIzlj5bmtojlroMKICAgICAgaWYgKGN1cnJlbnRSZXF1ZXN0Q29udHJvbGxlci52YWx1ZSkgewogICAgICAgIGN1cnJlbnRSZXF1ZXN0Q29udHJvbGxlci52YWx1ZS5hYm9ydCgpOwogICAgICAgIGN1cnJlbnRSZXF1ZXN0Q29udHJvbGxlci52YWx1ZSA9IG51bGw7CiAgICAgIH0KCiAgICAgIC8vIOmHjee9ruWKoOi9veeKtuaAgQogICAgICBsb2FkaW5nLnZhbHVlID0gZmFsc2U7CgogICAgICAvLyDmu5rliqjliLDpobbpg6gKICAgICAgbmV4dFRpY2soKCkgPT4gewogICAgICAgIGlmIChjaGF0Qm9keS52YWx1ZSkgewogICAgICAgICAgY2hhdEJvZHkudmFsdWUuc2Nyb2xsVG9wID0gMDsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgLy8g5Yi35paw5Y6G5Y+y6K6w5b2V5YiX6KGoCiAgICAgIGZldGNoQ2hhdFNlc3Npb25zKCk7CiAgICB9OwogICAgY29uc3QgcHJvY2Vzc0J1ZmZlciA9IGRhdGEgPT4gewogICAgICBsZXQgbGFzdE1lc3NhZ2UgPSBtZXNzYWdlcy52YWx1ZVttZXNzYWdlcy52YWx1ZS5sZW5ndGggLSAxXTsKICAgICAgaWYgKCFsYXN0TWVzc2FnZSB8fCBsYXN0TWVzc2FnZS5yb2xlICE9PSAnYXNzaXN0YW50JykgewogICAgICAgIGxhc3RNZXNzYWdlID0gewogICAgICAgICAgcm9sZTogJ2Fzc2lzdGFudCcsCiAgICAgICAgICBjb250ZW50OiAnJywKICAgICAgICAgIHJhd0NvbnRlbnQ6ICcnLAogICAgICAgICAgdHlwZTogJ3RleHQnLAogICAgICAgICAgc3RyZWFtaW5nOiB0cnVlLAogICAgICAgICAgc291cmNlOiBjaGF0TW9kZS52YWx1ZSA9PT0gJ2tub3dsZWRnZV9iYXNlJyA/ICdrbm93bGVkZ2VfYmFzZScgOiAnZ2VuZXJhbF9haScgLy8g5qC55o2u5b2T5YmN5qih5byP6K6+572u6buY6K6kc291cmNlCiAgICAgICAgfTsKICAgICAgICBtZXNzYWdlcy52YWx1ZS5wdXNoKGxhc3RNZXNzYWdlKTsKICAgICAgfQogICAgICBpZiAoZGF0YS50eXBlID09PSAncHJvY2Vzc2luZ19zdGFydCcpIHsKICAgICAgICBsYXN0TWVzc2FnZS50eXBlID0gJ3RleHQnOwogICAgICAgIGxhc3RNZXNzYWdlLmNvbnRlbnQgPSBkYXRhLmNvbnRlbnQ7CiAgICAgICAgbGFzdE1lc3NhZ2UucmF3Q29udGVudCA9IGRhdGEuY29udGVudDsKICAgICAgICBsYXN0TWVzc2FnZS5zdHJlYW1pbmcgPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gJ3RleHRfY2h1bmsnKSB7CiAgICAgICAgbGFzdE1lc3NhZ2UudHlwZSA9ICd0ZXh0JzsKICAgICAgICBsYXN0TWVzc2FnZS5zdHJlYW1pbmcgPSB0cnVlOwogICAgICAgIGlmICghbGFzdE1lc3NhZ2UucmF3Q29udGVudCB8fCBsYXN0TWVzc2FnZS5yYXdDb250ZW50ID09PSAi5q2j5Zyo5Li65oKo5aSE55CG5pel56iLLi4uIikgewogICAgICAgICAgbGFzdE1lc3NhZ2UucmF3Q29udGVudCA9ICcnOwogICAgICAgIH0KICAgICAgICAvLyDlnKjlsIblhoXlrrnmt7vliqDliLByYXdDb250ZW505LmL5YmN6L+b6KGM6L+H5rukCiAgICAgICAgY29uc3QgZmlsdGVyZWRDb250ZW50ID0gZGF0YS5jb250ZW50LnJlcGxhY2UoL1xbRGF0YTogU291cmNlcyBcKFxkK1wpXF1cLj8vZywgJycpOwogICAgICAgIGxhc3RNZXNzYWdlLnJhd0NvbnRlbnQgKz0gZmlsdGVyZWRDb250ZW50OwogICAgICAgIC8vIOa1geW8j+S8oOi+k+aXtu+8jOWunuaXtui/m+ihjG1hcmtkb3du6L2s5o2iCiAgICAgICAgbGFzdE1lc3NhZ2UuY29udGVudCA9IG1hcmtlZC5wYXJzZShsYXN0TWVzc2FnZS5yYXdDb250ZW50KTsKICAgICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICdmaW5hbF9jYXJkJykgewogICAgICAgIC8vIOS7heW9k+aYr+aXpeeoi+ebuOWFs+S4lOaciWV2ZW50X2lk5pe25omN5pi+56S65Li65Y2h54mHCiAgICAgICAgaWYgKGRhdGEuZXZlbnRfaWQgJiYgZGF0YS5pc19zY2hlZHVsZSA9PT0gdHJ1ZSkgewogICAgICAgICAgbGFzdE1lc3NhZ2UudHlwZSA9ICdjYXJkJzsKICAgICAgICAgIGxhc3RNZXNzYWdlLnN0cmVhbWluZyA9IGZhbHNlOwogICAgICAgICAgbGFzdE1lc3NhZ2UuY29udGVudCA9IG1hcmtlZC5wYXJzZShkYXRhLmNvbnRlbnQgfHwgJycpOwogICAgICAgICAgbGFzdE1lc3NhZ2Uuc3RhdHVzID0gZGF0YS5zdGF0dXMgfHwgJ2NsYXJpZmljYXRpb24nOwogICAgICAgICAgbGFzdE1lc3NhZ2UuZXZlbnRfaWQgPSBkYXRhLmV2ZW50X2lkIHx8IG51bGw7CgogICAgICAgICAgLy8g5aaC5p6c5piv5oiQ5Yqf5Yib5bu65pel56iL77yM6Kem5Y+R5pel5Y6G5Yi35pawCiAgICAgICAgICBpZiAoZGF0YS5zdGF0dXMgPT09ICdzdWNjZXNzJykgewogICAgICAgICAgICBlbWl0dGVyLmVtaXQoJ3JlZnJlc2hDYWxlbmRhcicpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyDpnZ7ml6XnqIvnm7jlhbPmiJbml6BldmVudF9pZOaXtuS7peaWh+acrOW9ouW8j+WxleekugogICAgICAgICAgbGFzdE1lc3NhZ2UudHlwZSA9ICd0ZXh0JzsKICAgICAgICAgIGxhc3RNZXNzYWdlLnN0cmVhbWluZyA9IGZhbHNlOwogICAgICAgICAgbGFzdE1lc3NhZ2UucmF3Q29udGVudCA9IGRhdGEuY29udGVudCB8fCAnJzsKICAgICAgICAgIGxhc3RNZXNzYWdlLmNvbnRlbnQgPSBtYXJrZWQucGFyc2UobGFzdE1lc3NhZ2UucmF3Q29udGVudCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGRhdGEudHlwZSA9PT0gJ2Vycm9yJykgewogICAgICAgIC8vIOWmguaenOaYr+aXpeeoi+ebuOWFs+mUmeivr+S4lOaYjuehruaMh+WumuS6hmlzX3NjaGVkdWxl77yM5omN5pi+56S65Li65Y2h54mHCiAgICAgICAgaWYgKGRhdGEuaXNfc2NoZWR1bGUgPT09IHRydWUpIHsKICAgICAgICAgIGxhc3RNZXNzYWdlLnR5cGUgPSAnY2FyZCc7CiAgICAgICAgICBsYXN0TWVzc2FnZS5zdHJlYW1pbmcgPSBmYWxzZTsKICAgICAgICAgIGxhc3RNZXNzYWdlLmNvbnRlbnQgPSBkYXRhLmNvbnRlbnQgfHwgJ+WPkeeUn+acquefpemUmeivr+OAgic7CiAgICAgICAgICBsYXN0TWVzc2FnZS5zdGF0dXMgPSAnZXJyb3InOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyDpnZ7ml6XnqIvplJnor6/ku6XmlofmnKzlvaLlvI/lsZXnpLoKICAgICAgICAgIGxhc3RNZXNzYWdlLnR5cGUgPSAndGV4dCc7CiAgICAgICAgICBsYXN0TWVzc2FnZS5zdHJlYW1pbmcgPSBmYWxzZTsKICAgICAgICAgIGxhc3RNZXNzYWdlLnJhd0NvbnRlbnQgPSBkYXRhLmNvbnRlbnQgfHwgJ+WPkeeUn+acquefpemUmeivr+OAgic7CiAgICAgICAgICBsYXN0TWVzc2FnZS5jb250ZW50ID0gbWFya2VkLnBhcnNlKGxhc3RNZXNzYWdlLnJhd0NvbnRlbnQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChkYXRhLnR5cGUgPT09ICd1cGRhdGVfY2FyZCcpIHsKICAgICAgICAvLyDku4Xmm7TmlrDml6XnqIvljaHniYcKICAgICAgICBpZiAoZGF0YS5pc19zY2hlZHVsZSA9PT0gdHJ1ZSAmJiBkYXRhLmV2ZW50X2lkKSB7CiAgICAgICAgICAvLyDlpITnkIbljaHniYfmm7TmlrAKICAgICAgICAgIGNvbnN0IHRhcmdldENhcmQgPSBtZXNzYWdlcy52YWx1ZS5maW5kKG1zZyA9PiBtc2cudHlwZSA9PT0gJ2NhcmQnICYmIG1zZy5ldmVudF9pZCA9PT0gZGF0YS5ldmVudF9pZCk7CiAgICAgICAgICBpZiAodGFyZ2V0Q2FyZCkgewogICAgICAgICAgICB0YXJnZXRDYXJkLmNvbnRlbnQgPSBtYXJrZWQucGFyc2UoZGF0YS5jb250ZW50IHx8ICcnKTsKICAgICAgICAgICAgdGFyZ2V0Q2FyZC5zdGF0dXMgPSBkYXRhLnN0YXR1cyB8fCB0YXJnZXRDYXJkLnN0YXR1czsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAnc2Vzc2lvbl9pZCcpIHsKICAgICAgICAvLyDlpITnkIbkvJror51JROa2iOaBr++8jOabtOaWsOW9k+WJjeiBiuWkqUlECiAgICAgICAgaWYgKGRhdGEuY2hhdF9pZCAmJiAhY2hhdElkLnZhbHVlKSB7CiAgICAgICAgICBjaGF0SWQudmFsdWUgPSBkYXRhLmNoYXRfaWQ7CiAgICAgICAgICBmZXRjaENoYXRTZXNzaW9ucygpOyAvLyDliJvlu7rmlrDkvJror53lkI7liLfmlrDliJfooagKICAgICAgICB9CiAgICAgIH0KICAgICAgc2Nyb2xsVG9Cb3R0b20oKTsKICAgIH07CiAgICBjb25zdCBzZW5kTXNnID0gYXN5bmMgKCkgPT4gewogICAgICBpZiAoIWlucHV0LnZhbHVlLnRyaW0oKSAmJiBzZWxlY3RlZEZpbGVzLnZhbHVlLmxlbmd0aCA9PT0gMCkgewogICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfor7fovpPlhaXlhoXlrrnmiJbkuIrkvKDmlofku7YnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHByb2Nlc3NpbmdGaWxlcy52YWx1ZSkgewogICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfmlofku7bmraPlnKjlpITnkIbkuK3vvIzor7fnqI3lgJnlho3or5UnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKGN1cnJlbnRSZXF1ZXN0Q29udHJvbGxlci52YWx1ZSkgewogICAgICAgIGN1cnJlbnRSZXF1ZXN0Q29udHJvbGxlci52YWx1ZS5hYm9ydCgpOwogICAgICB9CiAgICAgIGNvbnN0IHVzZXJNc2cgPSB7CiAgICAgICAgcm9sZTogJ3VzZXInLAogICAgICAgIGNvbnRlbnQ6IGlucHV0LnZhbHVlLAogICAgICAgIHR5cGU6ICd0ZXh0JwogICAgICB9OwogICAgICBtZXNzYWdlcy52YWx1ZS5wdXNoKHVzZXJNc2cpOwogICAgICBpZiAoc2VsZWN0ZWRGaWxlcy52YWx1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgbWVzc2FnZXMudmFsdWUucHVzaCh7CiAgICAgICAgICByb2xlOiAndXNlcicsCiAgICAgICAgICBjb250ZW50OiBg5LiK5Lyg5LqGJHtzZWxlY3RlZEZpbGVzLnZhbHVlLmxlbmd0aH3kuKrmlofku7ZgLAogICAgICAgICAgdHlwZTogJ2ZpbGUnLAogICAgICAgICAgZmlsZXM6IHNlbGVjdGVkRmlsZXMudmFsdWUubWFwKGYgPT4gKHsKICAgICAgICAgICAgbmFtZTogZi5uYW1lLAogICAgICAgICAgICBzaXplOiBmLnNpemUsCiAgICAgICAgICAgIGV4dDogZi5leHQKICAgICAgICAgIH0pKQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGNvbnN0IGFzc2lzdGFudE1zZyA9IHsKICAgICAgICByb2xlOiAnYXNzaXN0YW50JywKICAgICAgICBjb250ZW50OiAnJywKICAgICAgICB0eXBlOiAndGV4dCcsCiAgICAgICAgc3RyZWFtaW5nOiB0cnVlLAogICAgICAgIHNvdXJjZTogY2hhdE1vZGUudmFsdWUgPT09ICdrbm93bGVkZ2VfYmFzZScgPyAna25vd2xlZGdlX2Jhc2UnIDogJ2dlbmVyYWxfYWknCiAgICAgIH07CiAgICAgIG1lc3NhZ2VzLnZhbHVlLnB1c2goYXNzaXN0YW50TXNnKTsKICAgICAgY29uc3QgY3VycmVudElucHV0ID0gaW5wdXQudmFsdWU7CiAgICAgIGlucHV0LnZhbHVlID0gJyc7CiAgICAgIGNvbnN0IGN1cnJlbnREb2N1bWVudElkcyA9IHNlbGVjdGVkRmlsZXMudmFsdWUubWFwKGYgPT4gZi5kb2N1bWVudElkKS5maWx0ZXIoQm9vbGVhbik7CiAgICAgIHNlbGVjdGVkRmlsZXMudmFsdWUgPSBbXTsKICAgICAgc2Nyb2xsVG9Cb3R0b20oKTsKICAgICAgbG9hZGluZy52YWx1ZSA9IHRydWU7CgogICAgICAvLyDojrflj5bnlKjmiLfnmoRBSeS4quaAp+WMluiuvue9rgogICAgICBsZXQgYWlTZXR0aW5ncyA9IG51bGw7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgYWlTZXR0aW5nc1Jlc3BvbnNlID0gYXdhaXQgcmVxdWVzdCh7CiAgICAgICAgICB1cmw6ICcvYXBpL3NldHRpbmdzL2FpLXNldHRpbmdzJywKICAgICAgICAgIG1ldGhvZDogJ2dldCcKICAgICAgICB9KTsKICAgICAgICBpZiAoYWlTZXR0aW5nc1Jlc3BvbnNlICYmIGFpU2V0dGluZ3NSZXNwb25zZS5zdWNjZXNzKSB7CiAgICAgICAgICBhaVNldHRpbmdzID0gYWlTZXR0aW5nc1Jlc3BvbnNlLmRhdGE7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPlkFJ5Liq5oCn5YyW6K6+572u5aSx6LSlOicsIGVycm9yKTsKICAgICAgICAvLyDljbPkvb/ojrflj5blpLHotKXkuZ/nu6fnu63ogYrlpKkKICAgICAgfQogICAgICBjb25zdCByZXF1ZXN0RGF0YSA9IHsKICAgICAgICBtZXNzYWdlOiBjdXJyZW50SW5wdXQsCiAgICAgICAgY2hhdF9pZDogY2hhdElkLnZhbHVlLAogICAgICAgIGRvY3VtZW50X2lkczogY3VycmVudERvY3VtZW50SWRzLAogICAgICAgIGNoYXRNb2RlOiBjaGF0TW9kZS52YWx1ZSwKICAgICAgICBtZXRob2Q6IHNlYXJjaE1ldGhvZC52YWx1ZSAvLyBGb3Iga25vd2xlZGdlIGJhc2UKICAgICAgfTsKCiAgICAgIC8vIOa3u+WKoEFJ5Liq5oCn5YyW6K6+572uCiAgICAgIGlmIChhaVNldHRpbmdzKSB7CiAgICAgICAgcmVxdWVzdERhdGEuYWlfc2V0dGluZ3MgPSBhaVNldHRpbmdzOwogICAgICB9CgogICAgICAvLyDnu5/kuIDkvb/nlKjmtYHlvI/or7fmsYLlpITnkIbmiYDmnInmqKHlvI8KICAgICAgY3VycmVudFJlcXVlc3RDb250cm9sbGVyLnZhbHVlID0gYWlDaGF0V2l0aERvY3VtZW50c1N0cmVhbShyZXF1ZXN0RGF0YSwKICAgICAgLy8gb25DaHVuayBjYWxsYmFjawogICAgICAocGF5bG9hZCwgbmV3Q2hhdElkKSA9PiB7CiAgICAgICAgaWYgKG5ld0NoYXRJZCAmJiAhY2hhdElkLnZhbHVlKSB7CiAgICAgICAgICBjaGF0SWQudmFsdWUgPSBuZXdDaGF0SWQ7CiAgICAgICAgfQogICAgICAgIHByb2Nlc3NCdWZmZXIocGF5bG9hZCk7CiAgICAgIH0sCiAgICAgIC8vIG9uQ29tcGxldGUgY2FsbGJhY2sKICAgICAgbmV3Q2hhdElkID0+IHsKICAgICAgICBjb25zdCBsYXN0TXNnID0gbWVzc2FnZXMudmFsdWVbbWVzc2FnZXMudmFsdWUubGVuZ3RoIC0gMV07CiAgICAgICAgaWYgKGxhc3RNc2cgJiYgbGFzdE1zZy5yb2xlID09PSAnYXNzaXN0YW50JykgewogICAgICAgICAgbGFzdE1zZy5zdHJlYW1pbmcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKG5ld0NoYXRJZCAmJiAhY2hhdElkLnZhbHVlKSB7CiAgICAgICAgICBjaGF0SWQudmFsdWUgPSBuZXdDaGF0SWQ7CiAgICAgICAgICBmZXRjaENoYXRTZXNzaW9ucygpOyAvLyDliJvlu7rmlrDkvJror53lkI7liLfmlrDliJfooagKICAgICAgICB9CiAgICAgICAgbG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgIGN1cnJlbnRSZXF1ZXN0Q29udHJvbGxlci52YWx1ZSA9IG51bGw7CiAgICAgIH0sCiAgICAgIC8vIG9uRXJyb3IgY2FsbGJhY2sKICAgICAgZXJyb3IgPT4gewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+a1geW8j+ivt+axguWHuumUmTonLCBlcnJvcik7CiAgICAgICAgY29uc3QgbGFzdE1zZyA9IG1lc3NhZ2VzLnZhbHVlW21lc3NhZ2VzLnZhbHVlLmxlbmd0aCAtIDFdOwogICAgICAgIGlmIChsYXN0TXNnICYmIGxhc3RNc2cucm9sZSA9PT0gJ2Fzc2lzdGFudCcpIHsKICAgICAgICAgIGxhc3RNc2cuY29udGVudCA9ICfmirHmrYnvvIzlk43lupTnlJ/miJDov4fnqIvkuK3lh7rnjrDplJnor6/vvIzor7fnqI3lkI7ph43or5XjgIInOwogICAgICAgICAgbGFzdE1zZy5zdHJlYW1pbmcgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgbG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgIGN1cnJlbnRSZXF1ZXN0Q29udHJvbGxlci52YWx1ZSA9IG51bGw7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfor7fmsYLlh7rplJk6ICcgKyAoZXJyb3IubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJykpOwogICAgICB9KTsKICAgIH07CiAgICBjb25zdCB0cmlnZ2VyRmlsZUlucHV0ID0gKCkgPT4gewogICAgICBpZiAoZmlsZUlucHV0LnZhbHVlKSBmaWxlSW5wdXQudmFsdWUudmFsdWUgPSAnJzsKICAgICAgZmlsZUlucHV0LnZhbHVlICYmIGZpbGVJbnB1dC52YWx1ZS5jbGljaygpOwogICAgfTsKICAgIGNvbnN0IGhhbmRsZUZpbGVVcGxvYWQgPSBlID0+IHsKICAgICAgY29uc3QgZmlsZXMgPSBlLnRhcmdldC5maWxlczsKICAgICAgaWYgKCFmaWxlcyB8fCAhZmlsZXMubGVuZ3RoKSByZXR1cm47CgogICAgICAvLyDmlK/mjIHnmoTmlofku7bnsbvlnovphY3nva4KICAgICAgY29uc3QgYWxsb3dlZFR5cGVzID0gewogICAgICAgIC8vIOaWh+aho+exu+WeiwogICAgICAgICd0ZXh0L3BsYWluJzogJ3R4dCcsCiAgICAgICAgLy8gdHh05paH5Lu2CiAgICAgICAgJ2FwcGxpY2F0aW9uL3BkZic6ICdwZGYnLAogICAgICAgIC8vIHBkZuaWh+S7tgogICAgICAgICdhcHBsaWNhdGlvbi9tc3dvcmQnOiAnZG9jJywKICAgICAgICAvLyBkb2Pmlofku7YKICAgICAgICAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQnOiAnZG9jeCcsCiAgICAgICAgLy8gZG9jeOaWh+S7tgogICAgICAgICd0ZXh0L21hcmtkb3duJzogJ21kJywKICAgICAgICAvLyBtYXJrZG93buaWh+S7tgogICAgICAgICd0ZXh0L3gtbWFya2Rvd24nOiAnbWQnLAogICAgICAgIC8vIG1hcmtkb3du5paH5Lu25Y+Y5L2TCgogICAgICAgIC8vIOihqOagvOexu+WeiwogICAgICAgICd0ZXh0L2Nzdic6ICdjc3YnLAogICAgICAgIC8vIGNzduaWh+S7tgogICAgICAgICdhcHBsaWNhdGlvbi9jc3YnOiAnY3N2JywKICAgICAgICAvLyBjc3bmlofku7blj6bkuIDnp41NSU1FCiAgICAgICAgJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCc6ICd4bHMnLAogICAgICAgIC8vIHhsc+aWh+S7tgogICAgICAgICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCc6ICd4bHN4JywKICAgICAgICAvLyB4bHN45paH5Lu2CgogICAgICAgIC8vIOWbvueJh+exu+WeiwogICAgICAgICdpbWFnZS9qcGVnJzogJ2pwZycsCiAgICAgICAgLy8ganBnL2pwZWflm77niYcKICAgICAgICAnaW1hZ2UvcG5nJzogJ3BuZycsCiAgICAgICAgLy8gcG5n5Zu+54mHCiAgICAgICAgJ2ltYWdlL2dpZic6ICdnaWYnLAogICAgICAgIC8vIGdpZuWbvueJhwogICAgICAgICdpbWFnZS9ibXAnOiAnYm1wJywKICAgICAgICAvLyBibXDlm77niYcKICAgICAgICAnaW1hZ2Uvd2VicCc6ICd3ZWJwJywKICAgICAgICAvLyB3ZWJw5Zu+54mHCiAgICAgICAgJ2ltYWdlL3N2Zyt4bWwnOiAnc3ZnJywKICAgICAgICAvLyBzdmfnn6Lph4/lm74KICAgICAgICAnaW1hZ2UvdGlmZic6ICd0aWZmJyAvLyB0aWZm5Zu+54mHCiAgICAgIH07CgogICAgICAvLyDmmL7npLrmlK/mjIHnmoTmlofku7bmoLzlvI/mj5DnpLoKICAgICAgY29uc3Qgc3VwcG9ydGVkRm9ybWF0cyA9ICfmlK/mjIHnmoTmlofku7bmoLzlvI86IHR4dCwgcGRmLCBkb2MsIGRvY3gsIG1kLCB4bHMsIHhsc3gsIGNzdiDlkozluLjop4Hlm77niYfmoLzlvI8nOwoKICAgICAgLy8g5qOA5p+l5q+P5Liq5paH5Lu2CiAgICAgIGNvbnN0IHZhbGlkRmlsZXMgPSBbXTsKICAgICAgbGV0IGhhc0ludmFsaWRGaWxlID0gZmFsc2U7CgogICAgICAvLyDmnInmlYjnmoTmlofku7bmianlsZXlkI3liJfooajvvIjkuI3ljLrliIblpKflsI/lhpnvvIkKICAgICAgY29uc3QgdmFsaWRFeHRlbnNpb25zID0gWyd0eHQnLCAncGRmJywgJ2RvYycsICdkb2N4JywgJ21kJywgJ3hscycsICd4bHN4JywgJ2NzdicsICdqcGcnLCAnanBlZycsICdwbmcnLCAnZ2lmJywgJ2JtcCcsICd3ZWJwJywgJ3N2ZycsICd0aWZmJ107CiAgICAgIEFycmF5LmZyb20oZmlsZXMpLmZvckVhY2goZmlsZSA9PiB7CiAgICAgICAgY29uc3QgZXh0ID0gZ2V0RXh0KGZpbGUubmFtZSkudG9Mb3dlckNhc2UoKTsKICAgICAgICBjb25zdCBpc1ZhbGlkRXh0ZW5zaW9uID0gdmFsaWRFeHRlbnNpb25zLmluY2x1ZGVzKGV4dCk7CgogICAgICAgIC8vIOajgOafpU1JTUXnsbvlnovmiJbmianlsZXlkI3mmK/lkKbmnInmlYgKICAgICAgICBpZiAoYWxsb3dlZFR5cGVzW2ZpbGUudHlwZV0gfHwgaXNWYWxpZEV4dGVuc2lvbikgewogICAgICAgICAgY29uc3QgaWQgPSBmaWxlLm5hbWUgKyAnXycgKyBmaWxlLnNpemUgKyAnXycgKyBEYXRlLm5vdygpICsgTWF0aC5yYW5kb20oKTsKICAgICAgICAgIGlmIChmaWxlLnR5cGUuc3RhcnRzV2l0aCgnaW1hZ2UvJykpIHsKICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGV2ID0+IHsKICAgICAgICAgICAgICBzZWxlY3RlZEZpbGVzLnZhbHVlLnB1c2goewogICAgICAgICAgICAgICAgaWQsCiAgICAgICAgICAgICAgICBuYW1lOiBmaWxlLm5hbWUsCiAgICAgICAgICAgICAgICB0eXBlOiBmaWxlLnR5cGUsCiAgICAgICAgICAgICAgICB1cmw6IGV2LnRhcmdldC5yZXN1bHQsCiAgICAgICAgICAgICAgICBzaXplOiBmb3JtYXRTaXplKGZpbGUuc2l6ZSksCiAgICAgICAgICAgICAgICBleHQsCiAgICAgICAgICAgICAgICBsYWJlbDogZ2V0RmlsZUxhYmVsKGZpbGUudHlwZSwgZXh0KSwKICAgICAgICAgICAgICAgIGJnOiBnZXRGaWxlQmcoZXh0KSwKICAgICAgICAgICAgICAgIHJhd0ZpbGU6IGZpbGUsCiAgICAgICAgICAgICAgICBwcm9ncmVzczogMCwKICAgICAgICAgICAgICAgIHN0YXR1czogJ3JlYWR5JwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIC8vIOiHquWKqOS4iuS8oAogICAgICAgICAgICAgIHVwbG9hZEZpbGVBbmRHZXRJZChzZWxlY3RlZEZpbGVzLnZhbHVlW3NlbGVjdGVkRmlsZXMudmFsdWUubGVuZ3RoIC0gMV0pOwogICAgICAgICAgICB9OwogICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlbGVjdGVkRmlsZXMudmFsdWUucHVzaCh7CiAgICAgICAgICAgICAgaWQsCiAgICAgICAgICAgICAgbmFtZTogZmlsZS5uYW1lLAogICAgICAgICAgICAgIHR5cGU6IGZpbGUudHlwZSwKICAgICAgICAgICAgICB1cmw6IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSksCiAgICAgICAgICAgICAgc2l6ZTogZm9ybWF0U2l6ZShmaWxlLnNpemUpLAogICAgICAgICAgICAgIGV4dCwKICAgICAgICAgICAgICBsYWJlbDogZ2V0RmlsZUxhYmVsKGZpbGUudHlwZSwgZXh0KSwKICAgICAgICAgICAgICBiZzogZ2V0RmlsZUJnKGV4dCksCiAgICAgICAgICAgICAgcmF3RmlsZTogZmlsZSwKICAgICAgICAgICAgICAvLyDnm7TmjqXkvb/nlKjljp/lp4tmaWxl5a+56LGhCiAgICAgICAgICAgICAgcHJvZ3Jlc3M6IDAsCiAgICAgICAgICAgICAgc3RhdHVzOiAncmVhZHknCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAvLyDoh6rliqjkuIrkvKAKICAgICAgICAgICAgdXBsb2FkRmlsZUFuZEdldElkKHNlbGVjdGVkRmlsZXMudmFsdWVbc2VsZWN0ZWRGaWxlcy52YWx1ZS5sZW5ndGggLSAxXSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YWxpZEZpbGVzLnB1c2goc2VsZWN0ZWRGaWxlcy52YWx1ZVtzZWxlY3RlZEZpbGVzLnZhbHVlLmxlbmd0aCAtIDFdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaGFzSW52YWxpZEZpbGUgPSB0cnVlOwogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKGDkuI3mlK/mjIHnmoTmlofku7bnsbvlnos6ICR7ZmlsZS5uYW1lfWApOwogICAgICAgICAgY29uc29sZS53YXJuKGDmlofku7bnsbvlnovmi5Lnu506ICR7ZmlsZS5uYW1lfSwgTUlNRTogJHtmaWxlLnR5cGV9LCDmianlsZXlkI06ICR7ZXh0fWApOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICAvLyDlnKjmnInkuI3mlK/mjIHmlofku7bnsbvlnovml7bmmL7npLrmlK/mjIHnmoTmoLzlvI/kv6Hmga8KICAgICAgaWYgKGhhc0ludmFsaWRGaWxlKSB7CiAgICAgICAgRWxNZXNzYWdlLmluZm8oc3VwcG9ydGVkRm9ybWF0cyk7CiAgICAgIH0KCiAgICAgIC8vIOWmguaenOWFqOmDqOaWh+S7tumDveaYr+acieaViOeahO+8jOaYvuekuuaIkOWKn+S4iuS8oOaPkOekugogICAgICBpZiAodmFsaWRGaWxlcy5sZW5ndGggPiAwICYmIHZhbGlkRmlsZXMubGVuZ3RoID09PSBmaWxlcy5sZW5ndGgpIHsKICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcyhg5bey5re75YqgJHt2YWxpZEZpbGVzLmxlbmd0aH3kuKrmlofku7ZgKTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHJlbW92ZUZpbGUgPSBpZHggPT4gewogICAgICBzZWxlY3RlZEZpbGVzLnZhbHVlLnNwbGljZShpZHgsIDEpOwogICAgfTsKCiAgICAvLyBtYXJrZWTphY3nva7vvJrooajmoLzluKbovrnmoYYr5Luj56CB5Z2X576O5YyWK+WkjeWItuaMiemSrgogICAgY29uc3QgcmVuZGVyZXIgPSBuZXcgbWFya2VkLlJlbmRlcmVyKCk7CiAgICByZW5kZXJlci50YWJsZSA9IGZ1bmN0aW9uIChoZWFkZXIsIGJvZHkpIHsKICAgICAgcmV0dXJuIGA8dGFibGUgY2xhc3M9Im9wZW53ZWJ1aS1tZC10YWJsZSI+PHRoZWFkPiR7aGVhZGVyfTwvdGhlYWQ+PHRib2R5PiR7Ym9keX08L3Rib2R5PjwvdGFibGU+YDsKICAgIH07CiAgICByZW5kZXJlci5jb2RlID0gZnVuY3Rpb24gKGNvZGUsIGluZm9zdHJpbmcsIGVzY2FwZWQpIHsKICAgICAgY29uc3QgY29kZUlkID0gJ2NvZGUtJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KTsKICAgICAgbGV0IGxhbmcgPSAoaW5mb3N0cmluZyB8fCAnJykuc3BsaXQoL1xzKy8pWzBdOwogICAgICBsZXQgbGFuZ0xhYmVsID0gbGFuZyA/IGxhbmcgOiAnY29kZSc7CiAgICAgIGxldCBsYW5nQ2xhc3MgPSBsYW5nID8gYGxhbmd1YWdlLSR7bGFuZ31gIDogJyc7CiAgICAgIHJldHVybiBgCiAgICAgICAgPGRpdiBjbGFzcz0ib3BlbndlYnVpLW1kLWNvZGUtYmxvY2stYmVhdXR5Ij4KICAgICAgICAgIDxkaXYgY2xhc3M9Im9wZW53ZWJ1aS1tZC1jb2RlLXRvb2xiYXIiPgogICAgICAgICAgICA8c3BhbiBjbGFzcz0ib3BlbndlYnVpLW1kLWNvZGUtbGFuZyI+JHtsYW5nTGFiZWx9PC9zcGFuPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJvcGVud2VidWktY29weS1idG4iIGRhdGEtY2xpcGJvYXJkLXRhcmdldD0iIyR7Y29kZUlkfSIgdGl0bGU9IuWkjeWItuS7o+eggSI+5aSN5Yi2PC9idXR0b24+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDxwcmUgY2xhc3M9Im9wZW53ZWJ1aS1tZC1wcmUiPjxjb2RlIGlkPSIke2NvZGVJZH0iIGNsYXNzPSIke2xhbmdDbGFzc30iPiR7ZXNjYXBlZCA/IGNvZGUgOiBlc2NhcGVIdG1sKGNvZGUpfTwvY29kZT48L3ByZT4KICAgICAgICA8L2Rpdj4KICAgICAgYDsKICAgIH07CgogICAgLy8g5paw5aKe77ya6Ieq5a6a5LmJ5omp5bGV77yM56aB55So5Yig6Zmk57q/5Yqf6IO9CiAgICBjb25zdCBkaXNhYmxlU3RyaWtldGhyb3VnaCA9IHsKICAgICAgd2Fsa1Rva2Vucyh0b2tlbikgewogICAgICAgIGlmICh0b2tlbi50eXBlID09PSAnZGVsJykgewogICAgICAgICAgLy8g5bCG5Yig6Zmk57q/77yIZGVs77yJ57G75Z6L55qEdG9rZW7mlLnlhpnkuLrmma7pgJrmlofmnKzvvIh0ZXh077yJ57G75Z6LCiAgICAgICAgICB0b2tlbi50eXBlID0gJ3RleHQnOwogICAgICAgICAgdG9rZW4udGV4dCA9IHRva2VuLnJhdzsgLy8g5L2/55So5Y6f5aeL5paH5pys77yM5L+d55WZJ35+JwogICAgICAgICAgZGVsZXRlIHRva2VuLnRva2VuczsKICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICBtYXJrZWQudXNlKGRpc2FibGVTdHJpa2V0aHJvdWdoKTsKICAgIG1hcmtlZC5zZXRPcHRpb25zKHsKICAgICAgYnJlYWtzOiB0cnVlLAogICAgICBnZm06IHRydWUsCiAgICAgIGhlYWRlcklkczogZmFsc2UsCiAgICAgIG1hbmdsZTogZmFsc2UsCiAgICAgIHJlbmRlcmVyCiAgICB9KTsKCiAgICAvLyAtLS0g5Y2h54mH5qC35byP6L6F5Yqp5Ye95pWwICjmlrDlop4pIC0tLQogICAgY29uc3QgZ2V0Q2FyZENsYXNzID0gc3RhdHVzID0+IHsKICAgICAgc3dpdGNoIChzdGF0dXMpIHsKICAgICAgICBjYXNlICdzdWNjZXNzJzoKICAgICAgICAgIHJldHVybiAnc3VjY2Vzcy1jYXJkJzsKICAgICAgICBjYXNlICdlcnJvcic6CiAgICAgICAgICByZXR1cm4gJ2Vycm9yLWNhcmQnOwogICAgICAgIGNhc2UgJ2NsYXJpZmljYXRpb24nOgogICAgICAgICAgcmV0dXJuICdjbGFyaWZpY2F0aW9uLWNhcmQnOwogICAgICAgIGNhc2UgJ2RlbGV0ZWQnOgogICAgICAgICAgcmV0dXJuICdkZWxldGVkLWNhcmQnOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gJyc7CiAgICAgIH0KICAgIH07CiAgICBjb25zdCBnZXRDYXJkSWNvbiA9IHN0YXR1cyA9PiB7CiAgICAgIHN3aXRjaCAoc3RhdHVzKSB7CiAgICAgICAgY2FzZSAnc3VjY2Vzcyc6CiAgICAgICAgICByZXR1cm4gJ0NpcmNsZUNoZWNrRmlsbGVkJzsKICAgICAgICBjYXNlICdlcnJvcic6CiAgICAgICAgICByZXR1cm4gJ0NpcmNsZUNsb3NlRmlsbGVkJzsKICAgICAgICBjYXNlICdjbGFyaWZpY2F0aW9uJzoKICAgICAgICAgIHJldHVybiAnSW5mb0ZpbGxlZCc7CiAgICAgICAgY2FzZSAnZGVsZXRlZCc6CiAgICAgICAgICByZXR1cm4gJ1dhcm5pbmdGaWxsZWQnOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gJ0luZm9GaWxsZWQnOwogICAgICB9CiAgICB9OwogICAgY29uc3QgZ2V0Q2FyZFRpdGxlID0gc3RhdHVzID0+IHsKICAgICAgc3dpdGNoIChzdGF0dXMpIHsKICAgICAgICBjYXNlICdzdWNjZXNzJzoKICAgICAgICAgIHJldHVybiAn5pel56iL5pON5L2c5oiQ5YqfJzsKICAgICAgICBjYXNlICdlcnJvcic6CiAgICAgICAgICByZXR1cm4gJ+aTjeS9nOWksei0pSc7CiAgICAgICAgY2FzZSAnY2xhcmlmaWNhdGlvbic6CiAgICAgICAgICByZXR1cm4gJ+mcgOimgeehruiupCc7CiAgICAgICAgY2FzZSAnZGVsZXRlZCc6CiAgICAgICAgICByZXR1cm4gJ+aXpeeoi+W3suWIoOmZpCc7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiAn5o+Q56S65L+h5oGvJzsKICAgICAgfQogICAgfTsKICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAgIC8vIOWvvOiIquWIsOWFtuS7luaooeWdlwogICAgY29uc3QgbmF2aWdhdGVUbyA9IHBhdGggPT4gewogICAgICAvLyDojrflj5blvZPliY3ot6/nlLHot6/lvoQKICAgICAgY29uc3QgY3VycmVudFBhdGggPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWU7CiAgICAgIC8vIOWmguaenOW3sue7j+WcqOaMh+Wumui3r+W+hO+8jOS4jei/m+ihjOi3s+i9rAogICAgICBpZiAoY3VycmVudFBhdGguaW5jbHVkZXMocGF0aCkpIHJldHVybjsKCiAgICAgIC8vIOWcqOWQjOS4gHRhYuS4reWvvOiIqgogICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGAvJHtwYXRofWA7CiAgICB9OwoKICAgIC8vIOi/meS4quaWueazleWcqHdlbGNvbWUtbWVzc2FnZeS4reS9v+eUqAogICAgY29uc3QgbmF2aWdhdGVUb01vZHVsZSA9IHBhdGggPT4gewogICAgICBuYXZpZ2F0ZVRvKHBhdGgpOwogICAgfTsKCiAgICAvLyDliKDpmaTljZXkuKrogYrlpKnkvJror50KICAgIGNvbnN0IGRlbGV0ZVNlc3Npb24gPSBhc3luYyBzZXNzaW9uSWQgPT4gewogICAgICB0cnkgewogICAgICAgIGF3YWl0IEVsTWVzc2FnZUJveC5jb25maXJtKCfnoa7orqTopoHliKDpmaTov5nmnaHlr7nor53orrDlvZXlkJfvvJ8nLCAn5o+Q56S6JywgewogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfnoa7orqQnLAogICAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogJ+WPlua2iCcsCiAgICAgICAgICB0eXBlOiAnaW5mbycKICAgICAgICB9KTsKICAgICAgICBhd2FpdCBkZWxldGVBSUNoYXRTZXNzaW9uKHNlc3Npb25JZCk7CgogICAgICAgIC8vIOWIt+aWsOS8muivneWIl+ihqAogICAgICAgIGF3YWl0IGZldGNoQ2hhdFNlc3Npb25zKCk7CgogICAgICAgIC8vIOaXoOiuuuWIoOmZpOeahOaYr+S4jeaYr+W9k+WJjeS8muivne+8jOmDveebtOaOpeWIm+W7uuaWsOS8muivnQogICAgICAgIGNsZWFyQ2hhdCgpOyAvLyDmuIXnqbrlvZPliY3kvJror53vvIzliJvlu7rmlrDlr7nor50KICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5a+56K+d5bey5Yig6Zmk77yM5bey5Yib5bu65paw5a+56K+dJyk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgaWYgKGVycm9yICE9PSAnY2FuY2VsJyAmJiBlcnJvciAhPT0gJ2Nsb3NlJykgewogICAgICAgICAgY29uc29sZS5lcnJvcign5Yig6Zmk6IGK5aSp5Lya6K+d5aSx6LSlOicsIGVycm9yKTsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Yig6Zmk5aSx6LSl77yM6K+356iN5ZCO6YeN6K+VJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIC8vIOehruiupOa4heepuuaJgOacieWOhuWPsuiusOW9lQogICAgY29uc3QgY29uZmlybUNsZWFyQWxsSGlzdG9yeSA9ICgpID0+IHsKICAgICAgRWxNZXNzYWdlQm94LmNvbmZpcm0oJ+ehruiupOimgea4heepuuaJgOacieWOhuWPsuiusOW9leWQl++8n+atpOaTjeS9nOS4jeWPr+aBouWkjeOAgicsICforablkYonLCB7CiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfnoa7orqQnLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICflj5bmtognLAogICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICBjbGVhckFsbEhpc3RvcnkoKTsKICAgICAgfSkuY2F0Y2goKCkgPT4gewogICAgICAgIC8vIOeUqOaIt+WPlua2iO+8jOS4jeWBmuS7u+S9leaTjeS9nAogICAgICB9KTsKICAgIH07CgogICAgLy8g5riF56m65omA5pyJ5Y6G5Y+y6K6w5b2VCiAgICBjb25zdCBjbGVhckFsbEhpc3RvcnkgPSBhc3luYyAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgLy8g5pi+56S65Yqg6L2954q25oCBCiAgICAgICAgbG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgICAgZm9yIChjb25zdCBzZXNzaW9uIG9mIGNoYXRTZXNzaW9ucy52YWx1ZSkgewogICAgICAgICAgYXdhaXQgZGVsZXRlQUlDaGF0U2Vzc2lvbihzZXNzaW9uLmlkKTsKICAgICAgICB9CgogICAgICAgIC8vIOa4heepuuS8muivneWIl+ihqAogICAgICAgIGNoYXRTZXNzaW9ucy52YWx1ZSA9IFtdOwoKICAgICAgICAvLyDmuIXnqbrlvZPliY3kvJror53vvIzliJvlu7rmlrDlr7nor50KICAgICAgICBjbGVhckNoYXQoKTsKICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5omA5pyJ5Y6G5Y+y6K6w5b2V5bey5riF56m677yM5bey5Yib5bu65paw5a+56K+dJyk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5riF56m65Y6G5Y+y6K6w5b2V5aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+aTjeS9nOWksei0pe+8jOivt+eojeWQjumHjeivlScpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIC8vIOWFs+mXreWKoOi9veeKtuaAgQogICAgICAgIGxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgfQogICAgfTsKICAgIG9uTW91bnRlZCgoKSA9PiB7CiAgICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkgewogICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QgJiYgZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdvcGVud2VidWktY29weS1idG4nKSkgewogICAgICAgICAgY29uc3QgY29kZUlkID0gZS50YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLWNsaXBib2FyZC10YXJnZXQnKS5yZXBsYWNlKCcjJywgJycpOwogICAgICAgICAgY29uc3QgY29kZUVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb2RlSWQpOwogICAgICAgICAgaWYgKGNvZGVFbGVtKSB7CiAgICAgICAgICAgIG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGNvZGVFbGVtLmlubmVyVGV4dCkudGhlbigoKSA9PiB7CiAgICAgICAgICAgICAgZS50YXJnZXQuaW5uZXJUZXh0ID0gJ+W3suWkjeWItic7CiAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICBlLnRhcmdldC5pbm5lclRleHQgPSAn5aSN5Yi2JzsKICAgICAgICAgICAgICB9LCAxMjAwKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIC8vIOiOt+WPlueUqOaIt+WktOWDjwogICAgICBnZXRVc2VySW5mbygpOwoKICAgICAgLy8g6I635Y+W6IGK5aSp5Lya6K+d5YiX6KGo5bm25Yid5aeL5YyW55WM6Z2iCiAgICAgIGZldGNoQ2hhdFNlc3Npb25zKCkudGhlbigoKSA9PiB7CiAgICAgICAgLy8g5aaC5p6c5rKh5pyJ5Y6G5Y+y5Lya6K+d77yM56Gu5L+d5pi+56S65paw5a+56K+d55WM6Z2iCiAgICAgICAgaWYgKGNoYXRTZXNzaW9ucy52YWx1ZS5sZW5ndGggPT09IDApIHsKICAgICAgICAgIGNsZWFyQ2hhdCgpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICAvLyDmt7vliqDpobXpnaLljbjovb3ml7bnmoTmuIXnkIYKICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsICgpID0+IHsKICAgICAgICBpZiAoY3VycmVudFJlcXVlc3RDb250cm9sbGVyLnZhbHVlKSB7CiAgICAgICAgICBjdXJyZW50UmVxdWVzdENvbnRyb2xsZXIudmFsdWUuYWJvcnQoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CgogICAgLy8g55uR5o6n5pel5Y6G5Yi35paw5LqL5Lu2CiAgICBlbWl0dGVyLm9uKCdyZWZyZXNoQ2FsZW5kYXInLCAoKSA9PiB7CiAgICAgIC8vIOWBh+iuvuaXpeWOhuacieiHquW3seeahOWIt+aWsOaWueazle+8jOi/memHjOaIkeS7rOiwg+eUqOWugwogICAgICAvLyDlpoLmnpzml6Xljobnu4Tku7bmnIlyZWYsIOWPr+S7peaYryB0aGlzLiRyZWZzLmNhbGVuZGFyLmZldGNoRXZlbnRzKCk7CiAgICAgIC8vIOaIluiAheWmguaenOWIt+aWsOmAu+i+keWcqOW9k+WJjee7hOS7tuWGhe+8jOebtOaOpeiwg+eUqAogICAgICBjb25zb2xlLmxvZygn5pS25Yiw5pel5Y6G5Yi35paw5LqL5Lu277yM5q2j5Zyo6YeN5paw5Yqg6L295pWw5o2uLi4uJyk7CiAgICAgIC8vIOekuuS+izogZmluZENhbGVuZGFyQ29tcG9uZW50QW5kUmVmcmVzaCgpOwogICAgfSk7CgogICAgLy8gLS0tIOaWsOWinu+8muWNoeeJh+aTjeS9nOWHveaVsCAtLS0KICAgIGNvbnN0IGVkaXRFdmVudCA9IGFzeW5jIG1zZyA9PiB7CiAgICAgIGlmICghbXNnIHx8ICFtc2cuZXZlbnRfaWQgfHwgbXNnLmlzX3NjaGVkdWxlICE9PSB0cnVlKSB7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfml6DmlYjnmoTml6XnqIvkv6Hmga/vvIzml6Dms5XnvJbovpEnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICAvLyDojrflj5bkuovku7bor6bmg4UKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGdldENhbGVuZGFyRXZlbnQobXNnLmV2ZW50X2lkKTsKICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+aXoOazleiOt+WPluaXpeeoi+ivpuaDhe+8jOivt+eojeWQjumHjeivlScpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g6K6+572u57yW6L6R5LqL5Lu25pWw5o2uCiAgICAgICAgZWRpdGluZ0V2ZW50LnZhbHVlID0gewogICAgICAgICAgLi4ucmVzcG9uc2UuZGF0YQogICAgICAgIH07CiAgICAgICAgY3VycmVudEVkaXRpbmdNZXNzYWdlLnZhbHVlID0gbXNnOwoKICAgICAgICAvLyDmmL7npLrnvJbovpHlr7nor53moYYKICAgICAgICBlZGl0RXZlbnREaWFsb2dWaXNpYmxlLnZhbHVlID0gdHJ1ZTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICB2YXIgX2Vycm9yJHJlc3BvbnNlLCBfZXJyb3IkcmVzcG9uc2UkZGF0YTsKICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bml6XnqIvor6bmg4Xlh7rplJk6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign6I635Y+W5pel56iL5L+h5oGv5aSx6LSlOiAnICsgKCgoX2Vycm9yJHJlc3BvbnNlID0gZXJyb3IucmVzcG9uc2UpID09PSBudWxsIHx8IF9lcnJvciRyZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9lcnJvciRyZXNwb25zZSRkYXRhID0gX2Vycm9yJHJlc3BvbnNlLmRhdGEpID09PSBudWxsIHx8IF9lcnJvciRyZXNwb25zZSRkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXJyb3IkcmVzcG9uc2UkZGF0YS5tZXNzYWdlKSB8fCBlcnJvci5tZXNzYWdlIHx8ICfmnKrnn6XplJnor68nKSk7CiAgICAgIH0KICAgIH07CgogICAgLy8g5L+d5a2Y57yW6L6R5ZCO55qE5LqL5Lu2CiAgICBjb25zdCBzYXZlRWRpdEV2ZW50ID0gYXN5bmMgKCkgPT4gewogICAgICBpZiAoIWVkaXRpbmdFdmVudC52YWx1ZSB8fCAhY3VycmVudEVkaXRpbmdNZXNzYWdlLnZhbHVlKSB7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfnvJbovpHmlbDmja7ml6DmlYgnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIOeugOWNlemqjOivgQogICAgICBpZiAoIWVkaXRpbmdFdmVudC52YWx1ZS50aXRsZSkgewogICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfor7fovpPlhaXml6XnqIvmoIfpopgnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIOe7hOijheabtOaWsOaVsOaNrgogICAgICBjb25zdCB1cGRhdGVEYXRhID0gewogICAgICAgIHRpdGxlOiBlZGl0aW5nRXZlbnQudmFsdWUudGl0bGUsCiAgICAgICAgc3RhcnQ6IGVkaXRpbmdFdmVudC52YWx1ZS5zdGFydCwKICAgICAgICBlbmQ6IGVkaXRpbmdFdmVudC52YWx1ZS5lbmQsCiAgICAgICAgbG9jYXRpb246IGVkaXRpbmdFdmVudC52YWx1ZS5sb2NhdGlvbiB8fCAnJywKICAgICAgICBkZXNjcmlwdGlvbjogZWRpdGluZ0V2ZW50LnZhbHVlLmRlc2NyaXB0aW9uIHx8ICcnLAogICAgICAgIHR5cGU6IGVkaXRpbmdFdmVudC52YWx1ZS50eXBlLAogICAgICAgIHJlbWluZGVyOiBlZGl0aW5nRXZlbnQudmFsdWUucmVtaW5kZXIgfHwgJ25vbmUnCiAgICAgIH07CiAgICAgIHRyeSB7CiAgICAgICAgLy8g6LCD55So5pu05pawQVBJCiAgICAgICAgYXdhaXQgdXBkYXRlRXZlbnQoZWRpdGluZ0V2ZW50LnZhbHVlLmlkLCB1cGRhdGVEYXRhKTsKCiAgICAgICAgLy8g5pu05paw5raI5oGv5Y2h54mH5YaF5a65CiAgICAgICAgaWYgKGN1cnJlbnRFZGl0aW5nTWVzc2FnZS52YWx1ZSkgewogICAgICAgICAgY29uc3QgdGl0bGUgPSBlZGl0aW5nRXZlbnQudmFsdWUudGl0bGU7CiAgICAgICAgICBjb25zdCBzdGFydCA9IGZvcm1hdElTT0RhdGUoZWRpdGluZ0V2ZW50LnZhbHVlLnN0YXJ0KTsKICAgICAgICAgIGNvbnN0IGVuZCA9IGZvcm1hdElTT0RhdGUoZWRpdGluZ0V2ZW50LnZhbHVlLmVuZCk7CiAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IGVkaXRpbmdFdmVudC52YWx1ZS5sb2NhdGlvbjsKICAgICAgICAgIGxldCBjb250ZW50ID0gYOW3suaIkOWKn+abtOaWsOaXpeeoi++8mioqJHt0aXRsZX0qKlxuXG5gOwogICAgICAgICAgY29udGVudCArPSBgLSAqKuaXtumXtCoqOiAke3N0YXJ0fSAtICR7ZW5kfVxuYDsKICAgICAgICAgIGlmIChsb2NhdGlvbikgY29udGVudCArPSBgLSAqKuWcsOeCuSoqOiAke2xvY2F0aW9ufVxuYDsKICAgICAgICAgIGN1cnJlbnRFZGl0aW5nTWVzc2FnZS52YWx1ZS5jb250ZW50ID0gbWFya2VkLnBhcnNlKGNvbnRlbnQpOwogICAgICAgICAgY3VycmVudEVkaXRpbmdNZXNzYWdlLnZhbHVlLnN0YXR1cyA9ICdzdWNjZXNzJzsKICAgICAgICB9CgogICAgICAgIC8vIOinpuWPkeaXpeWOhuWIt+aWsOS6i+S7tgogICAgICAgIGVtaXR0ZXIuZW1pdCgncmVmcmVzaENhbGVuZGFyJyk7CiAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+aXpeeoi+W3suaIkOWKn+abtOaWsO+8gScpOwoKICAgICAgICAvLyDlhbPpl63lr7nor53moYYKICAgICAgICBlZGl0RXZlbnREaWFsb2dWaXNpYmxlLnZhbHVlID0gZmFsc2U7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgdmFyIF9lcnJvciRyZXNwb25zZTIsIF9lcnJvciRyZXNwb25zZTIkZGF0YTsKICAgICAgICBjb25zb2xlLmVycm9yKCfmm7TmlrDml6XnqIvlpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5pu05paw5aSx6LSlOiAnICsgKCgoX2Vycm9yJHJlc3BvbnNlMiA9IGVycm9yLnJlc3BvbnNlKSA9PT0gbnVsbCB8fCBfZXJyb3IkcmVzcG9uc2UyID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2Vycm9yJHJlc3BvbnNlMiRkYXRhID0gX2Vycm9yJHJlc3BvbnNlMi5kYXRhKSA9PT0gbnVsbCB8fCBfZXJyb3IkcmVzcG9uc2UyJGRhdGEgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lcnJvciRyZXNwb25zZTIkZGF0YS5tZXNzYWdlKSB8fCBlcnJvci5tZXNzYWdlIHx8ICfmnKrnn6XplJnor68nKSk7CiAgICAgIH0KICAgIH07CgogICAgLy8g5LuO5Y2h54mH5Lit5Yig6Zmk5pel56iLCiAgICBjb25zdCBkZWxldGVFdmVudEZyb21DYXJkID0gYXN5bmMgZXZlbnRJZCA9PiB7CiAgICAgIGlmICghZXZlbnRJZCkgewogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5peg5rOV5Yig6Zmk77ya57y65bCR5LqL5Lu2SUQnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCBFbE1lc3NhZ2VCb3guY29uZmlybSgn5oKo56Gu5a6a6KaB5Yig6Zmk6L+Z5Liq5pel56iL5ZCX77yfJywgJ+aPkOekuicsIHsKICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu6K6k5Yig6ZmkJywKICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICflj5bmtognLAogICAgICAgICAgdHlwZTogJ3dhcm5pbmcnCiAgICAgICAgfSk7CgogICAgICAgIC8vIOiwg+eUqOWIoOmZpEFQSQogICAgICAgIGF3YWl0IGRlbGV0ZUNhbGVuZGFyRXZlbnQoZXZlbnRJZCk7CgogICAgICAgIC8vIOaJvuWIsOWMheWQq+i/meS4quS6i+S7tklE55qE5Y2h54mH5raI5oGvCiAgICAgICAgY29uc3QgZXZlbnRNc2cgPSBtZXNzYWdlcy52YWx1ZS5maW5kKG1zZyA9PiBtc2cudHlwZSA9PT0gJ2NhcmQnICYmIG1zZy5ldmVudF9pZCA9PT0gZXZlbnRJZCAmJiBtc2cuaXNfc2NoZWR1bGUgPT09IHRydWUpOwogICAgICAgIGlmIChldmVudE1zZykgewogICAgICAgICAgLy8g6I635Y+W5LqL5Lu25qCH6aKYCiAgICAgICAgICBjb25zdCB0aXRsZU1hdGNoID0gZXZlbnRNc2cuY29udGVudC5tYXRjaCgvXCpcKihbXipdKylcKlwqLyk7CiAgICAgICAgICBjb25zdCBldmVudFRpdGxlID0gdGl0bGVNYXRjaCA/IHRpdGxlTWF0Y2hbMV0gOiAn5byA5LyaJzsKCiAgICAgICAgICAvLyDmm7TmlrDljaHniYfmmL7npLrkuLrlt7LliKDpmaTvvIzkvYbkvb/nlKjnroDmtIHnmoTnoa7orqTmtojmga8KICAgICAgICAgIGV2ZW50TXNnLnN0YXR1cyA9ICdkZWxldGVkJzsKICAgICAgICAgIGV2ZW50TXNnLmNvbnRlbnQgPSBg5aW955qE77yM5ZCN5Li6IiR7ZXZlbnRUaXRsZX0i55qE5LqL5Lu25bey5oiQ5Yqf5Yig6Zmk44CCYDsKICAgICAgICB9CgogICAgICAgIC8vIOinpuWPkeaXpeWOhuWIt+aWsOS6i+S7tgogICAgICAgIGVtaXR0ZXIuZW1pdCgncmVmcmVzaENhbGVuZGFyJyk7CiAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+aXpeeoi+W3suWIoOmZpCcpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHZhciBfZXJyb3IkcmVzcG9uc2UzOwogICAgICAgIGlmIChlcnJvciA9PT0gJ2NhbmNlbCcpIHJldHVybjsKICAgICAgICBpZiAoKChfZXJyb3IkcmVzcG9uc2UzID0gZXJyb3IucmVzcG9uc2UpID09PSBudWxsIHx8IF9lcnJvciRyZXNwb25zZTMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9lcnJvciRyZXNwb25zZTMuc3RhdHVzKSA9PT0gNDA0KSB7CiAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+aTjeS9nOWksei0pe+8muivpeaXpeeoi+W3suiiq+WIoOmZpOaIluS4jeWtmOWcqOOAgicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgX2Vycm9yJHJlc3BvbnNlNCwgX2Vycm9yJHJlc3BvbnNlNCRkYXRhOwogICAgICAgICAgY29uc29sZS5lcnJvcigi5LuO5Y2h54mH5Yig6Zmk5pel56iL5pe25Ye66ZSZOiIsIGVycm9yKTsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Yig6Zmk5aSx6LSl77yaJyArICgoKF9lcnJvciRyZXNwb25zZTQgPSBlcnJvci5yZXNwb25zZSkgPT09IG51bGwgfHwgX2Vycm9yJHJlc3BvbnNlNCA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9lcnJvciRyZXNwb25zZTQkZGF0YSA9IF9lcnJvciRyZXNwb25zZTQuZGF0YSkgPT09IG51bGwgfHwgX2Vycm9yJHJlc3BvbnNlNCRkYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZXJyb3IkcmVzcG9uc2U0JGRhdGEubWVzc2FnZSkgfHwgZXJyb3IubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJykpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICAvLyDmm7TmlrDljaHniYfmmL7npLoKICAgIGNvbnN0IHVwZGF0ZUNhcmREaXNwbGF5ID0gKG1zZywgdGl0bGUsIGRlc2NyaXB0aW9uKSA9PiB7CiAgICAgIC8vIOaehOW7uuaWsOeahOWNoeeJh+WGheWuuQogICAgICBjb25zdCBldmVudERhdGUgPSBuZXcgRGF0ZSgpOwogICAgICBjb25zdCBkYXRlU3RyID0gYCR7ZXZlbnREYXRlLmdldEZ1bGxZZWFyKCl95bm0JHtldmVudERhdGUuZ2V0TW9udGgoKSArIDF95pyIJHtldmVudERhdGUuZ2V0RGF0ZSgpfeaXpWA7CiAgICAgIGxldCBjb250ZW50ID0gYOW3suaIkOWKn+abtOaWsOaXpeeoi++8mioqJHt0aXRsZX0qKlxuXG5gOwogICAgICBjb250ZW50ICs9IGDml6XmnJ/vvJoke2RhdGVTdHJ9XG5cbmA7CiAgICAgIGlmIChkZXNjcmlwdGlvbikgewogICAgICAgIGNvbnRlbnQgKz0gYOaPj+i/sO+8miR7ZGVzY3JpcHRpb259XG5cbmA7CiAgICAgIH0KICAgICAgY29udGVudCArPSBg5oKo5Y+v5Lul5Zyo5pel5Y6G5Lit5p+l55yL5a6M5pW06K+m5oOF44CCYDsKCiAgICAgIC8vIOabtOaWsOWNoeeJh+WGheWuuQogICAgICBtc2cuY29udGVudCA9IG1hcmtlZC5wYXJzZShjb250ZW50KTsKCiAgICAgIC8vIOehruS/neWNoeeJh+eKtuaAgeS4uuaIkOWKnwogICAgICBtc2cuc3RhdHVzID0gJ3N1Y2Nlc3MnOwoKICAgICAgLy8g5by65Yi26YeN5paw5riy5p+T5Y2h54mHCiAgICAgIG5leHRUaWNrKCgpID0+IHsKICAgICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5vcGVud2VidWktY2FyZC1tZXNzYWdlW2RhdGEtZXZlbnQtaWQ9IiR7bXNnLmV2ZW50X2lkfSJdYCk7CiAgICAgICAgaWYgKGNhcmRFbGVtZW50KSB7CiAgICAgICAgICBjYXJkRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCdjbGFyaWZpY2F0aW9uLWNhcmQnLCAnZXJyb3ItY2FyZCcsICdkZWxldGVkLWNhcmQnKTsKICAgICAgICAgIGNhcmRFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3N1Y2Nlc3MtY2FyZCcpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIC8vIOS4uuaXpeacn+mAieaLqeWZqOagvOW8j+WMluaXpeacnyAo5L+d55WZ5q2k5Ye95pWw5Lul5YW85a655YW25LuW5Zyw5pa555qE6LCD55SoKQogICAgY29uc3QgZm9ybWF0RGF0ZUZvclBpY2tlciA9IGRhdGUgPT4gewogICAgICBpZiAoIWRhdGUpIHJldHVybiAnJzsKICAgICAgdHJ5IHsKICAgICAgICAvLyDnoa7kv53kvb/nlKjmnInmlYjnmoREYXRl5a+56LGhCiAgICAgICAgbGV0IGRhdGVPYmo7CiAgICAgICAgaWYgKGRhdGUgaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgICBpZiAoaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+aXoOaViOaXpeacn+WvueixoScsIGRhdGUpOwogICAgICAgICAgICBkYXRlT2JqID0gbmV3IERhdGUoKTsgLy8g5L2/55So5b2T5YmN5pe26Ze05L2c5Li65Zue6YCACiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkYXRlT2JqID0gZGF0ZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8g5bCd6K+V6Kej5p6Q5a2X56ym5Liy5pel5pyfCiAgICAgICAgICBkYXRlT2JqID0gbmV3IERhdGUoZGF0ZSk7CiAgICAgICAgICBpZiAoaXNOYU4oZGF0ZU9iai5nZXRUaW1lKCkpKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+aXoOaViOaXpeacn+Wtl+espuS4sicsIGRhdGUpOwogICAgICAgICAgICBkYXRlT2JqID0gbmV3IERhdGUoKTsgLy8g5L2/55So5b2T5YmN5pe26Ze05L2c5Li65Zue6YCACiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyDkvb/nlKjnm7TmjqXojrflj5blubTmnIjml6Xml7bliIbnmoTmlrnlvI/vvIzkuI3mtonlj4rml7bljLrovazmjaIKICAgICAgICBjb25zdCB5ZWFyID0gZGF0ZU9iai5nZXRGdWxsWWVhcigpOwogICAgICAgIGNvbnN0IG1vbnRoID0gKGRhdGVPYmouZ2V0TW9udGgoKSArIDEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsKICAgICAgICBjb25zdCBkYXkgPSBkYXRlT2JqLmdldERhdGUoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgY29uc3QgaG91cnMgPSBkYXRlT2JqLmdldEhvdXJzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpOwogICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBkYXRlT2JqLmdldE1pbnV0ZXMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7CiAgICAgICAgY29uc3QgZm9ybWF0dGVkID0gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9ICR7aG91cnN9OiR7bWludXRlc31gOwogICAgICAgIHJldHVybiBmb3JtYXR0ZWQ7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5pel5pyf5qC85byP5YyW6ZSZ6K+vOicsIGVycm9yKTsKICAgICAgICAvLyDov5Tlm57lvZPliY3ml7bpl7TkvZzkuLrlm57pgIDpgInpobkKICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpOwogICAgICAgIHJldHVybiBgJHtub3cuZ2V0RnVsbFllYXIoKX0tJHsobm93LmdldE1vbnRoKCkgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9LSR7bm93LmdldERhdGUoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9ICR7bm93LmdldEhvdXJzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfToke25vdy5nZXRNaW51dGVzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWA7CiAgICAgIH0KICAgIH07CiAgICByZXR1cm4gewogICAgICBpbnB1dCwKICAgICAgbWVzc2FnZXMsCiAgICAgIHNlbmRNc2csCiAgICAgIGNoYXRCb2R5LAogICAgICBmaWxlSW5wdXQsCiAgICAgIHRyaWdnZXJGaWxlSW5wdXQsCiAgICAgIGhhbmRsZUZpbGVVcGxvYWQsCiAgICAgIHNlbGVjdGVkRmlsZXMsCiAgICAgIHJlbW92ZUZpbGUsCiAgICAgIFVwbG9hZEZpbGxlZCwKICAgICAgRG9jdW1lbnQsCiAgICAgIENsb3NlLAogICAgICBDaGVjaywKICAgICAgbG9hZGluZywKICAgICAgcHJvY2Vzc2luZ0ZpbGVzLAogICAgICBjbGVhckNoYXQsCiAgICAgIHNob3dDb250ZXh0QmFyLAogICAgICBjaGF0SWQsCiAgICAgIHVzZXJBdmF0YXJVcmwsCiAgICAgIGhhbmRsZUF2YXRhckVycm9yLAogICAgICBzZWFyY2hNZXRob2QsCiAgICAgIGNoYXRNb2RlLAogICAgICByZXRyaWV2YWxTY29wZSwKICAgICAgLy8g5Y+z5L6n6Z2i5p2/55u45YWzCiAgICAgIHJpZ2h0UGFuZWxDb2xsYXBzZWQsCiAgICAgIGNoYXRTZXNzaW9ucywKICAgICAgc3dpdGNoQ2hhdFNlc3Npb24sCiAgICAgIGZvcm1hdFRpbWUsCiAgICAgIG5hdmlnYXRlVG8sCiAgICAgIG5hdmlnYXRlVG9Nb2R1bGUsCiAgICAgIC8vIOWbvuagh+e7hOS7tgogICAgICBDYWxlbmRhciwKICAgICAgQ2hhdERvdFJvdW5kLAogICAgICBDb2xsZWN0aW9uLAogICAgICBEb2N1bWVudENvcHksCiAgICAgIEdyaWQsCiAgICAgIENvbm5lY3Rpb24sCiAgICAgIGRlbGV0ZVNlc3Npb24sCiAgICAgIGNvbmZpcm1DbGVhckFsbEhpc3RvcnksCiAgICAgIGNsZWFyQWxsSGlzdG9yeSwKICAgICAgZ2V0Q2FyZENsYXNzLAogICAgICBnZXRDYXJkSWNvbiwKICAgICAgZ2V0Q2FyZFRpdGxlLAogICAgICBlZGl0RXZlbnQsCiAgICAgIGRlbGV0ZUV2ZW50RnJvbUNhcmQsCiAgICAgIGVkaXRFdmVudERpYWxvZ1Zpc2libGUsCiAgICAgIGVkaXRpbmdFdmVudCwKICAgICAgc2F2ZUVkaXRFdmVudCwKICAgICAgLy8g5re75Yqg6L+Z5Lik5Liq5Ye95pWw5Lul6Kej5YazRVNMaW506K2m5ZGKCiAgICAgIHVwZGF0ZUNhcmREaXNwbGF5LAogICAgICBmb3JtYXREYXRlRm9yUGlja2VyCiAgICB9OwogIH0KfTs="},{"version":3,"names":["ref","nextTick","computed","onMounted","watch","UploadFilled","Document","Close","Check","Delete","DataAnalysis","Cpu","MagicStick","ChatLineSquare","Fold","Expand","Calendar","ChatDotRound","Collection","DocumentCopy","Grid","Connection","CircleCheckFilled","InfoFilled","CircleCloseFilled","WarningFilled","EditPen","request","marked","ElMessage","ElMessageBox","aiChatWithDocumentsStream","getAIChatSessions","getAIChatSession","deleteAIChatSession","deleteCalendarEvent","getCurrentInstance","getCalendarEvent","updateEvent","formatSize","size","toFixed","getExt","name","arr","split","length","toLowerCase","getFileLabel","type","ext","ext_lower","startsWith","includes","toUpperCase","getFileBg","escapeHtml","html","replace","m","formatTime","dateTimeStr","date","Date","getMonth","getDate","getHours","toString","padStart","getMinutes","formatISODate","isoDateStr","toLocaleString","year","month","day","hour","minute","error","console","components","setup","proxy","userAvatarUrl","$store","state","user","avatar","handleAvatarError","value","input","messages","role","content","rawContent","chatBody","fileInput","selectedFiles","loading","processingFiles","some","file","status","chatId","showContextBar","searchMethod","chatMode","retrievalScope","currentRequestController","rightPanelCollapsed","chatSessions","editEventDialogVisible","editingEvent","currentEditingMessage","emitter","fetchChatSessions","res","data","Array","isArray","results","switchChatSession","sessionId","map","msg","source","sessionExists","session","id","clearChat","newChatId","getUserInfo","url","method","log","avatarUrl","findAvatar","obj","key","result","baseUrl","window","location","origin","scrollToBottom","scrollTop","scrollHeight","uploadFileAndGetId","formData","FormData","append","rawFile","progress","smoothTimer","lastProgress","uploadFinished","onUploadProgress","progressEvent","percentCompleted","Math","round","loaded","total","fakeProgress","setInterval","clearInterval","documentId","pollDocumentStatus","Error","message","interval","min","setTimeout","e","abort","processBuffer","lastMessage","streaming","push","filteredContent","parse","event_id","is_schedule","emit","targetCard","find","chat_id","sendMsg","trim","warning","userMsg","files","f","assistantMsg","currentInput","currentDocumentIds","filter","Boolean","aiSettings","aiSettingsResponse","success","requestData","document_ids","ai_settings","payload","lastMsg","triggerFileInput","click","handleFileUpload","target","allowedTypes","supportedFormats","validFiles","hasInvalidFile","validExtensions","from","forEach","isValidExtension","now","random","reader","FileReader","onload","ev","label","bg","readAsDataURL","URL","createObjectURL","warn","info","removeFile","idx","splice","renderer","Renderer","table","header","body","code","infostring","escaped","codeId","substr","lang","langLabel","langClass","disableStrikethrough","walkTokens","token","text","raw","tokens","use","setOptions","breaks","gfm","headerIds","mangle","getCardClass","getCardIcon","getCardTitle","navigateTo","path","currentPath","pathname","href","navigateToModule","deleteSession","confirm","confirmButtonText","cancelButtonText","confirmClearAllHistory","then","clearAllHistory","catch","document","addEventListener","classList","contains","getAttribute","codeElem","getElementById","navigator","clipboard","writeText","innerText","on","editEvent","response","_error$response","_error$response$data","saveEditEvent","title","updateData","start","end","description","reminder","_error$response2","_error$response2$data","deleteEventFromCard","eventId","eventMsg","titleMatch","match","eventTitle","_error$response3","_error$response4","_error$response4$data","updateCardDisplay","eventDate","dateStr","getFullYear","cardElement","querySelector","remove","add","formatDateForPicker","dateObj","isNaN","getTime","hours","minutes","formatted"],"sources":["C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\dashboard\\Index.vue"],"sourcesContent":["<template>\n  <div class=\"openwebui-chat-root\">\n    <div class=\"openwebui-chat-window\">\n      <div class=\"openwebui-chat-header\">\n        <span class=\"openwebui-title\">智慧AI办公助手</span>\n        <el-button type=\"link\" size=\"small\" @click=\"clearChat\" class=\"clear-chat-btn\">\n          <el-icon><Delete /></el-icon> 新对话\n        </el-button>\n      </div>\n      \n      <div class=\"openwebui-chat-container\">\n        <div class=\"openwebui-chat-body\" ref=\"chatBody\">\n          <div v-for=\"(msg, idx) in messages\" :key=\"idx\" :class=\"['openwebui-msg', msg.role]\">\n            <template v-if=\"msg.role==='assistant'\">\n              <div class=\"openwebui-avatar ai-avatar left-avatar\">\n                <svg viewBox=\"0 0 40 40\" width=\"36\" height=\"36\"><circle cx=\"20\" cy=\"20\" r=\"20\" fill=\"#2f54eb\"/><text x=\"50%\" y=\"55%\" text-anchor=\"middle\" fill=\"#fff\" font-size=\"20\" font-family=\"Arial\" dy=\".3em\">🤖</text></svg>\n              </div>\n            </template>\n            <template v-if=\"msg.role==='user'\">\n              <div class=\"openwebui-avatar user-avatar right-avatar\">\n                <img v-if=\"userAvatarUrl\" :src=\"userAvatarUrl\" class=\"user-avatar-img\" alt=\"用户头像\" @error=\"handleAvatarError\" />\n                <svg v-else viewBox=\"0 0 40 40\" width=\"36\" height=\"36\"><circle cx=\"20\" cy=\"20\" r=\"20\" fill=\"#bbb\"/><text x=\"50%\" y=\"55%\" text-anchor=\"middle\" fill=\"#fff\" font-size=\"20\" font-family=\"Arial\" dy=\".3em\">🧑</text></svg>\n              </div>\n            </template>\n            <div class=\"openwebui-msg-bubble\">\n              <template v-if=\"msg.type === 'text'\">\n                <span v-if=\"msg.role==='user'\">{{ msg.content }}</span>\n                <span v-else v-html=\"msg.content\"></span>\n                <span v-if=\"msg.streaming\" class=\"openwebui-cursor\"></span>\n                <div v-if=\"msg.source === 'knowledge_base' && msg.role === 'assistant'\" class=\"source-tag knowledge-base-tag\">\n                  <el-icon><DataAnalysis /></el-icon> 知识库\n                </div>\n                <div v-if=\"msg.source === 'general_ai' && msg.role === 'assistant'\" class=\"source-tag general-ai-tag\">\n                  <el-icon><Cpu /></el-icon> AI大模型\n                </div>\n              </template>\n              <!-- 卡片类型消息渲染（已修改） -->\n              <template v-else-if=\"msg.type === 'card'\">\n                <div class=\"openwebui-card-message\" :class=\"getCardClass(msg.status)\" :data-event-id=\"msg.event_id\">\n                  <div class=\"card-icon-wrapper\">\n                    <el-icon><component :is=\"getCardIcon(msg.status)\" /></el-icon>\n                  </div>\n                  <div class=\"card-content-wrapper\">\n                    <div class=\"card-title\">{{ getCardTitle(msg.status) }}</div>\n                    <div class=\"card-body\" v-html=\"msg.content\"></div>\n                    <!-- 新增：卡片操作按钮 -->\n                    <div v-if=\"msg.status === 'success' && msg.event_id\" class=\"card-actions\">\n                        <el-button size=\"small\" @click=\"editEvent(msg)\" round>\n                          <el-icon><EditPen /></el-icon> 编辑\n                        </el-button>\n                        <el-button type=\"danger\" size=\"small\" @click=\"deleteEventFromCard(msg.event_id)\" round>\n                          <el-icon><Delete /></el-icon> 删除\n                        </el-button>\n                    </div>\n                  </div>\n                </div>\n              </template>\n              <template v-else-if=\"msg.type === 'file'\">\n                <div class=\"file-bubble-nest file-bubble-vertical\">\n                  <div v-for=\"file in msg.files\" :key=\"file.name + file.size\" class=\"file-message-card\">\n                    <div class=\"file-icon-area\">\n                      <img v-if=\"file.ext==='csv'\" src=\"https://cdn.jsdelivr.net/gh/file-icons/icons/svg/csv.svg\" class=\"file-icon-img\" />\n                      <el-icon v-else><Document /></el-icon>\n                    </div>\n                    <div class=\"file-info-area\">\n                      <div class=\"file-name\">{{ file.name }}</div>\n                      <div class=\"file-meta\">{{ file.ext.toUpperCase() }} · {{ file.size }}</div>\n                    </div>\n                  </div>\n                  <div class=\"file-desc-text\" v-if=\"msg.content\">{{ msg.content }}</div>\n                </div>\n              </template>\n            </div>\n          </div>\n        </div>\n        \n        <!-- 右侧面板 - 包含模式切换和历史记录 -->\n        <div class=\"openwebui-right-panel\" :class=\"{'collapsed': rightPanelCollapsed}\">\n          <div class=\"right-panel-header\">\n            <!-- 模式切换按钮 -->\n            <div class=\"right-panel-mode-controls\">\n              <el-radio-group v-model=\"chatMode\" size=\"default\">\n                <el-radio-button label=\"agent\">\n                  <el-icon><MagicStick /></el-icon> AI助手\n                </el-radio-button>\n                <el-radio-button label=\"knowledge_base\">\n                  <el-icon><DataAnalysis /></el-icon> 知识库\n                </el-radio-button>\n              </el-radio-group>\n            </div>\n            \n            <!-- 展开/收起按钮 -->\n            <el-button \n              circle\n              @click=\"rightPanelCollapsed = !rightPanelCollapsed\"\n              :title=\"rightPanelCollapsed ? '展开' : '收起'\"\n              class=\"collapse-button\"\n            >\n              <el-icon :size=\"16\">\n                <Expand v-if=\"!rightPanelCollapsed\" />\n                <Fold v-else />\n              </el-icon>\n            </el-button>\n          </div>\n          \n          <!-- 历史记录内容 -->\n          <div class=\"history-container\">\n            <div class=\"history-header\">\n              <h3 class=\"history-title\">历史记录</h3>\n              <el-button \n                v-if=\"chatSessions.length > 0\"\n                text\n                size=\"small\" \n                class=\"clear-all-btn\"\n                @click=\"confirmClearAllHistory\"\n              >\n                清空\n              </el-button>\n            </div>\n            \n            <div class=\"history-list\">\n              <div \n                v-for=\"(session, index) in chatSessions\" \n                :key=\"session.id\"\n                class=\"history-item\"\n                :class=\"{'active': session.id === chatId}\"\n              >\n                <div class=\"history-item-content\" @click=\"switchChatSession(session.id)\">\n                  <div class=\"history-item-icon\">\n                    <el-icon><ChatLineSquare /></el-icon>\n                  </div>\n                  <div class=\"history-item-info\">\n                    <div class=\"history-item-title\">{{ session.title || `对话 ${index + 1}` }}</div>\n                    <div class=\"history-item-time\">{{ formatTime(session.created_at) }}</div>\n                  </div>\n                </div>\n                <div class=\"history-item-actions\">\n                  <div class=\"delete-btn-wrapper\" @click.stop=\"deleteSession(session.id)\">\n                    <el-icon class=\"delete-icon\"><Delete /></el-icon>\n                  </div>\n                </div>\n              </div>\n              <div v-if=\"chatSessions.length === 0\" class=\"history-empty\">\n                暂无历史记录\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"openwebui-chat-footer\">\n        <!-- 预览区放在footer顶部 -->\n        <div v-if=\"selectedFiles.length\" class=\"openwebui-file-preview-bar\">\n          <div v-for=\"(file, idx) in selectedFiles\" :key=\"file.id\" class=\"openwebui-file-card\">\n            <div class=\"openwebui-file-thumb\">\n              <img v-if=\"file.type.startsWith('image/')\" :src=\"file.url\" class=\"openwebui-file-img\" />\n              <div v-else class=\"openwebui-file-icon\" :style=\"{background: file.bg}\">\n                <el-icon v-if=\"file.ext==='pdf'\"><Document /></el-icon>\n                <el-icon v-else-if=\"file.ext==='csv' || file.ext==='xls' || file.ext==='xlsx'\"><Document /></el-icon>\n                <el-icon v-else><Document /></el-icon>\n              </div>\n            </div>\n            <div class=\"openwebui-file-info\">\n              <div class=\"openwebui-file-name\" :title=\"file.name\">{{ file.name }}</div>\n              <div class=\"openwebui-file-meta\">{{ file.label }} · {{ file.size }}</div>\n              <!-- 添加进度条显示 -->\n              <el-progress \n                v-if=\"file.status !== 'completed'\" \n                :percentage=\"file.progress\" \n                :status=\"file.status === 'failed' ? 'exception' : ''\" \n                :stroke-width=\"4\"\n                class=\"openwebui-file-progress\" />\n              <div v-else class=\"openwebui-file-status completed\">\n                <el-icon><Check /></el-icon> 处理完成\n              </div>\n            </div>\n            <el-icon class=\"openwebui-file-remove\" @click=\"removeFile(idx)\"><Close /></el-icon>\n          </div>\n        </div>\n        <!-- 输入区 -->\n        <div class=\"openwebui-input-area\">\n          <input type=\"file\" ref=\"fileInput\" style=\"display:none\" @change=\"handleFileUpload\" multiple \n               accept=\".txt,.pdf,.doc,.docx,.md,.xls,.xlsx,.csv,.jpg,.jpeg,.png,.gif,.bmp,.webp,.svg,.tiff\" />\n          <el-tooltip\n            content=\"文档: txt, pdf, doc, docx, md&#10;表格: xls, xlsx, csv&#10;图片: jpg, jpeg, png, gif, bmp, webp, svg, tiff\"\n            placement=\"top\"\n            popper-class=\"openwebui-upload-tooltip\"\n            :open-delay=\"200\"\n            v-if=\"chatMode === 'agent'\"\n          >\n            <el-button class=\"openwebui-upload-btn\" @click=\"triggerFileInput\" title=\"上传文件/图片\" :disabled=\"loading\">\n              <el-icon><UploadFilled /></el-icon>\n            </el-button>\n          </el-tooltip>\n          <el-input\n            v-model=\"input\"\n            placeholder=\"请输入您的问题...\"\n            @keyup.enter=\"sendMsg\"\n            class=\"openwebui-input\"\n            :disabled=\"loading || processingFiles\"\n          />\n          <el-button type=\"primary\" @click=\"sendMsg\" class=\"openwebui-send-btn\" :loading=\"loading\" :disabled=\"processingFiles\">\n            {{ loading ? '生成中' : (processingFiles ? '处理中' : '发送') }}\n          </el-button>\n        </div>\n        <div class=\"openwebui-options-area\" v-if=\"chatMode === 'knowledge_base'\">\n            <el-radio-group v-model=\"searchMethod\" size=\"small\">\n              <el-radio-button label=\"basic\">基础检索</el-radio-button>\n              <el-radio-button label=\"local\">复杂检索</el-radio-button>\n            </el-radio-group>\n        </div>\n        <div class=\"openwebui-footer-hint\" v-if=\"chatMode === 'agent'\">\n          支持文档、表格、图片等多种格式文件\n        </div>\n      </div>\n    </div>\n\n    <!-- 新增：编辑日程对话框 -->\n    <el-dialog\n      v-model=\"editEventDialogVisible\"\n      title=\"编辑日程\"\n      width=\"500px\"\n      class=\"calendar-dialog\"\n      :append-to-body=\"true\"\n      :destroy-on-close=\"true\"\n      :close-on-click-modal=\"false\"\n    >\n      <el-form :model=\"editingEvent\" label-width=\"80px\" v-if=\"editingEvent\">\n        <el-form-item label=\"标题\">\n          <el-input v-model=\"editingEvent.title\" placeholder=\"请输入日程标题\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"开始时间\">\n          <el-date-picker\n            v-model=\"editingEvent.start\"\n            type=\"datetime\"\n            placeholder=\"选择开始时间\"\n            format=\"YYYY-MM-DD HH:mm\"\n            value-format=\"YYYY-MM-DD HH:mm\"\n          ></el-date-picker>\n        </el-form-item>\n        <el-form-item label=\"结束时间\">\n          <el-date-picker\n            v-model=\"editingEvent.end\"\n            type=\"datetime\"\n            placeholder=\"选择结束时间\"\n            format=\"YYYY-MM-DD HH:mm\"\n            value-format=\"YYYY-MM-DD HH:mm\"\n          ></el-date-picker>\n        </el-form-item>\n        <el-form-item label=\"地点\">\n          <el-input v-model=\"editingEvent.location\" placeholder=\"请输入地点\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"类型\">\n          <el-select v-model=\"editingEvent.type\" placeholder=\"请选择日程类型\">\n            <el-option label=\"会议\" value=\"blue\"></el-option>\n            <el-option label=\"出差\" value=\"orange\"></el-option>\n            <el-option label=\"假期\" value=\"green\"></el-option>\n            <el-option label=\"截止日期\" value=\"red\"></el-option>\n            <el-option label=\"其他\" value=\"purple\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"提醒\">\n          <el-select v-model=\"editingEvent.reminder\" placeholder=\"请选择提醒时间\">\n            <el-option label=\"不提醒\" value=\"none\"></el-option>\n            <el-option label=\"10分钟前\" value=\"10min\"></el-option>\n            <el-option label=\"30分钟前\" value=\"30min\"></el-option>\n            <el-option label=\"1小时前\" value=\"1hour\"></el-option>\n            <el-option label=\"1天前\" value=\"1day\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"备注\">\n          <el-input \n            v-model=\"editingEvent.description\" \n            type=\"textarea\" \n            :rows=\"3\"\n            placeholder=\"请输入备注信息\"\n          ></el-input>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <div class=\"dialog-footer\">\n          <el-button @click=\"editEventDialogVisible = false\">取消</el-button>\n          <el-button type=\"primary\" @click=\"saveEditEvent\">确定</el-button>\n        </div>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { ref, nextTick, computed, onMounted, watch } from 'vue'\nimport { UploadFilled, Document, Close, Check, Delete, DataAnalysis, Cpu, MagicStick, ChatLineSquare, Fold, Expand, \n  Calendar, ChatDotRound, Collection, DocumentCopy, Grid, Connection, CircleCheckFilled, InfoFilled, CircleCloseFilled, WarningFilled, EditPen } from '@element-plus/icons-vue'\nimport request from '@/utils/request'\nimport { marked } from 'marked'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport { aiChatWithDocumentsStream, getAIChatSessions, getAIChatSession, deleteAIChatSession } from '@/api/ai'\nimport { deleteCalendarEvent } from '@/api/calendar' // 新增导入\nimport { getCurrentInstance } from 'vue';\nimport { getCalendarEvent, updateEvent } from '@/api/calendar' // 新增导入\n\nfunction formatSize(size) {\n  if (size < 1024) return size + 'B';\n  if (size < 1024*1024) return (size/1024).toFixed(1) + 'KB';\n  return (size/1024/1024).toFixed(1) + 'MB';\n}\nfunction getExt(name) {\n  const arr = name.split('.');\n  return arr.length > 1 ? arr[arr.length-1].toLowerCase() : '';\n}\nfunction getFileLabel(type, ext) {\n  const ext_lower = ext.toLowerCase();\n  if (type.startsWith('image/')) return '图片';\n  if (ext_lower === 'pdf') return 'PDF';\n  if (['csv','xls','xlsx'].includes(ext_lower)) return '表格';\n  if (['doc','docx'].includes(ext_lower)) return '文档';\n  if (ext_lower === 'md') return 'Markdown';\n  if (ext_lower === 'txt') return '文本';\n  return ext_lower.toUpperCase();\n}\nfunction getFileBg(ext) {\n  const ext_lower = ext.toLowerCase();\n  if (ext_lower === 'pdf') return '#f87171'; // 红色\n  if (['csv','xls','xlsx'].includes(ext_lower)) return '#34d399'; // 绿色\n  if (['doc','docx'].includes(ext_lower)) return '#60a5fa'; // 蓝色\n  if (ext_lower === 'md') return '#a78bfa'; // 紫色\n  if (ext_lower === 'txt') return '#fbbf24'; // 黄色\n  return '#a5b4fc'; // 默认淡紫色\n}\nfunction escapeHtml(html) {\n  return html.replace(/[&<>\"']/g, function(m) {\n    return ({\n      '&': '&amp;',\n      '<': '&lt;',\n      '>': '&gt;',\n      '\"': '&quot;',\n      \"'\": '&#39;'\n    })[m];\n  });\n}\n\n// 格式化日期时间\nfunction formatTime(dateTimeStr) {\n  if (!dateTimeStr) return '';\n  const date = new Date(dateTimeStr);\n  return `${date.getMonth() + 1}月${date.getDate()}日 ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;\n}\n\n// ISO日期格式化为可读格式\nfunction formatISODate(isoDateStr) {\n  if (!isoDateStr) return '';\n  try {\n    const date = new Date(isoDateStr);\n    return date.toLocaleString('zh-CN', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  } catch (error) {\n    console.error('日期格式化错误:', error);\n    return isoDateStr; // 返回原始值\n  }\n}\n\nexport default {\n  name: 'Dashboard',\n  components: {\n    UploadFilled, Document, Close, Check, Delete, DataAnalysis, Cpu, MagicStick, ChatLineSquare, Fold, Expand,\n    Calendar, ChatDotRound, Collection, DocumentCopy, Grid, Connection, CircleCheckFilled, InfoFilled, CircleCloseFilled, WarningFilled, EditPen\n  },\n  setup() {\n    const { proxy } = getCurrentInstance();\n    const userAvatarUrl = ref(proxy.$store.state.user.avatar)\n    const handleAvatarError = () => {\n      userAvatarUrl.value = ''; // 加载失败时清空，会显示默认SVG\n    };\n    \n    const input = ref('')\n    const messages = ref([\n      { \n        role: 'assistant', \n        content: `<div class=\"welcome-message\">\n          <h3>欢迎来到智行舟平台</h3>\n          <div class=\"platform-intro\">\n            <p>智行舟平台是您的智能协作中心，融合了项目管理、即时通讯、智能文档和AI助手等。我们致力于通过前沿AI技术赋能您的团队，优化业务流程，为您打造无缝连接的未来办公新范式，核心优势如下：</p>\n            \n            <ul class=\"platform-features\">\n              <li><span class=\"feature-highlight\">AI智能引擎</span> - 我们的AI助手能够理解自然语言，处理复杂文档，创建日程，成为您24小时的智能工作伙伴。</li>\n              <li><span class=\"feature-highlight\">一体化协作</span> - 无缝整合项目、日程与沟通工具，打破信息孤岛，让团队协作如行云流水般顺畅，显著提升效率。</li>\n              <li><span class=\"feature-highlight\">智慧文档处理</span> - 从智能合同生成到知识库管理，自动化处理繁杂的文档工作流，让您的团队聚焦于核心创新。</li>\n              <li><span class=\"feature-highlight\">安全可靠保障</span> - 采用企业级数据加密与精细化权限管理，全方位守护您的核心数据资产安全。</li>\n            </ul>\n            \n            <p>借助智行舟平台，您的企业将迈入更敏捷、高效、智能的协作新纪元，激发团队潜力，提升整体竞争力。</p>\n          </div>\n          <p>选择以下功能模块，或直接向我提问，我将为您提供智能助手服务。</p>\n          <div class=\"quick-nav-cards\">\n            <div class=\"nav-card\" onclick=\"window.location.href='/project'\">\n              <div class=\"nav-card-icon\">\n                <i class=\"bi bi-kanban\"></i>\n              </div>\n              <div class=\"nav-card-content\">\n                <div class=\"nav-card-title\">项目协作</div>\n                <div class=\"nav-card-desc\">任务分配、进度跟踪、团队协作</div>\n              </div>\n              <div class=\"nav-card-arrow\"><i class=\"nav-arrow-icon\">→</i></div>\n            </div>\n            <div class=\"nav-card\" onclick=\"window.location.href='/calendar'\">\n              <div class=\"nav-card-icon\">\n                <i class=\"bi bi-calendar-week\"></i>\n              </div>\n              <div class=\"nav-card-content\">\n                <div class=\"nav-card-title\">日程安排</div>\n                <div class=\"nav-card-desc\">会议预约、日程提醒、时间管理</div>\n              </div>\n              <div class=\"nav-card-arrow\"><i class=\"nav-arrow-icon\">→</i></div>\n            </div>\n            <div class=\"nav-card\" onclick=\"window.location.href='/chat'\">\n              <div class=\"nav-card-icon\">\n                <i class=\"bi bi-chat-dots\"></i>\n              </div>\n              <div class=\"nav-card-content\">\n                <div class=\"nav-card-title\">即时沟通</div>\n                <div class=\"nav-card-desc\">团队聊天、文件共享、消息通知</div>\n              </div>\n              <div class=\"nav-card-arrow\"><i class=\"nav-arrow-icon\">→</i></div>\n            </div>\n            <div class=\"nav-card\" onclick=\"window.location.href='/smartdoc'\">\n              <div class=\"nav-card-icon\">\n                <i class=\"bi bi-file-earmark-text\"></i>\n              </div>\n              <div class=\"nav-card-content\">\n                <div class=\"nav-card-title\">智能文档</div>\n                <div class=\"nav-card-desc\">内容创作、智能问答、文档共享</div>\n              </div>\n              <div class=\"nav-card-arrow\"><i class=\"nav-arrow-icon\">→</i></div>\n            </div>\n            <div class=\"nav-card\" onclick=\"window.location.href='/knowledge'\">\n              <div class=\"nav-card-icon\">\n                <i class=\"bi bi-book\"></i>\n              </div>\n              <div class=\"nav-card-content\">\n                <div class=\"nav-card-title\">知识库</div>\n                <div class=\"nav-card-desc\">团队知识共享、检索、存储平台</div>\n              </div>\n              <div class=\"nav-card-arrow\"><i class=\"nav-arrow-icon\">→</i></div>\n            </div>\n            <div class=\"nav-card\" onclick=\"window.location.href='/contract'\">\n              <div class=\"nav-card-icon\">\n                <i class=\"bi bi-file-earmark-ruled\"></i>\n              </div>\n              <div class=\"nav-card-content\">\n                <div class=\"nav-card-title\">智能合同</div>\n                <div class=\"nav-card-desc\">合同模板、AI审查、智能生成</div>\n              </div>\n              <div class=\"nav-card-arrow\"><i class=\"nav-arrow-icon\">→</i></div>\n            </div>\n          </div>\n        </div>`, \n        rawContent: '您好，我是您的AI助手，有什么可以帮您？',\n        type: 'text' \n      }\n    ])\n    const chatBody = ref(null)\n    const fileInput = ref(null)\n    const selectedFiles = ref([])\n    const loading = ref(false)\n    const processingFiles = computed(() => {\n      return selectedFiles.value.some(file => file.status !== 'completed' && file.status !== 'failed');\n    })\n    const chatId = ref(null) // 存储当前聊天ID，用于维持对话上下文\n    const showContextBar = computed(() => chatId.value !== null)\n    const searchMethod = ref('basic') // 新增：搜索方法, 默认为basic\n    const chatMode = ref('agent') // agent 或 knowledge_base\n    const retrievalScope = ref('local') // 'local' 或 'basic'\n    \n    // 添加变量来存储当前请求的控制器\n    const currentRequestController = ref(null);\n    \n    // 右侧面板相关状态\n    const rightPanelCollapsed = ref(false);\n    const chatSessions = ref([]);\n    \n    // 编辑对话框相关状态\n    const editEventDialogVisible = ref(false);\n    const editingEvent = ref(null);\n    const currentEditingMessage = ref(null);\n    \n    // 获取 emitter 实例\n    const emitter = proxy.emitter;\n    \n    // 获取聊天会话列表\n    const fetchChatSessions = async () => {\n      try {\n        const res = await getAIChatSessions();\n        if (res.data && Array.isArray(res.data)) {\n          chatSessions.value = res.data;\n        } else if (res.data && res.data.results && Array.isArray(res.data.results)) {\n          chatSessions.value = res.data.results;\n        }\n        return chatSessions.value;\n      } catch (error) {\n        console.error('获取聊天会话列表失败:', error);\n        chatSessions.value = [];\n        return [];\n      }\n    };\n    \n    // 切换聊天会话\n    const switchChatSession = async (sessionId) => {\n      if (sessionId === chatId.value) return;\n      \n      try {\n        loading.value = true;\n        const res = await getAIChatSession(sessionId);\n        if (res.data) {\n          chatId.value = sessionId;\n          // 加载聊天历史\n          if (res.data.messages && Array.isArray(res.data.messages)) {\n            messages.value = res.data.messages.map(msg => {\n              return {\n                role: msg.role,\n                content: msg.content,\n                rawContent: msg.content,\n                type: msg.type || 'text',\n                source: msg.role === 'user' ? '' : (msg.source || (msg.role === 'assistant' ? 'general_ai' : '')) // 确保用户消息没有source属性\n              }\n            });\n          }\n        }\n      } catch (error) {\n        console.error('获取聊天会话详情失败:', error);\n        ElMessage.error('切换聊天会话失败');\n        \n        // 如果切换失败，检查当前会话列表中是否还有这个会话\n        const sessionExists = chatSessions.value.some(session => session.id === sessionId);\n        if (!sessionExists) {\n          // 如果会话已不存在，尝试切换到第一个可用会话或创建新会话\n          if (chatSessions.value.length > 0) {\n            await switchChatSession(chatSessions.value[0].id);\n          } else {\n            clearChat();\n          }\n        }\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 监听聊天ID变化，更新会话列表\n    watch(chatId, (newChatId) => {\n      if (newChatId) {\n        fetchChatSessions();\n      }\n    });\n\n    // 获取用户信息\n    const getUserInfo = async () => {\n      try {\n        const res = await request({\n          url: '/api/auth/users/me/',\n          method: 'get'\n        })\n        console.log('用户信息完整响应:', res)\n\n        // 尝试从响应的不同位置获取头像URL\n        let avatarUrl = null\n        if (res.data && res.data.data && res.data.data.avatar) {\n          avatarUrl = res.data.data.avatar\n        } else if (res.data && res.data.avatar) {\n          avatarUrl = res.data.avatar\n        } else if (res.data) {\n          // 遍历res.data查找avatar字段\n          const findAvatar = (obj) => {\n            if (!obj || typeof obj !== 'object') return null\n            \n            if ('avatar' in obj) return obj.avatar\n            \n            // 递归搜索所有子对象\n            for (const key in obj) {\n              if (typeof obj[key] === 'object') {\n                const result = findAvatar(obj[key])\n                if (result) return result\n              }\n            }\n            return null\n          }\n          \n          avatarUrl = findAvatar(res.data)\n        }\n\n        console.log('找到的头像URL:', avatarUrl)\n        \n        if (avatarUrl) {\n          // 如果是相对路径，添加基础URL\n          if (!avatarUrl.startsWith('http') && !avatarUrl.startsWith('data:')) {\n            // 确保媒体URL正确拼接\n            const baseUrl = window.location.origin\n            if (avatarUrl.startsWith('/')) {\n              userAvatarUrl.value = `${baseUrl}${avatarUrl}`\n            } else {\n              userAvatarUrl.value = `${baseUrl}/${avatarUrl}`\n            }\n          } else {\n            userAvatarUrl.value = avatarUrl\n          }\n          console.log('处理后的用户头像URL:', userAvatarUrl.value)\n        } else {\n          console.log('用户信息中没有找到头像:', res.data)\n        }\n      } catch (error) {\n        console.error('获取用户信息失败:', error)\n      }\n    }\n    \n    const scrollToBottom = () => {\n      nextTick(() => {\n        if (chatBody.value) chatBody.value.scrollTop = chatBody.value.scrollHeight\n      })\n    }\n    \n    const uploadFileAndGetId = async (file) => {\n      const formData = new FormData()\n      formData.append('file', file.rawFile)\n      try {\n        // 标记文件为上传中\n        file.progress = 0;\n        file.status = 'pending';\n        let smoothTimer = null;\n        let lastProgress = 0;\n        let uploadFinished = false;\n        const res = await request({\n          url: '/api/ai/documents/upload/',\n          method: 'post',\n          data: formData,\n          onUploadProgress: (progressEvent) => {\n            const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total);\n            if (percentCompleted < 100) {\n              file.progress = percentCompleted;\n              lastProgress = percentCompleted;\n            } else {\n              // 上传瞬间完成，平滑递增到95%\n              if (!uploadFinished) {\n                uploadFinished = true;\n                let fakeProgress = lastProgress;\n                smoothTimer = setInterval(() => {\n                  fakeProgress += 3;\n                  if (fakeProgress >= 95) {\n                    fakeProgress = 95;\n                    clearInterval(smoothTimer);\n                  }\n                  file.progress = fakeProgress;\n                }, 20);\n              }\n            }\n          }\n        })\n        // 上传完成后，状态改为处理中，不重置进度条\n        if (smoothTimer) clearInterval(smoothTimer);\n        if (file.progress < 95) file.progress = 95;\n        file.status = 'processing';\n        file.documentId = res.data.id;\n        pollDocumentStatus(file);\n        return res.data.id;\n      } catch (error) {\n        file.status = 'failed';\n        console.error('文件上传失败:', error);\n        throw new Error(`上传文件 ${file.name} 失败: ${error.message || '服务器错误'}`);\n      }\n    }\n    \n    // 轮询文档处理状态\n    const pollDocumentStatus = async (file, interval = 1000) => {\n      if (!file.documentId) return;\n      \n      try {\n        const res = await request({\n          url: `/api/ai/documents/${file.documentId}/`,\n          method: 'get'\n        });\n        \n        if (res.data.status === 'completed') {\n          file.progress = 100;\n          file.status = 'completed';\n          return;\n        } else if (res.data.status === 'failed') {\n          file.status = 'failed';\n          file.progress = 0;\n          return;\n        } else if (res.data.status === 'processing') {\n          // 处理中，增加进度（仅在小于95时递增）\n          if (file.progress < 95) {\n            file.progress = Math.min(file.progress + 5, 95);\n          }\n        }\n        \n        // 继续轮询\n        setTimeout(() => pollDocumentStatus(file, interval), interval);\n      } catch (e) {\n        // 出错时，继续轮询，但不更新进度\n        setTimeout(() => pollDocumentStatus(file, interval), interval);\n      }\n    }\n    \n    const clearChat = () => {\n      // 清空对话历史，开始新的对话\n      chatId.value = null;\n      \n      // 重置消息列表，只保留欢迎消息\n      messages.value = [\n        { \n          role: 'assistant', \n          content: `<div class=\"welcome-message\">\n            <h3>欢迎来到智行舟平台</h3>\n            <div class=\"platform-intro\">\n              <p>智行舟平台是您的智能协作中心，融合了项目管理、即时通讯、智能文档和AI助手。我们致力于通过前沿AI技术赋能您的团队，优化业务流程，为您打造无缝连接的未来办公新范式，核心优势如下：</p>\n              \n              <ul class=\"platform-features\">\n                <li><span class=\"feature-highlight\">AI智能引擎</span> - 我们的AI助手能够理解自然语言，处理复杂文档，自动创建日程，成为您24小时的智能工作伙伴。</li>\n                <li><span class=\"feature-highlight\">一体化协作</span> - 无缝整合项目、日程与沟通工具，打破信息孤岛，让团队协作如行云流水般顺畅，显著提升效率。</li>\n                <li><span class=\"feature-highlight\">智慧文档处理</span> - 从智能合同生成到知识库管理，自动化处理繁杂的文档工作流，让您的团队聚焦于核心创新。</li>\n                <li><span class=\"feature-highlight\">安全可靠保障</span> - 采用企业级数据加密与精细化权限管理，全方位守护您的核心数据资产安全。</li>\n              </ul>\n              \n              <p>借助智行舟平台，您的企业将迈入更敏捷、高效、智能的协作新纪元，激发团队潜力，提升整体竞争力。</p>\n            </div>\n            <p>选择以下功能模块，或直接向我提问，我将为您提供智能助手服务。</p>\n            <div class=\"quick-nav-cards\">\n              <div class=\"nav-card\" onclick=\"window.location.href='/project'\">\n                <div class=\"nav-card-icon\">\n                  <i class=\"bi bi-kanban\"></i>\n                </div>\n                <div class=\"nav-card-content\">\n                  <div class=\"nav-card-title\">项目协作</div>\n                  <div class=\"nav-card-desc\">任务分配、进度跟踪、团队协作</div>\n                </div>\n                <div class=\"nav-card-arrow\"><i class=\"nav-arrow-icon\">→</i></div>\n              </div>\n              <div class=\"nav-card\" onclick=\"window.location.href='/calendar'\">\n                <div class=\"nav-card-icon\">\n                  <i class=\"bi bi-calendar-week\"></i>\n                </div>\n                <div class=\"nav-card-content\">\n                  <div class=\"nav-card-title\">日程安排</div>\n                  <div class=\"nav-card-desc\">会议预约、日程提醒、时间管理</div>\n                </div>\n                <div class=\"nav-card-arrow\"><i class=\"nav-arrow-icon\">→</i></div>\n              </div>\n              <div class=\"nav-card\" onclick=\"window.location.href='/chat'\">\n                <div class=\"nav-card-icon\">\n                  <i class=\"bi bi-chat-dots\"></i>\n                </div>\n                <div class=\"nav-card-content\">\n                  <div class=\"nav-card-title\">即时沟通</div>\n                  <div class=\"nav-card-desc\">团队聊天、文件共享、消息通知</div>\n                </div>\n                <div class=\"nav-card-arrow\"><i class=\"nav-arrow-icon\">→</i></div>\n              </div>\n              <div class=\"nav-card\" onclick=\"window.location.href='/smartdoc'\">\n                <div class=\"nav-card-icon\">\n                  <i class=\"bi bi-file-earmark-text\"></i>\n                </div>\n                <div class=\"nav-card-content\">\n                  <div class=\"nav-card-title\">AI文档</div>\n                  <div class=\"nav-card-desc\">文档摘要、智能问答、内容创作</div>\n                </div>\n                <div class=\"nav-card-arrow\"><i class=\"nav-arrow-icon\">→</i></div>\n              </div>\n              <div class=\"nav-card\" onclick=\"window.location.href='/knowledge'\">\n                <div class=\"nav-card-icon\">\n                  <i class=\"bi bi-book\"></i>\n                </div>\n                <div class=\"nav-card-content\">\n                  <div class=\"nav-card-title\">知识库</div>\n                  <div class=\"nav-card-desc\">团队知识共享、检索、存储平台</div>\n                </div>\n                <div class=\"nav-card-arrow\"><i class=\"nav-arrow-icon\">→</i></div>\n              </div>\n              <div class=\"nav-card\" onclick=\"window.location.href='/contract'\">\n                <div class=\"nav-card-icon\">\n                  <i class=\"bi bi-file-earmark-ruled\"></i>\n                </div>\n                <div class=\"nav-card-content\">\n                  <div class=\"nav-card-title\">智能合同</div>\n                  <div class=\"nav-card-desc\">合同模板、AI审查、智能生成</div>\n                </div>\n                <div class=\"nav-card-arrow\"><i class=\"nav-arrow-icon\">→</i></div>\n              </div>\n            </div>\n          </div>`, \n          rawContent: '您好，我是您的AI助手，有什么可以帮您？',\n          type: 'text' \n        }\n      ];\n      \n      // 清空选择的文件\n      selectedFiles.value = [];\n      \n      // 清空输入框\n      input.value = '';\n      \n      // 如果有正在进行的请求，取消它\n      if (currentRequestController.value) {\n        currentRequestController.value.abort();\n        currentRequestController.value = null;\n      }\n      \n      // 重置加载状态\n      loading.value = false;\n      \n      // 滚动到顶部\n      nextTick(() => {\n        if (chatBody.value) {\n          chatBody.value.scrollTop = 0;\n        }\n      });\n      \n      // 刷新历史记录列表\n      fetchChatSessions();\n    }\n    \n    const processBuffer = (data) => {\n        let lastMessage = messages.value[messages.value.length - 1];\n        if (!lastMessage || lastMessage.role !== 'assistant') {\n            lastMessage = { \n                role: 'assistant', \n                content: '', \n                rawContent: '', \n                type: 'text', \n                streaming: true,\n                source: chatMode.value === 'knowledge_base' ? 'knowledge_base' : 'general_ai' // 根据当前模式设置默认source\n            };\n            messages.value.push(lastMessage);\n        }\n\n        if (data.type === 'processing_start') {\n            lastMessage.type = 'text';\n            lastMessage.content = data.content;\n            lastMessage.rawContent = data.content;\n            lastMessage.streaming = true;\n        } else if (data.type === 'text_chunk') {\n            lastMessage.type = 'text';\n            lastMessage.streaming = true;\n            if (!lastMessage.rawContent || lastMessage.rawContent === \"正在为您处理日程...\") {\n              lastMessage.rawContent = '';\n            }\n            // 在将内容添加到rawContent之前进行过滤\n            const filteredContent = data.content.replace(/\\[Data: Sources \\(\\d+\\)\\]\\.?/g, '');\n            lastMessage.rawContent += filteredContent;\n            // 流式传输时，实时进行markdown转换\n            lastMessage.content = marked.parse(lastMessage.rawContent);\n        } else if (data.type === 'final_card') {\n            // 仅当是日程相关且有event_id时才显示为卡片\n            if (data.event_id && data.is_schedule === true) {\n                lastMessage.type = 'card';\n                lastMessage.streaming = false;\n                lastMessage.content = marked.parse(data.content || '');\n                lastMessage.status = data.status || 'clarification';\n                lastMessage.event_id = data.event_id || null;\n                \n                // 如果是成功创建日程，触发日历刷新\n                if (data.status === 'success') {\n                    emitter.emit('refreshCalendar');\n                }\n            } else {\n                // 非日程相关或无event_id时以文本形式展示\n                lastMessage.type = 'text';\n                lastMessage.streaming = false;\n                lastMessage.rawContent = data.content || '';\n                lastMessage.content = marked.parse(lastMessage.rawContent);\n            }\n        } else if (data.type === 'error') {\n            // 如果是日程相关错误且明确指定了is_schedule，才显示为卡片\n            if (data.is_schedule === true) {\n                lastMessage.type = 'card';\n                lastMessage.streaming = false;\n                lastMessage.content = data.content || '发生未知错误。';\n                lastMessage.status = 'error';\n            } else {\n                // 非日程错误以文本形式展示\n                lastMessage.type = 'text';\n                lastMessage.streaming = false;\n                lastMessage.rawContent = data.content || '发生未知错误。';\n                lastMessage.content = marked.parse(lastMessage.rawContent);\n            }\n        } else if (data.type === 'update_card') {\n            // 仅更新日程卡片\n            if (data.is_schedule === true && data.event_id) {\n                // 处理卡片更新\n                const targetCard = messages.value.find(msg => \n                    msg.type === 'card' && msg.event_id === data.event_id\n                );\n                \n                if (targetCard) {\n                    targetCard.content = marked.parse(data.content || '');\n                    targetCard.status = data.status || targetCard.status;\n                }\n            }\n        } else if (data.type === 'session_id') {\n            // 处理会话ID消息，更新当前聊天ID\n            if (data.chat_id && !chatId.value) {\n                chatId.value = data.chat_id;\n                fetchChatSessions(); // 创建新会话后刷新列表\n            }\n        }\n        scrollToBottom();\n    };\n\n    const sendMsg = async () => {\n      if (!input.value.trim() && selectedFiles.value.length === 0) {\n        ElMessage.warning('请输入内容或上传文件');\n        return;\n      }\n      \n      if (processingFiles.value) {\n        ElMessage.warning('文件正在处理中，请稍候再试');\n        return;\n      }\n      \n      if (currentRequestController.value) {\n        currentRequestController.value.abort();\n      }\n      \n      const userMsg = { role: 'user', content: input.value, type: 'text' };\n      messages.value.push(userMsg);\n      \n      if (selectedFiles.value.length > 0) {\n        messages.value.push({\n          role: 'user',\n          content: `上传了${selectedFiles.value.length}个文件`,\n          type: 'file',\n          files: selectedFiles.value.map(f => ({ name: f.name, size: f.size, ext: f.ext }))\n        });\n      }\n      \n      const assistantMsg = { role: 'assistant', content: '', type: 'text', streaming: true, source: chatMode.value === 'knowledge_base' ? 'knowledge_base' : 'general_ai' };\n      messages.value.push(assistantMsg);\n      \n      const currentInput = input.value;\n      input.value = '';\n      \n      const currentDocumentIds = selectedFiles.value.map(f => f.documentId).filter(Boolean);\n      selectedFiles.value = [];\n      \n      scrollToBottom();\n      loading.value = true;\n      \n      // 获取用户的AI个性化设置\n      let aiSettings = null;\n      try {\n        const aiSettingsResponse = await request({\n          url: '/api/settings/ai-settings',\n          method: 'get'\n        });\n        \n        if (aiSettingsResponse && aiSettingsResponse.success) {\n          aiSettings = aiSettingsResponse.data;\n        }\n      } catch (error) {\n        console.error('获取AI个性化设置失败:', error);\n        // 即使获取失败也继续聊天\n      }\n      \n      const requestData = {\n        message: currentInput,\n        chat_id: chatId.value,\n        document_ids: currentDocumentIds,\n        chatMode: chatMode.value,\n        method: searchMethod.value // For knowledge base\n      };\n\n      // 添加AI个性化设置\n      if (aiSettings) {\n        requestData.ai_settings = aiSettings;\n      }\n\n      // 统一使用流式请求处理所有模式\n      currentRequestController.value = aiChatWithDocumentsStream(\n        requestData,\n        // onChunk callback\n        (payload, newChatId) => {\n          if (newChatId && !chatId.value) {\n            chatId.value = newChatId;\n          }\n          processBuffer(payload);\n        },\n        // onComplete callback\n        (newChatId) => {\n          const lastMsg = messages.value[messages.value.length - 1];\n          if (lastMsg && lastMsg.role === 'assistant') {\n            lastMsg.streaming = false;\n          }\n          if (newChatId && !chatId.value) {\n            chatId.value = newChatId;\n            fetchChatSessions(); // 创建新会话后刷新列表\n          }\n          loading.value = false;\n          currentRequestController.value = null;\n        },\n        // onError callback\n        (error) => {\n          console.error('流式请求出错:', error);\n          const lastMsg = messages.value[messages.value.length - 1];\n          if (lastMsg && lastMsg.role === 'assistant') {\n            lastMsg.content = '抱歉，响应生成过程中出现错误，请稍后重试。';\n            lastMsg.streaming = false;\n          }\n          loading.value = false;\n          currentRequestController.value = null;\n          ElMessage.error('请求出错: ' + (error.message || '未知错误'));\n        }\n      );\n    }\n    \n    const triggerFileInput = () => {\n      if (fileInput.value) fileInput.value.value = '';\n      fileInput.value && fileInput.value.click()\n    }\n    \n    const handleFileUpload = (e) => {\n      const files = e.target.files\n      if (!files || !files.length) return\n      \n      // 支持的文件类型配置\n      const allowedTypes = {\n        // 文档类型\n        'text/plain': 'txt',                          // txt文件\n        'application/pdf': 'pdf',                     // pdf文件\n        'application/msword': 'doc',                  // doc文件\n        'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'docx', // docx文件\n        'text/markdown': 'md',                        // markdown文件\n        'text/x-markdown': 'md',                      // markdown文件变体\n        \n        // 表格类型\n        'text/csv': 'csv',                            // csv文件\n        'application/csv': 'csv',                     // csv文件另一种MIME\n        'application/vnd.ms-excel': 'xls',            // xls文件\n        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'xlsx', // xlsx文件\n        \n        // 图片类型\n        'image/jpeg': 'jpg',                          // jpg/jpeg图片\n        'image/png': 'png',                           // png图片\n        'image/gif': 'gif',                           // gif图片\n        'image/bmp': 'bmp',                           // bmp图片\n        'image/webp': 'webp',                         // webp图片\n        'image/svg+xml': 'svg',                       // svg矢量图\n        'image/tiff': 'tiff'                          // tiff图片\n      };\n      \n      // 显示支持的文件格式提示\n      const supportedFormats = '支持的文件格式: txt, pdf, doc, docx, md, xls, xlsx, csv 和常见图片格式';\n      \n      // 检查每个文件\n      const validFiles = [];\n      let hasInvalidFile = false;\n      \n      // 有效的文件扩展名列表（不区分大小写）\n      const validExtensions = ['txt', 'pdf', 'doc', 'docx', 'md', 'xls', 'xlsx', 'csv', \n                              'jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'svg', 'tiff'];\n      \n      Array.from(files).forEach(file => {\n        const ext = getExt(file.name).toLowerCase();\n        const isValidExtension = validExtensions.includes(ext);\n        \n        // 检查MIME类型或扩展名是否有效\n        if (allowedTypes[file.type] || isValidExtension) {\n          const id = file.name + '_' + file.size + '_' + Date.now() + Math.random()\n          if (file.type.startsWith('image/')) {\n            const reader = new FileReader()\n            reader.onload = (ev) => {\n              selectedFiles.value.push({\n                id,\n                name: file.name,\n                type: file.type,\n                url: ev.target.result,\n                size: formatSize(file.size),\n                ext,\n                label: getFileLabel(file.type, ext),\n                bg: getFileBg(ext),\n                rawFile: file,\n                progress: 0,\n                status: 'ready'\n              })\n              // 自动上传\n              uploadFileAndGetId(selectedFiles.value[selectedFiles.value.length - 1])\n            }\n            reader.readAsDataURL(file)\n          } else {\n            selectedFiles.value.push({\n              id,\n              name: file.name,\n              type: file.type,\n              url: URL.createObjectURL(file),\n              size: formatSize(file.size),\n              ext,\n              label: getFileLabel(file.type, ext),\n              bg: getFileBg(ext),\n              rawFile: file, // 直接使用原始file对象\n              progress: 0,\n              status: 'ready'\n            })\n            // 自动上传\n            uploadFileAndGetId(selectedFiles.value[selectedFiles.value.length - 1])\n          }\n          validFiles.push(selectedFiles.value[selectedFiles.value.length - 1])\n        } else {\n          hasInvalidFile = true;\n          ElMessage.error(`不支持的文件类型: ${file.name}`);\n          console.warn(`文件类型拒绝: ${file.name}, MIME: ${file.type}, 扩展名: ${ext}`);\n        }\n      })\n      \n      // 在有不支持文件类型时显示支持的格式信息\n      if (hasInvalidFile) {\n        ElMessage.info(supportedFormats);\n      }\n      \n      // 如果全部文件都是有效的，显示成功上传提示\n      if (validFiles.length > 0 && validFiles.length === files.length) {\n        ElMessage.success(`已添加${validFiles.length}个文件`);\n      }\n    }\n    \n    const removeFile = (idx) => {\n      selectedFiles.value.splice(idx, 1)\n    }\n\n    // marked配置：表格带边框+代码块美化+复制按钮\n    const renderer = new marked.Renderer();\n    renderer.table = function(header, body) {\n      return `<table class=\"openwebui-md-table\"><thead>${header}</thead><tbody>${body}</tbody></table>`;\n    };\n    renderer.code = function(code, infostring, escaped) {\n      const codeId = 'code-' + Math.random().toString(36).substr(2, 9);\n      let lang = (infostring || '').split(/\\s+/)[0];\n      let langLabel = lang ? lang : 'code';\n      let langClass = lang ? `language-${lang}` : '';\n      return `\n        <div class=\"openwebui-md-code-block-beauty\">\n          <div class=\"openwebui-md-code-toolbar\">\n            <span class=\"openwebui-md-code-lang\">${langLabel}</span>\n            <button class=\"openwebui-copy-btn\" data-clipboard-target=\"#${codeId}\" title=\"复制代码\">复制</button>\n          </div>\n          <pre class=\"openwebui-md-pre\"><code id=\"${codeId}\" class=\"${langClass}\">${escaped ? code : escapeHtml(code)}</code></pre>\n        </div>\n      `;\n    };\n    \n    // 新增：自定义扩展，禁用删除线功能\n    const disableStrikethrough = {\n      walkTokens(token) {\n        if (token.type === 'del') {\n          // 将删除线（del）类型的token改写为普通文本（text）类型\n          token.type = 'text';\n          token.text = token.raw; // 使用原始文本，保留'~~'\n          delete token.tokens;\n        }\n      },\n    };\n\n    marked.use(disableStrikethrough);\n    \n    marked.setOptions({\n      breaks: true,\n      gfm: true,\n      headerIds: false,\n      mangle: false,\n      renderer\n    })\n\n    // --- 卡片样式辅助函数 (新增) ---\n    const getCardClass = (status) => {\n      switch (status) {\n        case 'success':\n          return 'success-card';\n        case 'error':\n          return 'error-card';\n        case 'clarification':\n          return 'clarification-card';\n        case 'deleted':\n          return 'deleted-card';\n        default:\n          return '';\n      }\n    };\n    const getCardIcon = (status) => {\n      switch (status) {\n        case 'success':\n          return 'CircleCheckFilled';\n        case 'error':\n          return 'CircleCloseFilled';\n        case 'clarification':\n          return 'InfoFilled';\n        case 'deleted':\n          return 'WarningFilled';\n        default:\n          return 'InfoFilled';\n      }\n    };\n    const getCardTitle = (status) => {\n      switch (status) {\n        case 'success':\n          return '日程操作成功';\n        case 'error':\n          return '操作失败';\n        case 'clarification':\n          return '需要确认';\n        case 'deleted':\n          return '日程已删除';\n        default:\n          return '提示信息';\n      }\n    };\n    // ------------------------------------\n    \n    // 导航到其他模块\n    const navigateTo = (path) => {\n      // 获取当前路由路径\n      const currentPath = window.location.pathname;\n      // 如果已经在指定路径，不进行跳转\n      if (currentPath.includes(path)) return;\n      \n      // 在同一tab中导航\n      window.location.href = `/${path}`;\n    }\n\n    // 这个方法在welcome-message中使用\n    const navigateToModule = (path) => {\n      navigateTo(path);\n    }\n\n    // 删除单个聊天会话\n    const deleteSession = async (sessionId) => {\n      try {\n        await ElMessageBox.confirm(\n          '确认要删除这条对话记录吗？',\n          '提示',\n          {\n            confirmButtonText: '确认',\n            cancelButtonText: '取消',\n            type: 'info',\n          }\n        );\n        \n        await deleteAIChatSession(sessionId);\n        \n        // 刷新会话列表\n        await fetchChatSessions();\n        \n        // 无论删除的是不是当前会话，都直接创建新会话\n        clearChat(); // 清空当前会话，创建新对话\n        ElMessage.success('对话已删除，已创建新对话');\n      } catch (error) {\n        if (error !== 'cancel' && error !== 'close') {\n          console.error('删除聊天会话失败:', error);\n          ElMessage.error('删除失败，请稍后重试');\n        }\n      }\n    }\n\n    // 确认清空所有历史记录\n    const confirmClearAllHistory = () => {\n      ElMessageBox.confirm(\n        '确认要清空所有历史记录吗？此操作不可恢复。',\n        '警告',\n        {\n          confirmButtonText: '确认',\n          cancelButtonText: '取消',\n          type: 'warning',\n        }\n      )\n        .then(() => {\n          clearAllHistory();\n        })\n        .catch(() => {\n          // 用户取消，不做任何操作\n        });\n    }\n\n    // 清空所有历史记录\n    const clearAllHistory = async () => {\n      try {\n        // 显示加载状态\n        loading.value = true;\n        \n        for (const session of chatSessions.value) {\n          await deleteAIChatSession(session.id);\n        }\n        \n        // 清空会话列表\n        chatSessions.value = [];\n        \n        // 清空当前会话，创建新对话\n        clearChat();\n        \n        ElMessage.success('所有历史记录已清空，已创建新对话');\n      } catch (error) {\n        console.error('清空历史记录失败:', error);\n        ElMessage.error('操作失败，请稍后重试');\n      } finally {\n        // 关闭加载状态\n        loading.value = false;\n      }\n    }\n\n    onMounted(() => {\n      document.body.addEventListener('click', function(e) {\n        if (e.target.classList && e.target.classList.contains('openwebui-copy-btn')) {\n          const codeId = e.target.getAttribute('data-clipboard-target').replace('#', '');\n          const codeElem = document.getElementById(codeId);\n          if (codeElem) {\n            navigator.clipboard.writeText(codeElem.innerText).then(() => {\n              e.target.innerText = '已复制';\n              setTimeout(() => { e.target.innerText = '复制'; }, 1200);\n            });\n          }\n        }\n      });\n      \n      // 获取用户头像\n      getUserInfo();\n      \n      // 获取聊天会话列表并初始化界面\n      fetchChatSessions().then(() => {\n        // 如果没有历史会话，确保显示新对话界面\n        if (chatSessions.value.length === 0) {\n          clearChat();\n        }\n      });\n      \n      // 添加页面卸载时的清理\n      window.addEventListener('beforeunload', () => {\n        if (currentRequestController.value) {\n          currentRequestController.value.abort();\n        }\n      });\n    });\n\n    // 监控日历刷新事件\n    emitter.on('refreshCalendar', () => {\n      // 假设日历有自己的刷新方法，这里我们调用它\n      // 如果日历组件有ref, 可以是 this.$refs.calendar.fetchEvents();\n      // 或者如果刷新逻辑在当前组件内，直接调用\n      console.log('收到日历刷新事件，正在重新加载数据...');\n      // 示例: findCalendarComponentAndRefresh();\n    });\n\n    // --- 新增：卡片操作函数 ---\n    const editEvent = async (msg) => {\n      if (!msg || !msg.event_id || msg.is_schedule !== true) {\n        ElMessage.error('无效的日程信息，无法编辑');\n        return;\n      }\n      \n      try {\n        // 获取事件详情\n        const response = await getCalendarEvent(msg.event_id);\n        \n        if (!response || !response.data) {\n          ElMessage.error('无法获取日程详情，请稍后重试');\n          return;\n        }\n        \n        // 设置编辑事件数据\n        editingEvent.value = {...response.data};\n        currentEditingMessage.value = msg;\n        \n        // 显示编辑对话框\n        editEventDialogVisible.value = true;\n      } catch (error) {\n        console.error('获取日程详情出错:', error);\n        ElMessage.error('获取日程信息失败: ' + (error.response?.data?.message || error.message || '未知错误'));\n      }\n    };\n\n    // 保存编辑后的事件\n    const saveEditEvent = async () => {\n      if (!editingEvent.value || !currentEditingMessage.value) {\n        ElMessage.error('编辑数据无效');\n        return;\n      }\n      \n      // 简单验证\n      if (!editingEvent.value.title) {\n        ElMessage.warning('请输入日程标题');\n        return;\n      }\n      \n      // 组装更新数据\n      const updateData = {\n        title: editingEvent.value.title,\n        start: editingEvent.value.start,\n        end: editingEvent.value.end,\n        location: editingEvent.value.location || '',\n        description: editingEvent.value.description || '',\n        type: editingEvent.value.type,\n        reminder: editingEvent.value.reminder || 'none'\n      };\n      \n      try {\n        // 调用更新API\n        await updateEvent(editingEvent.value.id, updateData);\n        \n        // 更新消息卡片内容\n        if (currentEditingMessage.value) {\n          const title = editingEvent.value.title;\n          const start = formatISODate(editingEvent.value.start);\n          const end = formatISODate(editingEvent.value.end);\n          const location = editingEvent.value.location;\n          \n          let content = `已成功更新日程：**${title}**\\n\\n`;\n          content += `- **时间**: ${start} - ${end}\\n`;\n          if (location) content += `- **地点**: ${location}\\n`;\n          \n          currentEditingMessage.value.content = marked.parse(content);\n          currentEditingMessage.value.status = 'success';\n        }\n        \n        // 触发日历刷新事件\n        emitter.emit('refreshCalendar');\n        \n        ElMessage.success('日程已成功更新！');\n        \n        // 关闭对话框\n        editEventDialogVisible.value = false;\n      } catch (error) {\n        console.error('更新日程失败:', error);\n        ElMessage.error('更新失败: ' + (error.response?.data?.message || error.message || '未知错误'));\n      }\n    };\n\n    // 从卡片中删除日程\n    const deleteEventFromCard = async (eventId) => {\n      if (!eventId) {\n        ElMessage.error('无法删除：缺少事件ID');\n        return;\n      }\n      \n      try {\n        await ElMessageBox.confirm(\n          '您确定要删除这个日程吗？',\n          '提示',\n          {\n            confirmButtonText: '确认删除',\n            cancelButtonText: '取消',\n            type: 'warning'\n          }\n        );\n        \n        // 调用删除API\n        await deleteCalendarEvent(eventId);\n        \n        // 找到包含这个事件ID的卡片消息\n        const eventMsg = messages.value.find(msg => \n          msg.type === 'card' && msg.event_id === eventId && msg.is_schedule === true\n        );\n        \n        if (eventMsg) {\n          // 获取事件标题\n          const titleMatch = eventMsg.content.match(/\\*\\*([^*]+)\\*\\*/);\n          const eventTitle = titleMatch ? titleMatch[1] : '开会';\n          \n          // 更新卡片显示为已删除，但使用简洁的确认消息\n          eventMsg.status = 'deleted';\n          eventMsg.content = `好的，名为\"${eventTitle}\"的事件已成功删除。`;\n        }\n        \n        // 触发日历刷新事件\n        emitter.emit('refreshCalendar');\n        \n        ElMessage.success('日程已删除');\n      } catch (error) {\n        if (error === 'cancel') return;\n        \n        if (error.response?.status === 404) {\n          ElMessage.error('操作失败：该日程已被删除或不存在。');\n        } else {\n          console.error(\"从卡片删除日程时出错:\", error);\n          ElMessage.error('删除失败：' + (error.response?.data?.message || error.message || '未知错误'));\n        }\n      }\n    };\n    \n    // 更新卡片显示\n    const updateCardDisplay = (msg, title, description) => {\n      // 构建新的卡片内容\n      const eventDate = new Date();\n      const dateStr = `${eventDate.getFullYear()}年${eventDate.getMonth() + 1}月${eventDate.getDate()}日`;\n      let content = `已成功更新日程：**${title}**\\n\\n`;\n      content += `日期：${dateStr}\\n\\n`;\n      if (description) {\n        content += `描述：${description}\\n\\n`;\n      }\n      content += `您可以在日历中查看完整详情。`;\n      \n      // 更新卡片内容\n      msg.content = marked.parse(content);\n      \n      // 确保卡片状态为成功\n      msg.status = 'success';\n      \n      // 强制重新渲染卡片\n      nextTick(() => {\n        const cardElement = document.querySelector(`.openwebui-card-message[data-event-id=\"${msg.event_id}\"]`);\n        if (cardElement) {\n          cardElement.classList.remove('clarification-card', 'error-card', 'deleted-card');\n          cardElement.classList.add('success-card');\n        }\n      });\n    };\n    \n    // 为日期选择器格式化日期 (保留此函数以兼容其他地方的调用)\n    const formatDateForPicker = (date) => {\n      if (!date) return '';\n      \n      try {\n        // 确保使用有效的Date对象\n        let dateObj;\n        if (date instanceof Date) {\n          if (isNaN(date.getTime())) {\n            console.error('无效日期对象', date);\n            dateObj = new Date(); // 使用当前时间作为回退\n          } else {\n            dateObj = date;\n          }\n        } else {\n          // 尝试解析字符串日期\n          dateObj = new Date(date);\n          if (isNaN(dateObj.getTime())) {\n            console.error('无效日期字符串', date);\n            dateObj = new Date(); // 使用当前时间作为回退\n          }\n        }\n      \n        // 使用直接获取年月日时分的方式，不涉及时区转换\n        const year = dateObj.getFullYear();\n        const month = (dateObj.getMonth() + 1).toString().padStart(2, '0');\n        const day = dateObj.getDate().toString().padStart(2, '0');\n        const hours = dateObj.getHours().toString().padStart(2, '0');\n        const minutes = dateObj.getMinutes().toString().padStart(2, '0');\n        \n        const formatted = `${year}-${month}-${day} ${hours}:${minutes}`;\n        return formatted;\n      } catch (error) {\n        console.error('日期格式化错误:', error);\n        // 返回当前时间作为回退选项\n        const now = new Date();\n        return `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;\n      }\n    };\n\n    return {\n      input, \n      messages, \n      sendMsg, \n      chatBody, \n      fileInput,\n      triggerFileInput, \n      handleFileUpload, \n      selectedFiles, \n      removeFile, \n      UploadFilled, \n      Document, \n      Close, \n      Check,\n      loading, \n      processingFiles,\n      clearChat,\n      showContextBar,\n      chatId,\n      userAvatarUrl,\n      handleAvatarError,\n      searchMethod,\n      chatMode,\n      retrievalScope,\n      // 右侧面板相关\n      rightPanelCollapsed,\n      chatSessions,\n      switchChatSession,\n      formatTime,\n      navigateTo,\n      navigateToModule,\n      // 图标组件\n      Calendar, \n      ChatDotRound, \n      Collection, \n      DocumentCopy,\n      Grid,\n      Connection,\n      deleteSession,\n      confirmClearAllHistory,\n      clearAllHistory,\n      getCardClass,\n      getCardIcon,\n      getCardTitle,\n      editEvent,\n      deleteEventFromCard,\n      editEventDialogVisible,\n      editingEvent,\n      saveEditEvent,\n      // 添加这两个函数以解决ESLint警告\n      updateCardDisplay,\n      formatDateForPicker,\n    }\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n.dashboard-container {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n\n.openwebui-chat-root {\n  width: 100%;\n  height: 100%;\n  min-height: 0;\n  min-width: 0;\n  background: var(--bg-color);\n  display: flex;\n  align-items: stretch;\n  justify-content: stretch;\n  margin: 0;\n  padding: 0;\n  overflow: hidden;\n}\n\n.openwebui-chat-window {\n  width: 100%;\n  height: 100%;\n  min-height: 0;\n  background: var(--bg-color);\n  border-radius: 0;\n  box-shadow: none;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  margin: 0;\n}\n\n.openwebui-chat-header {\n  height: 56px;\n  background: var(--bg-color-secondary);\n  display: flex;\n  align-items: center;\n  padding: 0 24px;\n  font-size: 18px;\n  font-weight: 600;\n  border-bottom: 1px solid var(--border-color);\n  flex-shrink: 0;\n  justify-content: space-between;\n  color: var(--text-color);\n}\n\n.header-center-controls {\n  display: flex;\n  gap: 16px;\n  align-items: center;\n}\n\n.openwebui-title {\n  color: var(--primary-color);\n}\n\n.clear-chat-btn {\n  color: var(--text-color-secondary);\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  font-size: 14px;\n  font-weight: normal;\n}\n\n.clear-chat-btn:hover {\n  color: var(--primary-color);\n}\n\n.openwebui-file-preview-bar {\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n  align-items: flex-start;\n  gap: 12px;\n  padding: 12px 0 8px 0;\n  background: transparent;\n  border-bottom: none;\n  overflow-x: auto;\n  min-height: 64px;\n  z-index: 3;\n}\n\n.openwebui-file-card {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  background: var(--bg-color-secondary);\n  border-radius: 14px;\n  box-shadow: 0 2px 8px rgba(var(--primary-color-rgb),0.04);\n  padding: 8px 16px 8px 8px;\n  min-width: 160px;\n  max-width: 240px;\n  position: relative;\n  color: var(--text-color);\n}\n\n.openwebui-file-thumb {\n  width: 40px;\n  height: 40px;\n  border-radius: 8px;\n  background: var(--bg-color-tertiary);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  overflow: hidden;\n  margin-right: 10px;\n}\n\n.openwebui-file-img {\n  width: 40px;\n  height: 40px;\n  object-fit: cover;\n  border-radius: 8px;\n}\n\n.openwebui-file-icon {\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #fff;\n  font-size: 22px;\n}\n\n.openwebui-file-info {\n  flex: 1;\n  min-width: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n\n.openwebui-file-name {\n  font-size: 14px;\n  color: var(--text-color);\n  font-weight: 500;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 120px;\n}\n\n.openwebui-file-meta {\n  font-size: 12px;\n  color: var(--text-color-secondary);\n  margin-top: 2px;\n}\n\n.openwebui-file-progress {\n  margin-top: 4px;\n  width: 100%;\n}\n\n.openwebui-file-status.completed {\n  color: var(--success-color);\n}\n\n.openwebui-file-remove {\n  position: absolute;\n  top: 4px;\n  right: 4px;\n  color: var(--text-color-tertiary);\n  font-size: 16px;\n  cursor: pointer;\n  transition: color 0.2s;\n}\n\n.openwebui-file-remove:hover {\n  color: var(--error-color);\n}\n\n.openwebui-chat-container {\n  display: flex;\n  flex: 1;\n  overflow: hidden;\n  position: relative;\n}\n\n.openwebui-chat-body {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0 16px 12px 16px;\n  background: var(--bg-color);\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n  max-height: calc(100vh - 200px);\n  height: calc(100vh - 200px);\n  flex-shrink: 1;\n  scrollbar-width: thin;\n  width: auto;\n  transition: all 0.3s ease;\n}\n\n.openwebui-msg {\n  display: flex;\n  align-items: flex-end;\n  margin-bottom: 16px;\n  flex-direction: row;\n  justify-content: flex-start;\n}\n\n.openwebui-msg.user {\n  flex-direction: row-reverse;\n  justify-content: flex-end;\n  align-items: flex-end;\n  margin-left: auto;\n  margin-right: 0;\n}\n\n.openwebui-msg.assistant {\n  flex-direction: row;\n  justify-content: flex-start;\n  align-items: flex-end;\n  margin-right: auto;\n  margin-left: 0;\n}\n\n.openwebui-msg-bubble {\n  position: relative;\n  max-width: 90%;\n  padding: 12px 18px;\n  border-radius: 20px;\n  word-wrap: break-word;\n  overflow-wrap: break-word;\n  box-shadow: 0 1px 2px rgba(0,0,0,0.05);\n  line-height: 1.6;\n}\n\n.openwebui-msg.user .openwebui-msg-bubble {\n  background: var(--primary-color);\n  color: #fff;\n  border-bottom-right-radius: 4px;\n  margin-right: 8px;\n  margin-left: auto;\n}\n\n.openwebui-msg.assistant .openwebui-msg-bubble {\n  background: var(--bg-color-secondary);\n  color: var(--text-color);\n  border-bottom-left-radius: 4px;\n  margin-left: 8px;\n  margin-right: auto;\n}\n\n.openwebui-avatar {\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n  margin-bottom: auto;\n}\n\n.left-avatar {\n  margin-right: 8px;\n}\n\n.right-avatar {\n  margin-left: 8px;\n}\n\n.user-avatar-img {\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  object-fit: cover;\n  overflow: hidden;\n  display: block;\n  background-color: #f0f2f5;\n}\n\n.openwebui-user-label {\n  font-weight: bold;\n  margin-right: 4px;\n}\n\n.openwebui-ai-label {\n  font-weight: bold;\n  color: #2f54eb;\n  margin-right: 4px;\n}\n\n.openwebui-chat-footer {\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  padding: 0 16px 12px 16px;\n  background: var(--bg-color);\n  border-top: 1px solid var(--border-color);\n  margin: 0;\n  flex-shrink: 0;\n  box-shadow: 0 -2px 16px 0 rgba(var(--primary-color-rgb),0.03);\n  z-index: 2;\n}\n\n.openwebui-input-area {\n  display: flex;\n  align-items: center;\n  width: 100%;\n}\n\n.openwebui-input {\n  flex: 1;\n  margin-right: 12px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n}\n\n.openwebui-send-btn {\n  min-width: 72px;\n  height: 40px;\n  font-size: 16px;\n  font-weight: 500;\n  border-radius: 8px;\n}\n\n.openwebui-upload-btn {\n  margin-right: 8px;\n  font-size: 20px;\n  background: var(--bg-color-tertiary);\n  border: 1px solid var(--border-color);\n  color: var(--primary-color);\n  cursor: pointer;\n  border-radius: 8px;\n  width: 40px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: border 0.2s, box-shadow 0.2s;\n}\n\n.openwebui-upload-btn:hover {\n  border: 1.5px solid var(--primary-color);\n  box-shadow: 0 2px 8px rgba(var(--primary-color-rgb),0.08);\n}\n\n.openwebui-img-preview {\n  max-width: 180px;\n  max-height: 120px;\n  border-radius: 8px;\n  display: block;\n  margin: 4px 0;\n  box-shadow: 0 2px 8px rgba(47,84,235,0.08);\n}\n\n.openwebui-file-link {\n  color: var(--primary-color);\n  text-decoration: underline;\n  word-break: break-all;\n}\n\n.openwebui-cursor {\n  display: inline-block;\n  width: 8px;\n  height: 16px;\n  background: var(--primary-color);\n  margin-left: 2px;\n  vertical-align: middle;\n  animation: blink 0.8s infinite;\n}\n\n@keyframes blink {\n  0% { opacity: 1; }\n  50% { opacity: 0; }\n  100% { opacity: 1; }\n}\n\n.file-bubble-nest {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n}\n\n.file-bubble-vertical {\n  justify-content: flex-start;\n  align-items: flex-start;\n}\n\n.file-message-card {\n  display: flex;\n  align-items: center;\n  background: var(--bg-color-secondary);\n  border-radius: 12px;\n  padding: 8px 16px;\n  margin-bottom: 0;\n  min-width: 180px;\n  max-width: 320px;\n  box-shadow: 0 2px 8px rgba(var(--primary-color-rgb),0.04);\n  color: var(--text-color);\n}\n\n.file-icon-area {\n  width: 40px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-right: 12px;\n}\n\n.file-icon-img {\n  width: 32px;\n  height: 32px;\n}\n\n.file-info-area {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n\n.file-name {\n  font-size: 15px;\n  font-weight: 500;\n  color: var(--text-color);\n  margin-bottom: 2px;\n  word-break: break-all;\n}\n\n.file-meta {\n  font-size: 12px;\n  color: var(--text-color-secondary);\n}\n\n.file-desc-text {\n  margin-top: 8px;\n  font-size: 15px;\n  color: var(--text-color);\n  background: transparent;\n  border-radius: 8px;\n  padding: 0 2px;\n  display: inline-block;\n  word-break: break-all;\n}\n\n.openwebui-context-bar {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 8px 24px;\n  background-color: var(--bg-color-tertiary);\n  border-bottom: 1px solid var(--border-color);\n  font-size: 14px;\n  color: var(--text-color-secondary);\n}\n\n.context-info {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n\n.context-icon {\n  color: var(--primary-color);\n  font-size: 16px;\n}\n\n.source-tag {\n  font-size: 10px;\n  color: #888;\n  margin-top: 8px;\n  display: inline-flex;\n  align-items: center;\n  padding: 2px 6px;\n  border-radius: 4px;\n  .el-icon {\n    margin-right: 4px;\n  }\n}\n\n.knowledge-base-tag {\n  background-color: #e8f5e9; /* Light green */\n  color: #2e7d32;\n}\n\n.general-ai-tag {\n  background-color: #e3f2fd; /* Light blue */\n  color: #1565c0;\n}\n\n/* 右侧面板样式 */\n.openwebui-right-panel {\n  width: 320px;\n  height: 100%;\n  background: var(--el-bg-color-page);\n  border-left: 1px solid var(--el-border-color);\n  display: flex;\n  flex-direction: column;\n  transition: width 0.3s ease;\n  overflow: hidden;\n}\n\n.openwebui-right-panel.collapsed {\n  width: 50px;\n}\n\n.right-panel-header {\n  padding: 12px 16px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  border-bottom: 1px solid var(--el-border-color);\n  background-color: var(--el-bg-color);\n}\n\n.right-panel-mode-controls {\n  flex: 1;\n  display: flex;\n  justify-content: center;\n  overflow: hidden;\n  transition: opacity 0.3s;\n}\n\n.collapsed .right-panel-mode-controls {\n  opacity: 0;\n  width: 0;\n  pointer-events: none;\n}\n\n.collapse-button {\n  margin-left: 8px;\n  background-color: var(--bg-color);\n  border: 1px solid var(--border-color);\n  color: var(--text-color);\n  transition: all 0.2s ease;\n}\n\n.collapse-button:hover {\n  border-color: var(--primary-color);\n  color: var(--primary-color);\n  transform: scale(1.1);\n  box-shadow: 0 0 8px rgba(var(--primary-color-rgb), 0.2);\n}\n\n.collapsed .collapse-button {\n  margin-left: 0;\n}\n\n.history-container {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0 16px 16px;\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n  background-color: var(--el-bg-color-page);\n}\n\n.history-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 16px;\n  padding: 16px 0 8px;\n  border-bottom: none;\n}\n\n.history-title {\n  font-size: 15px;\n  margin: 0;\n  color: var(--el-text-color-regular);\n  transition: opacity 0.2s;\n  line-height: 1.2;\n  font-weight: 500;\n}\n\n.clear-all-btn {\n  padding: 4px 12px;\n  font-size: 12px;\n  color: var(--el-text-color-secondary);\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  border-radius: 4px;\n}\n\n.clear-all-btn:hover {\n  background-color: var(--el-color-danger-light-9);\n  color: var(--el-color-danger);\n}\n\n.history-list {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  padding: 0 4px;\n}\n\n.history-item {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  border-radius: 18px;\n  background: var(--el-bg-color);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  overflow: hidden;\n  margin-bottom: 8px;\n  border: 1px solid var(--el-border-color-lighter);\n  box-shadow: none;\n}\n\n.history-item:hover {\n  background: var(--el-bg-color-page);\n  border-color: var(--el-border-color);\n  box-shadow: var(--el-box-shadow-light);\n}\n\n.history-item.active {\n  background: var(--el-color-primary);\n  color: white;\n  border-color: var(--el-color-primary);\n}\n\n.history-item-content {\n  display: flex;\n  align-items: center;\n  flex: 1;\n  overflow: hidden;\n  min-width: 0;\n}\n\n.history-item-icon {\n  min-width: 28px;\n  height: 28px;\n  border-radius: 50%;\n  background-color: var(--el-color-primary-light-9);\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: var(--el-color-primary);\n  font-size: 14px;\n}\n\n.history-item.active .history-item-icon {\n  background-color: rgba(255, 255, 255, 0.2);\n  color: white;\n}\n\n.history-item-info {\n  flex: 1;\n  min-width: 0;\n  overflow: hidden;\n}\n\n.history-item-title {\n  font-size: 14.5px;\n  font-weight: 500;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  margin-bottom: 4px;\n  color: var(--el-text-color-primary);\n}\n\n.history-item-time {\n  font-size: 12px;\n  color: var(--el-text-color-secondary);\n}\n\n.history-item.active .history-item-time {\n  color: rgba(255, 255, 255, 0.8);\n}\n\n.history-item-actions {\n  opacity: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 8px;\n}\n\n.delete-btn-wrapper {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  background-color: rgba(245, 108, 108, 0.08);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: all 0.2s ease;\n  cursor: pointer;\n  border: none;\n}\n\n.delete-btn-wrapper:hover {\n  background-color: rgba(245, 108, 108, 0.15);\n}\n\n.delete-icon {\n  font-size: 17px;\n  color: var(--el-color-danger);\n  transition: all 0.2s ease;\n}\n\n.history-empty {\n  text-align: center;\n  padding: 30px 0;\n  color: var(--el-text-color-secondary);\n  font-size: 14px;\n  font-style: normal;\n}\n\n.collapsed .history-item {\n  justify-content: center;\n  padding: 10px 0;\n}\n\n.collapsed .history-item-icon {\n  margin-right: 0;\n}\n\n.collapsed .history-item-info,\n.collapsed .history-item-actions {\n  display: none;\n}\n\n.collapsed .history-title {\n  opacity: 0;\n  height: 0;\n  margin: 0;\n  padding: 0;\n}\n\n.collapsed .history-container {\n  display: none;\n}\n\n.collapsed .right-panel-header {\n  justify-content: center;\n  padding-left: 0;\n  padding-right: 0;\n  border-bottom-color: transparent;\n}\n\n/* 新增卡片消息样式 */\n.openwebui-card-message {\n  display: flex;\n  align-items: flex-start;\n  gap: 12px;\n  padding: 8px; /* 减小内边距，让卡片更紧凑 */\n  width: 100%; /* 确保卡片填满气泡 */\n}\n\n.card-icon-wrapper {\n  font-size: 24px;\n  margin-top: 2px;\n}\n\n.card-content-wrapper {\n  flex: 1;\n  text-align: left;\n}\n\n.card-title {\n  font-weight: bold;\n  font-size: 16px;\n  margin-bottom: 4px;\n}\n\n.card-body {\n  font-size: 14px;\n  line-height: 1.5;\n  // 确保换行符生效\n  white-space: pre-wrap;\n  :deep(p) {\n    margin: 0;\n  }\n}\n\n/* 新增：卡片操作区域样式 */\n.card-actions {\n  margin-top: 12px;\n  padding-top: 10px;\n  border-top: 1px solid var(--border-color);\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n}\n\n/* 根据状态设置不同颜色 */\n.success-card .card-icon-wrapper {\n  color: #67c23a; /* Element Plus 成功色 */\n}\n.success-card .card-title {\n  color: #67c23a;\n}\n.openwebui-msg.assistant .openwebui-msg-bubble .success-card {\n  border-left: 4px solid #67c23a;\n}\n\n.clarification-card .card-icon-wrapper {\n  color: #e6a23c; /* Element Plus 警告色 */\n}\n.clarification-card .card-title {\n  color: #e6a23c;\n}\n.openwebui-msg.assistant .openwebui-msg-bubble .clarification-card {\n  border-left: 4px solid #e6a23c;\n}\n\n.error-card .card-icon-wrapper {\n  color: #f56c6c; /* Element Plus 危险色 */\n}\n.error-card .card-title {\n  color: #f56c6c;\n}\n.openwebui-msg.assistant .openwebui-msg-bubble .error-card {\n  border-left: 4px solid #f56c6c;\n}\n\n.deleted-card .card-icon-wrapper {\n  color: #909399; /* Element Plus 灰色 */\n}\n.deleted-card .card-title {\n  color: #909399;\n}\n.openwebui-msg.assistant .openwebui-msg-bubble .deleted-card {\n  border-left: 4px solid #909399;\n}\n</style>\n\n<style>\n.openwebui-md-table {\n  width: 100%;\n  border-collapse: collapse;\n  margin: 8px 0;\n  background: var(--bg-color-secondary);\n  font-size: 15px;\n}\n.openwebui-md-table th, .openwebui-md-table td {\n  border: 1px solid var(--border-color);\n  padding: 6px 12px;\n  text-align: left;\n  color: var(--text-color);\n  background: var(--bg-color-secondary);\n}\n.openwebui-md-table th {\n  background: var(--bg-color-tertiary);\n  font-weight: 600;\n  color: var(--text-color-secondary);\n}\n/* 代码块美化和复制按钮 */\n.openwebui-md-code-block-beauty {\n  position: relative;\n  background: var(--bg-color-tertiary);\n  border-radius: 12px;\n  margin: 18px 0;\n  box-shadow: 0 4px 16px var(--shadow-color);\n  overflow: hidden;\n  border: 1px solid var(--border-color);\n}\n.openwebui-md-code-toolbar {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  background: var(--bg-color-secondary);\n  border-bottom: 1px solid var(--border-color);\n  height: 36px;\n  padding: 0 14px;\n}\n.openwebui-md-code-lang {\n  font-size: 13px;\n  color: var(--text-color-tertiary);\n  font-family: 'JetBrains Mono', 'Fira Mono', 'Consolas', monospace;\n  user-select: none;\n}\n.openwebui-copy-btn {\n  background: var(--bg-color-tertiary);\n  border: 1px solid var(--border-color);\n  color: var(--primary-color);\n  border-radius: 6px;\n  font-size: 13px;\n  padding: 2px 12px;\n  cursor: pointer;\n  z-index: 2;\n  transition: background 0.2s, border 0.2s, color 0.2s;\n  outline: none;\n  margin-left: 8px;\n}\n.openwebui-copy-btn:hover {\n  background: var(--primary-color);\n  color: #fff;\n  border: 1px solid var(--primary-color);\n}\n.openwebui-md-pre {\n  margin: 0;\n  padding: 16px 18px;\n  background: var(--bg-color-tertiary);\n  border-radius: 0 0 12px 12px;\n  overflow-x: auto;\n  font-family: 'JetBrains Mono', 'Fira Mono', 'Consolas', monospace;\n  font-size: 15px;\n  line-height: 1.7;\n  color: var(--text-color);\n  min-height: 40px;\n}\n@media (max-width: 600px) {\n  .openwebui-md-pre {\n    font-size: 13px;\n    padding: 12px 6px;\n  }\n  .openwebui-md-code-block-beauty {\n    margin: 12px 0;\n  }\n}\n</style>\n\n<style>\n.openwebui-footer-hint {\n  font-size: 12px;\n  color: var(--text-color-secondary);\n  text-align: center;\n  padding-top: 8px;\n  user-select: none;\n  width: 100%;\n}\n</style>\n\n<style>\n.openwebui-upload-tooltip {\n  max-width: 300px !important;\n  background: var(--bg-color-secondary) !important;\n  color: var(--text-color) !important;\n  border: 1px solid var(--primary-color) !important;\n  border-radius: 8px !important;\n  box-shadow: 0 4px 12px rgba(var(--primary-color-rgb), 0.2) !important;\n  padding: 10px 14px !important;\n  font-size: 13px !important;\n  line-height: 1.6 !important;\n  white-space: pre-wrap; /* For newline in content */\n}\n\n.openwebui-upload-tooltip .el-popper__arrow::before {\n  border-color: var(--primary-color) !important;\n  background: var(--bg-color-secondary) !important;\n}\n</style>\n\n<style lang=\"scss\" scoped>\n.openwebui-options-area {\n  display: flex;\n  justify-content: center;\n  padding-top: 8px;\n}\n</style>\n\n<style>\n/* 导航卡片样式 */\n.welcome-message {\n  margin-bottom: 24px;\n  padding: 8px;\n  border-radius: 12px;\n  background-color: var(--el-bg-color);\n}\n\n.welcome-message h3 {\n  margin-bottom: 12px;\n  font-size: 22px;\n  font-weight: 600;\n  color: var(--el-text-color-primary);\n  text-align: center;\n}\n\n.platform-intro {\n  background-color: var(--el-bg-color-page);\n  border-radius: 8px;\n  padding: 12px 16px;\n  margin-bottom: 18px;\n  border-left: 4px solid var(--el-color-primary);\n}\n\n.platform-intro p {\n  margin: 0;\n  color: var(--el-text-color-regular);\n  font-size: 14.5px;\n  line-height: 1.6;\n  text-align: left;\n}\n\n.welcome-message p {\n  margin-bottom: 22px;\n  color: var(--el-text-color-regular);\n  font-size: 15px;\n  text-align: center;\n}\n\n.quick-nav-cards {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 16px;\n  margin-top: 15px;\n}\n\n.nav-card {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  padding: 16px;\n  background-color: var(--el-bg-color-overlay);\n  border-radius: 12px;\n  border: 1px solid var(--el-border-color-lighter);\n  cursor: pointer;\n  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);\n  box-shadow: var(--el-box-shadow-lighter);\n  position: relative;\n  overflow: hidden;\n}\n\n.nav-card:hover {\n  background-color: var(--el-color-primary-light-9);\n  border-color: var(--el-color-primary-light-5);\n  transform: translateY(-3px);\n  box-shadow: var(--el-box-shadow-light);\n}\n\nbody[data-theme=\"dark\"] .nav-card:hover {\n  background-color: var(--el-color-primary-dark-2);\n}\n\n.nav-card:hover .nav-card-arrow {\n  opacity: 1;\n  transform: translateX(0);\n}\n\n.nav-card-icon {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-width: 46px;\n  height: 46px;\n  font-size: 22px;\n  margin-right: 12px;\n  color: #ffffff;\n  background-color: var(--el-color-primary);\n  border-radius: 10px;\n  box-shadow: 0 2px 6px rgba(64, 158, 255, 0.25);\n  transition: all 0.3s ease;\n}\n\n.nav-card:hover .nav-card-icon {\n  transform: scale(1.1);\n}\n\n.nav-card-icon .el-icon,\n.nav-card-icon .bi {\n  font-size: 22px;\n}\n\n.nav-card:nth-child(2) .nav-card-icon {\n  background-color: #67C23A;\n  box-shadow: 0 2px 6px rgba(103, 194, 58, 0.25);\n}\n\n.nav-card:nth-child(3) .nav-card-icon {\n  background-color: #E6A23C;\n  box-shadow: 0 2px 6px rgba(230, 162, 60, 0.25);\n}\n\n.nav-card:nth-child(4) .nav-card-icon {\n  background-color: #F56C6C;\n  box-shadow: 0 2px 6px rgba(245, 108, 108, 0.25);\n}\n\n.nav-card:nth-child(5) .nav-card-icon {\n  background-color: #909399;\n  box-shadow: 0 2px 6px rgba(144, 147, 153, 0.25);\n}\n\n.nav-card:nth-child(6) .nav-card-icon {\n  background-color: #9c27b0;\n  box-shadow: 0 2px 6px rgba(156, 39, 176, 0.25);\n}\n\n.nav-card-content {\n  flex: 1;\n}\n\n.nav-card-title {\n  font-weight: 600;\n  font-size: 15px;\n  margin-bottom: 4px;\n  color: var(--el-text-color-primary);\n}\n\n.nav-card-desc {\n  font-size: 12px;\n  color: var(--el-text-color-secondary);\n  line-height: 1.4;\n}\n\n.nav-card-arrow {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  opacity: 0;\n  transform: translateX(10px);\n  transition: all 0.3s ease;\n  color: var(--el-color-primary);\n  font-weight: bold;\n  font-size: 18px;\n  margin-left: 5px;\n}\n\n.nav-arrow-icon {\n  font-style: normal;\n}\n\n/* 响应式布局 */\n@media (max-width: 768px) {\n  .quick-nav-cards {\n    grid-template-columns: repeat(2, 1fr);\n    gap: 12px;\n  }\n  \n  .nav-card {\n    padding: 12px;\n    flex-direction: column;\n    text-align: center;\n  }\n  \n  .nav-card-icon {\n    margin-right: 0;\n    margin-bottom: 10px;\n    width: 42px;\n    height: 42px;\n  }\n  \n  .nav-card-title {\n    margin-bottom: 4px;\n  }\n  \n  .nav-card-arrow {\n    position: absolute;\n    top: 8px;\n    right: 8px;\n    font-size: 14px;\n  }\n}\n\n@media (max-width: 480px) {\n  .welcome-message h3 {\n    font-size: 18px;\n  }\n  \n  .welcome-message p {\n    font-size: 14px;\n    margin-bottom: 16px;\n  }\n  \n  .quick-nav-cards {\n    grid-template-columns: 1fr;\n    gap: 10px;\n  }\n  \n  .nav-card {\n    flex-direction: row;\n    text-align: left;\n    padding: 12px;\n  }\n  \n  .nav-card-icon {\n    margin-right: 12px;\n    margin-bottom: 0;\n  }\n}\n\n/* 更新平台介绍样式 */\n.platform-intro {\n  background-color: var(--el-bg-color-page);\n  border-radius: 12px;\n  padding: 16px 20px;\n  margin-bottom: 22px;\n  border-left: 4px solid var(--el-color-primary);\n  box-shadow: var(--el-box-shadow-lighter);\n}\n\n.platform-intro p {\n  margin: 0 0 12px;\n  color: var(--el-text-color-regular);\n  font-size: 14.5px;\n  line-height: 1.6;\n}\n\n.platform-intro p:last-child {\n  margin-bottom: 0;\n  font-style: italic;\n  color: #606266;\n}\n\n.platform-features {\n  padding-left: 18px;\n  margin: 12px 0 14px;\n  list-style-type: none;\n}\n\n.platform-features li {\n  position: relative;\n  padding-left: 8px;\n  margin-bottom: 10px;\n  font-size: 14px;\n  color: #454b54;\n  line-height: 1.5;\n}\n\n.platform-features li::before {\n  content: \"•\";\n  position: absolute;\n  left: -12px;\n  color: #409EFF;\n  font-weight: bold;\n}\n\n.feature-highlight {\n  font-weight: 600;\n  color: #303133;\n}\n\n/* 修改一下welcome-message样式 */\n.welcome-message h3 {\n  margin-bottom: 16px;\n  font-size: 22px;\n  font-weight: 600;\n  color: #303133;\n  text-align: center;\n}\n\n.welcome-message > p {\n  margin-bottom: 22px;\n  color: #606266;\n  font-size: 15px;\n  text-align: center;\n}\n</style> \n\n<!-- 添加事件编辑表单样式 -->\n<style>\n.event-edit-dialog .el-message-box__input {\n  padding: 0;\n}\n\n.event-edit-dialog .el-message-box__input input {\n  display: none;\n}\n\n.event-edit-form {\n  padding: 10px 0;\n}\n\n.event-edit-form .form-group {\n  margin-bottom: 15px;\n}\n\n.event-edit-form label {\n  display: block;\n  margin-bottom: 5px;\n  font-weight: 500;\n  color: var(--text-color);\n}\n\n.event-edit-form .form-control {\n  width: 100%;\n  padding: 8px 12px;\n  border: 1px solid var(--border-color);\n  border-radius: 4px;\n  background-color: var(--bg-color);\n  color: var(--text-color);\n  font-size: 14px;\n  transition: border-color 0.2s;\n}\n\n.event-edit-form .form-control:focus {\n  border-color: var(--primary-color);\n  outline: none;\n}\n\n.event-edit-form textarea.form-control {\n  min-height: 80px;\n  resize: vertical;\n}\n\n.event-edit-form select.form-control {\n  appearance: auto;\n  height: 38px;\n  background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E\");\n  background-position: right 0.5rem center;\n  background-repeat: no-repeat;\n  background-size: 1.5em 1.5em;\n  padding-right: 2.5rem;\n  -webkit-print-color-adjust: exact;\n  print-color-adjust: exact;\n}\n\n/* 增加对话框宽度 */\n.event-edit-dialog .el-message-box {\n  width: 400px;\n  max-width: 95vw;\n}\n\n/* 暗色主题适配 */\nbody[data-theme=\"dark\"] .event-edit-form .form-control {\n  background-color: var(--bg-color-secondary);\n  border-color: var(--border-color);\n  color: var(--text-color);\n}\n\nbody[data-theme=\"dark\"] .event-edit-form label {\n  color: var(--text-color-secondary);\n}\n\n/* 修复datetime-local输入框样式 */\n.event-edit-form input[type=\"datetime-local\"] {\n  padding-right: 0.75rem;\n}\n\n/* 确保表单在不同浏览器中正常显示 */\n@supports (-moz-appearance: none) {\n  .event-edit-form select.form-control {\n    padding-right: 2rem;\n    background-image: none;\n  }\n}\n</style>\n\n<style lang=\"scss\" scoped>\n// ... existing code ...\n\n/* 卡片消息样式 */\n.openwebui-card-message {\n  padding: 12px;\n  border-radius: 8px;\n  background-color: var(--bg-color-secondary);\n  display: flex;\n  align-items: flex-start;\n  margin-bottom: 8px;\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);\n  transition: all 0.3s ease;\n}\n\n.openwebui-card-message:hover {\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n}\n\n.card-icon-wrapper {\n  margin-right: 12px;\n  font-size: 20px;\n  padding-top: 2px;\n}\n\n.card-content-wrapper {\n  flex: 1;\n}\n\n.card-title {\n  font-size: 16px;\n  font-weight: 500;\n  margin-bottom: 8px;\n}\n\n.card-body {\n  font-size: 14px;\n  color: var(--text-color);\n  line-height: 1.5;\n}\n\n.card-actions {\n  margin-top: 12px;\n  display: flex;\n  gap: 8px;\n}\n\n/* 根据状态设置不同颜色 */\n.success-card .card-icon-wrapper {\n  color: #67c23a; /* Element Plus 成功色 */\n}\n.success-card .card-title {\n  color: #67c23a;\n}\n.openwebui-msg.assistant .openwebui-msg-bubble .success-card {\n  border-left: 4px solid #67c23a;\n}\n\n.clarification-card .card-icon-wrapper {\n  color: #e6a23c; /* Element Plus 警告色 */\n}\n.clarification-card .card-title {\n  color: #e6a23c;\n}\n.openwebui-msg.assistant .openwebui-msg-bubble .clarification-card {\n  border-left: 4px solid #e6a23c;\n}\n\n.error-card .card-icon-wrapper {\n  color: #f56c6c; /* Element Plus 危险色 */\n}\n.error-card .card-title {\n  color: #f56c6c;\n}\n.openwebui-msg.assistant .openwebui-msg-bubble .error-card {\n  border-left: 4px solid #f56c6c;\n}\n\n.deleted-card .card-icon-wrapper {\n  color: #909399; /* Element Plus 灰色 */\n}\n.deleted-card .card-title {\n  color: #909399;\n}\n.openwebui-msg.assistant .openwebui-msg-bubble .deleted-card {\n  border-left: 4px solid #909399;\n}\n</style>\n\n<!-- 添加事件编辑表单样式 -->\n<style>\n.event-edit-dialog .el-message-box__input {\n  padding: 0;\n}\n\n.event-edit-dialog .el-message-box__input input {\n  display: none;\n}\n\n.event-edit-form {\n  padding: 10px 0;\n}\n\n.event-edit-form .form-group {\n  margin-bottom: 15px;\n}\n\n.event-edit-form label {\n  display: block;\n  margin-bottom: 5px;\n  font-weight: 500;\n  color: var(--text-color);\n}\n\n.event-edit-form .form-control {\n  width: 100%;\n  padding: 8px 12px;\n  border: 1px solid var(--border-color);\n  border-radius: 4px;\n  background-color: var(--bg-color);\n  color: var(--text-color);\n  font-size: 14px;\n  transition: border-color 0.2s;\n}\n\n.event-edit-form .form-control:focus {\n  border-color: var(--primary-color);\n  outline: none;\n}\n\n.event-edit-form textarea.form-control {\n  min-height: 80px;\n  resize: vertical;\n}\n\n.event-edit-form select.form-control {\n  appearance: auto;\n}\n</style>\n\n<style>\n/* 确保 el-dialog 在暗黑模式下样式正确 */\n.calendar-dialog .el-dialog {\n  background-color: var(--bg-color);\n}\n.calendar-dialog .el-dialog__title {\n  color: var(--text-color);\n}\n.calendar-dialog .el-dialog__header {\n  border-bottom: 1px solid var(--border-color);\n}\n.calendar-dialog .el-dialog__body {\n  background-color: var(--bg-color);\n  color: var(--text-color);\n}\n.calendar-dialog .el-dialog__footer {\n  border-top: 1px solid var(--border-color);\n}\n.calendar-dialog .el-form-item__label {\n  color: var(--text-color);\n}\n.calendar-dialog .el-input__wrapper,\n.calendar-dialog .el-textarea__inner {\n  background-color: var(--bg-color-secondary) !important;\n  box-shadow: none !important;\n  border: 1px solid var(--border-color);\n  color: var(--text-color);\n}\n.calendar-dialog .el-input__inner {\n  color: var(--text-color) !important;\n}\n\n/* 移除旧的、不再需要的CSS */\n.event-edit-dialog .el-message-box__input {\n  display: none;\n}\n.event-edit-form {\n  display: none;\n}\n</style>"],"mappings":"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","ignoreList":[]}]}