{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\dashboard\\Index.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\dashboard\\Index.vue","mtime":1748700902983},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746431218000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLXNlYXJjaC1wYXJhbXMuZGVsZXRlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybC1zZWFyY2gtcGFyYW1zLmhhcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwtc2VhcmNoLXBhcmFtcy5zaXplLmpzIjsKaW1wb3J0IHsgcmVmLCBuZXh0VGljayB9IGZyb20gJ3Z1ZSc7CmltcG9ydCB7IFVwbG9hZEZpbGxlZCwgRG9jdW1lbnQsIENsb3NlIH0gZnJvbSAnQGVsZW1lbnQtcGx1cy9pY29ucy12dWUnOwppbXBvcnQgeyBhaUNoYXQgfSBmcm9tICdAL2FwaS9haSc7CmltcG9ydCByZXF1ZXN0IGZyb20gJ0AvdXRpbHMvcmVxdWVzdCc7CmZ1bmN0aW9uIGZvcm1hdFNpemUoc2l6ZSkgewogIGlmIChzaXplIDwgMTAyNCkgcmV0dXJuIHNpemUgKyAnQic7CiAgaWYgKHNpemUgPCAxMDI0ICogMTAyNCkgcmV0dXJuIChzaXplIC8gMTAyNCkudG9GaXhlZCgxKSArICdLQic7CiAgcmV0dXJuIChzaXplIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMSkgKyAnTUInOwp9CmZ1bmN0aW9uIGdldEV4dChuYW1lKSB7CiAgY29uc3QgYXJyID0gbmFtZS5zcGxpdCgnLicpOwogIHJldHVybiBhcnIubGVuZ3RoID4gMSA/IGFyclthcnIubGVuZ3RoIC0gMV0udG9Mb3dlckNhc2UoKSA6ICcnOwp9CmZ1bmN0aW9uIGdldEZpbGVMYWJlbCh0eXBlLCBleHQpIHsKICBpZiAodHlwZS5zdGFydHNXaXRoKCdpbWFnZS8nKSkgcmV0dXJuICdJbWFnZSc7CiAgaWYgKGV4dCA9PT0gJ3BkZicpIHJldHVybiAnUERGJzsKICBpZiAoWydjc3YnLCAneGxzJywgJ3hsc3gnXS5pbmNsdWRlcyhleHQpKSByZXR1cm4gJ0NTVic7CiAgcmV0dXJuIGV4dC50b1VwcGVyQ2FzZSgpOwp9CmZ1bmN0aW9uIGdldEZpbGVCZyhleHQpIHsKICBpZiAoZXh0ID09PSAncGRmJykgcmV0dXJuICcjZjg3MTcxJzsKICBpZiAoWydjc3YnLCAneGxzJywgJ3hsc3gnXS5pbmNsdWRlcyhleHQpKSByZXR1cm4gJyMzNGQzOTknOwogIHJldHVybiAnI2E1YjRmYyc7Cn0KZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdEYXNoYm9hcmQnLAogIGNvbXBvbmVudHM6IHsKICAgIFVwbG9hZEZpbGxlZCwKICAgIERvY3VtZW50LAogICAgQ2xvc2UKICB9LAogIHNldHVwKCkgewogICAgY29uc3QgaW5wdXQgPSByZWYoJycpOwogICAgY29uc3QgbWVzc2FnZXMgPSByZWYoW3sKICAgICAgcm9sZTogJ2Fzc2lzdGFudCcsCiAgICAgIGNvbnRlbnQ6ICfmgqjlpb3vvIzmiJHmmK/mgqjnmoRBSeWKqeaJi++8jOacieS7gOS5iOWPr+S7peW4ruaCqO+8nycsCiAgICAgIHR5cGU6ICd0ZXh0JwogICAgfV0pOwogICAgY29uc3QgY2hhdEJvZHkgPSByZWYobnVsbCk7CiAgICBjb25zdCBmaWxlSW5wdXQgPSByZWYobnVsbCk7CiAgICBjb25zdCBzZWxlY3RlZEZpbGVzID0gcmVmKFtdKTsKICAgIGNvbnN0IGxvYWRpbmcgPSByZWYoZmFsc2UpOwogICAgY29uc3QgdXBsb2FkRmlsZUFuZEdldElkID0gYXN5bmMgZmlsZSA9PiB7CiAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGZpbGUucmF3RmlsZSk7CiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QucG9zdCgnL2FwaS9haS9kb2N1bWVudHMvdXBsb2FkLycsIGZvcm1EYXRhKTsKICAgICAgcmV0dXJuIHJlcy5pZDsKICAgIH07CiAgICBjb25zdCBzZW5kTXNnID0gYXN5bmMgKCkgPT4gewogICAgICBpZiAoIWlucHV0LnZhbHVlLnRyaW0oKSAmJiAhc2VsZWN0ZWRGaWxlcy52YWx1ZS5sZW5ndGgpIHJldHVybjsKICAgICAgbG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgIGxldCBkb2N1bWVudElkcyA9IFtdOwogICAgICBpZiAoc2VsZWN0ZWRGaWxlcy52YWx1ZS5sZW5ndGgpIHsKICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2Ygc2VsZWN0ZWRGaWxlcy52YWx1ZSkgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgZG9jSWQgPSBhd2FpdCB1cGxvYWRGaWxlQW5kR2V0SWQoZmlsZSk7CiAgICAgICAgICAgIGlmIChkb2NJZCkgZG9jdW1lbnRJZHMucHVzaChkb2NJZCk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIG1lc3NhZ2VzLnZhbHVlLnB1c2goewogICAgICAgICAgICAgIHJvbGU6ICdhc3Npc3RhbnQnLAogICAgICAgICAgICAgIGNvbnRlbnQ6IGDmlofku7YgJHtmaWxlLm5hbWV9IOS4iuS8oOWksei0pWAsCiAgICAgICAgICAgICAgdHlwZTogJ3RleHQnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoaW5wdXQudmFsdWUudHJpbSgpKSB7CiAgICAgICAgbWVzc2FnZXMudmFsdWUucHVzaCh7CiAgICAgICAgICByb2xlOiAndXNlcicsCiAgICAgICAgICBjb250ZW50OiBpbnB1dC52YWx1ZSwKICAgICAgICAgIHR5cGU6ICd0ZXh0JwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHNlbGVjdGVkRmlsZXMudmFsdWUuZm9yRWFjaChmaWxlID0+IHsKICAgICAgICBpZiAoZmlsZS50eXBlLnN0YXJ0c1dpdGgoJ2ltYWdlLycpKSB7CiAgICAgICAgICBtZXNzYWdlcy52YWx1ZS5wdXNoKHsKICAgICAgICAgICAgcm9sZTogJ3VzZXInLAogICAgICAgICAgICB0eXBlOiAnaW1hZ2UnLAogICAgICAgICAgICB1cmw6IGZpbGUudXJsLAogICAgICAgICAgICBuYW1lOiBmaWxlLm5hbWUKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtZXNzYWdlcy52YWx1ZS5wdXNoKHsKICAgICAgICAgICAgcm9sZTogJ3VzZXInLAogICAgICAgICAgICB0eXBlOiAnZmlsZScsCiAgICAgICAgICAgIHVybDogZmlsZS51cmwsCiAgICAgICAgICAgIG5hbWU6IGZpbGUubmFtZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCBkYXRhID0gewogICAgICAgICAgbWVzc2FnZTogaW5wdXQudmFsdWUsCiAgICAgICAgICBkb2N1bWVudF9pZHM6IGRvY3VtZW50SWRzCiAgICAgICAgfTsKICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBhaUNoYXQoZGF0YSk7CiAgICAgICAgbWVzc2FnZXMudmFsdWUucHVzaCh7CiAgICAgICAgICByb2xlOiAnYXNzaXN0YW50JywKICAgICAgICAgIGNvbnRlbnQ6IHJlcy5tZXNzYWdlLAogICAgICAgICAgdHlwZTogJ3RleHQnCiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBtZXNzYWdlcy52YWx1ZS5wdXNoKHsKICAgICAgICAgIHJvbGU6ICdhc3Npc3RhbnQnLAogICAgICAgICAgY29udGVudDogJ0FJ5pyN5Yqh5pqC5LiN5Y+v55SoJywKICAgICAgICAgIHR5cGU6ICd0ZXh0JwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlucHV0LnZhbHVlID0gJyc7CiAgICAgIHNlbGVjdGVkRmlsZXMudmFsdWUgPSBbXTsKICAgICAgbG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICBuZXh0VGljaygoKSA9PiB7CiAgICAgICAgaWYgKGNoYXRCb2R5LnZhbHVlKSBjaGF0Qm9keS52YWx1ZS5zY3JvbGxUb3AgPSBjaGF0Qm9keS52YWx1ZS5zY3JvbGxIZWlnaHQ7CiAgICAgIH0pOwogICAgfTsKICAgIGNvbnN0IHRyaWdnZXJGaWxlSW5wdXQgPSAoKSA9PiB7CiAgICAgIGlmIChmaWxlSW5wdXQudmFsdWUpIGZpbGVJbnB1dC52YWx1ZS52YWx1ZSA9ICcnOwogICAgICBmaWxlSW5wdXQudmFsdWUgJiYgZmlsZUlucHV0LnZhbHVlLmNsaWNrKCk7CiAgICB9OwogICAgY29uc3QgaGFuZGxlRmlsZVVwbG9hZCA9IGUgPT4gewogICAgICBjb25zdCBmaWxlcyA9IGUudGFyZ2V0LmZpbGVzOwogICAgICBpZiAoIWZpbGVzIHx8ICFmaWxlcy5sZW5ndGgpIHJldHVybjsKICAgICAgQXJyYXkuZnJvbShmaWxlcykuZm9yRWFjaChmaWxlID0+IHsKICAgICAgICBjb25zdCBleHQgPSBnZXRFeHQoZmlsZS5uYW1lKTsKICAgICAgICBjb25zdCBpZCA9IGZpbGUubmFtZSArICdfJyArIGZpbGUuc2l6ZSArICdfJyArIERhdGUubm93KCkgKyBNYXRoLnJhbmRvbSgpOwogICAgICAgIGlmIChmaWxlLnR5cGUuc3RhcnRzV2l0aCgnaW1hZ2UvJykpIHsKICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICByZWFkZXIub25sb2FkID0gZXYgPT4gewogICAgICAgICAgICBzZWxlY3RlZEZpbGVzLnZhbHVlLnB1c2goewogICAgICAgICAgICAgIGlkLAogICAgICAgICAgICAgIG5hbWU6IGZpbGUubmFtZSwKICAgICAgICAgICAgICB0eXBlOiBmaWxlLnR5cGUsCiAgICAgICAgICAgICAgdXJsOiBldi50YXJnZXQucmVzdWx0LAogICAgICAgICAgICAgIHNpemU6IGZvcm1hdFNpemUoZmlsZS5zaXplKSwKICAgICAgICAgICAgICBleHQsCiAgICAgICAgICAgICAgbGFiZWw6IGdldEZpbGVMYWJlbChmaWxlLnR5cGUsIGV4dCksCiAgICAgICAgICAgICAgYmc6IGdldEZpbGVCZyhleHQpLAogICAgICAgICAgICAgIHJhd0ZpbGU6IGZpbGUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9OwogICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSk7CiAgICAgICAgICBzZWxlY3RlZEZpbGVzLnZhbHVlLnB1c2goewogICAgICAgICAgICBpZCwKICAgICAgICAgICAgbmFtZTogZmlsZS5uYW1lLAogICAgICAgICAgICB0eXBlOiBmaWxlLnR5cGUsCiAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgc2l6ZTogZm9ybWF0U2l6ZShmaWxlLnNpemUpLAogICAgICAgICAgICBleHQsCiAgICAgICAgICAgIGxhYmVsOiBnZXRGaWxlTGFiZWwoZmlsZS50eXBlLCBleHQpLAogICAgICAgICAgICBiZzogZ2V0RmlsZUJnKGV4dCksCiAgICAgICAgICAgIHJhd0ZpbGU6IGZpbGUKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwogICAgY29uc3QgcmVtb3ZlRmlsZSA9IGlkeCA9PiB7CiAgICAgIHNlbGVjdGVkRmlsZXMudmFsdWUuc3BsaWNlKGlkeCwgMSk7CiAgICB9OwogICAgcmV0dXJuIHsKICAgICAgaW5wdXQsCiAgICAgIG1lc3NhZ2VzLAogICAgICBzZW5kTXNnLAogICAgICBjaGF0Qm9keSwKICAgICAgZmlsZUlucHV0LAogICAgICB0cmlnZ2VyRmlsZUlucHV0LAogICAgICBoYW5kbGVGaWxlVXBsb2FkLAogICAgICBzZWxlY3RlZEZpbGVzLAogICAgICByZW1vdmVGaWxlLAogICAgICBVcGxvYWRGaWxsZWQsCiAgICAgIERvY3VtZW50LAogICAgICBDbG9zZSwKICAgICAgbG9hZGluZwogICAgfTsKICB9Cn07"},{"version":3,"names":["ref","nextTick","UploadFilled","Document","Close","aiChat","request","formatSize","size","toFixed","getExt","name","arr","split","length","toLowerCase","getFileLabel","type","ext","startsWith","includes","toUpperCase","getFileBg","components","setup","input","messages","role","content","chatBody","fileInput","selectedFiles","loading","uploadFileAndGetId","file","formData","FormData","append","rawFile","res","post","id","sendMsg","value","trim","documentIds","docId","push","e","forEach","url","data","message","document_ids","scrollTop","scrollHeight","triggerFileInput","click","handleFileUpload","files","target","Array","from","Date","now","Math","random","reader","FileReader","onload","ev","result","label","bg","readAsDataURL","URL","createObjectURL","removeFile","idx","splice"],"sources":["C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\dashboard\\Index.vue"],"sourcesContent":["<template>\n  <div class=\"openwebui-chat-root\">\n    <div class=\"openwebui-chat-window\">\n      <div class=\"openwebui-chat-header\">\n        <span class=\"openwebui-title\">Open WebUI AI 对话</span>\n      </div>\n      <div class=\"openwebui-chat-body\" ref=\"chatBody\">\n        <div v-for=\"(msg, idx) in messages\" :key=\"idx\" :class=\"['openwebui-msg', msg.role]\">\n          <template v-if=\"msg.role==='assistant'\">\n            <div class=\"openwebui-avatar ai-avatar\">\n              <svg viewBox=\"0 0 40 40\" width=\"36\" height=\"36\"><circle cx=\"20\" cy=\"20\" r=\"20\" fill=\"#2f54eb\"/><text x=\"50%\" y=\"55%\" text-anchor=\"middle\" fill=\"#fff\" font-size=\"20\" font-family=\"Arial\" dy=\".3em\">🤖</text></svg>\n            </div>\n          </template>\n          <div class=\"openwebui-msg-bubble\">\n            <span v-if=\"msg.role==='user'\" class=\"openwebui-user-label\">我：</span>\n            <span v-if=\"msg.role==='assistant'\" class=\"openwebui-ai-label\">AI：</span>\n            <template v-if=\"msg.type === 'text'\">\n              <span>{{ msg.content }}</span>\n            </template>\n            <template v-else-if=\"msg.type === 'image'\">\n              <img :src=\"msg.url\" class=\"openwebui-img-preview\" />\n            </template>\n            <template v-else-if=\"msg.type === 'file'\">\n              <a :href=\"msg.url\" target=\"_blank\" class=\"openwebui-file-link\">{{ msg.name }}</a>\n            </template>\n          </div>\n          <template v-if=\"msg.role==='user'\">\n            <div class=\"openwebui-avatar user-avatar\">\n              <svg viewBox=\"0 0 40 40\" width=\"36\" height=\"36\"><circle cx=\"20\" cy=\"20\" r=\"20\" fill=\"#bbb\"/><text x=\"50%\" y=\"55%\" text-anchor=\"middle\" fill=\"#fff\" font-size=\"20\" font-family=\"Arial\" dy=\".3em\">🧑</text></svg>\n            </div>\n          </template>\n        </div>\n      </div>\n      <div class=\"openwebui-chat-footer\">\n        <!-- 预览区放在footer顶部 -->\n        <div v-if=\"selectedFiles.length\" class=\"openwebui-file-preview-bar\">\n          <div v-for=\"(file, idx) in selectedFiles\" :key=\"file.id\" class=\"openwebui-file-card\">\n            <div class=\"openwebui-file-thumb\">\n              <img v-if=\"file.type.startsWith('image/')\" :src=\"file.url\" class=\"openwebui-file-img\" />\n              <div v-else class=\"openwebui-file-icon\" :style=\"{background: file.bg}\">\n                <el-icon v-if=\"file.ext==='pdf'\"><Document /></el-icon>\n                <el-icon v-else-if=\"file.ext==='csv' || file.ext==='xls' || file.ext==='xlsx'\"><Document /></el-icon>\n                <el-icon v-else><Document /></el-icon>\n              </div>\n            </div>\n            <div class=\"openwebui-file-info\">\n              <div class=\"openwebui-file-name\" :title=\"file.name\">{{ file.name }}</div>\n              <div class=\"openwebui-file-meta\">{{ file.label }} · {{ file.size }}</div>\n            </div>\n            <el-icon class=\"openwebui-file-remove\" @click=\"removeFile(idx)\"><Close /></el-icon>\n          </div>\n        </div>\n        <!-- 输入区 -->\n        <div class=\"openwebui-input-area\">\n          <input type=\"file\" ref=\"fileInput\" style=\"display:none\" @change=\"handleFileUpload\" multiple />\n          <el-button class=\"openwebui-upload-btn\" @click=\"triggerFileInput\" title=\"上传文件/图片\">\n            <el-icon><UploadFilled /></el-icon>\n          </el-button>\n          <el-input\n            v-model=\"input\"\n            placeholder=\"请输入您的问题...\"\n            @keyup.enter=\"sendMsg\"\n            class=\"openwebui-input\"\n          />\n          <el-button type=\"primary\" @click=\"sendMsg\" class=\"openwebui-send-btn\">发送</el-button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, nextTick } from 'vue'\nimport { UploadFilled, Document, Close } from '@element-plus/icons-vue'\nimport { aiChat } from '@/api/ai'\nimport request from '@/utils/request'\nfunction formatSize(size) {\n  if (size < 1024) return size + 'B';\n  if (size < 1024*1024) return (size/1024).toFixed(1) + 'KB';\n  return (size/1024/1024).toFixed(1) + 'MB';\n}\nfunction getExt(name) {\n  const arr = name.split('.');\n  return arr.length > 1 ? arr[arr.length-1].toLowerCase() : '';\n}\nfunction getFileLabel(type, ext) {\n  if (type.startsWith('image/')) return 'Image';\n  if (ext==='pdf') return 'PDF';\n  if (['csv','xls','xlsx'].includes(ext)) return 'CSV';\n  return ext.toUpperCase();\n}\nfunction getFileBg(ext) {\n  if (ext==='pdf') return '#f87171';\n  if (['csv','xls','xlsx'].includes(ext)) return '#34d399';\n  return '#a5b4fc';\n}\nexport default {\n  name: 'Dashboard',\n  components: { UploadFilled, Document, Close },\n  setup() {\n    const input = ref('')\n    const messages = ref([\n      { role: 'assistant', content: '您好，我是您的AI助手，有什么可以帮您？', type: 'text' }\n    ])\n    const chatBody = ref(null)\n    const fileInput = ref(null)\n    const selectedFiles = ref([])\n    const loading = ref(false)\n    const uploadFileAndGetId = async (file) => {\n      const formData = new FormData()\n      formData.append('file', file.rawFile)\n      const res = await request.post('/api/ai/documents/upload/', formData)\n      return res.id\n    }\n    const sendMsg = async () => {\n      if (!input.value.trim() && !selectedFiles.value.length) return\n      loading.value = true\n      let documentIds = []\n      if (selectedFiles.value.length) {\n        for (const file of selectedFiles.value) {\n          try {\n            const docId = await uploadFileAndGetId(file)\n            if (docId) documentIds.push(docId)\n          } catch (e) {\n            messages.value.push({ role: 'assistant', content: `文件 ${file.name} 上传失败`, type: 'text' })\n          }\n        }\n      }\n      if (input.value.trim()) {\n        messages.value.push({ role: 'user', content: input.value, type: 'text' })\n      }\n      selectedFiles.value.forEach(file => {\n        if (file.type.startsWith('image/')) {\n          messages.value.push({ role: 'user', type: 'image', url: file.url, name: file.name })\n        } else {\n          messages.value.push({ role: 'user', type: 'file', url: file.url, name: file.name })\n        }\n      })\n      try {\n        const data = {\n          message: input.value,\n          document_ids: documentIds\n        }\n        const res = await aiChat(data)\n        messages.value.push({ role: 'assistant', content: res.message, type: 'text' })\n      } catch (e) {\n        messages.value.push({ role: 'assistant', content: 'AI服务暂不可用', type: 'text' })\n      }\n      input.value = ''\n      selectedFiles.value = []\n      loading.value = false\n      nextTick(() => {\n        if (chatBody.value) chatBody.value.scrollTop = chatBody.value.scrollHeight\n      })\n    }\n    const triggerFileInput = () => {\n      if (fileInput.value) fileInput.value.value = '';\n      fileInput.value && fileInput.value.click()\n    }\n    const handleFileUpload = (e) => {\n      const files = e.target.files\n      if (!files || !files.length) return\n      Array.from(files).forEach(file => {\n        const ext = getExt(file.name)\n        const id = file.name + '_' + file.size + '_' + Date.now() + Math.random()\n        if (file.type.startsWith('image/')) {\n          const reader = new FileReader()\n          reader.onload = (ev) => {\n            selectedFiles.value.push({\n              id,\n              name: file.name,\n              type: file.type,\n              url: ev.target.result,\n              size: formatSize(file.size),\n              ext,\n              label: getFileLabel(file.type, ext),\n              bg: getFileBg(ext),\n              rawFile: file\n            })\n          }\n          reader.readAsDataURL(file)\n        } else {\n          const url = URL.createObjectURL(file)\n          selectedFiles.value.push({\n            id,\n            name: file.name,\n            type: file.type,\n            url,\n            size: formatSize(file.size),\n            ext,\n            label: getFileLabel(file.type, ext),\n            bg: getFileBg(ext),\n            rawFile: file\n          })\n        }\n      })\n    }\n    const removeFile = (idx) => {\n      selectedFiles.value.splice(idx, 1)\n    }\n    return { input, messages, sendMsg, chatBody, fileInput, triggerFileInput, handleFileUpload, selectedFiles, removeFile, UploadFilled, Document, Close, loading }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\nhtml, body {\n  width: 100vw;\n  height: 100vh;\n  margin: 0;\n  padding: 0;\n  overflow: hidden;\n}\n.openwebui-chat-root {\n  width: 100%;\n  height: 100%;\n  min-height: 0;\n  min-width: 0;\n  background: #f5f6fa;\n  display: flex;\n  align-items: stretch;\n  justify-content: stretch;\n  margin: 0;\n  padding: 0;\n  overflow: hidden;\n}\n.openwebui-chat-window {\n  width: 100%;\n  height: 100%;\n  min-height: 0;\n  background: #fff;\n  border-radius: 0;\n  box-shadow: none;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  margin: 0;\n}\n.openwebui-chat-header {\n  height: 56px;\n  background: #f0f2f5;\n  display: flex;\n  align-items: center;\n  padding: 0 24px;\n  font-size: 18px;\n  font-weight: 600;\n  border-bottom: 1px solid #ececec;\n  flex-shrink: 0;\n}\n.openwebui-title {\n  color: #2f54eb;\n}\n.openwebui-file-preview-bar {\n  width: 100%;\n  display: flex;\n  flex-direction: row;\n  align-items: flex-start;\n  gap: 12px;\n  padding: 12px 0 8px 0;\n  background: transparent;\n  border-bottom: none;\n  overflow-x: auto;\n  min-height: 64px;\n  z-index: 3;\n}\n.openwebui-file-card {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  background: #f7f8fa;\n  border-radius: 14px;\n  box-shadow: 0 2px 8px rgba(47,84,235,0.04);\n  padding: 8px 16px 8px 8px;\n  min-width: 160px;\n  max-width: 240px;\n  position: relative;\n}\n.openwebui-file-thumb {\n  width: 40px;\n  height: 40px;\n  border-radius: 8px;\n  background: #e6e6e6;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  overflow: hidden;\n  margin-right: 10px;\n}\n.openwebui-file-img {\n  width: 40px;\n  height: 40px;\n  object-fit: cover;\n  border-radius: 8px;\n}\n.openwebui-file-icon {\n  width: 32px;\n  height: 32px;\n  border-radius: 6px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: #fff;\n  font-size: 22px;\n}\n.openwebui-file-info {\n  flex: 1;\n  min-width: 0;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n}\n.openwebui-file-name {\n  font-size: 14px;\n  color: #222;\n  font-weight: 500;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 120px;\n}\n.openwebui-file-meta {\n  font-size: 12px;\n  color: #888;\n  margin-top: 2px;\n}\n.openwebui-file-remove {\n  position: absolute;\n  top: 4px;\n  right: 4px;\n  color: #bbb;\n  font-size: 16px;\n  cursor: pointer;\n  transition: color 0.2s;\n}\n.openwebui-file-remove:hover {\n  color: #f87171;\n}\n.openwebui-chat-body {\n  flex: 1 1 0%;\n  overflow-y: auto;\n  padding: 0 16px 12px 16px;\n  background: #f9fafb;\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n  max-height: 100%;\n  flex-shrink: 1;\n  justify-content: flex-end;\n}\n.openwebui-msg {\n  display: flex;\n  align-items: flex-end;\n  margin-bottom: 16px;\n}\n.openwebui-msg.user {\n  justify-content: flex-end;\n}\n.openwebui-msg.assistant {\n  justify-content: flex-start;\n}\n.openwebui-msg-bubble {\n  max-width: 70%;\n  padding: 12px 18px;\n  border-radius: 16px;\n  font-size: 15px;\n  line-height: 1.7;\n  background: #e6f0ff;\n  color: #222;\n  box-shadow: 0 2px 8px rgba(47,84,235,0.04);\n  position: relative;\n  word-break: break-all;\n}\n.openwebui-msg.user .openwebui-msg-bubble {\n  background: #2f54eb;\n  color: #fff;\n  border-bottom-right-radius: 4px;\n  margin-right: 8px;\n}\n.openwebui-msg.assistant .openwebui-msg-bubble {\n  background: #f0f2f5;\n  color: #222;\n  border-bottom-left-radius: 4px;\n  margin-left: 8px;\n}\n.openwebui-avatar {\n  width: 36px;\n  height: 36px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n}\n.ai-avatar {\n  margin-right: 4px;\n}\n.user-avatar {\n  margin-left: 4px;\n}\n.openwebui-user-label {\n  font-weight: bold;\n  margin-right: 4px;\n}\n.openwebui-ai-label {\n  font-weight: bold;\n  color: #2f54eb;\n  margin-right: 4px;\n}\n.openwebui-chat-footer {\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  padding: 0 16px 12px 16px;\n  background: #fff;\n  border-top: 1px solid #ececec;\n  margin: 0;\n  flex-shrink: 0;\n  box-shadow: 0 -2px 16px 0 rgba(47,84,235,0.03);\n  z-index: 2;\n}\n.openwebui-input-area {\n  display: flex;\n  align-items: center;\n  width: 100%;\n}\n.openwebui-input {\n  flex: 1;\n  margin-right: 12px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n}\n.openwebui-send-btn {\n  min-width: 72px;\n  height: 40px;\n  font-size: 16px;\n  font-weight: 500;\n  border-radius: 8px;\n}\n.openwebui-upload-btn {\n  margin-right: 8px;\n  font-size: 20px;\n  background: #fff;\n  border: 1px solid #e6e6e6;\n  color: #2f54eb;\n  cursor: pointer;\n  border-radius: 8px;\n  width: 40px;\n  height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  transition: border 0.2s, box-shadow 0.2s;\n}\n.openwebui-upload-btn:hover {\n  border: 1.5px solid #2f54eb;\n  box-shadow: 0 2px 8px rgba(47,84,235,0.08);\n}\n.openwebui-img-preview {\n  max-width: 180px;\n  max-height: 120px;\n  border-radius: 8px;\n  display: block;\n  margin: 4px 0;\n  box-shadow: 0 2px 8px rgba(47,84,235,0.08);\n}\n.openwebui-file-link {\n  color: #2f54eb;\n  text-decoration: underline;\n  word-break: break-all;\n}\n</style> "],"mappings":"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","ignoreList":[]}]}