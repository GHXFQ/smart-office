{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\chat\\Index.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\chat\\Index.vue","mtime":1748008419489},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1746431728000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746431218000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5zb21lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnVybC1zZWFyY2gtcGFyYW1zLmRlbGV0ZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi51cmwtc2VhcmNoLXBhcmFtcy5oYXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLXNlYXJjaC1wYXJhbXMuc2l6ZS5qcyI7CmltcG9ydCB7IHJlZiwgY29tcHV0ZWQsIG5leHRUaWNrLCBvbk1vdW50ZWQsIG9uQmVmb3JlVW5tb3VudCwgd2F0Y2ggfSBmcm9tICd2dWUnOwppbXBvcnQgeyB1c2VTdG9yZSB9IGZyb20gJ3Z1ZXgnOwppbXBvcnQgeyBFbE1lc3NhZ2UsIEVsTWVzc2FnZUJveCB9IGZyb20gJ2VsZW1lbnQtcGx1cyc7CmltcG9ydCB7IFNlYXJjaCwgUGhvbmUsIFZpZGVvQ2FtZXJhLCBJbmZvRmlsbGVkLCBEb2N1bWVudCwgUGljdHVyZUZpbGxlZCwgRm9sZGVyT3BlbmVkLCBNaWNyb3Bob25lLCBQb3NpdGlvbiwgQ2hhdERvdFNxdWFyZSwgUmVhZGluZywgVXNlckZpbGxlZCwgQ2hhdExpbmVTcXVhcmUsIFJlZnJlc2gsIE1vcmVGaWxsZWQgfSBmcm9tICdAZWxlbWVudC1wbHVzL2ljb25zLXZ1ZSc7CmltcG9ydCB7IGdldENoYXRTZXNzaW9ucywgZ2V0Q2hhdFNlc3Npb24sIHNlbmRUZXh0TWVzc2FnZSwgc2VuZEZpbGVNZXNzYWdlLCBzZW5kSW1hZ2VNZXNzYWdlLCBzZW5kS25vd2xlZGdlTWVzc2FnZSwgZG93bmxvYWRNZXNzYWdlRmlsZSB9IGZyb20gJ0AvYXBpL2NoYXQnOwppbXBvcnQgeyBnZXRLbm93bGVkZ2VMaXN0IH0gZnJvbSAnQC9hcGkva25vd2xlZGdlJzsKaW1wb3J0IHsgdXNlUm91dGUgfSBmcm9tICd2dWUtcm91dGVyJzsKaW1wb3J0IHJlcXVlc3QgZnJvbSAnQC91dGlscy9yZXF1ZXN0JzsKaW1wb3J0IENoYXRDYWxlbmRhckV2ZW50IGZyb20gJ0AvY29tcG9uZW50cy9DaGF0Q2FsZW5kYXJFdmVudC52dWUnOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0NoYXQnLAogIGNvbXBvbmVudHM6IHsKICAgIENoYXRDYWxlbmRhckV2ZW50CiAgfSwKICBzZXR1cCgpIHsKICAgIGNvbnN0IHN0b3JlID0gdXNlU3RvcmUoKTsKICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gY29tcHV0ZWQoKCkgPT4gc3RvcmUuZ2V0dGVycy51c2VyKTsKCiAgICAvLyDmt7vliqDmnKzlnLDnlKjmiLfmlbDmja7lrZjlgqgKICAgIGNvbnN0IHVzZXJJbmZvID0gcmVmKG51bGwpOwogICAgY29uc3Qgc2VhcmNoUXVlcnkgPSByZWYoJycpOwogICAgY29uc3QgYWN0aXZlVGFiID0gcmVmKDApOwogICAgY29uc3Qgc2VsZWN0ZWRDb250YWN0ID0gcmVmKG51bGwpOwogICAgY29uc3QgbWVzc2FnZUlucHV0ID0gcmVmKCcnKTsKICAgIGNvbnN0IG1lc3NhZ2VDb250YWluZXIgPSByZWYobnVsbCk7CiAgICBjb25zdCBmaWxlSW5wdXQgPSByZWYobnVsbCk7CiAgICBjb25zdCBpbWFnZUlucHV0ID0gcmVmKG51bGwpOwogICAgY29uc3QgbWVzc2FnZXMgPSByZWYoW10pOwogICAgY29uc3QgbG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBjaGF0U2Vzc2lvbnMgPSByZWYoW10pOwogICAgY29uc3QgY3VycmVudENoYXRJZCA9IHJlZihudWxsKTsKCiAgICAvLyDnn6Xor4blupPnm7jlhbMKICAgIGNvbnN0IGtub3dsZWRnZURpYWxvZ1Zpc2libGUgPSByZWYoZmFsc2UpOwogICAgY29uc3Qga25vd2xlZGdlTG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBrbm93bGVkZ2VMaXN0ID0gcmVmKFtdKTsKICAgIGNvbnN0IHNlbGVjdGVkS25vd2xlZGdlID0gcmVmKG51bGwpOwoKICAgIC8vIOagh+etvumhtQogICAgY29uc3QgdGFicyA9IHJlZihbJ+acgOi/keiBiuWkqScsICflkIzkuosnXSk7CgogICAgLy8g6IGU57O75Lq65YiX6KGoCiAgICBjb25zdCBjb250YWN0cyA9IHJlZihbXSk7CiAgICAvLyDmiYDmnInlkIzkuovnlKjmiLfliJfooagKICAgIGNvbnN0IGFsbENvbGxlYWd1ZXMgPSByZWYoW10pOwoKICAgIC8vIOW9k+WJjemAieS4reeahOiBlOezu+S6ugogICAgY29uc3QgY3VycmVudENvbnRhY3QgPSBjb21wdXRlZCgoKSA9PiB7CiAgICAgIGlmIChzZWxlY3RlZENvbnRhY3QudmFsdWUgPT09IG51bGwpIHJldHVybiB7fTsKICAgICAgcmV0dXJuIGNvbnRhY3RzLnZhbHVlLmZpbmQoYyA9PiBjLmlkID09PSBzZWxlY3RlZENvbnRhY3QudmFsdWUpIHx8IHt9OwogICAgfSk7CgogICAgLy8g5a6J5YWo5Zyw6I635Y+W55So5oi3SUTvvIzpgb/lhY3mqKHmnb/kuK3nmoRudWxs6ZSZ6K+vCiAgICBjb25zdCB1c2VySWQgPSBjb21wdXRlZCgoKSA9PiB7CiAgICAgIHZhciBfdXNlckluZm8kdmFsdWU7CiAgICAgIHJldHVybiAoKF91c2VySW5mbyR2YWx1ZSA9IHVzZXJJbmZvLnZhbHVlKSA9PT0gbnVsbCB8fCBfdXNlckluZm8kdmFsdWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF91c2VySW5mbyR2YWx1ZS5pZCkgfHwgbnVsbDsKICAgIH0pOwoKICAgIC8vIOagueaNruaQnOe0oui/h+a7pOiBlOezu+S6ugogICAgY29uc3QgZmlsdGVyZWRDb250YWN0cyA9IGNvbXB1dGVkKCgpID0+IHsKICAgICAgaWYgKCFzZWFyY2hRdWVyeS52YWx1ZSkgcmV0dXJuIGNvbnRhY3RzLnZhbHVlOwogICAgICByZXR1cm4gY29udGFjdHMudmFsdWUuZmlsdGVyKGNvbnRhY3QgPT4gY29udGFjdC5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoUXVlcnkudmFsdWUudG9Mb3dlckNhc2UoKSkpOwogICAgfSk7CgogICAgLy8g5qC55o2u5b2T5YmN5r+A5rS755qE5qCH562+6aG16I635Y+W6KaB5pi+56S655qE6IGU57O75Lq6CiAgICBjb25zdCBnZXRBY3RpdmVDb250YWN0cyA9IGNvbXB1dGVkKCgpID0+IHsKICAgICAgaWYgKGFjdGl2ZVRhYi52YWx1ZSA9PT0gMCkgewogICAgICAgIHJldHVybiBmaWx0ZXJlZENvbnRhY3RzLnZhbHVlOwogICAgICB9IGVsc2UgaWYgKGFjdGl2ZVRhYi52YWx1ZSA9PT0gMSkgewogICAgICAgIHJldHVybiBmaWx0ZXJlZENvbnRhY3RzLnZhbHVlLmZpbHRlcihjb250YWN0ID0+ICFjb250YWN0LmlzR3JvdXApOwogICAgICB9CiAgICAgIHJldHVybiBmaWx0ZXJlZENvbnRhY3RzLnZhbHVlOwogICAgfSk7CgogICAgLy8g5oyJ6YOo6Zeo5YiG57uE55qE55So5oi3CiAgICBjb25zdCBncm91cGVkVXNlcnNCeURlcGFydG1lbnQgPSBjb21wdXRlZCgoKSA9PiB7CiAgICAgIC8vIOWQiOW5tuiBiuWkqeiBlOezu+S6uuWSjOaJgOacieWQjOS6iwogICAgICBjb25zdCB1c2Vyc01hcCA9IG5ldyBNYXAoKTsKCiAgICAgIC8vIOWFiOa3u+WKoOiBiuWkqeiBlOezu+S6uu+8iOmdnue+pOe7hO+8iQogICAgICBmaWx0ZXJlZENvbnRhY3RzLnZhbHVlLmZpbHRlcihjb250YWN0ID0+ICFjb250YWN0LmlzR3JvdXApLmZvckVhY2goY29udGFjdCA9PiB7CiAgICAgICAgLy8g6Lez6L+H6Ieq5bexCiAgICAgICAgaWYgKHVzZXJJbmZvLnZhbHVlICYmIGNvbnRhY3QudXNlcklkID09PSB1c2VySW5mby52YWx1ZS5pZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLyDkvb/nlKhJROS9nOS4uuWUr+S4gOmUrgogICAgICAgIHVzZXJzTWFwLnNldChjb250YWN0LnVzZXJJZCB8fCBjb250YWN0LmlkLCBjb250YWN0KTsKICAgICAgfSk7CgogICAgICAvLyDlho3mt7vliqDmiYDmnInlkIzkuovvvIzkvYbpgb/lhY3ph43lpI0KICAgICAgYWxsQ29sbGVhZ3Vlcy52YWx1ZS5mb3JFYWNoKGNvbGxlYWd1ZSA9PiB7CiAgICAgICAgLy8g6Lez6L+H6Ieq5bexCiAgICAgICAgaWYgKHVzZXJJbmZvLnZhbHVlICYmIGNvbGxlYWd1ZS5pZCA9PT0gdXNlckluZm8udmFsdWUuaWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIOWPquacieWcqOS4jeWtmOWcqOaXtuaJjea3u+WKoO+8iOmBv+WFjeimhueblueOsOacieiBlOezu+S6uu+8iQogICAgICAgIGlmICghdXNlcnNNYXAuaGFzKGNvbGxlYWd1ZS5pZCkpIHsKICAgICAgICAgIC8vIOaehOmAoOWFvOWuueagvOW8j+eahOeUqOaIt+WvueixoQogICAgICAgICAgY29uc3QgY29udGFjdCA9IHsKICAgICAgICAgICAgaWQ6ICd1c2VyXycgKyBjb2xsZWFndWUuaWQsCiAgICAgICAgICAgIC8vIOa3u+WKoOWJjee8gOS7pemBv+WFjeS4jueOsOacieS8muivnUlE5Yay56qBCiAgICAgICAgICAgIHVzZXJJZDogY29sbGVhZ3VlLmlkLAogICAgICAgICAgICBuYW1lOiAoKGNvbGxlYWd1ZS5maXJzdF9uYW1lIHx8ICcnKSArICcgJyArIChjb2xsZWFndWUubGFzdF9uYW1lIHx8ICcnKSkudHJpbSgpIHx8IGNvbGxlYWd1ZS51c2VybmFtZSB8fCAn5pyq5ZG95ZCN6IGU57O75Lq6JywKICAgICAgICAgICAgaW5pdGlhbDogKGNvbGxlYWd1ZS5maXJzdF9uYW1lIHx8IGNvbGxlYWd1ZS51c2VybmFtZSB8fCAn5pyq5ZG95ZCN6IGU57O75Lq6JylbMF0sCiAgICAgICAgICAgIGF2YXRhcjogY29sbGVhZ3VlLmF2YXRhciB8fCAnJywKICAgICAgICAgICAgY29sb3I6IGdldFJhbmRvbUNvbG9yKGNvbGxlYWd1ZS5pZCksCiAgICAgICAgICAgIHN0YXR1czogJ29ubGluZScsCiAgICAgICAgICAgIGxhc3RNZXNzYWdlOiAnJywKICAgICAgICAgICAgbGFzdFRpbWU6ICcnLAogICAgICAgICAgICB1bnJlYWQ6IDAsCiAgICAgICAgICAgIGlzR3JvdXA6IGZhbHNlLAogICAgICAgICAgICBkZXBhcnRtZW50OiBjb2xsZWFndWUuZGVwYXJ0bWVudCB8fCAn5YW25a6DJwogICAgICAgICAgfTsKICAgICAgICAgIHVzZXJzTWFwLnNldChjb2xsZWFndWUuaWQsIGNvbnRhY3QpOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICAvLyDmjInpg6jpl6jliIbnu4QKICAgICAgY29uc3QgZ3JvdXBlZFVzZXJzID0ge307CgogICAgICAvLyDlsIZNYXDovazkuLpBcnJheeWQjuWIhue7hAogICAgICBBcnJheS5mcm9tKHVzZXJzTWFwLnZhbHVlcygpKS5mb3JFYWNoKHVzZXIgPT4gewogICAgICAgIGNvbnN0IGRlcGFydG1lbnROYW1lID0gdXNlci5kZXBhcnRtZW50IHx8ICflhbblroMnOwogICAgICAgIGlmICghZ3JvdXBlZFVzZXJzW2RlcGFydG1lbnROYW1lXSkgewogICAgICAgICAgZ3JvdXBlZFVzZXJzW2RlcGFydG1lbnROYW1lXSA9IFtdOwogICAgICAgIH0KICAgICAgICBncm91cGVkVXNlcnNbZGVwYXJ0bWVudE5hbWVdLnB1c2godXNlcik7CiAgICAgIH0pOwogICAgICByZXR1cm4gZ3JvdXBlZFVzZXJzOwogICAgfSk7CgogICAgLy8g6Lev55SxCiAgICBjb25zdCByb3V0ZSA9IHVzZVJvdXRlKCk7CgogICAgLy8g5a6a5LmJ5LiA5LiqcmVmcmVzaEludGVydmFs55qE5byV55So77yM5Lul5L6/5Zyo57uE5Lu25Y246L295pe25riF6ZmkCiAgICBsZXQgcmVmcmVzaEludGVydmFsID0gbnVsbDsKCiAgICAvLyDnu4Tku7bljbjovb3ml7bmuIXpmaTlrprml7blmagKICAgIG9uQmVmb3JlVW5tb3VudCgoKSA9PiB7CiAgICAgIGlmIChyZWZyZXNoSW50ZXJ2YWwpIHsKICAgICAgICBjbGVhckludGVydmFsKHJlZnJlc2hJbnRlcnZhbCk7CiAgICAgIH0KICAgIH0pOwoKICAgIC8vIOi3r+eUseebuOWFs+aTjeS9nAogICAgb25Nb3VudGVkKGFzeW5jICgpID0+IHsKICAgICAgdHJ5IHsKICAgICAgICAvLyDlhYjliqDovb3nlKjmiLfmlbDmja4KICAgICAgICBjb25zdCB1c2VyRGF0YSA9IGF3YWl0IGZldGNoQ3VycmVudFVzZXIoKTsKCiAgICAgICAgLy8g5aaC5p6c6I635Y+W55So5oi35L+h5oGv5aSx6LSl77yM5pi+56S66ZSZ6K+v5bm26L+U5ZueCiAgICAgICAgaWYgKCF1c2VyRGF0YSkgewogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfml6Dms5XliqDovb3nlKjmiLfkv6Hmga/vvIzor7fliLfmlrDpobXpnaLph43or5UnKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coJ+e7hOS7tuaMgui9veaXtuiOt+WPlueahOeUqOaIt+S/oeaBrzonLCB1c2VyRGF0YSk7CgogICAgICAgIC8vIOehruS/neeUqOaIt+aVsOaNruW3sue7j+abtOaWsAogICAgICAgIGlmICghdXNlckluZm8udmFsdWUgfHwgIXVzZXJJbmZvLnZhbHVlLmlkKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfnlKjmiLfmlbDmja7mnKrmraPnoa7liqDovb06JywgdXNlckluZm8udmFsdWUpOwogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfnlKjmiLfmlbDmja7liqDovb3lvILluLjvvIzor7fliLfmlrDpobXpnaLph43or5UnKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5sb2coJ+W9k+WJjeeUqOaIt+aVsOaNruW3suato+ehruWKoOi9vTonLCB1c2VySW5mby52YWx1ZSk7CiAgICAgICAgfQoKICAgICAgICAvLyDliqDovb3miYDmnInnlKjmiLfliJfooagKICAgICAgICBhd2FpdCBsb2FkQWxsVXNlcnMoKTsKCiAgICAgICAgLy8g5YaN5Yqg6L296IGK5aSp5Lya6K+d5YiX6KGoCiAgICAgICAgYXdhaXQgbG9hZENoYXRTZXNzaW9ucygpOwoKICAgICAgICAvLyDmo4Dmn6VVUkzlj4LmlbDkuK3mmK/lkKbmnInkvJror51JRAogICAgICAgIGNvbnN0IHNlc3Npb25JZCA9IHJvdXRlLnF1ZXJ5LnNlc3Npb24gfHwgcm91dGUucXVlcnkuaWQ7CiAgICAgICAgaWYgKHNlc3Npb25JZCkgewogICAgICAgICAgLy8g5p+l5om+5a+55bqU55qE6IGU57O75Lq6CiAgICAgICAgICBjb25zdCBmb3VuZENvbnRhY3QgPSBjb250YWN0cy52YWx1ZS5maW5kKGMgPT4gYy5pZCA9PT0gcGFyc2VJbnQoc2Vzc2lvbklkKSk7CiAgICAgICAgICBpZiAoZm91bmRDb250YWN0KSB7CiAgICAgICAgICAgIC8vIOmAieS4reivpeiBlOezu+S6ugogICAgICAgICAgICBzZWxlY3RlZENvbnRhY3QudmFsdWUgPSBmb3VuZENvbnRhY3QuaWQ7CiAgICAgICAgICAgIC8vIOWKoOi9veiBiuWkqeiusOW9lQogICAgICAgICAgICBhd2FpdCBsb2FkQ2hhdE1lc3NhZ2VzKHNlc3Npb25JZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyDlpoLmnpzmnKrmib7liLDlr7nlupTogZTns7vkurrvvIzlsJ3or5Xnm7TmjqXliqDovb3kvJror50KICAgICAgICAgICAgY29uc29sZS5sb2coJ+mAmui/h0lE55u05o6l5Yqg6L296IGK5aSp5Lya6K+dOicsIHNlc3Npb25JZCk7CiAgICAgICAgICAgIGF3YWl0IGxvYWRDaGF0TWVzc2FnZXMoc2Vzc2lvbklkKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIOiuvue9ruWumuaXtuWIt+aWsAogICAgICAgIHJlZnJlc2hJbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHsKICAgICAgICAgIGlmIChzZWxlY3RlZENvbnRhY3QudmFsdWUpIHsKICAgICAgICAgICAgYXdhaXQgbG9hZENoYXRNZXNzYWdlcyhzZWxlY3RlZENvbnRhY3QudmFsdWUpOwogICAgICAgICAgfQogICAgICAgICAgYXdhaXQgbG9hZENoYXRTZXNzaW9ucygpOwogICAgICAgIH0sIDMwMDAwKTsKCiAgICAgICAgLy8g5Yid5aeL5rua5Yqo5Yiw5bqV6YOoCiAgICAgICAgYXdhaXQgbmV4dFRpY2soKTsKICAgICAgICBzY3JvbGxUb0JvdHRvbSgpOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIneWni+WMluiBiuWkqee7hOS7tuWksei0pTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfliJ3lp4vljJbogYrlpKnnu4Tku7blpLHotKU6ICcgKyBlcnJvci5tZXNzYWdlKTsKICAgICAgfQogICAgfSk7CgogICAgLy8g6I635Y+W5b2T5YmN55So5oi35L+h5oGvCiAgICBjb25zdCBmZXRjaEN1cnJlbnRVc2VyID0gYXN5bmMgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnNvbGUubG9nKCflvIDlp4vojrflj5blvZPliY3nlKjmiLfkv6Hmga8uLi4nKTsKCiAgICAgICAgLy8g5qOA5p+lbG9jYWxTdG9yYWdl5Lit5piv5ZCm5pyJdG9rZW4KICAgICAgICBjb25zdCB0b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpOwogICAgICAgIGlmICghdG9rZW4pIHsKICAgICAgICAgIGNvbnNvbGUud2Fybign5pys5Zyw5a2Y5YKo5Lit5rKh5pyJ5om+5Yiw6K6k6K+BdG9rZW4nKTsKICAgICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfmnKrnmbvlvZXmiJbnmbvlvZXlt7Lov4fmnJ/vvIzor7fph43mlrDnmbvlvZUnKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoewogICAgICAgICAgdXJsOiAnL2FwaS9hdXRoL3VzZXJzL21lLycsCiAgICAgICAgICBtZXRob2Q6ICdnZXQnCiAgICAgICAgfSk7CiAgICAgICAgY29uc29sZS5sb2coJ+iOt+WPlueUqOaIt+S/oeaBr+WTjeW6lDonLCByZXNwb25zZSk7CgogICAgICAgIC8vIOajgOafpeWTjeW6lOagvOW8j+W5tuiOt+WPlueUqOaIt+aVsOaNrgogICAgICAgIGxldCB1c2VyRGF0YSA9IG51bGw7CiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5pZCkgewogICAgICAgICAgLy8g55u05o6l5LuOZGF0YeWtl+auteiOt+WPlueUqOaIt+aVsOaNrgogICAgICAgICAgdXNlckRhdGEgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgY29uc29sZS5sb2coJ+S7jmRhdGHlrZfmrrXojrflj5bnlKjmiLfmlbDmja46JywgdXNlckRhdGEpOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5kYXRhLmlkKSB7CiAgICAgICAgICAvLyDku47ltYzlpZdkYXRh5a2X5q616I635Y+W55So5oi35pWw5o2uCiAgICAgICAgICB1c2VyRGF0YSA9IHJlc3BvbnNlLmRhdGEuZGF0YTsKICAgICAgICAgIGNvbnNvbGUubG9nKCfku47ltYzlpZdkYXRh5a2X5q616I635Y+W55So5oi35pWw5o2uOicsIHVzZXJEYXRhKTsKICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmlkKSB7CiAgICAgICAgICAvLyDnm7TmjqXlk43lupTlsLHmmK/nlKjmiLfmlbDmja4KICAgICAgICAgIHVzZXJEYXRhID0gcmVzcG9uc2U7CiAgICAgICAgICBjb25zb2xlLmxvZygn55u05o6l6I635Y+W55So5oi35pWw5o2uOicsIHVzZXJEYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W55So5oi35L+h5oGv5ZON5bqU5qC85byP5byC5bi4OicsIHJlc3BvbnNlKTsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcign55So5oi35L+h5oGv5qC85byP5byC5bi4Jyk7CiAgICAgICAgfQogICAgICAgIGlmICghdXNlckRhdGEgfHwgIXVzZXJEYXRhLmlkKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bnmoTnlKjmiLfmlbDmja7ml6DmlYg6JywgdXNlckRhdGEpOwogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfml6DmlYjnmoTnlKjmiLfmlbDmja4nKTsKICAgICAgICB9CgogICAgICAgIC8vIOS4jeS9v+eUqOacquWumuS5ieeahG11dGF0aW9u77yM6ICM5piv55u05o6l5pu05paw5pys5Zyw54q25oCBCiAgICAgICAgdXNlckluZm8udmFsdWUgPSB1c2VyRGF0YTsKCiAgICAgICAgLy8g5L+d5a2Y5YiwbG9jYWxTdG9yYWdl5Lul5L6/5oyB5LmF5YyWCiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3VzZXInLCBKU09OLnN0cmluZ2lmeSh1c2VyRGF0YSkpOwogICAgICAgIGNvbnNvbGUubG9nKCfnlKjmiLfmlbDmja7lt7Lmm7TmlrA6JywgdXNlckluZm8udmFsdWUpOwogICAgICAgIHJldHVybiB1c2VyRGF0YTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5blvZPliY3nlKjmiLfkv6Hmga/lpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign6I635Y+W55So5oi35L+h5oGv5aSx6LSlOiAnICsgKGVycm9yLm1lc3NhZ2UgfHwgJ+acquefpemUmeivrycpKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfTsKCiAgICAvLyDliqDovb3ogYrlpKnkvJror53liJfooagKICAgIGNvbnN0IGxvYWRDaGF0U2Vzc2lvbnMgPSBhc3luYyAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgbG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgICAgY29uc29sZS5sb2coJ+ato+WcqOWKoOi9veiBiuWkqeS8muivneWIl+ihqC4uLicpOwogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0Q2hhdFNlc3Npb25zKCk7CiAgICAgICAgY29uc29sZS5sb2coJ+iOt+WPluiBiuWkqeS8muivneWTjeW6lDonLCByZXNwb25zZSk7CgogICAgICAgIC8vIOehruS/neaIkeS7rOacieWTjeW6lOaVsOaNrgogICAgICAgIGlmICghcmVzcG9uc2UpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPluiBiuWkqeS8muivnei/lOWbnuepuuWTjeW6lCcpOwogICAgICAgICAgY29udGFjdHMudmFsdWUgPSBbXTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgbGV0IGRhdGE7CiAgICAgICAgaWYgKHJlc3BvbnNlLnN1Y2Nlc3MgJiYgcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICBjb25zb2xlLmxvZygn5L2/55So5YyF6KOF5qC85byP55qE6IGK5aSp5pWw5o2uOicsIGRhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkYXRhID0gcmVzcG9uc2U7CiAgICAgICAgICBjb25zb2xlLmxvZygn5L2/55So55u05o6l6L+U5Zue55qE6IGK5aSp5pWw5o2uOicsIGRhdGEpOwogICAgICAgIH0KCiAgICAgICAgLy8g6L2s5o2i5pWw5o2u5qC85byPCiAgICAgICAgY2hhdFNlc3Npb25zLnZhbHVlID0gZGF0YTsKCiAgICAgICAgLy8g5p6E5bu66IGU57O75Lq65YiX6KGoCiAgICAgICAgaWYgKGRhdGEgJiYgQXJyYXkuaXNBcnJheShkYXRhLnJlc3VsdHMpKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygn5aSE55CG5YiG6aG15pWw5o2u57uT5p6ELCDlhbHmnInkvJror53mlbA6JywgZGF0YS5yZXN1bHRzLmxlbmd0aCk7CiAgICAgICAgICAvLyDlpITnkIbliIbpobXmlbDmja7nu5PmnoQKICAgICAgICAgIGNvbnRhY3RzLnZhbHVlID0gZGF0YS5yZXN1bHRzLm1hcChzZXNzaW9uID0+IHsKICAgICAgICAgICAgLy8g5om+5Yiw5a+55pa555So5oi377yI6Z2e5b2T5YmN55So5oi377yJCiAgICAgICAgICAgIGxldCBvdGhlclBhcnRpY2lwYW50ID0gbnVsbDsKICAgICAgICAgICAgaWYgKHNlc3Npb24ucGFydGljaXBhbnRzICYmIEFycmF5LmlzQXJyYXkoc2Vzc2lvbi5wYXJ0aWNpcGFudHMpKSB7CiAgICAgICAgICAgICAgaWYgKHVzZXJJbmZvLnZhbHVlICYmIHVzZXJJbmZvLnZhbHVlLmlkKSB7CiAgICAgICAgICAgICAgICBvdGhlclBhcnRpY2lwYW50ID0gc2Vzc2lvbi5wYXJ0aWNpcGFudHMuZmluZChwID0+IHAudXNlciAmJiBwLnVzZXIuaWQgIT09IHVzZXJJbmZvLnZhbHVlLmlkKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8g5aaC5p6c5rKh5pyJ5b2T5YmN55So5oi35L+h5oGv77yM5L2/55So56ys5LiA5Liq5Y+C5LiO6ICFCiAgICAgICAgICAgICAgICBvdGhlclBhcnRpY2lwYW50ID0gc2Vzc2lvbi5wYXJ0aWNpcGFudHNbMF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDlpoLmnpzmmK/nvqTogYrvvIzkvb/nlKjnvqTogYrkv6Hmga8KICAgICAgICAgICAgaWYgKHNlc3Npb24uaXNfZ3JvdXApIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IHNlc3Npb24uaWQsCiAgICAgICAgICAgICAgICBuYW1lOiBzZXNzaW9uLnRpdGxlIHx8ICfnvqTogYonLAogICAgICAgICAgICAgICAgaW5pdGlhbDogKHNlc3Npb24udGl0bGUgfHwgJ+e+pOiBiicpWzBdLAogICAgICAgICAgICAgICAgYXZhdGFyOiAnJywKICAgICAgICAgICAgICAgIGF2YXRhcl91cmw6ICcnLAogICAgICAgICAgICAgICAgY29sb3I6IGdldFJhbmRvbUNvbG9yKHNlc3Npb24uaWQpLAogICAgICAgICAgICAgICAgc3RhdHVzOiAnb25saW5lJywKICAgICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IHNlc3Npb24ubGFzdF9tZXNzYWdlLmNvbnRlbnQgOiAnJywKICAgICAgICAgICAgICAgIGxhc3RUaW1lOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24ubGFzdF9tZXNzYWdlLmNyZWF0ZWRfYXQpIDogZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi51cGRhdGVkX2F0KSwKICAgICAgICAgICAgICAgIHVucmVhZDogc2Vzc2lvbi51bnJlYWRfY291bnQsCiAgICAgICAgICAgICAgICBpc0dyb3VwOiB0cnVlCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g5Y2V6IGK77yM5L2/55So5a+55pa55L+h5oGvCiAgICAgICAgICAgIGlmIChvdGhlclBhcnRpY2lwYW50KSB7CiAgICAgICAgICAgICAgY29uc3QgdXNlciA9IG90aGVyUGFydGljaXBhbnQudXNlcjsKICAgICAgICAgICAgICAvLyDlpITnkIblpLTlg4/ot6/lvoQKICAgICAgICAgICAgICBsZXQgYXZhdGFyX3VybCA9ICcnOwogICAgICAgICAgICAgIGlmICh1c2VyLmF2YXRhcikgewogICAgICAgICAgICAgICAgY29uc3QgYXZhdGFyID0gdXNlci5hdmF0YXI7CiAgICAgICAgICAgICAgICBpZiAoYXZhdGFyLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBhdmF0YXIuc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkgewogICAgICAgICAgICAgICAgICBhdmF0YXJfdXJsID0gYXZhdGFyOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhdmF0YXIuc3RhcnRzV2l0aCgnLycpKSB7CiAgICAgICAgICAgICAgICAgIGF2YXRhcl91cmwgPSBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJIHx8ICdodHRwOi8vbG9jYWxob3N0OjgwMDAnfSR7YXZhdGFyfWA7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBhdmF0YXJfdXJsID0gYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9CQVNFX0FQSSB8fCAnaHR0cDovL2xvY2FsaG9zdDo4MDAwJ30vJHthdmF0YXJ9YDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBzZXNzaW9uLmlkLAogICAgICAgICAgICAgICAgdXNlcklkOiB1c2VyLmlkLAogICAgICAgICAgICAgICAgLy8g5re75Yqg55So5oi3SUTvvIznlKjkuo7mo4Dmn6XmmK/lkKbmmK/oh6rlt7EKICAgICAgICAgICAgICAgIG5hbWU6ICgodXNlci5maXJzdF9uYW1lIHx8ICcnKSArICcgJyArICh1c2VyLmxhc3RfbmFtZSB8fCAnJykpLnRyaW0oKSB8fCB1c2VyLnVzZXJuYW1lIHx8ICfmnKrlkb3lkI3ogZTns7vkuronLAogICAgICAgICAgICAgICAgaW5pdGlhbDogKHVzZXIuZmlyc3RfbmFtZSB8fCB1c2VyLnVzZXJuYW1lIHx8ICfmnKrlkb3lkI3ogZTns7vkuronKVswXSwKICAgICAgICAgICAgICAgIGF2YXRhcjogdXNlci5hdmF0YXIgfHwgJycsCiAgICAgICAgICAgICAgICBhdmF0YXJfdXJsOiBhdmF0YXJfdXJsLAogICAgICAgICAgICAgICAgY29sb3I6IGdldFJhbmRvbUNvbG9yKHVzZXIuaWQpLAogICAgICAgICAgICAgICAgc3RhdHVzOiAnb25saW5lJywKICAgICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IHNlc3Npb24ubGFzdF9tZXNzYWdlLmNvbnRlbnQgOiAnJywKICAgICAgICAgICAgICAgIGxhc3RUaW1lOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24ubGFzdF9tZXNzYWdlLmNyZWF0ZWRfYXQpIDogZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi51cGRhdGVkX2F0KSwKICAgICAgICAgICAgICAgIHVucmVhZDogc2Vzc2lvbi51bnJlYWRfY291bnQsCiAgICAgICAgICAgICAgICBpc0dyb3VwOiBmYWxzZSwKICAgICAgICAgICAgICAgIGRlcGFydG1lbnQ6IHVzZXIuZGVwYXJ0bWVudCAvLyDmt7vliqDpg6jpl6jkv6Hmga8KICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDlpoLmnpzmsqHmnInlhbbku5blj4LkuI7ogIXvvIjnkIborrrkuIrkuI3lupTor6Xlj5HnlJ/vvIkKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBpZDogc2Vzc2lvbi5pZCwKICAgICAgICAgICAgICBuYW1lOiBzZXNzaW9uLnRpdGxlIHx8ICfogYrlpKknLAogICAgICAgICAgICAgIGluaXRpYWw6IChzZXNzaW9uLnRpdGxlIHx8ICfogYrlpKknKVswXSwKICAgICAgICAgICAgICBhdmF0YXI6ICcnLAogICAgICAgICAgICAgIGF2YXRhcl91cmw6ICcnLAogICAgICAgICAgICAgIGNvbG9yOiBnZXRSYW5kb21Db2xvcihzZXNzaW9uLmlkKSwKICAgICAgICAgICAgICBzdGF0dXM6ICdvbmxpbmUnLAogICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IHNlc3Npb24ubGFzdF9tZXNzYWdlLmNvbnRlbnQgOiAnJywKICAgICAgICAgICAgICBsYXN0VGltZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLmxhc3RfbWVzc2FnZS5jcmVhdGVkX2F0KSA6IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24udXBkYXRlZF9hdCksCiAgICAgICAgICAgICAgdW5yZWFkOiBzZXNzaW9uLnVucmVhZF9jb3VudCwKICAgICAgICAgICAgICBpc0dyb3VwOiBzZXNzaW9uLmlzX2dyb3VwCiAgICAgICAgICAgIH07CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKGRhdGEgJiYgQXJyYXkuaXNBcnJheShkYXRhKSkgewogICAgICAgICAgY29uc29sZS5sb2coJ+WkhOeQhumdnuWIhumhteaVsOaNrue7k+aehCwg5YWx5pyJ5Lya6K+d5pWwOicsIGRhdGEubGVuZ3RoKTsKICAgICAgICAgIC8vIOWkhOeQhumdnuWIhumhteaVsOaNrue7k+aehAogICAgICAgICAgY29udGFjdHMudmFsdWUgPSBkYXRhLm1hcChzZXNzaW9uID0+IHsKICAgICAgICAgICAgLy8g5om+5Yiw5a+55pa555So5oi377yI6Z2e5b2T5YmN55So5oi377yJCiAgICAgICAgICAgIGxldCBvdGhlclBhcnRpY2lwYW50ID0gbnVsbDsKICAgICAgICAgICAgaWYgKHNlc3Npb24ucGFydGljaXBhbnRzICYmIEFycmF5LmlzQXJyYXkoc2Vzc2lvbi5wYXJ0aWNpcGFudHMpKSB7CiAgICAgICAgICAgICAgaWYgKHVzZXJJbmZvLnZhbHVlICYmIHVzZXJJbmZvLnZhbHVlLmlkKSB7CiAgICAgICAgICAgICAgICBvdGhlclBhcnRpY2lwYW50ID0gc2Vzc2lvbi5wYXJ0aWNpcGFudHMuZmluZChwID0+IHAudXNlciAmJiBwLnVzZXIuaWQgIT09IHVzZXJJbmZvLnZhbHVlLmlkKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8g5aaC5p6c5rKh5pyJ5b2T5YmN55So5oi35L+h5oGv77yM5L2/55So56ys5LiA5Liq5Y+C5LiO6ICFCiAgICAgICAgICAgICAgICBvdGhlclBhcnRpY2lwYW50ID0gc2Vzc2lvbi5wYXJ0aWNpcGFudHNbMF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyDlpoLmnpzmmK/nvqTogYrvvIzkvb/nlKjnvqTogYrkv6Hmga8KICAgICAgICAgICAgaWYgKHNlc3Npb24uaXNfZ3JvdXApIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IHNlc3Npb24uaWQsCiAgICAgICAgICAgICAgICBuYW1lOiBzZXNzaW9uLnRpdGxlIHx8ICfnvqTogYonLAogICAgICAgICAgICAgICAgaW5pdGlhbDogKHNlc3Npb24udGl0bGUgfHwgJ+e+pOiBiicpWzBdLAogICAgICAgICAgICAgICAgYXZhdGFyOiAnJywKICAgICAgICAgICAgICAgIGF2YXRhcl91cmw6ICcnLAogICAgICAgICAgICAgICAgY29sb3I6IGdldFJhbmRvbUNvbG9yKHNlc3Npb24uaWQpLAogICAgICAgICAgICAgICAgc3RhdHVzOiAnb25saW5lJywKICAgICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IHNlc3Npb24ubGFzdF9tZXNzYWdlLmNvbnRlbnQgOiAnJywKICAgICAgICAgICAgICAgIGxhc3RUaW1lOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IGZvcm1hdE1lc3NhZ2VUaW1lKHNlc3Npb24ubGFzdF9tZXNzYWdlLmNyZWF0ZWRfYXQpIDogZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi51cGRhdGVkX2F0KSwKICAgICAgICAgICAgICAgIHVucmVhZDogc2Vzc2lvbi51bnJlYWRfY291bnQsCiAgICAgICAgICAgICAgICBpc0dyb3VwOiB0cnVlCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g5Y2V6IGK77yM5L2/55So5a+55pa55L+h5oGvCiAgICAgICAgICAgIGlmIChvdGhlclBhcnRpY2lwYW50KSB7CiAgICAgICAgICAgICAgY29uc3QgdXNlciA9IG90aGVyUGFydGljaXBhbnQudXNlcjsKICAgICAgICAgICAgICAvLyDlpITnkIblpLTlg4/ot6/lvoQKICAgICAgICAgICAgICBsZXQgYXZhdGFyX3VybCA9ICcnOwogICAgICAgICAgICAgIGlmICh1c2VyLmF2YXRhcikgewogICAgICAgICAgICAgICAgY29uc3QgYXZhdGFyID0gdXNlci5hdmF0YXI7CiAgICAgICAgICAgICAgICBpZiAoYXZhdGFyLnN0YXJ0c1dpdGgoJ2h0dHA6Ly8nKSB8fCBhdmF0YXIuc3RhcnRzV2l0aCgnaHR0cHM6Ly8nKSkgewogICAgICAgICAgICAgICAgICBhdmF0YXJfdXJsID0gYXZhdGFyOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhdmF0YXIuc3RhcnRzV2l0aCgnLycpKSB7CiAgICAgICAgICAgICAgICAgIGF2YXRhcl91cmwgPSBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJIHx8ICdodHRwOi8vbG9jYWxob3N0OjgwMDAnfSR7YXZhdGFyfWA7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBhdmF0YXJfdXJsID0gYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9CQVNFX0FQSSB8fCAnaHR0cDovL2xvY2FsaG9zdDo4MDAwJ30vJHthdmF0YXJ9YDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBzZXNzaW9uLmlkLAogICAgICAgICAgICAgICAgbmFtZTogKCh1c2VyLmZpcnN0X25hbWUgfHwgJycpICsgJyAnICsgKHVzZXIubGFzdF9uYW1lIHx8ICcnKSkudHJpbSgpIHx8IHVzZXIudXNlcm5hbWUgfHwgJ+acquWRveWQjeiBlOezu+S6uicsCiAgICAgICAgICAgICAgICBpbml0aWFsOiAodXNlci5maXJzdF9uYW1lIHx8IHVzZXIudXNlcm5hbWUgfHwgJ+acquWRveWQjeiBlOezu+S6uicpWzBdLAogICAgICAgICAgICAgICAgYXZhdGFyOiB1c2VyLmF2YXRhciB8fCAnJywKICAgICAgICAgICAgICAgIGF2YXRhcl91cmw6IGF2YXRhcl91cmwsCiAgICAgICAgICAgICAgICBjb2xvcjogZ2V0UmFuZG9tQ29sb3IodXNlci5pZCksCiAgICAgICAgICAgICAgICBzdGF0dXM6ICdvbmxpbmUnLAogICAgICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IHNlc3Npb24ubGFzdF9tZXNzYWdlID8gc2Vzc2lvbi5sYXN0X21lc3NhZ2UuY29udGVudCA6ICcnLAogICAgICAgICAgICAgICAgbGFzdFRpbWU6IHNlc3Npb24ubGFzdF9tZXNzYWdlID8gZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi5sYXN0X21lc3NhZ2UuY3JlYXRlZF9hdCkgOiBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLnVwZGF0ZWRfYXQpLAogICAgICAgICAgICAgICAgdW5yZWFkOiBzZXNzaW9uLnVucmVhZF9jb3VudCwKICAgICAgICAgICAgICAgIGlzR3JvdXA6IGZhbHNlCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g5aaC5p6c5rKh5pyJ5YW25LuW5Y+C5LiO6ICF77yI55CG6K665LiK5LiN5bqU6K+l5Y+R55Sf77yJCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgaWQ6IHNlc3Npb24uaWQsCiAgICAgICAgICAgICAgbmFtZTogc2Vzc2lvbi50aXRsZSB8fCAn6IGK5aSpJywKICAgICAgICAgICAgICBpbml0aWFsOiAoc2Vzc2lvbi50aXRsZSB8fCAn6IGK5aSpJylbMF0sCiAgICAgICAgICAgICAgYXZhdGFyOiAnJywKICAgICAgICAgICAgICBhdmF0YXJfdXJsOiAnJywKICAgICAgICAgICAgICBjb2xvcjogZ2V0UmFuZG9tQ29sb3Ioc2Vzc2lvbi5pZCksCiAgICAgICAgICAgICAgc3RhdHVzOiAnb25saW5lJywKICAgICAgICAgICAgICBsYXN0TWVzc2FnZTogc2Vzc2lvbi5sYXN0X21lc3NhZ2UgPyBzZXNzaW9uLmxhc3RfbWVzc2FnZS5jb250ZW50IDogJycsCiAgICAgICAgICAgICAgbGFzdFRpbWU6IHNlc3Npb24ubGFzdF9tZXNzYWdlID8gZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi5sYXN0X21lc3NhZ2UuY3JlYXRlZF9hdCkgOiBmb3JtYXRNZXNzYWdlVGltZShzZXNzaW9uLnVwZGF0ZWRfYXQpLAogICAgICAgICAgICAgIHVucmVhZDogc2Vzc2lvbi51bnJlYWRfY291bnQsCiAgICAgICAgICAgICAgaXNHcm91cDogc2Vzc2lvbi5pc19ncm91cAogICAgICAgICAgICB9OwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIOWmguaenOayoeacieacieaViOaVsOaNrgogICAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W6IGK5aSp5Lya6K+d5qC85byP5byC5bi45oiW5Li656m6OicsIGRhdGEpOwogICAgICAgICAgY29udGFjdHMudmFsdWUgPSBbXTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coJ+WkhOeQhuWQjueahOiBlOezu+S6uuWIl+ihqDonLCBjb250YWN0cy52YWx1ZSk7CgogICAgICAgIC8vIOWmguaenOacieacquivu+a2iOaBr++8jOaMieacquivu+aVsOmHj+aOkuW6jwogICAgICAgIGlmIChjb250YWN0cy52YWx1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICBjb250YWN0cy52YWx1ZS5zb3J0KChhLCBiKSA9PiBiLnVucmVhZCAtIGEudW5yZWFkKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Yqg6L296IGK5aSp5Lya6K+d5aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WKoOi9veiBiuWkqeS8muivneWksei0pTogJyArIChlcnJvci5tZXNzYWdlIHx8ICfmnKrnn6XplJnor68nKSk7CiAgICAgICAgY29udGFjdHMudmFsdWUgPSBbXTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBsb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgIH0KICAgIH07CgogICAgLy8g5Yqg6L296IGK5aSp5raI5oGvCiAgICBjb25zdCBsb2FkQ2hhdE1lc3NhZ2VzID0gYXN5bmMgY2hhdElkID0+IHsKICAgICAgaWYgKCFjaGF0SWQpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfml6Dms5XliqDovb3mtojmga86IGNoYXRJZOS4uuepuicpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGxvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICAgIGNvbnNvbGUubG9nKGDmraPlnKjliqDovb3ogYrlpKnkvJror50gJHtjaGF0SWR9IOeahOa2iOaBry4uLmApOwogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0Q2hhdFNlc3Npb24oY2hhdElkKTsKICAgICAgICBjb25zb2xlLmxvZygn6IGK5aSp5Lya6K+d6K+m5oOF5ZON5bqUOicsIHJlc3BvbnNlKTsKICAgICAgICBpZiAoIXJlc3BvbnNlKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bogYrlpKnkvJror53or6bmg4Xov5Tlm57nqbrlk43lupQnKTsKICAgICAgICAgIG1lc3NhZ2VzLnZhbHVlID0gW107CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyDlpITnkIbkuI3lkIznmoTlk43lupTmoLzlvI8KICAgICAgICBsZXQgbWVzc2FnZURhdGEgPSBbXTsKICAgICAgICBsZXQgc2Vzc2lvbkRhdGEgPSBudWxsOwogICAgICAgIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEubWVzc2FnZXMpIHsKICAgICAgICAgIC8vIOagh+WHhuagvOW8j++8muWTjeW6lOebtOaOpeWMheWQq21lc3NhZ2Vz5a2X5q61CiAgICAgICAgICBtZXNzYWdlRGF0YSA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZXM7CiAgICAgICAgICBzZXNzaW9uRGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICBjb25zb2xlLmxvZygn5qCH5YeG5qC85byP5raI5oGv5pWw5o2u77yM5raI5oGv5pWw6YePOicsIG1lc3NhZ2VEYXRhLmxlbmd0aCk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuZGF0YSAmJiByZXNwb25zZS5kYXRhLmRhdGEubWVzc2FnZXMpIHsKICAgICAgICAgIC8vIOWMheijheagvOW8j++8mntzdWNjZXNzOiB0cnVlLCBkYXRhOiB7bWVzc2FnZXM6IFsuLi5dfX0KICAgICAgICAgIG1lc3NhZ2VEYXRhID0gcmVzcG9uc2UuZGF0YS5kYXRhLm1lc3NhZ2VzOwogICAgICAgICAgc2Vzc2lvbkRhdGEgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICBjb25zb2xlLmxvZygn5YyF6KOF5qC85byP5raI5oGv5pWw5o2u77yM5raI5oGv5pWw6YePOicsIG1lc3NhZ2VEYXRhLmxlbmd0aCk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5tZXNzYWdlcykgewogICAgICAgICAgLy8g55u05o6l6L+U5Zue5qC85byPOiB7bWVzc2FnZXM6IFsuLi5dfQogICAgICAgICAgbWVzc2FnZURhdGEgPSByZXNwb25zZS5tZXNzYWdlczsKICAgICAgICAgIHNlc3Npb25EYXRhID0gcmVzcG9uc2U7CiAgICAgICAgICBjb25zb2xlLmxvZygn55u05o6l6L+U5Zue5qC85byP5raI5oGv5pWw5o2u77yM5raI5oGv5pWw6YePOicsIG1lc3NhZ2VEYXRhLmxlbmd0aCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnNvbGUud2Fybign5peg5rOV6K+G5Yir55qE5raI5oGv5pWw5o2u5qC85byPOicsIHJlc3BvbnNlKTsKICAgICAgICAgIGNvbnNvbGUubG9nKCflsJ3or5Xmo4Dmn6XmmK/lkKbmnInlhbbku5blj6/og73nmoTmtojmga/lrZfmrrUuLi4nKTsKCiAgICAgICAgICAvLyDlsJ3or5Xmn6Xmib7lhbbku5blj6/og73nmoTmtojmga/lrZfmrrUKICAgICAgICAgIGNvbnN0IHBvc3NpYmxlTWVzc2FnZUZpZWxkcyA9IFsnbWVzc2FnZScsICdjaGF0X21lc3NhZ2VzJywgJ2NoYXRzJywgJ2NvbnRlbnQnXTsKICAgICAgICAgIGZvciAoY29uc3QgZmllbGQgb2YgcG9zc2libGVNZXNzYWdlRmllbGRzKSB7CiAgICAgICAgICAgIGlmIChyZXNwb25zZVtmaWVsZF0gJiYgQXJyYXkuaXNBcnJheShyZXNwb25zZVtmaWVsZF0pKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coYOaJvuWIsOWPr+iDveeahOa2iOaBr+Wtl+autSAke2ZpZWxkfe+8jOS9v+eUqOatpOWtl+auteaVsOaNrmApOwogICAgICAgICAgICAgIG1lc3NhZ2VEYXRhID0gcmVzcG9uc2VbZmllbGRdOwogICAgICAgICAgICAgIHNlc3Npb25EYXRhID0gcmVzcG9uc2U7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhW2ZpZWxkXSAmJiBBcnJheS5pc0FycmF5KHJlc3BvbnNlLmRhdGFbZmllbGRdKSkgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKGDlnKhkYXRh5a2X5q615Lit5om+5Yiw5Y+v6IO955qE5raI5oGv5a2X5q61ICR7ZmllbGR977yM5L2/55So5q2k5a2X5q615pWw5o2uYCk7CiAgICAgICAgICAgICAgbWVzc2FnZURhdGEgPSByZXNwb25zZS5kYXRhW2ZpZWxkXTsKICAgICAgICAgICAgICBzZXNzaW9uRGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChtZXNzYWdlRGF0YS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKCfmnKrmib7liLDku7vkvZXmtojmga/mlbDmja7vvIzkvb/nlKjnqbrmlbDnu4QnKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIOWkhOeQhua2iOaBr+WPkemAgeiAheeahOWktOWDjwogICAgICAgIG1lc3NhZ2VEYXRhLmZvckVhY2gobWVzc2FnZSA9PiB7CiAgICAgICAgICBpZiAobWVzc2FnZS5zZW5kZXIgJiYgbWVzc2FnZS5zZW5kZXIuYXZhdGFyKSB7CiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IG1lc3NhZ2Uuc2VuZGVyLmF2YXRhcjsKICAgICAgICAgICAgaWYgKGF2YXRhci5zdGFydHNXaXRoKCdodHRwOi8vJykgfHwgYXZhdGFyLnN0YXJ0c1dpdGgoJ2h0dHBzOi8vJykpIHsKICAgICAgICAgICAgICBtZXNzYWdlLnNlbmRlci5hdmF0YXJfdXJsID0gYXZhdGFyOwogICAgICAgICAgICB9IGVsc2UgaWYgKGF2YXRhci5zdGFydHNXaXRoKCcvJykpIHsKICAgICAgICAgICAgICBtZXNzYWdlLnNlbmRlci5hdmF0YXJfdXJsID0gYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9CQVNFX0FQSSB8fCAnaHR0cDovL2xvY2FsaG9zdDo4MDAwJ30ke2F2YXRhcn1gOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1lc3NhZ2Uuc2VuZGVyLmF2YXRhcl91cmwgPSBgJHtwcm9jZXNzLmVudi5WVUVfQVBQX0JBU0VfQVBJIHx8ICdodHRwOi8vbG9jYWxob3N0OjgwMDAnfS8ke2F2YXRhcn1gOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vIOiusOW9leS8muivneWSjOa2iOaBr+aVsOaNrgogICAgICAgIGNvbnNvbGUubG9nKCflpITnkIblkI7nmoTkvJror53mlbDmja46Jywgc2Vzc2lvbkRhdGEpOwogICAgICAgIGNvbnNvbGUubG9nKCflpITnkIblkI7nmoTmtojmga/mlbDmja46JywgbWVzc2FnZURhdGEpOwoKICAgICAgICAvLyDlpoLmnpzkvJror53kuI3lnKjogZTns7vkurrliJfooajkuK3vvIzmt7vliqDlroMKICAgICAgICBpZiAoc2Vzc2lvbkRhdGEgJiYgIWNvbnRhY3RzLnZhbHVlLnNvbWUoYyA9PiBjLmlkID09PSBwYXJzZUludChjaGF0SWQpKSkgewogICAgICAgICAgY29uc29sZS5sb2coJ+S8muivneS4jeWcqOiBlOezu+S6uuWIl+ihqOS4re+8jOa3u+WKoOWugzonLCBzZXNzaW9uRGF0YSk7CgogICAgICAgICAgLy8g5Yib5bu65Li05pe26IGU57O75Lq65a+56LGhCiAgICAgICAgICBjb25zdCBzZXNzaW9uID0gc2Vzc2lvbkRhdGE7CiAgICAgICAgICAvLyDmib7liLDlr7nmlrnnlKjmiLfvvIjpnZ7lvZPliY3nlKjmiLfvvIkKICAgICAgICAgIGxldCBvdGhlclBhcnRpY2lwYW50ID0gbnVsbDsKCiAgICAgICAgICAvLyDnoa7kv50gc2Vzc2lvbi5wYXJ0aWNpcGFudHMg5a2Y5Zyo5LiU5piv5pWw57uECiAgICAgICAgICBpZiAoc2Vzc2lvbi5wYXJ0aWNpcGFudHMgJiYgQXJyYXkuaXNBcnJheShzZXNzaW9uLnBhcnRpY2lwYW50cykgJiYgc2Vzc2lvbi5wYXJ0aWNpcGFudHMubGVuZ3RoID4gMCAmJiB1c2VySW5mby52YWx1ZSkgewogICAgICAgICAgICBvdGhlclBhcnRpY2lwYW50ID0gc2Vzc2lvbi5wYXJ0aWNpcGFudHMuZmluZChwID0+IHAudXNlciAmJiBwLnVzZXIuaWQgIT09IHVzZXJJbmZvLnZhbHVlLmlkKTsKICAgICAgICAgIH0KICAgICAgICAgIGxldCB0ZW1wQ29udGFjdCA9IG51bGw7CgogICAgICAgICAgLy8g5aaC5p6c5piv576k6IGK77yM5L2/55So576k6IGK5L+h5oGvCiAgICAgICAgICBpZiAoc2Vzc2lvbi5pc19ncm91cCkgewogICAgICAgICAgICB0ZW1wQ29udGFjdCA9IHsKICAgICAgICAgICAgICBpZDogcGFyc2VJbnQoY2hhdElkKSwKICAgICAgICAgICAgICBuYW1lOiBzZXNzaW9uLnRpdGxlIHx8ICfnvqTogYonLAogICAgICAgICAgICAgIGluaXRpYWw6IChzZXNzaW9uLnRpdGxlIHx8ICfnvqTogYonKVswXSwKICAgICAgICAgICAgICBhdmF0YXI6ICcnLAogICAgICAgICAgICAgIGF2YXRhcl91cmw6ICcnLAogICAgICAgICAgICAgIGNvbG9yOiBnZXRSYW5kb21Db2xvcihwYXJzZUludChjaGF0SWQpKSwKICAgICAgICAgICAgICBzdGF0dXM6ICdvbmxpbmUnLAogICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IHNlc3Npb24ubGFzdF9tZXNzYWdlLmNvbnRlbnQgOiAnJywKICAgICAgICAgICAgICBsYXN0VGltZTogZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi51cGRhdGVkX2F0KSwKICAgICAgICAgICAgICB1bnJlYWQ6IDAsCiAgICAgICAgICAgICAgaXNHcm91cDogdHJ1ZQogICAgICAgICAgICB9OwogICAgICAgICAgICAvLyDljZXogYrvvIzkvb/nlKjlr7nmlrnkv6Hmga8KICAgICAgICAgIH0gZWxzZSBpZiAob3RoZXJQYXJ0aWNpcGFudCAmJiBvdGhlclBhcnRpY2lwYW50LnVzZXIpIHsKICAgICAgICAgICAgY29uc3QgdXNlciA9IG90aGVyUGFydGljaXBhbnQudXNlcjsKICAgICAgICAgICAgLy8g5aSE55CG5aS05YOP6Lev5b6ECiAgICAgICAgICAgIGxldCBhdmF0YXJfdXJsID0gJyc7CiAgICAgICAgICAgIGlmICh1c2VyLmF2YXRhcikgewogICAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IHVzZXIuYXZhdGFyOwogICAgICAgICAgICAgIGlmIChhdmF0YXIuc3RhcnRzV2l0aCgnaHR0cDovLycpIHx8IGF2YXRhci5zdGFydHNXaXRoKCdodHRwczovLycpKSB7CiAgICAgICAgICAgICAgICBhdmF0YXJfdXJsID0gYXZhdGFyOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoYXZhdGFyLnN0YXJ0c1dpdGgoJy8nKSkgewogICAgICAgICAgICAgICAgYXZhdGFyX3VybCA9IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQkFTRV9BUEkgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6ODAwMCd9JHthdmF0YXJ9YDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYXZhdGFyX3VybCA9IGAke3Byb2Nlc3MuZW52LlZVRV9BUFBfQkFTRV9BUEkgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6ODAwMCd9LyR7YXZhdGFyfWA7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRlbXBDb250YWN0ID0gewogICAgICAgICAgICAgIGlkOiBwYXJzZUludChjaGF0SWQpLAogICAgICAgICAgICAgIG5hbWU6ICgodXNlci5maXJzdF9uYW1lIHx8ICcnKSArICcgJyArICh1c2VyLmxhc3RfbmFtZSB8fCAnJykpLnRyaW0oKSB8fCB1c2VyLnVzZXJuYW1lIHx8ICfmnKrlkb3lkI3ogZTns7vkuronLAogICAgICAgICAgICAgIGluaXRpYWw6ICh1c2VyLmZpcnN0X25hbWUgfHwgdXNlci51c2VybmFtZSB8fCAn5pyq5ZG95ZCN6IGU57O75Lq6JylbMF0sCiAgICAgICAgICAgICAgYXZhdGFyOiB1c2VyLmF2YXRhciB8fCAnJywKICAgICAgICAgICAgICBhdmF0YXJfdXJsOiBhdmF0YXJfdXJsLAogICAgICAgICAgICAgIGNvbG9yOiBnZXRSYW5kb21Db2xvcih1c2VyLmlkKSwKICAgICAgICAgICAgICBzdGF0dXM6ICdvbmxpbmUnLAogICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiBzZXNzaW9uLmxhc3RfbWVzc2FnZSA/IHNlc3Npb24ubGFzdF9tZXNzYWdlLmNvbnRlbnQgOiAnJywKICAgICAgICAgICAgICBsYXN0VGltZTogZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi51cGRhdGVkX2F0KSwKICAgICAgICAgICAgICB1bnJlYWQ6IDAsCiAgICAgICAgICAgICAgaXNHcm91cDogZmFsc2UKICAgICAgICAgICAgfTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIOWmguaenOaXoOazleaJvuWIsOWvueaWueS/oeaBr++8jOS9v+eUqOm7mOiupOWAvAogICAgICAgICAgICB0ZW1wQ29udGFjdCA9IHsKICAgICAgICAgICAgICBpZDogcGFyc2VJbnQoY2hhdElkKSwKICAgICAgICAgICAgICBuYW1lOiBzZXNzaW9uLnRpdGxlIHx8ICfogYrlpKknLAogICAgICAgICAgICAgIGluaXRpYWw6IChzZXNzaW9uLnRpdGxlIHx8ICfogYrlpKknKVswXSwKICAgICAgICAgICAgICBhdmF0YXI6ICcnLAogICAgICAgICAgICAgIGF2YXRhcl91cmw6ICcnLAogICAgICAgICAgICAgIGNvbG9yOiBnZXRSYW5kb21Db2xvcihwYXJzZUludChjaGF0SWQpKSwKICAgICAgICAgICAgICBzdGF0dXM6ICdvbmxpbmUnLAogICAgICAgICAgICAgIGxhc3RNZXNzYWdlOiAnJywKICAgICAgICAgICAgICBsYXN0VGltZTogZm9ybWF0TWVzc2FnZVRpbWUoc2Vzc2lvbi51cGRhdGVkX2F0KSwKICAgICAgICAgICAgICB1bnJlYWQ6IDAsCiAgICAgICAgICAgICAgaXNHcm91cDogc2Vzc2lvbi5pc19ncm91cAogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOa3u+WKoOS4tOaXtuiBlOezu+S6uuWIsOWIl+ihqAogICAgICAgICAgaWYgKHRlbXBDb250YWN0KSB7CiAgICAgICAgICAgIGNvbnRhY3RzLnZhbHVlLnVuc2hpZnQodGVtcENvbnRhY3QpOwogICAgICAgICAgICBjb25zb2xlLmxvZygn5re75Yqg5Li05pe26IGU57O75Lq6OicsIHRlbXBDb250YWN0KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIOabtOaWsOe7hOS7tuaVsOaNrgogICAgICAgIG1lc3NhZ2VzLnZhbHVlID0gbWVzc2FnZURhdGEgfHwgW107CiAgICAgICAgY3VycmVudENoYXRJZC52YWx1ZSA9IHBhcnNlSW50KGNoYXRJZCk7CiAgICAgICAgc2VsZWN0ZWRDb250YWN0LnZhbHVlID0gcGFyc2VJbnQoY2hhdElkKTsKCiAgICAgICAgLy8g5rua5Yqo5Yiw5bqV6YOoCiAgICAgICAgbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgc2Nyb2xsVG9Cb3R0b20oKTsKICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfliqDovb3kvJror53or6bmg4XlpLHotKU6JywgZXJyb3IpOwogICAgICAgIGxldCBlcnJvck1lc3NhZ2UgPSAn5Yqg6L296IGK5aSp5raI5oGv5aSx6LSlJzsKICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UpIHsKICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IGVycm9yLnJlc3BvbnNlLnN0YXR1czsKICAgICAgICAgIGlmIChzdGF0dXMgPT09IDQwNCkgewogICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAn6IGK5aSp5Lya6K+d5LiN5a2Y5Zyo5oiW5bey6KKr5Yig6ZmkJzsKICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSA0MDMpIHsKICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gJ+aXoOadg+iuv+mXruatpOiBiuWkqeS8muivnSc7CiAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yLnJlc3BvbnNlLmRhdGEgJiYgZXJyb3IucmVzcG9uc2UuZGF0YS5tZXNzYWdlKSB7CiAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IGVycm9yLnJlc3BvbnNlLmRhdGEubWVzc2FnZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGVycm9yLm1lc3NhZ2UpIHsKICAgICAgICAgIGVycm9yTWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U7CiAgICAgICAgfQogICAgICAgIEVsTWVzc2FnZS5lcnJvcihlcnJvck1lc3NhZ2UpOwogICAgICAgIG1lc3NhZ2VzLnZhbHVlID0gW107CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgbG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICB9CiAgICB9OwoKICAgIC8vIOWIt+aWsOiBiuWkqeS8muivneWIl+ihqAogICAgY29uc3QgcmVmcmVzaENoYXRTZXNzaW9ucyA9IGFzeW5jICgpID0+IHsKICAgICAgLy8g5pu05paw55So5oi35YiX6KGoCiAgICAgIGF3YWl0IGxvYWRBbGxVc2VycygpOwoKICAgICAgLy8g5pu05paw6IGK5aSp5Lya6K+dCiAgICAgIGF3YWl0IGxvYWRDaGF0U2Vzc2lvbnMoKTsKCiAgICAgIC8vIOWmguaenOacieW9k+WJjeiBiuWkqUlE77yM56Gu5L+d6YCJ5Lit5q2j56Gu55qE6IGU57O75Lq6CiAgICAgIGlmIChjdXJyZW50Q2hhdElkLnZhbHVlKSB7CiAgICAgICAgY29uc3QgY29udGFjdCA9IGNvbnRhY3RzLnZhbHVlLmZpbmQoYyA9PiBjLmlkID09PSBjdXJyZW50Q2hhdElkLnZhbHVlKTsKICAgICAgICBpZiAoY29udGFjdCkgewogICAgICAgICAgc2VsZWN0ZWRDb250YWN0LnZhbHVlID0gY29udGFjdC5pZDsKICAgICAgICB9CiAgICAgIH0KICAgIH07CgogICAgLy8g56Gu5L+d5raI5oGv5a655Zmo5rua5Yqo5Yiw5bqV6YOoCiAgICBjb25zdCBzY3JvbGxUb0JvdHRvbSA9ICgpID0+IHsKICAgICAgaWYgKG1lc3NhZ2VDb250YWluZXIudmFsdWUpIHsKICAgICAgICBtZXNzYWdlQ29udGFpbmVyLnZhbHVlLnNjcm9sbFRvcCA9IG1lc3NhZ2VDb250YWluZXIudmFsdWUuc2Nyb2xsSGVpZ2h0OwogICAgICB9CiAgICB9OwoKICAgIC8vIOWcqOmAieaLqeiBlOezu+S6uuWQju+8jOa7muWKqOWIsOW6lemDqAogICAgY29uc3Qgc2VsZWN0Q29udGFjdCA9IGFzeW5jIGNvbnRhY3QgPT4gewogICAgICAvLyDmo4Dmn6XmmK/lkKblsJ3or5XkuI7oh6rlt7HogYrlpKkKICAgICAgaWYgKCFjb250YWN0LmlzR3JvdXAgJiYgdXNlckluZm8udmFsdWUgJiYgY29udGFjdC51c2VySWQgPT09IHVzZXJJbmZvLnZhbHVlLmlkKSB7CiAgICAgICAgRWxNZXNzYWdlLndhcm5pbmcoJ+S4jeiDveS4juiHquW3seiBiuWkqScpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zb2xlLmxvZygn6YCJ5oup6IGU57O75Lq6OicsIGNvbnRhY3QpOwoKICAgICAgLy8g5aSE55CG5Lik56eN57G75Z6L55qESUTvvJrnjrDmnInlr7nor51JROWSjOeUqOaIt0lE5YmN57yA55qE5oOF5Ya1CiAgICAgIGxldCBjb250YWN0SWQgPSBjb250YWN0LmlkOwoKICAgICAgLy8g5qOA5p+l5piv5ZCm5bey5pyJ6K+l6IGU57O75Lq655qE5a+56K+dCiAgICAgIGlmICh0eXBlb2YgY29udGFjdElkID09PSAnc3RyaW5nJyAmJiBjb250YWN0SWQuc3RhcnRzV2l0aCgndXNlcl8nKSkgewogICAgICAgIC8vIOi/meaYr+ebtOaOpemAieaLqeS6hueUqOaIt++8jOiAjOS4jeaYr+eOsOacieeahOiBiuWkqeS8muivnQogICAgICAgIGxldCB1c2VySWQgPSBjb250YWN0LnVzZXJJZCB8fCBjb250YWN0LmlkLnJlcGxhY2UoJ3VzZXJfJywgJycpOwogICAgICAgIGNvbnNvbGUubG9nKCflsJ3or5Xmn6Xmib7kuI7nlKjmiLfnmoTnjrDmnInlr7nor506JywgdXNlcklkKTsKCiAgICAgICAgLy8g5bCd6K+V5Zyo546w5pyJ5Lya6K+d5Lit5p+l5om+5LiO6K+l55So5oi355qE5a+56K+dCiAgICAgICAgY29uc3QgZXhpc3RpbmdDaGF0ID0gY29udGFjdHMudmFsdWUuZmluZChjID0+ICFjLmlzR3JvdXAgJiYgKGMudXNlcklkICYmIGMudXNlcklkID09IHVzZXJJZCB8fCBjLnVzZXIgJiYgYy51c2VyLmlkID09IHVzZXJJZCkpOwogICAgICAgIGlmIChleGlzdGluZ0NoYXQpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCfmib7liLDkuI7nlKjmiLfnmoTnjrDmnInlr7nor506JywgZXhpc3RpbmdDaGF0KTsKICAgICAgICAgIGNvbnRhY3RJZCA9IGV4aXN0aW5nQ2hhdC5pZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5sb2coJ+acquaJvuWIsOS4jueUqOaIt+eahOeOsOacieWvueivne+8jOWIm+W7uuaWsOWvueivnScpOwoKICAgICAgICAgIC8vIOWIm+W7uuaWsOeahOiBiuWkqeS8muivnQogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KHsKICAgICAgICAgICAgICB1cmw6ICcvYXBpL2NoYXQvc2Vzc2lvbnMvJywKICAgICAgICAgICAgICBtZXRob2Q6ICdwb3N0JywKICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICBwYXJ0aWNpcGFudF9pZHM6IFt1c2VySWRdLAogICAgICAgICAgICAgICAgaXNfZ3JvdXA6IGZhbHNlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY29uc29sZS5sb2coJ+WIm+W7uuS8muivneWTjeW6lDonLCByZXNwb25zZSk7CgogICAgICAgICAgICAvLyDlpITnkIZBUEnlk43lupQKICAgICAgICAgICAgbGV0IG5ld1Nlc3Npb24gPSBudWxsOwogICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YSkgewogICAgICAgICAgICAgIG5ld1Nlc3Npb24gPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmlkKSB7CiAgICAgICAgICAgICAgbmV3U2Vzc2lvbiA9IHJlc3BvbnNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChuZXdTZXNzaW9uICYmIG5ld1Nlc3Npb24uaWQpIHsKICAgICAgICAgICAgICAvLyDliJvlu7rkuLTml7bogZTns7vkurrlr7nosaEKICAgICAgICAgICAgICBjb25zdCB0ZW1wQ29udGFjdCA9IHsKICAgICAgICAgICAgICAgIGlkOiBuZXdTZXNzaW9uLmlkLAogICAgICAgICAgICAgICAgdXNlcklkOiB1c2VySWQsCiAgICAgICAgICAgICAgICBuYW1lOiBjb250YWN0Lm5hbWUsCiAgICAgICAgICAgICAgICBpbml0aWFsOiBjb250YWN0LmluaXRpYWwsCiAgICAgICAgICAgICAgICBhdmF0YXI6IGNvbnRhY3QuYXZhdGFyLAogICAgICAgICAgICAgICAgYXZhdGFyX3VybDogY29udGFjdC5hdmF0YXJfdXJsIHx8ICcnLAogICAgICAgICAgICAgICAgY29sb3I6IGNvbnRhY3QuY29sb3IgfHwgZ2V0UmFuZG9tQ29sb3IodXNlcklkKSwKICAgICAgICAgICAgICAgIHN0YXR1czogJ29ubGluZScsCiAgICAgICAgICAgICAgICBsYXN0TWVzc2FnZTogJycsCiAgICAgICAgICAgICAgICBsYXN0VGltZTogZm9ybWF0TWVzc2FnZVRpbWUobmV3IERhdGUoKSksCiAgICAgICAgICAgICAgICB1bnJlYWQ6IDAsCiAgICAgICAgICAgICAgICBpc0dyb3VwOiBmYWxzZSwKICAgICAgICAgICAgICAgIGRlcGFydG1lbnQ6IGNvbnRhY3QuZGVwYXJ0bWVudAogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIC8vIOa3u+WKoOWIsOiBlOezu+S6uuWIl+ihqAogICAgICAgICAgICAgIGNvbnRhY3RzLnZhbHVlLnVuc2hpZnQodGVtcENvbnRhY3QpOwoKICAgICAgICAgICAgICAvLyDmm7TmlrDpgInkuK3nmoTogZTns7vkuroKICAgICAgICAgICAgICBjb250YWN0SWQgPSBuZXdTZXNzaW9uLmlkOwogICAgICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCflt7LliJvlu7rmlrDnmoTlr7nor50nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+WIm+W7uuS8muivnei/lOWbnuaXoOaViOaVsOaNricpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCfliJvlu7rmlrDkvJror53lpLHotKU6JywgZXJyb3IpOwogICAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+aXoOazleWIm+W7uuaWsOWvueivnTogJyArIChlcnJvci5tZXNzYWdlIHx8ICfmnKrnn6XplJnor68nKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIOWKoOi9vemAieS4reeahOiBlOezu+S6ugogICAgICBzZWxlY3RlZENvbnRhY3QudmFsdWUgPSBjb250YWN0SWQ7CiAgICAgIG1lc3NhZ2VJbnB1dC52YWx1ZSA9ICcnOwogICAgICBtZXNzYWdlcy52YWx1ZSA9IFtdOwoKICAgICAgLy8g5Yqg6L295raI5oGvCiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgbG9hZENoYXRNZXNzYWdlcyhjb250YWN0SWQpOwoKICAgICAgICAvLyDmu5rliqjliLDlupXpg6gKICAgICAgICBuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICBzY3JvbGxUb0JvdHRvbSgpOwogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WKoOi9veiBiuWkqea2iOaBr+Wksei0pTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfml6Dms5XliqDovb3lr7nor53lhoXlrrnvvJonICsgKGVycm9yLm1lc3NhZ2UgfHwgJ+acquefpemUmeivrycpKTsKICAgICAgfQogICAgfTsKCiAgICAvLyDlnKjmtojmga/liJfooajmm7TmlrDlkI7vvIzmu5rliqjliLDlupXpg6gKICAgIHdhdGNoKG1lc3NhZ2VzLCAoKSA9PiB7CiAgICAgIG5leHRUaWNrKCgpID0+IHsKICAgICAgICBzY3JvbGxUb0JvdHRvbSgpOwogICAgICB9KTsKICAgIH0pOwoKICAgIC8vIOWPkemAgea2iOaBrwogICAgY29uc3Qgc2VuZE1lc3NhZ2UgPSBhc3luYyAoKSA9PiB7CiAgICAgIGlmICghbWVzc2FnZUlucHV0LnZhbHVlLnRyaW0oKSB8fCAhY3VycmVudENoYXRJZC52YWx1ZSkgcmV0dXJuOwogICAgICB0cnkgewogICAgICAgIC8vIOajgOafpeW9k+WJjeeUqOaIt+S/oeaBr+aYr+WQpuWtmOWcqAogICAgICAgIGlmICghdXNlckluZm8udmFsdWUgfHwgIXVzZXJJbmZvLnZhbHVlLmlkKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygn5b2T5YmN55So5oi35L+h5oGv5LiN5a2Y5Zyo77yM5bCd6K+V6YeN5paw6I635Y+WLi4uJyk7CiAgICAgICAgICAvLyDlsJ3or5Xph43mlrDojrflj5bnlKjmiLfkv6Hmga8KICAgICAgICAgIGNvbnN0IHVzZXJEYXRhID0gYXdhaXQgZmV0Y2hDdXJyZW50VXNlcigpOwogICAgICAgICAgaWYgKCF1c2VyRGF0YSB8fCAhdXNlckRhdGEuaWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCfml6Dms5Xojrflj5blvZPliY3nlKjmiLfkv6Hmga/vvIzor7fliLfmlrDpobXpnaLph43or5UnKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnNvbGUubG9nKCfmiJDlip/ojrflj5bnlKjmiLfkv6Hmga86JywgdXNlckRhdGEpOwogICAgICAgIH0KCiAgICAgICAgLy8g5Yib5bu65Li05pe25raI5oGv5a+56LGhCiAgICAgICAgLy8g5YaN5qyh5qOA5p+l55So5oi35L+h5oGv5piv5ZCm5bey5pu05pawCiAgICAgICAgaWYgKCF1c2VySW5mby52YWx1ZSB8fCAhdXNlckluZm8udmFsdWUuaWQpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcign55So5oi35L+h5oGv5pyq5pu05paw77yM6K+35Yi35paw6aG16Z2i6YeN6K+VJyk7CiAgICAgICAgfQoKICAgICAgICAvLyDorrDlvZXlvZPliY3kvJror51JRAogICAgICAgIGNvbnNvbGUubG9nKCflvZPliY3kvJror51JRDonLCBjdXJyZW50Q2hhdElkLnZhbHVlLCAn57G75Z6LOicsIHR5cGVvZiBjdXJyZW50Q2hhdElkLnZhbHVlKTsKICAgICAgICBjb25zdCB0ZW1wTWVzc2FnZSA9IHsKICAgICAgICAgIGlkOiAndGVtcC0nICsgRGF0ZS5ub3coKSwKICAgICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2VJbnB1dC52YWx1ZS50cmltKCksCiAgICAgICAgICBzZW5kZXI6IHsKICAgICAgICAgICAgaWQ6IHVzZXJJbmZvLnZhbHVlLmlkLAogICAgICAgICAgICB1c2VybmFtZTogdXNlckluZm8udmFsdWUudXNlcm5hbWUgfHwgJ+eUqOaItycsCiAgICAgICAgICAgIGZpcnN0X25hbWU6IHVzZXJJbmZvLnZhbHVlLmZpcnN0X25hbWUgfHwgJycsCiAgICAgICAgICAgIGxhc3RfbmFtZTogdXNlckluZm8udmFsdWUubGFzdF9uYW1lIHx8ICcnCiAgICAgICAgICB9LAogICAgICAgICAgbWVzc2FnZV90eXBlOiAndGV4dCcsCiAgICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICBpc190ZW1wOiB0cnVlCiAgICAgICAgfTsKCiAgICAgICAgLy8g5YWI5bCG5Li05pe25raI5oGv5re75Yqg5Yiw5YiX6KGo5LitCiAgICAgICAgbWVzc2FnZXMudmFsdWUucHVzaCh0ZW1wTWVzc2FnZSk7CgogICAgICAgIC8vIOa4heepuui+k+WFpeahhgogICAgICAgIGNvbnN0IG1lc3NhZ2VDb3B5ID0gbWVzc2FnZUlucHV0LnZhbHVlOwogICAgICAgIG1lc3NhZ2VJbnB1dC52YWx1ZSA9ICcnOwoKICAgICAgICAvLyDmu5rliqjliLDlupXpg6gKICAgICAgICBhd2FpdCBuZXh0VGljaygpOwogICAgICAgIHNjcm9sbFRvQm90dG9tKCk7CgogICAgICAgIC8vIOivpue7huiusOW9leWPkemAgeS/oeaBrwogICAgICAgIGNvbnNvbGUubG9nKCflh4blpIflj5HpgIHmtojmga/liLDmnI3liqHlmajvvIzkvJror51JRDonLCBjdXJyZW50Q2hhdElkLnZhbHVlLCAn5raI5oGv5YaF5a65OicsIG1lc3NhZ2VDb3B5KTsKICAgICAgICB0cnkgewogICAgICAgICAgLy8g5Y+R6YCB5raI5oGv5Yiw5pyN5Yqh5ZmoCiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHNlbmRUZXh0TWVzc2FnZSh7CiAgICAgICAgICAgIGNoYXQ6IGN1cnJlbnRDaGF0SWQudmFsdWUsCiAgICAgICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2VDb3B5CiAgICAgICAgICB9KTsKICAgICAgICAgIGNvbnNvbGUubG9nKCflj5HpgIHmtojmga/lk43lupQ6JywgcmVzcG9uc2UpOwoKICAgICAgICAgIC8vIOmAguW6lOS4jeWQjOeahOWTjeW6lOagvOW8jwogICAgICAgICAgbGV0IG1lc3NhZ2VEYXRhID0gbnVsbDsKICAgICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5zdWNjZXNzICYmIHJlc3BvbnNlLmRhdGEpIHsKICAgICAgICAgICAgLy8g5qCH5YeG5YyF6KOF5qC85byPOiB7c3VjY2VzczogdHJ1ZSwgZGF0YToge319CiAgICAgICAgICAgIG1lc3NhZ2VEYXRhID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuaWQpIHsKICAgICAgICAgICAgLy8g5YyF5ZCrSUTnmoREUkbmoLzlvI8KICAgICAgICAgICAgbWVzc2FnZURhdGEgPSByZXNwb25zZTsKICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuY2hhdCkgewogICAgICAgICAgICAvLyDmlrBBUEnmoLzlvI86IHtjaGF0LCBjb250ZW50LCBtZXNzYWdlX3R5cGUsIGZpbGUsIC4uLn0KICAgICAgICAgICAgLy8g5p6E6YCg5a6M5pW055qE5raI5oGv5a+56LGhCiAgICAgICAgICAgIG1lc3NhZ2VEYXRhID0gewogICAgICAgICAgICAgIGlkOiByZXNwb25zZS5pZCB8fCAnbXNnLScgKyBEYXRlLm5vdygpLAogICAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmNvbnRlbnQsCiAgICAgICAgICAgICAgbWVzc2FnZV90eXBlOiByZXNwb25zZS5tZXNzYWdlX3R5cGUsCiAgICAgICAgICAgICAgZmlsZTogcmVzcG9uc2UuZmlsZSwKICAgICAgICAgICAgICBjcmVhdGVkX2F0OiByZXNwb25zZS5jcmVhdGVkX2F0IHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgICBzZW5kZXI6IHsKICAgICAgICAgICAgICAgIGlkOiB1c2VySW5mby52YWx1ZS5pZCwKICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB1c2VySW5mby52YWx1ZS51c2VybmFtZSB8fCAn55So5oi3JywKICAgICAgICAgICAgICAgIGZpcnN0X25hbWU6IHVzZXJJbmZvLnZhbHVlLmZpcnN0X25hbWUgfHwgJycsCiAgICAgICAgICAgICAgICBsYXN0X25hbWU6IHVzZXJJbmZvLnZhbHVlLmxhc3RfbmFtZSB8fCAnJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUud2Fybign5peg5rOV6K+G5Yir55qE5raI5oGv5ZON5bqU5qC85byPOicsIHJlc3BvbnNlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCflj5HpgIHmtojmga/lk43lupTmoLzlvI/lvILluLgnKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyDnlKjmnI3liqHlmajov5Tlm57nmoTmtojmga/mm7/mjaLkuLTml7bmtojmga8KICAgICAgICAgIGNvbnN0IHRlbXBJbmRleCA9IG1lc3NhZ2VzLnZhbHVlLmZpbmRJbmRleChtID0+IG0uaWQgPT09IHRlbXBNZXNzYWdlLmlkKTsKICAgICAgICAgIGlmICh0ZW1wSW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgIG1lc3NhZ2VzLnZhbHVlLnNwbGljZSh0ZW1wSW5kZXgsIDEsIG1lc3NhZ2VEYXRhKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1lc3NhZ2VzLnZhbHVlLnB1c2gobWVzc2FnZURhdGEpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOabtOaWsOiBlOezu+S6uuacgOaWsOa2iOaBrwogICAgICAgICAgY29uc3QgY29udGFjdEluZGV4ID0gY29udGFjdHMudmFsdWUuZmluZEluZGV4KGMgPT4gYy5pZCA9PT0gc2VsZWN0ZWRDb250YWN0LnZhbHVlKTsKICAgICAgICAgIGlmIChjb250YWN0SW5kZXggIT09IC0xKSB7CiAgICAgICAgICAgIGNvbnRhY3RzLnZhbHVlW2NvbnRhY3RJbmRleF0ubGFzdE1lc3NhZ2UgPSBtZXNzYWdlQ29weTsKICAgICAgICAgICAgY29udGFjdHMudmFsdWVbY29udGFjdEluZGV4XS5sYXN0VGltZSA9IGZvcm1hdE1lc3NhZ2VUaW1lKG5ldyBEYXRlKCkpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOWGjeasoea7muWKqOWIsOW6lemDqAogICAgICAgICAgYXdhaXQgbmV4dFRpY2soKTsKICAgICAgICAgIHNjcm9sbFRvQm90dG9tKCk7CiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgIC8vIOivpue7huiusOW9leWPkemAgea2iOaBr+mUmeivrwogICAgICAgICAgY29uc29sZS5lcnJvcign5Y+R6YCB5raI5oGvQVBJ6LCD55So5aSx6LSlOicsIGVycm9yKTsKICAgICAgICAgIGlmIChlcnJvci5yZXNwb25zZSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCfplJnor6/nirbmgIHnoIE6JywgZXJyb3IucmVzcG9uc2Uuc3RhdHVzKTsKICAgICAgICAgICAgY29uc29sZS5lcnJvcign6ZSZ6K+v6K+m5oOFOicsIGVycm9yLnJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICBjb25zb2xlLmVycm9yKCfor7fmsYJVUkw6JywgZXJyb3IucmVzcG9uc2UuY29uZmlnLnVybCk7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+ivt+axguaWueazlTonLCBlcnJvci5yZXNwb25zZS5jb25maWcubWV0aG9kKTsKICAgICAgICAgICAgY29uc29sZS5lcnJvcign6K+35rGC5pWw5o2uOicsIGVycm9yLnJlc3BvbnNlLmNvbmZpZy5kYXRhKTsKICAgICAgICAgICAgaWYgKGVycm9yLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7CiAgICAgICAgICAgICAgLy8gNDA06ZSZ6K+v5aSE55CGCiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignQVBJ56uv54K55LiN5a2Y5Zyo77yM5qOA5p+lVVJM6YWN572u5piv5ZCm5q2j56GuJyk7CiAgICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfmtojmga/lj5HpgIHlpLHotKU6IEFQSeerr+eCueS4jeWtmOWcqO+8jOivt+iBlOezu+euoeeQhuWRmCcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93IGVycm9yOyAvLyDlsIbplJnor6/kvKDpgJLnu5nlpJbpg6hjYXRjaAogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBlcnJvcjsgLy8g5bCG6ZSZ6K+v5Lyg6YCS57uZ5aSW6YOoY2F0Y2gKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Y+R6YCB5raI5oGv5aSx6LSlOicsIGVycm9yKTsKCiAgICAgICAgLy8g56e76Zmk5Li05pe25raI5oGvCiAgICAgICAgbWVzc2FnZXMudmFsdWUgPSBtZXNzYWdlcy52YWx1ZS5maWx0ZXIobSA9PiAhbS5pc190ZW1wKTsKCiAgICAgICAgLy8g5bCG5raI5oGv5YaF5a655pS+5Zue6L6T5YWl5qGGCiAgICAgICAgbWVzc2FnZUlucHV0LnZhbHVlID0gZXJyb3Iuc2F2ZWRNZXNzYWdlIHx8IG1lc3NhZ2VJbnB1dC52YWx1ZTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WPkemAgea2iOaBr+Wksei0pe+8jOivt+mHjeivlScpOwogICAgICB9CiAgICB9OwoKICAgIC8vIOaJk+W8gOaWh+S7tuS4iuS8oAogICAgY29uc3Qgb3BlbkZpbGVVcGxvYWQgPSAoKSA9PiB7CiAgICAgIGZpbGVJbnB1dC52YWx1ZS5jbGljaygpOwogICAgfTsKCiAgICAvLyDmiZPlvIDlm77niYfkuIrkvKAKICAgIGNvbnN0IG9wZW5JbWFnZVVwbG9hZCA9ICgpID0+IHsKICAgICAgaW1hZ2VJbnB1dC52YWx1ZS5jbGljaygpOwogICAgfTsKCiAgICAvLyDlpITnkIbmlofku7bkuIrkvKAKICAgIGNvbnN0IGhhbmRsZUZpbGVVcGxvYWQgPSBhc3luYyBldmVudCA9PiB7CiAgICAgIGNvbnN0IGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXNbMF07CiAgICAgIGlmICghZmlsZSB8fCAhY3VycmVudENoYXRJZC52YWx1ZSkgcmV0dXJuOwogICAgICB0cnkgewogICAgICAgIGF3YWl0IHNlbmRGaWxlTWVzc2FnZShjdXJyZW50Q2hhdElkLnZhbHVlLCBg5Y+R6YCB5paH5Lu2OiAke2ZpbGUubmFtZX1gLCBmaWxlKTsKCiAgICAgICAgLy8g6YeN5paw5Yqg6L295raI5oGvCiAgICAgICAgbG9hZENoYXRNZXNzYWdlcyhjdXJyZW50Q2hhdElkLnZhbHVlKTsKCiAgICAgICAgLy8g5riF56m65paH5Lu26L6T5YWlCiAgICAgICAgZXZlbnQudGFyZ2V0LnZhbHVlID0gJyc7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Y+R6YCB5paH5Lu25aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WPkemAgeaWh+S7tuWksei0pScpOwogICAgICB9CiAgICB9OwoKICAgIC8vIOWkhOeQhuWbvueJh+S4iuS8oAogICAgY29uc3QgaGFuZGxlSW1hZ2VVcGxvYWQgPSBhc3luYyBldmVudCA9PiB7CiAgICAgIGNvbnN0IGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXNbMF07CiAgICAgIGlmICghZmlsZSB8fCAhY3VycmVudENoYXRJZC52YWx1ZSkgcmV0dXJuOwogICAgICB0cnkgewogICAgICAgIGF3YWl0IHNlbmRJbWFnZU1lc3NhZ2UoY3VycmVudENoYXRJZC52YWx1ZSwgYOWPkemAgeWbvueJh2AsIGZpbGUpOwoKICAgICAgICAvLyDph43mlrDliqDovb3mtojmga8KICAgICAgICBsb2FkQ2hhdE1lc3NhZ2VzKGN1cnJlbnRDaGF0SWQudmFsdWUpOwoKICAgICAgICAvLyDmuIXnqbrmlofku7bovpPlhaUKICAgICAgICBldmVudC50YXJnZXQudmFsdWUgPSAnJzsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCflj5HpgIHlm77niYflpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Y+R6YCB5Zu+54mH5aSx6LSlJyk7CiAgICAgIH0KICAgIH07CgogICAgLy8g5omT5byA55+l6K+G5bqT5a+56K+d5qGGCiAgICBjb25zdCBvcGVuS25vd2xlZGdlRGlhbG9nID0gYXN5bmMgKCkgPT4gewogICAgICBrbm93bGVkZ2VEaWFsb2dWaXNpYmxlLnZhbHVlID0gdHJ1ZTsKICAgICAgYXdhaXQgbG9hZEtub3dsZWRnZUxpc3QoKTsKICAgIH07CgogICAgLy8g5Yqg6L2955+l6K+G5bqT5YiX6KGoCiAgICBjb25zdCBsb2FkS25vd2xlZGdlTGlzdCA9IGFzeW5jICgpID0+IHsKICAgICAgdHJ5IHsKICAgICAgICBrbm93bGVkZ2VMb2FkaW5nLnZhbHVlID0gdHJ1ZTsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBkYXRhCiAgICAgICAgfSA9IGF3YWl0IGdldEtub3dsZWRnZUxpc3QoKTsKICAgICAgICBrbm93bGVkZ2VMaXN0LnZhbHVlID0gZGF0YTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfliqDovb3nn6Xor4blupPliJfooajlpLHotKU6JywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Yqg6L2955+l6K+G5bqT5YiX6KGo5aSx6LSlJyk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAga25vd2xlZGdlTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICB9CiAgICB9OwoKICAgIC8vIOmAieaLqeefpeivhuW6k+aWh+S7tgogICAgY29uc3Qgc2VsZWN0S25vd2xlZGdlID0gcm93ID0+IHsKICAgICAgc2VsZWN0ZWRLbm93bGVkZ2UudmFsdWUgPSByb3c7CiAgICB9OwoKICAgIC8vIOWIhuS6q+efpeivhuW6k+aWh+S7tgogICAgY29uc3Qgc2hhcmVLbm93bGVkZ2UgPSBhc3luYyBrbm93bGVkZ2UgPT4gewogICAgICBpZiAoIWN1cnJlbnRDaGF0SWQudmFsdWUpIHJldHVybjsKICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCBzZW5kS25vd2xlZGdlTWVzc2FnZShjdXJyZW50Q2hhdElkLnZhbHVlLCBg5YiG5Lqr55+l6K+G5bqT5paH5Lu2OiAke2tub3dsZWRnZS50aXRsZX1gLCBrbm93bGVkZ2UuaWQpOwoKICAgICAgICAvLyDlhbPpl63lr7nor53moYYKICAgICAgICBrbm93bGVkZ2VEaWFsb2dWaXNpYmxlLnZhbHVlID0gZmFsc2U7CgogICAgICAgIC8vIOmHjeaWsOWKoOi9vea2iOaBrwogICAgICAgIGxvYWRDaGF0TWVzc2FnZXMoY3VycmVudENoYXRJZC52YWx1ZSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5YiG5Lqr55+l6K+G5bqT5paH5Lu25aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WIhuS6q+efpeivhuW6k+aWh+S7tuWksei0pScpOwogICAgICB9CiAgICB9OwoKICAgIC8vIOS4i+i9veaWh+S7tgogICAgY29uc3QgZG93bmxvYWRGaWxlID0gYXN5bmMgbWVzc2FnZSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBkb3dubG9hZE1lc3NhZ2VGaWxlKG1lc3NhZ2UuaWQpOwoKICAgICAgICAvLyDliJvlu7rkuIvovb3pk77mjqUKICAgICAgICBjb25zdCB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbcmVzcG9uc2UuZGF0YV0pKTsKICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgIGxpbmsuaHJlZiA9IHVybDsKICAgICAgICBsaW5rLnNldEF0dHJpYnV0ZSgnZG93bmxvYWQnLCBtZXNzYWdlLmZpbGVfbmFtZSB8fCAnZG93bmxvYWQnKTsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOwogICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+S4i+i9veaWh+S7tuWksei0pTonLCBlcnJvcik7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfkuIvovb3mlofku7blpLHotKUnKTsKICAgICAgfQogICAgfTsKCiAgICAvLyDmn6XnnIvnn6Xor4blupPmlofku7YKICAgIGNvbnN0IHZpZXdLbm93bGVkZ2UgPSBtZXNzYWdlID0+IHsKICAgICAgaWYgKG1lc3NhZ2Uua25vd2xlZGdlX2RldGFpbCkgewogICAgICAgIC8vIOWPr+S7pei3s+i9rOWIsOefpeivhuW6k+ivpuaDhemhtemdogogICAgICAgIEVsTWVzc2FnZUJveC5hbGVydChg5qCH6aKYOiAke21lc3NhZ2Uua25vd2xlZGdlX2RldGFpbC50aXRsZX08YnI+5o+P6L+wOiAke21lc3NhZ2Uua25vd2xlZGdlX2RldGFpbC5kZXNjcmlwdGlvbiB8fCAn5pegJ31gLCAn55+l6K+G5bqT5paH5Lu2JywgewogICAgICAgICAgZGFuZ2Vyb3VzbHlVc2VIVE1MU3RyaW5nOiB0cnVlLAogICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICfnoa7lrponCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgLy8g6I635Y+W5Y+R6YCB6ICF6aKc6ImyCiAgICBjb25zdCBnZXRTZW5kZXJDb2xvciA9IHNlbmRlciA9PiB7CiAgICAgIHJldHVybiBnZXRSYW5kb21Db2xvcihzZW5kZXIuaWQpOwogICAgfTsKCiAgICAvLyDojrflj5blj5HpgIHogIXpppblrZfmr40KICAgIGNvbnN0IGdldFNlbmRlckluaXRpYWwgPSBzZW5kZXIgPT4gewogICAgICByZXR1cm4gKHNlbmRlci5maXJzdF9uYW1lIHx8IHNlbmRlci51c2VybmFtZSlbMF07CiAgICB9OwoKICAgIC8vIOagueaNrklE55Sf5oiQ6ZqP5py66aKc6ImyCiAgICBjb25zdCBnZXRSYW5kb21Db2xvciA9IGlkID0+IHsKICAgICAgY29uc3QgY29sb3JzID0gWycjMDA3YmZmJywgJyMyOGE3NDUnLCAnI2RjMzU0NScsICcjZmQ3ZTE0JywgJyM2ZjQyYzEnLCAnIzIwYzk5NycsICcjMTdhMmI4JywgJyM2Yzc1N2QnXTsKCiAgICAgIC8vIOS9v+eUqElE5L2c5Li657Si5byV77yM56Gu5L+d5ZCM5LiA55So5oi36aKc6Imy5LiA6Ie0CiAgICAgIGNvbnN0IGluZGV4ID0gdHlwZW9mIGlkID09PSAnbnVtYmVyJyA/IGlkICUgY29sb3JzLmxlbmd0aCA6IDA7CiAgICAgIHJldHVybiBjb2xvcnNbaW5kZXhdOwogICAgfTsKCiAgICAvLyDmoLzlvI/ljJbmtojmga/ml7bpl7QKICAgIGNvbnN0IGZvcm1hdE1lc3NhZ2VUaW1lID0gdGltZXN0YW1wID0+IHsKICAgICAgaWYgKCF0aW1lc3RhbXApIHJldHVybiAnJzsKICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHRpbWVzdGFtcCk7CiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7CiAgICAgIGNvbnN0IGRpZmYgPSBub3cgLSBkYXRlOwoKICAgICAgLy8g5LuK5aSp5YaF55qE5raI5oGv5pi+56S65pe26Ze0CiAgICAgIGlmIChkaWZmIDwgMjQgKiA2MCAqIDYwICogMTAwMCkgewogICAgICAgIGNvbnN0IGhvdXJzID0gZGF0ZS5nZXRIb3VycygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTsKICAgICAgICBjb25zdCBtaW51dGVzID0gZGF0ZS5nZXRNaW51dGVzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpOwogICAgICAgIHJldHVybiBgJHtob3Vyc306JHttaW51dGVzfWA7CiAgICAgIH0KCiAgICAgIC8vIOS4gOWRqOWGheeahOa2iOaBr+aYvuekuuaYn+acn+WHoAogICAgICBpZiAoZGlmZiA8IDcgKiAyNCAqIDYwICogNjAgKiAxMDAwKSB7CiAgICAgICAgY29uc3QgZGF5cyA9IFsn5ZGo5pelJywgJ+WRqOS4gCcsICflkajkuownLCAn5ZGo5LiJJywgJ+WRqOWbmycsICflkajkupQnLCAn5ZGo5YWtJ107CiAgICAgICAgcmV0dXJuIGRheXNbZGF0ZS5nZXREYXkoKV07CiAgICAgIH0KCiAgICAgIC8vIOabtOaXqeeahOa2iOaBr+aYvuekuuaXpeacnwogICAgICByZXR1cm4gYCR7ZGF0ZS5nZXRNb250aCgpICsgMX3mnIgke2RhdGUuZ2V0RGF0ZSgpfeaXpWA7CiAgICB9OwoKICAgIC8vIOagvOW8j+WMluaXpeacnwogICAgY29uc3QgZm9ybWF0RGF0ZSA9IHRpbWVzdGFtcCA9PiB7CiAgICAgIGlmICghdGltZXN0YW1wKSByZXR1cm4gJyc7CiAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh0aW1lc3RhbXApOwogICAgICByZXR1cm4gYCR7ZGF0ZS5nZXRGdWxsWWVhcigpfS0keyhkYXRlLmdldE1vbnRoKCkgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9LSR7ZGF0ZS5nZXREYXRlKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpfWA7CiAgICB9OwoKICAgIC8vIOagvOW8j+WMluaWh+S7tuWkp+WwjwogICAgY29uc3QgZm9ybWF0RmlsZVNpemUgPSBzaXplSW5LQiA9PiB7CiAgICAgIGlmIChzaXplSW5LQiA8IDEwMjQpIHsKICAgICAgICByZXR1cm4gYCR7c2l6ZUluS0J9IEtCYDsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gYCR7KHNpemVJbktCIC8gMTAyNCkudG9GaXhlZCgyKX0gTUJgOwogICAgICB9CiAgICB9OwoKICAgIC8vIOiOt+WPlueKtuaAgeaWh+WtlwogICAgY29uc3QgZ2V0U3RhdHVzVGV4dCA9IHN0YXR1cyA9PiB7CiAgICAgIGNvbnN0IHN0YXR1c01hcCA9IHsKICAgICAgICAnb25saW5lJzogJ+WcqOe6vycsCiAgICAgICAgJ29mZmxpbmUnOiAn56a757q/JywKICAgICAgICAnYnVzeSc6ICflv5nnoownLAogICAgICAgICdhd2F5JzogJ+emu+W8gCcKICAgICAgfTsKICAgICAgcmV0dXJuIHN0YXR1c01hcFtzdGF0dXNdIHx8IHN0YXR1czsKICAgIH07CgogICAgLy8g5re75Yqg5by65Yi25Yi35paw5pa55rOVCiAgICBjb25zdCBmb3JjZVJlZnJlc2ggPSBhc3luYyAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgRWxNZXNzYWdlLmluZm8oJ+ato+WcqOW8uuWItuWIt+aWsOaVsOaNri4uLicpOwoKICAgICAgICAvLyDph43mlrDojrflj5bnlKjmiLfkv6Hmga8KICAgICAgICBjb25zdCB1c2VyRGF0YSA9IGF3YWl0IGZldGNoQ3VycmVudFVzZXIoKTsKICAgICAgICBpZiAoIXVzZXJEYXRhKSB7CiAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+aXoOazleiOt+WPlueUqOaIt+S/oeaBr++8jOivt+WwneivlemHjeaWsOeZu+W9lScpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g6YeN5paw5Yqg6L296IGK5aSp5Lya6K+dCiAgICAgICAgYXdhaXQgbG9hZENoYXRTZXNzaW9ucygpOwogICAgICAgIGlmIChjb250YWN0cy52YWx1ZS5sZW5ndGggPT09IDApIHsKICAgICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfmnKrmib7liLDku7vkvZXogYrlpKnkvJror53vvIzmgqjlj6/og73ov5jmsqHmnInlvIDlp4vku7vkvZXlr7nor50nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+WIt+aWsOaIkOWKn++8geaJvuWIsCAnICsgY29udGFjdHMudmFsdWUubGVuZ3RoICsgJyDkuKrogYrlpKnkvJror50nKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5by65Yi25Yi35paw5aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WIt+aWsOWksei0pTogJyArIChlcnJvci5tZXNzYWdlIHx8ICfmnKrnn6XplJnor68nKSk7CiAgICAgIH0KICAgIH07CgogICAgLy8g5Yqg6L295omA5pyJ55So5oi3CiAgICBjb25zdCBsb2FkQWxsVXNlcnMgPSBhc3luYyAoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc29sZS5sb2coJ+ato+WcqOWKoOi9veaJgOacieeUqOaIt+WIl+ihqC4uLicpOwoKICAgICAgICAvLyDlsJ3or5Xnm7TmjqXojrflj5bmiYDmnInnlKjmiLfvvIzkuI3pnIDopoHlhazlj7hJRAogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zb2xlLmxvZygn5bCd6K+V55u05o6l6I635Y+W5omA5pyJ55So5oi3Li4uJyk7CiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoewogICAgICAgICAgICB1cmw6ICcvYXBpL2F1dGgvdXNlcnMvJywKICAgICAgICAgICAgbWV0aG9kOiAnZ2V0JwogICAgICAgICAgfSk7CiAgICAgICAgICBjb25zb2xlLmxvZygn55So5oi3QVBJ5ZON5bqUOicsIHJlc3BvbnNlKTsKCiAgICAgICAgICAvLyDlpITnkIblk43lupTmlbDmja4KICAgICAgICAgIGxldCB1c2VycyA9IFtdOwogICAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLnJlc3VsdHMpIHsKICAgICAgICAgICAgdXNlcnMgPSByZXNwb25zZS5yZXN1bHRzOwogICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHJlc3BvbnNlKSkgewogICAgICAgICAgICB1c2VycyA9IHJlc3BvbnNlOwogICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlc3BvbnNlLmRhdGEpKSB7CiAgICAgICAgICAgICAgdXNlcnMgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLmRhdGEucmVzdWx0cykgewogICAgICAgICAgICAgIHVzZXJzID0gcmVzcG9uc2UuZGF0YS5yZXN1bHRzOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodXNlcnMgJiYgdXNlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBjb25zb2xlLmxvZyhg5oiQ5Yqf6I635Y+W5YiwJHt1c2Vycy5sZW5ndGh95Liq55So5oi3YCk7CiAgICAgICAgICAgIGFsbENvbGxlYWd1ZXMudmFsdWUgPSB1c2VyczsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfojrflj5bnlKjmiLfliJfooajlpLHotKU6JywgZXJyb3IpOwogICAgICAgIH0KCiAgICAgICAgLy8g5aaC5p6c55u05o6l6I635Y+W5aSx6LSl77yM5L2/55So5qih5ouf5pWw5o2uCiAgICAgICAgY29uc29sZS53YXJuKCdBUEnojrflj5bnlKjmiLfliJfooajlpLHotKXvvIzkvb/nlKjmqKHmi5/mlbDmja4nKTsKICAgICAgICBhbGxDb2xsZWFndWVzLnZhbHVlID0gW3sKICAgICAgICAgIGlkOiAxLAogICAgICAgICAgdXNlcm5hbWU6ICd6aGFuZ3NhbicsCiAgICAgICAgICBmaXJzdF9uYW1lOiAn5bygJywKICAgICAgICAgIGxhc3RfbmFtZTogJ+S4iScsCiAgICAgICAgICBkZXBhcnRtZW50OiAn5oqA5pyv6YOoJywKICAgICAgICAgIGF2YXRhcjogJycKICAgICAgICB9LCB7CiAgICAgICAgICBpZDogMiwKICAgICAgICAgIHVzZXJuYW1lOiAnbGlzaScsCiAgICAgICAgICBmaXJzdF9uYW1lOiAn5p2OJywKICAgICAgICAgIGxhc3RfbmFtZTogJ+WbmycsCiAgICAgICAgICBkZXBhcnRtZW50OiAn5biC5Zy66YOoJywKICAgICAgICAgIGF2YXRhcjogJycKICAgICAgICB9LCB7CiAgICAgICAgICBpZDogMywKICAgICAgICAgIHVzZXJuYW1lOiAnd2FuZ3d1JywKICAgICAgICAgIGZpcnN0X25hbWU6ICfnjosnLAogICAgICAgICAgbGFzdF9uYW1lOiAn5LqUJywKICAgICAgICAgIGRlcGFydG1lbnQ6ICfotKLliqHpg6gnLAogICAgICAgICAgYXZhdGFyOiAnJwogICAgICAgIH0sIHsKICAgICAgICAgIGlkOiA0LAogICAgICAgICAgdXNlcm5hbWU6ICd6aGFvbGl1JywKICAgICAgICAgIGZpcnN0X25hbWU6ICfotbUnLAogICAgICAgICAgbGFzdF9uYW1lOiAn5YWtJywKICAgICAgICAgIGRlcGFydG1lbnQ6ICcnLAogICAgICAgICAgYXZhdGFyOiAnJwogICAgICAgIH1dOwogICAgICAgIGNvbnNvbGUubG9nKCflt7LliqDovb3mqKHmi5/mlbDmja4nKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCfliqDovb3nlKjmiLfliJfooajov4fnqIvkuK3lh7rplJk6JywgZXJyb3IpOwogICAgICAgIC8vIOehruS/neaIkeS7rOiHs+WwkeacieS4gOS6m+aVsOaNrgogICAgICAgIGFsbENvbGxlYWd1ZXMudmFsdWUgPSBbewogICAgICAgICAgaWQ6IDEsCiAgICAgICAgICB1c2VybmFtZTogJ3VzZXIxJywKICAgICAgICAgIGZpcnN0X25hbWU6ICfnlKjmiLcnLAogICAgICAgICAgbGFzdF9uYW1lOiAnMScsCiAgICAgICAgICBkZXBhcnRtZW50OiAn5oqA5pyv6YOoJwogICAgICAgIH0sIHsKICAgICAgICAgIGlkOiAyLAogICAgICAgICAgdXNlcm5hbWU6ICd1c2VyMicsCiAgICAgICAgICBmaXJzdF9uYW1lOiAn55So5oi3JywKICAgICAgICAgIGxhc3RfbmFtZTogJzInLAogICAgICAgICAgZGVwYXJ0bWVudDogJ+W4guWcuumDqCcKICAgICAgICB9LCB7CiAgICAgICAgICBpZDogMywKICAgICAgICAgIHVzZXJuYW1lOiAndXNlcjMnLAogICAgICAgICAgZmlyc3RfbmFtZTogJ+eUqOaItycsCiAgICAgICAgICBsYXN0X25hbWU6ICczJywKICAgICAgICAgIGRlcGFydG1lbnQ6ICfotKLliqHpg6gnCiAgICAgICAgfSwgewogICAgICAgICAgaWQ6IDQsCiAgICAgICAgICB1c2VybmFtZTogJ3VzZXI0JywKICAgICAgICAgIGZpcnN0X25hbWU6ICfnlKjmiLcnLAogICAgICAgICAgbGFzdF9uYW1lOiAnNCcsCiAgICAgICAgICBkZXBhcnRtZW50OiAnJwogICAgICAgIH1dOwogICAgICB9CiAgICB9OwoKICAgIC8vIOaXpeeoi+S6i+S7tuebuOWFswogICAgY29uc3QgaGlkZGVuQ2FsZW5kYXJFdmVudHMgPSByZWYoW10pOwoKICAgIC8vIOWkhOeQhuaXpeeoi+S6i+S7tua3u+WKoOaIkOWKnwogICAgY29uc3QgaGFuZGxlQ2FsZW5kYXJFdmVudEFkZGVkID0gKCkgPT4gewogICAgICAvLyDlj6/ku6XlnKjov5nph4zlgZrkuIDkupvpop3lpJblpITnkIbvvIzkvovlpoLpgJrnn6Xlhbbku5bkurrnrYkKICAgIH07CgogICAgLy8g5aSE55CG5pel56iL5LqL5Lu26ZqQ6JePCiAgICBjb25zdCBoYW5kbGVDYWxlbmRhckV2ZW50SGlkZGVuID0gbWVzc2FnZUlkID0+IHsKICAgICAgaGlkZGVuQ2FsZW5kYXJFdmVudHMudmFsdWUucHVzaChtZXNzYWdlSWQpOwogICAgfTsKICAgIHJldHVybiB7CiAgICAgIHNlYXJjaFF1ZXJ5LAogICAgICBhY3RpdmVUYWIsCiAgICAgIHNlbGVjdGVkQ29udGFjdCwKICAgICAgdGFicywKICAgICAgY29udGFjdHMsCiAgICAgIGN1cnJlbnRDb250YWN0LAogICAgICBmaWx0ZXJlZENvbnRhY3RzLAogICAgICBtZXNzYWdlcywKICAgICAgbWVzc2FnZUlucHV0LAogICAgICBtZXNzYWdlQ29udGFpbmVyLAogICAgICBmaWxlSW5wdXQsCiAgICAgIGltYWdlSW5wdXQsCiAgICAgIGN1cnJlbnRVc2VyLAogICAgICB1c2VySW5mbywKICAgICAgdXNlcklkLAogICAgICBrbm93bGVkZ2VEaWFsb2dWaXNpYmxlLAogICAgICBrbm93bGVkZ2VMb2FkaW5nLAogICAgICBrbm93bGVkZ2VMaXN0LAogICAgICBsb2FkaW5nLAogICAgICAvLyDlm77moIcKICAgICAgU2VhcmNoLAogICAgICBQaG9uZSwKICAgICAgVmlkZW9DYW1lcmEsCiAgICAgIEluZm9GaWxsZWQsCiAgICAgIERvY3VtZW50LAogICAgICBQaWN0dXJlRmlsbGVkLAogICAgICBGb2xkZXJPcGVuZWQsCiAgICAgIE1pY3JvcGhvbmUsCiAgICAgIFBvc2l0aW9uLAogICAgICBDaGF0RG90U3F1YXJlLAogICAgICBSZWFkaW5nLAogICAgICBVc2VyRmlsbGVkLAogICAgICBDaGF0TGluZVNxdWFyZSwKICAgICAgUmVmcmVzaCwKICAgICAgTW9yZUZpbGxlZCwKICAgICAgLy8g5pa55rOVCiAgICAgIHNlbmRNZXNzYWdlLAogICAgICBnZXRTdGF0dXNUZXh0LAogICAgICBzZWxlY3RDb250YWN0LAogICAgICBvcGVuRmlsZVVwbG9hZCwKICAgICAgb3BlbkltYWdlVXBsb2FkLAogICAgICBoYW5kbGVGaWxlVXBsb2FkLAogICAgICBoYW5kbGVJbWFnZVVwbG9hZCwKICAgICAgb3Blbktub3dsZWRnZURpYWxvZywKICAgICAgc2VsZWN0S25vd2xlZGdlLAogICAgICBzaGFyZUtub3dsZWRnZSwKICAgICAgZG93bmxvYWRGaWxlLAogICAgICB2aWV3S25vd2xlZGdlLAogICAgICBnZXRTZW5kZXJDb2xvciwKICAgICAgZ2V0U2VuZGVySW5pdGlhbCwKICAgICAgZm9ybWF0TWVzc2FnZVRpbWUsCiAgICAgIGZvcm1hdERhdGUsCiAgICAgIGZvcm1hdEZpbGVTaXplLAogICAgICByZWZyZXNoQ2hhdFNlc3Npb25zLAogICAgICBmb3JjZVJlZnJlc2gsCiAgICAgIGdyb3VwZWRVc2Vyc0J5RGVwYXJ0bWVudCwKICAgICAgZ2V0QWN0aXZlQ29udGFjdHMsCiAgICAgIGxvYWRBbGxVc2VycywKICAgICAgaGlkZGVuQ2FsZW5kYXJFdmVudHMsCiAgICAgIGhhbmRsZUNhbGVuZGFyRXZlbnRBZGRlZCwKICAgICAgaGFuZGxlQ2FsZW5kYXJFdmVudEhpZGRlbgogICAgfTsKICB9Cn07"},{"version":3,"names":["ref","computed","nextTick","onMounted","onBeforeUnmount","watch","useStore","ElMessage","ElMessageBox","Search","Phone","VideoCamera","InfoFilled","Document","PictureFilled","FolderOpened","Microphone","Position","ChatDotSquare","Reading","UserFilled","ChatLineSquare","Refresh","MoreFilled","getChatSessions","getChatSession","sendTextMessage","sendFileMessage","sendImageMessage","sendKnowledgeMessage","downloadMessageFile","getKnowledgeList","useRoute","request","ChatCalendarEvent","name","components","setup","store","currentUser","getters","user","userInfo","searchQuery","activeTab","selectedContact","messageInput","messageContainer","fileInput","imageInput","messages","loading","chatSessions","currentChatId","knowledgeDialogVisible","knowledgeLoading","knowledgeList","selectedKnowledge","tabs","contacts","allColleagues","currentContact","value","find","c","id","userId","_userInfo$value","filteredContacts","filter","contact","toLowerCase","includes","getActiveContacts","isGroup","groupedUsersByDepartment","usersMap","Map","forEach","set","colleague","has","first_name","last_name","trim","username","initial","avatar","color","getRandomColor","status","lastMessage","lastTime","unread","department","groupedUsers","Array","from","values","departmentName","push","route","refreshInterval","clearInterval","userData","fetchCurrentUser","error","console","log","loadAllUsers","loadChatSessions","sessionId","query","session","foundContact","parseInt","loadChatMessages","setInterval","scrollToBottom","message","token","localStorage","getItem","warn","warning","response","url","method","data","Error","setItem","JSON","stringify","success","isArray","results","length","map","otherParticipant","participants","p","is_group","title","avatar_url","last_message","content","formatMessageTime","created_at","updated_at","unread_count","startsWith","process","env","VUE_APP_BASE_API","sort","a","b","chatId","messageData","sessionData","possibleMessageFields","field","sender","some","tempContact","unshift","errorMessage","refreshChatSessions","scrollTop","scrollHeight","selectContact","contactId","replace","existingChat","participant_ids","newSession","Date","sendMessage","tempMessage","now","message_type","toISOString","is_temp","messageCopy","chat","file","tempIndex","findIndex","m","splice","contactIndex","config","savedMessage","openFileUpload","click","openImageUpload","handleFileUpload","event","target","files","handleImageUpload","openKnowledgeDialog","loadKnowledgeList","selectKnowledge","row","shareKnowledge","knowledge","downloadFile","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","file_name","body","appendChild","removeChild","viewKnowledge","knowledge_detail","alert","description","dangerouslyUseHTMLString","confirmButtonText","getSenderColor","getSenderInitial","colors","index","timestamp","date","diff","hours","getHours","toString","padStart","minutes","getMinutes","days","getDay","getMonth","getDate","formatDate","getFullYear","formatFileSize","sizeInKB","toFixed","getStatusText","statusMap","forceRefresh","info","users","hiddenCalendarEvents","handleCalendarEventAdded","handleCalendarEventHidden","messageId"],"sources":["C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\chat\\Index.vue"],"sourcesContent":["<template>\n  <div class=\"chat-container\">\n        <el-card class=\"chat-card\">\n          <div class=\"chat-header-actions\" v-if=\"loading\">\n            <el-alert\n              title=\"正在加载数据...\"\n              type=\"info\"\n              :closable=\"false\"\n              show-icon\n            />\n          </div>\n          <div class=\"chat-layout\">\n            <!-- 左侧联系人列表 -->\n            <div class=\"chat-sidebar\">\n              <!-- 搜索框 -->\n              <div class=\"search-box\">\n                <div class=\"search-header\">\n                  <el-input \n                    v-model=\"searchQuery\" \n                    placeholder=\"搜索联系人...\"\n                    clearable\n                    :prefix-icon=\"Search\"\n                  ></el-input>\n                  <el-button circle size=\"small\" @click=\"refreshChatSessions\" title=\"刷新列表\">\n                    <el-icon><Refresh /></el-icon>\n                  </el-button>\n                </div>\n              </div>\n              \n              <!-- 聊天标签页 -->\n              <div class=\"chat-tabs\">\n                <div \n                  v-for=\"(tab, index) in tabs\" \n                  :key=\"index\"\n                  class=\"chat-tab\"\n                  :class=\"{'active': activeTab === index}\"\n                  @click=\"activeTab = index\"\n                >\n                  {{ tab }}\n                </div>\n              </div>\n              \n              <!-- 联系人列表 -->\n              <div class=\"contacts-list\">\n                <!-- 部门分组显示 (仅在同事标签页显示) -->\n                <template v-if=\"activeTab === 1\">\n                  <div v-if=\"!loading && Object.keys(groupedUsersByDepartment).length > 0\">\n                    <div v-for=\"(departmentUsers, deptName) in groupedUsersByDepartment\" :key=\"deptName\" class=\"department-group\">\n                      <div class=\"department-header\">{{ deptName }}</div>\n                      <div \n                        v-for=\"contact in departmentUsers\" \n                        :key=\"contact.id\"\n                        class=\"contact-item\"\n                        :class=\"{'active': selectedContact === contact.id}\"\n                        @click=\"selectContact(contact)\"\n                      >\n                        <div class=\"contact-avatar\">\n                          <div \n                            v-if=\"!contact.avatar && !contact.avatar_url\" \n                            class=\"avatar\" \n                            :style=\"{backgroundColor: contact.color}\"\n                          >\n                            <span class=\"avatar-initial\">{{ contact.initial }}</span>\n                          </div>\n                          <img v-else :src=\"contact.avatar_url || contact.avatar\" alt=\"avatar\" class=\"avatar\" />\n                          <div \n                            class=\"contact-status\" \n                            :class=\"'status-' + contact.status\"\n                          ></div>\n                        </div>\n                        <div class=\"contact-info\">\n                          <div class=\"contact-name\">\n                            <span>{{ contact.name }}</span>\n                            <span class=\"time\">{{ contact.lastTime }}</span>\n                          </div>\n                          <div class=\"contact-message\">\n                            <span>{{ contact.lastMessage }}</span>\n                            <el-badge \n                              v-if=\"contact.unread\" \n                              :value=\"contact.unread\" \n                              class=\"message-badge\"\n                            />\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div v-else-if=\"!loading\" class=\"loading-container\">\n                    <el-skeleton :rows=\"5\" animated />\n                  </div>\n                </template>\n                \n                <!-- 最近聊天标签页 -->\n                <template v-else>\n                  <div \n                    v-for=\"contact in filteredContacts\" \n                    :key=\"contact.id\"\n                    class=\"contact-item\"\n                    :class=\"{'active': selectedContact === contact.id}\"\n                    @click=\"selectContact(contact)\"\n                  >\n                    <div class=\"contact-avatar\">\n                      <div \n                        v-if=\"!contact.avatar && !contact.avatar_url\" \n                        class=\"avatar\" \n                        :style=\"{backgroundColor: contact.color}\"\n                      >\n                        <span class=\"avatar-initial\">{{ contact.initial }}</span>\n                      </div>\n                      <img v-else :src=\"contact.avatar_url || contact.avatar\" alt=\"avatar\" class=\"avatar\" />\n                      <div \n                        class=\"contact-status\" \n                        :class=\"'status-' + contact.status\"\n                      ></div>\n                    </div>\n                    <div class=\"contact-info\">\n                      <div class=\"contact-name\">\n                        <span>{{ contact.name }}</span>\n                        <span class=\"time\">{{ contact.lastTime }}</span>\n                      </div>\n                      <div class=\"contact-message\">\n                        <span>{{ contact.lastMessage }}</span>\n                        <el-badge \n                          v-if=\"contact.unread\" \n                          :value=\"contact.unread\" \n                          class=\"message-badge\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <!-- 在最近聊天标签页，如果没有聊天记录，显示提示 -->\n                  <div v-if=\"!loading && filteredContacts.length === 0\" class=\"empty-contacts\">\n                    <el-empty \n                      description=\"暂无联系人\" \n                      :image-size=\"100\"\n                    >\n                      <template #image>\n                        <el-icon :size=\"64\" class=\"empty-icon\"><UserFilled /></el-icon>\n                      </template>\n                    </el-empty>\n                  </div>\n                </template>\n\n                <!-- 无联系人提示 -->\n                <div v-if=\"loading\" class=\"loading-container\">\n                  <el-skeleton :rows=\"5\" animated />\n                </div>\n              </div>\n            </div>\n            \n            <!-- 右侧聊天内容 -->\n            <div class=\"chat-content\">\n              <!-- 聊天头部 -->\n              <div class=\"chat-header\" v-if=\"selectedContact !== null\">\n                <div class=\"contact-avatar\">\n                  <div \n                    v-if=\"!currentContact.avatar && !currentContact.avatar_url\" \n                    class=\"avatar\" \n                    :style=\"{backgroundColor: currentContact.color}\"\n                  >\n                    <span class=\"avatar-initial\">{{ currentContact.initial || '?' }}</span>\n                  </div>\n                  <img \n                    v-else \n                    :src=\"currentContact.avatar_url || currentContact.avatar\" \n                    alt=\"avatar\" \n                    class=\"avatar\" \n                  />\n                  <div \n                    class=\"contact-status\" \n                    :class=\"'status-' + (currentContact.status || 'online')\"\n                  ></div>\n                </div>\n                <div class=\"contact-info\">\n              <h6>{{ currentContact.name || '未命名联系人' }}</h6>\n              <p>{{ getStatusText(currentContact.status || 'online') }}</p>\n                </div>\n                <div class=\"chat-actions\">\n                  <el-tooltip content=\"语音通话\" placement=\"bottom\">\n                    <el-button circle>\n                      <el-icon><Phone /></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                  <el-tooltip content=\"视频通话\" placement=\"bottom\">\n                    <el-button circle>\n                      <el-icon><VideoCamera /></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                  <el-tooltip content=\"聊天信息\" placement=\"bottom\">\n                    <el-button circle>\n                      <el-icon><InfoFilled /></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                </div>\n              </div>\n              \n              <!-- 聊天消息区域 -->\n              <div class=\"chat-messages\" v-if=\"selectedContact !== null\" ref=\"messageContainer\">\n                <!-- 有消息时显示消息列表 -->\n                <template v-if=\"messages.length > 0\">\n                  <div \n                    v-for=\"(message, index) in messages\" \n                    :key=\"message.id || index\"\n                    class=\"message\"\n                    :class=\"message.sender.id === userId ? 'message-sent' : 'message-received'\"\n                  >\n                    <div class=\"message-container\">\n                      <div v-if=\"message.sender.id !== userId\" class=\"message-avatar\">\n                        <div \n                          v-if=\"!message.sender.avatar && !message.sender.avatar_url\" \n                          class=\"avatar small\" \n                          :style=\"{backgroundColor: getSenderColor(message.sender)}\"\n                        >\n                          <span class=\"avatar-initial\">{{ getSenderInitial(message.sender) }}</span>\n                        </div>\n                        <img \n                          v-else \n                          :src=\"message.sender.avatar_url || message.sender.avatar\" \n                          alt=\"avatar\" \n                          class=\"avatar small\" \n                        />\n                      </div>\n                      <div class=\"message-content-wrapper\">\n                        <div \n                          class=\"message-content\"\n                          :class=\"message.sender.id === userId ? 'sent' : 'received'\"\n                        >\n                          <span v-if=\"message.message_type === 'text'\">{{ message.content }}</span>\n                      \n                          <div v-else-if=\"message.message_type === 'image'\" class=\"message-image\">\n                            <img :src=\"message.file\" alt=\"image\" />\n                          </div>\n                      \n                          <div v-else-if=\"message.message_type === 'file'\" class=\"message-file\" @click=\"downloadFile(message)\">\n                            <el-icon><Document /></el-icon>\n                            <span>{{ message.file_name }}</span>\n                            <span class=\"file-size\">{{ formatFileSize(message.file_size) }}</span>\n                          </div>\n                      \n                          <div v-else-if=\"message.message_type === 'knowledge'\" class=\"message-knowledge\" @click=\"viewKnowledge(message)\">\n                            <el-icon><Reading /></el-icon>\n                            <div class=\"knowledge-info\">\n                              <div class=\"knowledge-title\">{{ message.knowledge_detail.title }}</div>\n                              <div class=\"knowledge-desc\">{{ message.knowledge_detail.description }}</div>\n                            </div>\n                          </div>\n                        </div>\n                        <div class=\"message-time\">{{ formatMessageTime(message.created_at) }}</div>\n                        \n                        <!-- 日程事件组件 -->\n                        <ChatCalendarEvent \n                          v-if=\"message.calendar_data && !hiddenCalendarEvents.includes(message.id)\"\n                          :messageId=\"message.id\"\n                          :eventData=\"message.calendar_data\"\n                          @calendar-event-added=\"handleCalendarEventAdded\"\n                          @calendar-event-hidden=\"handleCalendarEventHidden(message.id)\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                </template>\n                \n                <!-- 没有消息时显示空提示 -->\n                <template v-else-if=\"!loading\">\n                  <div class=\"empty-messages\">\n                    <el-empty description=\"暂无消息记录\">\n                      <template #image>\n                        <el-icon :size=\"64\" class=\"empty-icon\"><ChatLineSquare /></el-icon>\n                      </template>\n                      <p>发送第一条消息开始对话吧</p>\n                    </el-empty>\n                  </div>\n                </template>\n                \n                <!-- 加载中显示骨架屏 -->\n                <template v-else>\n                  <div class=\"loading-messages\">\n                    <el-skeleton :rows=\"3\" animated />\n                    <el-skeleton style=\"margin-top: 20px\" :rows=\"2\" animated />\n                    <div style=\"text-align: right; margin-top: 20px\">\n                      <el-skeleton :rows=\"2\" animated />\n                    </div>\n                  </div>\n                </template>\n              </div>\n              \n              <!-- 聊天输入框 -->\n              <div class=\"chat-input\" v-if=\"selectedContact !== null\">\n                <div class=\"chat-tools\">\n                  <el-tooltip content=\"发送图片\" placement=\"top\">\n                    <el-button circle @click=\"openImageUpload\">\n                      <el-icon><PictureFilled /></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                  <el-tooltip content=\"发送文件\" placement=\"top\">\n                    <el-button circle @click=\"openFileUpload\">\n                      <el-icon><FolderOpened /></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                  <el-tooltip content=\"分享知识库文件\" placement=\"top\">\n                    <el-button circle @click=\"openKnowledgeDialog\">\n                      <el-icon><Reading /></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                  <el-tooltip content=\"语音消息\" placement=\"top\">\n                    <el-button circle>\n                      <el-icon><Microphone /></el-icon>\n                    </el-button>\n                  </el-tooltip>\n                </div>\n                <div class=\"input-area\">\n                  <el-input\n                    v-model=\"messageInput\"\n                    type=\"textarea\"\n                    :rows=\"3\"\n                    placeholder=\"输入消息...\"\n                    resize=\"none\"\n                    @keyup.enter.prevent=\"sendMessage\"\n                  ></el-input>\n                </div>\n                <div class=\"send-button\">\n                  <el-button type=\"primary\" @click=\"sendMessage\">\n                    <el-icon><Position /></el-icon>\n                    发送\n                  </el-button>\n                </div>\n              </div>\n              \n              <!-- 无选中联系人提示 -->\n              <div class=\"empty-chat\" v-if=\"selectedContact === null\">\n                <div class=\"empty-illustration\">\n                  <el-icon :size=\"64\"><ChatDotSquare /></el-icon>\n                </div>\n                <h4>选择一个联系人开始聊天</h4>\n                <p>从左侧列表选择联系人开始对话</p>\n              </div>\n            </div>\n          </div>\n        </el-card>\n  \n  <!-- 隐藏的文件上传输入 -->\n  <input \n    type=\"file\" \n    ref=\"fileInput\" \n    style=\"display: none\" \n    @change=\"handleFileUpload\" \n  />\n  \n  <!-- 隐藏的图片上传输入 -->\n  <input \n    type=\"file\" \n    ref=\"imageInput\" \n    style=\"display: none\" \n    accept=\"image/*\" \n    @change=\"handleImageUpload\" \n  />\n  \n  <!-- 知识库选择对话框 -->\n  <el-dialog\n    v-model=\"knowledgeDialogVisible\"\n    title=\"选择知识库文件\"\n    width=\"50%\"\n  >\n    <el-table\n      v-loading=\"knowledgeLoading\"\n      :data=\"knowledgeList\"\n      style=\"width: 100%\"\n      @row-click=\"selectKnowledge\"\n    >\n      <el-table-column prop=\"title\" label=\"标题\"></el-table-column>\n      <el-table-column prop=\"file_type\" label=\"类型\">\n        <template #default=\"scope\">\n          <el-tag>{{ scope.row.file_type }}</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"created_at\" label=\"创建时间\">\n        <template #default=\"scope\">\n          {{ formatDate(scope.row.created_at) }}\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\">\n        <template #default=\"scope\">\n          <el-button type=\"primary\" size=\"small\" @click.stop=\"shareKnowledge(scope.row)\">\n            分享\n          </el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n    <template #footer>\n      <span class=\"dialog-footer\">\n        <el-button @click=\"knowledgeDialogVisible = false\">取消</el-button>\n      </span>\n    </template>\n  </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, nextTick, onMounted, onBeforeUnmount, watch } from 'vue'\nimport { useStore } from 'vuex'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport { \n  Search, Phone, VideoCamera, InfoFilled, Document, PictureFilled, \n  FolderOpened, Microphone, Position, ChatDotSquare, Reading, UserFilled, ChatLineSquare,\n  Refresh, MoreFilled\n} from '@element-plus/icons-vue'\nimport { \n  getChatSessions, \n  getChatSession, \n  sendTextMessage, \n  sendFileMessage,\n  sendImageMessage,\n  sendKnowledgeMessage,\n  downloadMessageFile\n} from '@/api/chat'\nimport { getKnowledgeList } from '@/api/knowledge'\nimport { useRoute } from 'vue-router'\nimport request from '@/utils/request'\nimport ChatCalendarEvent from '@/components/ChatCalendarEvent.vue'\n\nexport default {\n  name: 'Chat',\n  components: {\n    ChatCalendarEvent\n  },\n  setup() {\n    const store = useStore()\n    const currentUser = computed(() => store.getters.user)\n    \n    // 添加本地用户数据存储\n    const userInfo = ref(null)\n    \n    const searchQuery = ref('')\n    const activeTab = ref(0)\n    const selectedContact = ref(null)\n    const messageInput = ref('')\n    const messageContainer = ref(null)\n    const fileInput = ref(null)\n    const imageInput = ref(null)\n    const messages = ref([])\n    const loading = ref(false)\n    const chatSessions = ref([])\n    const currentChatId = ref(null)\n    \n    // 知识库相关\n    const knowledgeDialogVisible = ref(false)\n    const knowledgeLoading = ref(false)\n    const knowledgeList = ref([])\n    const selectedKnowledge = ref(null)\n    \n    // 标签页\n    const tabs = ref(['最近聊天', '同事'])\n    \n    // 联系人列表\n    const contacts = ref([])\n    // 所有同事用户列表\n    const allColleagues = ref([])\n    \n    // 当前选中的联系人\n    const currentContact = computed(() => {\n      if (selectedContact.value === null) return {}\n      return contacts.value.find(c => c.id === selectedContact.value) || {}\n    })\n    \n    // 安全地获取用户ID，避免模板中的null错误\n    const userId = computed(() => {\n      return userInfo.value?.id || null\n    })\n    \n    // 根据搜索过滤联系人\n    const filteredContacts = computed(() => {\n      if (!searchQuery.value) return contacts.value\n      return contacts.value.filter(contact =>\n        contact.name.toLowerCase().includes(searchQuery.value.toLowerCase())\n      )\n    })\n    \n    // 根据当前激活的标签页获取要显示的联系人\n    const getActiveContacts = computed(() => {\n      if (activeTab.value === 0) {\n        return filteredContacts.value\n      } else if (activeTab.value === 1) {\n        return filteredContacts.value.filter(contact => !contact.isGroup)\n      }\n      return filteredContacts.value\n    })\n    \n    \n    // 按部门分组的用户\n    const groupedUsersByDepartment = computed(() => {\n      // 合并聊天联系人和所有同事\n      const usersMap = new Map();\n      \n      // 先添加聊天联系人（非群组）\n      filteredContacts.value\n        .filter(contact => !contact.isGroup)\n        .forEach(contact => {\n          // 跳过自己\n          if (userInfo.value && contact.userId === userInfo.value.id) {\n            return;\n          }\n          // 使用ID作为唯一键\n          usersMap.set(contact.userId || contact.id, contact);\n        });\n      \n      // 再添加所有同事，但避免重复\n      allColleagues.value.forEach(colleague => {\n        // 跳过自己\n        if (userInfo.value && colleague.id === userInfo.value.id) {\n          return;\n        }\n        \n        // 只有在不存在时才添加（避免覆盖现有联系人）\n        if (!usersMap.has(colleague.id)) {\n          // 构造兼容格式的用户对象\n          const contact = {\n            id: 'user_' + colleague.id, // 添加前缀以避免与现有会话ID冲突\n            userId: colleague.id,\n            name: ((colleague.first_name || '') + ' ' + (colleague.last_name || '')).trim() || colleague.username || '未命名联系人',\n            initial: ((colleague.first_name || colleague.username || '未命名联系人')[0]),\n            avatar: colleague.avatar || '',\n            color: getRandomColor(colleague.id),\n            status: 'online',\n            lastMessage: '',\n            lastTime: '',\n            unread: 0,\n            isGroup: false,\n            department: colleague.department || '其它'\n          };\n          usersMap.set(colleague.id, contact);\n        }\n      });\n      \n      // 按部门分组\n      const groupedUsers = {};\n      \n      // 将Map转为Array后分组\n      Array.from(usersMap.values()).forEach(user => {\n        const departmentName = user.department || '其它';\n        if (!groupedUsers[departmentName]) {\n          groupedUsers[departmentName] = [];\n        }\n        groupedUsers[departmentName].push(user);\n      });\n      \n      return groupedUsers;\n    })\n    \n    // 路由\n    const route = useRoute()\n    \n    // 定义一个refreshInterval的引用，以便在组件卸载时清除\n    let refreshInterval = null\n    \n    // 组件卸载时清除定时器\n    onBeforeUnmount(() => {\n      if (refreshInterval) {\n        clearInterval(refreshInterval)\n      }\n    })\n    \n    // 路由相关操作\n    onMounted(async () => {\n      try {\n        // 先加载用户数据\n        const userData = await fetchCurrentUser()\n        \n        // 如果获取用户信息失败，显示错误并返回\n        if (!userData) {\n          ElMessage.error('无法加载用户信息，请刷新页面重试')\n          return\n        }\n        \n        console.log('组件挂载时获取的用户信息:', userData)\n        \n        // 确保用户数据已经更新\n        if (!userInfo.value || !userInfo.value.id) {\n          console.error('用户数据未正确加载:', userInfo.value)\n          ElMessage.error('用户数据加载异常，请刷新页面重试')\n          return\n        } else {\n          console.log('当前用户数据已正确加载:', userInfo.value)\n        }\n        \n        // 加载所有用户列表\n        await loadAllUsers()\n        \n        // 再加载聊天会话列表\n        await loadChatSessions()\n        \n        // 检查URL参数中是否有会话ID\n        const sessionId = route.query.session || route.query.id\n        if (sessionId) {\n          // 查找对应的联系人\n          const foundContact = contacts.value.find(c => c.id === parseInt(sessionId))\n          if (foundContact) {\n            // 选中该联系人\n            selectedContact.value = foundContact.id\n            // 加载聊天记录\n            await loadChatMessages(sessionId)\n          } else {\n            // 如果未找到对应联系人，尝试直接加载会话\n            console.log('通过ID直接加载聊天会话:', sessionId)\n            await loadChatMessages(sessionId)\n          }\n        }\n      \n        // 设置定时刷新\n        refreshInterval = setInterval(async () => {\n          if (selectedContact.value) {\n            await loadChatMessages(selectedContact.value)\n          }\n          await loadChatSessions()\n        }, 30000)\n        \n        // 初始滚动到底部\n        await nextTick()\n        scrollToBottom()\n      } catch (error) {\n        console.error('初始化聊天组件失败:', error)\n        ElMessage.error('初始化聊天组件失败: ' + error.message)\n      }\n    })\n    \n    // 获取当前用户信息\n    const fetchCurrentUser = async () => {\n      try {\n        console.log('开始获取当前用户信息...')\n        \n        // 检查localStorage中是否有token\n        const token = localStorage.getItem('token')\n        if (!token) {\n          console.warn('本地存储中没有找到认证token')\n          ElMessage.warning('未登录或登录已过期，请重新登录')\n          return null\n        }\n        \n        const response = await request({\n          url: '/api/auth/users/me/',\n          method: 'get'\n        })\n        \n        console.log('获取用户信息响应:', response)\n        \n        // 检查响应格式并获取用户数据\n        let userData = null\n        if (response.data && response.data.id) {\n          // 直接从data字段获取用户数据\n          userData = response.data\n          console.log('从data字段获取用户数据:', userData)\n        } else if (response.data && response.data.data && response.data.data.id) {\n          // 从嵌套data字段获取用户数据\n          userData = response.data.data\n          console.log('从嵌套data字段获取用户数据:', userData)\n        } else if (response.id) {\n          // 直接响应就是用户数据\n          userData = response\n          console.log('直接获取用户数据:', userData)\n        } else {\n          console.error('获取用户信息响应格式异常:', response)\n          throw new Error('用户信息格式异常')\n        }\n        \n        if (!userData || !userData.id) {\n          console.error('获取的用户数据无效:', userData)\n          throw new Error('无效的用户数据')\n        }\n        \n        // 不使用未定义的mutation，而是直接更新本地状态\n        userInfo.value = userData\n        \n        // 保存到localStorage以便持久化\n        localStorage.setItem('user', JSON.stringify(userData))\n        \n        console.log('用户数据已更新:', userInfo.value)\n        return userData\n      } catch (error) {\n        console.error('获取当前用户信息失败:', error)\n        ElMessage.error('获取用户信息失败: ' + (error.message || '未知错误'))\n        return null\n      }\n    }\n    \n    // 加载聊天会话列表\n    const loadChatSessions = async () => {\n      try {\n        loading.value = true\n        console.log('正在加载聊天会话列表...')\n        \n        const response = await getChatSessions()\n        console.log('获取聊天会话响应:', response)\n        \n        // 确保我们有响应数据\n        if (!response) {\n          console.error('获取聊天会话返回空响应')\n          contacts.value = []\n          return\n        }\n        \n        let data\n        if (response.success && response.data) {\n          data = response.data\n          console.log('使用包装格式的聊天数据:', data)\n        } else {\n          data = response\n          console.log('使用直接返回的聊天数据:', data)\n        }\n        \n        // 转换数据格式\n        chatSessions.value = data\n        \n        // 构建联系人列表\n        if (data && Array.isArray(data.results)) {\n          console.log('处理分页数据结构, 共有会话数:', data.results.length)\n          // 处理分页数据结构\n          contacts.value = data.results.map(session => {\n            // 找到对方用户（非当前用户）\n            let otherParticipant = null\n            if (session.participants && Array.isArray(session.participants)) {\n              if (userInfo.value && userInfo.value.id) {\n                otherParticipant = session.participants.find(\n                  p => p.user && p.user.id !== userInfo.value.id\n                )\n              } else {\n                // 如果没有当前用户信息，使用第一个参与者\n                otherParticipant = session.participants[0]\n              }\n            }\n            \n            // 如果是群聊，使用群聊信息\n            if (session.is_group) {\n              return {\n                id: session.id,\n                name: session.title || '群聊',\n                initial: (session.title || '群聊')[0],\n                avatar: '',\n                avatar_url: '',\n                color: getRandomColor(session.id),\n                status: 'online',\n                lastMessage: session.last_message ? session.last_message.content : '',\n                lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n                unread: session.unread_count,\n                isGroup: true\n              }\n            }\n            \n            // 单聊，使用对方信息\n            if (otherParticipant) {\n              const user = otherParticipant.user\n              // 处理头像路径\n              let avatar_url = '';\n              if (user.avatar) {\n                const avatar = user.avatar;\n                if (avatar.startsWith('http://') || avatar.startsWith('https://')) {\n                  avatar_url = avatar;\n                } else if (avatar.startsWith('/')) {\n                  avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}${avatar}`;\n                } else {\n                  avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}/${avatar}`;\n                }\n              }\n              \n              return {\n                id: session.id,\n                userId: user.id, // 添加用户ID，用于检查是否是自己\n                name: ((user.first_name || '') + ' ' + (user.last_name || '')).trim() || user.username || '未命名联系人',\n                initial: ((user.first_name || user.username || '未命名联系人')[0]),\n                avatar: user.avatar || '',\n                avatar_url: avatar_url,\n                color: getRandomColor(user.id),\n                status: 'online',\n                lastMessage: session.last_message ? session.last_message.content : '',\n                lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n                unread: session.unread_count,\n                isGroup: false,\n                department: user.department // 添加部门信息\n              }\n            }\n            \n            // 如果没有其他参与者（理论上不应该发生）\n            return {\n              id: session.id,\n              name: session.title || '聊天',\n              initial: (session.title || '聊天')[0],\n              avatar: '',\n              avatar_url: '',\n              color: getRandomColor(session.id),\n              status: 'online',\n              lastMessage: session.last_message ? session.last_message.content : '',\n              lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n              unread: session.unread_count,\n              isGroup: session.is_group\n            }\n          })\n        } else if (data && Array.isArray(data)) {\n          console.log('处理非分页数据结构, 共有会话数:', data.length)\n          // 处理非分页数据结构\n          contacts.value = data.map(session => {\n            // 找到对方用户（非当前用户）\n            let otherParticipant = null\n            if (session.participants && Array.isArray(session.participants)) {\n              if (userInfo.value && userInfo.value.id) {\n                otherParticipant = session.participants.find(\n                  p => p.user && p.user.id !== userInfo.value.id\n                )\n              } else {\n                // 如果没有当前用户信息，使用第一个参与者\n                otherParticipant = session.participants[0]\n              }\n            }\n            \n            // 如果是群聊，使用群聊信息\n            if (session.is_group) {\n              return {\n                id: session.id,\n                name: session.title || '群聊',\n                initial: (session.title || '群聊')[0],\n                avatar: '',\n                avatar_url: '',\n                color: getRandomColor(session.id),\n                status: 'online',\n                lastMessage: session.last_message ? session.last_message.content : '',\n                lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n                unread: session.unread_count,\n                isGroup: true\n              }\n            }\n            \n            // 单聊，使用对方信息\n            if (otherParticipant) {\n              const user = otherParticipant.user\n              // 处理头像路径\n              let avatar_url = '';\n              if (user.avatar) {\n                const avatar = user.avatar;\n                if (avatar.startsWith('http://') || avatar.startsWith('https://')) {\n                  avatar_url = avatar;\n                } else if (avatar.startsWith('/')) {\n                  avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}${avatar}`;\n                } else {\n                  avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}/${avatar}`;\n                }\n              }\n              \n              return {\n                id: session.id,\n                name: ((user.first_name || '') + ' ' + (user.last_name || '')).trim() || user.username || '未命名联系人',\n                initial: ((user.first_name || user.username || '未命名联系人')[0]),\n                avatar: user.avatar || '',\n                avatar_url: avatar_url,\n                color: getRandomColor(user.id),\n                status: 'online',\n                lastMessage: session.last_message ? session.last_message.content : '',\n                lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n                unread: session.unread_count,\n                isGroup: false\n              }\n            }\n            \n            // 如果没有其他参与者（理论上不应该发生）\n            return {\n              id: session.id,\n              name: session.title || '聊天',\n              initial: (session.title || '聊天')[0],\n              avatar: '',\n              avatar_url: '',\n              color: getRandomColor(session.id),\n              status: 'online',\n              lastMessage: session.last_message ? session.last_message.content : '',\n              lastTime: session.last_message ? formatMessageTime(session.last_message.created_at) : formatMessageTime(session.updated_at),\n              unread: session.unread_count,\n              isGroup: session.is_group\n            }\n          })\n        } else {\n          // 如果没有有效数据\n          console.error('获取聊天会话格式异常或为空:', data)\n          contacts.value = []\n        }\n        \n        console.log('处理后的联系人列表:', contacts.value)\n        \n        // 如果有未读消息，按未读数量排序\n        if (contacts.value.length > 0) {\n          contacts.value.sort((a, b) => b.unread - a.unread)\n        }\n      } catch (error) {\n        console.error('加载聊天会话失败:', error)\n        ElMessage.error('加载聊天会话失败: ' + (error.message || '未知错误'))\n        contacts.value = []\n      } finally {\n        loading.value = false\n      }\n    }\n    \n    // 加载聊天消息\n    const loadChatMessages = async (chatId) => {\n      if (!chatId) {\n        console.error('无法加载消息: chatId为空')\n        return\n      }\n      \n      try {\n        loading.value = true\n        console.log(`正在加载聊天会话 ${chatId} 的消息...`)\n        \n        const response = await getChatSession(chatId)\n        console.log('聊天会话详情响应:', response)\n        \n        if (!response) {\n          console.error('获取聊天会话详情返回空响应')\n          messages.value = []\n          return\n        }\n        \n        // 处理不同的响应格式\n        let messageData = []\n        let sessionData = null\n        \n        if (response.data && response.data.messages) {\n          // 标准格式：响应直接包含messages字段\n          messageData = response.data.messages\n          sessionData = response.data\n          console.log('标准格式消息数据，消息数量:', messageData.length)\n        } else if (response.data && response.data.data && response.data.data.messages) {\n          // 包装格式：{success: true, data: {messages: [...]}}\n          messageData = response.data.data.messages\n          sessionData = response.data.data\n          console.log('包装格式消息数据，消息数量:', messageData.length)\n        } else if (response.messages) {\n          // 直接返回格式: {messages: [...]}\n          messageData = response.messages\n          sessionData = response\n          console.log('直接返回格式消息数据，消息数量:', messageData.length)\n        } else {\n          console.warn('无法识别的消息数据格式:', response)\n          console.log('尝试检查是否有其他可能的消息字段...')\n          \n          // 尝试查找其他可能的消息字段\n          const possibleMessageFields = ['message', 'chat_messages', 'chats', 'content']\n          for (const field of possibleMessageFields) {\n            if (response[field] && Array.isArray(response[field])) {\n              console.log(`找到可能的消息字段 ${field}，使用此字段数据`)\n              messageData = response[field]\n              sessionData = response\n              break\n            } else if (response.data && response.data[field] && Array.isArray(response.data[field])) {\n              console.log(`在data字段中找到可能的消息字段 ${field}，使用此字段数据`)\n              messageData = response.data[field]\n              sessionData = response.data\n              break\n            }\n          }\n          \n          if (messageData.length === 0) {\n            console.warn('未找到任何消息数据，使用空数组')\n          }\n        }\n        \n        // 处理消息发送者的头像\n        messageData.forEach(message => {\n          if (message.sender && message.sender.avatar) {\n            const avatar = message.sender.avatar;\n            if (avatar.startsWith('http://') || avatar.startsWith('https://')) {\n              message.sender.avatar_url = avatar;\n            } else if (avatar.startsWith('/')) {\n              message.sender.avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}${avatar}`;\n            } else {\n              message.sender.avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}/${avatar}`;\n            }\n          }\n        });\n        \n        // 记录会话和消息数据\n        console.log('处理后的会话数据:', sessionData)\n        console.log('处理后的消息数据:', messageData)\n        \n        // 如果会话不在联系人列表中，添加它\n        if (sessionData && !contacts.value.some(c => c.id === parseInt(chatId))) {\n          console.log('会话不在联系人列表中，添加它:', sessionData)\n          \n          // 创建临时联系人对象\n          const session = sessionData\n          // 找到对方用户（非当前用户）\n          let otherParticipant = null\n          \n          // 确保 session.participants 存在且是数组\n          if (session.participants && Array.isArray(session.participants) && session.participants.length > 0 && userInfo.value) {\n            otherParticipant = session.participants.find(p => p.user && p.user.id !== userInfo.value.id)\n          }\n          \n          let tempContact = null\n          \n          // 如果是群聊，使用群聊信息\n          if (session.is_group) {\n            tempContact = {\n              id: parseInt(chatId),\n              name: session.title || '群聊',\n              initial: (session.title || '群聊')[0],\n              avatar: '',\n              avatar_url: '',\n              color: getRandomColor(parseInt(chatId)),\n              status: 'online',\n              lastMessage: session.last_message ? session.last_message.content : '',\n              lastTime: formatMessageTime(session.updated_at),\n              unread: 0,\n              isGroup: true\n            }\n          // 单聊，使用对方信息\n          } else if (otherParticipant && otherParticipant.user) {\n            const user = otherParticipant.user\n            // 处理头像路径\n            let avatar_url = '';\n            if (user.avatar) {\n              const avatar = user.avatar;\n              if (avatar.startsWith('http://') || avatar.startsWith('https://')) {\n                avatar_url = avatar;\n              } else if (avatar.startsWith('/')) {\n                avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}${avatar}`;\n              } else {\n                avatar_url = `${process.env.VUE_APP_BASE_API || 'http://localhost:8000'}/${avatar}`;\n              }\n            }\n            \n            tempContact = {\n              id: parseInt(chatId),\n              name: ((user.first_name || '') + ' ' + (user.last_name || '')).trim() || user.username || '未命名联系人',\n              initial: ((user.first_name || user.username || '未命名联系人')[0]),\n              avatar: user.avatar || '',\n              avatar_url: avatar_url,\n              color: getRandomColor(user.id),\n              status: 'online',\n              lastMessage: session.last_message ? session.last_message.content : '',\n              lastTime: formatMessageTime(session.updated_at),\n              unread: 0,\n              isGroup: false\n            }\n          } else {\n            // 如果无法找到对方信息，使用默认值\n            tempContact = {\n              id: parseInt(chatId),\n              name: session.title || '聊天',\n              initial: (session.title || '聊天')[0],\n              avatar: '',\n              avatar_url: '',\n              color: getRandomColor(parseInt(chatId)),\n              status: 'online',\n              lastMessage: '',\n              lastTime: formatMessageTime(session.updated_at),\n              unread: 0,\n              isGroup: session.is_group\n            }\n          }\n          \n          // 添加临时联系人到列表\n          if (tempContact) {\n            contacts.value.unshift(tempContact)\n            console.log('添加临时联系人:', tempContact)\n          }\n        }\n        \n        // 更新组件数据\n        messages.value = messageData || []\n        currentChatId.value = parseInt(chatId)\n        selectedContact.value = parseInt(chatId)\n        \n        // 滚动到底部\n        nextTick(() => {\n          scrollToBottom()\n        })\n      } catch (error) {\n        console.error('加载会话详情失败:', error)\n        \n        let errorMessage = '加载聊天消息失败'\n        if (error.response) {\n          const status = error.response.status\n          if (status === 404) {\n            errorMessage = '聊天会话不存在或已被删除'\n          } else if (status === 403) {\n            errorMessage = '无权访问此聊天会话'\n          } else if (error.response.data && error.response.data.message) {\n            errorMessage = error.response.data.message\n          }\n        } else if (error.message) {\n          errorMessage = error.message\n        }\n        \n        ElMessage.error(errorMessage)\n        messages.value = []\n      } finally {\n        loading.value = false\n      }\n    }\n    \n    // 刷新聊天会话列表\n    const refreshChatSessions = async () => {\n      // 更新用户列表\n      await loadAllUsers()\n      \n      // 更新聊天会话\n      await loadChatSessions()\n      \n      // 如果有当前聊天ID，确保选中正确的联系人\n      if (currentChatId.value) {\n        const contact = contacts.value.find(c => c.id === currentChatId.value)\n        if (contact) {\n          selectedContact.value = contact.id\n        }\n      }\n    }\n    \n    // 确保消息容器滚动到底部\n    const scrollToBottom = () => {\n      if (messageContainer.value) {\n        messageContainer.value.scrollTop = messageContainer.value.scrollHeight\n      }\n    }\n    \n    // 在选择联系人后，滚动到底部\n    const selectContact = async (contact) => {\n      // 检查是否尝试与自己聊天\n      if (!contact.isGroup && userInfo.value && contact.userId === userInfo.value.id) {\n        ElMessage.warning('不能与自己聊天')\n        return\n      }\n      \n      console.log('选择联系人:', contact)\n      \n      // 处理两种类型的ID：现有对话ID和用户ID前缀的情况\n      let contactId = contact.id\n      \n      // 检查是否已有该联系人的对话\n      if (typeof contactId === 'string' && contactId.startsWith('user_')) {\n        // 这是直接选择了用户，而不是现有的聊天会话\n        let userId = contact.userId || contact.id.replace('user_', '')\n        console.log('尝试查找与用户的现有对话:', userId)\n        \n        // 尝试在现有会话中查找与该用户的对话\n        const existingChat = contacts.value.find(c => \n          !c.isGroup && \n          ((c.userId && c.userId == userId) || \n          (c.user && c.user.id == userId))\n        )\n        \n        if (existingChat) {\n          console.log('找到与用户的现有对话:', existingChat)\n          contactId = existingChat.id\n        } else {\n          console.log('未找到与用户的现有对话，创建新对话')\n          \n          // 创建新的聊天会话\n          try {\n            const response = await request({\n              url: '/api/chat/sessions/',\n              method: 'post',\n              data: {\n                participant_ids: [userId],\n                is_group: false\n              }\n            })\n            \n            console.log('创建会话响应:', response)\n            \n            // 处理API响应\n            let newSession = null\n            \n            if (response && response.data) {\n              newSession = response.data\n            } else if (response && response.id) {\n              newSession = response\n            }\n            \n            if (newSession && newSession.id) {\n              // 创建临时联系人对象\n              const tempContact = {\n                id: newSession.id,\n                userId: userId,\n                name: contact.name,\n                initial: contact.initial,\n                avatar: contact.avatar,\n                avatar_url: contact.avatar_url || '',\n                color: contact.color || getRandomColor(userId),\n                status: 'online',\n                lastMessage: '',\n                lastTime: formatMessageTime(new Date()),\n                unread: 0,\n                isGroup: false,\n                department: contact.department\n              }\n              \n              // 添加到联系人列表\n              contacts.value.unshift(tempContact)\n              \n              // 更新选中的联系人\n              contactId = newSession.id\n              ElMessage.success('已创建新的对话')\n            } else {\n              throw new Error('创建会话返回无效数据')\n            }\n          } catch (error) {\n            console.error('创建新会话失败:', error)\n            ElMessage.error('无法创建新对话: ' + (error.message || '未知错误'))\n            return\n          }\n        }\n      }\n      \n      // 加载选中的联系人\n      selectedContact.value = contactId\n      messageInput.value = ''\n      messages.value = []\n      \n      // 加载消息\n      try {\n        await loadChatMessages(contactId)\n        \n        // 滚动到底部\n        nextTick(() => {\n          scrollToBottom()\n        })\n      } catch (error) {\n        console.error('加载聊天消息失败:', error)\n        ElMessage.error('无法加载对话内容：' + (error.message || '未知错误'))\n      }\n    }\n    \n    // 在消息列表更新后，滚动到底部\n    watch(messages, () => {\n      nextTick(() => {\n        scrollToBottom()\n      })\n    })\n    \n    // 发送消息\n    const sendMessage = async () => {\n      if (!messageInput.value.trim() || !currentChatId.value) return\n      \n      try {\n        // 检查当前用户信息是否存在\n        if (!userInfo.value || !userInfo.value.id) {\n          console.log('当前用户信息不存在，尝试重新获取...')\n          // 尝试重新获取用户信息\n          const userData = await fetchCurrentUser()\n          if (!userData || !userData.id) {\n            throw new Error('无法获取当前用户信息，请刷新页面重试')\n          }\n          \n          console.log('成功获取用户信息:', userData)\n        }\n        \n        // 创建临时消息对象\n        // 再次检查用户信息是否已更新\n        if (!userInfo.value || !userInfo.value.id) {\n          throw new Error('用户信息未更新，请刷新页面重试')\n        }\n        \n        // 记录当前会话ID\n        console.log('当前会话ID:', currentChatId.value, '类型:', typeof currentChatId.value)\n        \n        const tempMessage = {\n          id: 'temp-' + Date.now(),\n          content: messageInput.value.trim(),\n          sender: {\n            id: userInfo.value.id,\n            username: userInfo.value.username || '用户',\n            first_name: userInfo.value.first_name || '',\n            last_name: userInfo.value.last_name || ''\n          },\n          message_type: 'text',\n          created_at: new Date().toISOString(),\n          is_temp: true\n        }\n        \n        // 先将临时消息添加到列表中\n        messages.value.push(tempMessage)\n        \n        // 清空输入框\n        const messageCopy = messageInput.value\n        messageInput.value = ''\n        \n        // 滚动到底部\n        await nextTick()\n        scrollToBottom()\n        \n        // 详细记录发送信息\n        console.log('准备发送消息到服务器，会话ID:', currentChatId.value, '消息内容:', messageCopy)\n        \n        try {\n          // 发送消息到服务器\n          const response = await sendTextMessage({\n            chat: currentChatId.value,\n            content: messageCopy\n          })\n          console.log('发送消息响应:', response)\n          \n          // 适应不同的响应格式\n          let messageData = null\n          \n          if (response && response.success && response.data) {\n            // 标准包装格式: {success: true, data: {}}\n            messageData = response.data\n          } else if (response && response.id) {\n            // 包含ID的DRF格式\n            messageData = response\n          } else if (response && response.chat) {\n            // 新API格式: {chat, content, message_type, file, ...}\n            // 构造完整的消息对象\n            messageData = {\n              id: response.id || 'msg-' + Date.now(),\n              content: response.content,\n              message_type: response.message_type,\n              file: response.file,\n              created_at: response.created_at || new Date().toISOString(),\n              sender: {\n                id: userInfo.value.id,\n                username: userInfo.value.username || '用户',\n                first_name: userInfo.value.first_name || '',\n                last_name: userInfo.value.last_name || ''\n              }\n            }\n          } else {\n            console.warn('无法识别的消息响应格式:', response)\n            throw new Error('发送消息响应格式异常')\n          }\n          \n          // 用服务器返回的消息替换临时消息\n          const tempIndex = messages.value.findIndex(m => m.id === tempMessage.id)\n          if (tempIndex !== -1) {\n            messages.value.splice(tempIndex, 1, messageData)\n          } else {\n            messages.value.push(messageData)\n          }\n          \n          // 更新联系人最新消息\n          const contactIndex = contacts.value.findIndex(c => c.id === selectedContact.value)\n          if (contactIndex !== -1) {\n            contacts.value[contactIndex].lastMessage = messageCopy\n            contacts.value[contactIndex].lastTime = formatMessageTime(new Date())\n          }\n          \n          // 再次滚动到底部\n          await nextTick()\n          scrollToBottom()\n        } catch (error) {\n          // 详细记录发送消息错误\n          console.error('发送消息API调用失败:', error)\n          if (error.response) {\n            console.error('错误状态码:', error.response.status)\n            console.error('错误详情:', error.response.data)\n            console.error('请求URL:', error.response.config.url)\n            console.error('请求方法:', error.response.config.method)\n            console.error('请求数据:', error.response.config.data)\n            \n            if (error.response.status === 404) {\n              // 404错误处理\n              console.error('API端点不存在，检查URL配置是否正确')\n              ElMessage.error('消息发送失败: API端点不存在，请联系管理员')\n            } else {\n              throw error  // 将错误传递给外部catch\n            }\n          } else {\n            throw error  // 将错误传递给外部catch\n          }\n        }\n      } catch (error) {\n        console.error('发送消息失败:', error)\n        \n        // 移除临时消息\n        messages.value = messages.value.filter(m => !m.is_temp)\n        \n        // 将消息内容放回输入框\n        messageInput.value = error.savedMessage || messageInput.value\n        \n        ElMessage.error('发送消息失败，请重试')\n      }\n    }\n    \n    // 打开文件上传\n    const openFileUpload = () => {\n      fileInput.value.click()\n    }\n    \n    // 打开图片上传\n    const openImageUpload = () => {\n      imageInput.value.click()\n    }\n    \n    // 处理文件上传\n    const handleFileUpload = async (event) => {\n      const file = event.target.files[0]\n      if (!file || !currentChatId.value) return\n      \n      try {\n        await sendFileMessage(\n          currentChatId.value, \n          `发送文件: ${file.name}`, \n          file\n        )\n        \n        // 重新加载消息\n        loadChatMessages(currentChatId.value)\n        \n        // 清空文件输入\n        event.target.value = ''\n      } catch (error) {\n        console.error('发送文件失败:', error)\n        ElMessage.error('发送文件失败')\n      }\n    }\n    \n    // 处理图片上传\n    const handleImageUpload = async (event) => {\n      const file = event.target.files[0]\n      if (!file || !currentChatId.value) return\n      \n      try {\n        await sendImageMessage(\n          currentChatId.value, \n          `发送图片`, \n          file\n        )\n        \n        // 重新加载消息\n        loadChatMessages(currentChatId.value)\n        \n        // 清空文件输入\n        event.target.value = ''\n      } catch (error) {\n        console.error('发送图片失败:', error)\n        ElMessage.error('发送图片失败')\n      }\n    }\n    \n    // 打开知识库对话框\n    const openKnowledgeDialog = async () => {\n      knowledgeDialogVisible.value = true\n      await loadKnowledgeList()\n    }\n    \n    // 加载知识库列表\n    const loadKnowledgeList = async () => {\n      try {\n        knowledgeLoading.value = true\n        const { data } = await getKnowledgeList()\n        knowledgeList.value = data\n      } catch (error) {\n        console.error('加载知识库列表失败:', error)\n        ElMessage.error('加载知识库列表失败')\n      } finally {\n        knowledgeLoading.value = false\n      }\n    }\n    \n    // 选择知识库文件\n    const selectKnowledge = (row) => {\n      selectedKnowledge.value = row\n    }\n    \n    // 分享知识库文件\n    const shareKnowledge = async (knowledge) => {\n      if (!currentChatId.value) return\n      \n      try {\n        await sendKnowledgeMessage(\n          currentChatId.value,\n          `分享知识库文件: ${knowledge.title}`,\n          knowledge.id\n        )\n        \n        // 关闭对话框\n        knowledgeDialogVisible.value = false\n        \n        // 重新加载消息\n        loadChatMessages(currentChatId.value)\n      } catch (error) {\n        console.error('分享知识库文件失败:', error)\n        ElMessage.error('分享知识库文件失败')\n      }\n    }\n    \n    // 下载文件\n    const downloadFile = async (message) => {\n      try {\n        const response = await downloadMessageFile(message.id)\n        \n        // 创建下载链接\n        const url = window.URL.createObjectURL(new Blob([response.data]))\n        const link = document.createElement('a')\n        link.href = url\n        link.setAttribute('download', message.file_name || 'download')\n        document.body.appendChild(link)\n        link.click()\n        document.body.removeChild(link)\n      } catch (error) {\n        console.error('下载文件失败:', error)\n        ElMessage.error('下载文件失败')\n      }\n    }\n    \n    // 查看知识库文件\n    const viewKnowledge = (message) => {\n      if (message.knowledge_detail) {\n        // 可以跳转到知识库详情页面\n        ElMessageBox.alert(\n          `标题: ${message.knowledge_detail.title}<br>描述: ${message.knowledge_detail.description || '无'}`, \n          '知识库文件', \n          {\n            dangerouslyUseHTMLString: true,\n            confirmButtonText: '确定'\n          }\n        )\n      }\n    }\n    \n    // 获取发送者颜色\n    const getSenderColor = (sender) => {\n      return getRandomColor(sender.id)\n    }\n    \n    // 获取发送者首字母\n    const getSenderInitial = (sender) => {\n      return (sender.first_name || sender.username)[0]\n    }\n    \n    // 根据ID生成随机颜色\n    const getRandomColor = (id) => {\n      const colors = [\n        '#007bff', '#28a745', '#dc3545', '#fd7e14', \n        '#6f42c1', '#20c997', '#17a2b8', '#6c757d'\n      ]\n      \n      // 使用ID作为索引，确保同一用户颜色一致\n      const index = typeof id === 'number' ? id % colors.length : 0\n      return colors[index]\n    }\n    \n    // 格式化消息时间\n    const formatMessageTime = (timestamp) => {\n      if (!timestamp) return ''\n      \n      const date = new Date(timestamp)\n      const now = new Date()\n      const diff = now - date\n      \n      // 今天内的消息显示时间\n      if (diff < 24 * 60 * 60 * 1000) {\n      const hours = date.getHours().toString().padStart(2, '0')\n      const minutes = date.getMinutes().toString().padStart(2, '0')\n      return `${hours}:${minutes}`\n      }\n      \n      // 一周内的消息显示星期几\n      if (diff < 7 * 24 * 60 * 60 * 1000) {\n        const days = ['周日', '周一', '周二', '周三', '周四', '周五', '周六']\n        return days[date.getDay()]\n      }\n      \n      // 更早的消息显示日期\n      return `${date.getMonth() + 1}月${date.getDate()}日`\n    }\n    \n    // 格式化日期\n    const formatDate = (timestamp) => {\n      if (!timestamp) return ''\n      \n      const date = new Date(timestamp)\n      return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`\n    }\n    \n    // 格式化文件大小\n    const formatFileSize = (sizeInKB) => {\n      if (sizeInKB < 1024) {\n        return `${sizeInKB} KB`\n      } else {\n        return `${(sizeInKB / 1024).toFixed(2)} MB`\n      }\n    }\n    \n    // 获取状态文字\n    const getStatusText = (status) => {\n      const statusMap = {\n        'online': '在线',\n        'offline': '离线',\n        'busy': '忙碌',\n        'away': '离开'\n      }\n      return statusMap[status] || status\n    }\n    \n    // 添加强制刷新方法\n    const forceRefresh = async () => {\n      try {\n        ElMessage.info('正在强制刷新数据...')\n        \n        // 重新获取用户信息\n        const userData = await fetchCurrentUser()\n        \n        if (!userData) {\n          ElMessage.error('无法获取用户信息，请尝试重新登录')\n          return\n        }\n        \n        // 重新加载聊天会话\n        await loadChatSessions()\n        \n        if (contacts.value.length === 0) {\n          ElMessage.warning('未找到任何聊天会话，您可能还没有开始任何对话')\n        } else {\n          ElMessage.success('刷新成功！找到 ' + contacts.value.length + ' 个聊天会话')\n        }\n      } catch (error) {\n        console.error('强制刷新失败:', error)\n        ElMessage.error('刷新失败: ' + (error.message || '未知错误'))\n      }\n    }\n    \n    // 加载所有用户\n    const loadAllUsers = async () => {\n      try {\n        console.log('正在加载所有用户列表...')\n        \n        // 尝试直接获取所有用户，不需要公司ID\n        try {\n          console.log('尝试直接获取所有用户...')\n          const response = await request({\n            url: '/api/auth/users/',\n            method: 'get'\n          })\n          \n          console.log('用户API响应:', response)\n          \n          // 处理响应数据\n          let users = []\n          if (response && response.results) {\n            users = response.results\n          } else if (Array.isArray(response)) {\n            users = response\n          } else if (response && response.data) {\n            if (Array.isArray(response.data)) {\n              users = response.data\n            } else if (response.data.results) {\n              users = response.data.results\n            }\n          }\n          \n          if (users && users.length > 0) {\n            console.log(`成功获取到${users.length}个用户`)\n            allColleagues.value = users\n            return\n          }\n        } catch (error) {\n          console.error('获取用户列表失败:', error)\n        }\n        \n        // 如果直接获取失败，使用模拟数据\n        console.warn('API获取用户列表失败，使用模拟数据')\n        allColleagues.value = [\n          {\n            id: 1,\n            username: 'zhangsan',\n            first_name: '张',\n            last_name: '三',\n            department: '技术部',\n            avatar: ''\n          },\n          {\n            id: 2,\n            username: 'lisi',\n            first_name: '李',\n            last_name: '四',\n            department: '市场部',\n            avatar: ''\n          },\n          {\n            id: 3,\n            username: 'wangwu',\n            first_name: '王',\n            last_name: '五',\n            department: '财务部',\n            avatar: ''\n          },\n          {\n            id: 4,\n            username: 'zhaoliu',\n            first_name: '赵',\n            last_name: '六',\n            department: '',\n            avatar: ''\n          }\n        ]\n        console.log('已加载模拟数据')\n      } catch (error) {\n        console.error('加载用户列表过程中出错:', error)\n        // 确保我们至少有一些数据\n        allColleagues.value = [\n          { id: 1, username: 'user1', first_name: '用户', last_name: '1', department: '技术部' },\n          { id: 2, username: 'user2', first_name: '用户', last_name: '2', department: '市场部' },\n          { id: 3, username: 'user3', first_name: '用户', last_name: '3', department: '财务部' },\n          { id: 4, username: 'user4', first_name: '用户', last_name: '4', department: '' }\n        ]\n      }\n    }\n    \n    // 日程事件相关\n    const hiddenCalendarEvents = ref([])\n    \n    // 处理日程事件添加成功\n    const handleCalendarEventAdded = () => {\n      // 可以在这里做一些额外处理，例如通知其他人等\n    }\n    \n    // 处理日程事件隐藏\n    const handleCalendarEventHidden = (messageId) => {\n      hiddenCalendarEvents.value.push(messageId)\n    }\n    \n    return {\n      searchQuery,\n      activeTab,\n      selectedContact,\n      tabs,\n      contacts,\n      currentContact,\n      filteredContacts,\n      messages,\n      messageInput,\n      messageContainer,\n      fileInput,\n      imageInput,\n      currentUser,\n      userInfo,\n      userId,\n      knowledgeDialogVisible,\n      knowledgeLoading,\n      knowledgeList,\n      loading,\n      // 图标\n      Search,\n      Phone,\n      VideoCamera,\n      InfoFilled,\n      Document,\n      PictureFilled,\n      FolderOpened,\n      Microphone,\n      Position,\n      ChatDotSquare,\n      Reading,\n      UserFilled,\n      ChatLineSquare,\n      Refresh,\n      MoreFilled,\n      // 方法\n      sendMessage,\n      getStatusText,\n      selectContact,\n      openFileUpload,\n      openImageUpload,\n      handleFileUpload,\n      handleImageUpload,\n      openKnowledgeDialog,\n      selectKnowledge,\n      shareKnowledge,\n      downloadFile,\n      viewKnowledge,\n      getSenderColor,\n      getSenderInitial,\n      formatMessageTime,\n      formatDate,\n      formatFileSize,\n      refreshChatSessions,\n      forceRefresh,\n      groupedUsersByDepartment,\n      getActiveContacts,\n      loadAllUsers,\n      hiddenCalendarEvents,\n      handleCalendarEventAdded,\n      handleCalendarEventHidden\n    }\n  }\n}\n</script>\n\n<style scoped>\n.chat-container {\n  height: calc(100vh - 64px); /* 减去顶部导航栏的高度 */\n  width: 100%;\n  padding: 20px;\n  overflow: hidden;\n  box-sizing: border-box;\n}\n\n.chat-card {\n  height: 100%;\n  width: 100%;\n  border-radius: 8px;\n  margin: 0;\n  overflow: hidden;\n  box-shadow: 0 2px 12px var(--shadow-color) !important;\n}\n\n.chat-card :deep(.el-card__body) {\n  height: 100%;\n  padding: 0;\n}\n\n.chat-layout {\n  display: flex;\n  height: 100%;\n  width: 100%;\n}\n\n/* 侧边栏样式 */\n.chat-sidebar {\n  width: 280px;\n  border-right: 1px solid var(--border-color);\n  display: flex;\n  flex-direction: column;\n  background-color: var(--bg-color);\n  height: 100%;\n  overflow: hidden;\n}\n\n.search-box {\n  padding: 15px;\n  border-bottom: 1px solid var(--border-color);\n}\n\n.chat-tabs {\n  display: flex;\n  border-bottom: 1px solid var(--border-color);\n}\n\n.chat-tab {\n  flex: 1;\n  text-align: center;\n  padding: 12px;\n  cursor: pointer;\n  font-weight: 500;\n  color: var(--text-color-secondary);\n  transition: all 0.3s ease;\n}\n\n.chat-tab.active {\n  color: var(--el-color-primary);\n  border-bottom: 2px solid var(--el-color-primary);\n}\n\n.contacts-list {\n  flex: 1;\n  overflow-y: auto;\n  padding: 0;\n}\n\n.contact-item {\n  display: flex;\n  padding: 15px;\n  border-bottom: 1px solid var(--border-color-light);\n  cursor: pointer;\n  transition: all 0.2s ease;\n  border-color: var(--border-color);\n}\n\n.contact-item:hover {\n  background-color: var(--hover-color);\n}\n\n.contact-item.active {\n  background-color: var(--primary-color-light, #f0f7ff);\n}\n\n.contact-avatar {\n  position: relative;\n  margin-right: 12px;\n}\n\n.avatar {\n  width: 40px;\n  height: 40px;\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n  font-weight: bold;\n}\n\n.avatar.small {\n  width: 32px;\n  height: 32px;\n  font-size: 12px;\n}\n\n.avatar-initial {\n  font-size: 16px;\n}\n\n.contact-status {\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  width: 10px;\n  height: 10px;\n  border-radius: 50%;\n  border: 2px solid var(--bg-color);\n}\n\n.status-online {\n  background-color: #28a745;\n}\n\n.status-offline {\n  background-color: #6c757d;\n}\n\n.status-busy {\n  background-color: #dc3545;\n}\n\n.status-away {\n  background-color: #fd7e14;\n}\n\n.contact-info {\n  flex: 1;\n  overflow: hidden;\n}\n\n.contact-name {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 5px;\n}\n\n.contact-name span {\n  font-weight: 500;\n}\n\n.time {\n  font-size: 12px;\n  color: var(--text-color-tertiary);\n}\n\n.contact-message {\n  display: flex;\n  justify-content: space-between;\n  color: var(--text-color-secondary);\n  font-size: 13px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.message-badge {\n  margin-left: 5px;\n}\n\n/* 聊天内容样式 */\n.chat-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  background-color: var(--bg-color-secondary);\n  height: 100%;\n  overflow: hidden;\n}\n\n.chat-header {\n  display: flex;\n  align-items: center;\n  padding: 15px;\n  border-bottom: 1px solid var(--border-color);\n  background-color: var(--bg-color);\n}\n\n.chat-header .contact-info {\n  margin-right: auto;\n}\n\n.chat-header h6 {\n  margin: 0;\n  font-size: 16px;\n  color: var(--text-color);\n}\n\n.chat-header p {\n  margin: 0;\n  font-size: 12px;\n  color: var(--text-color-tertiary);\n}\n\n.chat-actions {\n  display: flex;\n  gap: 10px;\n}\n\n.chat-messages {\n  flex: 1;\n  overflow-y: auto;\n  padding: 20px;\n  max-height: calc(100% - 150px); /* 调整聊天框高度 */\n  display: flex;\n  flex-direction: column;\n}\n\n.message {\n  margin-bottom: 20px;\n}\n\n.message-container {\n  display: flex;\n}\n\n.message-sent .message-container {\n  flex-direction: row-reverse;\n}\n\n.message-avatar {\n  margin-right: 10px;\n  flex-shrink: 0;\n}\n\n.message-sent .message-avatar {\n  margin-right: 0;\n  margin-left: 10px;\n}\n\n.message-content-wrapper {\n  max-width: 70%;\n}\n\n.message-content {\n  padding: 12px 15px;\n  border-radius: 18px;\n  position: relative;\n  word-break: break-word;\n}\n\n.message-content.received {\n  background-color: var(--bg-color-tertiary);\n  border-top-left-radius: 4px;\n  color: var(--text-color);\n}\n\n.message-content.sent {\n  background-color: var(--el-color-primary);\n  color: white;\n  border-top-right-radius: 4px;\n}\n\n.message-time {\n  font-size: 12px;\n  color: var(--text-color-tertiary);\n  margin-top: 5px;\n  text-align: right;\n}\n\n.message-sent .message-time {\n  text-align: right;\n}\n\n.message-received .message-time {\n  text-align: left;\n}\n\n.message-image img {\n  max-width: 100%;\n  max-height: 300px;\n  border-radius: 8px;\n}\n\n.message-file {\n  display: flex;\n  align-items: center;\n  background-color: var(--bg-color-tertiary);\n  padding: 8px 12px;\n  border-radius: 8px;\n  cursor: pointer;\n}\n\n.message-file .el-icon {\n  font-size: 24px;\n  margin-right: 10px;\n}\n\n.file-size {\n  margin-left: 8px;\n  font-size: 12px;\n  opacity: 0.8;\n}\n\n.message-knowledge {\n  display: flex;\n  align-items: center;\n  background-color: var(--bg-color-tertiary);\n  padding: 10px;\n  border-radius: 8px;\n  cursor: pointer;\n}\n\n.message-knowledge .el-icon {\n  font-size: 24px;\n  margin-right: 10px;\n}\n\n.knowledge-info {\n  flex: 1;\n}\n\n.knowledge-title {\n  font-weight: 500;\n  margin-bottom: 5px;\n}\n\n.knowledge-desc {\n  font-size: 12px;\n  opacity: 0.8;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 200px;\n}\n\n.chat-input {\n  padding: 15px;\n  background-color: var(--bg-color);\n  border-top: 1px solid var(--border-color);\n  display: flex;\n  flex-direction: column;\n  min-height: 150px; /* 确保输入框有足够高度 */\n}\n\n.chat-tools {\n  display: flex;\n  gap: 10px;\n  margin-bottom: 10px;\n}\n\n.input-area {\n  margin-bottom: 10px;\n  flex: 1;\n}\n\n.send-button {\n  display: flex;\n  justify-content: flex-end;\n}\n\n.empty-chat {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: #999;\n}\n\n.empty-illustration {\n  margin-bottom: 20px;\n  color: #ddd;\n}\n\n.empty-chat h4 {\n  margin: 0 0 10px;\n}\n\n.empty-chat p {\n  margin: 0;\n  font-size: 14px;\n}\n\n.empty-contacts {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  color: #999;\n}\n\n.empty-icon {\n  margin-bottom: 20px;\n  color: #ddd;\n}\n\n.empty-contacts h4 {\n  margin: 0 0 10px;\n}\n\n.empty-contacts p {\n  margin: 0;\n  font-size: 14px;\n}\n\n.loading-container {\n  flex: 1;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.empty-messages {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 100%;\n}\n\n.loading-messages {\n  flex: 1;\n  padding: 20px;\n}\n\n.mt-3 {\n  margin-top: 15px;\n}\n\n.search-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.search-header .el-input {\n  flex: 1;\n}\n\n.chat-header-actions {\n  margin-bottom: 10px;\n}\n\n.refresh-action {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-top: 5px;\n}\n\n.department-group {\n  margin-bottom: 10px;\n  border-color: var(--border-color);\n}\n\n.department-header {\n  padding: 5px 15px;\n  font-size: 13px;\n  color: var(--text-color-secondary);\n  background-color: var(--bg-color-tertiary);\n  border-radius: 4px;\n  margin-bottom: 5px;\n  font-weight: 500;\n  background-color: var(--bg-color-tertiary) !important;\n}\n\n.group-actions {\n  display: flex;\n  align-items: center;\n  margin-left: auto;\n  margin-right: 5px;\n}\n\n.group-action-btn {\n  padding: 6px;\n  color: #909399;\n}\n\n.group-action-btn:hover {\n  color: #409EFF;\n}\n\n/* 添加对话框全局样式以适配深色模式 */\n:deep(.el-dialog) {\n  background-color: var(--bg-color);\n  color: var(--text-color);\n}\n\n:deep(.el-dialog__title) {\n  color: var(--text-color);\n}\n\n:deep(.el-dialog__body) {\n  color: var(--text-color);\n}\n\n/* 表格样式适配深色模式 */\n:deep(.el-table) {\n  background-color: var(--bg-color);\n  color: var(--text-color);\n}\n\n:deep(.el-table th.el-table__cell) {\n  background-color: var(--bg-color-tertiary);\n}\n\n:deep(.el-table tr) {\n  background-color: var(--bg-color);\n}\n\n:deep(.el-table td.el-table__cell) {\n  background-color: var(--bg-color);\n  border-bottom: 1px solid var(--border-color);\n}\n\n/* 修复输入框和下拉菜单 */\n:deep(.el-select .el-input__wrapper) {\n  background-color: var(--bg-color-secondary);\n}\n\n:deep(.el-select-dropdown) {\n  background-color: var(--bg-color-secondary);\n  border-color: var(--border-color);\n}\n\n:deep(.el-select-dropdown__item) {\n  color: var(--text-color);\n}\n\n:deep(.el-select-dropdown__item.hover),\n:deep(.el-select-dropdown__item:hover) {\n  background-color: var(--hover-color);\n}\n\n:deep(.el-input__wrapper) {\n  background-color: var(--bg-color-secondary) !important;\n  box-shadow: 0 0 0 1px var(--border-color) inset;\n}\n\n:deep(.el-input__inner) {\n  color: var(--text-color);\n}\n\n:deep(.el-select__input) {\n  color: var(--text-color) !important;\n}\n\n:deep(.el-textarea__inner) {\n  background-color: var(--bg-color-secondary);\n  color: var(--text-color);\n  border-color: var(--border-color);\n}\n\n/* 修复空白提示和图标颜色 */\n.empty-icon {\n  color: var(--text-color-tertiary);\n}\n\n:deep(.el-icon) {\n  color: inherit;\n}\n\n:deep(.el-button--primary) {\n  color: white;\n}\n\n.chat-header h6 {\n  color: var(--text-color);\n}\n\n/* 修复badge和标签 */\n:deep(.el-badge__content) {\n  background-color: var(--error-color, #ef4444);\n}\n\n:deep(.el-tag) {\n  background-color: var(--primary-color-light);\n  border-color: var(--primary-color-light);\n  color: var(--primary-color);\n}\n\n/* 修复下拉菜单的样式 */\n:deep(.el-popper.is-light) {\n  background-color: var(--bg-color-tertiary);\n  border-color: var(--border-color);\n}\n\n:deep(.el-popper__arrow::before) {\n  background-color: var(--bg-color-tertiary);\n  border-color: var(--border-color);\n}\n\n/* 修复搜索框内图标颜色 */\n.search-box :deep(.el-input__prefix-inner) {\n  color: var(--text-color-tertiary);\n}\n\n/* 修复表单组件 */\n:deep(.el-input),\n:deep(.el-select) {\n  --el-fill-color-blank: var(--bg-color-tertiary);\n  --el-text-color-regular: var(--text-color);\n  --el-border-color: var(--border-color);\n  --el-border-color-hover: var(--primary-color);\n  --el-fill-color-light: var(--bg-color-tertiary);\n}\n\n/* 修复部门组标题 */\n.department-header {\n  background-color: var(--bg-color-tertiary) !important;\n}\n\n/* 修复El-Card组件样式 */\n:deep(.el-card) {\n  --el-card-bg-color: var(--bg-color);\n  background-color: var(--bg-color);\n  color: var(--text-color);\n  border-color: var(--border-color);\n}\n\n/* 修复El-Alert样式 */\n:deep(.el-alert) {\n  --el-alert-bg-color: var(--bg-color-tertiary);\n  color: var(--text-color);\n}\n\n:deep(.el-alert--info) {\n  --el-alert-bg-color: var(--bg-color-tertiary);\n}\n\n:deep(.el-empty__image svg) {\n  fill: var(--text-color-tertiary);\n}\n\n/* 修复下拉菜单 */\n:deep(.el-dropdown-menu) {\n  background-color: var(--bg-color-tertiary);\n  border-color: var(--border-color);\n}\n\n:deep(.el-dropdown-menu__item) {\n  color: var(--text-color);\n}\n\n:deep(.el-dropdown-menu__item:hover) {\n  background-color: var(--hover-color);\n}\n\n:deep(.el-dropdown-menu__item--divided:before) {\n  background-color: var(--border-color);\n}\n\n:deep(.el-dropdown-menu__item.is-disabled) {\n  color: var(--text-color-tertiary);\n}\n\n:deep(.el-divider) {\n  background-color: var(--border-color);\n}\n\n/* 修复消息框 */\n:deep(.el-message-box) {\n  background-color: var(--bg-color);\n  border-color: var(--border-color);\n}\n\n:deep(.el-message-box__title) {\n  color: var(--text-color);\n}\n\n:deep(.el-message-box__message) {\n  color: var(--text-color);\n}\n\n:deep(.el-message) {\n  background-color: var(--bg-color);\n  border-color: var(--border-color);\n}\n\n:deep(.el-message__content) {\n  color: var(--text-color);\n}\n\n/* 修复输入区域的阴影 */\n.el-textarea__wrapper {\n  box-shadow: 0 0 0 1px var(--border-color) inset !important;\n}\n</style> "],"mappings":";;;;;;;;;;;AAgZA,SAASA,GAAG,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,SAAS,EAAEC,eAAe,EAAEC,KAAI,QAAS,KAAI;AAC/E,SAASC,QAAO,QAAS,MAAK;AAC9B,SAASC,SAAS,EAAEC,YAAW,QAAS,cAAa;AACrD,SACEC,MAAM,EAAEC,KAAK,EAAEC,WAAW,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,aAAa,EAC/DC,YAAY,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,aAAa,EAAEC,OAAO,EAAEC,UAAU,EAAEC,cAAc,EACtFC,OAAO,EAAEC,UAAS,QACb,yBAAwB;AAC/B,SACEC,eAAe,EACfC,cAAc,EACdC,eAAe,EACfC,eAAe,EACfC,gBAAgB,EAChBC,oBAAoB,EACpBC,mBAAkB,QACb,YAAW;AAClB,SAASC,gBAAe,QAAS,iBAAgB;AACjD,SAASC,QAAO,QAAS,YAAW;AACpC,OAAOC,OAAM,MAAO,iBAAgB;AACpC,OAAOC,iBAAgB,MAAO,oCAAmC;AAEjE,eAAe;EACbC,IAAI,EAAE,MAAM;EACZC,UAAU,EAAE;IACVF;EACF,CAAC;EACDG,KAAKA,CAAA,EAAG;IACN,MAAMC,KAAI,GAAIhC,QAAQ,CAAC;IACvB,MAAMiC,WAAU,GAAItC,QAAQ,CAAC,MAAMqC,KAAK,CAACE,OAAO,CAACC,IAAI;;IAErD;IACA,MAAMC,QAAO,GAAI1C,GAAG,CAAC,IAAI;IAEzB,MAAM2C,WAAU,GAAI3C,GAAG,CAAC,EAAE;IAC1B,MAAM4C,SAAQ,GAAI5C,GAAG,CAAC,CAAC;IACvB,MAAM6C,eAAc,GAAI7C,GAAG,CAAC,IAAI;IAChC,MAAM8C,YAAW,GAAI9C,GAAG,CAAC,EAAE;IAC3B,MAAM+C,gBAAe,GAAI/C,GAAG,CAAC,IAAI;IACjC,MAAMgD,SAAQ,GAAIhD,GAAG,CAAC,IAAI;IAC1B,MAAMiD,UAAS,GAAIjD,GAAG,CAAC,IAAI;IAC3B,MAAMkD,QAAO,GAAIlD,GAAG,CAAC,EAAE;IACvB,MAAMmD,OAAM,GAAInD,GAAG,CAAC,KAAK;IACzB,MAAMoD,YAAW,GAAIpD,GAAG,CAAC,EAAE;IAC3B,MAAMqD,aAAY,GAAIrD,GAAG,CAAC,IAAI;;IAE9B;IACA,MAAMsD,sBAAqB,GAAItD,GAAG,CAAC,KAAK;IACxC,MAAMuD,gBAAe,GAAIvD,GAAG,CAAC,KAAK;IAClC,MAAMwD,aAAY,GAAIxD,GAAG,CAAC,EAAE;IAC5B,MAAMyD,iBAAgB,GAAIzD,GAAG,CAAC,IAAI;;IAElC;IACA,MAAM0D,IAAG,GAAI1D,GAAG,CAAC,CAAC,MAAM,EAAE,IAAI,CAAC;;IAE/B;IACA,MAAM2D,QAAO,GAAI3D,GAAG,CAAC,EAAE;IACvB;IACA,MAAM4D,aAAY,GAAI5D,GAAG,CAAC,EAAE;;IAE5B;IACA,MAAM6D,cAAa,GAAI5D,QAAQ,CAAC,MAAM;MACpC,IAAI4C,eAAe,CAACiB,KAAI,KAAM,IAAI,EAAE,OAAO,CAAC;MAC5C,OAAOH,QAAQ,CAACG,KAAK,CAACC,IAAI,CAACC,CAAA,IAAKA,CAAC,CAACC,EAAC,KAAMpB,eAAe,CAACiB,KAAK,KAAK,CAAC;IACtE,CAAC;;IAED;IACA,MAAMI,MAAK,GAAIjE,QAAQ,CAAC,MAAM;MAAA,IAAAkE,eAAA;MAC5B,OAAO,EAAAA,eAAA,GAAAzB,QAAQ,CAACoB,KAAK,cAAAK,eAAA,uBAAdA,eAAA,CAAgBF,EAAC,KAAK,IAAG;IAClC,CAAC;;IAED;IACA,MAAMG,gBAAe,GAAInE,QAAQ,CAAC,MAAM;MACtC,IAAI,CAAC0C,WAAW,CAACmB,KAAK,EAAE,OAAOH,QAAQ,CAACG,KAAI;MAC5C,OAAOH,QAAQ,CAACG,KAAK,CAACO,MAAM,CAACC,OAAM,IACjCA,OAAO,CAACnC,IAAI,CAACoC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAC7B,WAAW,CAACmB,KAAK,CAACS,WAAW,CAAC,CAAC,CACrE;IACF,CAAC;;IAED;IACA,MAAME,iBAAgB,GAAIxE,QAAQ,CAAC,MAAM;MACvC,IAAI2C,SAAS,CAACkB,KAAI,KAAM,CAAC,EAAE;QACzB,OAAOM,gBAAgB,CAACN,KAAI;MAC9B,OAAO,IAAIlB,SAAS,CAACkB,KAAI,KAAM,CAAC,EAAE;QAChC,OAAOM,gBAAgB,CAACN,KAAK,CAACO,MAAM,CAACC,OAAM,IAAK,CAACA,OAAO,CAACI,OAAO;MAClE;MACA,OAAON,gBAAgB,CAACN,KAAI;IAC9B,CAAC;;IAGD;IACA,MAAMa,wBAAuB,GAAI1E,QAAQ,CAAC,MAAM;MAC9C;MACA,MAAM2E,QAAO,GAAI,IAAIC,GAAG,CAAC,CAAC;;MAE1B;MACAT,gBAAgB,CAACN,KAAI,CAClBO,MAAM,CAACC,OAAM,IAAK,CAACA,OAAO,CAACI,OAAO,EAClCI,OAAO,CAACR,OAAM,IAAK;QAClB;QACA,IAAI5B,QAAQ,CAACoB,KAAI,IAAKQ,OAAO,CAACJ,MAAK,KAAMxB,QAAQ,CAACoB,KAAK,CAACG,EAAE,EAAE;UAC1D;QACF;QACA;QACAW,QAAQ,CAACG,GAAG,CAACT,OAAO,CAACJ,MAAK,IAAKI,OAAO,CAACL,EAAE,EAAEK,OAAO,CAAC;MACrD,CAAC,CAAC;;MAEJ;MACAV,aAAa,CAACE,KAAK,CAACgB,OAAO,CAACE,SAAQ,IAAK;QACvC;QACA,IAAItC,QAAQ,CAACoB,KAAI,IAAKkB,SAAS,CAACf,EAAC,KAAMvB,QAAQ,CAACoB,KAAK,CAACG,EAAE,EAAE;UACxD;QACF;;QAEA;QACA,IAAI,CAACW,QAAQ,CAACK,GAAG,CAACD,SAAS,CAACf,EAAE,CAAC,EAAE;UAC/B;UACA,MAAMK,OAAM,GAAI;YACdL,EAAE,EAAE,OAAM,GAAIe,SAAS,CAACf,EAAE;YAAE;YAC5BC,MAAM,EAAEc,SAAS,CAACf,EAAE;YACpB9B,IAAI,EAAE,CAAC,CAAC6C,SAAS,CAACE,UAAS,IAAK,EAAE,IAAI,GAAE,IAAKF,SAAS,CAACG,SAAQ,IAAK,EAAE,CAAC,EAAEC,IAAI,CAAC,KAAKJ,SAAS,CAACK,QAAO,IAAK,QAAQ;YACjHC,OAAO,EAAG,CAACN,SAAS,CAACE,UAAS,IAAKF,SAAS,CAACK,QAAO,IAAK,QAAQ,EAAE,CAAC,CAAE;YACtEE,MAAM,EAAEP,SAAS,CAACO,MAAK,IAAK,EAAE;YAC9BC,KAAK,EAAEC,cAAc,CAACT,SAAS,CAACf,EAAE,CAAC;YACnCyB,MAAM,EAAE,QAAQ;YAChBC,WAAW,EAAE,EAAE;YACfC,QAAQ,EAAE,EAAE;YACZC,MAAM,EAAE,CAAC;YACTnB,OAAO,EAAE,KAAK;YACdoB,UAAU,EAAEd,SAAS,CAACc,UAAS,IAAK;UACtC,CAAC;UACDlB,QAAQ,CAACG,GAAG,CAACC,SAAS,CAACf,EAAE,EAAEK,OAAO,CAAC;QACrC;MACF,CAAC,CAAC;;MAEF;MACA,MAAMyB,YAAW,GAAI,CAAC,CAAC;;MAEvB;MACAC,KAAK,CAACC,IAAI,CAACrB,QAAQ,CAACsB,MAAM,CAAC,CAAC,CAAC,CAACpB,OAAO,CAACrC,IAAG,IAAK;QAC5C,MAAM0D,cAAa,GAAI1D,IAAI,CAACqD,UAAS,IAAK,IAAI;QAC9C,IAAI,CAACC,YAAY,CAACI,cAAc,CAAC,EAAE;UACjCJ,YAAY,CAACI,cAAc,IAAI,EAAE;QACnC;QACAJ,YAAY,CAACI,cAAc,CAAC,CAACC,IAAI,CAAC3D,IAAI,CAAC;MACzC,CAAC,CAAC;MAEF,OAAOsD,YAAY;IACrB,CAAC;;IAED;IACA,MAAMM,KAAI,GAAIrE,QAAQ,CAAC;;IAEvB;IACA,IAAIsE,eAAc,GAAI,IAAG;;IAEzB;IACAlG,eAAe,CAAC,MAAM;MACpB,IAAIkG,eAAe,EAAE;QACnBC,aAAa,CAACD,eAAe;MAC/B;IACF,CAAC;;IAED;IACAnG,SAAS,CAAC,YAAY;MACpB,IAAI;QACF;QACA,MAAMqG,QAAO,GAAI,MAAMC,gBAAgB,CAAC;;QAExC;QACA,IAAI,CAACD,QAAQ,EAAE;UACbjG,SAAS,CAACmG,KAAK,CAAC,kBAAkB;UAClC;QACF;QAEAC,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEJ,QAAQ;;QAErC;QACA,IAAI,CAAC9D,QAAQ,CAACoB,KAAI,IAAK,CAACpB,QAAQ,CAACoB,KAAK,CAACG,EAAE,EAAE;UACzC0C,OAAO,CAACD,KAAK,CAAC,YAAY,EAAEhE,QAAQ,CAACoB,KAAK;UAC1CvD,SAAS,CAACmG,KAAK,CAAC,kBAAkB;UAClC;QACF,OAAO;UACLC,OAAO,CAACC,GAAG,CAAC,cAAc,EAAElE,QAAQ,CAACoB,KAAK;QAC5C;;QAEA;QACA,MAAM+C,YAAY,CAAC;;QAEnB;QACA,MAAMC,gBAAgB,CAAC;;QAEvB;QACA,MAAMC,SAAQ,GAAIV,KAAK,CAACW,KAAK,CAACC,OAAM,IAAKZ,KAAK,CAACW,KAAK,CAAC/C,EAAC;QACtD,IAAI8C,SAAS,EAAE;UACb;UACA,MAAMG,YAAW,GAAIvD,QAAQ,CAACG,KAAK,CAACC,IAAI,CAACC,CAAA,IAAKA,CAAC,CAACC,EAAC,KAAMkD,QAAQ,CAACJ,SAAS,CAAC;UAC1E,IAAIG,YAAY,EAAE;YAChB;YACArE,eAAe,CAACiB,KAAI,GAAIoD,YAAY,CAACjD,EAAC;YACtC;YACA,MAAMmD,gBAAgB,CAACL,SAAS;UAClC,OAAO;YACL;YACAJ,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEG,SAAS;YACtC,MAAMK,gBAAgB,CAACL,SAAS;UAClC;QACF;;QAEA;QACAT,eAAc,GAAIe,WAAW,CAAC,YAAY;UACxC,IAAIxE,eAAe,CAACiB,KAAK,EAAE;YACzB,MAAMsD,gBAAgB,CAACvE,eAAe,CAACiB,KAAK;UAC9C;UACA,MAAMgD,gBAAgB,CAAC;QACzB,CAAC,EAAE,KAAK;;QAER;QACA,MAAM5G,QAAQ,CAAC;QACfoH,cAAc,CAAC;MACjB,EAAE,OAAOZ,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,YAAY,EAAEA,KAAK;QACjCnG,SAAS,CAACmG,KAAK,CAAC,aAAY,GAAIA,KAAK,CAACa,OAAO;MAC/C;IACF,CAAC;;IAED;IACA,MAAMd,gBAAe,GAAI,MAAAA,CAAA,KAAY;MACnC,IAAI;QACFE,OAAO,CAACC,GAAG,CAAC,eAAe;;QAE3B;QACA,MAAMY,KAAI,GAAIC,YAAY,CAACC,OAAO,CAAC,OAAO;QAC1C,IAAI,CAACF,KAAK,EAAE;UACVb,OAAO,CAACgB,IAAI,CAAC,kBAAkB;UAC/BpH,SAAS,CAACqH,OAAO,CAAC,iBAAiB;UACnC,OAAO,IAAG;QACZ;QAEA,MAAMC,QAAO,GAAI,MAAM5F,OAAO,CAAC;UAC7B6F,GAAG,EAAE,qBAAqB;UAC1BC,MAAM,EAAE;QACV,CAAC;QAEDpB,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEiB,QAAQ;;QAEjC;QACA,IAAIrB,QAAO,GAAI,IAAG;QAClB,IAAIqB,QAAQ,CAACG,IAAG,IAAKH,QAAQ,CAACG,IAAI,CAAC/D,EAAE,EAAE;UACrC;UACAuC,QAAO,GAAIqB,QAAQ,CAACG,IAAG;UACvBrB,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAEJ,QAAQ;QACxC,OAAO,IAAIqB,QAAQ,CAACG,IAAG,IAAKH,QAAQ,CAACG,IAAI,CAACA,IAAG,IAAKH,QAAQ,CAACG,IAAI,CAACA,IAAI,CAAC/D,EAAE,EAAE;UACvE;UACAuC,QAAO,GAAIqB,QAAQ,CAACG,IAAI,CAACA,IAAG;UAC5BrB,OAAO,CAACC,GAAG,CAAC,kBAAkB,EAAEJ,QAAQ;QAC1C,OAAO,IAAIqB,QAAQ,CAAC5D,EAAE,EAAE;UACtB;UACAuC,QAAO,GAAIqB,QAAO;UAClBlB,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEJ,QAAQ;QACnC,OAAO;UACLG,OAAO,CAACD,KAAK,CAAC,eAAe,EAAEmB,QAAQ;UACvC,MAAM,IAAII,KAAK,CAAC,UAAU;QAC5B;QAEA,IAAI,CAACzB,QAAO,IAAK,CAACA,QAAQ,CAACvC,EAAE,EAAE;UAC7B0C,OAAO,CAACD,KAAK,CAAC,YAAY,EAAEF,QAAQ;UACpC,MAAM,IAAIyB,KAAK,CAAC,SAAS;QAC3B;;QAEA;QACAvF,QAAQ,CAACoB,KAAI,GAAI0C,QAAO;;QAExB;QACAiB,YAAY,CAACS,OAAO,CAAC,MAAM,EAAEC,IAAI,CAACC,SAAS,CAAC5B,QAAQ,CAAC;QAErDG,OAAO,CAACC,GAAG,CAAC,UAAU,EAAElE,QAAQ,CAACoB,KAAK;QACtC,OAAO0C,QAAO;MAChB,EAAE,OAAOE,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,aAAa,EAAEA,KAAK;QAClCnG,SAAS,CAACmG,KAAK,CAAC,YAAW,IAAKA,KAAK,CAACa,OAAM,IAAK,MAAM,CAAC;QACxD,OAAO,IAAG;MACZ;IACF;;IAEA;IACA,MAAMT,gBAAe,GAAI,MAAAA,CAAA,KAAY;MACnC,IAAI;QACF3D,OAAO,CAACW,KAAI,GAAI,IAAG;QACnB6C,OAAO,CAACC,GAAG,CAAC,eAAe;QAE3B,MAAMiB,QAAO,GAAI,MAAMrG,eAAe,CAAC;QACvCmF,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEiB,QAAQ;;QAEjC;QACA,IAAI,CAACA,QAAQ,EAAE;UACblB,OAAO,CAACD,KAAK,CAAC,aAAa;UAC3B/C,QAAQ,CAACG,KAAI,GAAI,EAAC;UAClB;QACF;QAEA,IAAIkE,IAAG;QACP,IAAIH,QAAQ,CAACQ,OAAM,IAAKR,QAAQ,CAACG,IAAI,EAAE;UACrCA,IAAG,GAAIH,QAAQ,CAACG,IAAG;UACnBrB,OAAO,CAACC,GAAG,CAAC,cAAc,EAAEoB,IAAI;QAClC,OAAO;UACLA,IAAG,GAAIH,QAAO;UACdlB,OAAO,CAACC,GAAG,CAAC,cAAc,EAAEoB,IAAI;QAClC;;QAEA;QACA5E,YAAY,CAACU,KAAI,GAAIkE,IAAG;;QAExB;QACA,IAAIA,IAAG,IAAKhC,KAAK,CAACsC,OAAO,CAACN,IAAI,CAACO,OAAO,CAAC,EAAE;UACvC5B,OAAO,CAACC,GAAG,CAAC,kBAAkB,EAAEoB,IAAI,CAACO,OAAO,CAACC,MAAM;UACnD;UACA7E,QAAQ,CAACG,KAAI,GAAIkE,IAAI,CAACO,OAAO,CAACE,GAAG,CAACxB,OAAM,IAAK;YAC3C;YACA,IAAIyB,gBAAe,GAAI,IAAG;YAC1B,IAAIzB,OAAO,CAAC0B,YAAW,IAAK3C,KAAK,CAACsC,OAAO,CAACrB,OAAO,CAAC0B,YAAY,CAAC,EAAE;cAC/D,IAAIjG,QAAQ,CAACoB,KAAI,IAAKpB,QAAQ,CAACoB,KAAK,CAACG,EAAE,EAAE;gBACvCyE,gBAAe,GAAIzB,OAAO,CAAC0B,YAAY,CAAC5E,IAAI,CAC1C6E,CAAA,IAAKA,CAAC,CAACnG,IAAG,IAAKmG,CAAC,CAACnG,IAAI,CAACwB,EAAC,KAAMvB,QAAQ,CAACoB,KAAK,CAACG,EAC9C;cACF,OAAO;gBACL;gBACAyE,gBAAe,GAAIzB,OAAO,CAAC0B,YAAY,CAAC,CAAC;cAC3C;YACF;;YAEA;YACA,IAAI1B,OAAO,CAAC4B,QAAQ,EAAE;cACpB,OAAO;gBACL5E,EAAE,EAAEgD,OAAO,CAAChD,EAAE;gBACd9B,IAAI,EAAE8E,OAAO,CAAC6B,KAAI,IAAK,IAAI;gBAC3BxD,OAAO,EAAE,CAAC2B,OAAO,CAAC6B,KAAI,IAAK,IAAI,EAAE,CAAC,CAAC;gBACnCvD,MAAM,EAAE,EAAE;gBACVwD,UAAU,EAAE,EAAE;gBACdvD,KAAK,EAAEC,cAAc,CAACwB,OAAO,CAAChD,EAAE,CAAC;gBACjCyB,MAAM,EAAE,QAAQ;gBAChBC,WAAW,EAAEsB,OAAO,CAAC+B,YAAW,GAAI/B,OAAO,CAAC+B,YAAY,CAACC,OAAM,GAAI,EAAE;gBACrErD,QAAQ,EAAEqB,OAAO,CAAC+B,YAAW,GAAIE,iBAAiB,CAACjC,OAAO,CAAC+B,YAAY,CAACG,UAAU,IAAID,iBAAiB,CAACjC,OAAO,CAACmC,UAAU,CAAC;gBAC3HvD,MAAM,EAAEoB,OAAO,CAACoC,YAAY;gBAC5B3E,OAAO,EAAE;cACX;YACF;;YAEA;YACA,IAAIgE,gBAAgB,EAAE;cACpB,MAAMjG,IAAG,GAAIiG,gBAAgB,CAACjG,IAAG;cACjC;cACA,IAAIsG,UAAS,GAAI,EAAE;cACnB,IAAItG,IAAI,CAAC8C,MAAM,EAAE;gBACf,MAAMA,MAAK,GAAI9C,IAAI,CAAC8C,MAAM;gBAC1B,IAAIA,MAAM,CAAC+D,UAAU,CAAC,SAAS,KAAK/D,MAAM,CAAC+D,UAAU,CAAC,UAAU,CAAC,EAAE;kBACjEP,UAAS,GAAIxD,MAAM;gBACrB,OAAO,IAAIA,MAAM,CAAC+D,UAAU,CAAC,GAAG,CAAC,EAAE;kBACjCP,UAAS,GAAI,GAAGQ,OAAO,CAACC,GAAG,CAACC,gBAAe,IAAK,uBAAuB,GAAGlE,MAAM,EAAE;gBACpF,OAAO;kBACLwD,UAAS,GAAI,GAAGQ,OAAO,CAACC,GAAG,CAACC,gBAAe,IAAK,uBAAuB,IAAIlE,MAAM,EAAE;gBACrF;cACF;cAEA,OAAO;gBACLtB,EAAE,EAAEgD,OAAO,CAAChD,EAAE;gBACdC,MAAM,EAAEzB,IAAI,CAACwB,EAAE;gBAAE;gBACjB9B,IAAI,EAAE,CAAC,CAACM,IAAI,CAACyC,UAAS,IAAK,EAAE,IAAI,GAAE,IAAKzC,IAAI,CAAC0C,SAAQ,IAAK,EAAE,CAAC,EAAEC,IAAI,CAAC,KAAK3C,IAAI,CAAC4C,QAAO,IAAK,QAAQ;gBAClGC,OAAO,EAAG,CAAC7C,IAAI,CAACyC,UAAS,IAAKzC,IAAI,CAAC4C,QAAO,IAAK,QAAQ,EAAE,CAAC,CAAE;gBAC5DE,MAAM,EAAE9C,IAAI,CAAC8C,MAAK,IAAK,EAAE;gBACzBwD,UAAU,EAAEA,UAAU;gBACtBvD,KAAK,EAAEC,cAAc,CAAChD,IAAI,CAACwB,EAAE,CAAC;gBAC9ByB,MAAM,EAAE,QAAQ;gBAChBC,WAAW,EAAEsB,OAAO,CAAC+B,YAAW,GAAI/B,OAAO,CAAC+B,YAAY,CAACC,OAAM,GAAI,EAAE;gBACrErD,QAAQ,EAAEqB,OAAO,CAAC+B,YAAW,GAAIE,iBAAiB,CAACjC,OAAO,CAAC+B,YAAY,CAACG,UAAU,IAAID,iBAAiB,CAACjC,OAAO,CAACmC,UAAU,CAAC;gBAC3HvD,MAAM,EAAEoB,OAAO,CAACoC,YAAY;gBAC5B3E,OAAO,EAAE,KAAK;gBACdoB,UAAU,EAAErD,IAAI,CAACqD,UAAS,CAAE;cAC9B;YACF;;YAEA;YACA,OAAO;cACL7B,EAAE,EAAEgD,OAAO,CAAChD,EAAE;cACd9B,IAAI,EAAE8E,OAAO,CAAC6B,KAAI,IAAK,IAAI;cAC3BxD,OAAO,EAAE,CAAC2B,OAAO,CAAC6B,KAAI,IAAK,IAAI,EAAE,CAAC,CAAC;cACnCvD,MAAM,EAAE,EAAE;cACVwD,UAAU,EAAE,EAAE;cACdvD,KAAK,EAAEC,cAAc,CAACwB,OAAO,CAAChD,EAAE,CAAC;cACjCyB,MAAM,EAAE,QAAQ;cAChBC,WAAW,EAAEsB,OAAO,CAAC+B,YAAW,GAAI/B,OAAO,CAAC+B,YAAY,CAACC,OAAM,GAAI,EAAE;cACrErD,QAAQ,EAAEqB,OAAO,CAAC+B,YAAW,GAAIE,iBAAiB,CAACjC,OAAO,CAAC+B,YAAY,CAACG,UAAU,IAAID,iBAAiB,CAACjC,OAAO,CAACmC,UAAU,CAAC;cAC3HvD,MAAM,EAAEoB,OAAO,CAACoC,YAAY;cAC5B3E,OAAO,EAAEuC,OAAO,CAAC4B;YACnB;UACF,CAAC;QACH,OAAO,IAAIb,IAAG,IAAKhC,KAAK,CAACsC,OAAO,CAACN,IAAI,CAAC,EAAE;UACtCrB,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAEoB,IAAI,CAACQ,MAAM;UAC5C;UACA7E,QAAQ,CAACG,KAAI,GAAIkE,IAAI,CAACS,GAAG,CAACxB,OAAM,IAAK;YACnC;YACA,IAAIyB,gBAAe,GAAI,IAAG;YAC1B,IAAIzB,OAAO,CAAC0B,YAAW,IAAK3C,KAAK,CAACsC,OAAO,CAACrB,OAAO,CAAC0B,YAAY,CAAC,EAAE;cAC/D,IAAIjG,QAAQ,CAACoB,KAAI,IAAKpB,QAAQ,CAACoB,KAAK,CAACG,EAAE,EAAE;gBACvCyE,gBAAe,GAAIzB,OAAO,CAAC0B,YAAY,CAAC5E,IAAI,CAC1C6E,CAAA,IAAKA,CAAC,CAACnG,IAAG,IAAKmG,CAAC,CAACnG,IAAI,CAACwB,EAAC,KAAMvB,QAAQ,CAACoB,KAAK,CAACG,EAC9C;cACF,OAAO;gBACL;gBACAyE,gBAAe,GAAIzB,OAAO,CAAC0B,YAAY,CAAC,CAAC;cAC3C;YACF;;YAEA;YACA,IAAI1B,OAAO,CAAC4B,QAAQ,EAAE;cACpB,OAAO;gBACL5E,EAAE,EAAEgD,OAAO,CAAChD,EAAE;gBACd9B,IAAI,EAAE8E,OAAO,CAAC6B,KAAI,IAAK,IAAI;gBAC3BxD,OAAO,EAAE,CAAC2B,OAAO,CAAC6B,KAAI,IAAK,IAAI,EAAE,CAAC,CAAC;gBACnCvD,MAAM,EAAE,EAAE;gBACVwD,UAAU,EAAE,EAAE;gBACdvD,KAAK,EAAEC,cAAc,CAACwB,OAAO,CAAChD,EAAE,CAAC;gBACjCyB,MAAM,EAAE,QAAQ;gBAChBC,WAAW,EAAEsB,OAAO,CAAC+B,YAAW,GAAI/B,OAAO,CAAC+B,YAAY,CAACC,OAAM,GAAI,EAAE;gBACrErD,QAAQ,EAAEqB,OAAO,CAAC+B,YAAW,GAAIE,iBAAiB,CAACjC,OAAO,CAAC+B,YAAY,CAACG,UAAU,IAAID,iBAAiB,CAACjC,OAAO,CAACmC,UAAU,CAAC;gBAC3HvD,MAAM,EAAEoB,OAAO,CAACoC,YAAY;gBAC5B3E,OAAO,EAAE;cACX;YACF;;YAEA;YACA,IAAIgE,gBAAgB,EAAE;cACpB,MAAMjG,IAAG,GAAIiG,gBAAgB,CAACjG,IAAG;cACjC;cACA,IAAIsG,UAAS,GAAI,EAAE;cACnB,IAAItG,IAAI,CAAC8C,MAAM,EAAE;gBACf,MAAMA,MAAK,GAAI9C,IAAI,CAAC8C,MAAM;gBAC1B,IAAIA,MAAM,CAAC+D,UAAU,CAAC,SAAS,KAAK/D,MAAM,CAAC+D,UAAU,CAAC,UAAU,CAAC,EAAE;kBACjEP,UAAS,GAAIxD,MAAM;gBACrB,OAAO,IAAIA,MAAM,CAAC+D,UAAU,CAAC,GAAG,CAAC,EAAE;kBACjCP,UAAS,GAAI,GAAGQ,OAAO,CAACC,GAAG,CAACC,gBAAe,IAAK,uBAAuB,GAAGlE,MAAM,EAAE;gBACpF,OAAO;kBACLwD,UAAS,GAAI,GAAGQ,OAAO,CAACC,GAAG,CAACC,gBAAe,IAAK,uBAAuB,IAAIlE,MAAM,EAAE;gBACrF;cACF;cAEA,OAAO;gBACLtB,EAAE,EAAEgD,OAAO,CAAChD,EAAE;gBACd9B,IAAI,EAAE,CAAC,CAACM,IAAI,CAACyC,UAAS,IAAK,EAAE,IAAI,GAAE,IAAKzC,IAAI,CAAC0C,SAAQ,IAAK,EAAE,CAAC,EAAEC,IAAI,CAAC,KAAK3C,IAAI,CAAC4C,QAAO,IAAK,QAAQ;gBAClGC,OAAO,EAAG,CAAC7C,IAAI,CAACyC,UAAS,IAAKzC,IAAI,CAAC4C,QAAO,IAAK,QAAQ,EAAE,CAAC,CAAE;gBAC5DE,MAAM,EAAE9C,IAAI,CAAC8C,MAAK,IAAK,EAAE;gBACzBwD,UAAU,EAAEA,UAAU;gBACtBvD,KAAK,EAAEC,cAAc,CAAChD,IAAI,CAACwB,EAAE,CAAC;gBAC9ByB,MAAM,EAAE,QAAQ;gBAChBC,WAAW,EAAEsB,OAAO,CAAC+B,YAAW,GAAI/B,OAAO,CAAC+B,YAAY,CAACC,OAAM,GAAI,EAAE;gBACrErD,QAAQ,EAAEqB,OAAO,CAAC+B,YAAW,GAAIE,iBAAiB,CAACjC,OAAO,CAAC+B,YAAY,CAACG,UAAU,IAAID,iBAAiB,CAACjC,OAAO,CAACmC,UAAU,CAAC;gBAC3HvD,MAAM,EAAEoB,OAAO,CAACoC,YAAY;gBAC5B3E,OAAO,EAAE;cACX;YACF;;YAEA;YACA,OAAO;cACLT,EAAE,EAAEgD,OAAO,CAAChD,EAAE;cACd9B,IAAI,EAAE8E,OAAO,CAAC6B,KAAI,IAAK,IAAI;cAC3BxD,OAAO,EAAE,CAAC2B,OAAO,CAAC6B,KAAI,IAAK,IAAI,EAAE,CAAC,CAAC;cACnCvD,MAAM,EAAE,EAAE;cACVwD,UAAU,EAAE,EAAE;cACdvD,KAAK,EAAEC,cAAc,CAACwB,OAAO,CAAChD,EAAE,CAAC;cACjCyB,MAAM,EAAE,QAAQ;cAChBC,WAAW,EAAEsB,OAAO,CAAC+B,YAAW,GAAI/B,OAAO,CAAC+B,YAAY,CAACC,OAAM,GAAI,EAAE;cACrErD,QAAQ,EAAEqB,OAAO,CAAC+B,YAAW,GAAIE,iBAAiB,CAACjC,OAAO,CAAC+B,YAAY,CAACG,UAAU,IAAID,iBAAiB,CAACjC,OAAO,CAACmC,UAAU,CAAC;cAC3HvD,MAAM,EAAEoB,OAAO,CAACoC,YAAY;cAC5B3E,OAAO,EAAEuC,OAAO,CAAC4B;YACnB;UACF,CAAC;QACH,OAAO;UACL;UACAlC,OAAO,CAACD,KAAK,CAAC,gBAAgB,EAAEsB,IAAI;UACpCrE,QAAQ,CAACG,KAAI,GAAI,EAAC;QACpB;QAEA6C,OAAO,CAACC,GAAG,CAAC,YAAY,EAAEjD,QAAQ,CAACG,KAAK;;QAExC;QACA,IAAIH,QAAQ,CAACG,KAAK,CAAC0E,MAAK,GAAI,CAAC,EAAE;UAC7B7E,QAAQ,CAACG,KAAK,CAAC4F,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKA,CAAC,CAAC/D,MAAK,GAAI8D,CAAC,CAAC9D,MAAM;QACnD;MACF,EAAE,OAAOa,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,WAAW,EAAEA,KAAK;QAChCnG,SAAS,CAACmG,KAAK,CAAC,YAAW,IAAKA,KAAK,CAACa,OAAM,IAAK,MAAM,CAAC;QACxD5D,QAAQ,CAACG,KAAI,GAAI,EAAC;MACpB,UAAU;QACRX,OAAO,CAACW,KAAI,GAAI,KAAI;MACtB;IACF;;IAEA;IACA,MAAMsD,gBAAe,GAAI,MAAOyC,MAAM,IAAK;MACzC,IAAI,CAACA,MAAM,EAAE;QACXlD,OAAO,CAACD,KAAK,CAAC,kBAAkB;QAChC;MACF;MAEA,IAAI;QACFvD,OAAO,CAACW,KAAI,GAAI,IAAG;QACnB6C,OAAO,CAACC,GAAG,CAAC,YAAYiD,MAAM,SAAS;QAEvC,MAAMhC,QAAO,GAAI,MAAMpG,cAAc,CAACoI,MAAM;QAC5ClD,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEiB,QAAQ;QAEjC,IAAI,CAACA,QAAQ,EAAE;UACblB,OAAO,CAACD,KAAK,CAAC,eAAe;UAC7BxD,QAAQ,CAACY,KAAI,GAAI,EAAC;UAClB;QACF;;QAEA;QACA,IAAIgG,WAAU,GAAI,EAAC;QACnB,IAAIC,WAAU,GAAI,IAAG;QAErB,IAAIlC,QAAQ,CAACG,IAAG,IAAKH,QAAQ,CAACG,IAAI,CAAC9E,QAAQ,EAAE;UAC3C;UACA4G,WAAU,GAAIjC,QAAQ,CAACG,IAAI,CAAC9E,QAAO;UACnC6G,WAAU,GAAIlC,QAAQ,CAACG,IAAG;UAC1BrB,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAEkD,WAAW,CAACtB,MAAM;QAClD,OAAO,IAAIX,QAAQ,CAACG,IAAG,IAAKH,QAAQ,CAACG,IAAI,CAACA,IAAG,IAAKH,QAAQ,CAACG,IAAI,CAACA,IAAI,CAAC9E,QAAQ,EAAE;UAC7E;UACA4G,WAAU,GAAIjC,QAAQ,CAACG,IAAI,CAACA,IAAI,CAAC9E,QAAO;UACxC6G,WAAU,GAAIlC,QAAQ,CAACG,IAAI,CAACA,IAAG;UAC/BrB,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAEkD,WAAW,CAACtB,MAAM;QAClD,OAAO,IAAIX,QAAQ,CAAC3E,QAAQ,EAAE;UAC5B;UACA4G,WAAU,GAAIjC,QAAQ,CAAC3E,QAAO;UAC9B6G,WAAU,GAAIlC,QAAO;UACrBlB,OAAO,CAACC,GAAG,CAAC,kBAAkB,EAAEkD,WAAW,CAACtB,MAAM;QACpD,OAAO;UACL7B,OAAO,CAACgB,IAAI,CAAC,cAAc,EAAEE,QAAQ;UACrClB,OAAO,CAACC,GAAG,CAAC,qBAAqB;;UAEjC;UACA,MAAMoD,qBAAoB,GAAI,CAAC,SAAS,EAAE,eAAe,EAAE,OAAO,EAAE,SAAS;UAC7E,KAAK,MAAMC,KAAI,IAAKD,qBAAqB,EAAE;YACzC,IAAInC,QAAQ,CAACoC,KAAK,KAAKjE,KAAK,CAACsC,OAAO,CAACT,QAAQ,CAACoC,KAAK,CAAC,CAAC,EAAE;cACrDtD,OAAO,CAACC,GAAG,CAAC,aAAaqD,KAAK,UAAU;cACxCH,WAAU,GAAIjC,QAAQ,CAACoC,KAAK;cAC5BF,WAAU,GAAIlC,QAAO;cACrB;YACF,OAAO,IAAIA,QAAQ,CAACG,IAAG,IAAKH,QAAQ,CAACG,IAAI,CAACiC,KAAK,KAAKjE,KAAK,CAACsC,OAAO,CAACT,QAAQ,CAACG,IAAI,CAACiC,KAAK,CAAC,CAAC,EAAE;cACvFtD,OAAO,CAACC,GAAG,CAAC,qBAAqBqD,KAAK,UAAU;cAChDH,WAAU,GAAIjC,QAAQ,CAACG,IAAI,CAACiC,KAAK;cACjCF,WAAU,GAAIlC,QAAQ,CAACG,IAAG;cAC1B;YACF;UACF;UAEA,IAAI8B,WAAW,CAACtB,MAAK,KAAM,CAAC,EAAE;YAC5B7B,OAAO,CAACgB,IAAI,CAAC,iBAAiB;UAChC;QACF;;QAEA;QACAmC,WAAW,CAAChF,OAAO,CAACyC,OAAM,IAAK;UAC7B,IAAIA,OAAO,CAAC2C,MAAK,IAAK3C,OAAO,CAAC2C,MAAM,CAAC3E,MAAM,EAAE;YAC3C,MAAMA,MAAK,GAAIgC,OAAO,CAAC2C,MAAM,CAAC3E,MAAM;YACpC,IAAIA,MAAM,CAAC+D,UAAU,CAAC,SAAS,KAAK/D,MAAM,CAAC+D,UAAU,CAAC,UAAU,CAAC,EAAE;cACjE/B,OAAO,CAAC2C,MAAM,CAACnB,UAAS,GAAIxD,MAAM;YACpC,OAAO,IAAIA,MAAM,CAAC+D,UAAU,CAAC,GAAG,CAAC,EAAE;cACjC/B,OAAO,CAAC2C,MAAM,CAACnB,UAAS,GAAI,GAAGQ,OAAO,CAACC,GAAG,CAACC,gBAAe,IAAK,uBAAuB,GAAGlE,MAAM,EAAE;YACnG,OAAO;cACLgC,OAAO,CAAC2C,MAAM,CAACnB,UAAS,GAAI,GAAGQ,OAAO,CAACC,GAAG,CAACC,gBAAe,IAAK,uBAAuB,IAAIlE,MAAM,EAAE;YACpG;UACF;QACF,CAAC,CAAC;;QAEF;QACAoB,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEmD,WAAW;QACpCpD,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEkD,WAAW;;QAEpC;QACA,IAAIC,WAAU,IAAK,CAACpG,QAAQ,CAACG,KAAK,CAACqG,IAAI,CAACnG,CAAA,IAAKA,CAAC,CAACC,EAAC,KAAMkD,QAAQ,CAAC0C,MAAM,CAAC,CAAC,EAAE;UACvElD,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAEmD,WAAW;;UAE1C;UACA,MAAM9C,OAAM,GAAI8C,WAAU;UAC1B;UACA,IAAIrB,gBAAe,GAAI,IAAG;;UAE1B;UACA,IAAIzB,OAAO,CAAC0B,YAAW,IAAK3C,KAAK,CAACsC,OAAO,CAACrB,OAAO,CAAC0B,YAAY,KAAK1B,OAAO,CAAC0B,YAAY,CAACH,MAAK,GAAI,KAAK9F,QAAQ,CAACoB,KAAK,EAAE;YACpH4E,gBAAe,GAAIzB,OAAO,CAAC0B,YAAY,CAAC5E,IAAI,CAAC6E,CAAA,IAAKA,CAAC,CAACnG,IAAG,IAAKmG,CAAC,CAACnG,IAAI,CAACwB,EAAC,KAAMvB,QAAQ,CAACoB,KAAK,CAACG,EAAE;UAC7F;UAEA,IAAImG,WAAU,GAAI,IAAG;;UAErB;UACA,IAAInD,OAAO,CAAC4B,QAAQ,EAAE;YACpBuB,WAAU,GAAI;cACZnG,EAAE,EAAEkD,QAAQ,CAAC0C,MAAM,CAAC;cACpB1H,IAAI,EAAE8E,OAAO,CAAC6B,KAAI,IAAK,IAAI;cAC3BxD,OAAO,EAAE,CAAC2B,OAAO,CAAC6B,KAAI,IAAK,IAAI,EAAE,CAAC,CAAC;cACnCvD,MAAM,EAAE,EAAE;cACVwD,UAAU,EAAE,EAAE;cACdvD,KAAK,EAAEC,cAAc,CAAC0B,QAAQ,CAAC0C,MAAM,CAAC,CAAC;cACvCnE,MAAM,EAAE,QAAQ;cAChBC,WAAW,EAAEsB,OAAO,CAAC+B,YAAW,GAAI/B,OAAO,CAAC+B,YAAY,CAACC,OAAM,GAAI,EAAE;cACrErD,QAAQ,EAAEsD,iBAAiB,CAACjC,OAAO,CAACmC,UAAU,CAAC;cAC/CvD,MAAM,EAAE,CAAC;cACTnB,OAAO,EAAE;YACX;YACF;UACA,OAAO,IAAIgE,gBAAe,IAAKA,gBAAgB,CAACjG,IAAI,EAAE;YACpD,MAAMA,IAAG,GAAIiG,gBAAgB,CAACjG,IAAG;YACjC;YACA,IAAIsG,UAAS,GAAI,EAAE;YACnB,IAAItG,IAAI,CAAC8C,MAAM,EAAE;cACf,MAAMA,MAAK,GAAI9C,IAAI,CAAC8C,MAAM;cAC1B,IAAIA,MAAM,CAAC+D,UAAU,CAAC,SAAS,KAAK/D,MAAM,CAAC+D,UAAU,CAAC,UAAU,CAAC,EAAE;gBACjEP,UAAS,GAAIxD,MAAM;cACrB,OAAO,IAAIA,MAAM,CAAC+D,UAAU,CAAC,GAAG,CAAC,EAAE;gBACjCP,UAAS,GAAI,GAAGQ,OAAO,CAACC,GAAG,CAACC,gBAAe,IAAK,uBAAuB,GAAGlE,MAAM,EAAE;cACpF,OAAO;gBACLwD,UAAS,GAAI,GAAGQ,OAAO,CAACC,GAAG,CAACC,gBAAe,IAAK,uBAAuB,IAAIlE,MAAM,EAAE;cACrF;YACF;YAEA6E,WAAU,GAAI;cACZnG,EAAE,EAAEkD,QAAQ,CAAC0C,MAAM,CAAC;cACpB1H,IAAI,EAAE,CAAC,CAACM,IAAI,CAACyC,UAAS,IAAK,EAAE,IAAI,GAAE,IAAKzC,IAAI,CAAC0C,SAAQ,IAAK,EAAE,CAAC,EAAEC,IAAI,CAAC,KAAK3C,IAAI,CAAC4C,QAAO,IAAK,QAAQ;cAClGC,OAAO,EAAG,CAAC7C,IAAI,CAACyC,UAAS,IAAKzC,IAAI,CAAC4C,QAAO,IAAK,QAAQ,EAAE,CAAC,CAAE;cAC5DE,MAAM,EAAE9C,IAAI,CAAC8C,MAAK,IAAK,EAAE;cACzBwD,UAAU,EAAEA,UAAU;cACtBvD,KAAK,EAAEC,cAAc,CAAChD,IAAI,CAACwB,EAAE,CAAC;cAC9ByB,MAAM,EAAE,QAAQ;cAChBC,WAAW,EAAEsB,OAAO,CAAC+B,YAAW,GAAI/B,OAAO,CAAC+B,YAAY,CAACC,OAAM,GAAI,EAAE;cACrErD,QAAQ,EAAEsD,iBAAiB,CAACjC,OAAO,CAACmC,UAAU,CAAC;cAC/CvD,MAAM,EAAE,CAAC;cACTnB,OAAO,EAAE;YACX;UACF,OAAO;YACL;YACA0F,WAAU,GAAI;cACZnG,EAAE,EAAEkD,QAAQ,CAAC0C,MAAM,CAAC;cACpB1H,IAAI,EAAE8E,OAAO,CAAC6B,KAAI,IAAK,IAAI;cAC3BxD,OAAO,EAAE,CAAC2B,OAAO,CAAC6B,KAAI,IAAK,IAAI,EAAE,CAAC,CAAC;cACnCvD,MAAM,EAAE,EAAE;cACVwD,UAAU,EAAE,EAAE;cACdvD,KAAK,EAAEC,cAAc,CAAC0B,QAAQ,CAAC0C,MAAM,CAAC,CAAC;cACvCnE,MAAM,EAAE,QAAQ;cAChBC,WAAW,EAAE,EAAE;cACfC,QAAQ,EAAEsD,iBAAiB,CAACjC,OAAO,CAACmC,UAAU,CAAC;cAC/CvD,MAAM,EAAE,CAAC;cACTnB,OAAO,EAAEuC,OAAO,CAAC4B;YACnB;UACF;;UAEA;UACA,IAAIuB,WAAW,EAAE;YACfzG,QAAQ,CAACG,KAAK,CAACuG,OAAO,CAACD,WAAW;YAClCzD,OAAO,CAACC,GAAG,CAAC,UAAU,EAAEwD,WAAW;UACrC;QACF;;QAEA;QACAlH,QAAQ,CAACY,KAAI,GAAIgG,WAAU,IAAK,EAAC;QACjCzG,aAAa,CAACS,KAAI,GAAIqD,QAAQ,CAAC0C,MAAM;QACrChH,eAAe,CAACiB,KAAI,GAAIqD,QAAQ,CAAC0C,MAAM;;QAEvC;QACA3J,QAAQ,CAAC,MAAM;UACboH,cAAc,CAAC;QACjB,CAAC;MACH,EAAE,OAAOZ,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,WAAW,EAAEA,KAAK;QAEhC,IAAI4D,YAAW,GAAI,UAAS;QAC5B,IAAI5D,KAAK,CAACmB,QAAQ,EAAE;UAClB,MAAMnC,MAAK,GAAIgB,KAAK,CAACmB,QAAQ,CAACnC,MAAK;UACnC,IAAIA,MAAK,KAAM,GAAG,EAAE;YAClB4E,YAAW,GAAI,cAAa;UAC9B,OAAO,IAAI5E,MAAK,KAAM,GAAG,EAAE;YACzB4E,YAAW,GAAI,WAAU;UAC3B,OAAO,IAAI5D,KAAK,CAACmB,QAAQ,CAACG,IAAG,IAAKtB,KAAK,CAACmB,QAAQ,CAACG,IAAI,CAACT,OAAO,EAAE;YAC7D+C,YAAW,GAAI5D,KAAK,CAACmB,QAAQ,CAACG,IAAI,CAACT,OAAM;UAC3C;QACF,OAAO,IAAIb,KAAK,CAACa,OAAO,EAAE;UACxB+C,YAAW,GAAI5D,KAAK,CAACa,OAAM;QAC7B;QAEAhH,SAAS,CAACmG,KAAK,CAAC4D,YAAY;QAC5BpH,QAAQ,CAACY,KAAI,GAAI,EAAC;MACpB,UAAU;QACRX,OAAO,CAACW,KAAI,GAAI,KAAI;MACtB;IACF;;IAEA;IACA,MAAMyG,mBAAkB,GAAI,MAAAA,CAAA,KAAY;MACtC;MACA,MAAM1D,YAAY,CAAC;;MAEnB;MACA,MAAMC,gBAAgB,CAAC;;MAEvB;MACA,IAAIzD,aAAa,CAACS,KAAK,EAAE;QACvB,MAAMQ,OAAM,GAAIX,QAAQ,CAACG,KAAK,CAACC,IAAI,CAACC,CAAA,IAAKA,CAAC,CAACC,EAAC,KAAMZ,aAAa,CAACS,KAAK;QACrE,IAAIQ,OAAO,EAAE;UACXzB,eAAe,CAACiB,KAAI,GAAIQ,OAAO,CAACL,EAAC;QACnC;MACF;IACF;;IAEA;IACA,MAAMqD,cAAa,GAAIA,CAAA,KAAM;MAC3B,IAAIvE,gBAAgB,CAACe,KAAK,EAAE;QAC1Bf,gBAAgB,CAACe,KAAK,CAAC0G,SAAQ,GAAIzH,gBAAgB,CAACe,KAAK,CAAC2G,YAAW;MACvE;IACF;;IAEA;IACA,MAAMC,aAAY,GAAI,MAAOpG,OAAO,IAAK;MACvC;MACA,IAAI,CAACA,OAAO,CAACI,OAAM,IAAKhC,QAAQ,CAACoB,KAAI,IAAKQ,OAAO,CAACJ,MAAK,KAAMxB,QAAQ,CAACoB,KAAK,CAACG,EAAE,EAAE;QAC9E1D,SAAS,CAACqH,OAAO,CAAC,SAAS;QAC3B;MACF;MAEAjB,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAEtC,OAAO;;MAE7B;MACA,IAAIqG,SAAQ,GAAIrG,OAAO,CAACL,EAAC;;MAEzB;MACA,IAAI,OAAO0G,SAAQ,KAAM,QAAO,IAAKA,SAAS,CAACrB,UAAU,CAAC,OAAO,CAAC,EAAE;QAClE;QACA,IAAIpF,MAAK,GAAII,OAAO,CAACJ,MAAK,IAAKI,OAAO,CAACL,EAAE,CAAC2G,OAAO,CAAC,OAAO,EAAE,EAAE;QAC7DjE,OAAO,CAACC,GAAG,CAAC,eAAe,EAAE1C,MAAM;;QAEnC;QACA,MAAM2G,YAAW,GAAIlH,QAAQ,CAACG,KAAK,CAACC,IAAI,CAACC,CAAA,IACvC,CAACA,CAAC,CAACU,OAAM,KACPV,CAAC,CAACE,MAAK,IAAKF,CAAC,CAACE,MAAK,IAAKA,MAAM,IAC/BF,CAAC,CAACvB,IAAG,IAAKuB,CAAC,CAACvB,IAAI,CAACwB,EAAC,IAAKC,MAAO,CACjC;QAEA,IAAI2G,YAAY,EAAE;UAChBlE,OAAO,CAACC,GAAG,CAAC,aAAa,EAAEiE,YAAY;UACvCF,SAAQ,GAAIE,YAAY,CAAC5G,EAAC;QAC5B,OAAO;UACL0C,OAAO,CAACC,GAAG,CAAC,mBAAmB;;UAE/B;UACA,IAAI;YACF,MAAMiB,QAAO,GAAI,MAAM5F,OAAO,CAAC;cAC7B6F,GAAG,EAAE,qBAAqB;cAC1BC,MAAM,EAAE,MAAM;cACdC,IAAI,EAAE;gBACJ8C,eAAe,EAAE,CAAC5G,MAAM,CAAC;gBACzB2E,QAAQ,EAAE;cACZ;YACF,CAAC;YAEDlC,OAAO,CAACC,GAAG,CAAC,SAAS,EAAEiB,QAAQ;;YAE/B;YACA,IAAIkD,UAAS,GAAI,IAAG;YAEpB,IAAIlD,QAAO,IAAKA,QAAQ,CAACG,IAAI,EAAE;cAC7B+C,UAAS,GAAIlD,QAAQ,CAACG,IAAG;YAC3B,OAAO,IAAIH,QAAO,IAAKA,QAAQ,CAAC5D,EAAE,EAAE;cAClC8G,UAAS,GAAIlD,QAAO;YACtB;YAEA,IAAIkD,UAAS,IAAKA,UAAU,CAAC9G,EAAE,EAAE;cAC/B;cACA,MAAMmG,WAAU,GAAI;gBAClBnG,EAAE,EAAE8G,UAAU,CAAC9G,EAAE;gBACjBC,MAAM,EAAEA,MAAM;gBACd/B,IAAI,EAAEmC,OAAO,CAACnC,IAAI;gBAClBmD,OAAO,EAAEhB,OAAO,CAACgB,OAAO;gBACxBC,MAAM,EAAEjB,OAAO,CAACiB,MAAM;gBACtBwD,UAAU,EAAEzE,OAAO,CAACyE,UAAS,IAAK,EAAE;gBACpCvD,KAAK,EAAElB,OAAO,CAACkB,KAAI,IAAKC,cAAc,CAACvB,MAAM,CAAC;gBAC9CwB,MAAM,EAAE,QAAQ;gBAChBC,WAAW,EAAE,EAAE;gBACfC,QAAQ,EAAEsD,iBAAiB,CAAC,IAAI8B,IAAI,CAAC,CAAC,CAAC;gBACvCnF,MAAM,EAAE,CAAC;gBACTnB,OAAO,EAAE,KAAK;gBACdoB,UAAU,EAAExB,OAAO,CAACwB;cACtB;;cAEA;cACAnC,QAAQ,CAACG,KAAK,CAACuG,OAAO,CAACD,WAAW;;cAElC;cACAO,SAAQ,GAAII,UAAU,CAAC9G,EAAC;cACxB1D,SAAS,CAAC8H,OAAO,CAAC,SAAS;YAC7B,OAAO;cACL,MAAM,IAAIJ,KAAK,CAAC,YAAY;YAC9B;UACF,EAAE,OAAOvB,KAAK,EAAE;YACdC,OAAO,CAACD,KAAK,CAAC,UAAU,EAAEA,KAAK;YAC/BnG,SAAS,CAACmG,KAAK,CAAC,WAAU,IAAKA,KAAK,CAACa,OAAM,IAAK,MAAM,CAAC;YACvD;UACF;QACF;MACF;;MAEA;MACA1E,eAAe,CAACiB,KAAI,GAAI6G,SAAQ;MAChC7H,YAAY,CAACgB,KAAI,GAAI,EAAC;MACtBZ,QAAQ,CAACY,KAAI,GAAI,EAAC;;MAElB;MACA,IAAI;QACF,MAAMsD,gBAAgB,CAACuD,SAAS;;QAEhC;QACAzK,QAAQ,CAAC,MAAM;UACboH,cAAc,CAAC;QACjB,CAAC;MACH,EAAE,OAAOZ,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,WAAW,EAAEA,KAAK;QAChCnG,SAAS,CAACmG,KAAK,CAAC,WAAU,IAAKA,KAAK,CAACa,OAAM,IAAK,MAAM,CAAC;MACzD;IACF;;IAEA;IACAlH,KAAK,CAAC6C,QAAQ,EAAE,MAAM;MACpBhD,QAAQ,CAAC,MAAM;QACboH,cAAc,CAAC;MACjB,CAAC;IACH,CAAC;;IAED;IACA,MAAM2D,WAAU,GAAI,MAAAA,CAAA,KAAY;MAC9B,IAAI,CAACnI,YAAY,CAACgB,KAAK,CAACsB,IAAI,CAAC,KAAK,CAAC/B,aAAa,CAACS,KAAK,EAAE;MAExD,IAAI;QACF;QACA,IAAI,CAACpB,QAAQ,CAACoB,KAAI,IAAK,CAACpB,QAAQ,CAACoB,KAAK,CAACG,EAAE,EAAE;UACzC0C,OAAO,CAACC,GAAG,CAAC,qBAAqB;UACjC;UACA,MAAMJ,QAAO,GAAI,MAAMC,gBAAgB,CAAC;UACxC,IAAI,CAACD,QAAO,IAAK,CAACA,QAAQ,CAACvC,EAAE,EAAE;YAC7B,MAAM,IAAIgE,KAAK,CAAC,oBAAoB;UACtC;UAEAtB,OAAO,CAACC,GAAG,CAAC,WAAW,EAAEJ,QAAQ;QACnC;;QAEA;QACA;QACA,IAAI,CAAC9D,QAAQ,CAACoB,KAAI,IAAK,CAACpB,QAAQ,CAACoB,KAAK,CAACG,EAAE,EAAE;UACzC,MAAM,IAAIgE,KAAK,CAAC,iBAAiB;QACnC;;QAEA;QACAtB,OAAO,CAACC,GAAG,CAAC,SAAS,EAAEvD,aAAa,CAACS,KAAK,EAAE,KAAK,EAAE,OAAOT,aAAa,CAACS,KAAK;QAE7E,MAAMoH,WAAU,GAAI;UAClBjH,EAAE,EAAE,OAAM,GAAI+G,IAAI,CAACG,GAAG,CAAC,CAAC;UACxBlC,OAAO,EAAEnG,YAAY,CAACgB,KAAK,CAACsB,IAAI,CAAC,CAAC;UAClC8E,MAAM,EAAE;YACNjG,EAAE,EAAEvB,QAAQ,CAACoB,KAAK,CAACG,EAAE;YACrBoB,QAAQ,EAAE3C,QAAQ,CAACoB,KAAK,CAACuB,QAAO,IAAK,IAAI;YACzCH,UAAU,EAAExC,QAAQ,CAACoB,KAAK,CAACoB,UAAS,IAAK,EAAE;YAC3CC,SAAS,EAAEzC,QAAQ,CAACoB,KAAK,CAACqB,SAAQ,IAAK;UACzC,CAAC;UACDiG,YAAY,EAAE,MAAM;UACpBjC,UAAU,EAAE,IAAI6B,IAAI,CAAC,CAAC,CAACK,WAAW,CAAC,CAAC;UACpCC,OAAO,EAAE;QACX;;QAEA;QACApI,QAAQ,CAACY,KAAK,CAACsC,IAAI,CAAC8E,WAAW;;QAE/B;QACA,MAAMK,WAAU,GAAIzI,YAAY,CAACgB,KAAI;QACrChB,YAAY,CAACgB,KAAI,GAAI,EAAC;;QAEtB;QACA,MAAM5D,QAAQ,CAAC;QACfoH,cAAc,CAAC;;QAEf;QACAX,OAAO,CAACC,GAAG,CAAC,kBAAkB,EAAEvD,aAAa,CAACS,KAAK,EAAE,OAAO,EAAEyH,WAAW;QAEzE,IAAI;UACF;UACA,MAAM1D,QAAO,GAAI,MAAMnG,eAAe,CAAC;YACrC8J,IAAI,EAAEnI,aAAa,CAACS,KAAK;YACzBmF,OAAO,EAAEsC;UACX,CAAC;UACD5E,OAAO,CAACC,GAAG,CAAC,SAAS,EAAEiB,QAAQ;;UAE/B;UACA,IAAIiC,WAAU,GAAI,IAAG;UAErB,IAAIjC,QAAO,IAAKA,QAAQ,CAACQ,OAAM,IAAKR,QAAQ,CAACG,IAAI,EAAE;YACjD;YACA8B,WAAU,GAAIjC,QAAQ,CAACG,IAAG;UAC5B,OAAO,IAAIH,QAAO,IAAKA,QAAQ,CAAC5D,EAAE,EAAE;YAClC;YACA6F,WAAU,GAAIjC,QAAO;UACvB,OAAO,IAAIA,QAAO,IAAKA,QAAQ,CAAC2D,IAAI,EAAE;YACpC;YACA;YACA1B,WAAU,GAAI;cACZ7F,EAAE,EAAE4D,QAAQ,CAAC5D,EAAC,IAAK,MAAK,GAAI+G,IAAI,CAACG,GAAG,CAAC,CAAC;cACtClC,OAAO,EAAEpB,QAAQ,CAACoB,OAAO;cACzBmC,YAAY,EAAEvD,QAAQ,CAACuD,YAAY;cACnCK,IAAI,EAAE5D,QAAQ,CAAC4D,IAAI;cACnBtC,UAAU,EAAEtB,QAAQ,CAACsB,UAAS,IAAK,IAAI6B,IAAI,CAAC,CAAC,CAACK,WAAW,CAAC,CAAC;cAC3DnB,MAAM,EAAE;gBACNjG,EAAE,EAAEvB,QAAQ,CAACoB,KAAK,CAACG,EAAE;gBACrBoB,QAAQ,EAAE3C,QAAQ,CAACoB,KAAK,CAACuB,QAAO,IAAK,IAAI;gBACzCH,UAAU,EAAExC,QAAQ,CAACoB,KAAK,CAACoB,UAAS,IAAK,EAAE;gBAC3CC,SAAS,EAAEzC,QAAQ,CAACoB,KAAK,CAACqB,SAAQ,IAAK;cACzC;YACF;UACF,OAAO;YACLwB,OAAO,CAACgB,IAAI,CAAC,cAAc,EAAEE,QAAQ;YACrC,MAAM,IAAII,KAAK,CAAC,YAAY;UAC9B;;UAEA;UACA,MAAMyD,SAAQ,GAAIxI,QAAQ,CAACY,KAAK,CAAC6H,SAAS,CAACC,CAAA,IAAKA,CAAC,CAAC3H,EAAC,KAAMiH,WAAW,CAACjH,EAAE;UACvE,IAAIyH,SAAQ,KAAM,CAAC,CAAC,EAAE;YACpBxI,QAAQ,CAACY,KAAK,CAAC+H,MAAM,CAACH,SAAS,EAAE,CAAC,EAAE5B,WAAW;UACjD,OAAO;YACL5G,QAAQ,CAACY,KAAK,CAACsC,IAAI,CAAC0D,WAAW;UACjC;;UAEA;UACA,MAAMgC,YAAW,GAAInI,QAAQ,CAACG,KAAK,CAAC6H,SAAS,CAAC3H,CAAA,IAAKA,CAAC,CAACC,EAAC,KAAMpB,eAAe,CAACiB,KAAK;UACjF,IAAIgI,YAAW,KAAM,CAAC,CAAC,EAAE;YACvBnI,QAAQ,CAACG,KAAK,CAACgI,YAAY,CAAC,CAACnG,WAAU,GAAI4F,WAAU;YACrD5H,QAAQ,CAACG,KAAK,CAACgI,YAAY,CAAC,CAAClG,QAAO,GAAIsD,iBAAiB,CAAC,IAAI8B,IAAI,CAAC,CAAC;UACtE;;UAEA;UACA,MAAM9K,QAAQ,CAAC;UACfoH,cAAc,CAAC;QACjB,EAAE,OAAOZ,KAAK,EAAE;UACd;UACAC,OAAO,CAACD,KAAK,CAAC,cAAc,EAAEA,KAAK;UACnC,IAAIA,KAAK,CAACmB,QAAQ,EAAE;YAClBlB,OAAO,CAACD,KAAK,CAAC,QAAQ,EAAEA,KAAK,CAACmB,QAAQ,CAACnC,MAAM;YAC7CiB,OAAO,CAACD,KAAK,CAAC,OAAO,EAAEA,KAAK,CAACmB,QAAQ,CAACG,IAAI;YAC1CrB,OAAO,CAACD,KAAK,CAAC,QAAQ,EAAEA,KAAK,CAACmB,QAAQ,CAACkE,MAAM,CAACjE,GAAG;YACjDnB,OAAO,CAACD,KAAK,CAAC,OAAO,EAAEA,KAAK,CAACmB,QAAQ,CAACkE,MAAM,CAAChE,MAAM;YACnDpB,OAAO,CAACD,KAAK,CAAC,OAAO,EAAEA,KAAK,CAACmB,QAAQ,CAACkE,MAAM,CAAC/D,IAAI;YAEjD,IAAItB,KAAK,CAACmB,QAAQ,CAACnC,MAAK,KAAM,GAAG,EAAE;cACjC;cACAiB,OAAO,CAACD,KAAK,CAAC,sBAAsB;cACpCnG,SAAS,CAACmG,KAAK,CAAC,yBAAyB;YAC3C,OAAO;cACL,MAAMA,KAAI,EAAG;YACf;UACF,OAAO;YACL,MAAMA,KAAI,EAAG;UACf;QACF;MACF,EAAE,OAAOA,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,SAAS,EAAEA,KAAK;;QAE9B;QACAxD,QAAQ,CAACY,KAAI,GAAIZ,QAAQ,CAACY,KAAK,CAACO,MAAM,CAACuH,CAAA,IAAK,CAACA,CAAC,CAACN,OAAO;;QAEtD;QACAxI,YAAY,CAACgB,KAAI,GAAI4C,KAAK,CAACsF,YAAW,IAAKlJ,YAAY,CAACgB,KAAI;QAE5DvD,SAAS,CAACmG,KAAK,CAAC,YAAY;MAC9B;IACF;;IAEA;IACA,MAAMuF,cAAa,GAAIA,CAAA,KAAM;MAC3BjJ,SAAS,CAACc,KAAK,CAACoI,KAAK,CAAC;IACxB;;IAEA;IACA,MAAMC,eAAc,GAAIA,CAAA,KAAM;MAC5BlJ,UAAU,CAACa,KAAK,CAACoI,KAAK,CAAC;IACzB;;IAEA;IACA,MAAME,gBAAe,GAAI,MAAOC,KAAK,IAAK;MACxC,MAAMZ,IAAG,GAAIY,KAAK,CAACC,MAAM,CAACC,KAAK,CAAC,CAAC;MACjC,IAAI,CAACd,IAAG,IAAK,CAACpI,aAAa,CAACS,KAAK,EAAE;MAEnC,IAAI;QACF,MAAMnC,eAAe,CACnB0B,aAAa,CAACS,KAAK,EACnB,SAAS2H,IAAI,CAACtJ,IAAI,EAAE,EACpBsJ,IACF;;QAEA;QACArE,gBAAgB,CAAC/D,aAAa,CAACS,KAAK;;QAEpC;QACAuI,KAAK,CAACC,MAAM,CAACxI,KAAI,GAAI,EAAC;MACxB,EAAE,OAAO4C,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,SAAS,EAAEA,KAAK;QAC9BnG,SAAS,CAACmG,KAAK,CAAC,QAAQ;MAC1B;IACF;;IAEA;IACA,MAAM8F,iBAAgB,GAAI,MAAOH,KAAK,IAAK;MACzC,MAAMZ,IAAG,GAAIY,KAAK,CAACC,MAAM,CAACC,KAAK,CAAC,CAAC;MACjC,IAAI,CAACd,IAAG,IAAK,CAACpI,aAAa,CAACS,KAAK,EAAE;MAEnC,IAAI;QACF,MAAMlC,gBAAgB,CACpByB,aAAa,CAACS,KAAK,EACnB,MAAM,EACN2H,IACF;;QAEA;QACArE,gBAAgB,CAAC/D,aAAa,CAACS,KAAK;;QAEpC;QACAuI,KAAK,CAACC,MAAM,CAACxI,KAAI,GAAI,EAAC;MACxB,EAAE,OAAO4C,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,SAAS,EAAEA,KAAK;QAC9BnG,SAAS,CAACmG,KAAK,CAAC,QAAQ;MAC1B;IACF;;IAEA;IACA,MAAM+F,mBAAkB,GAAI,MAAAA,CAAA,KAAY;MACtCnJ,sBAAsB,CAACQ,KAAI,GAAI,IAAG;MAClC,MAAM4I,iBAAiB,CAAC;IAC1B;;IAEA;IACA,MAAMA,iBAAgB,GAAI,MAAAA,CAAA,KAAY;MACpC,IAAI;QACFnJ,gBAAgB,CAACO,KAAI,GAAI,IAAG;QAC5B,MAAM;UAAEkE;QAAK,IAAI,MAAMjG,gBAAgB,CAAC;QACxCyB,aAAa,CAACM,KAAI,GAAIkE,IAAG;MAC3B,EAAE,OAAOtB,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,YAAY,EAAEA,KAAK;QACjCnG,SAAS,CAACmG,KAAK,CAAC,WAAW;MAC7B,UAAU;QACRnD,gBAAgB,CAACO,KAAI,GAAI,KAAI;MAC/B;IACF;;IAEA;IACA,MAAM6I,eAAc,GAAKC,GAAG,IAAK;MAC/BnJ,iBAAiB,CAACK,KAAI,GAAI8I,GAAE;IAC9B;;IAEA;IACA,MAAMC,cAAa,GAAI,MAAOC,SAAS,IAAK;MAC1C,IAAI,CAACzJ,aAAa,CAACS,KAAK,EAAE;MAE1B,IAAI;QACF,MAAMjC,oBAAoB,CACxBwB,aAAa,CAACS,KAAK,EACnB,YAAYgJ,SAAS,CAAChE,KAAK,EAAE,EAC7BgE,SAAS,CAAC7I,EACZ;;QAEA;QACAX,sBAAsB,CAACQ,KAAI,GAAI,KAAI;;QAEnC;QACAsD,gBAAgB,CAAC/D,aAAa,CAACS,KAAK;MACtC,EAAE,OAAO4C,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,YAAY,EAAEA,KAAK;QACjCnG,SAAS,CAACmG,KAAK,CAAC,WAAW;MAC7B;IACF;;IAEA;IACA,MAAMqG,YAAW,GAAI,MAAOxF,OAAO,IAAK;MACtC,IAAI;QACF,MAAMM,QAAO,GAAI,MAAM/F,mBAAmB,CAACyF,OAAO,CAACtD,EAAE;;QAErD;QACA,MAAM6D,GAAE,GAAIkF,MAAM,CAACC,GAAG,CAACC,eAAe,CAAC,IAAIC,IAAI,CAAC,CAACtF,QAAQ,CAACG,IAAI,CAAC,CAAC;QAChE,MAAMoF,IAAG,GAAIC,QAAQ,CAACC,aAAa,CAAC,GAAG;QACvCF,IAAI,CAACG,IAAG,GAAIzF,GAAE;QACdsF,IAAI,CAACI,YAAY,CAAC,UAAU,EAAEjG,OAAO,CAACkG,SAAQ,IAAK,UAAU;QAC7DJ,QAAQ,CAACK,IAAI,CAACC,WAAW,CAACP,IAAI;QAC9BA,IAAI,CAAClB,KAAK,CAAC;QACXmB,QAAQ,CAACK,IAAI,CAACE,WAAW,CAACR,IAAI;MAChC,EAAE,OAAO1G,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,SAAS,EAAEA,KAAK;QAC9BnG,SAAS,CAACmG,KAAK,CAAC,QAAQ;MAC1B;IACF;;IAEA;IACA,MAAMmH,aAAY,GAAKtG,OAAO,IAAK;MACjC,IAAIA,OAAO,CAACuG,gBAAgB,EAAE;QAC5B;QACAtN,YAAY,CAACuN,KAAK,CAChB,OAAOxG,OAAO,CAACuG,gBAAgB,CAAChF,KAAK,WAAWvB,OAAO,CAACuG,gBAAgB,CAACE,WAAU,IAAK,GAAG,EAAE,EAC7F,OAAO,EACP;UACEC,wBAAwB,EAAE,IAAI;UAC9BC,iBAAiB,EAAE;QACrB,CACF;MACF;IACF;;IAEA;IACA,MAAMC,cAAa,GAAKjE,MAAM,IAAK;MACjC,OAAOzE,cAAc,CAACyE,MAAM,CAACjG,EAAE;IACjC;;IAEA;IACA,MAAMmK,gBAAe,GAAKlE,MAAM,IAAK;MACnC,OAAO,CAACA,MAAM,CAAChF,UAAS,IAAKgF,MAAM,CAAC7E,QAAQ,EAAE,CAAC;IACjD;;IAEA;IACA,MAAMI,cAAa,GAAKxB,EAAE,IAAK;MAC7B,MAAMoK,MAAK,GAAI,CACb,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAC1C,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAQ,CAC3C;;MAEA;MACA,MAAMC,KAAI,GAAI,OAAOrK,EAAC,KAAM,QAAO,GAAIA,EAAC,GAAIoK,MAAM,CAAC7F,MAAK,GAAI;MAC5D,OAAO6F,MAAM,CAACC,KAAK;IACrB;;IAEA;IACA,MAAMpF,iBAAgB,GAAKqF,SAAS,IAAK;MACvC,IAAI,CAACA,SAAS,EAAE,OAAO,EAAC;MAExB,MAAMC,IAAG,GAAI,IAAIxD,IAAI,CAACuD,SAAS;MAC/B,MAAMpD,GAAE,GAAI,IAAIH,IAAI,CAAC;MACrB,MAAMyD,IAAG,GAAItD,GAAE,GAAIqD,IAAG;;MAEtB;MACA,IAAIC,IAAG,GAAI,EAAC,GAAI,EAAC,GAAI,EAAC,GAAI,IAAI,EAAE;QAChC,MAAMC,KAAI,GAAIF,IAAI,CAACG,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAE,GAAG;QACxD,MAAMC,OAAM,GAAIN,IAAI,CAACO,UAAU,CAAC,CAAC,CAACH,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAE,GAAG;QAC5D,OAAO,GAAGH,KAAK,IAAII,OAAO,EAAC;MAC3B;;MAEA;MACA,IAAIL,IAAG,GAAI,IAAI,EAAC,GAAI,EAAC,GAAI,EAAC,GAAI,IAAI,EAAE;QAClC,MAAMO,IAAG,GAAI,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI;QACtD,OAAOA,IAAI,CAACR,IAAI,CAACS,MAAM,CAAC,CAAC;MAC3B;;MAEA;MACA,OAAO,GAAGT,IAAI,CAACU,QAAQ,CAAC,IAAI,CAAC,IAAIV,IAAI,CAACW,OAAO,CAAC,CAAC,GAAE;IACnD;;IAEA;IACA,MAAMC,UAAS,GAAKb,SAAS,IAAK;MAChC,IAAI,CAACA,SAAS,EAAE,OAAO,EAAC;MAExB,MAAMC,IAAG,GAAI,IAAIxD,IAAI,CAACuD,SAAS;MAC/B,OAAO,GAAGC,IAAI,CAACa,WAAW,CAAC,CAAC,IAAI,CAACb,IAAI,CAACU,QAAQ,CAAC,IAAI,CAAC,EAAEN,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,IAAIL,IAAI,CAACW,OAAO,CAAC,CAAC,CAACP,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,EAAC;IAClI;;IAEA;IACA,MAAMS,cAAa,GAAKC,QAAQ,IAAK;MACnC,IAAIA,QAAO,GAAI,IAAI,EAAE;QACnB,OAAO,GAAGA,QAAQ,KAAI;MACxB,OAAO;QACL,OAAO,GAAG,CAACA,QAAO,GAAI,IAAI,EAAEC,OAAO,CAAC,CAAC,CAAC,KAAI;MAC5C;IACF;;IAEA;IACA,MAAMC,aAAY,GAAK/J,MAAM,IAAK;MAChC,MAAMgK,SAAQ,GAAI;QAChB,QAAQ,EAAE,IAAI;QACd,SAAS,EAAE,IAAI;QACf,MAAM,EAAE,IAAI;QACZ,MAAM,EAAE;MACV;MACA,OAAOA,SAAS,CAAChK,MAAM,KAAKA,MAAK;IACnC;;IAEA;IACA,MAAMiK,YAAW,GAAI,MAAAA,CAAA,KAAY;MAC/B,IAAI;QACFpP,SAAS,CAACqP,IAAI,CAAC,aAAa;;QAE5B;QACA,MAAMpJ,QAAO,GAAI,MAAMC,gBAAgB,CAAC;QAExC,IAAI,CAACD,QAAQ,EAAE;UACbjG,SAAS,CAACmG,KAAK,CAAC,kBAAkB;UAClC;QACF;;QAEA;QACA,MAAMI,gBAAgB,CAAC;QAEvB,IAAInD,QAAQ,CAACG,KAAK,CAAC0E,MAAK,KAAM,CAAC,EAAE;UAC/BjI,SAAS,CAACqH,OAAO,CAAC,wBAAwB;QAC5C,OAAO;UACLrH,SAAS,CAAC8H,OAAO,CAAC,UAAS,GAAI1E,QAAQ,CAACG,KAAK,CAAC0E,MAAK,GAAI,QAAQ;QACjE;MACF,EAAE,OAAO9B,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,SAAS,EAAEA,KAAK;QAC9BnG,SAAS,CAACmG,KAAK,CAAC,QAAO,IAAKA,KAAK,CAACa,OAAM,IAAK,MAAM,CAAC;MACtD;IACF;;IAEA;IACA,MAAMV,YAAW,GAAI,MAAAA,CAAA,KAAY;MAC/B,IAAI;QACFF,OAAO,CAACC,GAAG,CAAC,eAAe;;QAE3B;QACA,IAAI;UACFD,OAAO,CAACC,GAAG,CAAC,eAAe;UAC3B,MAAMiB,QAAO,GAAI,MAAM5F,OAAO,CAAC;YAC7B6F,GAAG,EAAE,kBAAkB;YACvBC,MAAM,EAAE;UACV,CAAC;UAEDpB,OAAO,CAACC,GAAG,CAAC,UAAU,EAAEiB,QAAQ;;UAEhC;UACA,IAAIgI,KAAI,GAAI,EAAC;UACb,IAAIhI,QAAO,IAAKA,QAAQ,CAACU,OAAO,EAAE;YAChCsH,KAAI,GAAIhI,QAAQ,CAACU,OAAM;UACzB,OAAO,IAAIvC,KAAK,CAACsC,OAAO,CAACT,QAAQ,CAAC,EAAE;YAClCgI,KAAI,GAAIhI,QAAO;UACjB,OAAO,IAAIA,QAAO,IAAKA,QAAQ,CAACG,IAAI,EAAE;YACpC,IAAIhC,KAAK,CAACsC,OAAO,CAACT,QAAQ,CAACG,IAAI,CAAC,EAAE;cAChC6H,KAAI,GAAIhI,QAAQ,CAACG,IAAG;YACtB,OAAO,IAAIH,QAAQ,CAACG,IAAI,CAACO,OAAO,EAAE;cAChCsH,KAAI,GAAIhI,QAAQ,CAACG,IAAI,CAACO,OAAM;YAC9B;UACF;UAEA,IAAIsH,KAAI,IAAKA,KAAK,CAACrH,MAAK,GAAI,CAAC,EAAE;YAC7B7B,OAAO,CAACC,GAAG,CAAC,QAAQiJ,KAAK,CAACrH,MAAM,KAAK;YACrC5E,aAAa,CAACE,KAAI,GAAI+L,KAAI;YAC1B;UACF;QACF,EAAE,OAAOnJ,KAAK,EAAE;UACdC,OAAO,CAACD,KAAK,CAAC,WAAW,EAAEA,KAAK;QAClC;;QAEA;QACAC,OAAO,CAACgB,IAAI,CAAC,oBAAoB;QACjC/D,aAAa,CAACE,KAAI,GAAI,CACpB;UACEG,EAAE,EAAE,CAAC;UACLoB,QAAQ,EAAE,UAAU;UACpBH,UAAU,EAAE,GAAG;UACfC,SAAS,EAAE,GAAG;UACdW,UAAU,EAAE,KAAK;UACjBP,MAAM,EAAE;QACV,CAAC,EACD;UACEtB,EAAE,EAAE,CAAC;UACLoB,QAAQ,EAAE,MAAM;UAChBH,UAAU,EAAE,GAAG;UACfC,SAAS,EAAE,GAAG;UACdW,UAAU,EAAE,KAAK;UACjBP,MAAM,EAAE;QACV,CAAC,EACD;UACEtB,EAAE,EAAE,CAAC;UACLoB,QAAQ,EAAE,QAAQ;UAClBH,UAAU,EAAE,GAAG;UACfC,SAAS,EAAE,GAAG;UACdW,UAAU,EAAE,KAAK;UACjBP,MAAM,EAAE;QACV,CAAC,EACD;UACEtB,EAAE,EAAE,CAAC;UACLoB,QAAQ,EAAE,SAAS;UACnBH,UAAU,EAAE,GAAG;UACfC,SAAS,EAAE,GAAG;UACdW,UAAU,EAAE,EAAE;UACdP,MAAM,EAAE;QACV,EACF;QACAoB,OAAO,CAACC,GAAG,CAAC,SAAS;MACvB,EAAE,OAAOF,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,cAAc,EAAEA,KAAK;QACnC;QACA9C,aAAa,CAACE,KAAI,GAAI,CACpB;UAAEG,EAAE,EAAE,CAAC;UAAEoB,QAAQ,EAAE,OAAO;UAAEH,UAAU,EAAE,IAAI;UAAEC,SAAS,EAAE,GAAG;UAAEW,UAAU,EAAE;QAAM,CAAC,EACjF;UAAE7B,EAAE,EAAE,CAAC;UAAEoB,QAAQ,EAAE,OAAO;UAAEH,UAAU,EAAE,IAAI;UAAEC,SAAS,EAAE,GAAG;UAAEW,UAAU,EAAE;QAAM,CAAC,EACjF;UAAE7B,EAAE,EAAE,CAAC;UAAEoB,QAAQ,EAAE,OAAO;UAAEH,UAAU,EAAE,IAAI;UAAEC,SAAS,EAAE,GAAG;UAAEW,UAAU,EAAE;QAAM,CAAC,EACjF;UAAE7B,EAAE,EAAE,CAAC;UAAEoB,QAAQ,EAAE,OAAO;UAAEH,UAAU,EAAE,IAAI;UAAEC,SAAS,EAAE,GAAG;UAAEW,UAAU,EAAE;QAAG,EAC/E;MACF;IACF;;IAEA;IACA,MAAMgK,oBAAmB,GAAI9P,GAAG,CAAC,EAAE;;IAEnC;IACA,MAAM+P,wBAAuB,GAAIA,CAAA,KAAM;MACrC;IAAA,CACF;;IAEA;IACA,MAAMC,yBAAwB,GAAKC,SAAS,IAAK;MAC/CH,oBAAoB,CAAChM,KAAK,CAACsC,IAAI,CAAC6J,SAAS;IAC3C;IAEA,OAAO;MACLtN,WAAW;MACXC,SAAS;MACTC,eAAe;MACfa,IAAI;MACJC,QAAQ;MACRE,cAAc;MACdO,gBAAgB;MAChBlB,QAAQ;MACRJ,YAAY;MACZC,gBAAgB;MAChBC,SAAS;MACTC,UAAU;MACVV,WAAW;MACXG,QAAQ;MACRwB,MAAM;MACNZ,sBAAsB;MACtBC,gBAAgB;MAChBC,aAAa;MACbL,OAAO;MACP;MACA1C,MAAM;MACNC,KAAK;MACLC,WAAW;MACXC,UAAU;MACVC,QAAQ;MACRC,aAAa;MACbC,YAAY;MACZC,UAAU;MACVC,QAAQ;MACRC,aAAa;MACbC,OAAO;MACPC,UAAU;MACVC,cAAc;MACdC,OAAO;MACPC,UAAU;MACV;MACA0J,WAAW;MACXwE,aAAa;MACb/E,aAAa;MACbuB,cAAc;MACdE,eAAe;MACfC,gBAAgB;MAChBI,iBAAiB;MACjBC,mBAAmB;MACnBE,eAAe;MACfE,cAAc;MACdE,YAAY;MACZc,aAAa;MACbM,cAAc;MACdC,gBAAgB;MAChBlF,iBAAiB;MACjBkG,UAAU;MACVE,cAAc;MACd/E,mBAAmB;MACnBoF,YAAY;MACZhL,wBAAwB;MACxBF,iBAAiB;MACjBoC,YAAY;MACZiJ,oBAAoB;MACpBC,wBAAwB;MACxBC;IACF;EACF;AACF","ignoreList":[]}]}