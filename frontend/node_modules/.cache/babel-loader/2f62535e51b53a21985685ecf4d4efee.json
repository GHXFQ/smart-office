{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\smartdoc\\Detail.vue?vue&type=script&lang=js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\smartdoc\\Detail.vue","mtime":1750132816713},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746431218000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5tYXAuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5zb21lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LmRpZmZlcmVuY2UudjIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zZXQuaW50ZXJzZWN0aW9uLnYyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LmlzLWRpc2pvaW50LWZyb20udjIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zZXQuaXMtc3Vic2V0LW9mLnYyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LmlzLXN1cGVyc2V0LW9mLnYyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LnN5bW1ldHJpYy1kaWZmZXJlbmNlLnYyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc2V0LnVuaW9uLnYyLmpzIjsKaW1wb3J0IHsgcmVmLCBjb21wdXRlZCwgd2F0Y2gsIG9uTW91bnRlZCwgbmV4dFRpY2sgfSBmcm9tICd2dWUnOwppbXBvcnQgeyB1c2VSb3V0ZSwgdXNlUm91dGVyIH0gZnJvbSAndnVlLXJvdXRlcic7CmltcG9ydCB7IEVsTWVzc2FnZSwgRWxNZXNzYWdlQm94LCBFbExvYWRpbmcgfSBmcm9tICdlbGVtZW50LXBsdXMnOwppbXBvcnQgXyBmcm9tICdsb2Rhc2gnOwppbXBvcnQgcmVxdWVzdCBmcm9tICdAL3V0aWxzL3JlcXVlc3QnOwppbXBvcnQgeyBnZXREb2N1bWVudHMsIGdldERvY3VtZW50RGV0YWlsLCBjcmVhdGVEb2N1bWVudCwgdXBkYXRlRG9jdW1lbnQsIGRlbGV0ZURvY3VtZW50IGFzIGFwaURlbGV0ZURvY3VtZW50LCBzaGFyZURvY3VtZW50IGFzIGFwaVNoYXJlRG9jdW1lbnQsIGV4cGFuZENvbnRlbnQgYXMgYXBpRXhwYW5kQ29udGVudCwgcG9saXNoVGV4dCBhcyBhcGlQb2xpc2hUZXh0LCBncmFtbWFyQ2hlY2ssIHRyYW5zbGF0ZVRleHQsIGRvY1FhIH0gZnJvbSAnQC9hcGkvc21hcnRkb2MnOwppbXBvcnQgdXNlckFwaSBmcm9tICdAL2FwaS91c2VyJzsKaW1wb3J0IHsgY3JlYXRlQ2hhdFNlc3Npb24sIGdldENoYXRTZXNzaW9ucyB9IGZyb20gJ0AvYXBpL2NoYXQnOwppbXBvcnQgeyBEb2N1bWVudCwgUGx1cywgQ2lyY2xlQ2hlY2ssIERvd25sb2FkLCBNb3JlLCBTZWFyY2gsIEFycm93TGVmdCwgQXJyb3dSaWdodCwgU2hhcmUgYXMgU2hhcmVJY29uLCBFZGl0LCBTdGFyRmlsbGVkLCBDaGF0RG90Um91bmQsIFF1ZXN0aW9uRmlsbGVkLCBBcnJvd0xlZnRCb2xkLCBMb2FkaW5nIH0gZnJvbSAnQGVsZW1lbnQtcGx1cy9pY29ucy12dWUnOwppbXBvcnQgeyBRdWlsbEVkaXRvciB9IGZyb20gJ0B2dWV1cC92dWUtcXVpbGwnOwppbXBvcnQgJ0B2dWV1cC92dWUtcXVpbGwvZGlzdC92dWUtcXVpbGwuc25vdy5jc3MnOwppbXBvcnQgeyBtYXJrZWQgfSBmcm9tICdtYXJrZWQnOwppbXBvcnQgeyBtYXJrZWRIaWdobGlnaHQgfSBmcm9tICdtYXJrZWQtaGlnaGxpZ2h0JzsKaW1wb3J0IGhsanMgZnJvbSAnaGlnaGxpZ2h0LmpzJzsKaW1wb3J0ICdoaWdobGlnaHQuanMvc3R5bGVzL2dpdGh1Yi5jc3MnOyAvLyDlr7zlhaXku6PnoIHpq5jkuq7moLflvI/ooagKCi8vIOmFjee9rm1hcmtlZAptYXJrZWQudXNlKG1hcmtlZEhpZ2hsaWdodCh7CiAgbGFuZ1ByZWZpeDogJ2hsanMgbGFuZ3VhZ2UtJywKICBoaWdobGlnaHQoY29kZSwgbGFuZykgewogICAgY29uc3QgbGFuZ3VhZ2UgPSBobGpzLmdldExhbmd1YWdlKGxhbmcpID8gbGFuZyA6ICdwbGFpbnRleHQnOwogICAgcmV0dXJuIGhsanMuaGlnaGxpZ2h0KGNvZGUsIHsKICAgICAgbGFuZ3VhZ2UKICAgIH0pLnZhbHVlOwogIH0KfSkpOwoKLy8g6K6+572u5a6J5YWo6YCJ6aG5Cm1hcmtlZC51c2UoewogIGdmbTogdHJ1ZSwKICBicmVha3M6IHRydWUsCiAgcGVkYW50aWM6IGZhbHNlLAogIHNhbml0aXplOiBmYWxzZSwKICAvLyBtYXJrZWQgdjQuMy4w5LiN5YaN5pSv5oyBc2FuaXRpemXpgInpobkKICBzbWFydExpc3RzOiB0cnVlLAogIHNtYXJ0eXBhbnRzOiBmYWxzZQp9KTsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdTbWFydERvY0RldGFpbCcsCiAgY29tcG9uZW50czogewogICAgRG9jdW1lbnQsCiAgICBQbHVzLAogICAgQ2lyY2xlQ2hlY2ssCiAgICBEb3dubG9hZCwKICAgIE1vcmUsCiAgICBTZWFyY2gsCiAgICBBcnJvd0xlZnQsCiAgICBBcnJvd1JpZ2h0LAogICAgU2hhcmVJY29uLAogICAgUXVpbGxFZGl0b3IsCiAgICBFZGl0LAogICAgU3RhckZpbGxlZCwKICAgIENoYXREb3RSb3VuZCwKICAgIFF1ZXN0aW9uRmlsbGVkLAogICAgQXJyb3dMZWZ0Qm9sZCwKICAgIExvYWRpbmcKICB9LAogIHNldHVwKCkgewogICAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKCk7CiAgICBjb25zdCByb3V0ZSA9IHVzZVJvdXRlKCk7CiAgICBjb25zdCBnb0JhY2sgPSAoKSA9PiB7CiAgICAgIHJvdXRlci5wdXNoKCcvc21hcnRkb2MnKTsKICAgIH07CgogICAgLy8g54q25oCB5pWw5o2uCiAgICBjb25zdCBkb2N1bWVudHMgPSByZWYoW10pOwogICAgY29uc3QgY3VycmVudERvYyA9IHJlZihudWxsKTsKICAgIGNvbnN0IGRvY3VtZW50Q2hhbmdlZCA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBpc0RvY0xpc3RDb2xsYXBzZWQgPSByZWYoZmFsc2UpOwogICAgY29uc3QgaXNBc3Npc3RhbnRDb2xsYXBzZWQgPSByZWYoZmFsc2UpOwogICAgY29uc3Qgc2VhcmNoUXVlcnkgPSByZWYoJycpOwogICAgY29uc3QgZG9jVHlwZUZpbHRlciA9IHJlZignJyk7CiAgICBjb25zdCBzb3J0T3B0aW9uID0gcmVmKCd1cGRhdGUnKTsKICAgIGNvbnN0IG5ld0RvY3VtZW50RGlhbG9nVmlzaWJsZSA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBzaGFyZURpYWxvZ1Zpc2libGUgPSByZWYoZmFsc2UpOwogICAgY29uc3QgZGVsZXRlRGlhbG9nVmlzaWJsZSA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBzZWxlY3RlZFVzZXJzID0gcmVmKFtdKTsKICAgIGNvbnN0IGF2YWlsYWJsZVVzZXJzID0gcmVmKFtdKTsKICAgIGNvbnN0IGRvY3VtZW50c0xvYWRpbmcgPSByZWYodHJ1ZSk7IC8vIOaWh+aho+WKoOi9veeKtuaAgQoKICAgIC8vIOWKoOi9veeKtuaAgQogICAgY29uc3Qgc2F2ZUxvYWRpbmcgPSByZWYoZmFsc2UpOwogICAgY29uc3QgY3JlYXRlTG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBzaGFyZUxvYWRpbmcgPSByZWYoZmFsc2UpOwogICAgY29uc3QgZGVsZXRlTG9hZGluZyA9IHJlZihmYWxzZSk7CiAgICBjb25zdCBleHBhbmRMb2FkaW5nID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IHBvbGlzaExvYWRpbmcgPSByZWYoZmFsc2UpOwogICAgY29uc3QgZ3JhbW1hckNoZWNrTG9hZGluZyA9IHJlZihmYWxzZSk7CgogICAgLy8g6KGo5Y2V5pWw5o2uCiAgICBjb25zdCBuZXdEb2N1bWVudEZvcm0gPSByZWYoewogICAgICB0aXRsZTogJycsCiAgICAgIHR5cGU6ICcnCiAgICB9KTsKCiAgICAvLyDooajljZXpqozor4Hop4TliJkKICAgIGNvbnN0IGRvY3VtZW50Rm9ybVJ1bGVzID0gewogICAgICB0aXRsZTogW3sKICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICBtZXNzYWdlOiAn6K+36L6T5YWl5paH5qGj5qCH6aKYJywKICAgICAgICB0cmlnZ2VyOiAnYmx1cicKICAgICAgfSwgewogICAgICAgIG1pbjogMiwKICAgICAgICBtYXg6IDUwLAogICAgICAgIG1lc3NhZ2U6ICfmoIfpopjplb/luqbpobvlnKgy5YiwNTDkuKrlrZfnrKbkuYvpl7QnLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9XQogICAgfTsKICAgIGNvbnN0IGRvY3VtZW50Rm9ybVJlZiA9IHJlZihudWxsKTsKICAgIGNvbnN0IHVwbG9hZEltYWdlID0gYXN5bmMgZmlsZSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgLy8g5L2/55SoRmlsZVJlYWRlcuWwhuaWh+S7tui9rOaNouS4umJhc2U2NAogICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBlID0+IHsKICAgICAgICAgICAgY29uc3QgYmFzZTY0RGF0YSA9IGUudGFyZ2V0LnJlc3VsdDsKICAgICAgICAgICAgLy8g55u05o6l6L+U5ZueYmFzZTY05pWw5o2u5L2c5Li65Zu+54mHVVJMCiAgICAgICAgICAgIHJlc29sdmUoewogICAgICAgICAgICAgIHVybDogYmFzZTY0RGF0YQogICAgICAgICAgICB9KTsKICAgICAgICAgIH07CiAgICAgICAgICByZWFkZXIub25lcnJvciA9ICgpID0+IHsKICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcign5paH5Lu26K+75Y+W5aSx6LSlJykpOwogICAgICAgICAgfTsKICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WbvueJh+WkhOeQhuWksei0pTonLCBlcnJvcik7CiAgICAgICAgdGhyb3cgZXJyb3I7CiAgICAgIH0KICAgIH07CgogICAgLy8g57yW6L6R5Zmo6YWN572uCiAgICBjb25zdCBlZGl0b3JPcHRpb25zID0gewogICAgICBwbGFjZWhvbGRlcjogJyAnLAogICAgICBtb2R1bGVzOiB7CiAgICAgICAgdG9vbGJhcjogewogICAgICAgICAgY29udGFpbmVyOiBbWydib2xkJywgJ2l0YWxpYycsICd1bmRlcmxpbmUnLCAnc3RyaWtlJ10sIFsnYmxvY2txdW90ZScsICdjb2RlLWJsb2NrJ10sIFt7CiAgICAgICAgICAgICdoZWFkZXInOiAxCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgICdoZWFkZXInOiAyCiAgICAgICAgICB9XSwgW3sKICAgICAgICAgICAgJ2xpc3QnOiAnb3JkZXJlZCcKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgJ2xpc3QnOiAnYnVsbGV0JwogICAgICAgICAgfV0sIFt7CiAgICAgICAgICAgICdzY3JpcHQnOiAnc3ViJwogICAgICAgICAgfSwgewogICAgICAgICAgICAnc2NyaXB0JzogJ3N1cGVyJwogICAgICAgICAgfV0sIFt7CiAgICAgICAgICAgICdpbmRlbnQnOiAnLTEnCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgICdpbmRlbnQnOiAnKzEnCiAgICAgICAgICB9XSwgW3sKICAgICAgICAgICAgJ2RpcmVjdGlvbic6ICdydGwnCiAgICAgICAgICB9XSwgW3sKICAgICAgICAgICAgJ3NpemUnOiBbJ3NtYWxsJywgZmFsc2UsICdsYXJnZScsICdodWdlJ10KICAgICAgICAgIH1dLCBbewogICAgICAgICAgICAnaGVhZGVyJzogWzEsIDIsIDMsIDQsIDUsIDYsIGZhbHNlXQogICAgICAgICAgfV0sIFt7CiAgICAgICAgICAgICdjb2xvcic6IFtdCiAgICAgICAgICB9LCB7CiAgICAgICAgICAgICdiYWNrZ3JvdW5kJzogW10KICAgICAgICAgIH1dLCBbewogICAgICAgICAgICAnZm9udCc6IFtdCiAgICAgICAgICB9XSwgW3sKICAgICAgICAgICAgJ2FsaWduJzogW10KICAgICAgICAgIH1dLCBbJ2NsZWFuJ10sIFsnbGluaycsICdpbWFnZSddXSwKICAgICAgICAgIGhhbmRsZXJzOiB7CiAgICAgICAgICAgIGltYWdlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwogICAgICAgICAgICAgIGlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICdmaWxlJyk7CiAgICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKCdhY2NlcHQnLCAnaW1hZ2UvKicpOwogICAgICAgICAgICAgIGlucHV0LmNsaWNrKCk7CiAgICAgICAgICAgICAgaW5wdXQub25jaGFuZ2UgPSBhc3luYyAoKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gaW5wdXQuZmlsZXNbMF07CiAgICAgICAgICAgICAgICBpZiAoIWZpbGUpIHJldHVybjsKCiAgICAgICAgICAgICAgICAvLyDmo4Dmn6Xmlofku7blpKflsI/lkoznsbvlnosKICAgICAgICAgICAgICAgIGlmIChmaWxlLnNpemUgPiA1ICogMTAyNCAqIDEwMjQpIHsKICAgICAgICAgICAgICAgICAgLy8gNU1C6ZmQ5Yi2CiAgICAgICAgICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Zu+54mH5LiN6IO96LaF6L+HNU1CJyk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyDmlK/mjIHnmoTlm77niYfnsbvlnosKICAgICAgICAgICAgICAgIGNvbnN0IHN1cHBvcnRlZFR5cGVzID0gWydpbWFnZS9qcGVnJywgJ2ltYWdlL3BuZycsICdpbWFnZS9naWYnLCAnaW1hZ2Uvd2VicCddOwogICAgICAgICAgICAgICAgaWYgKCFzdXBwb3J0ZWRUeXBlcy5pbmNsdWRlcyhmaWxlLnR5cGUpKSB7CiAgICAgICAgICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Y+q5pSv5oyBSlBH44CBUE5H44CBR0lG5ZKMV0VCUOagvOW8j+WbvueJhycpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBFbE1lc3NhZ2UuaW5mbygn5q2j5Zyo5aSE55CG5Zu+54mHLi4uJyk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAvLyDnm7TmjqXkvKDpgJLmlofku7blr7nosaHogIzkuI3mmK9Gb3JtRGF0YQogICAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB1cGxvYWRJbWFnZShmaWxlKTsKICAgICAgICAgICAgICAgICAgY29uc3QgdXJsID0gcmVzLnVybDsKICAgICAgICAgICAgICAgICAgaWYgKCF1cmwpIHRocm93IG5ldyBFcnJvcign5peg5pWI55qE5Zu+54mHVVJMJyk7CgogICAgICAgICAgICAgICAgICAvLyDojrflj5bnvJbovpHlmajlrp7kvovlubbmj5LlhaXlm77niYcKICAgICAgICAgICAgICAgICAgY29uc3QgcXVpbGwgPSBxdWlsbEluc3RhbmNlLnZhbHVlOwogICAgICAgICAgICAgICAgICBjb25zdCByYW5nZSA9IHF1aWxsLmdldFNlbGVjdGlvbih0cnVlKTsKICAgICAgICAgICAgICAgICAgcXVpbGwuaW5zZXJ0RW1iZWQocmFuZ2UuaW5kZXgsICdpbWFnZScsIHVybCk7CgogICAgICAgICAgICAgICAgICAvLyDmoIforrDmlofmoaPlt7Lkv67mlLkKICAgICAgICAgICAgICAgICAgZG9jdW1lbnRDaGFuZ2VkLnZhbHVlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+WbvueJh+aPkuWFpeaIkOWKnycpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCflm77niYflpITnkIblpLHotKU6JywgZSk7CiAgICAgICAgICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Zu+54mH5aSE55CG5aSx6LSlOiAnICsgZS5tZXNzYWdlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9OwoKICAgIC8vIOiuoeeul+WxnuaApwogICAgY29uc3QgZmlsdGVyZWREb2N1bWVudHMgPSBjb21wdXRlZCgoKSA9PiB7CiAgICAgIGxldCByZXN1bHQgPSBbLi4uZG9jdW1lbnRzLnZhbHVlXTsKCiAgICAgIC8vIOaQnOe0ouetm+mAiQogICAgICBpZiAoc2VhcmNoUXVlcnkudmFsdWUpIHsKICAgICAgICBjb25zdCBxdWVyeSA9IHNlYXJjaFF1ZXJ5LnZhbHVlLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmZpbHRlcihkb2MgPT4gZG9jLnRpdGxlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocXVlcnkpIHx8IGRvYy50eXBlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocXVlcnkpKTsKICAgICAgfQoKICAgICAgLy8g57G75Z6L562b6YCJCiAgICAgIGlmIChkb2NUeXBlRmlsdGVyLnZhbHVlKSB7CiAgICAgICAgY29uc3QgdHlwZUZpbHRlciA9IGRvY1R5cGVGaWx0ZXIudmFsdWUudG9Mb3dlckNhc2UoKTsKICAgICAgICByZXN1bHQgPSByZXN1bHQuZmlsdGVyKGRvYyA9PiBkb2MudHlwZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHR5cGVGaWx0ZXIpKTsKICAgICAgfQoKICAgICAgLy8g5o6S5bqPCiAgICAgIGlmIChzb3J0T3B0aW9uLnZhbHVlID09PSAndXBkYXRlJykgewogICAgICAgIHJlc3VsdC5zb3J0KChhLCBiKSA9PiBuZXcgRGF0ZShiLnVwZGF0ZV90aW1lKSAtIG5ldyBEYXRlKGEudXBkYXRlX3RpbWUpKTsKICAgICAgfSBlbHNlIGlmIChzb3J0T3B0aW9uLnZhbHVlID09PSAnY3JlYXRlJykgewogICAgICAgIHJlc3VsdC5zb3J0KChhLCBiKSA9PiBuZXcgRGF0ZShiLmNyZWF0ZV90aW1lKSAtIG5ldyBEYXRlKGEuY3JlYXRlX3RpbWUpKTsKICAgICAgfSBlbHNlIGlmIChzb3J0T3B0aW9uLnZhbHVlID09PSAnbmFtZS1hc2MnKSB7CiAgICAgICAgcmVzdWx0LnNvcnQoKGEsIGIpID0+IGEudGl0bGUubG9jYWxlQ29tcGFyZShiLnRpdGxlKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0pOwoKICAgIC8vIOaWueazlQogICAgY29uc3QgZmV0Y2hEb2N1bWVudHMgPSBhc3luYyAocGFnZSA9IDEsIGFsbERvY3MgPSBbXSkgPT4gewogICAgICBpZiAocGFnZSA9PT0gMSkgewogICAgICAgIGRvY3VtZW50c0xvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgY29uc29sZS5sb2coYOW8gOWni+iOt+WPluaWh+aho+WIl+ihqCDnrKwke3BhZ2V96aG1Li4uYCk7CiAgICAgICAgY29uc3QgcGFyYW1zID0gewogICAgICAgICAgcGFnZTogcGFnZSwKICAgICAgICAgIGxpbWl0OiAxMDAsCiAgICAgICAgICAvLyDlsJ3or5Xor7fmsYLmm7TlpJrvvIzlsL3nrqHlkI7nq6/lj6/og73lj6rkvJrov5Tlm54xMOadoe+8iOm7mOiupFBBR0VfU0laRe+8iQogICAgICAgICAgX3Q6IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8vIOa3u+WKoOaXtumXtOaIs++8jOehruS/neS4jeS9v+eUqOe8k+WtmAogICAgICAgIH07CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZXREb2N1bWVudHMocGFyYW1zKTsKICAgICAgICBjb25zb2xlLmxvZyhg5paH5qGj5YiX6KGo5ZON5bqUKOesrCR7cGFnZX3pobUpOmAsIHJlc3BvbnNlKTsKCiAgICAgICAgLy8g5aSE55CG6I635Y+W5Yiw55qE5pWw5o2uCiAgICAgICAgbGV0IGRvY3NMaXN0ID0gWy4uLmFsbERvY3NdOwogICAgICAgIGxldCB0b3RhbENvdW50ID0gMDsKICAgICAgICBsZXQgY3VycmVudFBhZ2VEb2NzID0gW107CiAgICAgICAgbGV0IGhhc01vcmUgPSBmYWxzZTsKCiAgICAgICAgLy8g5aSE55CG5LiN5ZCM5qC85byP55qE5ZON5bqUCiAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgQXJyYXkuaXNBcnJheShyZXNwb25zZS5kYXRhKSkgewogICAgICAgICAgY3VycmVudFBhZ2VEb2NzID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICAgIHRvdGFsQ291bnQgPSByZXNwb25zZS5jb3VudCB8fCByZXNwb25zZS50b3RhbCB8fCAwOwogICAgICAgICAgaGFzTW9yZSA9IGRvY3NMaXN0Lmxlbmd0aCArIGN1cnJlbnRQYWdlRG9jcy5sZW5ndGggPCB0b3RhbENvdW50OwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UucmVzdWx0cyAmJiBBcnJheS5pc0FycmF5KHJlc3BvbnNlLnJlc3VsdHMpKSB7CiAgICAgICAgICBjdXJyZW50UGFnZURvY3MgPSByZXNwb25zZS5yZXN1bHRzOwogICAgICAgICAgdG90YWxDb3VudCA9IHJlc3BvbnNlLmNvdW50IHx8IDA7CiAgICAgICAgICBoYXNNb3JlID0gISFyZXNwb25zZS5uZXh0OwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLnJlc3VsdHMgJiYgQXJyYXkuaXNBcnJheShyZXNwb25zZS5kYXRhLnJlc3VsdHMpKSB7CiAgICAgICAgICBjdXJyZW50UGFnZURvY3MgPSByZXNwb25zZS5kYXRhLnJlc3VsdHM7CiAgICAgICAgICB0b3RhbENvdW50ID0gcmVzcG9uc2UuZGF0YS5jb3VudCB8fCAwOwogICAgICAgICAgaGFzTW9yZSA9ICEhcmVzcG9uc2UuZGF0YS5uZXh0OwogICAgICAgIH0KCiAgICAgICAgLy8g56Gu5L+d5LiN5re75Yqg6YeN5aSN55qE5paH5qGjCiAgICAgICAgY29uc3QgZXhpc3RpbmdJZHMgPSBuZXcgU2V0KGRvY3NMaXN0Lm1hcChkb2MgPT4gZG9jLmlkKSk7CiAgICAgICAgY29uc3QgbmV3RG9jcyA9IGN1cnJlbnRQYWdlRG9jcy5maWx0ZXIoZG9jID0+ICFleGlzdGluZ0lkcy5oYXMoZG9jLmlkKSk7CiAgICAgICAgaWYgKG5ld0RvY3MubGVuZ3RoID4gMCkgewogICAgICAgICAgZG9jc0xpc3QgPSBbLi4uZG9jc0xpc3QsIC4uLm5ld0RvY3NdOwogICAgICAgICAgY29uc29sZS5sb2coYOesrCR7cGFnZX3pobXmt7vliqDkuoYke25ld0RvY3MubGVuZ3RofeS4quaWsOaWh+aho++8jOW9k+WJjeWFseaciSR7ZG9jc0xpc3QubGVuZ3RofeS4quaWh+aho2ApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhg56ysJHtwYWdlfemhteayoeacieaWsOaWh+aho++8jOWPr+iDveaYr+i+vuWIsOS6huacq+WwvuaIluWHuueOsOS6humHjeWkjeaVsOaNrmApOwogICAgICAgIH0KCiAgICAgICAgLy8g5pu05paw5paH5qGj5YiX6KGoCiAgICAgICAgZG9jdW1lbnRzLnZhbHVlID0gZG9jc0xpc3Q7CgogICAgICAgIC8vIOWmguaenOayoeacieabtOWkmuaVsOaNruaIluW3sue7j+WKoOi9veS6hui2s+Wkn+WkmueahOaWh+aho++8jOWImeWBnOatoumAkuW9kgogICAgICAgIGlmICghaGFzTW9yZSB8fCBjdXJyZW50UGFnZURvY3MubGVuZ3RoID09PSAwIHx8IHBhZ2UgPj0gNTApIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGDmlofmoaPliqDovb3lrozmiJDvvIzlhbEke2RvY3NMaXN0Lmxlbmd0aH3kuKrmlofmoaMke2hhc01vcmUgPyAn77yI5L2G6L+Y5pyJ5pu05aSa77yJJyA6ICcnfWApOwogICAgICAgICAgZG9jdW1lbnRzTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgICAgcmV0dXJuIGRvY3NMaXN0OwogICAgICAgIH0KCiAgICAgICAgLy8g5aaC5p6c5paH5qGj5pWw6YeP5aSq5bCR77yI5q+U5aaC5bCP5LqONTDvvInvvIzlubbkuJTmnInmm7TlpJrmlbDmja7vvIznu6fnu63liqDovb3kuIvkuIDpobUKICAgICAgICBpZiAoZG9jc0xpc3QubGVuZ3RoIDwgMjAwICYmIGhhc01vcmUpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGDlt7Lojrflj5YgJHtkb2NzTGlzdC5sZW5ndGh9LyR7dG90YWxDb3VudCB8fCAn5pyq55+lJ30g5Liq5paH5qGj77yM5Yqg6L295LiL5LiA6aG1Li4uYCk7CiAgICAgICAgICAvLyDlu7bov58xMDBtc+mBv+WFjeivt+axgui/h+S6jumikee5gQogICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpOwogICAgICAgICAgLy8g6YCS5b2S5Yqg6L295LiL5LiA6aG1CiAgICAgICAgICByZXR1cm4gZmV0Y2hEb2N1bWVudHMocGFnZSArIDEsIGRvY3NMaXN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS5sb2coYOW3suWKoOi9vei2s+Wkn+eahOaWh+ahoygke2RvY3NMaXN0Lmxlbmd0aH3kuKop5oiW6L6+5Yiw6ZmQ5Yi277yM5YGc5q2i5Yqg6L295pu05aSaYCk7CiAgICAgICAgICBkb2N1bWVudHNMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICByZXR1cm4gZG9jc0xpc3Q7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPluaWh+aho+WIl+ihqOWksei0pScsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+iOt+WPluaWh+aho+WIl+ihqOWksei0pe+8jOW3suWKoOi9vemDqOWIhuaVsOaNricpOwogICAgICAgIGRvY3VtZW50c0xvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICBkb2N1bWVudHMudmFsdWUgPSBhbGxEb2NzOyAvLyDkv53nlZnlt7LliqDovb3nmoTmlofmoaMKICAgICAgICByZXR1cm4gYWxsRG9jczsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IGxvYWRpbmcgPSByZWYoZmFsc2UpOwoKICAgIC8vIOa3u+WKoOS4gOS4quaWh+aho+e8k+WtmOWvueixoQogICAgY29uc3QgZG9jdW1lbnRDYWNoZSA9IHJlZihuZXcgTWFwKCkpOwogICAgY29uc3Qgc2VsZWN0RG9jdW1lbnQgPSBhc3luYyBpZCA9PiB7CiAgICAgIHZhciBfY3VycmVudERvYyR2YWx1ZTsKICAgICAgY29uc29sZS5sb2coYOmAieaLqeaWh+ahozogJHtpZH0sIOW9k+WJjeaWh+ahozogJHsoX2N1cnJlbnREb2MkdmFsdWUgPSBjdXJyZW50RG9jLnZhbHVlKSA9PT0gbnVsbCB8fCBfY3VycmVudERvYyR2YWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2N1cnJlbnREb2MkdmFsdWUuaWR9YCk7CgogICAgICAvLyDlpoLmnpzngrnlh7vnmoTmmK/lvZPliY3mlofmoaPvvIzkuI3miafooYzku7vkvZXmk43kvZwKICAgICAgaWYgKGN1cnJlbnREb2MudmFsdWUgJiYgY3VycmVudERvYy52YWx1ZS5pZCA9PT0gaWQpIHsKICAgICAgICBjb25zb2xlLmxvZygn5bey57uP6YCJ5Lit6K+l5paH5qGj77yM5LiN5omn6KGM5Lu75L2V5pON5L2cJyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyDlpoLmnpzlvZPliY3mlofmoaPlt7Lkv67mlLnvvIzmj5DnpLrkv53lrZgKICAgICAgaWYgKGRvY3VtZW50Q2hhbmdlZC52YWx1ZSAmJiBjdXJyZW50RG9jLnZhbHVlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGF3YWl0IEVsTWVzc2FnZUJveC5jb25maXJtKCflvZPliY3mlofmoaPlt7Lkv67mlLnkvYbmnKrkv53lrZjvvIzmmK/lkKbkv53lrZjmm7TmlLnvvJ8nLCAn5L+d5a2Y5o+Q56S6JywgewogICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+S/neWtmCcsCiAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICfkuI3kv53lrZgnLAogICAgICAgICAgICB0eXBlOiAnd2FybmluZycsCiAgICAgICAgICAgIGRpc3Rpbmd1aXNoQ2FuY2VsQW5kQ2xvc2U6IHRydWUgLy8g5YWB6K645Yy65YiG5Y+W5raI5ZKM5YWz6ZetCiAgICAgICAgICB9KTsKICAgICAgICAgIGF3YWl0IHNhdmVEb2N1bWVudCgpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAvLyDnlKjmiLfpgInmi6nkuI3kv53lrZjmiJbngrnDl++8jOaSpOmUgOacrOWcsOabtOaUue+8jOaBouWkjeWOn+WGheWuuQogICAgICAgICAgaWYgKGVycm9yID09PSAnY2FuY2VsJyB8fCBlcnJvciA9PT0gJ2Nsb3NlJykgewogICAgICAgICAgICBpZiAoY3VycmVudERvYy52YWx1ZSAmJiBvcmlnaW5hbERvYy52YWx1ZSkgewogICAgICAgICAgICAgIGN1cnJlbnREb2MudmFsdWUudGl0bGUgPSBvcmlnaW5hbERvYy52YWx1ZS50aXRsZTsKICAgICAgICAgICAgICBjdXJyZW50RG9jLnZhbHVlLnR5cGUgPSBvcmlnaW5hbERvYy52YWx1ZS50eXBlOwogICAgICAgICAgICAgIGN1cnJlbnREb2MudmFsdWUuY29udGVudCA9IG9yaWdpbmFsRG9jLnZhbHVlLmNvbnRlbnQ7CiAgICAgICAgICAgICAgZG9jdW1lbnRDaGFuZ2VkLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIC8vIOeUqOaIt+mAieaLqeS4jeS/neWtmO+8jOe7p+e7reWIh+aNouaWh+ahowogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8g5b+r6YCf5pi+56S657yT5a2Y5Lit55qE5paH5qGj77yI5aaC5p6c5pyJ77yJCiAgICAgIGlmIChkb2N1bWVudENhY2hlLnZhbHVlLmhhcyhpZCkpIHsKICAgICAgICBjb25zb2xlLmxvZyhg5L2/55So57yT5a2Y55qE5paH5qGj5pWw5o2uOiAke2lkfWApOwogICAgICAgIGNvbnN0IGNhY2hlZERvYyA9IGRvY3VtZW50Q2FjaGUudmFsdWUuZ2V0KGlkKTsKCiAgICAgICAgLy8g5YWI6K6+572u5b2T5YmN5paH5qGj5Li657yT5a2Y5pWw5o2u77yM5o+Q6auY55So5oi35L2T6aqMCiAgICAgICAgY3VycmVudERvYy52YWx1ZSA9IGNhY2hlZERvYzsKICAgICAgICBvcmlnaW5hbERvYy52YWx1ZSA9IHsKICAgICAgICAgIHRpdGxlOiBjYWNoZWREb2MudGl0bGUgfHwgJycsCiAgICAgICAgICB0eXBlOiBjYWNoZWREb2MudHlwZSB8fCAn6YCa55SoJywKICAgICAgICAgIGNvbnRlbnQ6IGNhY2hlZERvYy5jb250ZW50IHx8ICcnCiAgICAgICAgfTsKICAgICAgICBkb2N1bWVudENoYW5nZWQudmFsdWUgPSBmYWxzZTsKICAgICAgfQoKICAgICAgLy8g5pu05paw6Lev55Sx5Lul5Y+N5pig5paw6YCJ5Lit55qE5paH5qGjCiAgICAgIHJvdXRlci5wdXNoKHsKICAgICAgICBuYW1lOiAnU21hcnREb2NEZXRhaWwnLAogICAgICAgIHBhcmFtczogewogICAgICAgICAgaWQKICAgICAgICB9LAogICAgICAgIHJlcGxhY2U6IHRydWUKICAgICAgfSk7CiAgICB9OwoKICAgIC8vIOiusOW9leWIneWni+WGheWuueeUqOS6juWvueavlAogICAgY29uc3Qgb3JpZ2luYWxEb2MgPSByZWYoewogICAgICB0aXRsZTogJycsCiAgICAgIHR5cGU6ICcnLAogICAgICBjb250ZW50OiAnJwogICAgfSk7CiAgICBjb25zdCBmZXRjaERvY3VtZW50RGV0YWlsID0gYXN5bmMgKGlkLCByZXRyeSA9IDApID0+IHsKICAgICAgLy8g5aaC5p6c5piv5ZCM5LiA5Liq5paH5qGj77yM5LiU5bey5Yqg6L2977yM5LiN6YeN5aSN5Yqg6L29CiAgICAgIGlmIChjdXJyZW50RG9jLnZhbHVlICYmIGN1cnJlbnREb2MudmFsdWUuaWQgPT09IGlkICYmICFsb2FkaW5nLnZhbHVlKSB7CiAgICAgICAgY29uc29sZS5sb2coYOaWh+ahoyAke2lkfSDlt7LliqDovb3vvIzkuI3ph43lpI3ojrflj5ZgKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgbG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc29sZS5sb2coYOato+WcqOiOt+WPluaWh+aho+ivpuaDhe+8jElEOiAke2lkfWApOwogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0RG9jdW1lbnREZXRhaWwoaWQpOwogICAgICAgIGNvbnNvbGUubG9nKCfmlofmoaPor6bmg4Xlk43lupQ6JywgcmVzcG9uc2UpOwogICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhKSB7CiAgICAgICAgICAvLyDnoa7kv53mlofmoaPmlbDmja7lrozmlbQKICAgICAgICAgIGlmICghcmVzcG9uc2UuZGF0YS5jb250ZW50KSB7CiAgICAgICAgICAgIGNvbnNvbGUud2Fybign5paH5qGj5YaF5a655Li656m677yM6K6+572u5Li66buY6K6k56m65a2X56ym5LiyJyk7CiAgICAgICAgICAgIHJlc3BvbnNlLmRhdGEuY29udGVudCA9ICcnOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOS/neWtmOaWh+aho+aVsOaNrgogICAgICAgICAgY3VycmVudERvYy52YWx1ZSA9IHJlc3BvbnNlLmRhdGE7CgogICAgICAgICAgLy8g5pu05paw57yT5a2YCiAgICAgICAgICBkb2N1bWVudENhY2hlLnZhbHVlLnNldChpZCwgewogICAgICAgICAgICAuLi5yZXNwb25zZS5kYXRhCiAgICAgICAgICB9KTsKCiAgICAgICAgICAvLyDlpoLmnpznvJPlrZjov4flpKfvvIzmuIXnkIbml6fnvJPlrZgKICAgICAgICAgIGlmIChkb2N1bWVudENhY2hlLnZhbHVlLnNpemUgPiAyMCkgewogICAgICAgICAgICAvLyDovazmjaLkuLrmlbDnu4TvvIzkv53nlZnmnIDov5HnmoQxMOS4qgogICAgICAgICAgICBjb25zdCBlbnRyaWVzID0gQXJyYXkuZnJvbShkb2N1bWVudENhY2hlLnZhbHVlLmVudHJpZXMoKSk7CiAgICAgICAgICAgIGNvbnN0IHJlY2VudEVudHJpZXMgPSBlbnRyaWVzLnNsaWNlKC0xMCk7CiAgICAgICAgICAgIGRvY3VtZW50Q2FjaGUudmFsdWUgPSBuZXcgTWFwKHJlY2VudEVudHJpZXMpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOiusOW9leWIneWni+WGheWuuQogICAgICAgICAgb3JpZ2luYWxEb2MudmFsdWUgPSB7CiAgICAgICAgICAgIHRpdGxlOiByZXNwb25zZS5kYXRhLnRpdGxlIHx8ICcnLAogICAgICAgICAgICB0eXBlOiByZXNwb25zZS5kYXRhLnR5cGUgfHwgJ+mAmueUqCcsCiAgICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmRhdGEuY29udGVudCB8fCAnJwogICAgICAgICAgfTsKICAgICAgICAgIGRvY3VtZW50Q2hhbmdlZC52YWx1ZSA9IGZhbHNlOwogICAgICAgICAgbG9hZGluZy52YWx1ZSA9IGZhbHNlOwoKICAgICAgICAgIC8vIOajgOafpeaVsOaNruWujOaVtOaApwogICAgICAgICAgaWYgKCFjdXJyZW50RG9jLnZhbHVlLmNvbnRlbnQpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKCfmlofmoaPlhoXlrrnlj6/og73nvLrlpLHvvIzlsJ3or5Xph43mlrDojrflj5YnKTsKICAgICAgICAgICAgLy8g6K6+572u5LiA5Liq5a6a5pe25Zmo77yM5Zyo57yW6L6R5Zmo5Yqg6L295a6M5oiQ5ZCO5qOA5p+l5YaF5a65CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgIGlmIChxdWlsbEluc3RhbmNlLnZhbHVlICYmICghY3VycmVudERvYy52YWx1ZS5jb250ZW50IHx8IGN1cnJlbnREb2MudmFsdWUuY29udGVudC50cmltKCkgPT09ICcnKSkgewogICAgICAgICAgICAgICAgRWxNZXNzYWdlLndhcm5pbmcoJ+aWh+aho+WGheWuueWPr+iDveS4jeWujOaVtO+8jOivt+WwneivleWIt+aWsOmhtemdoicpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgMjAwMCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcign5paH5qGj5LiN5a2Y5Zyo5oiW5pWw5o2u5peg5pWIJyk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPluaWh+aho+ivpuaDheWksei0pScsIGVycm9yKTsKICAgICAgICBpZiAocmV0cnkgPCAzKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhg6I635Y+W5paH5qGj6K+m5oOF5aSx6LSl77yMJHtyZXRyeSArIDF956eS5ZCO6YeN6K+VLi4uYCk7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGZldGNoRG9jdW1lbnREZXRhaWwoaWQsIHJldHJ5ICsgMSksIDEwMDAgKiAocmV0cnkgKyAxKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WkmuasoemHjeivleWQjuiOt+WPluaWh+aho+ivpuaDheS7jeeEtuWksei0pScsIGVycm9yKTsKICAgICAgICAgIGNvbnN0IGVycm9yTXNnID0gZXJyb3IucmVzcG9uc2UgJiYgZXJyb3IucmVzcG9uc2Uuc3RhdHVzID09PSA0MDQgPyAn5paH5qGj5LiN5a2Y5ZyoJyA6IGVycm9yLnJlc3BvbnNlICYmIGVycm9yLnJlc3BvbnNlLmRhdGEgJiYgZXJyb3IucmVzcG9uc2UuZGF0YS5kZXRhaWwgPyBlcnJvci5yZXNwb25zZS5kYXRhLmRldGFpbCA6ICfojrflj5bmlofmoaPor6bmg4XlpLHotKUnOwogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKGVycm9yTXNnKTsKICAgICAgICAgIC8vIOWmguaenOaYrzQwNO+8jOWvvOiIquWbnuaWh+aho+WIl+ihqOmhtQogICAgICAgICAgaWYgKGVycm9yLnJlc3BvbnNlICYmIGVycm9yLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSB7CiAgICAgICAgICAgIHJvdXRlci5wdXNoKCcvc21hcnRkb2MnKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH07CiAgICBjb25zdCBzYXZlRG9jdW1lbnQgPSBhc3luYyAoKSA9PiB7CiAgICAgIGlmICghY3VycmVudERvYy52YWx1ZSB8fCAhZG9jdW1lbnRDaGFuZ2VkLnZhbHVlKSByZXR1cm47CiAgICAgIHNhdmVMb2FkaW5nLnZhbHVlID0gdHJ1ZTsKICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCB1cGRhdGVEb2N1bWVudChjdXJyZW50RG9jLnZhbHVlLmlkLCB7CiAgICAgICAgICB0aXRsZTogY3VycmVudERvYy52YWx1ZS50aXRsZSwKICAgICAgICAgIHR5cGU6IGN1cnJlbnREb2MudmFsdWUudHlwZSwKICAgICAgICAgIGNvbnRlbnQ6IGN1cnJlbnREb2MudmFsdWUuY29udGVudAogICAgICAgIH0pOwoKICAgICAgICAvLyDkv53lrZjmiJDlip/lkI7vvIzmm7TmlrDljp/lp4vmlofmoaPorrDlvZUKICAgICAgICBvcmlnaW5hbERvYy52YWx1ZSA9IHsKICAgICAgICAgIHRpdGxlOiBjdXJyZW50RG9jLnZhbHVlLnRpdGxlLAogICAgICAgICAgdHlwZTogY3VycmVudERvYy52YWx1ZS50eXBlLAogICAgICAgICAgY29udGVudDogY3VycmVudERvYy52YWx1ZS5jb250ZW50CiAgICAgICAgfTsKICAgICAgICBkb2N1bWVudENoYW5nZWQudmFsdWUgPSBmYWxzZTsKICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5paH5qGj5L+d5a2Y5oiQ5YqfJyk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5L+d5a2Y5paH5qGj5aSx6LSlJywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5L+d5a2Y5paH5qGj5aSx6LSlJyk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgc2F2ZUxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHRvZ2dsZURvY0xpc3QgPSAoKSA9PiB7CiAgICAgIGlzRG9jTGlzdENvbGxhcHNlZC52YWx1ZSA9ICFpc0RvY0xpc3RDb2xsYXBzZWQudmFsdWU7CiAgICB9OwogICAgY29uc3QgdG9nZ2xlQXNzaXN0YW50ID0gKCkgPT4gewogICAgICBpc0Fzc2lzdGFudENvbGxhcHNlZC52YWx1ZSA9ICFpc0Fzc2lzdGFudENvbGxhcHNlZC52YWx1ZTsKICAgIH07CiAgICBjb25zdCBvbkVkaXRvckNoYW5nZSA9ICgpID0+IHsKICAgICAgZG9jdW1lbnRDaGFuZ2VkLnZhbHVlID0gdHJ1ZTsKICAgIH07CiAgICBjb25zdCBvcGVuTmV3RG9jdW1lbnREaWFsb2cgPSAoKSA9PiB7CiAgICAgIG5ld0RvY3VtZW50Rm9ybS52YWx1ZSA9IHsKICAgICAgICB0aXRsZTogJycsCiAgICAgICAgdHlwZTogJycKICAgICAgfTsKICAgICAgbmV3RG9jdW1lbnREaWFsb2dWaXNpYmxlLnZhbHVlID0gdHJ1ZTsKICAgIH07CiAgICBjb25zdCBjcmVhdGVOZXdEb2N1bWVudCA9IGFzeW5jICgpID0+IHsKICAgICAgaWYgKCFkb2N1bWVudEZvcm1SZWYudmFsdWUpIHJldHVybjsKICAgICAgYXdhaXQgZG9jdW1lbnRGb3JtUmVmLnZhbHVlLnZhbGlkYXRlKGFzeW5jIHZhbGlkID0+IHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIGNyZWF0ZUxvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjcmVhdGVEb2N1bWVudCh7CiAgICAgICAgICAgICAgdGl0bGU6IG5ld0RvY3VtZW50Rm9ybS52YWx1ZS50aXRsZSwKICAgICAgICAgICAgICB0eXBlOiBuZXdEb2N1bWVudEZvcm0udmFsdWUudHlwZSB8fCAn6YCa55SoJywKICAgICAgICAgICAgICBjb250ZW50OiAnJwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+aWh+aho+WIm+W7uuaIkOWKnycpOwogICAgICAgICAgICBuZXdEb2N1bWVudERpYWxvZ1Zpc2libGUudmFsdWUgPSBmYWxzZTsKCiAgICAgICAgICAgIC8vIOWIt+aWsOaWh+aho+WIl+ihqOW5tuaJk+W8gOaWsOaWh+ahowogICAgICAgICAgICBhd2FpdCBmZXRjaERvY3VtZW50cygpOwogICAgICAgICAgICByb3V0ZXIucHVzaCh7CiAgICAgICAgICAgICAgbmFtZTogJ1NtYXJ0RG9jRGV0YWlsJywKICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgIGlkOiByZXNwb25zZS5kYXRhLmlkCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WIm+W7uuaWh+aho+Wksei0pScsIGVycm9yKTsKICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfliJvlu7rmlofmoaPlpLHotKUnKTsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGNyZWF0ZUxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfTsKICAgIGNvbnN0IHNoYXJlRG9jdW1lbnQgPSBhc3luYyAoKSA9PiB7CiAgICAgIGlmICghY3VycmVudERvYy52YWx1ZSkgcmV0dXJuOwoKICAgICAgLy8g5pi+56S65Yqg6L2954q25oCBCiAgICAgIHNoYXJlTG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgIHRyeSB7CiAgICAgICAgLy8g5LuOQVBJ6I635Y+W5YWs5Y+45omA5pyJ55So5oi3CiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlckFwaS5nZXRDb21wYW55VXNlcnMoKTsKICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgJiYgQXJyYXkuaXNBcnJheShyZXN1bHQuZGF0YSkpIHsKICAgICAgICAgIC8vIOiOt+WPluW9k+WJjeeUqOaIt0lECiAgICAgICAgICBjb25zdCBjdXJyZW50VXNlckpzb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlcicpOwogICAgICAgICAgbGV0IGN1cnJlbnRVc2VySWQgPSBudWxsOwogICAgICAgICAgaWYgKGN1cnJlbnRVc2VySnNvbikgewogICAgICAgICAgICBjb25zdCBjdXJyZW50VXNlciA9IEpTT04ucGFyc2UoY3VycmVudFVzZXJKc29uKTsKICAgICAgICAgICAgY3VycmVudFVzZXJJZCA9IGN1cnJlbnRVc2VyLmlkOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIOi/h+a7pOaOieW9k+WJjeeUqOaIt++8jOWPquaYvuekuuWFtuS7lueUqOaItwogICAgICAgICAgYXZhaWxhYmxlVXNlcnMudmFsdWUgPSByZXN1bHQuZGF0YS5maWx0ZXIodXNlciA9PiB1c2VyLmlkICE9PSBjdXJyZW50VXNlcklkKS5tYXAodXNlciA9PiAoewogICAgICAgICAgICBpZDogdXNlci5pZCwKICAgICAgICAgICAgdXNlcm5hbWU6IHVzZXIubmFtZSB8fCB1c2VyLnVzZXJuYW1lIHx8IHVzZXIuZW1haWwgfHwgYOeUqOaItyR7dXNlci5pZH1gCiAgICAgICAgICB9KSk7CiAgICAgICAgICBjb25zb2xlLmxvZygn5Y+v5YiG5Lqr55So5oi35YiX6KGoOicsIGF2YWlsYWJsZVVzZXJzLnZhbHVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgRWxNZXNzYWdlLndhcm5pbmcoJ+iOt+WPlueUqOaIt+WIl+ihqOWksei0pTogJyArIChyZXN1bHQubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJykpOwogICAgICAgICAgYXZhaWxhYmxlVXNlcnMudmFsdWUgPSBbXTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign6I635Y+W55So5oi35YiX6KGo5aSx6LSlOicsIGVycm9yKTsKICAgICAgICBFbE1lc3NhZ2Uud2FybmluZygn6I635Y+W55So5oi35YiX6KGo5aSx6LSl77yM6K+36YeN6K+VJyk7CiAgICAgICAgYXZhaWxhYmxlVXNlcnMudmFsdWUgPSBbXTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAvLyDpmpDol4/liqDovb3nirbmgIEKICAgICAgICBzaGFyZUxvYWRpbmcudmFsdWUgPSBmYWxzZTsKCiAgICAgICAgLy8g6YeN572u5YiG5Lqr55u45YWz5Y+Y6YePCiAgICAgICAgc2hhcmVNZXRob2QudmFsdWUgPSAncGVybWlzc2lvbic7CiAgICAgICAgc2hhcmVGb3JtYXQudmFsdWUgPSAncGRmJzsKICAgICAgICBzZWxlY3RlZFVzZXJzLnZhbHVlID0gW107CiAgICAgICAgc2VsZWN0ZWRDaGF0VXNlcnMudmFsdWUgPSBbXTsKCiAgICAgICAgLy8g5pi+56S65a+56K+d5qGGCiAgICAgICAgc2hhcmVEaWFsb2dWaXNpYmxlLnZhbHVlID0gdHJ1ZTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IGNvbmZpcm1TaGFyZSA9IGFzeW5jICgpID0+IHsKICAgICAgLy8g5p2D6ZmQ5YiG5Lqr5pa55byPCiAgICAgIGlmIChzaGFyZU1ldGhvZC52YWx1ZSA9PT0gJ3Blcm1pc3Npb24nKSB7CiAgICAgICAgaWYgKCFjdXJyZW50RG9jLnZhbHVlIHx8IHNlbGVjdGVkVXNlcnMudmFsdWUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBFbE1lc3NhZ2Uud2FybmluZygn6K+36YCJ5oup6Iez5bCR5LiA5Liq55So5oi3Jyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHNoYXJlTG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGF3YWl0IGFwaVNoYXJlRG9jdW1lbnQoY3VycmVudERvYy52YWx1ZS5pZCwgc2VsZWN0ZWRVc2Vycy52YWx1ZSk7CiAgICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5paH5qGj5YiG5Lqr5oiQ5YqfJyk7CiAgICAgICAgICBzaGFyZURpYWxvZ1Zpc2libGUudmFsdWUgPSBmYWxzZTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcign5YiG5Lqr5paH5qGj5aSx6LSlJywgZXJyb3IpOwogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfliIbkuqvmlofmoaPlpLHotKUnKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgc2hhcmVMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIOiBiuWkqeWIhuS6q+aWueW8jwogICAgICBlbHNlIGlmIChzaGFyZU1ldGhvZC52YWx1ZSA9PT0gJ2NoYXQnKSB7CiAgICAgICAgaWYgKCFjdXJyZW50RG9jLnZhbHVlIHx8IHNlbGVjdGVkQ2hhdFVzZXJzLnZhbHVlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgRWxNZXNzYWdlLndhcm5pbmcoJ+ivt+mAieaLqeiHs+WwkeS4gOS4quaOpeaUtueUqOaItycpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBzaGFyZUxvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAvLyDojrflj5blvZPliY3nlKjmiLfkv6Hmga8KICAgICAgICAgIGNvbnN0IGN1cnJlbnRVc2VySnNvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd1c2VyJyk7CiAgICAgICAgICBsZXQgY3VycmVudFVzZXJJZCA9IG51bGw7CiAgICAgICAgICBpZiAoY3VycmVudFVzZXJKc29uKSB7CiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gSlNPTi5wYXJzZShjdXJyZW50VXNlckpzb24pOwogICAgICAgICAgICBjdXJyZW50VXNlcklkID0gY3VycmVudFVzZXIuaWQ7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIWN1cnJlbnRVc2VySWQpIHsKICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfml6Dms5Xojrflj5blvZPliY3nlKjmiLfkv6Hmga8nKTsKICAgICAgICAgICAgc2hhcmVMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyDkvb/nlKjliY3nq6/lr7zlh7rmlofku7bnmoTmlrnlvI/ojrflj5bmlofku7YKICAgICAgICAgIGNvbnN0IGxvYWRpbmcgPSBFbExvYWRpbmcuc2VydmljZSh7CiAgICAgICAgICAgIGxvY2s6IHRydWUsCiAgICAgICAgICAgIHRleHQ6IGDmraPlnKjlh4blpIcke3NoYXJlRm9ybWF0LnZhbHVlID09PSAncGRmJyA/ICdQREYnIDogJ1dvcmQnfeaWh+S7ti4uLmAsCiAgICAgICAgICAgIGJhY2tncm91bmQ6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNyknCiAgICAgICAgICB9KTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIOWHhuWkh+aWh+aho+WGheWuuQogICAgICAgICAgICBjb25zdCBkb2NUaXRsZSA9IGN1cnJlbnREb2MudmFsdWUudGl0bGUgfHwgJ+acquWRveWQjeaWh+ahoyc7CiAgICAgICAgICAgIGNvbnN0IGRvY3VtZW50Q29udGVudCA9IGN1cnJlbnREb2MudmFsdWUuY29udGVudDsKCiAgICAgICAgICAgIC8vIOWIm+W7uuS4tOaXtuWuueWZqOeUqOS6juWvvOWHugogICAgICAgICAgICBjb25zdCB0ZW1wQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgIHRlbXBDb250YWluZXIuaW5uZXJIVE1MID0gZG9jdW1lbnRDb250ZW50OwogICAgICAgICAgICB0ZW1wQ29udGFpbmVyLmNsYXNzTmFtZSA9ICd0ZW1wLWV4cG9ydC1jb250YWluZXInOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRlbXBDb250YWluZXIpOwogICAgICAgICAgICBsZXQgZG9jdW1lbnRGaWxlID0gbnVsbDsKICAgICAgICAgICAgbGV0IGZpbGVOYW1lID0gZG9jVGl0bGU7CiAgICAgICAgICAgIGxldCBmaWxlVHlwZSA9ICcnOwogICAgICAgICAgICBpZiAoc2hhcmVGb3JtYXQudmFsdWUgPT09ICdwZGYnKSB7CiAgICAgICAgICAgICAgZmlsZU5hbWUgKz0gJy5wZGYnOwogICAgICAgICAgICAgIGZpbGVUeXBlID0gJ2FwcGxpY2F0aW9uL3BkZic7CiAgICAgICAgICAgICAgbG9hZGluZy5zZXRUZXh0KCfmraPlnKjnlJ/miJBQREbmlofku7YuLi4nKTsKCiAgICAgICAgICAgICAgLy8g5Yqo5oCB5a+85YWlaHRtbDJwZGYuanMKICAgICAgICAgICAgICBjb25zdCBodG1sMnBkZk1vZHVsZSA9IGF3YWl0IGltcG9ydCgnaHRtbDJwZGYuanMnKTsKICAgICAgICAgICAgICBjb25zdCBodG1sMnBkZiA9IGh0bWwycGRmTW9kdWxlLmRlZmF1bHQ7CiAgICAgICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgICAgICAgICAgIG1hcmdpbjogWzE1LCAxNSwgMTUsIDE1XSwKICAgICAgICAgICAgICAgIGZpbGVuYW1lOiBmaWxlTmFtZSwKICAgICAgICAgICAgICAgIGltYWdlOiB7CiAgICAgICAgICAgICAgICAgIHR5cGU6ICdqcGVnJywKICAgICAgICAgICAgICAgICAgcXVhbGl0eTogMC45OAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGh0bWwyY2FudmFzOiB7CiAgICAgICAgICAgICAgICAgIHNjYWxlOiAyLAogICAgICAgICAgICAgICAgICB1c2VDT1JTOiB0cnVlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAganNQREY6IHsKICAgICAgICAgICAgICAgICAgdW5pdDogJ21tJywKICAgICAgICAgICAgICAgICAgZm9ybWF0OiAnYTQnLAogICAgICAgICAgICAgICAgICBvcmllbnRhdGlvbjogJ3BvcnRyYWl0JwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIC8vIOeUn+aIkFBERuW5tuiOt+WPlkJsb2IKICAgICAgICAgICAgICBkb2N1bWVudEZpbGUgPSBhd2FpdCBodG1sMnBkZigpLmZyb20odGVtcENvbnRhaW5lcikuc2V0KG9wdGlvbnMpLm91dHB1dFBkZignYmxvYicpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGZpbGVOYW1lICs9ICcuZG9jJzsKICAgICAgICAgICAgICBmaWxlVHlwZSA9ICdhcHBsaWNhdGlvbi9tc3dvcmQnOwogICAgICAgICAgICAgIGxvYWRpbmcuc2V0VGV4dCgn5q2j5Zyo55Sf5oiQV29yZOaWh+S7ti4uLicpOwoKICAgICAgICAgICAgICAvLyDliJvlu7rlvq7ova9Xb3Jk5YW85a6555qESFRNTOaWh+ahowogICAgICAgICAgICAgIGNvbnN0IG1zV29yZEh0bWwgPSBgCiAgICAgICAgICAgICAgICA8aHRtbCB4bWxuczpvPSJ1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOm9mZmljZTpvZmZpY2UiIAogICAgICAgICAgICAgICAgICAgICAgeG1sbnM6dz0idXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTpvZmZpY2U6d29yZCIgCiAgICAgICAgICAgICAgICAgICAgICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvVFIvUkVDLWh0bWw0MCI+CiAgICAgICAgICAgICAgICA8aGVhZD4KICAgICAgICAgICAgICAgICAgPG1ldGEgY2hhcnNldD0idXRmLTgiPgogICAgICAgICAgICAgICAgICA8dGl0bGU+JHtkb2NUaXRsZX08L3RpdGxlPgogICAgICAgICAgICAgICAgICA8c3R5bGU+CiAgICAgICAgICAgICAgICAgICAgYm9keSB7IGZvbnQtZmFtaWx5OiBTaW1TdW4sIEFyaWFsLCBzYW5zLXNlcmlmOyBtYXJnaW46IDFjbTsgfQogICAgICAgICAgICAgICAgICAgIGltZyB7IG1heC13aWR0aDogMTAwJTsgaGVpZ2h0OiBhdXRvOyB9CiAgICAgICAgICAgICAgICAgICAgcCB7IG1hcmdpbjogMDsgcGFkZGluZzogMDsgfQogICAgICAgICAgICAgICAgICAgIGgxIHsgZm9udC1zaXplOiAxOHB0OyB9CiAgICAgICAgICAgICAgICAgICAgaDIgeyBmb250LXNpemU6IDE2cHQ7IH0KICAgICAgICAgICAgICAgICAgICBoMyB7IGZvbnQtc2l6ZTogMTRwdDsgfQogICAgICAgICAgICAgICAgICAgIHRhYmxlIHsgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsgd2lkdGg6IDEwMCU7IH0KICAgICAgICAgICAgICAgICAgICB0ZCwgdGggeyBib3JkZXI6IDFweCBzb2xpZCAjMDAwOyBwYWRkaW5nOiA1cHg7IH0KICAgICAgICAgICAgICAgICAgPC9zdHlsZT4KICAgICAgICAgICAgICAgIDwvaGVhZD4KICAgICAgICAgICAgICAgIDxib2R5PgogICAgICAgICAgICAgICAgICA8aDE+JHtkb2NUaXRsZX08L2gxPgogICAgICAgICAgICAgICAgICAke3RlbXBDb250YWluZXIuaW5uZXJIVE1MfQogICAgICAgICAgICAgICAgPC9ib2R5PgogICAgICAgICAgICAgICAgPC9odG1sPgogICAgICAgICAgICAgIGA7CgogICAgICAgICAgICAgIC8vIOWIm+W7ukJsb2IKICAgICAgICAgICAgICBkb2N1bWVudEZpbGUgPSBuZXcgQmxvYihbbXNXb3JkSHRtbF0sIHsKICAgICAgICAgICAgICAgIHR5cGU6IGZpbGVUeXBlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIOa4heeQhuS4tOaXtuWFg+e0oAogICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRlbXBDb250YWluZXIpOwoKICAgICAgICAgICAgLy8g6L+b5YWl5Li65q+P5Liq55So5oi35Y+R6YCB5paH5Lu255qE5rWB56iLCiAgICAgICAgICAgIGxvYWRpbmcuc2V0VGV4dCgn5q2j5Zyo5Y+R6YCB5Yiw6IGK5aSpLi4uJyk7CgogICAgICAgICAgICAvLyDkuLrmr4/kuKrpgInkuK3nmoTnlKjmiLfliJvlu7rmiJbojrflj5bogYrlpKnkvJror53vvIzlubblj5HpgIHmlofmoaMKICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBzZWxlY3RlZENoYXRVc2Vycy52YWx1ZS5tYXAoYXN5bmMgdXNlcklkID0+IHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8g6I635Y+W546w5pyJ6IGK5aSp5Lya6K+d5YiX6KGoCiAgICAgICAgICAgICAgICBjb25zdCBzZXNzaW9uc1Jlc3BvbnNlID0gYXdhaXQgZ2V0Q2hhdFNlc3Npb25zKCk7CiAgICAgICAgICAgICAgICBsZXQgY2hhdElkID0gbnVsbDsKCiAgICAgICAgICAgICAgICAvLyDmo4Dmn6XmmK/lkKblt7LmnInkuI7or6XnlKjmiLfnmoTkvJror50KICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uc1Jlc3BvbnNlICYmIHNlc3Npb25zUmVzcG9uc2UuZGF0YSAmJiBBcnJheS5pc0FycmF5KHNlc3Npb25zUmVzcG9uc2UuZGF0YSkpIHsKICAgICAgICAgICAgICAgICAgLy8g55u05o6l5pWw57uE5qC85byP5ZON5bqUCiAgICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nU2Vzc2lvbiA9IHNlc3Npb25zUmVzcG9uc2UuZGF0YS5maW5kKHNlc3Npb24gPT4gc2Vzc2lvbi5wYXJ0aWNpcGFudHMubGVuZ3RoID09PSAyICYmIHNlc3Npb24ucGFydGljaXBhbnRzLnNvbWUocCA9PiBwLmlkID09PSB1c2VySWQpICYmIHNlc3Npb24ucGFydGljaXBhbnRzLnNvbWUocCA9PiBwLmlkID09PSBjdXJyZW50VXNlcklkKSk7CiAgICAgICAgICAgICAgICAgIGlmIChleGlzdGluZ1Nlc3Npb24pIHsKICAgICAgICAgICAgICAgICAgICBjaGF0SWQgPSBleGlzdGluZ1Nlc3Npb24uaWQ7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYOaJvuWIsOeOsOacieS8muivnTogJHtjaGF0SWR9YCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2Vzc2lvbnNSZXNwb25zZSAmJiBzZXNzaW9uc1Jlc3BvbnNlLnJlc3VsdHMgJiYgQXJyYXkuaXNBcnJheShzZXNzaW9uc1Jlc3BvbnNlLnJlc3VsdHMpKSB7CiAgICAgICAgICAgICAgICAgIC8vIERSRuWIhumhteagvOW8jwogICAgICAgICAgICAgICAgICBjb25zdCBleGlzdGluZ1Nlc3Npb24gPSBzZXNzaW9uc1Jlc3BvbnNlLnJlc3VsdHMuZmluZChzZXNzaW9uID0+IHNlc3Npb24ucGFydGljaXBhbnRzLmxlbmd0aCA9PT0gMiAmJiBzZXNzaW9uLnBhcnRpY2lwYW50cy5zb21lKHAgPT4gcC5pZCA9PT0gdXNlcklkKSAmJiBzZXNzaW9uLnBhcnRpY2lwYW50cy5zb21lKHAgPT4gcC5pZCA9PT0gY3VycmVudFVzZXJJZCkpOwogICAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdTZXNzaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY2hhdElkID0gZXhpc3RpbmdTZXNzaW9uLmlkOwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGDmib7liLDnjrDmnInkvJror506ICR7Y2hhdElkfWApOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8g5aaC5p6c5rKh5om+5Yiw546w5pyJ5Lya6K+d77yM5Yib5bu65paw5Lya6K+dCiAgICAgICAgICAgICAgICBpZiAoIWNoYXRJZCkgewogICAgICAgICAgICAgICAgICBjb25zdCBzZXNzaW9uUmVzcG9uc2UgPSBhd2FpdCBjcmVhdGVDaGF0U2Vzc2lvbih7CiAgICAgICAgICAgICAgICAgICAgcGFydGljaXBhbnRfaWRzOiBbY3VycmVudFVzZXJJZCwgdXNlcklkXSwKICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ+aWh+aho+WIhuS6qycKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIGlmICghc2Vzc2lvblJlc3BvbnNlIHx8ICFzZXNzaW9uUmVzcG9uc2UuZGF0YSB8fCAhc2Vzc2lvblJlc3BvbnNlLmRhdGEuaWQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCfliJvlu7rogYrlpKnkvJror53lpLHotKU6Jywgc2Vzc2lvblJlc3BvbnNlKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgY2hhdElkID0gc2Vzc2lvblJlc3BvbnNlLmRhdGEuaWQ7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGDliJvlu7rmlrDogYrlpKnkvJror506ICR7Y2hhdElkfWApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIOWIm+W7ukZvcm1EYXRh5a+56LGh77yM5re75Yqg5paH5Lu25ZKM55u45YWz5L+h5oGvCiAgICAgICAgICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdjaGF0JywgY2hhdElkKTsKICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnbWVzc2FnZV90eXBlJywgJ2ZpbGUnKTsKICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnY29udGVudCcsIGDliIbkuqvkuobkuIDkuKoke3NoYXJlRm9ybWF0LnZhbHVlID09PSAncGRmJyA/ICdQREYnIDogJ1dvcmQnfeaWh+ahozogJHtkb2NUaXRsZX1gKTsKCiAgICAgICAgICAgICAgICAvLyDlsIbmlofku7ZCbG9i6L2s5o2i5Li6RmlsZeWvueixoQogICAgICAgICAgICAgICAgY29uc3QgZmlsZSA9IG5ldyBGaWxlKFtkb2N1bWVudEZpbGVdLCBmaWxlTmFtZSwgewogICAgICAgICAgICAgICAgICB0eXBlOiBmaWxlVHlwZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2ZpbGUnLCBmaWxlKTsKCiAgICAgICAgICAgICAgICAvLyDlj5HpgIHmlofku7bmtojmga8KICAgICAgICAgICAgICAgIGF3YWl0IHJlcXVlc3QoewogICAgICAgICAgICAgICAgICB1cmw6ICcvYXBpL2NoYXQvbWVzc2FnZXMvJywKICAgICAgICAgICAgICAgICAgbWV0aG9kOiAncG9zdCcsCiAgICAgICAgICAgICAgICAgIGRhdGE6IGZvcm1EYXRhLAogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdtdWx0aXBhcnQvZm9ybS1kYXRhJwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGDlkJHnlKjmiLcgJHt1c2VySWR9IOWPkemAgeaWh+aho+Wksei0pTpgLCBlcnJvcik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIOetieW+heaJgOacieWPkemAgeWujOaIkAogICAgICAgICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpOwogICAgICAgICAgICBjb25zdCBzdWNjZXNzQ291bnQgPSByZXN1bHRzLmZpbHRlcihyZXN1bHQgPT4gcmVzdWx0KS5sZW5ndGg7CiAgICAgICAgICAgIGlmIChzdWNjZXNzQ291bnQgPiAwKSB7CiAgICAgICAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoYOaIkOWKn+WPkemAgeaWh+aho+WIsCAke3N1Y2Nlc3NDb3VudH0g5Liq55So5oi355qE6IGK5aSpYCk7CiAgICAgICAgICAgICAgc2hhcmVEaWFsb2dWaXNpYmxlLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCflj5HpgIHmlofmoaPlpLHotKXvvIzor7fph43or5UnKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcign55Sf5oiQ5paH5qGj5paH5Lu25aSx6LSlOicsIGVycm9yKTsKICAgICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfnlJ/miJDmlofmoaPmlofku7blpLHotKUnKTsKICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGxvYWRpbmcuY2xvc2UoKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcign5YiG5Lqr5paH5qGj5Yiw6IGK5aSp5aSx6LSlOicsIGVycm9yKTsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5YiG5Lqr5paH5qGj5Yiw6IGK5aSp5aSx6LSlJyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgIHNoYXJlTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIGNvbnN0IGRlbGV0ZURvY3VtZW50ID0gKCkgPT4gewogICAgICBpZiAoIWN1cnJlbnREb2MudmFsdWUpIHJldHVybjsKICAgICAgZGVsZXRlRGlhbG9nVmlzaWJsZS52YWx1ZSA9IHRydWU7CiAgICB9OwogICAgY29uc3QgY29uZmlybURlbGV0ZSA9IGFzeW5jICgpID0+IHsKICAgICAgaWYgKCFjdXJyZW50RG9jLnZhbHVlKSByZXR1cm47CiAgICAgIGRlbGV0ZUxvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICB0cnkgewogICAgICAgIC8vIOiusOW9leWwhuimgeWIoOmZpOeahOaWh+aho0lE77yM5L6/5LqO6LCD6K+VCiAgICAgICAgY29uc3QgZGVsZXRlZERvY0lkID0gY3VycmVudERvYy52YWx1ZS5pZDsKCiAgICAgICAgLy8g5omn6KGM5Yig6ZmkQVBJ6LCD55SoCiAgICAgICAgYXdhaXQgYXBpRGVsZXRlRG9jdW1lbnQoZGVsZXRlZERvY0lkKTsKICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5paH5qGj5Yig6Zmk5oiQ5YqfJyk7CiAgICAgICAgZGVsZXRlRGlhbG9nVmlzaWJsZS52YWx1ZSA9IGZhbHNlOwogICAgICAgIGNvbnNvbGUubG9nKGDmlofmoaPlt7LliKDpmaTvvIxJRDogJHtkZWxldGVkRG9jSWR977yM5YeG5aSH6L+U5Zue5YiX6KGo6aG16Z2i5bm25Yi35pawYCk7CgogICAgICAgIC8vIOa4hemZpOWPr+iDveeahOe8k+WtmOaVsOaNrgogICAgICAgIGlmICh3aW5kb3cubG9jYWxTdG9yYWdlKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICAvLyDnp7vpmaTlj6/og73lrZjlnKjnmoTnm7jlhbPnvJPlrZgKICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oYGRvY19jYWNoZV8ke2RlbGV0ZWREb2NJZH1gKTsKICAgICAgICAgICAgLy8g56e76Zmk5paH5qGj5YiX6KGo57yT5a2Y77yM56Gu5L+d5YaN5qyh5Yqg6L295pe26I635Y+W5pyA5paw5pWw5o2uCiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGBkb2NfbGlzdF9jYWNoZWApOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCfmuIXpmaTmnKzlnLDnvJPlrZjlpLHotKU6JywgZSk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyDmuIXpmaTlvZPliY3mlofmoaPnirbmgIHvvIzpgb/lhY3lj6/og73nmoTlhoXlrZjms4TmvI8KICAgICAgICBjdXJyZW50RG9jLnZhbHVlID0gbnVsbDsKCiAgICAgICAgLy8g5L2/55Sod2luZG93LmxvY2F0aW9uLmhyZWbogIzkuI3mmK9yb3V0ZXIucmVwbGFjZe+8jOW8uuWItuaVtOS4qumhtemdouWIt+aWsAogICAgICAgIC8vIOa3u+WKoOaXtumXtOaIs+WPguaVsO+8jOehruS/neS4jei1sOe8k+WtmAogICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9zbWFydGRvYz9fcmVmcmVzaD0nICsgbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcign5Yig6Zmk5paH5qGj5aSx6LSlJywgZXJyb3IpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcign5Yig6Zmk5paH5qGj5aSx6LSlJyk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgZGVsZXRlTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICB9CiAgICB9OwogICAgY29uc3QgZXhwb3J0RG9jdW1lbnQgPSAoKSA9PiB7CiAgICAgIEVsTWVzc2FnZUJveCh7CiAgICAgICAgdGl0bGU6ICflr7zlh7rmlofmoaMnLAogICAgICAgIG1lc3NhZ2U6ICfor7fpgInmi6nlr7zlh7rmoLzlvI8nLAogICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsCiAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6ICflr7zlh7rkuLpQREYnLAogICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6ICflr7zlh7rkuLpXb3JkJywKICAgICAgICBjbG9zZU9uQ2xpY2tNb2RhbDogdHJ1ZSwKICAgICAgICBjYWxsYmFjazogYWN0aW9uID0+IHsKICAgICAgICAgIGlmIChhY3Rpb24gPT09ICdjb25maXJtJykgewogICAgICAgICAgICBleHBvcnRUb1BkZigpOwogICAgICAgICAgfSBlbHNlIGlmIChhY3Rpb24gPT09ICdjYW5jZWwnKSB7CiAgICAgICAgICAgIGV4cG9ydFRvV29yZCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9OwoKICAgIC8vIOWvvOWHuuS4ulBERgogICAgY29uc3QgZXhwb3J0VG9QZGYgPSAoKSA9PiB7CiAgICAgIGlmICghY3VycmVudERvYy52YWx1ZSB8fCAhY3VycmVudERvYy52YWx1ZS5jb250ZW50KSB7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfmsqHmnInlj6/lr7zlh7rnmoTmlofmoaMnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgZG9jVGl0bGUgPSBjdXJyZW50RG9jLnZhbHVlLnRpdGxlIHx8ICfmnKrlkb3lkI3mlofmoaMnOwogICAgICBjb25zdCBmaWxlbmFtZSA9IGAke2RvY1RpdGxlfS5wZGZgOwogICAgICAvLyDnm7TmjqXlhYvpmoZxdWlsbOe8lui+keWZqOWGheWuuQogICAgICBjb25zdCBlZGl0b3JEb20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucWwtZWRpdG9yJyk7CiAgICAgIGlmICghZWRpdG9yRG9tKSB7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfmnKrmib7liLDnvJbovpHlmajlhoXlrrknKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgY29udGVudEVsZW1lbnQgPSBlZGl0b3JEb20uY2xvbmVOb2RlKHRydWUpOwogICAgICBjb25zdCBvcHRpb25zID0gewogICAgICAgIG1hcmdpbjogWzE1LCAxNSwgMTUsIDE1XSwKICAgICAgICBmaWxlbmFtZTogZmlsZW5hbWUsCiAgICAgICAgaW1hZ2U6IHsKICAgICAgICAgIHR5cGU6ICdqcGVnJywKICAgICAgICAgIHF1YWxpdHk6IDAuOTgKICAgICAgICB9LAogICAgICAgIGh0bWwyY2FudmFzOiB7CiAgICAgICAgICBzY2FsZTogMiwKICAgICAgICAgIHVzZUNPUlM6IHRydWUKICAgICAgICB9LAogICAgICAgIGpzUERGOiB7CiAgICAgICAgICB1bml0OiAnbW0nLAogICAgICAgICAgZm9ybWF0OiAnYTQnLAogICAgICAgICAgb3JpZW50YXRpb246ICdwb3J0cmFpdCcKICAgICAgICB9CiAgICAgIH07CiAgICAgIGNvbnN0IGxvYWRpbmcgPSBFbExvYWRpbmcuc2VydmljZSh7CiAgICAgICAgbG9jazogdHJ1ZSwKICAgICAgICB0ZXh0OiAn5q2j5Zyo55Sf5oiQUERGLi4uJywKICAgICAgICBiYWNrZ3JvdW5kOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjcpJwogICAgICB9KTsKICAgICAgaW1wb3J0KCdodG1sMnBkZi5qcycpLnRoZW4oaHRtbDJwZGZNb2R1bGUgPT4gewogICAgICAgIGNvbnN0IGh0bWwycGRmID0gaHRtbDJwZGZNb2R1bGUuZGVmYXVsdDsKICAgICAgICBodG1sMnBkZigpLmZyb20oY29udGVudEVsZW1lbnQpLnNldChvcHRpb25zKS5zYXZlKCkudGhlbigoKSA9PiB7CiAgICAgICAgICBsb2FkaW5nLmNsb3NlKCk7CiAgICAgICAgICBFbE1lc3NhZ2Uuc3VjY2VzcygnUERG5a+85Ye65oiQ5YqfJyk7CiAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgICAgY29uc29sZS5lcnJvcignUERG5a+85Ye65aSx6LSlOicsIGVycm9yKTsKICAgICAgICAgIGxvYWRpbmcuY2xvc2UoKTsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcignUERG5a+85Ye65aSx6LSlJyk7CiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGVycm9yID0+IHsKICAgICAgICBjb25zb2xlLmVycm9yKCfliqDovb1odG1sMnBkZi5qc+Wksei0pTonLCBlcnJvcik7CiAgICAgICAgbG9hZGluZy5jbG9zZSgpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcignUERG5a+85Ye65Yqf6IO95Yqg6L295aSx6LSlJyk7CiAgICAgIH0pOwogICAgfTsKCiAgICAvLyDlr7zlh7rkuLpXb3Jk77yI5L+d55WZ5Zu+54mH77yJCiAgICBjb25zdCBleHBvcnRUb1dvcmQgPSBhc3luYyAoKSA9PiB7CiAgICAgIGlmICghY3VycmVudERvYy52YWx1ZSB8fCAhY3VycmVudERvYy52YWx1ZS5jb250ZW50KSB7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfmsqHmnInlj6/lr7zlh7rnmoTmlofmoaMnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgZG9jVGl0bGUgPSBjdXJyZW50RG9jLnZhbHVlLnRpdGxlIHx8ICfmnKrlkb3lkI3mlofmoaMnOwogICAgICBjb25zdCBmaWxlbmFtZSA9IGAke2RvY1RpdGxlfS5kb2NgOwogICAgICBjb25zdCBsb2FkaW5nID0gRWxMb2FkaW5nLnNlcnZpY2UoewogICAgICAgIGxvY2s6IHRydWUsCiAgICAgICAgdGV4dDogJ+ato+WcqOeUn+aIkFdvcmTmlofmoaMuLi4nLAogICAgICAgIGJhY2tncm91bmQ6ICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNyknCiAgICAgIH0pOwogICAgICB0cnkgewogICAgICAgIC8vIOWIm+W7uuS4gOS4quS4tOaXtuaWh+aho+WuueWZqOWkhOeQhuWGheWuuQogICAgICAgIGNvbnN0IGNvbnRlbnRDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICBjb250ZW50Q29udGFpbmVyLmlubmVySFRNTCA9IGN1cnJlbnREb2MudmFsdWUuY29udGVudDsKICAgICAgICAvLyDkuI3lho3mm7/mjaLlm77niYfkuLrljaDkvY3nrKbvvIznm7TmjqXkv53nlZk8aW1nPuagh+etvgogICAgICAgIC8vIOWIm+W7uuW+rui9r1dvcmTlhbzlrrnnmoRIVE1M5paH5qGjCiAgICAgICAgY29uc3QgbXNXb3JkSHRtbCA9IGAKICAgICAgICAgIDxodG1sIHhtbG5zOm89InVybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206b2ZmaWNlOm9mZmljZSIgCiAgICAgICAgICAgICAgICB4bWxuczp3PSJ1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOm9mZmljZTp3b3JkIiAKICAgICAgICAgICAgICAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy9UUi9SRUMtaHRtbDQwIj4KICAgICAgICAgIDxoZWFkPgogICAgICAgICAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICAgICAgICAgIDx0aXRsZT4ke2RvY1RpdGxlfTwvdGl0bGU+CiAgICAgICAgICAgIDxzdHlsZT4KICAgICAgICAgICAgICBib2R5IHsgZm9udC1mYW1pbHk6IFNpbVN1biwgQXJpYWwsIHNhbnMtc2VyaWY7IG1hcmdpbjogMWNtOyB9CiAgICAgICAgICAgICAgaW1nIHsgbWF4LXdpZHRoOiAxMDAlOyBoZWlnaHQ6IGF1dG87IH0KICAgICAgICAgICAgICBwIHsgbWFyZ2luOiAwOyBwYWRkaW5nOiAwOyB9CiAgICAgICAgICAgICAgaDEgeyBmb250LXNpemU6IDE4cHQ7IH0KICAgICAgICAgICAgICBoMiB7IGZvbnQtc2l6ZTogMTZwdDsgfQogICAgICAgICAgICAgIGgzIHsgZm9udC1zaXplOiAxNHB0OyB9CiAgICAgICAgICAgICAgdGFibGUgeyBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOyB3aWR0aDogMTAwJTsgfQogICAgICAgICAgICAgIHRkLCB0aCB7IGJvcmRlcjogMXB4IHNvbGlkICMwMDA7IHBhZGRpbmc6IDVweDsgfQogICAgICAgICAgICA8L3N0eWxlPgogICAgICAgICAgPC9oZWFkPgogICAgICAgICAgPGJvZHk+CiAgICAgICAgICAgIDxoMT4ke2RvY1RpdGxlfTwvaDE+CiAgICAgICAgICAgICR7Y29udGVudENvbnRhaW5lci5pbm5lckhUTUx9CiAgICAgICAgICA8L2JvZHk+CiAgICAgICAgICA8L2h0bWw+CiAgICAgICAgYDsKICAgICAgICAvLyDkvb/nlKhmaWxlLXNhdmVy5L+d5a2Y5paH5Lu2CiAgICAgICAgY29uc3QgRmlsZVNhdmVyID0gYXdhaXQgaW1wb3J0KCdmaWxlLXNhdmVyJyk7CiAgICAgICAgY29uc3Qgc2F2ZUFzID0gRmlsZVNhdmVyLnNhdmVBcyB8fCBGaWxlU2F2ZXIuZGVmYXVsdDsKICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW21zV29yZEh0bWxdLCB7CiAgICAgICAgICB0eXBlOiAnYXBwbGljYXRpb24vbXN3b3JkJwogICAgICAgIH0pOwogICAgICAgIHNhdmVBcyhibG9iLCBmaWxlbmFtZSk7CiAgICAgICAgbG9hZGluZy5jbG9zZSgpOwogICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCdXb3Jk5paH5qGj5a+85Ye65oiQ5YqfJyk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignV29yZOWvvOWHuuWksei0pTonLCBlcnJvcik7CiAgICAgICAgbG9hZGluZy5jbG9zZSgpOwogICAgICAgIEVsTWVzc2FnZS5lcnJvcihgV29yZOWvvOWHuuWksei0pTogJHtlcnJvci5tZXNzYWdlIHx8ICfmnKrnn6XplJnor68nfWApOwogICAgICB9CiAgICB9OwogICAgY29uc3QgcHJpbnREb2N1bWVudCA9ICgpID0+IHsKICAgICAgRWxNZXNzYWdlLmluZm8oJ+aJk+WNsOaWh+aho+WKn+iDveaaguacquWunueOsCcpOwogICAgfTsKICAgIGNvbnN0IGFkZENvbGxhYm9yYXRvciA9ICgpID0+IHsKICAgICAgRWxNZXNzYWdlLmluZm8oJ+a3u+WKoOWNj+S9nOiAheWKn+iDveaaguacquWunueOsCcpOwogICAgfTsKICAgIGNvbnN0IHZpZXdIaXN0b3J5ID0gKCkgPT4gewogICAgICBFbE1lc3NhZ2UuaW5mbygn5p+l55yL5Y6G5Y+y54mI5pys5Yqf6IO95pqC5pyq5a6e546wJyk7CiAgICB9OwoKICAgIC8vIDEuIOWcqHNldHVw6YeM5Yqg57yT5a2Y5Y+Y6YePCiAgICBjb25zdCBxdWlsbFNlbGVjdGlvbiA9IHJlZihudWxsKTsKICAgIGNvbnN0IHF1aWxsU2VsZWN0ZWRUZXh0ID0gcmVmKCcnKTsKCiAgICAvLyAyLiDnm5HlkKxRdWlsbOeahHNlbGVjdGlvbi1jaGFuZ2Xkuovku7YKICAgIGNvbnN0IG9uU2VsZWN0aW9uQ2hhbmdlID0gKHJhbmdlLCBvbGRSYW5nZSwgc291cmNlKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCfnu4Tku7ZzZWxlY3Rpb24tY2hhbmdl5LqL5Lu2OicsIHJhbmdlLCAnc291cmNlOicsIHNvdXJjZSk7CiAgICAgIGlmICghcXVpbGxJbnN0YW5jZS52YWx1ZSkgcmV0dXJuOwoKICAgICAgLy8g6Ziy5q2i5Zyo56iL5bqP5YyW5pON5L2c5pe25riF6Zmk6YCJ5oup54q25oCBCiAgICAgIGlmIChzb3VyY2UgPT09ICdhcGknICYmICFyYW5nZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAocmFuZ2UgJiYgcmFuZ2UubGVuZ3RoID4gMCkgewogICAgICAgIGNvbnN0IHRleHQgPSBxdWlsbEluc3RhbmNlLnZhbHVlLmdldFRleHQocmFuZ2UuaW5kZXgsIHJhbmdlLmxlbmd0aCk7CiAgICAgICAgY29uc29sZS5sb2coJ+e7hOS7tumAieS4reaWh+acrDonLCB0ZXh0KTsKICAgICAgICBxdWlsbFNlbGVjdGVkVGV4dC52YWx1ZSA9IHRleHQudHJpbSgpOwogICAgICAgIHF1aWxsU2VsZWN0aW9uLnZhbHVlID0gewogICAgICAgICAgLi4ucmFuZ2UKICAgICAgICB9OyAvLyDmt7Hmi7fotJ3pgb/lhY3lvJXnlKjpl67popgKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zb2xlLmxvZygn57uE5Lu25riF6Zmk6YCJ5oupJyk7CiAgICAgICAgcXVpbGxTZWxlY3RlZFRleHQudmFsdWUgPSAnJzsKICAgICAgICBxdWlsbFNlbGVjdGlvbi52YWx1ZSA9IG51bGw7CiAgICAgIH0KICAgIH07CgogICAgLy8gMS4g5pyA5aSn6ZW/5bqm5bi46YePCiAgICBjb25zdCBNQVhfQUlfVEVYVF9MRU5HVEggPSAyMDAwOwoKICAgIC8vIOi+heWKqeWHveaVsO+8muiOt+WPluW9k+WJjeacieaViOeahOmAieaLqQogICAgY29uc3QgZ2V0Q3VycmVudFNlbGVjdGlvbiA9ICgpID0+IHsKICAgICAgaWYgKCFxdWlsbEluc3RhbmNlLnZhbHVlKSByZXR1cm4gbnVsbDsKICAgICAgbGV0IHNlbGVjdGlvbiA9IHF1aWxsSW5zdGFuY2UudmFsdWUuZ2V0U2VsZWN0aW9uKCk7CgogICAgICAvLyDlpoLmnpzlvZPliY3msqHmnInpgInmi6nmiJbpgInmi6nplb/luqbkuLow77yM5bCd6K+V5L2/55So57yT5a2Y55qE6YCJ5oupCiAgICAgIGlmICghc2VsZWN0aW9uIHx8IHNlbGVjdGlvbi5sZW5ndGggPT09IDApIHsKICAgICAgICBpZiAocXVpbGxTZWxlY3Rpb24udmFsdWUgJiYgcXVpbGxTZWxlY3Rpb24udmFsdWUubGVuZ3RoID4gMCkgewogICAgICAgICAgLy8g6aqM6K+B57yT5a2Y55qE6YCJ5oup5piv5ZCm5LuN54S25pyJ5pWICiAgICAgICAgICBjb25zdCB0ZXh0TGVuZ3RoID0gcXVpbGxJbnN0YW5jZS52YWx1ZS5nZXRMZW5ndGgoKTsKICAgICAgICAgIGlmIChxdWlsbFNlbGVjdGlvbi52YWx1ZS5pbmRleCArIHF1aWxsU2VsZWN0aW9uLnZhbHVlLmxlbmd0aCA8PSB0ZXh0TGVuZ3RoKSB7CiAgICAgICAgICAgIHNlbGVjdGlvbiA9IHF1aWxsU2VsZWN0aW9uLnZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gc2VsZWN0aW9uOwogICAgfTsKCiAgICAvLyDovoXliqnlh73mlbDvvJrlronlhajlnLDorr7nva7pgInmi6nnirbmgIEKICAgIGNvbnN0IHNhZmVTZXRTZWxlY3Rpb24gPSAoaW5kZXgsIGxlbmd0aCA9IDAsIHNvdXJjZSA9ICdhcGknKSA9PiB7CiAgICAgIGlmICghcXVpbGxJbnN0YW5jZS52YWx1ZSkgcmV0dXJuOwogICAgICB0cnkgewogICAgICAgIGNvbnN0IHRleHRMZW5ndGggPSBxdWlsbEluc3RhbmNlLnZhbHVlLmdldExlbmd0aCgpOwogICAgICAgIGNvbnN0IHNhZmVJbmRleCA9IE1hdGgubWF4KDAsIE1hdGgubWluKGluZGV4LCB0ZXh0TGVuZ3RoIC0gMSkpOwogICAgICAgIGNvbnN0IHNhZmVMZW5ndGggPSBNYXRoLm1heCgwLCBNYXRoLm1pbihsZW5ndGgsIHRleHRMZW5ndGggLSBzYWZlSW5kZXgpKTsKICAgICAgICBxdWlsbEluc3RhbmNlLnZhbHVlLnNldFNlbGVjdGlvbihzYWZlSW5kZXgsIHNhZmVMZW5ndGgsIHNvdXJjZSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS53YXJuKCforr7nva7pgInmi6nnirbmgIHlpLHotKU6JywgZXJyb3IpOwogICAgICB9CiAgICB9OwoKICAgIC8vIDIuIGV4cGFuZENvbnRlbnTmlrnms5XliqDmiKrmlq0KICAgIGNvbnN0IGV4cGFuZENvbnRlbnQgPSBhc3luYyAoKSA9PiB7CiAgICAgIGlmICghY3VycmVudERvYy52YWx1ZSB8fCBleHBhbmRMb2FkaW5nLnZhbHVlKSByZXR1cm47CiAgICAgIHRyeSB7CiAgICAgICAgZXhwYW5kTG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgICAgaWYgKCFxdWlsbEluc3RhbmNlLnZhbHVlKSB7CiAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+e8lui+keWZqOacquWwsee7qu+8jOivt+eojeWQjuWGjeivlScpOwogICAgICAgICAgZXhwYW5kTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g5L2/55So6L6F5Yqp5Ye95pWw6I635Y+W5b2T5YmN5pyJ5pWI6YCJ5oupCiAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gZ2V0Q3VycmVudFNlbGVjdGlvbigpOwogICAgICAgIGxldCBzZWxlY3RlZFRleHQgPSAnJzsKICAgICAgICBsZXQgcmFuZ2UgPSBudWxsOwogICAgICAgIGlmIChzZWxlY3Rpb24gJiYgc2VsZWN0aW9uLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHJhbmdlID0gewogICAgICAgICAgICAuLi5zZWxlY3Rpb24KICAgICAgICAgIH07CiAgICAgICAgICBzZWxlY3RlZFRleHQgPSBxdWlsbEluc3RhbmNlLnZhbHVlLmdldFRleHQoc2VsZWN0aW9uLmluZGV4LCBzZWxlY3Rpb24ubGVuZ3RoKS50cmltKCk7CiAgICAgICAgfQogICAgICAgIGlmICghc2VsZWN0ZWRUZXh0KSB7CiAgICAgICAgICBFbE1lc3NhZ2Uud2FybmluZygn6K+35YWI6YCJ5oup6KaB5omp5YaZ55qE5paH5pys5YaF5a65Jyk7CiAgICAgICAgICBleHBhbmRMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChzZWxlY3RlZFRleHQubGVuZ3RoID4gTUFYX0FJX1RFWFRfTEVOR1RIKSB7CiAgICAgICAgICBFbE1lc3NhZ2Uud2FybmluZyhg6YCJ5Lit5paH5pys6L+H6ZW/77yM5bey6Ieq5Yqo5oiq5pat5Li65YmNJHtNQVhfQUlfVEVYVF9MRU5HVEh95a2XYCk7CiAgICAgICAgICBzZWxlY3RlZFRleHQgPSBzZWxlY3RlZFRleHQuc2xpY2UoMCwgTUFYX0FJX1RFWFRfTEVOR1RIKTsKICAgICAgICB9CiAgICAgICAgRWxNZXNzYWdlLmluZm8oJ+ato+WcqOaJqeWGmeWGheWuue+8jOivt+eojeWAmS4uLicpOwogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXBpRXhwYW5kQ29udGVudChjdXJyZW50RG9jLnZhbHVlLmlkLCB7CiAgICAgICAgICBzZWxlY3Rpb246IHNlbGVjdGVkVGV4dCwKICAgICAgICAgIGxlbmd0aDogJ21lZGl1bScKICAgICAgICB9KTsKICAgICAgICBzaG93Q29tcGFyZURpYWxvZyh7CiAgICAgICAgICB0aXRsZTogJ+WGheWuueaJqeWGmee7k+aenCcsCiAgICAgICAgICBvcmlnaW5hbDogc2VsZWN0ZWRUZXh0LAogICAgICAgICAgbW9kaWZpZWQ6IHJlc3BvbnNlLmRhdGEuY29udGVudCwKICAgICAgICAgIG9uQXBwbHk6IGZpbmFsQ29udGVudCA9PiB7CiAgICAgICAgICAgIGlmIChyYW5nZSAmJiB0eXBlb2YgcmFuZ2UuaW5kZXggPT09ICdudW1iZXInICYmIHR5cGVvZiByYW5nZS5sZW5ndGggPT09ICdudW1iZXInICYmIHJhbmdlLmluZGV4ID49IDAgJiYgcmFuZ2UubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGNvbnN0IHF1aWxsTGVuID0gcXVpbGxJbnN0YW5jZS52YWx1ZS5nZXRMZW5ndGgoKTsKICAgICAgICAgICAgICBsZXQgaW5zZXJ0UG9zID0gcmFuZ2UuaW5kZXg7CiAgICAgICAgICAgICAgaWYgKGluc2VydFBvcyA+IHF1aWxsTGVuKSBpbnNlcnRQb3MgPSBxdWlsbExlbiAtIDE7CgogICAgICAgICAgICAgIC8vIOS9v+eUqCBBUEkg5rqQ5qCH6K6w77yM6YG/5YWN6Kem5Y+R5LiN5b+F6KaB55qE6YCJ5oup5Y+Y5YyW5LqL5Lu2CiAgICAgICAgICAgICAgcXVpbGxJbnN0YW5jZS52YWx1ZS5kZWxldGVUZXh0KGluc2VydFBvcywgcmFuZ2UubGVuZ3RoLCAnYXBpJyk7CiAgICAgICAgICAgICAgcXVpbGxJbnN0YW5jZS52YWx1ZS5pbnNlcnRUZXh0KGluc2VydFBvcywgZmluYWxDb250ZW50LCAnYXBpJyk7CgogICAgICAgICAgICAgIC8vIOiuvue9ruaWsOeahOmAieaLqeS9jee9rgogICAgICAgICAgICAgIGxldCBzZWxQb3MgPSBpbnNlcnRQb3MgKyBmaW5hbENvbnRlbnQubGVuZ3RoOwogICAgICAgICAgICAgIHNlbFBvcyA9IE1hdGgubWF4KDAsIE1hdGgubWluKHNlbFBvcywgcXVpbGxJbnN0YW5jZS52YWx1ZS5nZXRMZW5ndGgoKSkpOwoKICAgICAgICAgICAgICAvLyDlu7bov5/orr7nva7pgInmi6nvvIznoa7kv53mlofmnKzmj5LlhaXlrozmiJAKICAgICAgICAgICAgICBuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgICAgICBzYWZlU2V0U2VsZWN0aW9uKHNlbFBvcywgMCwgJ2FwaScpOwogICAgICAgICAgICAgICAgZG9jdW1lbnRDaGFuZ2VkLnZhbHVlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCflhoXlrrnmianlhpnlt7LlupTnlKgnKTsKICAgICAgICAgICAgICAgIC8vIOW8uuWItuWIt+aWsOmhtemdogogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign6YCJ5Yy65peg5pWI77yM5peg5rOV5o+S5YWl5YaF5a65Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdb5YaF5a655omp5YaZXSDlvILluLg6JywgZXJyb3IpOwogICAgICAgIGlmIChlcnJvciAmJiBlcnJvci5yZXNwb25zZSkgewogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCflhoXlrrnmianlhpnlpLHotKU6ICcgKyAoZXJyb3IucmVzcG9uc2UuZGF0YS5kZXRhaWwgfHwgZXJyb3IubWVzc2FnZSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+WGheWuueaJqeWGmeWksei0pe+8jOivt+eojeWQjuWGjeivlScpOwogICAgICAgIH0KICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBleHBhbmRMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgIH0KICAgIH07CgogICAgLy8gMy4gcG9saXNoVGV4dOWQjOeQhgogICAgY29uc3QgcG9saXNoVGV4dCA9IGFzeW5jICgpID0+IHsKICAgICAgaWYgKCFjdXJyZW50RG9jLnZhbHVlIHx8IHBvbGlzaExvYWRpbmcudmFsdWUpIHJldHVybjsKICAgICAgdHJ5IHsKICAgICAgICBwb2xpc2hMb2FkaW5nLnZhbHVlID0gdHJ1ZTsKICAgICAgICBpZiAoIXF1aWxsSW5zdGFuY2UudmFsdWUpIHsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign57yW6L6R5Zmo5pyq5bCx57uq77yM6K+356iN5ZCO5YaN6K+VJyk7CiAgICAgICAgICBwb2xpc2hMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyDkvb/nlKjovoXliqnlh73mlbDojrflj5blvZPliY3mnInmlYjpgInmi6kKICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBnZXRDdXJyZW50U2VsZWN0aW9uKCk7CiAgICAgICAgbGV0IHNlbGVjdGVkVGV4dCA9ICcnOwogICAgICAgIGxldCByYW5nZSA9IG51bGw7CiAgICAgICAgaWYgKHNlbGVjdGlvbiAmJiBzZWxlY3Rpb24ubGVuZ3RoID4gMCkgewogICAgICAgICAgcmFuZ2UgPSB7CiAgICAgICAgICAgIC4uLnNlbGVjdGlvbgogICAgICAgICAgfTsKICAgICAgICAgIHNlbGVjdGVkVGV4dCA9IHF1aWxsSW5zdGFuY2UudmFsdWUuZ2V0VGV4dChzZWxlY3Rpb24uaW5kZXgsIHNlbGVjdGlvbi5sZW5ndGgpLnRyaW0oKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFzZWxlY3RlZFRleHQpIHsKICAgICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfor7flhYjpgInmi6nopoHmtqboibLnmoTmlofmnKzlhoXlrrknKTsKICAgICAgICAgIHBvbGlzaExvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGVjdGVkVGV4dC5sZW5ndGggPiBNQVhfQUlfVEVYVF9MRU5HVEgpIHsKICAgICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKGDpgInkuK3mlofmnKzov4fplb/vvIzlt7Loh6rliqjmiKrmlq3kuLrliY0ke01BWF9BSV9URVhUX0xFTkdUSH3lrZdgKTsKICAgICAgICAgIHNlbGVjdGVkVGV4dCA9IHNlbGVjdGVkVGV4dC5zbGljZSgwLCBNQVhfQUlfVEVYVF9MRU5HVEgpOwogICAgICAgIH0KICAgICAgICBFbE1lc3NhZ2UuaW5mbygn5q2j5Zyo5ram6Imy5paH5pys77yM6K+356iN5YCZLi4uJyk7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhcGlQb2xpc2hUZXh0KGN1cnJlbnREb2MudmFsdWUuaWQsIHsKICAgICAgICAgIHNlbGVjdGlvbjogc2VsZWN0ZWRUZXh0LAogICAgICAgICAgc3R5bGU6ICdwcm9mZXNzaW9uYWwnCiAgICAgICAgfSk7CiAgICAgICAgc2hvd0NvbXBhcmVEaWFsb2coewogICAgICAgICAgdGl0bGU6ICfmlofmnKzmtqboibLnu5PmnpwnLAogICAgICAgICAgb3JpZ2luYWw6IHNlbGVjdGVkVGV4dCwKICAgICAgICAgIG1vZGlmaWVkOiByZXNwb25zZS5kYXRhLmNvbnRlbnQsCiAgICAgICAgICBvbkFwcGx5OiBmaW5hbENvbnRlbnQgPT4gewogICAgICAgICAgICBpZiAocmFuZ2UgJiYgdHlwZW9mIHJhbmdlLmluZGV4ID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgcmFuZ2UubGVuZ3RoID09PSAnbnVtYmVyJyAmJiByYW5nZS5pbmRleCA+PSAwICYmIHJhbmdlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBjb25zdCBxdWlsbExlbiA9IHF1aWxsSW5zdGFuY2UudmFsdWUuZ2V0TGVuZ3RoKCk7CiAgICAgICAgICAgICAgbGV0IGluc2VydFBvcyA9IHJhbmdlLmluZGV4OwogICAgICAgICAgICAgIGlmIChpbnNlcnRQb3MgPiBxdWlsbExlbikgaW5zZXJ0UG9zID0gcXVpbGxMZW4gLSAxOwoKICAgICAgICAgICAgICAvLyDkvb/nlKggQVBJIOa6kOagh+iusO+8jOmBv+WFjeinpuWPkeS4jeW/heimgeeahOmAieaLqeWPmOWMluS6i+S7tgogICAgICAgICAgICAgIHF1aWxsSW5zdGFuY2UudmFsdWUuZGVsZXRlVGV4dChpbnNlcnRQb3MsIHJhbmdlLmxlbmd0aCwgJ2FwaScpOwogICAgICAgICAgICAgIHF1aWxsSW5zdGFuY2UudmFsdWUuaW5zZXJ0VGV4dChpbnNlcnRQb3MsIGZpbmFsQ29udGVudCwgJ2FwaScpOwoKICAgICAgICAgICAgICAvLyDorr7nva7mlrDnmoTpgInmi6nkvY3nva4KICAgICAgICAgICAgICBsZXQgc2VsUG9zID0gaW5zZXJ0UG9zICsgZmluYWxDb250ZW50Lmxlbmd0aDsKICAgICAgICAgICAgICBzZWxQb3MgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihzZWxQb3MsIHF1aWxsSW5zdGFuY2UudmFsdWUuZ2V0TGVuZ3RoKCkpKTsKCiAgICAgICAgICAgICAgLy8g5bu26L+f6K6+572u6YCJ5oup77yM56Gu5L+d5paH5pys5o+S5YWl5a6M5oiQCiAgICAgICAgICAgICAgbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgICAgICAgc2FmZVNldFNlbGVjdGlvbihzZWxQb3MsIDAsICdhcGknKTsKICAgICAgICAgICAgICAgIGRvY3VtZW50Q2hhbmdlZC52YWx1ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBFbE1lc3NhZ2Uuc3VjY2Vzcygn5paH5pys5ram6Imy5bey5bqU55SoJyk7CiAgICAgICAgICAgICAgICAvLyDlvLrliLbliLfmlrDpobXpnaIKICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+mAieWMuuaXoOaViO+8jOaXoOazleaPkuWFpeWGheWuuScpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignW+aWh+acrOa2puiJsl0g5byC5bi4OicsIGVycm9yKTsKICAgICAgICBpZiAoZXJyb3IgJiYgZXJyb3IucmVzcG9uc2UpIHsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign5paH5pys5ram6Imy5aSx6LSlOiAnICsgKGVycm9yLnJlc3BvbnNlLmRhdGEuZGV0YWlsIHx8IGVycm9yLm1lc3NhZ2UpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfmlofmnKzmtqboibLlpLHotKXvvIzor7fnqI3lkI7lho3or5UnKTsKICAgICAgICB9CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgcG9saXNoTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICB9CiAgICB9OwoKICAgIC8vIOa3u+WKoOavlOi+g+W8ueeql+eahOeKtuaAgeWPmOmHj+WSjOaWueazlQogICAgY29uc3QgY29tcGFyZURpYWxvZ1Zpc2libGUgPSByZWYoZmFsc2UpOwogICAgY29uc3QgY29tcGFyZURpYWxvZ0RhdGEgPSByZWYoewogICAgICB0aXRsZTogJycsCiAgICAgIG9yaWdpbmFsOiAnJywKICAgICAgbW9kaWZpZWQ6ICcnLAogICAgICBtb2RpZmllZENvbnRlbnQ6ICcnLAogICAgICBvbkFwcGx5OiAoKSA9PiB7fQogICAgfSk7CgogICAgLy8g5pi+56S65q+U6L6D5by556qXCiAgICBjb25zdCBzaG93Q29tcGFyZURpYWxvZyA9IGRhdGEgPT4gewogICAgICBjb21wYXJlRGlhbG9nRGF0YS52YWx1ZSA9IHsKICAgICAgICAuLi5kYXRhLAogICAgICAgIG1vZGlmaWVkQ29udGVudDogZGF0YS5tb2RpZmllZAogICAgICB9OwogICAgICBjb21wYXJlRGlhbG9nVmlzaWJsZS52YWx1ZSA9IHRydWU7CiAgICB9OwoKICAgIC8vIOW6lOeUqOavlOi+g+W8ueeql+eahOabtOaUuQogICAgY29uc3QgYXBwbHlDb21wYXJlQ2hhbmdlcyA9ICgpID0+IHsKICAgICAgY29tcGFyZURpYWxvZ0RhdGEudmFsdWUub25BcHBseShjb21wYXJlRGlhbG9nRGF0YS52YWx1ZS5tb2RpZmllZENvbnRlbnQpOwogICAgICBjb21wYXJlRGlhbG9nVmlzaWJsZS52YWx1ZSA9IGZhbHNlOwogICAgfTsKCiAgICAvLyDlhbPpl63mr5TovoPlvLnnqpcKICAgIGNvbnN0IGNsb3NlQ29tcGFyZURpYWxvZyA9ICgpID0+IHsKICAgICAgY29tcGFyZURpYWxvZ1Zpc2libGUudmFsdWUgPSBmYWxzZTsKICAgIH07CgogICAgLy8g6Ziy5oqW5pCc57SiCiAgICBjb25zdCBkZWJvdW5jZWRTZWFyY2ggPSBfLmRlYm91bmNlKCgpID0+IHsKICAgICAgLy8g5pCc57Si6YC76L6R5bey6YCa6L+H6K6h566X5bGe5oCn5aSE55CGCiAgICB9LCAzMDApOwogICAgY29uc3QgZm9ybWF0RGF0ZSA9IGRhdGVTdHJpbmcgPT4gewogICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoZGF0ZVN0cmluZyk7CiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7CgogICAgICAvLyDlkIzkuIDlpKnmmL7npLrml7bpl7QKICAgICAgaWYgKGRhdGUudG9EYXRlU3RyaW5nKCkgPT09IG5vdy50b0RhdGVTdHJpbmcoKSkgewogICAgICAgIHJldHVybiBkYXRlLnRvTG9jYWxlVGltZVN0cmluZygnemgtQ04nLCB7CiAgICAgICAgICBob3VyOiAnMi1kaWdpdCcsCiAgICAgICAgICBtaW51dGU6ICcyLWRpZ2l0JwogICAgICAgIH0pOwogICAgICB9CgogICAgICAvLyDmmKjlpKkKICAgICAgY29uc3QgeWVzdGVyZGF5ID0gbmV3IERhdGUobm93KTsKICAgICAgeWVzdGVyZGF5LnNldERhdGUobm93LmdldERhdGUoKSAtIDEpOwogICAgICBpZiAoZGF0ZS50b0RhdGVTdHJpbmcoKSA9PT0geWVzdGVyZGF5LnRvRGF0ZVN0cmluZygpKSB7CiAgICAgICAgcmV0dXJuICfmmKjlpKknOwogICAgICB9CgogICAgICAvLyDkuIDlkajlhoXmmL7npLrmmJ/mnJ8KICAgICAgY29uc3Qgd2Vla0RheXMgPSBbJ+WRqOaXpScsICflkajkuIAnLCAn5ZGo5LqMJywgJ+WRqOS4iScsICflkajlm5snLCAn5ZGo5LqUJywgJ+WRqOWFrSddOwogICAgICBjb25zdCBkaWZmRGF5cyA9IE1hdGgucm91bmQoKG5vdyAtIGRhdGUpIC8gKDEwMDAgKiA2MCAqIDYwICogMjQpKTsKICAgICAgaWYgKGRpZmZEYXlzIDwgNykgewogICAgICAgIHJldHVybiB3ZWVrRGF5c1tkYXRlLmdldERheSgpXTsKICAgICAgfQoKICAgICAgLy8g5YW25LuW5oOF5Ya15pi+56S65pel5pyfCiAgICAgIHJldHVybiBkYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygnemgtQ04nLCB7CiAgICAgICAgbW9udGg6ICdudW1lcmljJywKICAgICAgICBkYXk6ICdudW1lcmljJwogICAgICB9KTsKICAgIH07CgogICAgLy8g55uR5ZCs6Lev55Sx5Y+Y5YyWCiAgICB3YXRjaCgoKSA9PiByb3V0ZS5wYXJhbXMuaWQsIChuZXdJZCwgb2xkSWQpID0+IHsKICAgICAgY29uc29sZS5sb2coYOi3r+eUseWPguaVsElE5Y+Y5YyWOiAke29sZElkfSAtPiAke25ld0lkfWApOwogICAgICBpZiAobmV3SWQpIHsKICAgICAgICAvLyDmo4Dmn6VJROaYr+WQpuS4uuacieaViOato+aVtOaVsAogICAgICAgIGNvbnN0IGlkTnVtID0gTnVtYmVyKG5ld0lkKTsKICAgICAgICBpZiAoaXNOYU4oaWROdW0pIHx8IGlkTnVtIDw9IDAgfHwgIU51bWJlci5pc0ludGVnZXIoaWROdW0pKSB7CiAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+aXoOaViOeahOaWh+aho0lEJyk7CiAgICAgICAgICByb3V0ZXIucHVzaCgnL3NtYXJ0ZG9jJyk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyDlpoLmnpxJROWPkeeUn+S6huWPmOWMlu+8jOmHjeaWsOiOt+WPluaWh+ahowogICAgICAgIGlmIChuZXdJZCAhPT0gb2xkSWQpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGDmlofmoaNJROWPmOWMlu+8jOiOt+WPluaWh+aho+ivpuaDhTogJHtuZXdJZH1gKTsKICAgICAgICAgIC8vIOajgOafpeaYr+WQpuW3suaciee8k+WtmAogICAgICAgICAgaWYgKGRvY3VtZW50Q2FjaGUudmFsdWUuaGFzKG5ld0lkKSkgewogICAgICAgICAgICBjb25zb2xlLmxvZyhg5L2/55So57yT5a2Y55qE5paH5qGj5pWw5o2uOiAke25ld0lkfWApOwogICAgICAgICAgICBjdXJyZW50RG9jLnZhbHVlID0gZG9jdW1lbnRDYWNoZS52YWx1ZS5nZXQobmV3SWQpOwogICAgICAgICAgICBvcmlnaW5hbERvYy52YWx1ZSA9IHsKICAgICAgICAgICAgICB0aXRsZTogY3VycmVudERvYy52YWx1ZS50aXRsZSB8fCAnJywKICAgICAgICAgICAgICB0eXBlOiBjdXJyZW50RG9jLnZhbHVlLnR5cGUgfHwgJ+mAmueUqCcsCiAgICAgICAgICAgICAgY29udGVudDogY3VycmVudERvYy52YWx1ZS5jb250ZW50IHx8ICcnCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGRvY3VtZW50Q2hhbmdlZC52YWx1ZSA9IGZhbHNlOwoKICAgICAgICAgICAgLy8g5Zyo5ZCO5Y+w5byC5q2l5Yi35paw5pWw5o2uCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgIGZldGNoRG9jdW1lbnREZXRhaWwobmV3SWQpOwogICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8g5rKh5pyJ57yT5a2Y77yM55u05o6l6I635Y+WCiAgICAgICAgICAgIGZldGNoRG9jdW1lbnREZXRhaWwobmV3SWQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjdXJyZW50RG9jLnZhbHVlID0gbnVsbDsKICAgICAgfQogICAgfSwgewogICAgICBpbW1lZGlhdGU6IGZhbHNlCiAgICB9KTsgLy8g6K6+5Li6ZmFsc2Xpgb/lhY3ph43lpI3liqDovb0KCiAgICAvLyDnm5HlkKxxdWVyeeWPguaVsOWPmOWMlu+8jOWkhOeQhuW8uuWItuWIt+aWsAogICAgd2F0Y2goKCkgPT4gcm91dGUucXVlcnkuX3JlZnJlc2gsIG5ld1ZhbCA9PiB7CiAgICAgIGlmIChuZXdWYWwpIHsKICAgICAgICBjb25zb2xlLmxvZygn5qOA5rWL5Yiw5by65Yi25Yi35paw5Y+C5pWwOicsIG5ld1ZhbCk7CiAgICAgICAgY29uc3QgZG9jSWQgPSByb3V0ZS5wYXJhbXMuaWQ7CiAgICAgICAgaWYgKGRvY0lkKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygn5by65Yi25Yi35paw5paH5qGj6K+m5oOFOicsIGRvY0lkKTsKICAgICAgICAgIGZldGNoRG9jdW1lbnREZXRhaWwoZG9jSWQpOwogICAgICAgIH0KICAgICAgICAvLyDlkIzml7bliLfmlrDmlofmoaPliJfooagKICAgICAgICBmZXRjaERvY3VtZW50cygpOwogICAgICB9CiAgICB9KTsKCiAgICAvLyDoh6rliqjkv53lrZjlip/og70KICAgIHNldEludGVydmFsKCgpID0+IHsKICAgICAgaWYgKGRvY3VtZW50Q2hhbmdlZC52YWx1ZSAmJiBjdXJyZW50RG9jLnZhbHVlICYmICFzYXZlTG9hZGluZy52YWx1ZSkgewogICAgICAgIHNhdmVEb2N1bWVudCgpOwogICAgICB9CiAgICB9LCA2MDAwMCk7IC8vIOavj+WIhumSn+iHquWKqOS/neWtmOS4gOasoQoKICAgIC8vIOeUn+WRveWRqOacn+mSqeWtkAogICAgb25Nb3VudGVkKCgpID0+IHsKICAgICAgY29uc29sZS5sb2coJ+e7hOS7tuaMgui9ve+8jOW8gOWni+WKoOi9veaVsOaNricpOwoKICAgICAgLy8g6I635Y+W5b2T5YmN5paH5qGjSUQKICAgICAgY29uc3QgZG9jSWQgPSByb3V0ZS5wYXJhbXMuaWQ7CgogICAgICAvLyDlpoLmnpzmnInmlofmoaNJRO+8jOS8mOWFiOWKoOi9veaWh+aho+ivpuaDhQogICAgICBpZiAoZG9jSWQpIHsKICAgICAgICBjb25zb2xlLmxvZygn5pyJ5paH5qGjSUTvvIzkvJjlhYjliqDovb3mlofmoaPor6bmg4U6JywgZG9jSWQpOwogICAgICAgIGZldGNoRG9jdW1lbnREZXRhaWwoZG9jSWQpLnRoZW4oKCkgPT4gewogICAgICAgICAgLy8g5paH5qGj6K+m5oOF5Yqg6L295a6M5oiQ5ZCO77yM5byC5q2l5Yqg6L295paH5qGj5YiX6KGoCiAgICAgICAgICBjb25zb2xlLmxvZygn5paH5qGj6K+m5oOF5Yqg6L295a6M5oiQ77yM5byA5aeL5Yqg6L295paH5qGj5YiX6KGoJyk7CiAgICAgICAgICBmZXRjaERvY3VtZW50cygpLnRoZW4oKCkgPT4gewogICAgICAgICAgICAvLyDmlofmoaPliJfooajliqDovb3lrozmiJDlkI7vvIzmu5rliqjliLDlvZPliY3mlofmoaMKICAgICAgICAgICAgY29uc29sZS5sb2coJ+aWh+aho+WIl+ihqOWKoOi9veWujOaIkCcpOwogICAgICAgICAgICBuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgICAgc2Nyb2xsVG9BY3RpdmVEb2N1bWVudCgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIOayoeacieaWh+aho0lE77yM5Y+q5Yqg6L295paH5qGj5YiX6KGoCiAgICAgICAgY29uc29sZS5sb2coJ+ayoeacieaWh+aho0lE77yM5Y+q5Yqg6L295paH5qGj5YiX6KGoJyk7CiAgICAgICAgZmV0Y2hEb2N1bWVudHMoKTsKICAgICAgfQogICAgfSk7CgogICAgLy8g5rua5Yqo5Yiw5b2T5YmN6YCJ5Lit55qE5paH5qGjCiAgICBjb25zdCBzY3JvbGxUb0FjdGl2ZURvY3VtZW50ID0gKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGlmICghY3VycmVudERvYy52YWx1ZSkgcmV0dXJuOwoKICAgICAgICAvLyDmn6Xmib7lvZPliY3mv4DmtLvnmoTmlofmoaPlhYPntKAKICAgICAgICBjb25zdCBhY3RpdmVEb2MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZG9jLWl0ZW0uYWN0aXZlJyk7CiAgICAgICAgaWYgKGFjdGl2ZURvYykgewogICAgICAgICAgLy8g5L2/55Soc2Nyb2xsSW50b1ZpZXfmu5rliqjliLDor6XlhYPntKAKICAgICAgICAgIGFjdGl2ZURvYy5zY3JvbGxJbnRvVmlldyh7CiAgICAgICAgICAgIGJlaGF2aW9yOiAnc21vb3RoJywKICAgICAgICAgICAgYmxvY2s6ICduZWFyZXN0JwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ+a7muWKqOWIsOa0u+WKqOaWh+aho+Wksei0pTonLCBlcnJvcik7CiAgICAgIH0KICAgIH07CgogICAgLy8g5Y+q5pyJ5YaF5a655a6e6ZmF5Y+Y5YyW5omN5qCH6K6w5Li65bey5L+u5pS5CiAgICBjb25zdCBvblRpdGxlQ2hhbmdlID0gdmFsID0+IHsKICAgICAgZG9jdW1lbnRDaGFuZ2VkLnZhbHVlID0gdmFsICE9PSBvcmlnaW5hbERvYy52YWx1ZS50aXRsZTsKICAgIH07CiAgICBjb25zdCBvblR5cGVDaGFuZ2UgPSB2YWwgPT4gewogICAgICBkb2N1bWVudENoYW5nZWQudmFsdWUgPSB2YWwgIT09IG9yaWdpbmFsRG9jLnZhbHVlLnR5cGU7CiAgICB9OwogICAgY29uc3Qgb25Db250ZW50Q2hhbmdlID0gKCkgPT4gewogICAgICAvLyDkv67lpI3vvJrmraPnoa7mr5TovoPnvJbovpHlmajlhoXlrrkKICAgICAgaWYgKGN1cnJlbnREb2MudmFsdWUgJiYgb3JpZ2luYWxEb2MudmFsdWUpIHsKICAgICAgICAvLyDmr5TovoPlvZPliY3lhoXlrrnkuI7ljp/lp4vlhoXlrrnmmK/lkKbnnJ/nmoTkuI3lkIwKICAgICAgICBjb25zdCBjdXJyZW50Q29udGVudCA9IGN1cnJlbnREb2MudmFsdWUuY29udGVudDsKICAgICAgICBjb25zdCBvcmlnaW5hbENvbnRlbnQgPSBvcmlnaW5hbERvYy52YWx1ZS5jb250ZW50OwogICAgICAgIGRvY3VtZW50Q2hhbmdlZC52YWx1ZSA9IGN1cnJlbnRDb250ZW50ICE9PSBvcmlnaW5hbENvbnRlbnQ7CiAgICAgIH0KICAgICAgc2Nyb2xsUXVpbGxUb0JvdHRvbSgpOwogICAgfTsKCiAgICAvLyDnvJbovpHlmajlrp7kvosKICAgIGNvbnN0IHF1aWxsSW5zdGFuY2UgPSByZWYobnVsbCk7CgogICAgLy8gMi4g57yW6L6R5ZmocmVhZHnml7botYvlgLwKICAgIGNvbnN0IG9uRWRpdG9yUmVhZHkgPSBxdWlsbCA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCfnvJbovpHlmajlsLHnu6onKTsKICAgICAgcXVpbGxJbnN0YW5jZS52YWx1ZSA9IHF1aWxsOwogICAgICBxdWlsbC5vbignc2VsZWN0aW9uLWNoYW5nZScsIG9uU2VsZWN0aW9uQ2hhbmdlKTsKCiAgICAgIC8vIOW7tui/n+aJp+ihjO+8jOehruS/neW3peWFt+agj0RPTeW3suWujOWFqOa4suafkwogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAvLyDkuLrlt6XlhbfmoI/mjInpkq7mt7vliqDmj5DnpLoKICAgICAgICBjb25zdCB0b29sYmFyVG9vbHRpcHMgPSB7CiAgICAgICAgICAnLnFsLWJvbGQnOiAn5Yqg57KXIChDdHJsK0IpJywKICAgICAgICAgICcucWwtaXRhbGljJzogJ+aWnOS9kyAoQ3RybCtJKScsCiAgICAgICAgICAnLnFsLXVuZGVybGluZSc6ICfkuIvliJLnur8gKEN0cmwrVSknLAogICAgICAgICAgJy5xbC1zdHJpa2UnOiAn5Yig6Zmk57q/JywKICAgICAgICAgICcucWwtYmxvY2txdW90ZSc6ICflnZfnuqflvJXnlKgnLAogICAgICAgICAgJy5xbC1jb2RlLWJsb2NrJzogJ+S7o+eggeWdlycsCiAgICAgICAgICAnLnFsLWhlYWRlclt2YWx1ZT0iMSJdJzogJ+agh+mimDEnLAogICAgICAgICAgJy5xbC1oZWFkZXJbdmFsdWU9IjIiXSc6ICfmoIfpopgyJywKICAgICAgICAgICcucWwtbGlzdFt2YWx1ZT0ib3JkZXJlZCJdJzogJ+acieW6j+WIl+ihqCcsCiAgICAgICAgICAnLnFsLWxpc3RbdmFsdWU9ImJ1bGxldCJdJzogJ+aXoOW6j+WIl+ihqCcsCiAgICAgICAgICAnLnFsLXNjcmlwdFt2YWx1ZT0ic3ViIl0nOiAn5LiL5qCHJywKICAgICAgICAgICcucWwtc2NyaXB0W3ZhbHVlPSJzdXBlciJdJzogJ+S4iuaghycsCiAgICAgICAgICAnLnFsLWluZGVudFt2YWx1ZT0iLTEiXSc6ICflh4/lsJHnvKnov5snLAogICAgICAgICAgJy5xbC1pbmRlbnRbdmFsdWU9IisxIl0nOiAn5aKe5Yqg57yp6L+bJywKICAgICAgICAgICcucWwtZGlyZWN0aW9uJzogJ+aWh+acrOaWueWQkScsCiAgICAgICAgICAnLnFsLWNsZWFuJzogJ+a4hemZpOagvOW8jycsCiAgICAgICAgICAnLnFsLWxpbmsnOiAn6LaF6ZO+5o6lJywKICAgICAgICAgICcucWwtaW1hZ2UnOiAn5Zu+54mHJywKICAgICAgICAgIC8vIFBpY2tlcnMgKGxlc3Mgc3BlY2lmaWMgc2VsZWN0b3JzKQogICAgICAgICAgJy5xbC1zaXplJzogJ+Wtl+WPtycsCiAgICAgICAgICAnLnFsLWhlYWRlcic6ICfmrrXokL3moLzlvI8nLAogICAgICAgICAgJy5xbC1jb2xvcic6ICflrZfkvZPpopzoibInLAogICAgICAgICAgJy5xbC1iYWNrZ3JvdW5kJzogJ+iDjOaZr+minOiJsicsCiAgICAgICAgICAnLnFsLWZvbnQnOiAn5a2X5L2TJywKICAgICAgICAgICcucWwtYWxpZ24nOiAn5a+56b2Q5pa55byPJwogICAgICAgIH07CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IHRvb2xiYXIgPSBxdWlsbC5nZXRNb2R1bGUoJ3Rvb2xiYXInKS5jb250YWluZXI7CiAgICAgICAgICBpZiAoIXRvb2xiYXIpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigi5pyq6IO96I635Y+W57yW6L6R5Zmo5bel5YW35qCP5a655Zmo44CCIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoY29uc3Qgc2VsZWN0b3IgaW4gdG9vbGJhclRvb2x0aXBzKSB7CiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRzID0gdG9vbGJhci5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTsKICAgICAgICAgICAgZWxlbWVudHMuZm9yRWFjaChlbCA9PiB7CiAgICAgICAgICAgICAgLy8g6YG/5YWN6KaG55uW5pu05YW35L2T6YCJ5oup5Zmo55qE5o+Q56S6CiAgICAgICAgICAgICAgaWYgKCFlbC5oYXNBdHRyaWJ1dGUoJ3RpdGxlJykpIHsKICAgICAgICAgICAgICAgIGVsLnRpdGxlID0gdG9vbGJhclRvb2x0aXBzW3NlbGVjdG9yXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCLkuLrnvJbovpHlmajlt6XlhbfmoI/mt7vliqDmj5DnpLrml7blh7rplJk6IiwgZXJyb3IpOwogICAgICAgIH0KICAgICAgfSwgMjAwKTsgLy8g5bu26L+fMjAw5q+r56eSCiAgICB9OwoKICAgIC8vIOaZuuiDvea7muWKqOWHveaVsCAtIOmBv+WFjeW5suaJsOaWh+acrOmAieaLqQogICAgZnVuY3Rpb24gc2Nyb2xsUXVpbGxUb0JvdHRvbSgpIHsKICAgICAgaWYgKHF1aWxsSW5zdGFuY2UudmFsdWUpIHsKICAgICAgICAvLyDkv53lrZjlvZPliY3pgInmi6nnirbmgIEKICAgICAgICBjb25zdCBjdXJyZW50U2VsZWN0aW9uID0gcXVpbGxJbnN0YW5jZS52YWx1ZS5nZXRTZWxlY3Rpb24oKTsKICAgICAgICBjb25zdCBjb250YWluZXIgPSBxdWlsbEluc3RhbmNlLnZhbHVlLnJvb3Q7CiAgICAgICAgY29udGFpbmVyLnNjcm9sbFRvcCA9IGNvbnRhaW5lci5zY3JvbGxIZWlnaHQ7CgogICAgICAgIC8vIOaBouWkjemAieaLqeeKtuaAge+8iOWmguaenOWtmOWcqO+8iQogICAgICAgIGlmIChjdXJyZW50U2VsZWN0aW9uICYmIGN1cnJlbnRTZWxlY3Rpb24ubGVuZ3RoID4gMCkgewogICAgICAgICAgLy8g5L2/55SoIG5leHRUaWNrIOehruS/nea7muWKqOWujOaIkOWQjuWGjeaBouWkjemAieaLqQogICAgICAgICAgbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHF1aWxsSW5zdGFuY2UudmFsdWUuc2V0U2VsZWN0aW9uKGN1cnJlbnRTZWxlY3Rpb24uaW5kZXgsIGN1cnJlbnRTZWxlY3Rpb24ubGVuZ3RoKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ+aBouWkjemAieaLqeeKtuaAgeWksei0pTonLCBlcnJvcik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY29uc3QgZ3JhbW1hckNoZWNrVGV4dCA9IGFzeW5jICgpID0+IHsKICAgICAgaWYgKCFjdXJyZW50RG9jLnZhbHVlIHx8IGdyYW1tYXJDaGVja0xvYWRpbmcudmFsdWUpIHJldHVybjsKICAgICAgdHJ5IHsKICAgICAgICBncmFtbWFyQ2hlY2tMb2FkaW5nLnZhbHVlID0gdHJ1ZTsKICAgICAgICBpZiAoIXF1aWxsSW5zdGFuY2UudmFsdWUpIHsKICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign57yW6L6R5Zmo5pyq5bCx57uq77yM6K+356iN5ZCO5YaN6K+VJyk7CiAgICAgICAgICBncmFtbWFyQ2hlY2tMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyDkvb/nlKjovoXliqnlh73mlbDojrflj5blvZPliY3mnInmlYjpgInmi6kKICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBnZXRDdXJyZW50U2VsZWN0aW9uKCk7CiAgICAgICAgbGV0IHNlbGVjdGVkVGV4dCA9ICcnOwogICAgICAgIGxldCByYW5nZSA9IG51bGw7CiAgICAgICAgaWYgKHNlbGVjdGlvbiAmJiBzZWxlY3Rpb24ubGVuZ3RoID4gMCkgewogICAgICAgICAgcmFuZ2UgPSB7CiAgICAgICAgICAgIC4uLnNlbGVjdGlvbgogICAgICAgICAgfTsKICAgICAgICAgIHNlbGVjdGVkVGV4dCA9IHF1aWxsSW5zdGFuY2UudmFsdWUuZ2V0VGV4dChzZWxlY3Rpb24uaW5kZXgsIHNlbGVjdGlvbi5sZW5ndGgpLnRyaW0oKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFzZWxlY3RlZFRleHQpIHsKICAgICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKCfor7flhYjpgInmi6nopoHnuqDplJnnmoTmlofmnKzlhoXlrrknKTsKICAgICAgICAgIGdyYW1tYXJDaGVja0xvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHNlbGVjdGVkVGV4dC5sZW5ndGggPiBNQVhfQUlfVEVYVF9MRU5HVEgpIHsKICAgICAgICAgIEVsTWVzc2FnZS53YXJuaW5nKGDpgInkuK3mlofmnKzov4fplb/vvIzlt7Loh6rliqjmiKrmlq3kuLrliY0ke01BWF9BSV9URVhUX0xFTkdUSH3lrZdgKTsKICAgICAgICAgIHNlbGVjdGVkVGV4dCA9IHNlbGVjdGVkVGV4dC5zbGljZSgwLCBNQVhfQUlfVEVYVF9MRU5HVEgpOwogICAgICAgIH0KICAgICAgICBFbE1lc3NhZ2UuaW5mbygn5q2j5Zyo5pm66IO957qg6ZSZ77yM6K+356iN5YCZLi4uJyk7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBncmFtbWFyQ2hlY2soY3VycmVudERvYy52YWx1ZS5pZCwgewogICAgICAgICAgc2VsZWN0aW9uOiBzZWxlY3RlZFRleHQKICAgICAgICB9KTsKICAgICAgICAvLyDlj6rkv53nlZnlu7rorq7pg6jliIbvvIzljrvpmaQi5LyY5YyW5ZCO55qE5paH5pysIuWtl+agt++8jOW5tuWwhm1k6L2s5Li6aHRtbAogICAgICAgIGxldCBzdWdnZXN0aW9ucyA9IHJlc3BvbnNlLnN1Z2dlc3Rpb25zIHx8ICcnOwogICAgICAgIHN1Z2dlc3Rpb25zID0gc3VnZ2VzdGlvbnMucmVwbGFjZSgvXCpcKuS8mOWMluWQjueahOaWh+acrFwqXCpbOu+8ml0/KFtcc1xTXSopJC8sICcnKS50cmltKCk7CiAgICAgICAgY29uc3Qgc3VnZ2VzdGlvbnNIdG1sID0gbWFya2VkLnBhcnNlKHN1Z2dlc3Rpb25zKTsKCiAgICAgICAgLy8g5LuO5L+u5q2j5paH5pys5Lit5Y+q5o+Q5Y+W5LyY5YyW5ZCO55qE5paH5pysCiAgICAgICAgbGV0IGNvcnJlY3RlZFRleHQgPSByZXNwb25zZS5jb3JyZWN0ZWQgfHwgJyc7CiAgICAgICAgY29uc3Qgb3B0aW1pemVkVGV4dE1hdGNoID0gY29ycmVjdGVkVGV4dC5tYXRjaCgv5LyY5YyW5ZCO55qE5paH5pysWzrvvJpdKFtcc1xTXSopLyk7CiAgICAgICAgY29uc3QgZmluYWxDb3JyZWN0ZWRUZXh0ID0gb3B0aW1pemVkVGV4dE1hdGNoID8gb3B0aW1pemVkVGV4dE1hdGNoWzFdLnRyaW0oKSA6IGNvcnJlY3RlZFRleHQ7CiAgICAgICAgc2hvd0NvbXBhcmVEaWFsb2coewogICAgICAgICAgdGl0bGU6ICfmmbrog73nuqDplJnlu7rorq4nLAogICAgICAgICAgb3JpZ2luYWw6IHNlbGVjdGVkVGV4dCwKICAgICAgICAgIG1vZGlmaWVkOiBmaW5hbENvcnJlY3RlZFRleHQsCiAgICAgICAgICAvLyDlj7PkvqfnvJbovpHlmajnm7TmjqXloavkvJjljJblkI7mlofmnKwKICAgICAgICAgIHN1Z2dlc3Rpb25zOiBzdWdnZXN0aW9uc0h0bWwsCiAgICAgICAgICAvLyBBSeW7uuiuruWMuuWPquaYvuekuuW7uuiuru+8jOS4lOS4umh0bWwKICAgICAgICAgIG9uQXBwbHk6IGZpbmFsQ29udGVudCA9PiB7CiAgICAgICAgICAgIGlmIChyYW5nZSAmJiB0eXBlb2YgcmFuZ2UuaW5kZXggPT09ICdudW1iZXInICYmIHR5cGVvZiByYW5nZS5sZW5ndGggPT09ICdudW1iZXInICYmIHJhbmdlLmluZGV4ID49IDAgJiYgcmFuZ2UubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGNvbnN0IHF1aWxsTGVuID0gcXVpbGxJbnN0YW5jZS52YWx1ZS5nZXRMZW5ndGgoKTsKICAgICAgICAgICAgICBsZXQgaW5zZXJ0UG9zID0gcmFuZ2UuaW5kZXg7CiAgICAgICAgICAgICAgaWYgKGluc2VydFBvcyA+IHF1aWxsTGVuKSBpbnNlcnRQb3MgPSBxdWlsbExlbiAtIDE7CgogICAgICAgICAgICAgIC8vIOS9v+eUqCBBUEkg5rqQ5qCH6K6w77yM6YG/5YWN6Kem5Y+R5LiN5b+F6KaB55qE6YCJ5oup5Y+Y5YyW5LqL5Lu2CiAgICAgICAgICAgICAgcXVpbGxJbnN0YW5jZS52YWx1ZS5kZWxldGVUZXh0KGluc2VydFBvcywgcmFuZ2UubGVuZ3RoLCAnYXBpJyk7CiAgICAgICAgICAgICAgcXVpbGxJbnN0YW5jZS52YWx1ZS5pbnNlcnRUZXh0KGluc2VydFBvcywgZmluYWxDb250ZW50LCAnYXBpJyk7CgogICAgICAgICAgICAgIC8vIOiuvue9ruaWsOeahOmAieaLqeS9jee9rgogICAgICAgICAgICAgIGxldCBzZWxQb3MgPSBpbnNlcnRQb3MgKyBmaW5hbENvbnRlbnQubGVuZ3RoOwogICAgICAgICAgICAgIHNlbFBvcyA9IE1hdGgubWF4KDAsIE1hdGgubWluKHNlbFBvcywgcXVpbGxJbnN0YW5jZS52YWx1ZS5nZXRMZW5ndGgoKSkpOwoKICAgICAgICAgICAgICAvLyDlu7bov5/orr7nva7pgInmi6nvvIznoa7kv53mlofmnKzmj5LlhaXlrozmiJAKICAgICAgICAgICAgICBuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgICAgICBzYWZlU2V0U2VsZWN0aW9uKHNlbFBvcywgMCwgJ2FwaScpOwogICAgICAgICAgICAgICAgZG9jdW1lbnRDaGFuZ2VkLnZhbHVlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCfmmbrog73nuqDplJnlt7LlupTnlKgnKTsKICAgICAgICAgICAgICAgIC8vIOW8uuWItuWIt+aWsOmhtemdogogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIEVsTWVzc2FnZS5lcnJvcign6YCJ5Yy65peg5pWI77yM5peg5rOV5o+S5YWl5YaF5a65Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdb5pm66IO957qg6ZSZXSDlvILluLg6JywgZXJyb3IpOwogICAgICAgIGlmIChlcnJvciAmJiBlcnJvci5yZXNwb25zZSkgewogICAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfmmbrog73nuqDplJnlpLHotKU6ICcgKyAoZXJyb3IucmVzcG9uc2UuZGF0YS5kZXRhaWwgfHwgZXJyb3IubWVzc2FnZSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBFbE1lc3NhZ2UuZXJyb3IoJ+aZuuiDvee6oOmUmeWksei0pe+8jOivt+eojeWQjuWGjeivlScpOwogICAgICAgIH0KICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBncmFtbWFyQ2hlY2tMb2FkaW5nLnZhbHVlID0gZmFsc2U7CiAgICAgIH0KICAgIH07CgogICAgLy8g5aSa6K+t6KiA57+76K+RCiAgICBjb25zdCB0cmFuc2xhdGVEaWFsb2dWaXNpYmxlID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IHRyYW5zbGF0ZUlucHV0ID0gcmVmKCcnKTsKICAgIGNvbnN0IHRyYW5zbGF0ZVJlc3VsdCA9IHJlZignJyk7CiAgICBjb25zdCB0cmFuc2xhdGVMb2FkaW5nID0gcmVmKGZhbHNlKTsKICAgIGNvbnN0IHRhcmdldExhbmcgPSByZWYoJ2VuJyk7CiAgICBjb25zdCB0cmFuc2xhdGVNb2RpZmllZENvbnRlbnQgPSByZWYoJycpOwogICAgY29uc3Qgb3BlblRyYW5zbGF0ZURpYWxvZyA9ICgpID0+IHsKICAgICAgaWYgKCFxdWlsbEluc3RhbmNlLnZhbHVlKSB7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfnvJbovpHlmajmnKrlsLHnu6rvvIzor7fnqI3lkI7ph43or5UnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLy8g5riF56m65pen5pWw5o2uCiAgICAgIHRyYW5zbGF0ZVJlc3VsdC52YWx1ZSA9ICcnOwogICAgICB0cmFuc2xhdGVNb2RpZmllZENvbnRlbnQudmFsdWUgPSAnJzsKCiAgICAgIC8vIOS9v+eUqOi+heWKqeWHveaVsOiOt+WPluW9k+WJjeacieaViOmAieaLqe+8jOi/meaYr+S/ruWkjemXrumimOeahOWFs+mUrgogICAgICBjb25zdCBzZWxlY3Rpb24gPSBnZXRDdXJyZW50U2VsZWN0aW9uKCk7CiAgICAgIGlmIChzZWxlY3Rpb24gJiYgc2VsZWN0aW9uLmxlbmd0aCA+IDApIHsKICAgICAgICB0cmFuc2xhdGVJbnB1dC52YWx1ZSA9IHF1aWxsSW5zdGFuY2UudmFsdWUuZ2V0VGV4dChzZWxlY3Rpb24uaW5kZXgsIHNlbGVjdGlvbi5sZW5ndGgpLnRyaW0oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDlpoLmnpzmsqHmnInpgInmi6nvvIzmuIXnqbrovpPlhaXmoYYKICAgICAgICB0cmFuc2xhdGVJbnB1dC52YWx1ZSA9ICcnOwogICAgICB9CgogICAgICAvLyDmmL7npLrlr7nor53moYYKICAgICAgdHJhbnNsYXRlRGlhbG9nVmlzaWJsZS52YWx1ZSA9IHRydWU7CiAgICB9OwogICAgY29uc3QgZG9UcmFuc2xhdGUgPSBhc3luYyAoKSA9PiB7CiAgICAgIGlmICghY3VycmVudERvYy52YWx1ZSB8fCAhdHJhbnNsYXRlSW5wdXQudmFsdWUpIHJldHVybjsKICAgICAgdHJhbnNsYXRlTG9hZGluZy52YWx1ZSA9IHRydWU7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdHJhbnNsYXRlVGV4dChjdXJyZW50RG9jLnZhbHVlLmlkLCB7CiAgICAgICAgICBzZWxlY3Rpb246IHRyYW5zbGF0ZUlucHV0LnZhbHVlLAogICAgICAgICAgdGFyZ2V0X2xhbmc6IHRhcmdldExhbmcudmFsdWUKICAgICAgICB9KTsKICAgICAgICB0cmFuc2xhdGVSZXN1bHQudmFsdWUgPSByZXMudHJhbnNsYXRlZDsKICAgICAgICB0cmFuc2xhdGVNb2RpZmllZENvbnRlbnQudmFsdWUgPSByZXMudHJhbnNsYXRlZDsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIEVsTWVzc2FnZS5lcnJvcign57+76K+R5aSx6LSlJyk7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgdHJhbnNsYXRlTG9hZGluZy52YWx1ZSA9IGZhbHNlOwogICAgICB9CiAgICB9OwogICAgY29uc3QgcmVwbGFjZVNlbGVjdGlvbldpdGhUcmFuc2xhdGlvbiA9ICgpID0+IHsKICAgICAgaWYgKCFxdWlsbEluc3RhbmNlLnZhbHVlIHx8ICF0cmFuc2xhdGVNb2RpZmllZENvbnRlbnQudmFsdWUpIHJldHVybjsKCiAgICAgIC8vIOS9v+eUqOi+heWKqeWHveaVsOiOt+WPluW9k+WJjeacieaViOmAieaLqQogICAgICBjb25zdCBzZWxlY3Rpb24gPSBnZXRDdXJyZW50U2VsZWN0aW9uKCk7CiAgICAgIGlmIChzZWxlY3Rpb24gJiYgc2VsZWN0aW9uLmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCBxdWlsbExlbiA9IHF1aWxsSW5zdGFuY2UudmFsdWUuZ2V0TGVuZ3RoKCk7CiAgICAgICAgbGV0IGluc2VydFBvcyA9IHNlbGVjdGlvbi5pbmRleDsKICAgICAgICBpZiAoaW5zZXJ0UG9zID4gcXVpbGxMZW4pIGluc2VydFBvcyA9IHF1aWxsTGVuIC0gMTsKCiAgICAgICAgLy8g5L2/55SoIEFQSSDmupDmoIforrDvvIzpgb/lhY3op6blj5HkuI3lv4XopoHnmoTpgInmi6nlj5jljJbkuovku7YKICAgICAgICBxdWlsbEluc3RhbmNlLnZhbHVlLmRlbGV0ZVRleHQoaW5zZXJ0UG9zLCBzZWxlY3Rpb24ubGVuZ3RoLCAnYXBpJyk7CiAgICAgICAgcXVpbGxJbnN0YW5jZS52YWx1ZS5jbGlwYm9hcmQuZGFuZ2Vyb3VzbHlQYXN0ZUhUTUwoaW5zZXJ0UG9zLCB0cmFuc2xhdGVNb2RpZmllZENvbnRlbnQudmFsdWUsICdhcGknKTsKICAgICAgICBsZXQgc2VsUG9zID0gaW5zZXJ0UG9zICsgdHJhbnNsYXRlTW9kaWZpZWRDb250ZW50LnZhbHVlLnJlcGxhY2UoLzxbXj5dKz4vZywgJycpLmxlbmd0aDsKICAgICAgICBpZiAoc2VsUG9zID4gcXVpbGxJbnN0YW5jZS52YWx1ZS5nZXRMZW5ndGgoKSAtIDEpIHNlbFBvcyA9IHF1aWxsSW5zdGFuY2UudmFsdWUuZ2V0TGVuZ3RoKCkgLSAxOwoKICAgICAgICAvLyDlu7bov5/orr7nva7pgInmi6nvvIznoa7kv53mlofmnKzmj5LlhaXlrozmiJAKICAgICAgICBuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICBzYWZlU2V0U2VsZWN0aW9uKHNlbFBvcywgMCwgJ2FwaScpOwogICAgICAgICAgZG9jdW1lbnRDaGFuZ2VkLnZhbHVlID0gdHJ1ZTsKICAgICAgICAgIEVsTWVzc2FnZS5zdWNjZXNzKCflt7Lmm7/mjaLkuLrnv7vor5HlhoXlrrknKTsKICAgICAgICAgIHRyYW5zbGF0ZURpYWxvZ1Zpc2libGUudmFsdWUgPSBmYWxzZTsKICAgICAgICAgIC8vIOW8uuWItuWIt+aWsOmhtemdogogICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIOacqumAieS4reWGheWuueaXtuaPkuWFpeWIsOWFieagh+WkhAogICAgICAgIGNvbnN0IGN1cnNvciA9IHF1aWxsSW5zdGFuY2UudmFsdWUuZ2V0U2VsZWN0aW9uKHRydWUpOwogICAgICAgIGxldCBpbnNlcnRQb3MgPSBjdXJzb3IgPyBjdXJzb3IuaW5kZXggOiBxdWlsbEluc3RhbmNlLnZhbHVlLmdldExlbmd0aCgpIC0gMTsKICAgICAgICBxdWlsbEluc3RhbmNlLnZhbHVlLmluc2VydEVtYmVkKGluc2VydFBvcywgJ3RleHQnLCB0cmFuc2xhdGVNb2RpZmllZENvbnRlbnQudmFsdWUsICdhcGknKTsKICAgICAgICBuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICBxdWlsbEluc3RhbmNlLnZhbHVlLnNldFNlbGVjdGlvbihpbnNlcnRQb3MgKyB0cmFuc2xhdGVNb2RpZmllZENvbnRlbnQudmFsdWUucmVwbGFjZSgvPFtePl0rPi9nLCAnJykubGVuZ3RoLCAwLCAnYXBpJyk7CiAgICAgICAgICBkb2N1bWVudENoYW5nZWQudmFsdWUgPSB0cnVlOwogICAgICAgICAgRWxNZXNzYWdlLnN1Y2Nlc3MoJ+W3suaPkuWFpee/u+ivkeWGheWuuScpOwogICAgICAgICAgdHJhbnNsYXRlRGlhbG9nVmlzaWJsZS52YWx1ZSA9IGZhbHNlOwogICAgICAgICAgLy8g5by65Yi25Yi35paw6aG16Z2iCiAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgLy8g5pm66IO96Zeu562UCiAgICBjb25zdCBxYURpYWxvZ1Zpc2libGUgPSByZWYoZmFsc2UpOwogICAgY29uc3QgcWFRdWVzdGlvbiA9IHJlZignJyk7CiAgICBjb25zdCBxYUFuc3dlciA9IHJlZignJyk7CiAgICBjb25zdCBxYUxvYWRpbmcgPSByZWYoZmFsc2UpOwoKICAgIC8vIOiuoeeul+WxnuaAp++8muWwhk1hcmtkb3du5qC85byP55qE5Zue562U6L2s5o2i5Li6SFRNTAogICAgY29uc3QgcWFBbnN3ZXJIdG1sID0gY29tcHV0ZWQoKCkgPT4gewogICAgICByZXR1cm4gcWFBbnN3ZXIudmFsdWUgPyBtYXJrZWQucGFyc2UocWFBbnN3ZXIudmFsdWUpIDogJyc7CiAgICB9KTsKICAgIGNvbnN0IG9wZW5RYURpYWxvZyA9ICgpID0+IHsKICAgICAgcWFEaWFsb2dWaXNpYmxlLnZhbHVlID0gdHJ1ZTsKICAgICAgcWFRdWVzdGlvbi52YWx1ZSA9ICcnOwogICAgICBxYUFuc3dlci52YWx1ZSA9ICcnOwogICAgfTsKICAgIGNvbnN0IGRvUWEgPSBhc3luYyAoKSA9PiB7CiAgICAgIGlmICghY3VycmVudERvYy52YWx1ZSB8fCAhcWFRdWVzdGlvbi52YWx1ZSkgcmV0dXJuOwogICAgICBxYUxvYWRpbmcudmFsdWUgPSB0cnVlOwogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGRvY1FhKGN1cnJlbnREb2MudmFsdWUuaWQsIHsKICAgICAgICAgIHF1ZXN0aW9uOiBxYVF1ZXN0aW9uLnZhbHVlLAogICAgICAgICAgY29udGV4dDogY3VycmVudERvYy52YWx1ZS5jb250ZW50CiAgICAgICAgfSk7CiAgICAgICAgcWFBbnN3ZXIudmFsdWUgPSByZXMuYW5zd2VyOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgRWxNZXNzYWdlLmVycm9yKCfpl67nrZTlpLHotKUnKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBxYUxvYWRpbmcudmFsdWUgPSBmYWxzZTsKICAgICAgfQogICAgfTsKCiAgICAvLyDmt7vliqDliIbkuqvnm7jlhbPlj5jph48KICAgIGNvbnN0IHNoYXJlTWV0aG9kID0gcmVmKCdwZXJtaXNzaW9uJyk7IC8vIOWIhuS6q+aWueW8j++8mnBlcm1pc3Npb24o5o6I5p2DKSDmiJYgY2hhdCjlj5HpgIHliLDogYrlpKkpCiAgICBjb25zdCBzaGFyZUZvcm1hdCA9IHJlZigncGRmJyk7IC8vIOWIhuS6q+aWh+aho+agvOW8j++8mnBkZiDmiJYgd29yZAogICAgY29uc3Qgc2VsZWN0ZWRDaGF0VXNlcnMgPSByZWYoW10pOyAvLyDpgInmi6nnmoTogYrlpKnnlKjmiLcKCiAgICByZXR1cm4gewogICAgICBkb2N1bWVudHMsCiAgICAgIGN1cnJlbnREb2MsCiAgICAgIGRvY3VtZW50Q2hhbmdlZCwKICAgICAgaXNEb2NMaXN0Q29sbGFwc2VkLAogICAgICBpc0Fzc2lzdGFudENvbGxhcHNlZCwKICAgICAgc2VhcmNoUXVlcnksCiAgICAgIGRvY1R5cGVGaWx0ZXIsCiAgICAgIHNvcnRPcHRpb24sCiAgICAgIGZpbHRlcmVkRG9jdW1lbnRzLAogICAgICBuZXdEb2N1bWVudERpYWxvZ1Zpc2libGUsCiAgICAgIHNoYXJlRGlhbG9nVmlzaWJsZSwKICAgICAgZGVsZXRlRGlhbG9nVmlzaWJsZSwKICAgICAgc2VsZWN0ZWRVc2VycywKICAgICAgYXZhaWxhYmxlVXNlcnMsCiAgICAgIHNhdmVMb2FkaW5nLAogICAgICBjcmVhdGVMb2FkaW5nLAogICAgICBzaGFyZUxvYWRpbmcsCiAgICAgIGRlbGV0ZUxvYWRpbmcsCiAgICAgIGV4cGFuZExvYWRpbmcsCiAgICAgIHBvbGlzaExvYWRpbmcsCiAgICAgIGdyYW1tYXJDaGVja0xvYWRpbmcsCiAgICAgIG5ld0RvY3VtZW50Rm9ybSwKICAgICAgZG9jdW1lbnRGb3JtUnVsZXMsCiAgICAgIGRvY3VtZW50Rm9ybVJlZiwKICAgICAgZWRpdG9yT3B0aW9ucywKICAgICAgZmV0Y2hEb2N1bWVudHMsCiAgICAgIGZldGNoRG9jdW1lbnREZXRhaWwsCiAgICAgIHNlbGVjdERvY3VtZW50LAogICAgICBzYXZlRG9jdW1lbnQsCiAgICAgIHRvZ2dsZURvY0xpc3QsCiAgICAgIHRvZ2dsZUFzc2lzdGFudCwKICAgICAgb25FZGl0b3JDaGFuZ2UsCiAgICAgIG9wZW5OZXdEb2N1bWVudERpYWxvZywKICAgICAgY3JlYXRlTmV3RG9jdW1lbnQsCiAgICAgIHNoYXJlRG9jdW1lbnQsCiAgICAgIGNvbmZpcm1TaGFyZSwKICAgICAgZGVsZXRlRG9jdW1lbnQsCiAgICAgIGNvbmZpcm1EZWxldGUsCiAgICAgIGV4cG9ydERvY3VtZW50LAogICAgICBleHBvcnRUb1BkZiwKICAgICAgZXhwb3J0VG9Xb3JkLAogICAgICBwcmludERvY3VtZW50LAogICAgICBhZGRDb2xsYWJvcmF0b3IsCiAgICAgIHZpZXdIaXN0b3J5LAogICAgICBleHBhbmRDb250ZW50LAogICAgICBwb2xpc2hUZXh0LAogICAgICBkZWJvdW5jZWRTZWFyY2gsCiAgICAgIGZvcm1hdERhdGUsCiAgICAgIGxvYWRpbmcsCiAgICAgIG9uVGl0bGVDaGFuZ2UsCiAgICAgIG9uVHlwZUNoYW5nZSwKICAgICAgb25Db250ZW50Q2hhbmdlLAogICAgICBvbkVkaXRvclJlYWR5LAogICAgICBjb21wYXJlRGlhbG9nVmlzaWJsZSwKICAgICAgY29tcGFyZURpYWxvZ0RhdGEsCiAgICAgIHNob3dDb21wYXJlRGlhbG9nLAogICAgICBhcHBseUNvbXBhcmVDaGFuZ2VzLAogICAgICBjbG9zZUNvbXBhcmVEaWFsb2csCiAgICAgIHF1aWxsU2VsZWN0aW9uLAogICAgICBxdWlsbFNlbGVjdGVkVGV4dCwKICAgICAgb25TZWxlY3Rpb25DaGFuZ2UsCiAgICAgIHF1aWxsSW5zdGFuY2UsCiAgICAgIGdyYW1tYXJDaGVja1RleHQsCiAgICAgIHRyYW5zbGF0ZURpYWxvZ1Zpc2libGUsCiAgICAgIHRyYW5zbGF0ZUlucHV0LAogICAgICB0cmFuc2xhdGVSZXN1bHQsCiAgICAgIHRyYW5zbGF0ZUxvYWRpbmcsCiAgICAgIHRhcmdldExhbmcsCiAgICAgIG9wZW5UcmFuc2xhdGVEaWFsb2csCiAgICAgIGRvVHJhbnNsYXRlLAogICAgICBxYURpYWxvZ1Zpc2libGUsCiAgICAgIHFhUXVlc3Rpb24sCiAgICAgIHFhQW5zd2VyLAogICAgICBxYUxvYWRpbmcsCiAgICAgIG9wZW5RYURpYWxvZywKICAgICAgZG9RYSwKICAgICAgcWFBbnN3ZXJIdG1sLAogICAgICByZXBsYWNlU2VsZWN0aW9uV2l0aFRyYW5zbGF0aW9uLAogICAgICB0cmFuc2xhdGVNb2RpZmllZENvbnRlbnQsCiAgICAgIGRvY3VtZW50c0xvYWRpbmcsCiAgICAgIGRvY3VtZW50Q2FjaGUsCiAgICAgIHNjcm9sbFRvQWN0aXZlRG9jdW1lbnQsCiAgICAgIGdvQmFjaywKICAgICAgc2hhcmVNZXRob2QsCiAgICAgIHNoYXJlRm9ybWF0LAogICAgICBzZWxlY3RlZENoYXRVc2VycwogICAgfTsKICB9Cn07"},{"version":3,"names":["ref","computed","watch","onMounted","nextTick","useRoute","useRouter","ElMessage","ElMessageBox","ElLoading","_","request","getDocuments","getDocumentDetail","createDocument","updateDocument","deleteDocument","apiDeleteDocument","shareDocument","apiShareDocument","expandContent","apiExpandContent","polishText","apiPolishText","grammarCheck","translateText","docQa","userApi","createChatSession","getChatSessions","Document","Plus","CircleCheck","Download","More","Search","ArrowLeft","ArrowRight","Share","ShareIcon","Edit","StarFilled","ChatDotRound","QuestionFilled","ArrowLeftBold","Loading","QuillEditor","marked","markedHighlight","hljs","use","langPrefix","highlight","code","lang","language","getLanguage","value","gfm","breaks","pedantic","sanitize","smartLists","smartypants","name","components","setup","router","route","goBack","push","documents","currentDoc","documentChanged","isDocListCollapsed","isAssistantCollapsed","searchQuery","docTypeFilter","sortOption","newDocumentDialogVisible","shareDialogVisible","deleteDialogVisible","selectedUsers","availableUsers","documentsLoading","saveLoading","createLoading","shareLoading","deleteLoading","expandLoading","polishLoading","grammarCheckLoading","newDocumentForm","title","type","documentFormRules","required","message","trigger","min","max","documentFormRef","uploadImage","file","reader","FileReader","Promise","resolve","reject","onload","e","base64Data","target","result","url","onerror","Error","readAsDataURL","error","console","editorOptions","placeholder","modules","toolbar","container","handlers","image","input","document","createElement","setAttribute","click","onchange","files","size","supportedTypes","includes","info","res","quill","quillInstance","range","getSelection","insertEmbed","index","success","filteredDocuments","query","toLowerCase","filter","doc","typeFilter","sort","a","b","Date","update_time","create_time","localeCompare","fetchDocuments","page","allDocs","log","params","limit","_t","getTime","response","docsList","totalCount","currentPageDocs","hasMore","data","Array","isArray","count","total","length","results","next","existingIds","Set","map","id","newDocs","has","setTimeout","loading","documentCache","Map","selectDocument","_currentDoc$value","confirm","confirmButtonText","cancelButtonText","distinguishCancelAndClose","saveDocument","originalDoc","content","cachedDoc","get","replace","fetchDocumentDetail","retry","warn","set","entries","from","recentEntries","slice","trim","warning","errorMsg","status","detail","toggleDocList","toggleAssistant","onEditorChange","openNewDocumentDialog","createNewDocument","validate","valid","getCompanyUsers","currentUserJson","localStorage","getItem","currentUserId","currentUser","JSON","parse","user","username","email","shareMethod","shareFormat","selectedChatUsers","confirmShare","service","lock","text","background","docTitle","documentContent","tempContainer","innerHTML","className","body","appendChild","documentFile","fileName","fileType","setText","html2pdfModule","html2pdf","default","options","margin","filename","quality","html2canvas","scale","useCORS","jsPDF","unit","format","orientation","outputPdf","msWordHtml","Blob","removeChild","promises","userId","sessionsResponse","chatId","existingSession","find","session","participants","some","p","sessionResponse","participant_ids","formData","FormData","append","File","method","headers","all","successCount","close","confirmDelete","deletedDocId","window","removeItem","location","href","exportDocument","showCancelButton","closeOnClickModal","callback","action","exportToPdf","exportToWord","editorDom","querySelector","contentElement","cloneNode","then","save","catch","contentContainer","FileSaver","saveAs","blob","printDocument","addCollaborator","viewHistory","quillSelection","quillSelectedText","onSelectionChange","oldRange","source","getText","MAX_AI_TEXT_LENGTH","getCurrentSelection","selection","textLength","getLength","safeSetSelection","safeIndex","Math","safeLength","setSelection","selectedText","showCompareDialog","original","modified","onApply","finalContent","quillLen","insertPos","deleteText","insertText","selPos","reload","style","compareDialogVisible","compareDialogData","modifiedContent","applyCompareChanges","closeCompareDialog","debouncedSearch","debounce","formatDate","dateString","date","now","toDateString","toLocaleTimeString","hour","minute","yesterday","setDate","getDate","weekDays","diffDays","round","getDay","toLocaleDateString","month","day","newId","oldId","idNum","Number","isNaN","isInteger","immediate","_refresh","newVal","docId","setInterval","scrollToActiveDocument","activeDoc","scrollIntoView","behavior","block","onTitleChange","val","onTypeChange","onContentChange","currentContent","originalContent","scrollQuillToBottom","onEditorReady","on","toolbarTooltips","getModule","selector","elements","querySelectorAll","forEach","el","hasAttribute","currentSelection","root","scrollTop","scrollHeight","grammarCheckText","suggestions","suggestionsHtml","correctedText","corrected","optimizedTextMatch","match","finalCorrectedText","translateDialogVisible","translateInput","translateResult","translateLoading","targetLang","translateModifiedContent","openTranslateDialog","doTranslate","target_lang","translated","replaceSelectionWithTranslation","clipboard","dangerouslyPasteHTML","cursor","qaDialogVisible","qaQuestion","qaAnswer","qaLoading","qaAnswerHtml","openQaDialog","doQa","question","context","answer"],"sources":["C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\smartdoc\\Detail.vue"],"sourcesContent":["<template>\n  <div class=\"smart-doc-container smartdoc-detail\">\n    <!--  -->\n    <div class=\"sidebar\" :class=\"{ 'collapsed': isDocListCollapsed }\">\n      <!--  -->\n      <div class=\"sidebar-header\">\n        <h4 v-if=\"!isDocListCollapsed\"></h4>\n        <div class=\"toggle-btn\" @click=\"toggleDocList\">\n          <el-icon><ArrowLeft v-if=\"!isDocListCollapsed\" /><ArrowRight v-else /></el-icon>\n        </div>\n      </div>\n\n      <!--  -->\n      <div class=\"sidebar-content\" v-show=\"!isDocListCollapsed\">\n        <!--  -->\n        <div class=\"search-area\">\n          <el-input\n            placeholder=\"...\"\n            v-model=\"searchQuery\"\n            clearable\n            @input=\"debouncedSearch\"\n          >\n            <template #prefix>\n              <el-icon><Search /></el-icon>\n            </template>\n          </el-input>\n          <div class=\"filter-options\">\n            <el-input v-model=\"docTypeFilter\" placeholder=\"\" size=\"small\" clearable />\n            <el-select v-model=\"sortOption\" placeholder=\"\" size=\"small\">\n              <el-option label=\"\" value=\"update\" />\n              <el-option label=\"\" value=\"create\" />\n              <el-option label=\"\" value=\"name-asc\" />\n            </el-select>\n          </div>\n        </div>\n\n        <!--  -->\n        <el-scrollbar class=\"document-list-scrollbar\">\n          <div v-if=\"documentsLoading\" class=\"loading-state\">\n            <el-skeleton :rows=\"10\" animated />\n          </div>\n          <div v-else class=\"document-list\">\n            <div \n              v-for=\"doc in filteredDocuments\" \n              :key=\"doc.id\" \n              class=\"doc-item\"\n              :class=\"{ 'active': currentDoc?.id === doc.id }\"\n              @click=\"selectDocument(doc.id)\"\n            >\n              <div class=\"doc-icon\">\n                <el-icon><Document /></el-icon>\n              </div>\n              <div class=\"doc-info\">\n                <h5>{{ doc.title }}</h5>\n                <div class=\"doc-meta\">\n                  <span>{{ doc.type }}</span>\n                  <span>{{ formatDate(doc.update_time) }}</span>\n                </div>\n              </div>\n            </div>\n            \n            <div v-if=\"filteredDocuments.length === 0\" class=\"empty-state\">\n              <el-empty description=\"\" :image-size=\"60\">\n                <el-button size=\"small\" @click=\"fetchDocuments(1, [])\"></el-button>\n              </el-empty>\n            </div>\n            \n            <div v-if=\"filteredDocuments.length > 0\" class=\"document-count\">\n               {{ filteredDocuments.length }} \n            </div>\n          </div>\n        </el-scrollbar>\n\n        <!--  -->\n        <div class=\"action-buttons\">\n          <el-button type=\"primary\" @click=\"openNewDocumentDialog\">\n            <el-icon><Plus /></el-icon> \n          </el-button>\n        </div>\n      </div>\n\n      <!--  -->\n      <div class=\"collapsed-sidebar\" v-if=\"isDocListCollapsed\">\n        <el-tooltip content=\"\" placement=\"right\">\n          <div class=\"icon-btn create-btn\" @click=\"openNewDocumentDialog\">\n            <el-icon><Plus /></el-icon>\n          </div>\n        </el-tooltip>\n        \n        <div class=\"recent-docs\">\n          <el-tooltip \n            v-for=\"doc in filteredDocuments.slice(0, 5)\" \n            :key=\"doc.id\" \n            :content=\"doc.title\"\n            placement=\"right\"\n          >\n            <div \n              class=\"icon-btn doc-btn\"\n              :class=\"{ 'active': currentDoc?.id === doc.id }\"\n              @click=\"selectDocument(doc.id)\"\n            >\n              <el-icon><Document /></el-icon>\n            </div>\n          </el-tooltip>\n        </div>\n      </div>\n    </div>\n\n    <!--  -->\n    <div class=\"main-content\">\n      <!--  -->\n      <div class=\"document-content\">\n        <el-skeleton v-if=\"loading\" :rows=\"6\" animated style=\"margin:40px\" />\n        <template v-else-if=\"currentDoc\">\n          <!--  -->\n          <div class=\"document-header\">\n            <div class=\"header-left-actions\">\n              <el-tooltip content=\"\" placement=\"bottom\">\n                <el-button @click=\"goBack\" circle>\n                  <el-icon><ArrowLeftBold /></el-icon>\n                </el-button>\n              </el-tooltip>\n            </div>\n            <div class=\"doc-info-area\">\n              <div class=\"doc-title-label\"></div>\n              <div class=\"doc-title\">\n                <el-input \n                  v-model=\"currentDoc.title\"\n                  placeholder=\"\"\n                  size=\"large\"\n                  @change=\"onTitleChange\"\n                />\n              </div>\n              <div class=\"doc-type-label\"></div>\n              <div class=\"doc-type-selector\">\n                <el-input \n                  v-model=\"currentDoc.type\" \n                  placeholder=\"\"\n                  size=\"default\"\n                  @change=\"onTypeChange\"\n                />\n              </div>\n            </div>\n            <div class=\"doc-actions\">\n              <el-tooltip content=\"\" placement=\"bottom\">\n                <el-button \n                  circle\n                  :disabled=\"!documentChanged\" \n                  :loading=\"saveLoading\"\n                  @click=\"saveDocument\"\n                >\n                  <el-icon><CircleCheck /></el-icon>\n                </el-button>\n              </el-tooltip>\n              <el-tooltip content=\"\" placement=\"bottom\">\n                <el-button circle @click=\"shareDocument\"><el-icon><ShareIcon /></el-icon></el-button>\n              </el-tooltip>\n              <el-tooltip content=\"\" placement=\"bottom\">\n                <el-button circle @click=\"exportDocument\"><el-icon><Download /></el-icon></el-button>\n              </el-tooltip>\n              <el-tooltip content=\"\" placement=\"bottom\">\n                <el-dropdown trigger=\"click\">\n                  <el-button circle><el-icon><More /></el-icon></el-button>\n                  <template #dropdown>\n                    <el-dropdown-menu>\n                      <el-dropdown-item @click=\"deleteDocument\" class=\"text-red-500\"></el-dropdown-item>\n                    </el-dropdown-menu>\n                  </template>\n                </el-dropdown>\n              </el-tooltip>\n            </div>\n          </div>\n          \n          <!--  -->\n          <div class=\"editor-area\">\n            <QuillEditor\n              v-model:content=\"currentDoc.content\"\n              :options=\"editorOptions\"\n              contentType=\"html\"\n              theme=\"snow\"\n              class=\"quill-editor\"\n              @textChange=\"onContentChange\"\n              @ready=\"onEditorReady\"\n              placeholder=\" \"\n            />\n          </div>\n        </template>\n        \n        <!--  -->\n        <div v-else class=\"empty-doc-state\">\n          <el-empty description=\"\">\n            <el-button type=\"primary\" @click=\"openNewDocumentDialog\"></el-button>\n          </el-empty>\n        </div>\n      </div>\n    </div>\n    \n    <!--  -->\n    <div class=\"assistant-panel\" :class=\"{ 'collapsed': isAssistantCollapsed }\">\n      <div class=\"assistant-header\">\n        <h5 v-if=\"!isAssistantCollapsed\">AI</h5>\n        <div class=\"toggle-btn\" @click=\"toggleAssistant\">\n          <el-icon><ArrowRight v-if=\"!isAssistantCollapsed\" /><ArrowLeft v-else /></el-icon>\n        </div>\n      </div>\n      \n      <div class=\"assistant-body\" v-show=\"!isAssistantCollapsed\">\n        <div class=\"ai-features-beauty\">\n          <div class=\"ai-feature-card\">\n            <el-tooltip content=\"\" :disabled=\"!!quillSelectedText\" placement=\"top\" effect=\"dark\">\n              <el-button type=\"primary\" class=\"ai-feature-btn\" @click=\"expandContent\" :loading=\"expandLoading\" :disabled=\"!quillSelectedText\">\n                <el-icon class=\"ai-icon\"><Edit /></el-icon>\n                \n              </el-button>\n            </el-tooltip>\n            <div class=\"ai-feature-desc\"></div>\n          </div>\n          <div class=\"ai-feature-card\">\n            <el-tooltip content=\"\" :disabled=\"!!quillSelectedText\" placement=\"top\" effect=\"dark\">\n              <el-button type=\"success\" class=\"ai-feature-btn\" @click=\"polishText\" :loading=\"polishLoading\" :disabled=\"!quillSelectedText\">\n                <el-icon class=\"ai-icon\"><StarFilled /></el-icon>\n                \n              </el-button>\n            </el-tooltip>\n            <div class=\"ai-feature-desc\"></div>\n          </div>\n          <div class=\"ai-feature-card\">\n            <el-tooltip content=\"\" :disabled=\"!!quillSelectedText\" placement=\"top\" effect=\"dark\">\n              <el-button type=\"warning\" class=\"ai-feature-btn\" @click=\"grammarCheckText\" :loading=\"grammarCheckLoading\" :disabled=\"!quillSelectedText\">\n                <el-icon class=\"ai-icon\"><Edit /></el-icon>\n                \n              </el-button>\n            </el-tooltip>\n            <div class=\"ai-feature-desc\">AI</div>\n          </div>\n          <div class=\"ai-feature-card\">\n            <el-button type=\"info\" class=\"ai-feature-btn\" @click=\"openTranslateDialog\" \n                      style=\"background-color: #50a1ff !important; border-color: #50a1ff !important; color: white !important; box-shadow: 0 2px 6px rgba(100, 150, 255, 0.2) !important;\">\n              <el-icon class=\"ai-icon\"><ChatDotRound /></el-icon>\n              \n            </el-button>\n            <div class=\"ai-feature-desc\"></div>\n          </div>\n          <div class=\"ai-feature-card\">\n            <el-button type=\"success\" class=\"ai-feature-btn\" @click=\"openQaDialog\"\n                      style=\"background-color: #67c23a !important; border-color: #67c23a !important; color: white !important; box-shadow: 0 2px 6px rgba(103, 194, 58, 0.2) !important;\">\n              <el-icon class=\"ai-icon\"><QuestionFilled /></el-icon>\n              \n            </el-button>\n            <div class=\"ai-feature-desc\">AI</div>\n          </div>\n        </div>\n      </div>\n      \n      <!-- AI -->\n      <div class=\"collapsed-assistant\" v-if=\"isAssistantCollapsed\">\n        <el-tooltip :content=\"quillSelectedText ? '' : ''\" placement=\"left\">\n          <div class=\"icon-btn\" @click=\"expandContent\" :class=\"{ 'disabled': !quillSelectedText || expandLoading }\">\n            <el-icon v-if=\"expandLoading\" class=\"is-loading\"><Loading /></el-icon>\n            <el-icon v-else><Edit /></el-icon>\n          </div>\n        </el-tooltip>\n        <el-tooltip :content=\"quillSelectedText ? '' : ''\" placement=\"left\">\n          <div class=\"icon-btn\" @click=\"polishText\" :class=\"{ 'disabled': !quillSelectedText || polishLoading }\">\n            <el-icon v-if=\"polishLoading\" class=\"is-loading\"><Loading /></el-icon>\n            <el-icon v-else><StarFilled /></el-icon>\n          </div>\n        </el-tooltip>\n        <el-tooltip :content=\"quillSelectedText ? '' : ''\" placement=\"left\">\n          <div class=\"icon-btn\" @click=\"grammarCheckText\" :class=\"{ 'disabled': !quillSelectedText || grammarCheckLoading }\">\n            <el-icon v-if=\"grammarCheckLoading\" class=\"is-loading\"><Loading /></el-icon>\n            <el-icon v-else><Edit /></el-icon>\n          </div>\n        </el-tooltip>\n        <el-tooltip content=\"\" placement=\"left\">\n          <div class=\"icon-btn\" @click=\"openTranslateDialog\" \n               style=\"background-color: #50a1ff !important; border-color: #50a1ff !important; color: white !important;\">\n            <el-icon><ChatDotRound /></el-icon>\n          </div>\n        </el-tooltip>\n        <el-tooltip content=\"\" placement=\"left\">\n          <div class=\"icon-btn\" @click=\"openQaDialog\"\n               style=\"background-color: #67c23a !important; border-color: #67c23a !important; color: white !important;\">\n            <el-icon><QuestionFilled /></el-icon>\n          </div>\n        </el-tooltip>\n      </div>\n    </div>\n\n    <!--  -->\n    <el-dialog\n      v-model=\"newDocumentDialogVisible\"\n      title=\"\"\n      width=\"35%\"\n    >\n      <el-form \n        :model=\"newDocumentForm\" \n        label-width=\"80px\" \n        :rules=\"documentFormRules\"\n        ref=\"documentFormRef\"\n      >\n        <el-form-item label=\"\" prop=\"title\">\n          <el-input v-model=\"newDocumentForm.title\" placeholder=\"\" />\n        </el-form-item>\n        <el-form-item label=\"\">\n          <el-input v-model=\"newDocumentForm.type\" placeholder=\"\" />\n          <div class=\"form-tip\"></div>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"newDocumentDialogVisible = false\"></el-button>\n          <el-button type=\"primary\" @click=\"createNewDocument\" :loading=\"createLoading\">\n            \n          </el-button>\n        </span>\n      </template>\n    </el-dialog>\n    \n    <!--  -->\n    <el-dialog\n      v-model=\"shareDialogVisible\"\n      title=\"\"\n      width=\"30%\"\n    >\n      <div v-if=\"currentDoc\">\n        <p>: <strong>{{ currentDoc.title }}</strong></p>\n        \n        <!--  -->\n        <el-form label-width=\"120px\" class=\"mt-4\">\n          <el-form-item label=\"\">\n            <el-radio-group v-model=\"shareMethod\">\n              <el-radio label=\"permission\"></el-radio>\n              <el-radio label=\"chat\"></el-radio>\n            </el-radio-group>\n          </el-form-item>\n          \n          <!--  -->\n          <el-form-item label=\"\" v-if=\"shareMethod === 'permission'\">\n            <el-select\n              v-model=\"selectedUsers\"\n              multiple\n              placeholder=\"\"\n              style=\"width: 100%\"\n            >\n              <el-option\n                v-for=\"user in availableUsers\"\n                :key=\"user.id\"\n                :label=\"user.username\"\n                :value=\"user.id\"\n              />\n            </el-select>\n          </el-form-item>\n          \n          <!--  -->\n          <template v-if=\"shareMethod === 'chat'\">\n            <el-form-item label=\"\">\n              <el-radio-group v-model=\"shareFormat\">\n                <el-radio label=\"pdf\">PDF</el-radio>\n                <el-radio label=\"word\">Word</el-radio>\n              </el-radio-group>\n            </el-form-item>\n            \n            <el-form-item label=\"\">\n              <el-select\n                v-model=\"selectedChatUsers\"\n                multiple\n                placeholder=\"\"\n                style=\"width: 100%\"\n              >\n                <el-option\n                  v-for=\"user in availableUsers\"\n                  :key=\"user.id\"\n                  :label=\"user.username\"\n                  :value=\"user.id\"\n                />\n              </el-select>\n              <div class=\"form-tip\"></div>\n            </el-form-item>\n          </template>\n        </el-form>\n      </div>\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"shareDialogVisible = false\"></el-button>\n          <el-button type=\"primary\" @click=\"confirmShare\" :loading=\"shareLoading\">\n            \n          </el-button>\n        </span>\n      </template>\n    </el-dialog>\n    \n    <!--  -->\n    <el-dialog\n      v-model=\"deleteDialogVisible\"\n      title=\"\"\n      width=\"30%\"\n    >\n      <div v-if=\"currentDoc\">\n        <p> <strong>{{ currentDoc.title }}</strong> ?</p>\n        <p class=\"warning-text\">!</p>\n        </div>\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"deleteDialogVisible = false\"></el-button>\n          <el-button type=\"danger\" @click=\"confirmDelete\" :loading=\"deleteLoading\">\n            \n          </el-button>\n        </span>\n      </template>\n    </el-dialog>\n\n    <!--  -->\n    <el-dialog\n      v-model=\"compareDialogVisible\"\n      :title=\"compareDialogData.title\"\n      width=\"90%\"\n      class=\"compare-dialog large-dialog\"\n      :fullscreen=\"false\"\n      :append-to-body=\"true\"\n      :destroy-on-close=\"false\"\n      :close-on-click-modal=\"false\"\n      :show-close=\"true\"\n    >\n      <div v-if=\"compareDialogData\" class=\"dialog-container\">\n        <div class=\"compare-content\">\n          <div class=\"original-content\">\n            <h6></h6>\n            <QuillEditor\n              v-model:content=\"compareDialogData.original\"\n              contentType=\"text\"\n              theme=\"snow\"\n              :readOnly=\"true\"\n              class=\"quill-editor-in-dialog dark-content\"\n            />\n          </div>\n          <div class=\"modified-content\">\n            <h6></h6>\n            <QuillEditor\n              v-model:content=\"compareDialogData.modifiedContent\"\n              contentType=\"text\"\n              theme=\"snow\"\n              class=\"quill-editor-in-dialog\"\n            />\n          </div>\n        </div>\n        <div v-if=\"compareDialogData.suggestions\" class=\"ai-suggestions\" style=\"margin-top:16px;\">\n          <el-alert\n            title=\"AI\"\n            type=\"info\"\n            :closable=\"false\"\n            show-icon\n            style=\"font-size:15px;line-height:1.8;\"\n          >\n            <div v-html=\"compareDialogData.suggestions\"></div>\n          </el-alert>\n        </div>\n      </div>\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"closeCompareDialog\"></el-button>\n          <el-button type=\"primary\" @click=\"applyCompareChanges\"></el-button>\n        </span>\n      </template>\n    </el-dialog>\n\n    <!--  -->\n    <el-dialog v-model=\"translateDialogVisible\" title=\"\" width=\"900px\" destroy-on-close>\n      <div style=\"margin-bottom:12px; display:flex; align-items:center; gap:12px;\">\n        <el-select v-model=\"targetLang\" placeholder=\"\" style=\"width:180px;\">\n          <el-option label=\"\" value=\"en\" />\n          <el-option label=\"\" value=\"zh\" />\n          <el-option label=\"\" value=\"ja\" />\n          <el-option label=\"\" value=\"fr\" />\n          <el-option label=\"\" value=\"de\" />\n          <el-option label=\"\" value=\"es\" />\n          <el-option label=\"\" value=\"ru\" />\n          <el-option label=\"\" value=\"ko\" />\n        </el-select>\n        <el-button type=\"primary\" :loading=\"translateLoading\" @click=\"doTranslate\"></el-button>\n      </div>\n      <div class=\"compare-content\">\n        <div class=\"original-content\">\n          <h6></h6>\n          <QuillEditor\n            v-model:content=\"translateInput\"\n            contentType=\"text\"\n            theme=\"snow\"\n            :readOnly=\"true\"\n            class=\"quill-editor-in-dialog dark-content\"\n          />\n        </div>\n        <div class=\"modified-content\">\n          <h6></h6>\n          <QuillEditor\n            v-model:content=\"translateModifiedContent\"\n            contentType=\"text\"\n            theme=\"snow\"\n            class=\"quill-editor-in-dialog\"\n          />\n        </div>\n      </div>\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"translateDialogVisible = false\"></el-button>\n          <el-button v-if=\"translateModifiedContent\" type=\"success\" @click=\"replaceSelectionWithTranslation\"></el-button>\n        </span>\n      </template>\n    </el-dialog>\n\n    <!--  -->\n    <el-dialog v-model=\"qaDialogVisible\" title=\"\" width=\"500px\">\n      <el-input\n        v-model=\"qaQuestion\"\n        placeholder=\"\"\n        style=\"margin-bottom:12px;\"\n        @keyup.enter=\"doQa\"\n      />\n      <el-button type=\"primary\" :loading=\"qaLoading\" @click=\"doQa\"></el-button>\n      <div v-if=\"qaAnswer\" style=\"margin-top:16px;\">\n        <el-alert title=\"AI\" type=\"info\" :closable=\"false\" show-icon>\n          <div v-html=\"qaAnswerHtml\"></div>\n        </el-alert>\n      </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { ref, computed, watch, onMounted, nextTick } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { ElMessage, ElMessageBox, ElLoading } from 'element-plus'\nimport _ from 'lodash'\nimport request from '@/utils/request'\nimport { \n  getDocuments, \n  getDocumentDetail, \n  createDocument, \n  updateDocument,\n  deleteDocument as apiDeleteDocument,\n  shareDocument as apiShareDocument,\n  expandContent as apiExpandContent,\n  polishText as apiPolishText,\n  grammarCheck,\n  translateText,\n  docQa\n} from '@/api/smartdoc'\nimport userApi from '@/api/user';\nimport { createChatSession, getChatSessions } from '@/api/chat';\nimport { Document, Plus, CircleCheck, Download, More, Search, ArrowLeft, ArrowRight, Share as ShareIcon, Edit, StarFilled, ChatDotRound, QuestionFilled, ArrowLeftBold, Loading } from '@element-plus/icons-vue'\nimport { QuillEditor } from '@vueup/vue-quill'\nimport '@vueup/vue-quill/dist/vue-quill.snow.css'\nimport { marked } from 'marked'\nimport { markedHighlight } from 'marked-highlight'\nimport hljs from 'highlight.js'\nimport 'highlight.js/styles/github.css' // \n\n// marked\nmarked.use(\n  markedHighlight({\n    langPrefix: 'hljs language-',\n    highlight(code, lang) {\n      const language = hljs.getLanguage(lang) ? lang : 'plaintext';\n      return hljs.highlight(code, { language }).value;\n    }\n  })\n);\n\n// \nmarked.use({\n  gfm: true,\n  breaks: true,\n  pedantic: false,\n  sanitize: false, // marked v4.3.0sanitize\n  smartLists: true,\n  smartypants: false\n});\n\nexport default {\n  name: 'SmartDocDetail',\n  components: {\n    Document, Plus, CircleCheck, Download, More, \n    Search, ArrowLeft, ArrowRight, ShareIcon, QuillEditor, Edit, StarFilled, ChatDotRound, QuestionFilled, ArrowLeftBold, Loading\n  },\n  setup() {\n    const router = useRouter();\n    const route = useRoute();\n    \n    const goBack = () => {\n      router.push('/smartdoc');\n    };\n    \n    // \n    const documents = ref([])\n    const currentDoc = ref(null)\n    const documentChanged = ref(false)\n    const isDocListCollapsed = ref(false)\n    const isAssistantCollapsed = ref(false)\n    const searchQuery = ref('')\n    const docTypeFilter = ref('')\n    const sortOption = ref('update')\n    const newDocumentDialogVisible = ref(false)\n    const shareDialogVisible = ref(false)\n    const deleteDialogVisible = ref(false)\n    const selectedUsers = ref([])\n    const availableUsers = ref([])\n    const documentsLoading = ref(true) // \n    \n    // \n    const saveLoading = ref(false)\n    const createLoading = ref(false)\n    const shareLoading = ref(false)\n    const deleteLoading = ref(false)\n    const expandLoading = ref(false)\n    const polishLoading = ref(false)\n    const grammarCheckLoading = ref(false)\n    \n    // \n    const newDocumentForm = ref({\n        title: '',\n      type: ''\n    })\n    \n    // \n    const documentFormRules = {\n      title: [\n        { required: true, message: '', trigger: 'blur' },\n        { min: 2, max: 50, message: '250', trigger: 'blur' }\n      ]\n    }\n    \n    const documentFormRef = ref(null)\n      \n    const uploadImage = async (file) => {\n      try {\n        // FileReaderbase64\n        const reader = new FileReader()\n        return new Promise((resolve, reject) => {\n          reader.onload = (e) => {\n            const base64Data = e.target.result\n            // base64URL\n            resolve({ url: base64Data })\n          }\n          reader.onerror = () => {\n            reject(new Error(''))\n          }\n          reader.readAsDataURL(file)\n        })\n      } catch (error) {\n        console.error(':', error)\n        throw error\n      }\n    }\n    \n      // \n    const editorOptions = {\n      placeholder: ' ',\n        modules: {\n        toolbar: {\n          container: [\n            ['bold', 'italic', 'underline', 'strike'],\n            ['blockquote', 'code-block'],\n          [{ 'header': 1 }, { 'header': 2 }],\n          [{ 'list': 'ordered' }, { 'list': 'bullet' }],\n          [{ 'script': 'sub' }, { 'script': 'super' }],\n          [{ 'indent': '-1' }, { 'indent': '+1' }],\n          [{ 'direction': 'rtl' }],\n          [{ 'size': ['small', false, 'large', 'huge'] }],\n          [{ 'header': [1, 2, 3, 4, 5, 6, false] }],\n          [{ 'color': [] }, { 'background': [] }],\n          [{ 'font': [] }],\n          [{ 'align': [] }],\n            ['clean'],\n          ['link', 'image']\n          ],\n          handlers: {\n            image: function () {\n              const input = document.createElement('input')\n              input.setAttribute('type', 'file')\n              input.setAttribute('accept', 'image/*')\n              input.click()\n              input.onchange = async () => {\n                const file = input.files[0]\n                if (!file) return\n                \n                // \n                if (file.size > 5 * 1024 * 1024) { // 5MB\n                  ElMessage.error('5MB')\n                  return\n                }\n                \n                // \n                const supportedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp']\n                if (!supportedTypes.includes(file.type)) {\n                  ElMessage.error('JPGPNGGIFWEBP')\n                  return\n                }\n                \n                ElMessage.info('...')\n                \n                try {\n                  // FormData\n                  const res = await uploadImage(file)\n                  const url = res.url\n                  if (!url) throw new Error('URL')\n                  \n                  // \n                  const quill = quillInstance.value\n                  const range = quill.getSelection(true)\n                  quill.insertEmbed(range.index, 'image', url)\n                  \n                  // \n                  documentChanged.value = true\n                  \n                  ElMessage.success('')\n                } catch (e) {\n                  console.error(':', e)\n                  ElMessage.error(': ' + e.message)\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n    \n    // \n    const filteredDocuments = computed(() => {\n      let result = [...documents.value]\n      \n      // \n      if (searchQuery.value) {\n        const query = searchQuery.value.toLowerCase()\n        result = result.filter(doc => \n          doc.title.toLowerCase().includes(query) || \n          doc.type.toLowerCase().includes(query)\n        )\n      }\n      \n      // \n      if (docTypeFilter.value) {\n        const typeFilter = docTypeFilter.value.toLowerCase()\n        result = result.filter(doc => \n          doc.type.toLowerCase().includes(typeFilter)\n        )\n      }\n      \n      // \n      if (sortOption.value === 'update') {\n        result.sort((a, b) => new Date(b.update_time) - new Date(a.update_time))\n      } else if (sortOption.value === 'create') {\n        result.sort((a, b) => new Date(b.create_time) - new Date(a.create_time))\n      } else if (sortOption.value === 'name-asc') {\n        result.sort((a, b) => a.title.localeCompare(b.title))\n      }\n      \n      return result\n    })\n    \n    // \n    const fetchDocuments = async (page = 1, allDocs = []) => {\n      if (page === 1) {\n        documentsLoading.value = true\n      }\n      \n      try {\n        console.log(` ${page}...`)\n        const params = {\n          page: page,\n          limit: 100,  // 10PAGE_SIZE\n          _t: new Date().getTime() // \n        }\n        \n        const response = await getDocuments(params)\n        console.log(`(${page}):`, response)\n        \n        // \n        let docsList = [...allDocs]\n        let totalCount = 0\n        let currentPageDocs = []\n        let hasMore = false\n        \n        // \n        if (response.data && Array.isArray(response.data)) {\n          currentPageDocs = response.data\n          totalCount = response.count || response.total || 0\n          hasMore = docsList.length + currentPageDocs.length < totalCount\n        } else if (response.results && Array.isArray(response.results)) {\n          currentPageDocs = response.results\n          totalCount = response.count || 0\n          hasMore = !!response.next\n        } else if (response.data && response.data.results && Array.isArray(response.data.results)) {\n          currentPageDocs = response.data.results\n          totalCount = response.data.count || 0\n          hasMore = !!response.data.next\n        }\n        \n        // \n        const existingIds = new Set(docsList.map(doc => doc.id))\n        const newDocs = currentPageDocs.filter(doc => !existingIds.has(doc.id))\n        \n        if (newDocs.length > 0) {\n          docsList = [...docsList, ...newDocs]\n          console.log(`${page}${newDocs.length}${docsList.length}`)\n        } else {\n          console.log(`${page}`)\n        }\n        \n        // \n        documents.value = docsList\n        \n        // \n        if (!hasMore || currentPageDocs.length === 0 || page >= 50) {\n          console.log(`${docsList.length}${hasMore ? '' : ''}`)\n          documentsLoading.value = false\n          return docsList\n        }\n        \n        // 50\n        if (docsList.length < 200 && hasMore) {\n          console.log(` ${docsList.length}/${totalCount || ''} ...`)\n          // 100ms\n          await new Promise(resolve => setTimeout(resolve, 100))\n          // \n          return fetchDocuments(page + 1, docsList)\n        } else {\n          console.log(`(${docsList.length})`)\n          documentsLoading.value = false\n          return docsList\n        }\n      } catch (error) {\n        console.error('', error)\n        ElMessage.error('')\n        documentsLoading.value = false\n        documents.value = allDocs // \n        return allDocs\n      }\n    }\n    \n    const loading = ref(false)\n    \n    // \n    const documentCache = ref(new Map());\n    \n    const selectDocument = async (id) => {\n      console.log(`: ${id}, : ${currentDoc.value?.id}`);\n      \n      // \n      if (currentDoc.value && currentDoc.value.id === id) {\n        console.log('');\n        return;\n      }\n      \n      // \n      if (documentChanged.value && currentDoc.value) {\n        try {\n          await ElMessageBox.confirm(\n            '',\n            '',\n            {\n              confirmButtonText: '',\n              cancelButtonText: '',\n              type: 'warning',\n              distinguishCancelAndClose: true // \n            }\n          )\n          await saveDocument()\n        } catch (error) {\n          // \n          if (error === 'cancel' || error === 'close') {\n            if (currentDoc.value && originalDoc.value) {\n              currentDoc.value.title = originalDoc.value.title\n              currentDoc.value.type = originalDoc.value.type\n              currentDoc.value.content = originalDoc.value.content\n              documentChanged.value = false\n            }\n          }\n          // \n        }\n      }\n      \n      // \n      if (documentCache.value.has(id)) {\n        console.log(`: ${id}`);\n        const cachedDoc = documentCache.value.get(id);\n        \n        // \n        currentDoc.value = cachedDoc;\n        originalDoc.value = {\n          title: cachedDoc.title || '',\n          type: cachedDoc.type || '',\n          content: cachedDoc.content || ''\n        };\n        documentChanged.value = false;\n      }\n      \n      // \n      router.push({ name: 'SmartDocDetail', params: { id }, replace: true })\n    }\n    \n    // \n    const originalDoc = ref({ title: '', type: '', content: '' })\n    \n    const fetchDocumentDetail = async (id, retry = 0) => {\n      // \n      if (currentDoc.value && currentDoc.value.id === id && !loading.value) {\n        console.log(` ${id} `);\n        return;\n      }\n      \n      loading.value = true\n      try {\n        console.log(`ID: ${id}`)\n        const response = await getDocumentDetail(id)\n        console.log(':', response)\n        \n        if (response && response.data) {\n          // \n          if (!response.data.content) {\n            console.warn('')\n            response.data.content = ''\n          }\n          \n          // \n          currentDoc.value = response.data\n          \n          // \n          documentCache.value.set(id, { ...response.data });\n          \n          // \n          if (documentCache.value.size > 20) {\n            // 10\n            const entries = Array.from(documentCache.value.entries());\n            const recentEntries = entries.slice(-10);\n            documentCache.value = new Map(recentEntries);\n          }\n          \n          // \n          originalDoc.value = {\n            title: response.data.title || '',\n            type: response.data.type || '',\n            content: response.data.content || ''\n          }\n          \n          documentChanged.value = false\n          loading.value = false\n          \n          // \n          if (!currentDoc.value.content) {\n            console.warn('')\n            // \n            setTimeout(() => {\n              if (quillInstance.value && (!currentDoc.value.content || currentDoc.value.content.trim() === '')) {\n                ElMessage.warning('')\n              }\n            }, 2000)\n          }\n        } else {\n          throw new Error('')\n        }\n      } catch (error) {\n        console.error('', error)\n        \n        if (retry < 3) {\n          console.log(`${retry + 1}...`)\n          setTimeout(() => fetchDocumentDetail(id, retry + 1), 1000 * (retry + 1))\n        } else {\n          loading.value = false\n          console.error('', error)\n          const errorMsg = error.response && error.response.status === 404 \n            ? '' \n            : error.response && error.response.data && error.response.data.detail \n              ? error.response.data.detail \n              : ''\n          \n          ElMessage.error(errorMsg)\n          // 404\n          if (error.response && error.response.status === 404) {\n            router.push('/smartdoc')\n          }\n        }\n      }\n    }\n    \n    const saveDocument = async () => {\n      if (!currentDoc.value || !documentChanged.value) return\n      \n      saveLoading.value = true\n      try {\n        await updateDocument(currentDoc.value.id, {\n          title: currentDoc.value.title,\n          type: currentDoc.value.type,\n          content: currentDoc.value.content\n        })\n        \n        // \n        originalDoc.value = {\n          title: currentDoc.value.title,\n          type: currentDoc.value.type,\n          content: currentDoc.value.content\n        }\n        documentChanged.value = false\n        ElMessage.success('')\n      } catch (error) {\n        console.error('', error)\n        ElMessage.error('')\n      } finally {\n        saveLoading.value = false\n      }\n    }\n    \n    const toggleDocList = () => {\n      isDocListCollapsed.value = !isDocListCollapsed.value\n    }\n    \n    const toggleAssistant = () => {\n      isAssistantCollapsed.value = !isAssistantCollapsed.value\n    }\n    \n    const onEditorChange = () => {\n      documentChanged.value = true\n    }\n    \n    const openNewDocumentDialog = () => {\n      newDocumentForm.value = { title: '', type: '' }\n      newDocumentDialogVisible.value = true\n    }\n    \n    const createNewDocument = async () => {\n      if (!documentFormRef.value) return\n      \n      await documentFormRef.value.validate(async (valid) => {\n        if (valid) {\n          createLoading.value = true\n          try {\n            const response = await createDocument({\n              title: newDocumentForm.value.title,\n              type: newDocumentForm.value.type || '',\n              content: ''\n            })\n            \n            ElMessage.success('')\n            newDocumentDialogVisible.value = false\n            \n            // \n            await fetchDocuments()\n            router.push({ name: 'SmartDocDetail', params: { id: response.data.id } })\n      } catch (error) {\n            console.error('', error)\n            ElMessage.error('')\n          } finally {\n            createLoading.value = false\n          }\n        }\n      })\n    }\n    \n    const shareDocument = async () => {\n      if (!currentDoc.value) return\n      \n      // \n      shareLoading.value = true\n      \n      try {\n        // API\n        const result = await userApi.getCompanyUsers()\n        \n        if (result.success && Array.isArray(result.data)) {\n          // ID\n          const currentUserJson = localStorage.getItem('user')\n          let currentUserId = null\n          if (currentUserJson) {\n            const currentUser = JSON.parse(currentUserJson)\n            currentUserId = currentUser.id\n          }\n          \n          // \n          availableUsers.value = result.data\n            .filter(user => user.id !== currentUserId)\n            .map(user => ({\n              id: user.id,\n              username: user.name || user.username || user.email || `${user.id}`\n            }))\n          \n          console.log(':', availableUsers.value)\n        } else {\n          ElMessage.warning(': ' + (result.message || ''))\n          availableUsers.value = []\n        }\n      } catch (error) {\n        console.error(':', error)\n        ElMessage.warning('')\n        availableUsers.value = []\n      } finally {\n        // \n        shareLoading.value = false\n        \n        // \n        shareMethod.value = 'permission'\n        shareFormat.value = 'pdf'\n        selectedUsers.value = []\n        selectedChatUsers.value = []\n        \n        // \n        shareDialogVisible.value = true\n      }\n    }\n    \n    const confirmShare = async () => {\n      // \n      if (shareMethod.value === 'permission') {\n        if (!currentDoc.value || selectedUsers.value.length === 0) {\n          ElMessage.warning('')\n          return\n        }\n        \n        shareLoading.value = true\n        try {\n          await apiShareDocument(currentDoc.value.id, selectedUsers.value)\n          ElMessage.success('')\n          shareDialogVisible.value = false\n        } catch (error) {\n          console.error('', error)\n          ElMessage.error('')\n        } finally {\n          shareLoading.value = false\n        }\n      } \n      // \n      else if (shareMethod.value === 'chat') {\n        if (!currentDoc.value || selectedChatUsers.value.length === 0) {\n          ElMessage.warning('')\n          return\n        }\n        \n        shareLoading.value = true\n        try {\n          // \n          const currentUserJson = localStorage.getItem('user')\n          let currentUserId = null\n          if (currentUserJson) {\n            const currentUser = JSON.parse(currentUserJson)\n            currentUserId = currentUser.id\n          }\n          \n          if (!currentUserId) {\n            ElMessage.error('')\n            shareLoading.value = false\n            return\n          }\n          \n          // \n          const loading = ElLoading.service({\n            lock: true,\n            text: `${shareFormat.value === 'pdf' ? 'PDF' : 'Word'}...`,\n            background: 'rgba(255, 255, 255, 0.7)'\n          });\n          \n          try {\n            // \n            const docTitle = currentDoc.value.title || '';\n            const documentContent = currentDoc.value.content;\n            \n            // \n            const tempContainer = document.createElement('div');\n            tempContainer.innerHTML = documentContent;\n            tempContainer.className = 'temp-export-container';\n            document.body.appendChild(tempContainer);\n            \n            let documentFile = null;\n            let fileName = docTitle;\n            let fileType = '';\n            \n            if (shareFormat.value === 'pdf') {\n              fileName += '.pdf';\n              fileType = 'application/pdf';\n              \n              loading.setText('PDF...');\n              \n              // html2pdf.js\n              const html2pdfModule = await import('html2pdf.js');\n              const html2pdf = html2pdfModule.default;\n              \n              const options = {\n                margin: [15, 15, 15, 15],\n                filename: fileName,\n                image: { type: 'jpeg', quality: 0.98 },\n                html2canvas: { scale: 2, useCORS: true },\n                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }\n              };\n              \n              // PDFBlob\n              documentFile = await html2pdf().from(tempContainer).set(options).outputPdf('blob');\n            }\n            else {\n              fileName += '.doc';\n              fileType = 'application/msword';\n              \n              loading.setText('Word...');\n              \n              // WordHTML\n              const msWordHtml = `\n                <html xmlns:o=\"urn:schemas-microsoft-com:office:office\" \n                      xmlns:w=\"urn:schemas-microsoft-com:office:word\" \n                      xmlns=\"http://www.w3.org/TR/REC-html40\">\n                <head>\n                  <meta charset=\"utf-8\">\n                  <title>${docTitle}</title>\n                  <style>\n                    body { font-family: SimSun, Arial, sans-serif; margin: 1cm; }\n                    img { max-width: 100%; height: auto; }\n                    p { margin: 0; padding: 0; }\n                    h1 { font-size: 18pt; }\n                    h2 { font-size: 16pt; }\n                    h3 { font-size: 14pt; }\n                    table { border-collapse: collapse; width: 100%; }\n                    td, th { border: 1px solid #000; padding: 5px; }\n                  </style>\n                </head>\n                <body>\n                  <h1>${docTitle}</h1>\n                  ${tempContainer.innerHTML}\n                </body>\n                </html>\n              `;\n              \n              // Blob\n              documentFile = new Blob([msWordHtml], { type: fileType });\n            }\n            \n            // \n            document.body.removeChild(tempContainer);\n            \n            // \n            loading.setText('...');\n            \n            // \n            const promises = selectedChatUsers.value.map(async (userId) => {\n              try {\n                // \n                const sessionsResponse = await getChatSessions();\n                let chatId = null;\n                \n                // \n                if (sessionsResponse && sessionsResponse.data && Array.isArray(sessionsResponse.data)) {\n                  // \n                  const existingSession = sessionsResponse.data.find(session => \n                    session.participants.length === 2 && \n                    session.participants.some(p => p.id === userId) &&\n                    session.participants.some(p => p.id === currentUserId)\n                  );\n                  if (existingSession) {\n                    chatId = existingSession.id;\n                    console.log(`: ${chatId}`);\n                  }\n                } else if (sessionsResponse && sessionsResponse.results && Array.isArray(sessionsResponse.results)) {\n                  // DRF\n                  const existingSession = sessionsResponse.results.find(session => \n                    session.participants.length === 2 && \n                    session.participants.some(p => p.id === userId) &&\n                    session.participants.some(p => p.id === currentUserId)\n                  );\n                  if (existingSession) {\n                    chatId = existingSession.id;\n                    console.log(`: ${chatId}`);\n                  }\n                }\n                \n                // \n                if (!chatId) {\n                  const sessionResponse = await createChatSession({\n                    participant_ids: [currentUserId, userId],\n                    title: ''\n                  });\n                  \n                  if (!sessionResponse || !sessionResponse.data || !sessionResponse.data.id) {\n                    console.error(':', sessionResponse);\n                    return false;\n                  }\n                  \n                  chatId = sessionResponse.data.id;\n                  console.log(`: ${chatId}`);\n                }\n                \n                // FormData\n                const formData = new FormData();\n                formData.append('chat', chatId);\n                formData.append('message_type', 'file');\n                formData.append('content', `${shareFormat.value === 'pdf' ? 'PDF' : 'Word'}: ${docTitle}`);\n                \n                // BlobFile\n                const file = new File([documentFile], fileName, { type: fileType });\n                formData.append('file', file);\n                \n                // \n                await request({\n                  url: '/api/chat/messages/',\n                  method: 'post',\n                  data: formData,\n                  headers: {\n                    'Content-Type': 'multipart/form-data'\n                  }\n                });\n                \n                return true;\n              } catch (error) {\n                console.error(` ${userId} :`, error);\n                return false;\n              }\n            });\n            \n            // \n            const results = await Promise.all(promises);\n            const successCount = results.filter(result => result).length;\n            \n            if (successCount > 0) {\n              ElMessage.success(` ${successCount} `);\n              shareDialogVisible.value = false;\n            } else {\n              ElMessage.error('');\n            }\n          } catch (error) {\n            console.error(':', error);\n            ElMessage.error('');\n          } finally {\n            loading.close();\n          }\n        } catch (error) {\n          console.error(':', error);\n          ElMessage.error('');\n        } finally {\n          shareLoading.value = false;\n        }\n      }\n    }\n    \n    const deleteDocument = () => {\n      if (!currentDoc.value) return\n      \n      deleteDialogVisible.value = true\n    }\n    \n    const confirmDelete = async () => {\n      if (!currentDoc.value) return\n      \n      deleteLoading.value = true\n      try {\n        // ID\n        const deletedDocId = currentDoc.value.id\n        \n        // API\n        await apiDeleteDocument(deletedDocId)\n        ElMessage.success('')\n        deleteDialogVisible.value = false\n        \n        console.log(`ID: ${deletedDocId}`)\n        \n        // \n        if (window.localStorage) {\n          try {\n            // \n            localStorage.removeItem(`doc_cache_${deletedDocId}`);\n            // \n            localStorage.removeItem(`doc_list_cache`);\n          } catch (e) {\n            console.error(':', e);\n          }\n        }\n        \n        // \n        currentDoc.value = null;\n        \n        // window.location.hrefrouter.replace\n        // \n        window.location.href = '/smartdoc?_refresh=' + new Date().getTime();\n      } catch (error) {\n        console.error('', error)\n        ElMessage.error('')\n      } finally {\n        deleteLoading.value = false\n      }\n    }\n    \n    const exportDocument = () => {\n      ElMessageBox({\n        title: '',\n        message: '',\n        showCancelButton: true,\n        confirmButtonText: 'PDF',\n        cancelButtonText: 'Word',\n        closeOnClickModal: true,\n        callback: (action) => {\n          if (action === 'confirm') {\n            exportToPdf()\n          } else if (action === 'cancel') {\n            exportToWord()\n          }\n        }\n      })\n    }\n    \n    // PDF\n    const exportToPdf = () => {\n      if (!currentDoc.value || !currentDoc.value.content) {\n        ElMessage.error('')\n        return\n      }\n      const docTitle = currentDoc.value.title || ''\n      const filename = `${docTitle}.pdf`\n      // quill\n      const editorDom = document.querySelector('.ql-editor')\n      if (!editorDom) {\n        ElMessage.error('')\n        return\n      }\n      const contentElement = editorDom.cloneNode(true)\n      const options = {\n        margin: [15, 15, 15, 15],\n        filename: filename,\n        image: { type: 'jpeg', quality: 0.98 },\n        html2canvas: { scale: 2, useCORS: true },\n        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }\n      }\n      const loading = ElLoading.service({\n        lock: true,\n        text: 'PDF...',\n        background: 'rgba(255, 255, 255, 0.7)'\n      })\n      import('html2pdf.js').then(html2pdfModule => {\n        const html2pdf = html2pdfModule.default\n        html2pdf().from(contentElement).set(options).save().then(() => {\n          loading.close()\n          ElMessage.success('PDF')\n        }).catch(error => {\n          console.error('PDF:', error)\n          loading.close()\n          ElMessage.error('PDF')\n        })\n      }).catch(error => {\n        console.error('html2pdf.js:', error)\n        loading.close()\n        ElMessage.error('PDF')\n      })\n    }\n    \n    // Word\n    const exportToWord = async () => {\n      if (!currentDoc.value || !currentDoc.value.content) {\n        ElMessage.error('')\n        return\n      }\n      \n      const docTitle = currentDoc.value.title || ''\n      const filename = `${docTitle}.doc`\n      \n      const loading = ElLoading.service({\n        lock: true,\n        text: 'Word...',\n        background: 'rgba(255, 255, 255, 0.7)'\n      })\n      \n      try {\n        // \n        const contentContainer = document.createElement('div')\n        contentContainer.innerHTML = currentDoc.value.content\n        // <img>\n        // WordHTML\n        const msWordHtml = `\n          <html xmlns:o=\"urn:schemas-microsoft-com:office:office\" \n                xmlns:w=\"urn:schemas-microsoft-com:office:word\" \n                xmlns=\"http://www.w3.org/TR/REC-html40\">\n          <head>\n            <meta charset=\"utf-8\">\n            <title>${docTitle}</title>\n            <style>\n              body { font-family: SimSun, Arial, sans-serif; margin: 1cm; }\n              img { max-width: 100%; height: auto; }\n              p { margin: 0; padding: 0; }\n              h1 { font-size: 18pt; }\n              h2 { font-size: 16pt; }\n              h3 { font-size: 14pt; }\n              table { border-collapse: collapse; width: 100%; }\n              td, th { border: 1px solid #000; padding: 5px; }\n            </style>\n          </head>\n          <body>\n            <h1>${docTitle}</h1>\n            ${contentContainer.innerHTML}\n          </body>\n          </html>\n        `\n        // file-saver\n        const FileSaver = await import('file-saver')\n        const saveAs = FileSaver.saveAs || FileSaver.default\n        const blob = new Blob([msWordHtml], { type: 'application/msword' })\n        saveAs(blob, filename)\n        loading.close()\n        ElMessage.success('Word')\n      } catch (error) {\n        console.error('Word:', error)\n        loading.close()\n        ElMessage.error(`Word: ${error.message || ''}`)\n      }\n    }\n    \n    const printDocument = () => {\n      ElMessage.info('')\n    }\n    \n    const addCollaborator = () => {\n      ElMessage.info('')\n    }\n    \n    const viewHistory = () => {\n      ElMessage.info('')\n    }\n    \n    // 1. setup\n    const quillSelection = ref(null);\n    const quillSelectedText = ref('');\n\n    // 2. Quillselection-change\n    const onSelectionChange = (range, oldRange, source) => {\n      console.log('selection-change:', range, 'source:', source);\n      if (!quillInstance.value) return;\n\n      // \n      if (source === 'api' && !range) {\n        return;\n      }\n\n      if (range && range.length > 0) {\n        const text = quillInstance.value.getText(range.index, range.length);\n        console.log(':', text);\n        quillSelectedText.value = text.trim();\n        quillSelection.value = { ...range }; // \n      } else {\n        console.log('');\n        quillSelectedText.value = '';\n        quillSelection.value = null;\n      }\n    };\n\n    // 1. \n    const MAX_AI_TEXT_LENGTH = 2000;\n\n    // \n    const getCurrentSelection = () => {\n      if (!quillInstance.value) return null;\n\n      let selection = quillInstance.value.getSelection();\n\n      // 0\n      if (!selection || selection.length === 0) {\n        if (quillSelection.value && quillSelection.value.length > 0) {\n          // \n          const textLength = quillInstance.value.getLength();\n          if (quillSelection.value.index + quillSelection.value.length <= textLength) {\n            selection = quillSelection.value;\n          }\n        }\n      }\n\n      return selection;\n    };\n\n    // \n    const safeSetSelection = (index, length = 0, source = 'api') => {\n      if (!quillInstance.value) return;\n\n      try {\n        const textLength = quillInstance.value.getLength();\n        const safeIndex = Math.max(0, Math.min(index, textLength - 1));\n        const safeLength = Math.max(0, Math.min(length, textLength - safeIndex));\n\n        quillInstance.value.setSelection(safeIndex, safeLength, source);\n      } catch (error) {\n        console.warn(':', error);\n      }\n    };\n\n    // 2. expandContent\n    const expandContent = async () => {\n      if (!currentDoc.value || expandLoading.value) return;\n      try {\n        expandLoading.value = true;\n        if (!quillInstance.value) {\n          ElMessage.error('');\n          expandLoading.value = false;\n          return;\n        }\n\n        // \n        const selection = getCurrentSelection();\n\n        let selectedText = '';\n        let range = null;\n        if (selection && selection.length > 0) {\n          range = { ...selection };\n          selectedText = quillInstance.value.getText(selection.index, selection.length).trim();\n        }\n        if (!selectedText) {\n          ElMessage.warning('');\n          expandLoading.value = false;\n          return;\n        }\n        if (selectedText.length > MAX_AI_TEXT_LENGTH) {\n          ElMessage.warning(`${MAX_AI_TEXT_LENGTH}`);\n          selectedText = selectedText.slice(0, MAX_AI_TEXT_LENGTH);\n        }\n        ElMessage.info('...');\n        const response = await apiExpandContent(currentDoc.value.id, {\n          selection: selectedText,\n          length: 'medium'\n        });\n        showCompareDialog({\n          title: '',\n          original: selectedText,\n          modified: response.data.content,\n          onApply: (finalContent) => {\n            if (\n              range &&\n              typeof range.index === 'number' &&\n              typeof range.length === 'number' &&\n              range.index >= 0 &&\n              range.length > 0\n            ) {\n              const quillLen = quillInstance.value.getLength();\n              let insertPos = range.index;\n              if (insertPos > quillLen) insertPos = quillLen - 1;\n\n              //  API \n              quillInstance.value.deleteText(insertPos, range.length, 'api');\n              quillInstance.value.insertText(insertPos, finalContent, 'api');\n\n              // \n              let selPos = insertPos + finalContent.length;\n              selPos = Math.max(0, Math.min(selPos, quillInstance.value.getLength()));\n\n              // \n              nextTick(() => {\n                safeSetSelection(selPos, 0, 'api');\n                documentChanged.value = true;\n                ElMessage.success('');\n                // \n                window.location.reload();\n              });\n            } else {\n              ElMessage.error('');\n            }\n          }\n        });\n      } catch (error) {\n        console.error('[] :', error);\n        if (error && error.response) {\n          ElMessage.error(': ' + (error.response.data.detail || error.message));\n        } else {\n          ElMessage.error('');\n        }\n      } finally {\n        expandLoading.value = false;\n      }\n    };\n\n    // 3. polishText\n    const polishText = async () => {\n      if (!currentDoc.value || polishLoading.value) return;\n      try {\n        polishLoading.value = true;\n        if (!quillInstance.value) {\n          ElMessage.error('');\n          polishLoading.value = false;\n          return;\n        }\n\n        // \n        const selection = getCurrentSelection();\n\n        let selectedText = '';\n        let range = null;\n        if (selection && selection.length > 0) {\n          range = { ...selection };\n          selectedText = quillInstance.value.getText(selection.index, selection.length).trim();\n        }\n        if (!selectedText) {\n          ElMessage.warning('');\n          polishLoading.value = false;\n          return;\n        }\n        if (selectedText.length > MAX_AI_TEXT_LENGTH) {\n          ElMessage.warning(`${MAX_AI_TEXT_LENGTH}`);\n          selectedText = selectedText.slice(0, MAX_AI_TEXT_LENGTH);\n        }\n        ElMessage.info('...');\n        const response = await apiPolishText(currentDoc.value.id, {\n          selection: selectedText,\n          style: 'professional'\n        });\n        showCompareDialog({\n          title: '',\n          original: selectedText,\n          modified: response.data.content,\n          onApply: (finalContent) => {\n            if (\n              range &&\n              typeof range.index === 'number' &&\n              typeof range.length === 'number' &&\n              range.index >= 0 &&\n              range.length > 0\n            ) {\n              const quillLen = quillInstance.value.getLength();\n              let insertPos = range.index;\n              if (insertPos > quillLen) insertPos = quillLen - 1;\n\n              //  API \n              quillInstance.value.deleteText(insertPos, range.length, 'api');\n              quillInstance.value.insertText(insertPos, finalContent, 'api');\n\n              // \n              let selPos = insertPos + finalContent.length;\n              selPos = Math.max(0, Math.min(selPos, quillInstance.value.getLength()));\n\n              // \n              nextTick(() => {\n                safeSetSelection(selPos, 0, 'api');\n                documentChanged.value = true;\n                ElMessage.success('');\n                // \n                window.location.reload();\n              });\n            } else {\n              ElMessage.error('');\n            }\n          }\n        });\n      } catch (error) {\n        console.error('[] :', error);\n        if (error && error.response) {\n          ElMessage.error(': ' + (error.response.data.detail || error.message));\n        } else {\n          ElMessage.error('');\n        }\n      } finally {\n        polishLoading.value = false;\n      }\n    };\n    \n    // \n    const compareDialogVisible = ref(false)\n    const compareDialogData = ref({\n      title: '',\n      original: '',\n      modified: '',\n      modifiedContent: '',\n      onApply: () => {}\n    })\n    \n    // \n    const showCompareDialog = (data) => {\n      compareDialogData.value = {\n        ...data,\n        modifiedContent: data.modified\n      };\n      compareDialogVisible.value = true;\n    }\n    \n    // \n    const applyCompareChanges = () => {\n      compareDialogData.value.onApply(compareDialogData.value.modifiedContent);\n      compareDialogVisible.value = false;\n    }\n    \n    // \n    const closeCompareDialog = () => {\n      compareDialogVisible.value = false\n    }\n    \n    // \n    const debouncedSearch = _.debounce(() => {\n      // \n    }, 300)\n    \n    const formatDate = (dateString) => {\n      const date = new Date(dateString)\n      const now = new Date()\n      \n      // \n      if (date.toDateString() === now.toDateString()) {\n        return date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })\n      }\n      \n      // \n      const yesterday = new Date(now)\n      yesterday.setDate(now.getDate() - 1)\n      if (date.toDateString() === yesterday.toDateString()) {\n        return ''\n      }\n      \n      // \n      const weekDays = ['', '', '', '', '', '', '']\n      const diffDays = Math.round((now - date) / (1000 * 60 * 60 * 24))\n      if (diffDays < 7) {\n        return weekDays[date.getDay()]\n      }\n      \n      // \n      return date.toLocaleDateString('zh-CN', { month: 'numeric', day: 'numeric' })\n    }\n    \n    // \n    watch(() => route.params.id, (newId, oldId) => {\n      console.log(`ID: ${oldId} -> ${newId}`)\n      if (newId) {\n        // ID\n        const idNum = Number(newId)\n        if (isNaN(idNum) || idNum <= 0 || !Number.isInteger(idNum)) {\n          ElMessage.error('ID')\n          router.push('/smartdoc')\n          return\n        }\n        \n        // ID\n        if (newId !== oldId) {\n          console.log(`ID: ${newId}`)\n          // \n          if (documentCache.value.has(newId)) {\n            console.log(`: ${newId}`);\n            currentDoc.value = documentCache.value.get(newId);\n            originalDoc.value = {\n              title: currentDoc.value.title || '',\n              type: currentDoc.value.type || '',\n              content: currentDoc.value.content || ''\n            };\n            documentChanged.value = false;\n            \n            // \n            setTimeout(() => {\n              fetchDocumentDetail(newId);\n            }, 500);\n          } else {\n            // \n            fetchDocumentDetail(newId);\n          }\n        }\n      } else {\n        currentDoc.value = null\n      }\n    }, { immediate: false }) // false\n    \n    // query\n    watch(() => route.query._refresh, (newVal) => {\n      if (newVal) {\n        console.log(':', newVal)\n        const docId = route.params.id\n        if (docId) {\n          console.log(':', docId)\n          fetchDocumentDetail(docId)\n        }\n        // \n        fetchDocuments()\n      }\n    })\n    \n    // \n    setInterval(() => {\n      if (documentChanged.value && currentDoc.value && !saveLoading.value) {\n        saveDocument()\n      }\n    }, 60000) // \n    \n    // \n    onMounted(() => {\n      console.log('')\n      \n      // ID\n      const docId = route.params.id\n      \n      // ID\n      if (docId) {\n        console.log('ID:', docId)\n        fetchDocumentDetail(docId).then(() => {\n          // \n          console.log('')\n          fetchDocuments().then(() => {\n            // \n            console.log('')\n            nextTick(() => {\n              scrollToActiveDocument();\n            });\n          });\n        });\n      } else {\n        // ID\n        console.log('ID')\n        fetchDocuments();\n      }\n    })\n    \n    // \n    const scrollToActiveDocument = () => {\n      try {\n        if (!currentDoc.value) return;\n        \n        // \n        const activeDoc = document.querySelector('.doc-item.active');\n        if (activeDoc) {\n          // scrollIntoView\n          activeDoc.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n        }\n      } catch (error) {\n        console.error(':', error);\n      }\n    }\n    \n    // \n    const onTitleChange = (val) => {\n      documentChanged.value = val !== originalDoc.value.title\n    }\n    const onTypeChange = (val) => {\n      documentChanged.value = val !== originalDoc.value.type\n    }\n    const onContentChange = () => {\n      // \n      if (currentDoc.value && originalDoc.value) {\n        // \n        const currentContent = currentDoc.value.content\n        const originalContent = originalDoc.value.content\n        documentChanged.value = currentContent !== originalContent\n      }\n      scrollQuillToBottom();\n    }\n    \n    // \n    const quillInstance = ref(null);\n\n    // 2. ready\n    const onEditorReady = (quill) => {\n      console.log('');\n      quillInstance.value = quill;\n      quill.on('selection-change', onSelectionChange);\n\n      // DOM\n      setTimeout(() => {\n        // \n        const toolbarTooltips = {\n          '.ql-bold': ' (Ctrl+B)',\n          '.ql-italic': ' (Ctrl+I)',\n          '.ql-underline': ' (Ctrl+U)',\n          '.ql-strike': '',\n          '.ql-blockquote': '',\n          '.ql-code-block': '',\n          '.ql-header[value=\"1\"]': '1',\n          '.ql-header[value=\"2\"]': '2',\n          '.ql-list[value=\"ordered\"]': '',\n          '.ql-list[value=\"bullet\"]': '',\n          '.ql-script[value=\"sub\"]': '',\n          '.ql-script[value=\"super\"]': '',\n          '.ql-indent[value=\"-1\"]': '',\n          '.ql-indent[value=\"+1\"]': '',\n          '.ql-direction': '',\n          '.ql-clean': '',\n          '.ql-link': '',\n          '.ql-image': '',\n          // Pickers (less specific selectors)\n          '.ql-size': '',\n          '.ql-header': '',\n          '.ql-color': '',\n          '.ql-background': '',\n          '.ql-font': '',\n          '.ql-align': '',\n        };\n\n        try {\n          const toolbar = quill.getModule('toolbar').container;\n          if (!toolbar) {\n            console.error(\"\");\n            return;\n          }\n          for (const selector in toolbarTooltips) {\n            const elements = toolbar.querySelectorAll(selector);\n            elements.forEach(el => {\n              // \n              if (!el.hasAttribute('title')) {\n                 el.title = toolbarTooltips[selector];\n              }\n            });\n          }\n        } catch (error) {\n          console.error(\":\", error);\n        }\n      }, 200); // 200\n    };\n    \n    //  - \n    function scrollQuillToBottom() {\n      if (quillInstance.value) {\n        // \n        const currentSelection = quillInstance.value.getSelection();\n\n        const container = quillInstance.value.root;\n        container.scrollTop = container.scrollHeight;\n\n        // \n        if (currentSelection && currentSelection.length > 0) {\n          //  nextTick \n          nextTick(() => {\n            try {\n              quillInstance.value.setSelection(currentSelection.index, currentSelection.length);\n            } catch (error) {\n              console.warn(':', error);\n            }\n          });\n        }\n      }\n    }\n    \n    const grammarCheckText = async () => {\n      if (!currentDoc.value || grammarCheckLoading.value) return;\n      try {\n        grammarCheckLoading.value = true;\n        if (!quillInstance.value) {\n          ElMessage.error('');\n          grammarCheckLoading.value = false;\n          return;\n        }\n\n        // \n        const selection = getCurrentSelection();\n\n        let selectedText = '';\n        let range = null;\n        if (selection && selection.length > 0) {\n          range = { ...selection };\n          selectedText = quillInstance.value.getText(selection.index, selection.length).trim();\n        }\n        if (!selectedText) {\n          ElMessage.warning('');\n          grammarCheckLoading.value = false;\n          return;\n        }\n        if (selectedText.length > MAX_AI_TEXT_LENGTH) {\n          ElMessage.warning(`${MAX_AI_TEXT_LENGTH}`);\n          selectedText = selectedText.slice(0, MAX_AI_TEXT_LENGTH);\n        }\n        ElMessage.info('...');\n        const response = await grammarCheck(currentDoc.value.id, { selection: selectedText });\n        // \"\"mdhtml\n        let suggestions = response.suggestions || '';\n        suggestions = suggestions.replace(/\\*\\*\\*\\*[:]?([\\s\\S]*)$/, '').trim();\n        const suggestionsHtml = marked.parse(suggestions);\n\n        // \n        let correctedText = response.corrected || '';\n        const optimizedTextMatch = correctedText.match(/[:]([\\s\\S]*)/);\n        const finalCorrectedText = optimizedTextMatch ? optimizedTextMatch[1].trim() : correctedText;\n\n        showCompareDialog({\n          title: '',\n          original: selectedText,\n          modified: finalCorrectedText, // \n          suggestions: suggestionsHtml, // AIhtml\n          onApply: (finalContent) => {\n            if (\n              range &&\n              typeof range.index === 'number' &&\n              typeof range.length === 'number' &&\n              range.index >= 0 &&\n              range.length > 0\n            ) {\n              const quillLen = quillInstance.value.getLength();\n              let insertPos = range.index;\n              if (insertPos > quillLen) insertPos = quillLen - 1;\n\n              //  API \n              quillInstance.value.deleteText(insertPos, range.length, 'api');\n              quillInstance.value.insertText(insertPos, finalContent, 'api');\n\n              // \n              let selPos = insertPos + finalContent.length;\n              selPos = Math.max(0, Math.min(selPos, quillInstance.value.getLength()));\n\n              // \n              nextTick(() => {\n                safeSetSelection(selPos, 0, 'api');\n                documentChanged.value = true;\n                ElMessage.success('');\n                // \n                window.location.reload();\n              });\n            } else {\n              ElMessage.error('');\n            }\n          }\n        });\n      } catch (error) {\n        console.error('[] :', error);\n        if (error && error.response) {\n          ElMessage.error(': ' + (error.response.data.detail || error.message));\n        } else {\n          ElMessage.error('');\n        }\n      } finally {\n        grammarCheckLoading.value = false;\n      }\n    }\n    \n    // \n    const translateDialogVisible = ref(false)\n    const translateInput = ref('')\n    const translateResult = ref('')\n    const translateLoading = ref(false)\n    const targetLang = ref('en')\n    const translateModifiedContent = ref('')\n    const openTranslateDialog = () => {\n      if (!quillInstance.value) {\n        ElMessage.error('');\n        return;\n      }\n      // \n      translateResult.value = '';\n      translateModifiedContent.value = '';\n\n      // \n      const selection = getCurrentSelection();\n\n      if (selection && selection.length > 0) {\n        translateInput.value = quillInstance.value.getText(selection.index, selection.length).trim();\n      } else {\n        // \n        translateInput.value = '';\n      }\n\n      // \n      translateDialogVisible.value = true;\n    }\n    const doTranslate = async () => {\n      if (!currentDoc.value || !translateInput.value) return\n      translateLoading.value = true\n      try {\n        const res = await translateText(currentDoc.value.id, { selection: translateInput.value, target_lang: targetLang.value })\n        translateResult.value = res.translated\n        translateModifiedContent.value = res.translated\n      } catch (e) {\n        ElMessage.error('')\n      } finally {\n        translateLoading.value = false\n      }\n    }\n    const replaceSelectionWithTranslation = () => {\n      if (!quillInstance.value || !translateModifiedContent.value) return\n\n      // \n      const selection = getCurrentSelection();\n\n      if (selection && selection.length > 0) {\n        const quillLen = quillInstance.value.getLength()\n        let insertPos = selection.index\n        if (insertPos > quillLen) insertPos = quillLen - 1\n\n        //  API \n        quillInstance.value.deleteText(insertPos, selection.length, 'api')\n        quillInstance.value.clipboard.dangerouslyPasteHTML(insertPos, translateModifiedContent.value, 'api')\n\n        let selPos = insertPos + translateModifiedContent.value.replace(/<[^>]+>/g, '').length\n        if (selPos > quillInstance.value.getLength() - 1) selPos = quillInstance.value.getLength() - 1\n\n        // \n        nextTick(() => {\n          safeSetSelection(selPos, 0, 'api')\n          documentChanged.value = true\n          ElMessage.success('')\n          translateDialogVisible.value = false\n          // \n          window.location.reload();\n        });\n      } else {\n        // \n        const cursor = quillInstance.value.getSelection(true)\n        let insertPos = cursor ? cursor.index : quillInstance.value.getLength() - 1\n        quillInstance.value.insertEmbed(insertPos, 'text', translateModifiedContent.value, 'api')\n\n        nextTick(() => {\n          quillInstance.value.setSelection(insertPos + translateModifiedContent.value.replace(/<[^>]+>/g, '').length, 0, 'api')\n          documentChanged.value = true\n          ElMessage.success('')\n          translateDialogVisible.value = false\n          // \n          window.location.reload();\n        });\n      }\n    }\n\n    // \n    const qaDialogVisible = ref(false)\n    const qaQuestion = ref('')\n    const qaAnswer = ref('')\n    const qaLoading = ref(false)\n    \n    // MarkdownHTML\n    const qaAnswerHtml = computed(() => {\n      return qaAnswer.value ? marked.parse(qaAnswer.value) : ''\n    })\n    \n    const openQaDialog = () => {\n      qaDialogVisible.value = true\n      qaQuestion.value = ''\n      qaAnswer.value = ''\n    }\n    const doQa = async () => {\n      if (!currentDoc.value || !qaQuestion.value) return\n      qaLoading.value = true\n      try {\n        const res = await docQa(currentDoc.value.id, { question: qaQuestion.value, context: currentDoc.value.content })\n        qaAnswer.value = res.answer\n      } catch (e) {\n        ElMessage.error('')\n      } finally {\n        qaLoading.value = false\n      }\n    }\n    \n    // \n    const shareMethod = ref('permission') // permission()  chat()\n    const shareFormat = ref('pdf') // pdf  word\n    const selectedChatUsers = ref([]) // \n    \n    return {\n      documents,\n      currentDoc,\n      documentChanged,\n      isDocListCollapsed,\n      isAssistantCollapsed,\n      searchQuery,\n      docTypeFilter,\n      sortOption,\n      filteredDocuments,\n      newDocumentDialogVisible,\n      shareDialogVisible,\n      deleteDialogVisible,\n      selectedUsers,\n      availableUsers,\n      saveLoading,\n      createLoading,\n      shareLoading,\n      deleteLoading,\n      expandLoading,\n      polishLoading,\n      grammarCheckLoading,\n      newDocumentForm,\n      documentFormRules,\n      documentFormRef,\n      editorOptions,\n      fetchDocuments,\n      fetchDocumentDetail,\n      selectDocument,\n      saveDocument,\n      toggleDocList,\n      toggleAssistant,\n      onEditorChange,\n      openNewDocumentDialog,\n      createNewDocument,\n      shareDocument,\n      confirmShare,\n      deleteDocument,\n      confirmDelete,\n      exportDocument,\n      exportToPdf,\n      exportToWord,\n      printDocument,\n      addCollaborator,\n      viewHistory,\n      expandContent,\n      polishText,\n      debouncedSearch,\n      formatDate,\n      loading,\n      onTitleChange,\n      onTypeChange,\n      onContentChange,\n      onEditorReady,\n      compareDialogVisible,\n      compareDialogData,\n      showCompareDialog,\n      applyCompareChanges,\n      closeCompareDialog,\n      quillSelection,\n      quillSelectedText,\n      onSelectionChange,\n      quillInstance,\n      grammarCheckText,\n      translateDialogVisible,\n      translateInput,\n      translateResult,\n      translateLoading,\n      targetLang,\n      openTranslateDialog,\n      doTranslate,\n      qaDialogVisible,\n      qaQuestion,\n      qaAnswer,\n      qaLoading,\n      openQaDialog,\n      doQa,\n      qaAnswerHtml,\n      replaceSelectionWithTranslation,\n      translateModifiedContent,\n      documentsLoading,\n      documentCache,\n      scrollToActiveDocument,\n      goBack,\n      shareMethod,\n      shareFormat,\n      selectedChatUsers\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n/*  */\n.smart-doc-container {\n  height: 100%;\n  width: 100%;\n  display: flex;\n  overflow: hidden;\n  background-color: var(--el-bg-color-page);\n}\n\n.sidebar {\n  width: 260px;\n  height: 100%;\n  border-right: 1px solid var(--el-border-color-lighter);\n  background-color: var(--el-bg-color-overlay);\n  display: flex;\n  flex-direction: column;\n  transition: width 0.3s, transform 0.3s;\n  z-index: 10;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.sidebar.collapsed {\n  width: 50px;\n}\n\n.sidebar-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  border-bottom: 1px solid var(--el-border-color-lighter);\n  height: 48px;\n  box-sizing: border-box;\n  background-color: var(--el-bg-color);\n}\n\n.sidebar-header h4 {\n  margin: 0;\n  font-size: 16px;\n  font-weight: 600;\n  color: var(--el-text-color-primary);\n}\n\n.toggle-btn {\n  cursor: pointer;\n  width: 24px;\n  height: 24px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n}\n\n.toggle-btn:hover {\n  background-color: #f2f2f2;\n}\n\n.sidebar-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n.search-area {\n  padding: 16px;\n  border-bottom: 1px solid var(--el-border-color-lighter);\n}\n\n.filter-options {\n  display: flex;\n  gap: 8px;\n  margin-top: 10px;\n}\n\n.document-list-scrollbar {\n  flex: 1;\n  overflow-y: auto;\n}\n\n.document-list {\n  padding: 8px;\n}\n\n.doc-item {\n  border-radius: 6px;\n  cursor: pointer;\n  padding: 8px 12px;\n  margin-bottom: 8px;\n  display: flex;\n  align-items: center;\n  transition: background-color 0.2s;\n  background-color: var(--el-bg-color);\n}\n\n.doc-item:hover {\n  background-color: var(--el-fill-color-light);\n}\n\n.doc-item.active {\n  background-color: var(--el-color-primary-light-9);\n  border-left: 2px solid var(--el-color-primary);\n}\n\n.doc-icon {\n  color: var(--el-color-primary);\n  margin-right: 12px;\n}\n\n.doc-info {\n  flex: 1;\n  overflow: hidden;\n}\n\n.doc-info h5 {\n  margin: 0;\n  font-size: 14px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  font-weight: 550;\n  color: var(--el-text-color-primary);\n  letter-spacing: 0.2px;\n}\n\n.doc-meta {\n  display: flex;\n  justify-content: space-between;\n  font-size: 12px;\n  margin-top: 4px;\n  color: var(--el-text-color-secondary);\n}\n\n.action-buttons {\n  padding: 12px;\n  border-top: 1px solid #f0f0f0;\n}\n\n.action-buttons .el-button {\n  width: 100%;\n}\n\n.collapsed-sidebar {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 12px 0;\n  gap: 12px;\n  height: calc(100% - 48px);\n  overflow-y: auto;\n}\n\n.icon-btn {\n  width: 36px;\n  height: 36px;\n  border-radius: 4px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.icon-btn:hover {\n  background-color: #f2f2f2;\n}\n\n.icon-btn.doc-btn.active {\n  background-color: #ecf5ff;\n  color: #409eff;\n}\n\n.create-btn {\n  background-color: #ecf5ff;\n  color: #409eff;\n}\n\n.recent-docs {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  width: 100%;\n  align-items: center;\n}\n\n/*  */\n.main-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  min-width: 0;\n  height: 100%;\n  background-color: var(--el-bg-color-page);\n  position: relative;\n  /*  */\n  overflow: hidden;\n}\n\n.document-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  background-color: var(--el-bg-color-overlay);\n  height: 100%;\n  overflow: hidden;\n}\n\n/*  */\n.doc-title-label, .doc-type-label {\n  font-size: 14px;\n  font-weight: 600;\n  color: var(--el-text-color-primary);\n  white-space: nowrap;\n}\n\n.document-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 15px 20px;\n  border-bottom: 1px solid var(--el-border-color-lighter);\n  background-color: var(--el-bg-color);\n  height: 68px;\n  box-sizing: border-box;\n  width: 100%;\n  z-index: 5;\n}\n\n.header-left-actions {\n  margin-right: 15px;\n}\n\n.doc-info-area {\n  flex-grow: 1;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.doc-title {\n  width: 300px;\n}\n\n.doc-type-selector {\n  width: 150px;\n}\n\n.doc-actions {\n  display: flex;\n  gap: 8px;\n  z-index: 6; /*  */\n}\n\n.editor-area {\n  flex: 1;\n  background-color: var(--el-bg-color-overlay);\n  height: 100%;\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  box-sizing: border-box;\n  padding: 0; /* padding */\n}\n\n.quill-editor {\n  flex: 1;\n  height: 100%;\n  background: var(--el-bg-color-overlay);\n  min-height: 0;\n  box-sizing: border-box;\n}\n\n.quill-editor :deep(.ql-container) {\n  flex: 1;\n  height: 100% !important;\n  min-height: 0 !important;\n  overflow-y: auto !important;\n  background: var(--el-bg-color-overlay) !important;\n  box-sizing: border-box;\n}\n\n.quill-editor :deep(.ql-editor) {\n  flex: 1;\n  min-height: 0 !important;\n  height: 100% !important;\n  overflow-y: auto !important;\n  background: var(--el-bg-color-overlay) !important;\n  padding: 15px;\n  box-sizing: border-box;\n  color: var(--el-text-color-primary);\n}\n\n.empty-doc-state {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: var(--el-bg-color-overlay);\n}\n\n/*  */\n.assistant-panel {\n  width: 280px;\n  height: 100%;\n  border-left: 1px solid var(--el-border-color-lighter);\n  background-color: var(--el-bg-color-overlay);\n  display: flex;\n  flex-direction: column;\n  transition: width 0.3s;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.assistant-panel.collapsed {\n  width: 50px;\n}\n\n.assistant-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  border-bottom: 1px solid var(--el-border-color-lighter);\n  height: 48px;\n  box-sizing: border-box;\n}\n\n.assistant-header h5 {\n  margin: 0;\n  font-size: 16px;\n  font-weight: 600;\n}\n\n.assistant-body {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  overflow-y: auto;\n  padding: 16px;\n}\n\n.ai-features-beauty {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 28px;\n  margin-top: 30px;\n}\n\n.ai-feature-card {\n  width: 100%;\n  max-width: 320px;\n  background: var(--el-bg-color-overlay);\n  border-radius: 12px;\n  box-shadow: 0 2px 8px rgba(80,120,200,0.06);\n  padding: 18px 20px 10px 20px;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  transition: box-shadow 0.2s;\n  border: 1px solid var(--el-border-color-lighter);\n}\n\n.ai-feature-card:hover {\n  box-shadow: 0 4px 16px rgba(80,120,200,0.13);\n}\n\n.ai-feature-btn {\n  width: 100%;\n  height: 48px;\n  font-size: 17px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 8px;\n  margin-bottom: 6px;\n  transition: background 0.2s, color 0.2s;\n}\n\n.ai-feature-desc {\n  font-size: 13px;\n  color: #7a8599;\n  text-align: center;\n  margin-top: 2px;\n  margin-bottom: 2px;\n  line-height: 1.6;\n}\n\n.context-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 10px;\n}\n\n.warning-text {\n  color: #f56c6c;\n  font-weight: 500;\n}\n\n.compare-content {\n  flex: 1;\n  display: flex;\n  gap: 20px;\n  overflow: hidden;\n}\n\n.original-content, .modified-content {\n  flex: 1;\n  min-width: 350px;\n  max-width: 50%;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n  background: #fff;\n}\n\n.original-content h6, .modified-content h6 {\n  margin: 0;\n  padding: 10px;\n  font-size: 14px;\n  font-weight: 600;\n  background-color: #eef2f6;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.content-box {\n  padding: 15px;\n  overflow-y: auto;\n  white-space: pre-wrap;\n  flex: 1;\n  font-size: 14px;\n  line-height: 1.6;\n  max-height: 50vh;\n  border: 1px solid #e0e0e0;\n  background-color: #fff;\n}\n\n.compare-dialog :deep(.el-dialog__body) {\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  max-height: 60vh;\n  height: 60vh;\n  overflow: hidden;\n  background-color: var(--el-bg-color) !important;\n}\n\n.compare-dialog :deep(.el-dialog__header) {\n  padding: 15px 20px;\n  background-color: var(--el-bg-color) !important;\n}\n\n.compare-dialog :deep(.el-dialog__footer) {\n  padding: 10px 20px;\n  background-color: var(--el-bg-color) !important;\n}\n\n.compare-dialog :deep(.el-dialog) {\n  max-height: 85vh; /*  */\n  display: flex;\n  flex-direction: column;\n  margin: 0 auto !important;\n  overflow: hidden; /*  */\n  background-color: var(--el-bg-color) !important;\n}\n\n/*  */\n.compare-dialog :deep(.el-dialog__body) {\n  padding: 20px;\n  flex: 1;\n  overflow: auto;\n  max-height: calc(85vh - 110px); /*  */\n  height: auto;\n  display: flex;\n  flex-direction: column;\n}\n\n.dialog-container {\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  height: 100%;\n  overflow: visible;\n}\n\n.quill-editor-in-dialog {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  overflow: hidden;\n}\n\n.quill-editor-in-dialog :deep(.ql-toolbar) {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: #fff;\n}\n\n.quill-editor-in-dialog :deep(.ql-container) {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  height: 100% !important;\n  overflow-y: auto !important;\n  background: var(--el-bg-color-overlay) !important;\n}\n\n.quill-editor-in-dialog :deep(.ql-editor) {\n  flex: 1;\n  min-height: 0 !important;\n  height: 100% !important;\n  overflow-y: auto !important;\n  background: var(--el-bg-color-overlay) !important;\n  padding: 15px;\n}\n\n.document-count {\n  text-align: center;\n  padding: 12px;\n  color: #909399;\n  font-size: 13px;\n  border-top: 1px dashed #e6e6e6;\n  margin-top: 10px;\n}\n\n.loading-state {\n  padding: 10px;\n  min-height: 200px;\n}\n\n.empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  min-height: 200px;\n  padding: 20px;\n  text-align: center;\n  color: #909399;\n}\n\n.collapsed-assistant {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 12px 0;\n  gap: 12px;\n  height: calc(100% - 48px);\n  overflow-y: auto;\n}\n\n.icon-btn.disabled {\n  color: #a8abb2;\n  cursor: not-allowed;\n}\n\n.icon-btn.disabled:hover {\n  background-color: transparent;\n}\n\n.collapsed-assistant .icon-btn {\n  border-radius: 50%;\n  color: #606266;\n  background-color: #f7f7f7;\n  border: 1px solid #e9e9eb;\n  transition: all 0.2s ease-in-out;\n}\n\n.collapsed-assistant .icon-btn:hover {\n  background-color: #409eff;\n  color: white;\n  transform: translateY(-2px);\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n  border-color: #409eff;\n}\n\n.collapsed-assistant .icon-btn.disabled {\n  color: #c0c4cc;\n  background-color: #f9f9f9;\n  border-color: #f0f0f0;\n}\n\n.collapsed-assistant .icon-btn.disabled:hover {\n  background-color: #f9f9f9;\n  color: #c0c4cc;\n  transform: none;\n  box-shadow: none;\n  border-color: #f0f0f0;\n  cursor: not-allowed;\n}\n</style>\n\n<style>\n/* Markdown  */\n.el-alert__content div {\n  max-height: 400px;\n  overflow-y: auto;\n  padding-right: 8px;\n}\n\n/* Markdown  */\n.el-alert__content div h1,\n.el-alert__content div h2,\n.el-alert__content div h3,\n.el-alert__content div h4,\n.el-alert__content div h5,\n.el-alert__content div h6 {\n  margin-top: 16px;\n  margin-bottom: 8px;\n  font-weight: 600;\n}\n\n.el-alert__content div h1 { font-size: 1.5em; }\n.el-alert__content div h2 { font-size: 1.3em; }\n.el-alert__content div h3 { font-size: 1.2em; }\n\n.el-alert__content div p {\n  margin-bottom: 12px;\n  line-height: 1.6;\n}\n\n.el-alert__content div ul,\n.el-alert__content div ol {\n  padding-left: 20px;\n  margin-bottom: 12px;\n}\n\n.el-alert__content div li {\n  margin-bottom: 4px;\n}\n\n.el-alert__content div code {\n  background-color: #f0f0f0;\n  padding: 2px 4px;\n  border-radius: 3px;\n  font-family: monospace;\n  font-size: 0.9em;\n}\n\n.el-alert__content div pre {\n  background-color: #f5f5f5;\n  padding: 12px;\n  border-radius: 4px;\n  overflow-x: auto;\n  margin-bottom: 12px;\n}\n\n.el-alert__content div pre code {\n  background-color: transparent;\n  padding: 0;\n  border-radius: 0;\n  display: block;\n  white-space: pre;\n}\n\n.el-alert__content div blockquote {\n  border-left: 4px solid #ddd;\n  padding-left: 12px;\n  color: #666;\n  margin: 0 0 12px;\n}\n\n.el-alert__content div table {\n  border-collapse: collapse;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.el-alert__content div th,\n.el-alert__content div td {\n  border: 1px solid #ddd;\n  padding: 8px;\n  text-align: left;\n}\n\n.el-alert__content div th {\n  background-color: #f2f2f2;\n}\n\n.el-alert__content div a {\n  color: #409eff;\n  text-decoration: none;\n}\n\n.el-alert__content div a:hover {\n  text-decoration: underline;\n}\n\n.el-alert__content div img {\n  max-width: 100%;\n  height: auto;\n}\n\n/* Quill */\nbody[data-theme=\"dark\"] .ql-toolbar,\nbody[data-theme=\"dark\"] .ql-container,\nbody[data-theme=\"dark\"] .ql-editor {\n  border-color: var(--el-border-color-lighter) !important;\n  background-color: var(--el-bg-color) !important;\n  color: var(--el-text-color-primary) !important;\n}\n\nbody[data-theme=\"dark\"] .ql-snow .ql-stroke {\n  stroke: var(--el-text-color-regular) !important;\n}\n\nbody[data-theme=\"dark\"] .ql-snow .ql-fill {\n  fill: var(--el-text-color-regular) !important;\n}\n\nbody[data-theme=\"dark\"] .ql-snow .ql-picker {\n  color: var(--el-text-color-primary) !important;\n}\n\nbody[data-theme=\"dark\"] .ql-snow .ql-picker-options {\n  background-color: var(--el-bg-color) !important;\n  color: var(--el-text-color-primary) !important;\n}\n\n/* Markdown */\nbody[data-theme=\"dark\"] .el-alert__content div code {\n  background-color: var(--el-fill-color) !important;\n  color: var(--el-text-color-primary) !important;\n}\n\nbody[data-theme=\"dark\"] .el-alert__content div pre {\n  background-color: var(--el-fill-color-light) !important;\n}\n\nbody[data-theme=\"dark\"] .el-alert__content div th {\n  background-color: var(--el-fill-color) !important;\n}\n\nbody[data-theme=\"dark\"] .el-alert__content div blockquote {\n  border-color: var(--el-border-color) !important;\n  color: var(--el-text-color-secondary) !important;\n}\n\nbody[data-theme=\"dark\"] .el-alert__content div a {\n  color: var(--el-color-primary) !important;\n}\n\n/*  */\nbody[data-theme=\"dark\"] .smart-doc-container {\n  background-color: var(--el-bg-color-page) !important;\n}\n\nbody[data-theme=\"dark\"] .document-content,\nbody[data-theme=\"dark\"] .editor-area,\nbody[data-theme=\"dark\"] .original-content,\nbody[data-theme=\"dark\"] .modified-content {\n  background-color: var(--el-bg-color) !important;\n  color: var(--el-text-color-primary) !important;\n}\n\nbody[data-theme=\"dark\"] .ai-feature-card {\n  background-color: var(--el-bg-color) !important;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;\n}\n\nbody[data-theme=\"dark\"] .ai-feature-desc {\n  color: var(--el-text-color-secondary) !important;\n}\n\nbody[data-theme=\"dark\"] .document-header {\n  background-color: var(--el-bg-color) !important;\n  border-color: var(--el-border-color-lighter) !important;\n}\n\nbody[data-theme=\"dark\"] .doc-title-label,\nbody[data-theme=\"dark\"] .doc-type-label {\n  color: var(--el-text-color-primary) !important;\n}\n\n/*  */\nbody[data-theme=\"dark\"] .el-dialog,\nbody[data-theme=\"dark\"] .el-dialog__header,\nbody[data-theme=\"dark\"] .el-dialog__body,\nbody[data-theme=\"dark\"] .el-dialog__footer {\n  background-color: var(--el-bg-color) !important;\n  color: var(--el-text-color-primary) !important;\n}\n\n/* AI */\nbody[data-theme=\"dark\"] .ai-features-beauty .ai-feature-card {\n  background-color: var(--el-bg-color) !important;\n  border: 1px solid var(--el-border-color-lighter) !important;\n}\n\n/*  */\nbody[data-theme=\"dark\"] .original-content h6, \nbody[data-theme=\"dark\"] .modified-content h6, \nbody[data-theme=\"dark\"] .compare-content .quill-editor-in-dialog,\nbody[data-theme=\"dark\"] .compare-content .quill-editor-in-dialog .ql-toolbar,\nbody[data-theme=\"dark\"] .compare-content .quill-editor-in-dialog .ql-container,\nbody[data-theme=\"dark\"] .compare-content .quill-editor-in-dialog .ql-editor {\n  background-color: var(--el-bg-color) !important;\n  color: var(--el-text-color-primary) !important;\n  border-color: var(--el-border-color-lighter) !important;\n}\n\n/* #f9f9f9 */\nbody[data-theme=\"dark\"] [style*=\"background:#f9f9f9\"],\nbody[data-theme=\"dark\"] [style*=\"background: #f9f9f9\"],\nbody[data-theme=\"dark\"] [style*=\"background-color:#f9f9f9\"],\nbody[data-theme=\"dark\"] [style*=\"background-color: #f9f9f9\"] {\n  background: var(--el-bg-color) !important;\n  background-color: var(--el-bg-color) !important;\n}\n\n/* #eef2f6 */\nbody[data-theme=\"dark\"] .original-content h6,\nbody[data-theme=\"dark\"] .modified-content h6 {\n  background-color: var(--el-fill-color-light) !important;\n}\n\n/*  */\nbody[data-theme=\"dark\"] .sidebar {\n  font-family: 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n  -webkit-font-smoothing: antialiased !important;\n  -moz-osx-font-smoothing: grayscale !important;\n}\n\nbody[data-theme=\"dark\"] .doc-info h5,\nbody[data-theme=\"dark\"] .doc-meta span,\nbody[data-theme=\"dark\"] .sidebar-header h4,\nbody[data-theme=\"dark\"] .doc-title-label,\nbody[data-theme=\"dark\"] .doc-type-label {\n  font-weight: 600 !important; \n  letter-spacing: 0.3px !important;\n}\n\n/*  */\nbody[data-theme=\"dark\"] .smartdoc-detail .el-dialog .ql-editor,\nbody[data-theme=\"dark\"] .smartdoc-detail .compare-dialog .ql-editor,\nbody[data-theme=\"dark\"] .smartdoc-detail .el-dialog .ql-container,\nbody[data-theme=\"dark\"] .smartdoc-detail .compare-dialog .ql-container,\nbody[data-theme=\"dark\"] .smartdoc-detail .el-dialog .ql-toolbar,\nbody[data-theme=\"dark\"] .smartdoc-detail .compare-dialog .ql-toolbar {\n  background-color: var(--el-bg-color) !important;\n  color: var(--el-text-color-primary) !important;\n}\n\n/* style */\nbody[data-theme=\"dark\"] .smartdoc-detail [style*=\"background:\"] {\n  background: var(--el-bg-color) !important;\n}\n\nbody[data-theme=\"dark\"] .smartdoc-detail [style*=\"background-color:\"] {\n  background-color: var(--el-bg-color) !important;\n}\n\n/* AI */\nbody[data-theme=\"dark\"] .ai-feature-card {\n  background-color: var(--el-bg-color) !important;\n  border: 1px solid var(--el-border-color-lighter) !important;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;\n}\n\n/*  */\nbody[data-theme=\"dark\"] .quill-editor-in-dialog[style*=\"background:#f9f9f9\"],\nbody[data-theme=\"dark\"] .quill-editor-in-dialog[style*=\"background: #f9f9f9\"] {\n  background: var(--el-bg-color) !important;\n  background-color: var(--el-bg-color) !important;\n}\n\n/*  */\nbody[data-theme=\"dark\"] .smartdoc-detail .document-content {\n  background-color: var(--el-bg-color) !important;\n}\n\n/*  */\nbody[data-theme=\"dark\"] .sidebar .doc-info h5 {\n  text-shadow: 0px 0px 0.5px rgba(255, 255, 255, 0.2);\n  font-weight: 600;\n}\n\n/*  */\nbody[data-theme=\"dark\"] .dark-content,\nbody[data-theme=\"dark\"] .dark-content .ql-toolbar,\nbody[data-theme=\"dark\"] .dark-content .ql-container,\nbody[data-theme=\"dark\"] .dark-content .ql-editor {\n  background-color: var(--el-bg-color) !important;\n  color: var(--el-text-color-primary) !important;\n  border-color: var(--el-border-color-lighter) !important;\n}\n\n/*  */\nbody[data-theme=\"dark\"] .original-content h6,\nbody[data-theme=\"dark\"] .modified-content h6 {\n  background-color: var(--el-fill-color-light) !important;\n  color: var(--el-text-color-primary) !important;\n}\n\n/*  */\nbody[data-theme=\"dark\"] .ai-feature-card:nth-child(4) .ai-feature-btn {\n  background-color: #50a1ff !important; /*  */\n  border-color: #50a1ff !important;\n  color: white !important;\n  box-shadow: 0 2px 6px rgba(100, 150, 255, 0.2) !important;\n}\n\nbody[data-theme=\"dark\"] .ai-feature-card:nth-child(5) .ai-feature-btn {\n  background-color: #67c23a !important; /*  */\n  border-color: #67c23a !important;\n  color: white !important;\n  box-shadow: 0 2px 6px rgba(103, 194, 58, 0.2) !important;\n}\n\n/*  */\nbody[data-theme=\"dark\"] .collapsed-assistant .icon-btn:nth-child(4),\nbody[data-theme=\"dark\"] .collapsed-assistant .icon-btn:nth-child(5) {\n  background-color: var(--el-color-primary-light-5) !important;\n  color: white !important;\n  border-color: transparent !important;\n}\n\n/*  */\nbody[data-theme=\"dark\"] .smartdoc-detail .ai-features-beauty .ai-feature-card:nth-child(4) .ai-feature-btn {\n  background-color: #50a1ff !important; /*  */\n  border-color: #50a1ff !important;\n  color: white !important;\n  box-shadow: 0 2px 6px rgba(100, 150, 255, 0.2) !important;\n}\n\nbody[data-theme=\"dark\"] .smartdoc-detail .ai-features-beauty .ai-feature-card:nth-child(5) .ai-feature-btn {\n  background-color: #67c23a !important; /*  */\n  border-color: #67c23a !important;\n  color: white !important;\n  box-shadow: 0 2px 6px rgba(103, 194, 58, 0.2) !important;\n}\n\n/*  */\nhtml body[data-theme=\"dark\"] .smartdoc-detail .ai-feature-card:nth-child(4) .ai-feature-btn.el-button--info,\nhtml body[data-theme=\"dark\"] #app .ai-feature-card:nth-child(4) .ai-feature-btn[type=\"info\"] {\n  background-color: #50a1ff !important;\n  border-color: #50a1ff !important;\n  color: white !important;\n}\n\nhtml body[data-theme=\"dark\"] .smartdoc-detail .ai-feature-card:nth-child(5) .ai-feature-btn.el-button--success,\nhtml body[data-theme=\"dark\"] #app .ai-feature-card:nth-child(5) .ai-feature-btn[type=\"success\"] {\n  background-color: #67c23a !important;\n  border-color: #67c23a !important;\n  color: white !important;\n}\n\n/*  */\nhtml body[data-theme=\"dark\"] .smartdoc-detail .collapsed-assistant .icon-btn:nth-child(4),\nhtml body[data-theme=\"dark\"] .smartdoc-detail .collapsed-assistant .icon-btn:nth-child(5) {\n  background-color: var(--el-color-primary-light-5) !important;\n  color: white !important;\n  border-color: transparent !important;\n}\n</style> "],"mappings":"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","ignoreList":[]}]}