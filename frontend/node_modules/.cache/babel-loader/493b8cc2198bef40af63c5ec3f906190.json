{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\quill\\modules\\history.js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\quill\\modules\\history.js","mtime":1751792162046},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJDOi9Vc2Vycy8xODA4My9EZXNrdG9wL0NDSVQvb2ZmaWNlL3NtYXJ0LW9mZmljZS9mcm9udGVuZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5yZWR1Y2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5zb21lLmpzIjsKaW1wb3J0IHsgU2NvcGUgfSBmcm9tICdwYXJjaG1lbnQnOwppbXBvcnQgTW9kdWxlIGZyb20gJy4uL2NvcmUvbW9kdWxlLmpzJzsKaW1wb3J0IFF1aWxsIGZyb20gJy4uL2NvcmUvcXVpbGwuanMnOwpjbGFzcyBIaXN0b3J5IGV4dGVuZHMgTW9kdWxlIHsKICBjb25zdHJ1Y3RvcihxdWlsbCwgb3B0aW9ucykgewogICAgc3VwZXIocXVpbGwsIG9wdGlvbnMpOwogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJsYXN0UmVjb3JkZWQiLCAwKTsKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiaWdub3JlQ2hhbmdlIiwgZmFsc2UpOwogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJzdGFjayIsIHsKICAgICAgdW5kbzogW10sCiAgICAgIHJlZG86IFtdCiAgICB9KTsKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiY3VycmVudFJhbmdlIiwgbnVsbCk7CiAgICB0aGlzLnF1aWxsLm9uKFF1aWxsLmV2ZW50cy5FRElUT1JfQ0hBTkdFLCAoZXZlbnROYW1lLCB2YWx1ZSwgb2xkVmFsdWUsIHNvdXJjZSkgPT4gewogICAgICBpZiAoZXZlbnROYW1lID09PSBRdWlsbC5ldmVudHMuU0VMRUNUSU9OX0NIQU5HRSkgewogICAgICAgIGlmICh2YWx1ZSAmJiBzb3VyY2UgIT09IFF1aWxsLnNvdXJjZXMuU0lMRU5UKSB7CiAgICAgICAgICB0aGlzLmN1cnJlbnRSYW5nZSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChldmVudE5hbWUgPT09IFF1aWxsLmV2ZW50cy5URVhUX0NIQU5HRSkgewogICAgICAgIGlmICghdGhpcy5pZ25vcmVDaGFuZ2UpIHsKICAgICAgICAgIGlmICghdGhpcy5vcHRpb25zLnVzZXJPbmx5IHx8IHNvdXJjZSA9PT0gUXVpbGwuc291cmNlcy5VU0VSKSB7CiAgICAgICAgICAgIHRoaXMucmVjb3JkKHZhbHVlLCBvbGRWYWx1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnRyYW5zZm9ybSh2YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMuY3VycmVudFJhbmdlID0gdHJhbnNmb3JtUmFuZ2UodGhpcy5jdXJyZW50UmFuZ2UsIHZhbHVlKTsKICAgICAgfQogICAgfSk7CiAgICB0aGlzLnF1aWxsLmtleWJvYXJkLmFkZEJpbmRpbmcoewogICAgICBrZXk6ICd6JywKICAgICAgc2hvcnRLZXk6IHRydWUKICAgIH0sIHRoaXMudW5kby5iaW5kKHRoaXMpKTsKICAgIHRoaXMucXVpbGwua2V5Ym9hcmQuYWRkQmluZGluZyh7CiAgICAgIGtleTogWyd6JywgJ1onXSwKICAgICAgc2hvcnRLZXk6IHRydWUsCiAgICAgIHNoaWZ0S2V5OiB0cnVlCiAgICB9LCB0aGlzLnJlZG8uYmluZCh0aGlzKSk7CiAgICBpZiAoL1dpbi9pLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKSkgewogICAgICB0aGlzLnF1aWxsLmtleWJvYXJkLmFkZEJpbmRpbmcoewogICAgICAgIGtleTogJ3knLAogICAgICAgIHNob3J0S2V5OiB0cnVlCiAgICAgIH0sIHRoaXMucmVkby5iaW5kKHRoaXMpKTsKICAgIH0KICAgIHRoaXMucXVpbGwucm9vdC5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmVpbnB1dCcsIGV2ZW50ID0+IHsKICAgICAgaWYgKGV2ZW50LmlucHV0VHlwZSA9PT0gJ2hpc3RvcnlVbmRvJykgewogICAgICAgIHRoaXMudW5kbygpOwogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0gZWxzZSBpZiAoZXZlbnQuaW5wdXRUeXBlID09PSAnaGlzdG9yeVJlZG8nKSB7CiAgICAgICAgdGhpcy5yZWRvKCk7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgfQogICAgfSk7CiAgfQogIGNoYW5nZShzb3VyY2UsIGRlc3QpIHsKICAgIGlmICh0aGlzLnN0YWNrW3NvdXJjZV0ubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICBjb25zdCBpdGVtID0gdGhpcy5zdGFja1tzb3VyY2VdLnBvcCgpOwogICAgaWYgKCFpdGVtKSByZXR1cm47CiAgICBjb25zdCBiYXNlID0gdGhpcy5xdWlsbC5nZXRDb250ZW50cygpOwogICAgY29uc3QgaW52ZXJzZURlbHRhID0gaXRlbS5kZWx0YS5pbnZlcnQoYmFzZSk7CiAgICB0aGlzLnN0YWNrW2Rlc3RdLnB1c2goewogICAgICBkZWx0YTogaW52ZXJzZURlbHRhLAogICAgICByYW5nZTogdHJhbnNmb3JtUmFuZ2UoaXRlbS5yYW5nZSwgaW52ZXJzZURlbHRhKQogICAgfSk7CiAgICB0aGlzLmxhc3RSZWNvcmRlZCA9IDA7CiAgICB0aGlzLmlnbm9yZUNoYW5nZSA9IHRydWU7CiAgICB0aGlzLnF1aWxsLnVwZGF0ZUNvbnRlbnRzKGl0ZW0uZGVsdGEsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICB0aGlzLmlnbm9yZUNoYW5nZSA9IGZhbHNlOwogICAgdGhpcy5yZXN0b3JlU2VsZWN0aW9uKGl0ZW0pOwogIH0KICBjbGVhcigpIHsKICAgIHRoaXMuc3RhY2sgPSB7CiAgICAgIHVuZG86IFtdLAogICAgICByZWRvOiBbXQogICAgfTsKICB9CiAgY3V0b2ZmKCkgewogICAgdGhpcy5sYXN0UmVjb3JkZWQgPSAwOwogIH0KICByZWNvcmQoY2hhbmdlRGVsdGEsIG9sZERlbHRhKSB7CiAgICBpZiAoY2hhbmdlRGVsdGEub3BzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwogICAgdGhpcy5zdGFjay5yZWRvID0gW107CiAgICBsZXQgdW5kb0RlbHRhID0gY2hhbmdlRGVsdGEuaW52ZXJ0KG9sZERlbHRhKTsKICAgIGxldCB1bmRvUmFuZ2UgPSB0aGlzLmN1cnJlbnRSYW5nZTsKICAgIGNvbnN0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7CiAgICBpZiAoCiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEZpeCBtZSBsYXRlcgogICAgdGhpcy5sYXN0UmVjb3JkZWQgKyB0aGlzLm9wdGlvbnMuZGVsYXkgPiB0aW1lc3RhbXAgJiYgdGhpcy5zdGFjay51bmRvLmxlbmd0aCA+IDApIHsKICAgICAgY29uc3QgaXRlbSA9IHRoaXMuc3RhY2sudW5kby5wb3AoKTsKICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICB1bmRvRGVsdGEgPSB1bmRvRGVsdGEuY29tcG9zZShpdGVtLmRlbHRhKTsKICAgICAgICB1bmRvUmFuZ2UgPSBpdGVtLnJhbmdlOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmxhc3RSZWNvcmRlZCA9IHRpbWVzdGFtcDsKICAgIH0KICAgIGlmICh1bmRvRGVsdGEubGVuZ3RoKCkgPT09IDApIHJldHVybjsKICAgIHRoaXMuc3RhY2sudW5kby5wdXNoKHsKICAgICAgZGVsdGE6IHVuZG9EZWx0YSwKICAgICAgcmFuZ2U6IHVuZG9SYW5nZQogICAgfSk7CiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEZpeCBtZSBsYXRlcgogICAgaWYgKHRoaXMuc3RhY2sudW5kby5sZW5ndGggPiB0aGlzLm9wdGlvbnMubWF4U3RhY2spIHsKICAgICAgdGhpcy5zdGFjay51bmRvLnNoaWZ0KCk7CiAgICB9CiAgfQogIHJlZG8oKSB7CiAgICB0aGlzLmNoYW5nZSgncmVkbycsICd1bmRvJyk7CiAgfQogIHRyYW5zZm9ybShkZWx0YSkgewogICAgdHJhbnNmb3JtU3RhY2sodGhpcy5zdGFjay51bmRvLCBkZWx0YSk7CiAgICB0cmFuc2Zvcm1TdGFjayh0aGlzLnN0YWNrLnJlZG8sIGRlbHRhKTsKICB9CiAgdW5kbygpIHsKICAgIHRoaXMuY2hhbmdlKCd1bmRvJywgJ3JlZG8nKTsKICB9CiAgcmVzdG9yZVNlbGVjdGlvbihzdGFja0l0ZW0pIHsKICAgIGlmIChzdGFja0l0ZW0ucmFuZ2UpIHsKICAgICAgdGhpcy5xdWlsbC5zZXRTZWxlY3Rpb24oc3RhY2tJdGVtLnJhbmdlLCBRdWlsbC5zb3VyY2VzLlVTRVIpOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgaW5kZXggPSBnZXRMYXN0Q2hhbmdlSW5kZXgodGhpcy5xdWlsbC5zY3JvbGwsIHN0YWNrSXRlbS5kZWx0YSk7CiAgICAgIHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKGluZGV4LCBRdWlsbC5zb3VyY2VzLlVTRVIpOwogICAgfQogIH0KfQpfZGVmaW5lUHJvcGVydHkoSGlzdG9yeSwgIkRFRkFVTFRTIiwgewogIGRlbGF5OiAxMDAwLAogIG1heFN0YWNrOiAxMDAsCiAgdXNlck9ubHk6IGZhbHNlCn0pOwpmdW5jdGlvbiB0cmFuc2Zvcm1TdGFjayhzdGFjaywgZGVsdGEpIHsKICBsZXQgcmVtb3RlRGVsdGEgPSBkZWx0YTsKICBmb3IgKGxldCBpID0gc3RhY2subGVuZ3RoIC0gMTsgaSA+PSAwOyBpIC09IDEpIHsKICAgIGNvbnN0IG9sZEl0ZW0gPSBzdGFja1tpXTsKICAgIHN0YWNrW2ldID0gewogICAgICBkZWx0YTogcmVtb3RlRGVsdGEudHJhbnNmb3JtKG9sZEl0ZW0uZGVsdGEsIHRydWUpLAogICAgICByYW5nZTogb2xkSXRlbS5yYW5nZSAmJiB0cmFuc2Zvcm1SYW5nZShvbGRJdGVtLnJhbmdlLCByZW1vdGVEZWx0YSkKICAgIH07CiAgICByZW1vdGVEZWx0YSA9IG9sZEl0ZW0uZGVsdGEudHJhbnNmb3JtKHJlbW90ZURlbHRhKTsKICAgIGlmIChzdGFja1tpXS5kZWx0YS5sZW5ndGgoKSA9PT0gMCkgewogICAgICBzdGFjay5zcGxpY2UoaSwgMSk7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGVuZHNXaXRoTmV3bGluZUNoYW5nZShzY3JvbGwsIGRlbHRhKSB7CiAgY29uc3QgbGFzdE9wID0gZGVsdGEub3BzW2RlbHRhLm9wcy5sZW5ndGggLSAxXTsKICBpZiAobGFzdE9wID09IG51bGwpIHJldHVybiBmYWxzZTsKICBpZiAobGFzdE9wLmluc2VydCAhPSBudWxsKSB7CiAgICByZXR1cm4gdHlwZW9mIGxhc3RPcC5pbnNlcnQgPT09ICdzdHJpbmcnICYmIGxhc3RPcC5pbnNlcnQuZW5kc1dpdGgoJ1xuJyk7CiAgfQogIGlmIChsYXN0T3AuYXR0cmlidXRlcyAhPSBudWxsKSB7CiAgICByZXR1cm4gT2JqZWN0LmtleXMobGFzdE9wLmF0dHJpYnV0ZXMpLnNvbWUoYXR0ciA9PiB7CiAgICAgIHJldHVybiBzY3JvbGwucXVlcnkoYXR0ciwgU2NvcGUuQkxPQ0spICE9IG51bGw7CiAgICB9KTsKICB9CiAgcmV0dXJuIGZhbHNlOwp9CmZ1bmN0aW9uIGdldExhc3RDaGFuZ2VJbmRleChzY3JvbGwsIGRlbHRhKSB7CiAgY29uc3QgZGVsZXRlTGVuZ3RoID0gZGVsdGEucmVkdWNlKChsZW5ndGgsIG9wKSA9PiB7CiAgICByZXR1cm4gbGVuZ3RoICsgKG9wLmRlbGV0ZSB8fCAwKTsKICB9LCAwKTsKICBsZXQgY2hhbmdlSW5kZXggPSBkZWx0YS5sZW5ndGgoKSAtIGRlbGV0ZUxlbmd0aDsKICBpZiAoZW5kc1dpdGhOZXdsaW5lQ2hhbmdlKHNjcm9sbCwgZGVsdGEpKSB7CiAgICBjaGFuZ2VJbmRleCAtPSAxOwogIH0KICByZXR1cm4gY2hhbmdlSW5kZXg7Cn0KZnVuY3Rpb24gdHJhbnNmb3JtUmFuZ2UocmFuZ2UsIGRlbHRhKSB7CiAgaWYgKCFyYW5nZSkgcmV0dXJuIHJhbmdlOwogIGNvbnN0IHN0YXJ0ID0gZGVsdGEudHJhbnNmb3JtUG9zaXRpb24ocmFuZ2UuaW5kZXgpOwogIGNvbnN0IGVuZCA9IGRlbHRhLnRyYW5zZm9ybVBvc2l0aW9uKHJhbmdlLmluZGV4ICsgcmFuZ2UubGVuZ3RoKTsKICByZXR1cm4gewogICAgaW5kZXg6IHN0YXJ0LAogICAgbGVuZ3RoOiBlbmQgLSBzdGFydAogIH07Cn0KZXhwb3J0IHsgSGlzdG9yeSBhcyBkZWZhdWx0LCBnZXRMYXN0Q2hhbmdlSW5kZXggfTs="},{"version":3,"names":["Scope","Module","Quill","History","constructor","quill","options","_defineProperty","undo","redo","on","events","EDITOR_CHANGE","eventName","value","oldValue","source","SELECTION_CHANGE","sources","SILENT","currentRange","TEXT_CHANGE","ignoreChange","userOnly","USER","record","transform","transformRange","keyboard","addBinding","key","shortKey","bind","shiftKey","test","navigator","platform","root","addEventListener","event","inputType","preventDefault","change","dest","stack","length","item","pop","base","getContents","inverseDelta","delta","invert","push","range","lastRecorded","updateContents","restoreSelection","clear","cutoff","changeDelta","oldDelta","ops","undoDelta","undoRange","timestamp","Date","now","delay","compose","maxStack","shift","transformStack","stackItem","setSelection","index","getLastChangeIndex","scroll","remoteDelta","i","oldItem","splice","endsWithNewlineChange","lastOp","insert","endsWith","attributes","Object","keys","some","attr","query","BLOCK","deleteLength","reduce","op","delete","changeIndex","start","transformPosition","end","default"],"sources":["../../src/modules/history.ts"],"sourcesContent":["import { Scope } from 'parchment';\nimport type Delta from 'quill-delta';\nimport Module from '../core/module.js';\nimport Quill from '../core/quill.js';\nimport type Scroll from '../blots/scroll.js';\nimport type { Range } from '../core/selection.js';\n\nexport interface HistoryOptions {\n  userOnly: boolean;\n  delay: number;\n  maxStack: number;\n}\n\nexport interface StackItem {\n  delta: Delta;\n  range: Range | null;\n}\n\ninterface Stack {\n  undo: StackItem[];\n  redo: StackItem[];\n}\n\nclass History extends Module<HistoryOptions> {\n  static DEFAULTS: HistoryOptions = {\n    delay: 1000,\n    maxStack: 100,\n    userOnly: false,\n  };\n\n  lastRecorded = 0;\n  ignoreChange = false;\n  stack: Stack = { undo: [], redo: [] };\n  currentRange: Range | null = null;\n\n  constructor(quill: Quill, options: Partial<HistoryOptions>) {\n    super(quill, options);\n    this.quill.on(\n      Quill.events.EDITOR_CHANGE,\n      (eventName, value, oldValue, source) => {\n        if (eventName === Quill.events.SELECTION_CHANGE) {\n          if (value && source !== Quill.sources.SILENT) {\n            this.currentRange = value;\n          }\n        } else if (eventName === Quill.events.TEXT_CHANGE) {\n          if (!this.ignoreChange) {\n            if (!this.options.userOnly || source === Quill.sources.USER) {\n              this.record(value, oldValue);\n            } else {\n              this.transform(value);\n            }\n          }\n\n          this.currentRange = transformRange(this.currentRange, value);\n        }\n      },\n    );\n\n    this.quill.keyboard.addBinding(\n      { key: 'z', shortKey: true },\n      this.undo.bind(this),\n    );\n    this.quill.keyboard.addBinding(\n      { key: ['z', 'Z'], shortKey: true, shiftKey: true },\n      this.redo.bind(this),\n    );\n    if (/Win/i.test(navigator.platform)) {\n      this.quill.keyboard.addBinding(\n        { key: 'y', shortKey: true },\n        this.redo.bind(this),\n      );\n    }\n\n    this.quill.root.addEventListener('beforeinput', (event) => {\n      if (event.inputType === 'historyUndo') {\n        this.undo();\n        event.preventDefault();\n      } else if (event.inputType === 'historyRedo') {\n        this.redo();\n        event.preventDefault();\n      }\n    });\n  }\n\n  change(source: 'undo' | 'redo', dest: 'redo' | 'undo') {\n    if (this.stack[source].length === 0) return;\n    const item = this.stack[source].pop();\n    if (!item) return;\n    const base = this.quill.getContents();\n    const inverseDelta = item.delta.invert(base);\n    this.stack[dest].push({\n      delta: inverseDelta,\n      range: transformRange(item.range, inverseDelta),\n    });\n    this.lastRecorded = 0;\n    this.ignoreChange = true;\n    this.quill.updateContents(item.delta, Quill.sources.USER);\n    this.ignoreChange = false;\n\n    this.restoreSelection(item);\n  }\n\n  clear() {\n    this.stack = { undo: [], redo: [] };\n  }\n\n  cutoff() {\n    this.lastRecorded = 0;\n  }\n\n  record(changeDelta: Delta, oldDelta: Delta) {\n    if (changeDelta.ops.length === 0) return;\n    this.stack.redo = [];\n    let undoDelta = changeDelta.invert(oldDelta);\n    let undoRange = this.currentRange;\n    const timestamp = Date.now();\n    if (\n      // @ts-expect-error Fix me later\n      this.lastRecorded + this.options.delay > timestamp &&\n      this.stack.undo.length > 0\n    ) {\n      const item = this.stack.undo.pop();\n      if (item) {\n        undoDelta = undoDelta.compose(item.delta);\n        undoRange = item.range;\n      }\n    } else {\n      this.lastRecorded = timestamp;\n    }\n    if (undoDelta.length() === 0) return;\n    this.stack.undo.push({ delta: undoDelta, range: undoRange });\n    // @ts-expect-error Fix me later\n    if (this.stack.undo.length > this.options.maxStack) {\n      this.stack.undo.shift();\n    }\n  }\n\n  redo() {\n    this.change('redo', 'undo');\n  }\n\n  transform(delta: Delta) {\n    transformStack(this.stack.undo, delta);\n    transformStack(this.stack.redo, delta);\n  }\n\n  undo() {\n    this.change('undo', 'redo');\n  }\n\n  protected restoreSelection(stackItem: StackItem) {\n    if (stackItem.range) {\n      this.quill.setSelection(stackItem.range, Quill.sources.USER);\n    } else {\n      const index = getLastChangeIndex(this.quill.scroll, stackItem.delta);\n      this.quill.setSelection(index, Quill.sources.USER);\n    }\n  }\n}\n\nfunction transformStack(stack: StackItem[], delta: Delta) {\n  let remoteDelta = delta;\n  for (let i = stack.length - 1; i >= 0; i -= 1) {\n    const oldItem = stack[i];\n    stack[i] = {\n      delta: remoteDelta.transform(oldItem.delta, true),\n      range: oldItem.range && transformRange(oldItem.range, remoteDelta),\n    };\n    remoteDelta = oldItem.delta.transform(remoteDelta);\n    if (stack[i].delta.length() === 0) {\n      stack.splice(i, 1);\n    }\n  }\n}\n\nfunction endsWithNewlineChange(scroll: Scroll, delta: Delta) {\n  const lastOp = delta.ops[delta.ops.length - 1];\n  if (lastOp == null) return false;\n  if (lastOp.insert != null) {\n    return typeof lastOp.insert === 'string' && lastOp.insert.endsWith('\\n');\n  }\n  if (lastOp.attributes != null) {\n    return Object.keys(lastOp.attributes).some((attr) => {\n      return scroll.query(attr, Scope.BLOCK) != null;\n    });\n  }\n  return false;\n}\n\nfunction getLastChangeIndex(scroll: Scroll, delta: Delta) {\n  const deleteLength = delta.reduce((length, op) => {\n    return length + (op.delete || 0);\n  }, 0);\n  let changeIndex = delta.length() - deleteLength;\n  if (endsWithNewlineChange(scroll, delta)) {\n    changeIndex -= 1;\n  }\n  return changeIndex;\n}\n\nfunction transformRange(range: Range | null, delta: Delta) {\n  if (!range) return range;\n  const start = delta.transformPosition(range.index);\n  const end = delta.transformPosition(range.index + range.length);\n  return { index: start, length: end - start };\n}\n\nexport { History as default, getLastChangeIndex };\n"],"mappings":"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","ignoreList":[]}]}