{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\quill\\modules\\keyboard.js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\quill\\modules\\keyboard.js","mtime":1751792162076},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1746431219000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnJlZHVjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZXZlcnkuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5yZWR1Y2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5zb21lLmpzIjsKaW1wb3J0IHsgY2xvbmVEZWVwLCBpc0VxdWFsIH0gZnJvbSAnbG9kYXNoLWVzJzsKaW1wb3J0IERlbHRhLCB7IEF0dHJpYnV0ZU1hcCB9IGZyb20gJ3F1aWxsLWRlbHRhJzsKaW1wb3J0IHsgRW1iZWRCbG90LCBTY29wZSwgVGV4dEJsb3QgfSBmcm9tICdwYXJjaG1lbnQnOwppbXBvcnQgUXVpbGwgZnJvbSAnLi4vY29yZS9xdWlsbC5qcyc7CmltcG9ydCBsb2dnZXIgZnJvbSAnLi4vY29yZS9sb2dnZXIuanMnOwppbXBvcnQgTW9kdWxlIGZyb20gJy4uL2NvcmUvbW9kdWxlLmpzJzsKY29uc3QgZGVidWcgPSBsb2dnZXIoJ3F1aWxsOmtleWJvYXJkJyk7CmNvbnN0IFNIT1JUS0VZID0gL01hYy9pLnRlc3QobmF2aWdhdG9yLnBsYXRmb3JtKSA/ICdtZXRhS2V5JyA6ICdjdHJsS2V5JzsKY2xhc3MgS2V5Ym9hcmQgZXh0ZW5kcyBNb2R1bGUgewogIHN0YXRpYyBtYXRjaChldnQsIGJpbmRpbmcpIHsKICAgIGlmIChbJ2FsdEtleScsICdjdHJsS2V5JywgJ21ldGFLZXknLCAnc2hpZnRLZXknXS5zb21lKGtleSA9PiB7CiAgICAgIHJldHVybiAhIWJpbmRpbmdba2V5XSAhPT0gZXZ0W2tleV0gJiYgYmluZGluZ1trZXldICE9PSBudWxsOwogICAgfSkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIGJpbmRpbmcua2V5ID09PSBldnQua2V5IHx8IGJpbmRpbmcua2V5ID09PSBldnQud2hpY2g7CiAgfQogIGNvbnN0cnVjdG9yKHF1aWxsLCBvcHRpb25zKSB7CiAgICBzdXBlcihxdWlsbCwgb3B0aW9ucyk7CiAgICB0aGlzLmJpbmRpbmdzID0ge307CiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEZpeCBtZSBsYXRlcgogICAgT2JqZWN0LmtleXModGhpcy5vcHRpb25zLmJpbmRpbmdzKS5mb3JFYWNoKG5hbWUgPT4gewogICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEZpeCBtZSBsYXRlcgogICAgICBpZiAodGhpcy5vcHRpb25zLmJpbmRpbmdzW25hbWVdKSB7CiAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBGaXggbWUgbGF0ZXIKICAgICAgICB0aGlzLmFkZEJpbmRpbmcodGhpcy5vcHRpb25zLmJpbmRpbmdzW25hbWVdKTsKICAgICAgfQogICAgfSk7CiAgICB0aGlzLmFkZEJpbmRpbmcoewogICAgICBrZXk6ICdFbnRlcicsCiAgICAgIHNoaWZ0S2V5OiBudWxsCiAgICB9LCB0aGlzLmhhbmRsZUVudGVyKTsKICAgIHRoaXMuYWRkQmluZGluZyh7CiAgICAgIGtleTogJ0VudGVyJywKICAgICAgbWV0YUtleTogbnVsbCwKICAgICAgY3RybEtleTogbnVsbCwKICAgICAgYWx0S2V5OiBudWxsCiAgICB9LCAoKSA9PiB7fSk7CiAgICBpZiAoL0ZpcmVmb3gvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7CiAgICAgIC8vIE5lZWQgdG8gaGFuZGxlIGRlbGV0ZSBhbmQgYmFja3NwYWNlIGZvciBGaXJlZm94IGluIHRoZSBnZW5lcmFsIGNhc2UgIzExNzEKICAgICAgdGhpcy5hZGRCaW5kaW5nKHsKICAgICAgICBrZXk6ICdCYWNrc3BhY2UnCiAgICAgIH0sIHsKICAgICAgICBjb2xsYXBzZWQ6IHRydWUKICAgICAgfSwgdGhpcy5oYW5kbGVCYWNrc3BhY2UpOwogICAgICB0aGlzLmFkZEJpbmRpbmcoewogICAgICAgIGtleTogJ0RlbGV0ZScKICAgICAgfSwgewogICAgICAgIGNvbGxhcHNlZDogdHJ1ZQogICAgICB9LCB0aGlzLmhhbmRsZURlbGV0ZSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmFkZEJpbmRpbmcoewogICAgICAgIGtleTogJ0JhY2tzcGFjZScKICAgICAgfSwgewogICAgICAgIGNvbGxhcHNlZDogdHJ1ZSwKICAgICAgICBwcmVmaXg6IC9eLj8kLwogICAgICB9LCB0aGlzLmhhbmRsZUJhY2tzcGFjZSk7CiAgICAgIHRoaXMuYWRkQmluZGluZyh7CiAgICAgICAga2V5OiAnRGVsZXRlJwogICAgICB9LCB7CiAgICAgICAgY29sbGFwc2VkOiB0cnVlLAogICAgICAgIHN1ZmZpeDogL14uPyQvCiAgICAgIH0sIHRoaXMuaGFuZGxlRGVsZXRlKTsKICAgIH0KICAgIHRoaXMuYWRkQmluZGluZyh7CiAgICAgIGtleTogJ0JhY2tzcGFjZScKICAgIH0sIHsKICAgICAgY29sbGFwc2VkOiBmYWxzZQogICAgfSwgdGhpcy5oYW5kbGVEZWxldGVSYW5nZSk7CiAgICB0aGlzLmFkZEJpbmRpbmcoewogICAgICBrZXk6ICdEZWxldGUnCiAgICB9LCB7CiAgICAgIGNvbGxhcHNlZDogZmFsc2UKICAgIH0sIHRoaXMuaGFuZGxlRGVsZXRlUmFuZ2UpOwogICAgdGhpcy5hZGRCaW5kaW5nKHsKICAgICAga2V5OiAnQmFja3NwYWNlJywKICAgICAgYWx0S2V5OiBudWxsLAogICAgICBjdHJsS2V5OiBudWxsLAogICAgICBtZXRhS2V5OiBudWxsLAogICAgICBzaGlmdEtleTogbnVsbAogICAgfSwgewogICAgICBjb2xsYXBzZWQ6IHRydWUsCiAgICAgIG9mZnNldDogMAogICAgfSwgdGhpcy5oYW5kbGVCYWNrc3BhY2UpOwogICAgdGhpcy5saXN0ZW4oKTsKICB9CiAgYWRkQmluZGluZyhrZXlCaW5kaW5nKSB7CiAgICBsZXQgY29udGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgICBsZXQgaGFuZGxlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CiAgICBjb25zdCBiaW5kaW5nID0gbm9ybWFsaXplKGtleUJpbmRpbmcpOwogICAgaWYgKGJpbmRpbmcgPT0gbnVsbCkgewogICAgICBkZWJ1Zy53YXJuKCdBdHRlbXB0ZWQgdG8gYWRkIGludmFsaWQga2V5Ym9hcmQgYmluZGluZycsIGJpbmRpbmcpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodHlwZW9mIGNvbnRleHQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgY29udGV4dCA9IHsKICAgICAgICBoYW5kbGVyOiBjb250ZXh0CiAgICAgIH07CiAgICB9CiAgICBpZiAodHlwZW9mIGhhbmRsZXIgPT09ICdmdW5jdGlvbicpIHsKICAgICAgaGFuZGxlciA9IHsKICAgICAgICBoYW5kbGVyCiAgICAgIH07CiAgICB9CiAgICBjb25zdCBrZXlzID0gQXJyYXkuaXNBcnJheShiaW5kaW5nLmtleSkgPyBiaW5kaW5nLmtleSA6IFtiaW5kaW5nLmtleV07CiAgICBrZXlzLmZvckVhY2goa2V5ID0+IHsKICAgICAgY29uc3Qgc2luZ2xlQmluZGluZyA9IHsKICAgICAgICAuLi5iaW5kaW5nLAogICAgICAgIGtleSwKICAgICAgICAuLi5jb250ZXh0LAogICAgICAgIC4uLmhhbmRsZXIKICAgICAgfTsKICAgICAgdGhpcy5iaW5kaW5nc1tzaW5nbGVCaW5kaW5nLmtleV0gPSB0aGlzLmJpbmRpbmdzW3NpbmdsZUJpbmRpbmcua2V5XSB8fCBbXTsKICAgICAgdGhpcy5iaW5kaW5nc1tzaW5nbGVCaW5kaW5nLmtleV0ucHVzaChzaW5nbGVCaW5kaW5nKTsKICAgIH0pOwogIH0KICBsaXN0ZW4oKSB7CiAgICB0aGlzLnF1aWxsLnJvb3QuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGV2dCA9PiB7CiAgICAgIGlmIChldnQuZGVmYXVsdFByZXZlbnRlZCB8fCBldnQuaXNDb21wb3NpbmcpIHJldHVybjsKCiAgICAgIC8vIGV2dC5pc0NvbXBvc2luZyBpcyBmYWxzZSB3aGVuIHByZXNzaW5nIEVudGVyL0JhY2tzcGFjZSB3aGVuIGNvbXBvc2luZyBpbiBTYWZhcmkKICAgICAgLy8gaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTE2NTAwNAogICAgICBjb25zdCBpc0NvbXBvc2luZyA9IGV2dC5rZXlDb2RlID09PSAyMjkgJiYgKGV2dC5rZXkgPT09ICdFbnRlcicgfHwgZXZ0LmtleSA9PT0gJ0JhY2tzcGFjZScpOwogICAgICBpZiAoaXNDb21wb3NpbmcpIHJldHVybjsKICAgICAgY29uc3QgYmluZGluZ3MgPSAodGhpcy5iaW5kaW5nc1tldnQua2V5XSB8fCBbXSkuY29uY2F0KHRoaXMuYmluZGluZ3NbZXZ0LndoaWNoXSB8fCBbXSk7CiAgICAgIGNvbnN0IG1hdGNoZXMgPSBiaW5kaW5ncy5maWx0ZXIoYmluZGluZyA9PiBLZXlib2FyZC5tYXRjaChldnQsIGJpbmRpbmcpKTsKICAgICAgaWYgKG1hdGNoZXMubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IKICAgICAgY29uc3QgYmxvdCA9IFF1aWxsLmZpbmQoZXZ0LnRhcmdldCwgdHJ1ZSk7CiAgICAgIGlmIChibG90ICYmIGJsb3Quc2Nyb2xsICE9PSB0aGlzLnF1aWxsLnNjcm9sbCkgcmV0dXJuOwogICAgICBjb25zdCByYW5nZSA9IHRoaXMucXVpbGwuZ2V0U2VsZWN0aW9uKCk7CiAgICAgIGlmIChyYW5nZSA9PSBudWxsIHx8ICF0aGlzLnF1aWxsLmhhc0ZvY3VzKCkpIHJldHVybjsKICAgICAgY29uc3QgW2xpbmUsIG9mZnNldF0gPSB0aGlzLnF1aWxsLmdldExpbmUocmFuZ2UuaW5kZXgpOwogICAgICBjb25zdCBbbGVhZlN0YXJ0LCBvZmZzZXRTdGFydF0gPSB0aGlzLnF1aWxsLmdldExlYWYocmFuZ2UuaW5kZXgpOwogICAgICBjb25zdCBbbGVhZkVuZCwgb2Zmc2V0RW5kXSA9IHJhbmdlLmxlbmd0aCA9PT0gMCA/IFtsZWFmU3RhcnQsIG9mZnNldFN0YXJ0XSA6IHRoaXMucXVpbGwuZ2V0TGVhZihyYW5nZS5pbmRleCArIHJhbmdlLmxlbmd0aCk7CiAgICAgIGNvbnN0IHByZWZpeFRleHQgPSBsZWFmU3RhcnQgaW5zdGFuY2VvZiBUZXh0QmxvdCA/IGxlYWZTdGFydC52YWx1ZSgpLnNsaWNlKDAsIG9mZnNldFN0YXJ0KSA6ICcnOwogICAgICBjb25zdCBzdWZmaXhUZXh0ID0gbGVhZkVuZCBpbnN0YW5jZW9mIFRleHRCbG90ID8gbGVhZkVuZC52YWx1ZSgpLnNsaWNlKG9mZnNldEVuZCkgOiAnJzsKICAgICAgY29uc3QgY3VyQ29udGV4dCA9IHsKICAgICAgICBjb2xsYXBzZWQ6IHJhbmdlLmxlbmd0aCA9PT0gMCwKICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEZpeCBtZSBsYXRlcgogICAgICAgIGVtcHR5OiByYW5nZS5sZW5ndGggPT09IDAgJiYgbGluZS5sZW5ndGgoKSA8PSAxLAogICAgICAgIGZvcm1hdDogdGhpcy5xdWlsbC5nZXRGb3JtYXQocmFuZ2UpLAogICAgICAgIGxpbmUsCiAgICAgICAgb2Zmc2V0LAogICAgICAgIHByZWZpeDogcHJlZml4VGV4dCwKICAgICAgICBzdWZmaXg6IHN1ZmZpeFRleHQsCiAgICAgICAgZXZlbnQ6IGV2dAogICAgICB9OwogICAgICBjb25zdCBwcmV2ZW50ZWQgPSBtYXRjaGVzLnNvbWUoYmluZGluZyA9PiB7CiAgICAgICAgaWYgKGJpbmRpbmcuY29sbGFwc2VkICE9IG51bGwgJiYgYmluZGluZy5jb2xsYXBzZWQgIT09IGN1ckNvbnRleHQuY29sbGFwc2VkKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChiaW5kaW5nLmVtcHR5ICE9IG51bGwgJiYgYmluZGluZy5lbXB0eSAhPT0gY3VyQ29udGV4dC5lbXB0eSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoYmluZGluZy5vZmZzZXQgIT0gbnVsbCAmJiBiaW5kaW5nLm9mZnNldCAhPT0gY3VyQ29udGV4dC5vZmZzZXQpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYmluZGluZy5mb3JtYXQpKSB7CiAgICAgICAgICAvLyBhbnkgZm9ybWF0IGlzIHByZXNlbnQKICAgICAgICAgIGlmIChiaW5kaW5nLmZvcm1hdC5ldmVyeShuYW1lID0+IGN1ckNvbnRleHQuZm9ybWF0W25hbWVdID09IG51bGwpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBiaW5kaW5nLmZvcm1hdCA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgIC8vIGFsbCBmb3JtYXRzIG11c3QgbWF0Y2gKICAgICAgICAgIGlmICghT2JqZWN0LmtleXMoYmluZGluZy5mb3JtYXQpLmV2ZXJ5KG5hbWUgPT4gewogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEZpeCBtZSBsYXRlcgogICAgICAgICAgICBpZiAoYmluZGluZy5mb3JtYXRbbmFtZV0gPT09IHRydWUpIHJldHVybiBjdXJDb250ZXh0LmZvcm1hdFtuYW1lXSAhPSBudWxsOwogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEZpeCBtZSBsYXRlcgogICAgICAgICAgICBpZiAoYmluZGluZy5mb3JtYXRbbmFtZV0gPT09IGZhbHNlKSByZXR1cm4gY3VyQ29udGV4dC5mb3JtYXRbbmFtZV0gPT0gbnVsbDsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBGaXggbWUgbGF0ZXIKICAgICAgICAgICAgcmV0dXJuIGlzRXF1YWwoYmluZGluZy5mb3JtYXRbbmFtZV0sIGN1ckNvbnRleHQuZm9ybWF0W25hbWVdKTsKICAgICAgICAgIH0pKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGJpbmRpbmcucHJlZml4ICE9IG51bGwgJiYgIWJpbmRpbmcucHJlZml4LnRlc3QoY3VyQ29udGV4dC5wcmVmaXgpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChiaW5kaW5nLnN1ZmZpeCAhPSBudWxsICYmICFiaW5kaW5nLnN1ZmZpeC50ZXN0KGN1ckNvbnRleHQuc3VmZml4KSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEZpeCBtZSBsYXRlcgogICAgICAgIHJldHVybiBiaW5kaW5nLmhhbmRsZXIuY2FsbCh0aGlzLCByYW5nZSwgY3VyQ29udGV4dCwgYmluZGluZykgIT09IHRydWU7CiAgICAgIH0pOwogICAgICBpZiAocHJldmVudGVkKSB7CiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0pOwogIH0KICBoYW5kbGVCYWNrc3BhY2UocmFuZ2UsIGNvbnRleHQpIHsKICAgIC8vIENoZWNrIGZvciBhc3RyYWwgc3ltYm9scwogICAgY29uc3QgbGVuZ3RoID0gL1tcdUQ4MDAtXHVEQkZGXVtcdURDMDAtXHVERkZGXSQvLnRlc3QoY29udGV4dC5wcmVmaXgpID8gMiA6IDE7CiAgICBpZiAocmFuZ2UuaW5kZXggPT09IDAgfHwgdGhpcy5xdWlsbC5nZXRMZW5ndGgoKSA8PSAxKSByZXR1cm47CiAgICBsZXQgZm9ybWF0cyA9IHt9OwogICAgY29uc3QgW2xpbmVdID0gdGhpcy5xdWlsbC5nZXRMaW5lKHJhbmdlLmluZGV4KTsKICAgIGxldCBkZWx0YSA9IG5ldyBEZWx0YSgpLnJldGFpbihyYW5nZS5pbmRleCAtIGxlbmd0aCkuZGVsZXRlKGxlbmd0aCk7CiAgICBpZiAoY29udGV4dC5vZmZzZXQgPT09IDApIHsKICAgICAgLy8gQWx3YXlzIGRlbGV0aW5nIG5ld2xpbmUgaGVyZSwgbGVuZ3RoIGFsd2F5cyAxCiAgICAgIGNvbnN0IFtwcmV2XSA9IHRoaXMucXVpbGwuZ2V0TGluZShyYW5nZS5pbmRleCAtIDEpOwogICAgICBpZiAocHJldikgewogICAgICAgIGNvbnN0IGlzUHJldkxpbmVFbXB0eSA9IHByZXYuc3RhdGljcy5ibG90TmFtZSA9PT0gJ2Jsb2NrJyAmJiBwcmV2Lmxlbmd0aCgpIDw9IDE7CiAgICAgICAgaWYgKCFpc1ByZXZMaW5lRW1wdHkpIHsKICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgRml4IG1lIGxhdGVyCiAgICAgICAgICBjb25zdCBjdXJGb3JtYXRzID0gbGluZS5mb3JtYXRzKCk7CiAgICAgICAgICBjb25zdCBwcmV2Rm9ybWF0cyA9IHRoaXMucXVpbGwuZ2V0Rm9ybWF0KHJhbmdlLmluZGV4IC0gMSwgMSk7CiAgICAgICAgICBmb3JtYXRzID0gQXR0cmlidXRlTWFwLmRpZmYoY3VyRm9ybWF0cywgcHJldkZvcm1hdHMpIHx8IHt9OwogICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGZvcm1hdHMpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgLy8gbGluZS5sZW5ndGgoKSAtIDEgdGFyZ2V0cyBcbiBpbiBsaW5lLCBhbm90aGVyIC0xIGZvciBuZXdsaW5lIGJlaW5nIGRlbGV0ZWQKICAgICAgICAgICAgY29uc3QgZm9ybWF0RGVsdGEgPSBuZXcgRGVsdGEoKQogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEZpeCBtZSBsYXRlcgogICAgICAgICAgICAucmV0YWluKHJhbmdlLmluZGV4ICsgbGluZS5sZW5ndGgoKSAtIDIpLnJldGFpbigxLCBmb3JtYXRzKTsKICAgICAgICAgICAgZGVsdGEgPSBkZWx0YS5jb21wb3NlKGZvcm1hdERlbHRhKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRoaXMucXVpbGwudXBkYXRlQ29udGVudHMoZGVsdGEsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICB0aGlzLnF1aWxsLmZvY3VzKCk7CiAgfQogIGhhbmRsZURlbGV0ZShyYW5nZSwgY29udGV4dCkgewogICAgLy8gQ2hlY2sgZm9yIGFzdHJhbCBzeW1ib2xzCiAgICBjb25zdCBsZW5ndGggPSAvXltcdUQ4MDAtXHVEQkZGXVtcdURDMDAtXHVERkZGXS8udGVzdChjb250ZXh0LnN1ZmZpeCkgPyAyIDogMTsKICAgIGlmIChyYW5nZS5pbmRleCA+PSB0aGlzLnF1aWxsLmdldExlbmd0aCgpIC0gbGVuZ3RoKSByZXR1cm47CiAgICBsZXQgZm9ybWF0cyA9IHt9OwogICAgY29uc3QgW2xpbmVdID0gdGhpcy5xdWlsbC5nZXRMaW5lKHJhbmdlLmluZGV4KTsKICAgIGxldCBkZWx0YSA9IG5ldyBEZWx0YSgpLnJldGFpbihyYW5nZS5pbmRleCkuZGVsZXRlKGxlbmd0aCk7CiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEZpeCBtZSBsYXRlcgogICAgaWYgKGNvbnRleHQub2Zmc2V0ID49IGxpbmUubGVuZ3RoKCkgLSAxKSB7CiAgICAgIGNvbnN0IFtuZXh0XSA9IHRoaXMucXVpbGwuZ2V0TGluZShyYW5nZS5pbmRleCArIDEpOwogICAgICBpZiAobmV4dCkgewogICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgRml4IG1lIGxhdGVyCiAgICAgICAgY29uc3QgY3VyRm9ybWF0cyA9IGxpbmUuZm9ybWF0cygpOwogICAgICAgIGNvbnN0IG5leHRGb3JtYXRzID0gdGhpcy5xdWlsbC5nZXRGb3JtYXQocmFuZ2UuaW5kZXgsIDEpOwogICAgICAgIGZvcm1hdHMgPSBBdHRyaWJ1dGVNYXAuZGlmZihjdXJGb3JtYXRzLCBuZXh0Rm9ybWF0cykgfHwge307CiAgICAgICAgaWYgKE9iamVjdC5rZXlzKGZvcm1hdHMpLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGRlbHRhID0gZGVsdGEucmV0YWluKG5leHQubGVuZ3RoKCkgLSAxKS5yZXRhaW4oMSwgZm9ybWF0cyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICB0aGlzLnF1aWxsLnVwZGF0ZUNvbnRlbnRzKGRlbHRhLCBRdWlsbC5zb3VyY2VzLlVTRVIpOwogICAgdGhpcy5xdWlsbC5mb2N1cygpOwogIH0KICBoYW5kbGVEZWxldGVSYW5nZShyYW5nZSkgewogICAgZGVsZXRlUmFuZ2UoewogICAgICByYW5nZSwKICAgICAgcXVpbGw6IHRoaXMucXVpbGwKICAgIH0pOwogICAgdGhpcy5xdWlsbC5mb2N1cygpOwogIH0KICBoYW5kbGVFbnRlcihyYW5nZSwgY29udGV4dCkgewogICAgY29uc3QgbGluZUZvcm1hdHMgPSBPYmplY3Qua2V5cyhjb250ZXh0LmZvcm1hdCkucmVkdWNlKChmb3JtYXRzLCBmb3JtYXQpID0+IHsKICAgICAgaWYgKHRoaXMucXVpbGwuc2Nyb2xsLnF1ZXJ5KGZvcm1hdCwgU2NvcGUuQkxPQ0spICYmICFBcnJheS5pc0FycmF5KGNvbnRleHQuZm9ybWF0W2Zvcm1hdF0pKSB7CiAgICAgICAgZm9ybWF0c1tmb3JtYXRdID0gY29udGV4dC5mb3JtYXRbZm9ybWF0XTsKICAgICAgfQogICAgICByZXR1cm4gZm9ybWF0czsKICAgIH0sIHt9KTsKICAgIGNvbnN0IGRlbHRhID0gbmV3IERlbHRhKCkucmV0YWluKHJhbmdlLmluZGV4KS5kZWxldGUocmFuZ2UubGVuZ3RoKS5pbnNlcnQoJ1xuJywgbGluZUZvcm1hdHMpOwogICAgdGhpcy5xdWlsbC51cGRhdGVDb250ZW50cyhkZWx0YSwgUXVpbGwuc291cmNlcy5VU0VSKTsKICAgIHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKHJhbmdlLmluZGV4ICsgMSwgUXVpbGwuc291cmNlcy5TSUxFTlQpOwogICAgdGhpcy5xdWlsbC5mb2N1cygpOwogIH0KfQpjb25zdCBkZWZhdWx0T3B0aW9ucyA9IHsKICBiaW5kaW5nczogewogICAgYm9sZDogbWFrZUZvcm1hdEhhbmRsZXIoJ2JvbGQnKSwKICAgIGl0YWxpYzogbWFrZUZvcm1hdEhhbmRsZXIoJ2l0YWxpYycpLAogICAgdW5kZXJsaW5lOiBtYWtlRm9ybWF0SGFuZGxlcigndW5kZXJsaW5lJyksCiAgICBpbmRlbnQ6IHsKICAgICAgLy8gaGlnaGxpZ2h0IHRhYiBvciB0YWIgYXQgYmVnaW5uaW5nIG9mIGxpc3QsIGluZGVudCBvciBibG9ja3F1b3RlCiAgICAgIGtleTogJ1RhYicsCiAgICAgIGZvcm1hdDogWydibG9ja3F1b3RlJywgJ2luZGVudCcsICdsaXN0J10sCiAgICAgIGhhbmRsZXIocmFuZ2UsIGNvbnRleHQpIHsKICAgICAgICBpZiAoY29udGV4dC5jb2xsYXBzZWQgJiYgY29udGV4dC5vZmZzZXQgIT09IDApIHJldHVybiB0cnVlOwogICAgICAgIHRoaXMucXVpbGwuZm9ybWF0KCdpbmRlbnQnLCAnKzEnLCBRdWlsbC5zb3VyY2VzLlVTRVIpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIG91dGRlbnQ6IHsKICAgICAga2V5OiAnVGFiJywKICAgICAgc2hpZnRLZXk6IHRydWUsCiAgICAgIGZvcm1hdDogWydibG9ja3F1b3RlJywgJ2luZGVudCcsICdsaXN0J10sCiAgICAgIC8vIGhpZ2hsaWdodCB0YWIgb3IgdGFiIGF0IGJlZ2lubmluZyBvZiBsaXN0LCBpbmRlbnQgb3IgYmxvY2txdW90ZQogICAgICBoYW5kbGVyKHJhbmdlLCBjb250ZXh0KSB7CiAgICAgICAgaWYgKGNvbnRleHQuY29sbGFwc2VkICYmIGNvbnRleHQub2Zmc2V0ICE9PSAwKSByZXR1cm4gdHJ1ZTsKICAgICAgICB0aGlzLnF1aWxsLmZvcm1hdCgnaW5kZW50JywgJy0xJywgUXVpbGwuc291cmNlcy5VU0VSKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICAnb3V0ZGVudCBiYWNrc3BhY2UnOiB7CiAgICAgIGtleTogJ0JhY2tzcGFjZScsCiAgICAgIGNvbGxhcHNlZDogdHJ1ZSwKICAgICAgc2hpZnRLZXk6IG51bGwsCiAgICAgIG1ldGFLZXk6IG51bGwsCiAgICAgIGN0cmxLZXk6IG51bGwsCiAgICAgIGFsdEtleTogbnVsbCwKICAgICAgZm9ybWF0OiBbJ2luZGVudCcsICdsaXN0J10sCiAgICAgIG9mZnNldDogMCwKICAgICAgaGFuZGxlcihyYW5nZSwgY29udGV4dCkgewogICAgICAgIGlmIChjb250ZXh0LmZvcm1hdC5pbmRlbnQgIT0gbnVsbCkgewogICAgICAgICAgdGhpcy5xdWlsbC5mb3JtYXQoJ2luZGVudCcsICctMScsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICAgICAgfSBlbHNlIGlmIChjb250ZXh0LmZvcm1hdC5saXN0ICE9IG51bGwpIHsKICAgICAgICAgIHRoaXMucXVpbGwuZm9ybWF0KCdsaXN0JywgZmFsc2UsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgJ2luZGVudCBjb2RlLWJsb2NrJzogbWFrZUNvZGVCbG9ja0hhbmRsZXIodHJ1ZSksCiAgICAnb3V0ZGVudCBjb2RlLWJsb2NrJzogbWFrZUNvZGVCbG9ja0hhbmRsZXIoZmFsc2UpLAogICAgJ3JlbW92ZSB0YWInOiB7CiAgICAgIGtleTogJ1RhYicsCiAgICAgIHNoaWZ0S2V5OiB0cnVlLAogICAgICBjb2xsYXBzZWQ6IHRydWUsCiAgICAgIHByZWZpeDogL1x0JC8sCiAgICAgIGhhbmRsZXIocmFuZ2UpIHsKICAgICAgICB0aGlzLnF1aWxsLmRlbGV0ZVRleHQocmFuZ2UuaW5kZXggLSAxLCAxLCBRdWlsbC5zb3VyY2VzLlVTRVIpOwogICAgICB9CiAgICB9LAogICAgdGFiOiB7CiAgICAgIGtleTogJ1RhYicsCiAgICAgIGhhbmRsZXIocmFuZ2UsIGNvbnRleHQpIHsKICAgICAgICBpZiAoY29udGV4dC5mb3JtYXQudGFibGUpIHJldHVybiB0cnVlOwogICAgICAgIHRoaXMucXVpbGwuaGlzdG9yeS5jdXRvZmYoKTsKICAgICAgICBjb25zdCBkZWx0YSA9IG5ldyBEZWx0YSgpLnJldGFpbihyYW5nZS5pbmRleCkuZGVsZXRlKHJhbmdlLmxlbmd0aCkuaW5zZXJ0KCdcdCcpOwogICAgICAgIHRoaXMucXVpbGwudXBkYXRlQ29udGVudHMoZGVsdGEsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICAgICAgdGhpcy5xdWlsbC5oaXN0b3J5LmN1dG9mZigpOwogICAgICAgIHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKHJhbmdlLmluZGV4ICsgMSwgUXVpbGwuc291cmNlcy5TSUxFTlQpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSwKICAgICdibG9ja3F1b3RlIGVtcHR5IGVudGVyJzogewogICAgICBrZXk6ICdFbnRlcicsCiAgICAgIGNvbGxhcHNlZDogdHJ1ZSwKICAgICAgZm9ybWF0OiBbJ2Jsb2NrcXVvdGUnXSwKICAgICAgZW1wdHk6IHRydWUsCiAgICAgIGhhbmRsZXIoKSB7CiAgICAgICAgdGhpcy5xdWlsbC5mb3JtYXQoJ2Jsb2NrcXVvdGUnLCBmYWxzZSwgUXVpbGwuc291cmNlcy5VU0VSKTsKICAgICAgfQogICAgfSwKICAgICdsaXN0IGVtcHR5IGVudGVyJzogewogICAgICBrZXk6ICdFbnRlcicsCiAgICAgIGNvbGxhcHNlZDogdHJ1ZSwKICAgICAgZm9ybWF0OiBbJ2xpc3QnXSwKICAgICAgZW1wdHk6IHRydWUsCiAgICAgIGhhbmRsZXIocmFuZ2UsIGNvbnRleHQpIHsKICAgICAgICBjb25zdCBmb3JtYXRzID0gewogICAgICAgICAgbGlzdDogZmFsc2UKICAgICAgICB9OwogICAgICAgIGlmIChjb250ZXh0LmZvcm1hdC5pbmRlbnQpIHsKICAgICAgICAgIGZvcm1hdHMuaW5kZW50ID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHRoaXMucXVpbGwuZm9ybWF0TGluZShyYW5nZS5pbmRleCwgcmFuZ2UubGVuZ3RoLCBmb3JtYXRzLCBRdWlsbC5zb3VyY2VzLlVTRVIpOwogICAgICB9CiAgICB9LAogICAgJ2NoZWNrbGlzdCBlbnRlcic6IHsKICAgICAga2V5OiAnRW50ZXInLAogICAgICBjb2xsYXBzZWQ6IHRydWUsCiAgICAgIGZvcm1hdDogewogICAgICAgIGxpc3Q6ICdjaGVja2VkJwogICAgICB9LAogICAgICBoYW5kbGVyKHJhbmdlKSB7CiAgICAgICAgY29uc3QgW2xpbmUsIG9mZnNldF0gPSB0aGlzLnF1aWxsLmdldExpbmUocmFuZ2UuaW5kZXgpOwogICAgICAgIGNvbnN0IGZvcm1hdHMgPSB7CiAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEZpeCBtZSBsYXRlcgogICAgICAgICAgLi4ubGluZS5mb3JtYXRzKCksCiAgICAgICAgICBsaXN0OiAnY2hlY2tlZCcKICAgICAgICB9OwogICAgICAgIGNvbnN0IGRlbHRhID0gbmV3IERlbHRhKCkucmV0YWluKHJhbmdlLmluZGV4KS5pbnNlcnQoJ1xuJywgZm9ybWF0cykKICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEZpeCBtZSBsYXRlcgogICAgICAgIC5yZXRhaW4obGluZS5sZW5ndGgoKSAtIG9mZnNldCAtIDEpLnJldGFpbigxLCB7CiAgICAgICAgICBsaXN0OiAndW5jaGVja2VkJwogICAgICAgIH0pOwogICAgICAgIHRoaXMucXVpbGwudXBkYXRlQ29udGVudHMoZGVsdGEsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICAgICAgdGhpcy5xdWlsbC5zZXRTZWxlY3Rpb24ocmFuZ2UuaW5kZXggKyAxLCBRdWlsbC5zb3VyY2VzLlNJTEVOVCk7CiAgICAgICAgdGhpcy5xdWlsbC5zY3JvbGxTZWxlY3Rpb25JbnRvVmlldygpOwogICAgICB9CiAgICB9LAogICAgJ2hlYWRlciBlbnRlcic6IHsKICAgICAga2V5OiAnRW50ZXInLAogICAgICBjb2xsYXBzZWQ6IHRydWUsCiAgICAgIGZvcm1hdDogWydoZWFkZXInXSwKICAgICAgc3VmZml4OiAvXiQvLAogICAgICBoYW5kbGVyKHJhbmdlLCBjb250ZXh0KSB7CiAgICAgICAgY29uc3QgW2xpbmUsIG9mZnNldF0gPSB0aGlzLnF1aWxsLmdldExpbmUocmFuZ2UuaW5kZXgpOwogICAgICAgIGNvbnN0IGRlbHRhID0gbmV3IERlbHRhKCkucmV0YWluKHJhbmdlLmluZGV4KS5pbnNlcnQoJ1xuJywgY29udGV4dC5mb3JtYXQpCiAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBGaXggbWUgbGF0ZXIKICAgICAgICAucmV0YWluKGxpbmUubGVuZ3RoKCkgLSBvZmZzZXQgLSAxKS5yZXRhaW4oMSwgewogICAgICAgICAgaGVhZGVyOiBudWxsCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5xdWlsbC51cGRhdGVDb250ZW50cyhkZWx0YSwgUXVpbGwuc291cmNlcy5VU0VSKTsKICAgICAgICB0aGlzLnF1aWxsLnNldFNlbGVjdGlvbihyYW5nZS5pbmRleCArIDEsIFF1aWxsLnNvdXJjZXMuU0lMRU5UKTsKICAgICAgICB0aGlzLnF1aWxsLnNjcm9sbFNlbGVjdGlvbkludG9WaWV3KCk7CiAgICAgIH0KICAgIH0sCiAgICAndGFibGUgYmFja3NwYWNlJzogewogICAgICBrZXk6ICdCYWNrc3BhY2UnLAogICAgICBmb3JtYXQ6IFsndGFibGUnXSwKICAgICAgY29sbGFwc2VkOiB0cnVlLAogICAgICBvZmZzZXQ6IDAsCiAgICAgIGhhbmRsZXIoKSB7fQogICAgfSwKICAgICd0YWJsZSBkZWxldGUnOiB7CiAgICAgIGtleTogJ0RlbGV0ZScsCiAgICAgIGZvcm1hdDogWyd0YWJsZSddLAogICAgICBjb2xsYXBzZWQ6IHRydWUsCiAgICAgIHN1ZmZpeDogL14kLywKICAgICAgaGFuZGxlcigpIHt9CiAgICB9LAogICAgJ3RhYmxlIGVudGVyJzogewogICAgICBrZXk6ICdFbnRlcicsCiAgICAgIHNoaWZ0S2V5OiBudWxsLAogICAgICBmb3JtYXQ6IFsndGFibGUnXSwKICAgICAgaGFuZGxlcihyYW5nZSkgewogICAgICAgIGNvbnN0IG1vZHVsZSA9IHRoaXMucXVpbGwuZ2V0TW9kdWxlKCd0YWJsZScpOwogICAgICAgIGlmIChtb2R1bGUpIHsKICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IKICAgICAgICAgIGNvbnN0IFt0YWJsZSwgcm93LCBjZWxsLCBvZmZzZXRdID0gbW9kdWxlLmdldFRhYmxlKHJhbmdlKTsKICAgICAgICAgIGNvbnN0IHNoaWZ0ID0gdGFibGVTaWRlKHRhYmxlLCByb3csIGNlbGwsIG9mZnNldCk7CiAgICAgICAgICBpZiAoc2hpZnQgPT0gbnVsbCkgcmV0dXJuOwogICAgICAgICAgbGV0IGluZGV4ID0gdGFibGUub2Zmc2V0KCk7CiAgICAgICAgICBpZiAoc2hpZnQgPCAwKSB7CiAgICAgICAgICAgIGNvbnN0IGRlbHRhID0gbmV3IERlbHRhKCkucmV0YWluKGluZGV4KS5pbnNlcnQoJ1xuJyk7CiAgICAgICAgICAgIHRoaXMucXVpbGwudXBkYXRlQ29udGVudHMoZGVsdGEsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICAgICAgICAgIHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKHJhbmdlLmluZGV4ICsgMSwgcmFuZ2UubGVuZ3RoLCBRdWlsbC5zb3VyY2VzLlNJTEVOVCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHNoaWZ0ID4gMCkgewogICAgICAgICAgICBpbmRleCArPSB0YWJsZS5sZW5ndGgoKTsKICAgICAgICAgICAgY29uc3QgZGVsdGEgPSBuZXcgRGVsdGEoKS5yZXRhaW4oaW5kZXgpLmluc2VydCgnXG4nKTsKICAgICAgICAgICAgdGhpcy5xdWlsbC51cGRhdGVDb250ZW50cyhkZWx0YSwgUXVpbGwuc291cmNlcy5VU0VSKTsKICAgICAgICAgICAgdGhpcy5xdWlsbC5zZXRTZWxlY3Rpb24oaW5kZXgsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgJ3RhYmxlIHRhYic6IHsKICAgICAga2V5OiAnVGFiJywKICAgICAgc2hpZnRLZXk6IG51bGwsCiAgICAgIGZvcm1hdDogWyd0YWJsZSddLAogICAgICBoYW5kbGVyKHJhbmdlLCBjb250ZXh0KSB7CiAgICAgICAgY29uc3QgewogICAgICAgICAgZXZlbnQsCiAgICAgICAgICBsaW5lOiBjZWxsCiAgICAgICAgfSA9IGNvbnRleHQ7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gY2VsbC5vZmZzZXQodGhpcy5xdWlsbC5zY3JvbGwpOwogICAgICAgIGlmIChldmVudC5zaGlmdEtleSkgewogICAgICAgICAgdGhpcy5xdWlsbC5zZXRTZWxlY3Rpb24ob2Zmc2V0IC0gMSwgUXVpbGwuc291cmNlcy5VU0VSKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5xdWlsbC5zZXRTZWxlY3Rpb24ob2Zmc2V0ICsgY2VsbC5sZW5ndGgoKSwgUXVpbGwuc291cmNlcy5VU0VSKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAnbGlzdCBhdXRvZmlsbCc6IHsKICAgICAga2V5OiAnICcsCiAgICAgIHNoaWZ0S2V5OiBudWxsLAogICAgICBjb2xsYXBzZWQ6IHRydWUsCiAgICAgIGZvcm1hdDogewogICAgICAgICdjb2RlLWJsb2NrJzogZmFsc2UsCiAgICAgICAgYmxvY2txdW90ZTogZmFsc2UsCiAgICAgICAgdGFibGU6IGZhbHNlCiAgICAgIH0sCiAgICAgIHByZWZpeDogL15ccyo/KFxkK1wufC18XCp8XFsgP1xdfFxbeFxdKSQvLAogICAgICBoYW5kbGVyKHJhbmdlLCBjb250ZXh0KSB7CiAgICAgICAgaWYgKHRoaXMucXVpbGwuc2Nyb2xsLnF1ZXJ5KCdsaXN0JykgPT0gbnVsbCkgcmV0dXJuIHRydWU7CiAgICAgICAgY29uc3QgewogICAgICAgICAgbGVuZ3RoCiAgICAgICAgfSA9IGNvbnRleHQucHJlZml4OwogICAgICAgIGNvbnN0IFtsaW5lLCBvZmZzZXRdID0gdGhpcy5xdWlsbC5nZXRMaW5lKHJhbmdlLmluZGV4KTsKICAgICAgICBpZiAob2Zmc2V0ID4gbGVuZ3RoKSByZXR1cm4gdHJ1ZTsKICAgICAgICBsZXQgdmFsdWU7CiAgICAgICAgc3dpdGNoIChjb250ZXh0LnByZWZpeC50cmltKCkpIHsKICAgICAgICAgIGNhc2UgJ1tdJzoKICAgICAgICAgIGNhc2UgJ1sgXSc6CiAgICAgICAgICAgIHZhbHVlID0gJ3VuY2hlY2tlZCc7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnW3hdJzoKICAgICAgICAgICAgdmFsdWUgPSAnY2hlY2tlZCc7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnLSc6CiAgICAgICAgICBjYXNlICcqJzoKICAgICAgICAgICAgdmFsdWUgPSAnYnVsbGV0JzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB2YWx1ZSA9ICdvcmRlcmVkJzsKICAgICAgICB9CiAgICAgICAgdGhpcy5xdWlsbC5pbnNlcnRUZXh0KHJhbmdlLmluZGV4LCAnICcsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICAgICAgdGhpcy5xdWlsbC5oaXN0b3J5LmN1dG9mZigpOwogICAgICAgIGNvbnN0IGRlbHRhID0gbmV3IERlbHRhKCkucmV0YWluKHJhbmdlLmluZGV4IC0gb2Zmc2V0KS5kZWxldGUobGVuZ3RoICsgMSkKICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIEZpeCBtZSBsYXRlcgogICAgICAgIC5yZXRhaW4obGluZS5sZW5ndGgoKSAtIDIgLSBvZmZzZXQpLnJldGFpbigxLCB7CiAgICAgICAgICBsaXN0OiB2YWx1ZQogICAgICAgIH0pOwogICAgICAgIHRoaXMucXVpbGwudXBkYXRlQ29udGVudHMoZGVsdGEsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICAgICAgdGhpcy5xdWlsbC5oaXN0b3J5LmN1dG9mZigpOwogICAgICAgIHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKHJhbmdlLmluZGV4IC0gbGVuZ3RoLCBRdWlsbC5zb3VyY2VzLlNJTEVOVCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9LAogICAgJ2NvZGUgZXhpdCc6IHsKICAgICAga2V5OiAnRW50ZXInLAogICAgICBjb2xsYXBzZWQ6IHRydWUsCiAgICAgIGZvcm1hdDogWydjb2RlLWJsb2NrJ10sCiAgICAgIHByZWZpeDogL14kLywKICAgICAgc3VmZml4OiAvXlxzKiQvLAogICAgICBoYW5kbGVyKHJhbmdlKSB7CiAgICAgICAgY29uc3QgW2xpbmUsIG9mZnNldF0gPSB0aGlzLnF1aWxsLmdldExpbmUocmFuZ2UuaW5kZXgpOwogICAgICAgIGxldCBudW1MaW5lcyA9IDI7CiAgICAgICAgbGV0IGN1ciA9IGxpbmU7CiAgICAgICAgd2hpbGUgKGN1ciAhPSBudWxsICYmIGN1ci5sZW5ndGgoKSA8PSAxICYmIGN1ci5mb3JtYXRzKClbJ2NvZGUtYmxvY2snXSkgewogICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvcgogICAgICAgICAgY3VyID0gY3VyLnByZXY7CiAgICAgICAgICBudW1MaW5lcyAtPSAxOwogICAgICAgICAgLy8gUmVxdWlzaXRlIHByZXYgbGluZXMgYXJlIGVtcHR5CiAgICAgICAgICBpZiAobnVtTGluZXMgPD0gMCkgewogICAgICAgICAgICBjb25zdCBkZWx0YSA9IG5ldyBEZWx0YSgpCiAgICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgRml4IG1lIGxhdGVyCiAgICAgICAgICAgIC5yZXRhaW4ocmFuZ2UuaW5kZXggKyBsaW5lLmxlbmd0aCgpIC0gb2Zmc2V0IC0gMikucmV0YWluKDEsIHsKICAgICAgICAgICAgICAnY29kZS1ibG9jayc6IG51bGwKICAgICAgICAgICAgfSkuZGVsZXRlKDEpOwogICAgICAgICAgICB0aGlzLnF1aWxsLnVwZGF0ZUNvbnRlbnRzKGRlbHRhLCBRdWlsbC5zb3VyY2VzLlVTRVIpOwogICAgICAgICAgICB0aGlzLnF1aWxsLnNldFNlbGVjdGlvbihyYW5nZS5pbmRleCAtIDEsIFF1aWxsLnNvdXJjZXMuU0lMRU5UKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgICdlbWJlZCBsZWZ0JzogbWFrZUVtYmVkQXJyb3dIYW5kbGVyKCdBcnJvd0xlZnQnLCBmYWxzZSksCiAgICAnZW1iZWQgbGVmdCBzaGlmdCc6IG1ha2VFbWJlZEFycm93SGFuZGxlcignQXJyb3dMZWZ0JywgdHJ1ZSksCiAgICAnZW1iZWQgcmlnaHQnOiBtYWtlRW1iZWRBcnJvd0hhbmRsZXIoJ0Fycm93UmlnaHQnLCBmYWxzZSksCiAgICAnZW1iZWQgcmlnaHQgc2hpZnQnOiBtYWtlRW1iZWRBcnJvd0hhbmRsZXIoJ0Fycm93UmlnaHQnLCB0cnVlKSwKICAgICd0YWJsZSBkb3duJzogbWFrZVRhYmxlQXJyb3dIYW5kbGVyKGZhbHNlKSwKICAgICd0YWJsZSB1cCc6IG1ha2VUYWJsZUFycm93SGFuZGxlcih0cnVlKQogIH0KfTsKS2V5Ym9hcmQuREVGQVVMVFMgPSBkZWZhdWx0T3B0aW9uczsKZnVuY3Rpb24gbWFrZUNvZGVCbG9ja0hhbmRsZXIoaW5kZW50KSB7CiAgcmV0dXJuIHsKICAgIGtleTogJ1RhYicsCiAgICBzaGlmdEtleTogIWluZGVudCwKICAgIGZvcm1hdDogewogICAgICAnY29kZS1ibG9jayc6IHRydWUKICAgIH0sCiAgICBoYW5kbGVyKHJhbmdlLCBfcmVmKSB7CiAgICAgIGxldCB7CiAgICAgICAgZXZlbnQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IENvZGVCbG9jayA9IHRoaXMucXVpbGwuc2Nyb2xsLnF1ZXJ5KCdjb2RlLWJsb2NrJyk7CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IKICAgICAgY29uc3QgewogICAgICAgIFRBQgogICAgICB9ID0gQ29kZUJsb2NrOwogICAgICBpZiAocmFuZ2UubGVuZ3RoID09PSAwICYmICFldmVudC5zaGlmdEtleSkgewogICAgICAgIHRoaXMucXVpbGwuaW5zZXJ0VGV4dChyYW5nZS5pbmRleCwgVEFCLCBRdWlsbC5zb3VyY2VzLlVTRVIpOwogICAgICAgIHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKHJhbmdlLmluZGV4ICsgVEFCLmxlbmd0aCwgUXVpbGwuc291cmNlcy5TSUxFTlQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBsaW5lcyA9IHJhbmdlLmxlbmd0aCA9PT0gMCA/IHRoaXMucXVpbGwuZ2V0TGluZXMocmFuZ2UuaW5kZXgsIDEpIDogdGhpcy5xdWlsbC5nZXRMaW5lcyhyYW5nZSk7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXgsCiAgICAgICAgbGVuZ3RoCiAgICAgIH0gPSByYW5nZTsKICAgICAgbGluZXMuZm9yRWFjaCgobGluZSwgaSkgPT4gewogICAgICAgIGlmIChpbmRlbnQpIHsKICAgICAgICAgIGxpbmUuaW5zZXJ0QXQoMCwgVEFCKTsKICAgICAgICAgIGlmIChpID09PSAwKSB7CiAgICAgICAgICAgIGluZGV4ICs9IFRBQi5sZW5ndGg7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsZW5ndGggKz0gVEFCLmxlbmd0aDsKICAgICAgICAgIH0KICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgRml4IG1lIGxhdGVyCiAgICAgICAgfSBlbHNlIGlmIChsaW5lLmRvbU5vZGUudGV4dENvbnRlbnQuc3RhcnRzV2l0aChUQUIpKSB7CiAgICAgICAgICBsaW5lLmRlbGV0ZUF0KDAsIFRBQi5sZW5ndGgpOwogICAgICAgICAgaWYgKGkgPT09IDApIHsKICAgICAgICAgICAgaW5kZXggLT0gVEFCLmxlbmd0aDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxlbmd0aCAtPSBUQUIubGVuZ3RoOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMucXVpbGwudXBkYXRlKFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICAgIHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKGluZGV4LCBsZW5ndGgsIFF1aWxsLnNvdXJjZXMuU0lMRU5UKTsKICAgIH0KICB9Owp9CmZ1bmN0aW9uIG1ha2VFbWJlZEFycm93SGFuZGxlcihrZXksIHNoaWZ0S2V5KSB7CiAgY29uc3Qgd2hlcmUgPSBrZXkgPT09ICdBcnJvd0xlZnQnID8gJ3ByZWZpeCcgOiAnc3VmZml4JzsKICByZXR1cm4gewogICAga2V5LAogICAgc2hpZnRLZXksCiAgICBhbHRLZXk6IG51bGwsCiAgICBbd2hlcmVdOiAvXiQvLAogICAgaGFuZGxlcihyYW5nZSkgewogICAgICBsZXQgewogICAgICAgIGluZGV4CiAgICAgIH0gPSByYW5nZTsKICAgICAgaWYgKGtleSA9PT0gJ0Fycm93UmlnaHQnKSB7CiAgICAgICAgaW5kZXggKz0gcmFuZ2UubGVuZ3RoICsgMTsKICAgICAgfQogICAgICBjb25zdCBbbGVhZl0gPSB0aGlzLnF1aWxsLmdldExlYWYoaW5kZXgpOwogICAgICBpZiAoIShsZWFmIGluc3RhbmNlb2YgRW1iZWRCbG90KSkgcmV0dXJuIHRydWU7CiAgICAgIGlmIChrZXkgPT09ICdBcnJvd0xlZnQnKSB7CiAgICAgICAgaWYgKHNoaWZ0S2V5KSB7CiAgICAgICAgICB0aGlzLnF1aWxsLnNldFNlbGVjdGlvbihyYW5nZS5pbmRleCAtIDEsIHJhbmdlLmxlbmd0aCArIDEsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMucXVpbGwuc2V0U2VsZWN0aW9uKHJhbmdlLmluZGV4IC0gMSwgUXVpbGwuc291cmNlcy5VU0VSKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoc2hpZnRLZXkpIHsKICAgICAgICB0aGlzLnF1aWxsLnNldFNlbGVjdGlvbihyYW5nZS5pbmRleCwgcmFuZ2UubGVuZ3RoICsgMSwgUXVpbGwuc291cmNlcy5VU0VSKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnF1aWxsLnNldFNlbGVjdGlvbihyYW5nZS5pbmRleCArIHJhbmdlLmxlbmd0aCArIDEsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH07Cn0KZnVuY3Rpb24gbWFrZUZvcm1hdEhhbmRsZXIoZm9ybWF0KSB7CiAgcmV0dXJuIHsKICAgIGtleTogZm9ybWF0WzBdLAogICAgc2hvcnRLZXk6IHRydWUsCiAgICBoYW5kbGVyKHJhbmdlLCBjb250ZXh0KSB7CiAgICAgIHRoaXMucXVpbGwuZm9ybWF0KGZvcm1hdCwgIWNvbnRleHQuZm9ybWF0W2Zvcm1hdF0sIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICB9CiAgfTsKfQpmdW5jdGlvbiBtYWtlVGFibGVBcnJvd0hhbmRsZXIodXApIHsKICByZXR1cm4gewogICAga2V5OiB1cCA/ICdBcnJvd1VwJyA6ICdBcnJvd0Rvd24nLAogICAgY29sbGFwc2VkOiB0cnVlLAogICAgZm9ybWF0OiBbJ3RhYmxlJ10sCiAgICBoYW5kbGVyKHJhbmdlLCBjb250ZXh0KSB7CiAgICAgIC8vIFRPRE8gbW92ZSB0byB0YWJsZSBtb2R1bGUKICAgICAgY29uc3Qga2V5ID0gdXAgPyAncHJldicgOiAnbmV4dCc7CiAgICAgIGNvbnN0IGNlbGwgPSBjb250ZXh0LmxpbmU7CiAgICAgIGNvbnN0IHRhcmdldFJvdyA9IGNlbGwucGFyZW50W2tleV07CiAgICAgIGlmICh0YXJnZXRSb3cgIT0gbnVsbCkgewogICAgICAgIGlmICh0YXJnZXRSb3cuc3RhdGljcy5ibG90TmFtZSA9PT0gJ3RhYmxlLXJvdycpIHsKICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IKICAgICAgICAgIGxldCB0YXJnZXRDZWxsID0gdGFyZ2V0Um93LmNoaWxkcmVuLmhlYWQ7CiAgICAgICAgICBsZXQgY3VyID0gY2VsbDsKICAgICAgICAgIHdoaWxlIChjdXIucHJldiAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IKICAgICAgICAgICAgY3VyID0gY3VyLnByZXY7CiAgICAgICAgICAgIHRhcmdldENlbGwgPSB0YXJnZXRDZWxsLm5leHQ7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBpbmRleCA9IHRhcmdldENlbGwub2Zmc2V0KHRoaXMucXVpbGwuc2Nyb2xsKSArIE1hdGgubWluKGNvbnRleHQub2Zmc2V0LCB0YXJnZXRDZWxsLmxlbmd0aCgpIC0gMSk7CiAgICAgICAgICB0aGlzLnF1aWxsLnNldFNlbGVjdGlvbihpbmRleCwgMCwgUXVpbGwuc291cmNlcy5VU0VSKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvcgogICAgICAgIGNvbnN0IHRhcmdldExpbmUgPSBjZWxsLnRhYmxlKClba2V5XTsKICAgICAgICBpZiAodGFyZ2V0TGluZSAhPSBudWxsKSB7CiAgICAgICAgICBpZiAodXApIHsKICAgICAgICAgICAgdGhpcy5xdWlsbC5zZXRTZWxlY3Rpb24odGFyZ2V0TGluZS5vZmZzZXQodGhpcy5xdWlsbC5zY3JvbGwpICsgdGFyZ2V0TGluZS5sZW5ndGgoKSAtIDEsIDAsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnF1aWxsLnNldFNlbGVjdGlvbih0YXJnZXRMaW5lLm9mZnNldCh0aGlzLnF1aWxsLnNjcm9sbCksIDAsIFF1aWxsLnNvdXJjZXMuVVNFUik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9Owp9CmZ1bmN0aW9uIG5vcm1hbGl6ZShiaW5kaW5nKSB7CiAgaWYgKHR5cGVvZiBiaW5kaW5nID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgYmluZGluZyA9PT0gJ251bWJlcicpIHsKICAgIGJpbmRpbmcgPSB7CiAgICAgIGtleTogYmluZGluZwogICAgfTsKICB9IGVsc2UgaWYgKHR5cGVvZiBiaW5kaW5nID09PSAnb2JqZWN0JykgewogICAgYmluZGluZyA9IGNsb25lRGVlcChiaW5kaW5nKTsKICB9IGVsc2UgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGlmIChiaW5kaW5nLnNob3J0S2V5KSB7CiAgICBiaW5kaW5nW1NIT1JUS0VZXSA9IGJpbmRpbmcuc2hvcnRLZXk7CiAgICBkZWxldGUgYmluZGluZy5zaG9ydEtleTsKICB9CiAgcmV0dXJuIGJpbmRpbmc7Cn0KCi8vIFRPRE86IE1vdmUgaW50byBxdWlsbC50cyBvciBlZGl0b3IudHMKZnVuY3Rpb24gZGVsZXRlUmFuZ2UoX3JlZjIpIHsKICBsZXQgewogICAgcXVpbGwsCiAgICByYW5nZQogIH0gPSBfcmVmMjsKICBjb25zdCBsaW5lcyA9IHF1aWxsLmdldExpbmVzKHJhbmdlKTsKICBsZXQgZm9ybWF0cyA9IHt9OwogIGlmIChsaW5lcy5sZW5ndGggPiAxKSB7CiAgICBjb25zdCBmaXJzdEZvcm1hdHMgPSBsaW5lc1swXS5mb3JtYXRzKCk7CiAgICBjb25zdCBsYXN0Rm9ybWF0cyA9IGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdLmZvcm1hdHMoKTsKICAgIGZvcm1hdHMgPSBBdHRyaWJ1dGVNYXAuZGlmZihsYXN0Rm9ybWF0cywgZmlyc3RGb3JtYXRzKSB8fCB7fTsKICB9CiAgcXVpbGwuZGVsZXRlVGV4dChyYW5nZSwgUXVpbGwuc291cmNlcy5VU0VSKTsKICBpZiAoT2JqZWN0LmtleXMoZm9ybWF0cykubGVuZ3RoID4gMCkgewogICAgcXVpbGwuZm9ybWF0TGluZShyYW5nZS5pbmRleCwgMSwgZm9ybWF0cywgUXVpbGwuc291cmNlcy5VU0VSKTsKICB9CiAgcXVpbGwuc2V0U2VsZWN0aW9uKHJhbmdlLmluZGV4LCBRdWlsbC5zb3VyY2VzLlNJTEVOVCk7Cn0KZnVuY3Rpb24gdGFibGVTaWRlKF90YWJsZSwgcm93LCBjZWxsLCBvZmZzZXQpIHsKICBpZiAocm93LnByZXYgPT0gbnVsbCAmJiByb3cubmV4dCA9PSBudWxsKSB7CiAgICBpZiAoY2VsbC5wcmV2ID09IG51bGwgJiYgY2VsbC5uZXh0ID09IG51bGwpIHsKICAgICAgcmV0dXJuIG9mZnNldCA9PT0gMCA/IC0xIDogMTsKICAgIH0KICAgIHJldHVybiBjZWxsLnByZXYgPT0gbnVsbCA/IC0xIDogMTsKICB9CiAgaWYgKHJvdy5wcmV2ID09IG51bGwpIHsKICAgIHJldHVybiAtMTsKICB9CiAgaWYgKHJvdy5uZXh0ID09IG51bGwpIHsKICAgIHJldHVybiAxOwogIH0KICByZXR1cm4gbnVsbDsKfQpleHBvcnQgeyBLZXlib2FyZCBhcyBkZWZhdWx0LCBTSE9SVEtFWSwgbm9ybWFsaXplLCBkZWxldGVSYW5nZSB9Ow=="},{"version":3,"names":["cloneDeep","isEqual","Delta","AttributeMap","EmbedBlot","Scope","TextBlot","Quill","logger","Module","debug","SHORTKEY","test","navigator","platform","Keyboard","match","evt","binding","some","key","which","constructor","quill","options","bindings","Object","keys","forEach","name","addBinding","shiftKey","handleEnter","metaKey","ctrlKey","altKey","userAgent","collapsed","handleBackspace","handleDelete","prefix","suffix","handleDeleteRange","offset","listen","keyBinding","context","arguments","length","undefined","handler","normalize","warn","Array","isArray","singleBinding","push","root","addEventListener","defaultPrevented","isComposing","keyCode","concat","matches","filter","blot","find","target","scroll","range","getSelection","hasFocus","line","getLine","index","leafStart","offsetStart","getLeaf","leafEnd","offsetEnd","prefixText","value","slice","suffixText","curContext","empty","format","getFormat","event","prevented","every","call","preventDefault","getLength","formats","delta","retain","delete","prev","isPrevLineEmpty","statics","blotName","curFormats","prevFormats","diff","formatDelta","compose","updateContents","sources","USER","focus","next","nextFormats","deleteRange","lineFormats","reduce","query","BLOCK","insert","setSelection","SILENT","defaultOptions","bold","makeFormatHandler","italic","underline","indent","outdent","list","makeCodeBlockHandler","deleteText","tab","table","history","cutoff","formatLine","scrollSelectionIntoView","header","module","getModule","row","cell","getTable","shift","tableSide","blockquote","trim","insertText","numLines","cur","makeEmbedArrowHandler","makeTableArrowHandler","DEFAULTS","_ref","CodeBlock","TAB","lines","getLines","i","insertAt","domNode","textContent","startsWith","deleteAt","update","where","leaf","shortKey","up","targetRow","parent","targetCell","children","head","Math","min","targetLine","_ref2","firstFormats","lastFormats","_table","default"],"sources":["../../src/modules/keyboard.ts"],"sourcesContent":["import { cloneDeep, isEqual } from 'lodash-es';\nimport Delta, { AttributeMap } from 'quill-delta';\nimport { EmbedBlot, Scope, TextBlot } from 'parchment';\nimport type { Blot, BlockBlot } from 'parchment';\nimport Quill from '../core/quill.js';\nimport logger from '../core/logger.js';\nimport Module from '../core/module.js';\nimport type { BlockEmbed } from '../blots/block.js';\nimport type { Range } from '../core/selection.js';\n\nconst debug = logger('quill:keyboard');\n\nconst SHORTKEY = /Mac/i.test(navigator.platform) ? 'metaKey' : 'ctrlKey';\n\nexport interface Context {\n  collapsed: boolean;\n  empty: boolean;\n  offset: number;\n  prefix: string;\n  suffix: string;\n  format: Record<string, unknown>;\n  event: KeyboardEvent;\n  line: BlockEmbed | BlockBlot;\n}\n\ninterface BindingObject\n  extends Partial<Omit<Context, 'prefix' | 'suffix' | 'format'>> {\n  key: number | string | string[];\n  shortKey?: boolean | null;\n  shiftKey?: boolean | null;\n  altKey?: boolean | null;\n  metaKey?: boolean | null;\n  ctrlKey?: boolean | null;\n  prefix?: RegExp;\n  suffix?: RegExp;\n  format?: Record<string, unknown> | string[];\n  handler?: (\n    this: { quill: Quill },\n    range: Range,\n    curContext: Context,\n    // eslint-disable-next-line no-use-before-define\n    binding: NormalizedBinding,\n  ) => boolean | void;\n}\n\ntype Binding = BindingObject | string | number;\n\ninterface NormalizedBinding extends Omit<BindingObject, 'key' | 'shortKey'> {\n  key: string | number;\n}\n\ninterface KeyboardOptions {\n  bindings: Record<string, Binding>;\n}\n\ninterface KeyboardOptions {\n  bindings: Record<string, Binding>;\n}\n\nclass Keyboard extends Module<KeyboardOptions> {\n  static DEFAULTS: KeyboardOptions;\n\n  static match(evt: KeyboardEvent, binding: BindingObject) {\n    if (\n      (['altKey', 'ctrlKey', 'metaKey', 'shiftKey'] as const).some((key) => {\n        return !!binding[key] !== evt[key] && binding[key] !== null;\n      })\n    ) {\n      return false;\n    }\n    return binding.key === evt.key || binding.key === evt.which;\n  }\n\n  bindings: Record<string, NormalizedBinding[]>;\n\n  constructor(quill: Quill, options: Partial<KeyboardOptions>) {\n    super(quill, options);\n    this.bindings = {};\n    // @ts-expect-error Fix me later\n    Object.keys(this.options.bindings).forEach((name) => {\n      // @ts-expect-error Fix me later\n      if (this.options.bindings[name]) {\n        // @ts-expect-error Fix me later\n        this.addBinding(this.options.bindings[name]);\n      }\n    });\n    this.addBinding({ key: 'Enter', shiftKey: null }, this.handleEnter);\n    this.addBinding(\n      { key: 'Enter', metaKey: null, ctrlKey: null, altKey: null },\n      () => {},\n    );\n    if (/Firefox/i.test(navigator.userAgent)) {\n      // Need to handle delete and backspace for Firefox in the general case #1171\n      this.addBinding(\n        { key: 'Backspace' },\n        { collapsed: true },\n        this.handleBackspace,\n      );\n      this.addBinding(\n        { key: 'Delete' },\n        { collapsed: true },\n        this.handleDelete,\n      );\n    } else {\n      this.addBinding(\n        { key: 'Backspace' },\n        { collapsed: true, prefix: /^.?$/ },\n        this.handleBackspace,\n      );\n      this.addBinding(\n        { key: 'Delete' },\n        { collapsed: true, suffix: /^.?$/ },\n        this.handleDelete,\n      );\n    }\n    this.addBinding(\n      { key: 'Backspace' },\n      { collapsed: false },\n      this.handleDeleteRange,\n    );\n    this.addBinding(\n      { key: 'Delete' },\n      { collapsed: false },\n      this.handleDeleteRange,\n    );\n    this.addBinding(\n      {\n        key: 'Backspace',\n        altKey: null,\n        ctrlKey: null,\n        metaKey: null,\n        shiftKey: null,\n      },\n      { collapsed: true, offset: 0 },\n      this.handleBackspace,\n    );\n    this.listen();\n  }\n\n  addBinding(\n    keyBinding: Binding,\n    context:\n      | Required<BindingObject['handler']>\n      | Partial<Omit<BindingObject, 'key' | 'handler'>> = {},\n    handler:\n      | Required<BindingObject['handler']>\n      | Partial<Omit<BindingObject, 'key' | 'handler'>> = {},\n  ) {\n    const binding = normalize(keyBinding);\n    if (binding == null) {\n      debug.warn('Attempted to add invalid keyboard binding', binding);\n      return;\n    }\n    if (typeof context === 'function') {\n      context = { handler: context };\n    }\n    if (typeof handler === 'function') {\n      handler = { handler };\n    }\n    const keys = Array.isArray(binding.key) ? binding.key : [binding.key];\n    keys.forEach((key) => {\n      const singleBinding = {\n        ...binding,\n        key,\n        ...context,\n        ...handler,\n      };\n      this.bindings[singleBinding.key] = this.bindings[singleBinding.key] || [];\n      this.bindings[singleBinding.key].push(singleBinding);\n    });\n  }\n\n  listen() {\n    this.quill.root.addEventListener('keydown', (evt) => {\n      if (evt.defaultPrevented || evt.isComposing) return;\n\n      // evt.isComposing is false when pressing Enter/Backspace when composing in Safari\n      // https://bugs.webkit.org/show_bug.cgi?id=165004\n      const isComposing =\n        evt.keyCode === 229 && (evt.key === 'Enter' || evt.key === 'Backspace');\n      if (isComposing) return;\n\n      const bindings = (this.bindings[evt.key] || []).concat(\n        this.bindings[evt.which] || [],\n      );\n      const matches = bindings.filter((binding) =>\n        Keyboard.match(evt, binding),\n      );\n      if (matches.length === 0) return;\n      // @ts-expect-error\n      const blot = Quill.find(evt.target, true);\n      if (blot && blot.scroll !== this.quill.scroll) return;\n      const range = this.quill.getSelection();\n      if (range == null || !this.quill.hasFocus()) return;\n      const [line, offset] = this.quill.getLine(range.index);\n      const [leafStart, offsetStart] = this.quill.getLeaf(range.index);\n      const [leafEnd, offsetEnd] =\n        range.length === 0\n          ? [leafStart, offsetStart]\n          : this.quill.getLeaf(range.index + range.length);\n      const prefixText =\n        leafStart instanceof TextBlot\n          ? leafStart.value().slice(0, offsetStart)\n          : '';\n      const suffixText =\n        leafEnd instanceof TextBlot ? leafEnd.value().slice(offsetEnd) : '';\n      const curContext = {\n        collapsed: range.length === 0,\n        // @ts-expect-error Fix me later\n        empty: range.length === 0 && line.length() <= 1,\n        format: this.quill.getFormat(range),\n        line,\n        offset,\n        prefix: prefixText,\n        suffix: suffixText,\n        event: evt,\n      };\n      const prevented = matches.some((binding) => {\n        if (\n          binding.collapsed != null &&\n          binding.collapsed !== curContext.collapsed\n        ) {\n          return false;\n        }\n        if (binding.empty != null && binding.empty !== curContext.empty) {\n          return false;\n        }\n        if (binding.offset != null && binding.offset !== curContext.offset) {\n          return false;\n        }\n        if (Array.isArray(binding.format)) {\n          // any format is present\n          if (binding.format.every((name) => curContext.format[name] == null)) {\n            return false;\n          }\n        } else if (typeof binding.format === 'object') {\n          // all formats must match\n          if (\n            !Object.keys(binding.format).every((name) => {\n              // @ts-expect-error Fix me later\n              if (binding.format[name] === true)\n                return curContext.format[name] != null;\n              // @ts-expect-error Fix me later\n              if (binding.format[name] === false)\n                return curContext.format[name] == null;\n              // @ts-expect-error Fix me later\n              return isEqual(binding.format[name], curContext.format[name]);\n            })\n          ) {\n            return false;\n          }\n        }\n        if (binding.prefix != null && !binding.prefix.test(curContext.prefix)) {\n          return false;\n        }\n        if (binding.suffix != null && !binding.suffix.test(curContext.suffix)) {\n          return false;\n        }\n        // @ts-expect-error Fix me later\n        return binding.handler.call(this, range, curContext, binding) !== true;\n      });\n      if (prevented) {\n        evt.preventDefault();\n      }\n    });\n  }\n\n  handleBackspace(range: Range, context: Context) {\n    // Check for astral symbols\n    const length = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]$/.test(context.prefix)\n      ? 2\n      : 1;\n    if (range.index === 0 || this.quill.getLength() <= 1) return;\n    let formats = {};\n    const [line] = this.quill.getLine(range.index);\n    let delta = new Delta().retain(range.index - length).delete(length);\n    if (context.offset === 0) {\n      // Always deleting newline here, length always 1\n      const [prev] = this.quill.getLine(range.index - 1);\n      if (prev) {\n        const isPrevLineEmpty =\n          prev.statics.blotName === 'block' && prev.length() <= 1;\n        if (!isPrevLineEmpty) {\n          // @ts-expect-error Fix me later\n          const curFormats = line.formats();\n          const prevFormats = this.quill.getFormat(range.index - 1, 1);\n          formats = AttributeMap.diff(curFormats, prevFormats) || {};\n          if (Object.keys(formats).length > 0) {\n            // line.length() - 1 targets \\n in line, another -1 for newline being deleted\n            const formatDelta = new Delta()\n              // @ts-expect-error Fix me later\n              .retain(range.index + line.length() - 2)\n              .retain(1, formats);\n            delta = delta.compose(formatDelta);\n          }\n        }\n      }\n    }\n    this.quill.updateContents(delta, Quill.sources.USER);\n    this.quill.focus();\n  }\n\n  handleDelete(range: Range, context: Context) {\n    // Check for astral symbols\n    const length = /^[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/.test(context.suffix)\n      ? 2\n      : 1;\n    if (range.index >= this.quill.getLength() - length) return;\n    let formats = {};\n    const [line] = this.quill.getLine(range.index);\n    let delta = new Delta().retain(range.index).delete(length);\n    // @ts-expect-error Fix me later\n    if (context.offset >= line.length() - 1) {\n      const [next] = this.quill.getLine(range.index + 1);\n      if (next) {\n        // @ts-expect-error Fix me later\n        const curFormats = line.formats();\n        const nextFormats = this.quill.getFormat(range.index, 1);\n        formats = AttributeMap.diff(curFormats, nextFormats) || {};\n        if (Object.keys(formats).length > 0) {\n          delta = delta.retain(next.length() - 1).retain(1, formats);\n        }\n      }\n    }\n    this.quill.updateContents(delta, Quill.sources.USER);\n    this.quill.focus();\n  }\n\n  handleDeleteRange(range: Range) {\n    deleteRange({ range, quill: this.quill });\n    this.quill.focus();\n  }\n\n  handleEnter(range: Range, context: Context) {\n    const lineFormats = Object.keys(context.format).reduce(\n      (formats: Record<string, unknown>, format) => {\n        if (\n          this.quill.scroll.query(format, Scope.BLOCK) &&\n          !Array.isArray(context.format[format])\n        ) {\n          formats[format] = context.format[format];\n        }\n        return formats;\n      },\n      {},\n    );\n    const delta = new Delta()\n      .retain(range.index)\n      .delete(range.length)\n      .insert('\\n', lineFormats);\n    this.quill.updateContents(delta, Quill.sources.USER);\n    this.quill.setSelection(range.index + 1, Quill.sources.SILENT);\n    this.quill.focus();\n  }\n}\n\nconst defaultOptions: KeyboardOptions = {\n  bindings: {\n    bold: makeFormatHandler('bold'),\n    italic: makeFormatHandler('italic'),\n    underline: makeFormatHandler('underline'),\n    indent: {\n      // highlight tab or tab at beginning of list, indent or blockquote\n      key: 'Tab',\n      format: ['blockquote', 'indent', 'list'],\n      handler(range, context) {\n        if (context.collapsed && context.offset !== 0) return true;\n        this.quill.format('indent', '+1', Quill.sources.USER);\n        return false;\n      },\n    },\n    outdent: {\n      key: 'Tab',\n      shiftKey: true,\n      format: ['blockquote', 'indent', 'list'],\n      // highlight tab or tab at beginning of list, indent or blockquote\n      handler(range, context) {\n        if (context.collapsed && context.offset !== 0) return true;\n        this.quill.format('indent', '-1', Quill.sources.USER);\n        return false;\n      },\n    },\n    'outdent backspace': {\n      key: 'Backspace',\n      collapsed: true,\n      shiftKey: null,\n      metaKey: null,\n      ctrlKey: null,\n      altKey: null,\n      format: ['indent', 'list'],\n      offset: 0,\n      handler(range, context) {\n        if (context.format.indent != null) {\n          this.quill.format('indent', '-1', Quill.sources.USER);\n        } else if (context.format.list != null) {\n          this.quill.format('list', false, Quill.sources.USER);\n        }\n      },\n    },\n    'indent code-block': makeCodeBlockHandler(true),\n    'outdent code-block': makeCodeBlockHandler(false),\n    'remove tab': {\n      key: 'Tab',\n      shiftKey: true,\n      collapsed: true,\n      prefix: /\\t$/,\n      handler(range) {\n        this.quill.deleteText(range.index - 1, 1, Quill.sources.USER);\n      },\n    },\n    tab: {\n      key: 'Tab',\n      handler(range, context) {\n        if (context.format.table) return true;\n        this.quill.history.cutoff();\n        const delta = new Delta()\n          .retain(range.index)\n          .delete(range.length)\n          .insert('\\t');\n        this.quill.updateContents(delta, Quill.sources.USER);\n        this.quill.history.cutoff();\n        this.quill.setSelection(range.index + 1, Quill.sources.SILENT);\n        return false;\n      },\n    },\n    'blockquote empty enter': {\n      key: 'Enter',\n      collapsed: true,\n      format: ['blockquote'],\n      empty: true,\n      handler() {\n        this.quill.format('blockquote', false, Quill.sources.USER);\n      },\n    },\n    'list empty enter': {\n      key: 'Enter',\n      collapsed: true,\n      format: ['list'],\n      empty: true,\n      handler(range, context) {\n        const formats: Record<string, unknown> = { list: false };\n        if (context.format.indent) {\n          formats.indent = false;\n        }\n        this.quill.formatLine(\n          range.index,\n          range.length,\n          formats,\n          Quill.sources.USER,\n        );\n      },\n    },\n    'checklist enter': {\n      key: 'Enter',\n      collapsed: true,\n      format: { list: 'checked' },\n      handler(range) {\n        const [line, offset] = this.quill.getLine(range.index);\n        const formats = {\n          // @ts-expect-error Fix me later\n          ...line.formats(),\n          list: 'checked',\n        };\n        const delta = new Delta()\n          .retain(range.index)\n          .insert('\\n', formats)\n          // @ts-expect-error Fix me later\n          .retain(line.length() - offset - 1)\n          .retain(1, { list: 'unchecked' });\n        this.quill.updateContents(delta, Quill.sources.USER);\n        this.quill.setSelection(range.index + 1, Quill.sources.SILENT);\n        this.quill.scrollSelectionIntoView();\n      },\n    },\n    'header enter': {\n      key: 'Enter',\n      collapsed: true,\n      format: ['header'],\n      suffix: /^$/,\n      handler(range, context) {\n        const [line, offset] = this.quill.getLine(range.index);\n        const delta = new Delta()\n          .retain(range.index)\n          .insert('\\n', context.format)\n          // @ts-expect-error Fix me later\n          .retain(line.length() - offset - 1)\n          .retain(1, { header: null });\n        this.quill.updateContents(delta, Quill.sources.USER);\n        this.quill.setSelection(range.index + 1, Quill.sources.SILENT);\n        this.quill.scrollSelectionIntoView();\n      },\n    },\n    'table backspace': {\n      key: 'Backspace',\n      format: ['table'],\n      collapsed: true,\n      offset: 0,\n      handler() {},\n    },\n    'table delete': {\n      key: 'Delete',\n      format: ['table'],\n      collapsed: true,\n      suffix: /^$/,\n      handler() {},\n    },\n    'table enter': {\n      key: 'Enter',\n      shiftKey: null,\n      format: ['table'],\n      handler(range) {\n        const module = this.quill.getModule('table');\n        if (module) {\n          // @ts-expect-error\n          const [table, row, cell, offset] = module.getTable(range);\n          const shift = tableSide(table, row, cell, offset);\n          if (shift == null) return;\n          let index = table.offset();\n          if (shift < 0) {\n            const delta = new Delta().retain(index).insert('\\n');\n            this.quill.updateContents(delta, Quill.sources.USER);\n            this.quill.setSelection(\n              range.index + 1,\n              range.length,\n              Quill.sources.SILENT,\n            );\n          } else if (shift > 0) {\n            index += table.length();\n            const delta = new Delta().retain(index).insert('\\n');\n            this.quill.updateContents(delta, Quill.sources.USER);\n            this.quill.setSelection(index, Quill.sources.USER);\n          }\n        }\n      },\n    },\n    'table tab': {\n      key: 'Tab',\n      shiftKey: null,\n      format: ['table'],\n      handler(range, context) {\n        const { event, line: cell } = context;\n        const offset = cell.offset(this.quill.scroll);\n        if (event.shiftKey) {\n          this.quill.setSelection(offset - 1, Quill.sources.USER);\n        } else {\n          this.quill.setSelection(offset + cell.length(), Quill.sources.USER);\n        }\n      },\n    },\n    'list autofill': {\n      key: ' ',\n      shiftKey: null,\n      collapsed: true,\n      format: {\n        'code-block': false,\n        blockquote: false,\n        table: false,\n      },\n      prefix: /^\\s*?(\\d+\\.|-|\\*|\\[ ?\\]|\\[x\\])$/,\n      handler(range, context) {\n        if (this.quill.scroll.query('list') == null) return true;\n        const { length } = context.prefix;\n        const [line, offset] = this.quill.getLine(range.index);\n        if (offset > length) return true;\n        let value;\n        switch (context.prefix.trim()) {\n          case '[]':\n          case '[ ]':\n            value = 'unchecked';\n            break;\n          case '[x]':\n            value = 'checked';\n            break;\n          case '-':\n          case '*':\n            value = 'bullet';\n            break;\n          default:\n            value = 'ordered';\n        }\n        this.quill.insertText(range.index, ' ', Quill.sources.USER);\n        this.quill.history.cutoff();\n        const delta = new Delta()\n          .retain(range.index - offset)\n          .delete(length + 1)\n          // @ts-expect-error Fix me later\n          .retain(line.length() - 2 - offset)\n          .retain(1, { list: value });\n        this.quill.updateContents(delta, Quill.sources.USER);\n        this.quill.history.cutoff();\n        this.quill.setSelection(range.index - length, Quill.sources.SILENT);\n        return false;\n      },\n    },\n    'code exit': {\n      key: 'Enter',\n      collapsed: true,\n      format: ['code-block'],\n      prefix: /^$/,\n      suffix: /^\\s*$/,\n      handler(range) {\n        const [line, offset] = this.quill.getLine(range.index);\n        let numLines = 2;\n        let cur = line;\n        while (\n          cur != null &&\n          cur.length() <= 1 &&\n          cur.formats()['code-block']\n        ) {\n          // @ts-expect-error\n          cur = cur.prev;\n          numLines -= 1;\n          // Requisite prev lines are empty\n          if (numLines <= 0) {\n            const delta = new Delta()\n              // @ts-expect-error Fix me later\n              .retain(range.index + line.length() - offset - 2)\n              .retain(1, { 'code-block': null })\n              .delete(1);\n            this.quill.updateContents(delta, Quill.sources.USER);\n            this.quill.setSelection(range.index - 1, Quill.sources.SILENT);\n            return false;\n          }\n        }\n        return true;\n      },\n    },\n    'embed left': makeEmbedArrowHandler('ArrowLeft', false),\n    'embed left shift': makeEmbedArrowHandler('ArrowLeft', true),\n    'embed right': makeEmbedArrowHandler('ArrowRight', false),\n    'embed right shift': makeEmbedArrowHandler('ArrowRight', true),\n    'table down': makeTableArrowHandler(false),\n    'table up': makeTableArrowHandler(true),\n  },\n};\n\nKeyboard.DEFAULTS = defaultOptions;\n\nfunction makeCodeBlockHandler(indent: boolean): BindingObject {\n  return {\n    key: 'Tab',\n    shiftKey: !indent,\n    format: { 'code-block': true },\n    handler(range, { event }) {\n      const CodeBlock = this.quill.scroll.query('code-block');\n      // @ts-expect-error\n      const { TAB } = CodeBlock;\n      if (range.length === 0 && !event.shiftKey) {\n        this.quill.insertText(range.index, TAB, Quill.sources.USER);\n        this.quill.setSelection(range.index + TAB.length, Quill.sources.SILENT);\n        return;\n      }\n\n      const lines =\n        range.length === 0\n          ? this.quill.getLines(range.index, 1)\n          : this.quill.getLines(range);\n      let { index, length } = range;\n      lines.forEach((line, i) => {\n        if (indent) {\n          line.insertAt(0, TAB);\n          if (i === 0) {\n            index += TAB.length;\n          } else {\n            length += TAB.length;\n          }\n          // @ts-expect-error Fix me later\n        } else if (line.domNode.textContent.startsWith(TAB)) {\n          line.deleteAt(0, TAB.length);\n          if (i === 0) {\n            index -= TAB.length;\n          } else {\n            length -= TAB.length;\n          }\n        }\n      });\n      this.quill.update(Quill.sources.USER);\n      this.quill.setSelection(index, length, Quill.sources.SILENT);\n    },\n  };\n}\n\nfunction makeEmbedArrowHandler(\n  key: string,\n  shiftKey: boolean | null,\n): BindingObject {\n  const where = key === 'ArrowLeft' ? 'prefix' : 'suffix';\n  return {\n    key,\n    shiftKey,\n    altKey: null,\n    [where]: /^$/,\n    handler(range) {\n      let { index } = range;\n      if (key === 'ArrowRight') {\n        index += range.length + 1;\n      }\n      const [leaf] = this.quill.getLeaf(index);\n      if (!(leaf instanceof EmbedBlot)) return true;\n      if (key === 'ArrowLeft') {\n        if (shiftKey) {\n          this.quill.setSelection(\n            range.index - 1,\n            range.length + 1,\n            Quill.sources.USER,\n          );\n        } else {\n          this.quill.setSelection(range.index - 1, Quill.sources.USER);\n        }\n      } else if (shiftKey) {\n        this.quill.setSelection(\n          range.index,\n          range.length + 1,\n          Quill.sources.USER,\n        );\n      } else {\n        this.quill.setSelection(\n          range.index + range.length + 1,\n          Quill.sources.USER,\n        );\n      }\n      return false;\n    },\n  };\n}\n\nfunction makeFormatHandler(format: string): BindingObject {\n  return {\n    key: format[0],\n    shortKey: true,\n    handler(range, context) {\n      this.quill.format(format, !context.format[format], Quill.sources.USER);\n    },\n  };\n}\n\nfunction makeTableArrowHandler(up: boolean): BindingObject {\n  return {\n    key: up ? 'ArrowUp' : 'ArrowDown',\n    collapsed: true,\n    format: ['table'],\n    handler(range, context) {\n      // TODO move to table module\n      const key = up ? 'prev' : 'next';\n      const cell = context.line;\n      const targetRow = cell.parent[key];\n      if (targetRow != null) {\n        if (targetRow.statics.blotName === 'table-row') {\n          // @ts-expect-error\n          let targetCell = targetRow.children.head;\n          let cur = cell;\n          while (cur.prev != null) {\n            // @ts-expect-error\n            cur = cur.prev;\n            targetCell = targetCell.next;\n          }\n          const index =\n            targetCell.offset(this.quill.scroll) +\n            Math.min(context.offset, targetCell.length() - 1);\n          this.quill.setSelection(index, 0, Quill.sources.USER);\n        }\n      } else {\n        // @ts-expect-error\n        const targetLine = cell.table()[key];\n        if (targetLine != null) {\n          if (up) {\n            this.quill.setSelection(\n              targetLine.offset(this.quill.scroll) + targetLine.length() - 1,\n              0,\n              Quill.sources.USER,\n            );\n          } else {\n            this.quill.setSelection(\n              targetLine.offset(this.quill.scroll),\n              0,\n              Quill.sources.USER,\n            );\n          }\n        }\n      }\n      return false;\n    },\n  };\n}\n\nfunction normalize(binding: Binding): BindingObject | null {\n  if (typeof binding === 'string' || typeof binding === 'number') {\n    binding = { key: binding };\n  } else if (typeof binding === 'object') {\n    binding = cloneDeep(binding);\n  } else {\n    return null;\n  }\n  if (binding.shortKey) {\n    binding[SHORTKEY] = binding.shortKey;\n    delete binding.shortKey;\n  }\n  return binding;\n}\n\n// TODO: Move into quill.ts or editor.ts\nfunction deleteRange({ quill, range }: { quill: Quill; range: Range }) {\n  const lines = quill.getLines(range);\n  let formats = {};\n  if (lines.length > 1) {\n    const firstFormats = lines[0].formats();\n    const lastFormats = lines[lines.length - 1].formats();\n    formats = AttributeMap.diff(lastFormats, firstFormats) || {};\n  }\n  quill.deleteText(range, Quill.sources.USER);\n  if (Object.keys(formats).length > 0) {\n    quill.formatLine(range.index, 1, formats, Quill.sources.USER);\n  }\n  quill.setSelection(range.index, Quill.sources.SILENT);\n}\n\nfunction tableSide(_table: unknown, row: Blot, cell: Blot, offset: number) {\n  if (row.prev == null && row.next == null) {\n    if (cell.prev == null && cell.next == null) {\n      return offset === 0 ? -1 : 1;\n    }\n    return cell.prev == null ? -1 : 1;\n  }\n  if (row.prev == null) {\n    return -1;\n  }\n  if (row.next == null) {\n    return 1;\n  }\n  return null;\n}\n\nexport { Keyboard as default, SHORTKEY, normalize, deleteRange };\n"],"mappings":"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","ignoreList":[]}]}