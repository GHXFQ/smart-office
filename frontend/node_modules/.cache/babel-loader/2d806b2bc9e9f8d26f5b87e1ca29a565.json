{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\quill\\blots\\scroll.js","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\quill\\blots\\scroll.js","mtime":1751792162280},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\babel.config.js","mtime":1748077811200},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1746431219000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":1746431202000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJDOi9Vc2Vycy8xODA4My9EZXNrdG9wL0NDSVQvb2ZmaWNlL3NtYXJ0LW9mZmljZS9mcm9udGVuZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maWx0ZXIuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5yZWR1Y2UuanMiOwppbXBvcnQgeyBDb250YWluZXJCbG90LCBMZWFmQmxvdCwgU2NvcGUsIFNjcm9sbEJsb3QgfSBmcm9tICdwYXJjaG1lbnQnOwppbXBvcnQgRGVsdGEsIHsgQXR0cmlidXRlTWFwLCBPcCB9IGZyb20gJ3F1aWxsLWRlbHRhJzsKaW1wb3J0IEVtaXR0ZXIgZnJvbSAnLi4vY29yZS9lbWl0dGVyLmpzJzsKaW1wb3J0IEJsb2NrLCB7IEJsb2NrRW1iZWQsIGJ1YmJsZUZvcm1hdHMgfSBmcm9tICcuL2Jsb2NrLmpzJzsKaW1wb3J0IEJyZWFrIGZyb20gJy4vYnJlYWsuanMnOwppbXBvcnQgQ29udGFpbmVyIGZyb20gJy4vY29udGFpbmVyLmpzJzsKZnVuY3Rpb24gaXNMaW5lKGJsb3QpIHsKICByZXR1cm4gYmxvdCBpbnN0YW5jZW9mIEJsb2NrIHx8IGJsb3QgaW5zdGFuY2VvZiBCbG9ja0VtYmVkOwp9CmZ1bmN0aW9uIGlzVXBkYXRhYmxlKGJsb3QpIHsKICByZXR1cm4gdHlwZW9mIGJsb3QudXBkYXRlQ29udGVudCA9PT0gJ2Z1bmN0aW9uJzsKfQpjbGFzcyBTY3JvbGwgZXh0ZW5kcyBTY3JvbGxCbG90IHsKICBjb25zdHJ1Y3RvcihyZWdpc3RyeSwgZG9tTm9kZSwgX3JlZikgewogICAgbGV0IHsKICAgICAgZW1pdHRlcgogICAgfSA9IF9yZWY7CiAgICBzdXBlcihyZWdpc3RyeSwgZG9tTm9kZSk7CiAgICB0aGlzLmVtaXR0ZXIgPSBlbWl0dGVyOwogICAgdGhpcy5iYXRjaCA9IGZhbHNlOwogICAgdGhpcy5vcHRpbWl6ZSgpOwogICAgdGhpcy5lbmFibGUoKTsKICAgIHRoaXMuZG9tTm9kZS5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCBlID0+IHRoaXMuaGFuZGxlRHJhZ1N0YXJ0KGUpKTsKICB9CiAgYmF0Y2hTdGFydCgpIHsKICAgIGlmICghQXJyYXkuaXNBcnJheSh0aGlzLmJhdGNoKSkgewogICAgICB0aGlzLmJhdGNoID0gW107CiAgICB9CiAgfQogIGJhdGNoRW5kKCkgewogICAgaWYgKCF0aGlzLmJhdGNoKSByZXR1cm47CiAgICBjb25zdCBtdXRhdGlvbnMgPSB0aGlzLmJhdGNoOwogICAgdGhpcy5iYXRjaCA9IGZhbHNlOwogICAgdGhpcy51cGRhdGUobXV0YXRpb25zKTsKICB9CiAgZW1pdE1vdW50KGJsb3QpIHsKICAgIHRoaXMuZW1pdHRlci5lbWl0KEVtaXR0ZXIuZXZlbnRzLlNDUk9MTF9CTE9UX01PVU5ULCBibG90KTsKICB9CiAgZW1pdFVubW91bnQoYmxvdCkgewogICAgdGhpcy5lbWl0dGVyLmVtaXQoRW1pdHRlci5ldmVudHMuU0NST0xMX0JMT1RfVU5NT1VOVCwgYmxvdCk7CiAgfQogIGVtaXRFbWJlZFVwZGF0ZShibG90LCBjaGFuZ2UpIHsKICAgIHRoaXMuZW1pdHRlci5lbWl0KEVtaXR0ZXIuZXZlbnRzLlNDUk9MTF9FTUJFRF9VUERBVEUsIGJsb3QsIGNoYW5nZSk7CiAgfQogIGRlbGV0ZUF0KGluZGV4LCBsZW5ndGgpIHsKICAgIGNvbnN0IFtmaXJzdCwgb2Zmc2V0XSA9IHRoaXMubGluZShpbmRleCk7CiAgICBjb25zdCBbbGFzdF0gPSB0aGlzLmxpbmUoaW5kZXggKyBsZW5ndGgpOwogICAgc3VwZXIuZGVsZXRlQXQoaW5kZXgsIGxlbmd0aCk7CiAgICBpZiAobGFzdCAhPSBudWxsICYmIGZpcnN0ICE9PSBsYXN0ICYmIG9mZnNldCA+IDApIHsKICAgICAgaWYgKGZpcnN0IGluc3RhbmNlb2YgQmxvY2tFbWJlZCB8fCBsYXN0IGluc3RhbmNlb2YgQmxvY2tFbWJlZCkgewogICAgICAgIHRoaXMub3B0aW1pemUoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgcmVmID0gbGFzdC5jaGlsZHJlbi5oZWFkIGluc3RhbmNlb2YgQnJlYWsgPyBudWxsIDogbGFzdC5jaGlsZHJlbi5oZWFkOwogICAgICAvLyBAdHMtZXhwZWN0LWVycm9yCiAgICAgIGZpcnN0Lm1vdmVDaGlsZHJlbihsYXN0LCByZWYpOwogICAgICAvLyBAdHMtZXhwZWN0LWVycm9yCiAgICAgIGZpcnN0LnJlbW92ZSgpOwogICAgfQogICAgdGhpcy5vcHRpbWl6ZSgpOwogIH0KICBlbmFibGUoKSB7CiAgICBsZXQgZW5hYmxlZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogdHJ1ZTsKICAgIHRoaXMuZG9tTm9kZS5zZXRBdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScsIGVuYWJsZWQgPyAndHJ1ZScgOiAnZmFsc2UnKTsKICB9CiAgZm9ybWF0QXQoaW5kZXgsIGxlbmd0aCwgZm9ybWF0LCB2YWx1ZSkgewogICAgc3VwZXIuZm9ybWF0QXQoaW5kZXgsIGxlbmd0aCwgZm9ybWF0LCB2YWx1ZSk7CiAgICB0aGlzLm9wdGltaXplKCk7CiAgfQogIGluc2VydEF0KGluZGV4LCB2YWx1ZSwgZGVmKSB7CiAgICBpZiAoaW5kZXggPj0gdGhpcy5sZW5ndGgoKSkgewogICAgICBpZiAoZGVmID09IG51bGwgfHwgdGhpcy5zY3JvbGwucXVlcnkodmFsdWUsIFNjb3BlLkJMT0NLKSA9PSBudWxsKSB7CiAgICAgICAgY29uc3QgYmxvdCA9IHRoaXMuc2Nyb2xsLmNyZWF0ZSh0aGlzLnN0YXRpY3MuZGVmYXVsdENoaWxkLmJsb3ROYW1lKTsKICAgICAgICB0aGlzLmFwcGVuZENoaWxkKGJsb3QpOwogICAgICAgIGlmIChkZWYgPT0gbnVsbCAmJiB2YWx1ZS5lbmRzV2l0aCgnXG4nKSkgewogICAgICAgICAgYmxvdC5pbnNlcnRBdCgwLCB2YWx1ZS5zbGljZSgwLCAtMSksIGRlZik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJsb3QuaW5zZXJ0QXQoMCwgdmFsdWUsIGRlZik7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGVtYmVkID0gdGhpcy5zY3JvbGwuY3JlYXRlKHZhbHVlLCBkZWYpOwogICAgICAgIHRoaXMuYXBwZW5kQ2hpbGQoZW1iZWQpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBzdXBlci5pbnNlcnRBdChpbmRleCwgdmFsdWUsIGRlZik7CiAgICB9CiAgICB0aGlzLm9wdGltaXplKCk7CiAgfQogIGluc2VydEJlZm9yZShibG90LCByZWYpIHsKICAgIGlmIChibG90LnN0YXRpY3Muc2NvcGUgPT09IFNjb3BlLklOTElORV9CTE9UKSB7CiAgICAgIGNvbnN0IHdyYXBwZXIgPSB0aGlzLnNjcm9sbC5jcmVhdGUodGhpcy5zdGF0aWNzLmRlZmF1bHRDaGlsZC5ibG90TmFtZSk7CiAgICAgIHdyYXBwZXIuYXBwZW5kQ2hpbGQoYmxvdCk7CiAgICAgIHN1cGVyLmluc2VydEJlZm9yZSh3cmFwcGVyLCByZWYpOwogICAgfSBlbHNlIHsKICAgICAgc3VwZXIuaW5zZXJ0QmVmb3JlKGJsb3QsIHJlZik7CiAgICB9CiAgfQogIGluc2VydENvbnRlbnRzKGluZGV4LCBkZWx0YSkgewogICAgY29uc3QgcmVuZGVyQmxvY2tzID0gdGhpcy5kZWx0YVRvUmVuZGVyQmxvY2tzKGRlbHRhLmNvbmNhdChuZXcgRGVsdGEoKS5pbnNlcnQoJ1xuJykpKTsKICAgIGNvbnN0IGxhc3QgPSByZW5kZXJCbG9ja3MucG9wKCk7CiAgICBpZiAobGFzdCA9PSBudWxsKSByZXR1cm47CiAgICB0aGlzLmJhdGNoU3RhcnQoKTsKICAgIGNvbnN0IGZpcnN0ID0gcmVuZGVyQmxvY2tzLnNoaWZ0KCk7CiAgICBpZiAoZmlyc3QpIHsKICAgICAgY29uc3Qgc2hvdWxkSW5zZXJ0TmV3bGluZUNoYXIgPSBmaXJzdC50eXBlID09PSAnYmxvY2snICYmIChmaXJzdC5kZWx0YS5sZW5ndGgoKSA9PT0gMCB8fCAhdGhpcy5kZXNjZW5kYW50KEJsb2NrRW1iZWQsIGluZGV4KVswXSAmJiBpbmRleCA8IHRoaXMubGVuZ3RoKCkpOwogICAgICBjb25zdCBkZWx0YSA9IGZpcnN0LnR5cGUgPT09ICdibG9jaycgPyBmaXJzdC5kZWx0YSA6IG5ldyBEZWx0YSgpLmluc2VydCh7CiAgICAgICAgW2ZpcnN0LmtleV06IGZpcnN0LnZhbHVlCiAgICAgIH0pOwogICAgICBpbnNlcnRJbmxpbmVDb250ZW50cyh0aGlzLCBpbmRleCwgZGVsdGEpOwogICAgICBjb25zdCBuZXdsaW5lQ2hhckxlbmd0aCA9IGZpcnN0LnR5cGUgPT09ICdibG9jaycgPyAxIDogMDsKICAgICAgY29uc3QgbGluZUVuZEluZGV4ID0gaW5kZXggKyBkZWx0YS5sZW5ndGgoKSArIG5ld2xpbmVDaGFyTGVuZ3RoOwogICAgICBpZiAoc2hvdWxkSW5zZXJ0TmV3bGluZUNoYXIpIHsKICAgICAgICB0aGlzLmluc2VydEF0KGxpbmVFbmRJbmRleCAtIDEsICdcbicpOwogICAgICB9CiAgICAgIGNvbnN0IGZvcm1hdHMgPSBidWJibGVGb3JtYXRzKHRoaXMubGluZShpbmRleClbMF0pOwogICAgICBjb25zdCBhdHRyaWJ1dGVzID0gQXR0cmlidXRlTWFwLmRpZmYoZm9ybWF0cywgZmlyc3QuYXR0cmlidXRlcykgfHwge307CiAgICAgIE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLmZvckVhY2gobmFtZSA9PiB7CiAgICAgICAgdGhpcy5mb3JtYXRBdChsaW5lRW5kSW5kZXggLSAxLCAxLCBuYW1lLCBhdHRyaWJ1dGVzW25hbWVdKTsKICAgICAgfSk7CiAgICAgIGluZGV4ID0gbGluZUVuZEluZGV4OwogICAgfQogICAgbGV0IFtyZWZCbG90LCByZWZCbG90T2Zmc2V0XSA9IHRoaXMuY2hpbGRyZW4uZmluZChpbmRleCk7CiAgICBpZiAocmVuZGVyQmxvY2tzLmxlbmd0aCkgewogICAgICBpZiAocmVmQmxvdCkgewogICAgICAgIHJlZkJsb3QgPSByZWZCbG90LnNwbGl0KHJlZkJsb3RPZmZzZXQpOwogICAgICAgIHJlZkJsb3RPZmZzZXQgPSAwOwogICAgICB9CiAgICAgIHJlbmRlckJsb2Nrcy5mb3JFYWNoKHJlbmRlckJsb2NrID0+IHsKICAgICAgICBpZiAocmVuZGVyQmxvY2sudHlwZSA9PT0gJ2Jsb2NrJykgewogICAgICAgICAgY29uc3QgYmxvY2sgPSB0aGlzLmNyZWF0ZUJsb2NrKHJlbmRlckJsb2NrLmF0dHJpYnV0ZXMsIHJlZkJsb3QgfHwgdW5kZWZpbmVkKTsKICAgICAgICAgIGluc2VydElubGluZUNvbnRlbnRzKGJsb2NrLCAwLCByZW5kZXJCbG9jay5kZWx0YSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGJsb2NrRW1iZWQgPSB0aGlzLmNyZWF0ZShyZW5kZXJCbG9jay5rZXksIHJlbmRlckJsb2NrLnZhbHVlKTsKICAgICAgICAgIHRoaXMuaW5zZXJ0QmVmb3JlKGJsb2NrRW1iZWQsIHJlZkJsb3QgfHwgdW5kZWZpbmVkKTsKICAgICAgICAgIE9iamVjdC5rZXlzKHJlbmRlckJsb2NrLmF0dHJpYnV0ZXMpLmZvckVhY2gobmFtZSA9PiB7CiAgICAgICAgICAgIGJsb2NrRW1iZWQuZm9ybWF0KG5hbWUsIHJlbmRlckJsb2NrLmF0dHJpYnV0ZXNbbmFtZV0pOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIGlmIChsYXN0LnR5cGUgPT09ICdibG9jaycgJiYgbGFzdC5kZWx0YS5sZW5ndGgoKSkgewogICAgICBjb25zdCBvZmZzZXQgPSByZWZCbG90ID8gcmVmQmxvdC5vZmZzZXQocmVmQmxvdC5zY3JvbGwpICsgcmVmQmxvdE9mZnNldCA6IHRoaXMubGVuZ3RoKCk7CiAgICAgIGluc2VydElubGluZUNvbnRlbnRzKHRoaXMsIG9mZnNldCwgbGFzdC5kZWx0YSk7CiAgICB9CiAgICB0aGlzLmJhdGNoRW5kKCk7CiAgICB0aGlzLm9wdGltaXplKCk7CiAgfQogIGlzRW5hYmxlZCgpIHsKICAgIHJldHVybiB0aGlzLmRvbU5vZGUuZ2V0QXR0cmlidXRlKCdjb250ZW50ZWRpdGFibGUnKSA9PT0gJ3RydWUnOwogIH0KICBsZWFmKGluZGV4KSB7CiAgICBjb25zdCBsYXN0ID0gdGhpcy5wYXRoKGluZGV4KS5wb3AoKTsKICAgIGlmICghbGFzdCkgewogICAgICByZXR1cm4gW251bGwsIC0xXTsKICAgIH0KICAgIGNvbnN0IFtibG90LCBvZmZzZXRdID0gbGFzdDsKICAgIHJldHVybiBibG90IGluc3RhbmNlb2YgTGVhZkJsb3QgPyBbYmxvdCwgb2Zmc2V0XSA6IFtudWxsLCAtMV07CiAgfQogIGxpbmUoaW5kZXgpIHsKICAgIGlmIChpbmRleCA9PT0gdGhpcy5sZW5ndGgoKSkgewogICAgICByZXR1cm4gdGhpcy5saW5lKGluZGV4IC0gMSk7CiAgICB9CiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IG1ha2UgZGVzY2VuZGFudCgpIGdlbmVyaWMKICAgIHJldHVybiB0aGlzLmRlc2NlbmRhbnQoaXNMaW5lLCBpbmRleCk7CiAgfQogIGxpbmVzKCkgewogICAgbGV0IGluZGV4ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAwOwogICAgbGV0IGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogTnVtYmVyLk1BWF9WQUxVRTsKICAgIGNvbnN0IGdldExpbmVzID0gKGJsb3QsIGJsb3RJbmRleCwgYmxvdExlbmd0aCkgPT4gewogICAgICBsZXQgbGluZXMgPSBbXTsKICAgICAgbGV0IGxlbmd0aExlZnQgPSBibG90TGVuZ3RoOwogICAgICBibG90LmNoaWxkcmVuLmZvckVhY2hBdChibG90SW5kZXgsIGJsb3RMZW5ndGgsIChjaGlsZCwgY2hpbGRJbmRleCwgY2hpbGRMZW5ndGgpID0+IHsKICAgICAgICBpZiAoaXNMaW5lKGNoaWxkKSkgewogICAgICAgICAgbGluZXMucHVzaChjaGlsZCk7CiAgICAgICAgfSBlbHNlIGlmIChjaGlsZCBpbnN0YW5jZW9mIENvbnRhaW5lckJsb3QpIHsKICAgICAgICAgIGxpbmVzID0gbGluZXMuY29uY2F0KGdldExpbmVzKGNoaWxkLCBjaGlsZEluZGV4LCBsZW5ndGhMZWZ0KSk7CiAgICAgICAgfQogICAgICAgIGxlbmd0aExlZnQgLT0gY2hpbGRMZW5ndGg7CiAgICAgIH0pOwogICAgICByZXR1cm4gbGluZXM7CiAgICB9OwogICAgcmV0dXJuIGdldExpbmVzKHRoaXMsIGluZGV4LCBsZW5ndGgpOwogIH0KICBvcHRpbWl6ZSgpIHsKICAgIGxldCBtdXRhdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOwogICAgbGV0IGNvbnRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgaWYgKHRoaXMuYmF0Y2gpIHJldHVybjsKICAgIHN1cGVyLm9wdGltaXplKG11dGF0aW9ucywgY29udGV4dCk7CiAgICBpZiAobXV0YXRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgdGhpcy5lbWl0dGVyLmVtaXQoRW1pdHRlci5ldmVudHMuU0NST0xMX09QVElNSVpFLCBtdXRhdGlvbnMsIGNvbnRleHQpOwogICAgfQogIH0KICBwYXRoKGluZGV4KSB7CiAgICByZXR1cm4gc3VwZXIucGF0aChpbmRleCkuc2xpY2UoMSk7IC8vIEV4Y2x1ZGUgc2VsZgogIH0KICByZW1vdmUoKSB7CiAgICAvLyBOZXZlciByZW1vdmUgc2VsZgogIH0KICB1cGRhdGUobXV0YXRpb25zKSB7CiAgICBpZiAodGhpcy5iYXRjaCkgewogICAgICBpZiAoQXJyYXkuaXNBcnJheShtdXRhdGlvbnMpKSB7CiAgICAgICAgdGhpcy5iYXRjaCA9IHRoaXMuYmF0Y2guY29uY2F0KG11dGF0aW9ucyk7CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IHNvdXJjZSA9IEVtaXR0ZXIuc291cmNlcy5VU0VSOwogICAgaWYgKHR5cGVvZiBtdXRhdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgIHNvdXJjZSA9IG11dGF0aW9uczsKICAgIH0KICAgIGlmICghQXJyYXkuaXNBcnJheShtdXRhdGlvbnMpKSB7CiAgICAgIG11dGF0aW9ucyA9IHRoaXMub2JzZXJ2ZXIudGFrZVJlY29yZHMoKTsKICAgIH0KICAgIG11dGF0aW9ucyA9IG11dGF0aW9ucy5maWx0ZXIoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHRhcmdldAogICAgICB9ID0gX3JlZjI7CiAgICAgIGNvbnN0IGJsb3QgPSB0aGlzLmZpbmQodGFyZ2V0LCB0cnVlKTsKICAgICAgcmV0dXJuIGJsb3QgJiYgIWlzVXBkYXRhYmxlKGJsb3QpOwogICAgfSk7CiAgICBpZiAobXV0YXRpb25zLmxlbmd0aCA+IDApIHsKICAgICAgdGhpcy5lbWl0dGVyLmVtaXQoRW1pdHRlci5ldmVudHMuU0NST0xMX0JFRk9SRV9VUERBVEUsIHNvdXJjZSwgbXV0YXRpb25zKTsKICAgIH0KICAgIHN1cGVyLnVwZGF0ZShtdXRhdGlvbnMuY29uY2F0KFtdKSk7IC8vIHBhc3MgY29weQogICAgaWYgKG11dGF0aW9ucy5sZW5ndGggPiAwKSB7CiAgICAgIHRoaXMuZW1pdHRlci5lbWl0KEVtaXR0ZXIuZXZlbnRzLlNDUk9MTF9VUERBVEUsIHNvdXJjZSwgbXV0YXRpb25zKTsKICAgIH0KICB9CiAgdXBkYXRlRW1iZWRBdChpbmRleCwga2V5LCBjaGFuZ2UpIHsKICAgIC8vIEN1cnJlbnRseSBpdCBvbmx5IHN1cHBvcnRzIHRvcC1sZXZlbCBlbWJlZHMgKEJsb2NrRW1iZWQpLgogICAgLy8gV2UgY2FuIHVwZGF0ZSBgUGFyZW50QmxvdGAgaW4gcGFyY2htZW50IHRvIHN1cHBvcnQgaW5saW5lIGVtYmVkcy4KICAgIGNvbnN0IFtibG90XSA9IHRoaXMuZGVzY2VuZGFudChiID0+IGIgaW5zdGFuY2VvZiBCbG9ja0VtYmVkLCBpbmRleCk7CiAgICBpZiAoYmxvdCAmJiBibG90LnN0YXRpY3MuYmxvdE5hbWUgPT09IGtleSAmJiBpc1VwZGF0YWJsZShibG90KSkgewogICAgICBibG90LnVwZGF0ZUNvbnRlbnQoY2hhbmdlKTsKICAgIH0KICB9CiAgaGFuZGxlRHJhZ1N0YXJ0KGV2ZW50KSB7CiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogIH0KICBkZWx0YVRvUmVuZGVyQmxvY2tzKGRlbHRhKSB7CiAgICBjb25zdCByZW5kZXJCbG9ja3MgPSBbXTsKICAgIGxldCBjdXJyZW50QmxvY2tEZWx0YSA9IG5ldyBEZWx0YSgpOwogICAgZGVsdGEuZm9yRWFjaChvcCA9PiB7CiAgICAgIGNvbnN0IGluc2VydCA9IG9wID09PSBudWxsIHx8IG9wID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcC5pbnNlcnQ7CiAgICAgIGlmICghaW5zZXJ0KSByZXR1cm47CiAgICAgIGlmICh0eXBlb2YgaW5zZXJ0ID09PSAnc3RyaW5nJykgewogICAgICAgIGNvbnN0IHNwbGl0dGVkID0gaW5zZXJ0LnNwbGl0KCdcbicpOwogICAgICAgIHNwbGl0dGVkLnNsaWNlKDAsIC0xKS5mb3JFYWNoKHRleHQgPT4gewogICAgICAgICAgdmFyIF9vcCRhdHRyaWJ1dGVzOwogICAgICAgICAgY3VycmVudEJsb2NrRGVsdGEuaW5zZXJ0KHRleHQsIG9wLmF0dHJpYnV0ZXMpOwogICAgICAgICAgcmVuZGVyQmxvY2tzLnB1c2goewogICAgICAgICAgICB0eXBlOiAnYmxvY2snLAogICAgICAgICAgICBkZWx0YTogY3VycmVudEJsb2NrRGVsdGEsCiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IChfb3AkYXR0cmlidXRlcyA9IG9wLmF0dHJpYnV0ZXMpICE9PSBudWxsICYmIF9vcCRhdHRyaWJ1dGVzICE9PSB2b2lkIDAgPyBfb3AkYXR0cmlidXRlcyA6IHt9CiAgICAgICAgICB9KTsKICAgICAgICAgIGN1cnJlbnRCbG9ja0RlbHRhID0gbmV3IERlbHRhKCk7CiAgICAgICAgfSk7CiAgICAgICAgY29uc3QgbGFzdCA9IHNwbGl0dGVkW3NwbGl0dGVkLmxlbmd0aCAtIDFdOwogICAgICAgIGlmIChsYXN0KSB7CiAgICAgICAgICBjdXJyZW50QmxvY2tEZWx0YS5pbnNlcnQobGFzdCwgb3AuYXR0cmlidXRlcyk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKGluc2VydClbMF07CiAgICAgICAgaWYgKCFrZXkpIHJldHVybjsKICAgICAgICBpZiAodGhpcy5xdWVyeShrZXksIFNjb3BlLklOTElORSkpIHsKICAgICAgICAgIGN1cnJlbnRCbG9ja0RlbHRhLnB1c2gob3ApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgX29wJGF0dHJpYnV0ZXMyOwogICAgICAgICAgaWYgKGN1cnJlbnRCbG9ja0RlbHRhLmxlbmd0aCgpKSB7CiAgICAgICAgICAgIHJlbmRlckJsb2Nrcy5wdXNoKHsKICAgICAgICAgICAgICB0eXBlOiAnYmxvY2snLAogICAgICAgICAgICAgIGRlbHRhOiBjdXJyZW50QmxvY2tEZWx0YSwKICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7fQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGN1cnJlbnRCbG9ja0RlbHRhID0gbmV3IERlbHRhKCk7CiAgICAgICAgICByZW5kZXJCbG9ja3MucHVzaCh7CiAgICAgICAgICAgIHR5cGU6ICdibG9ja0VtYmVkJywKICAgICAgICAgICAga2V5LAogICAgICAgICAgICB2YWx1ZTogaW5zZXJ0W2tleV0sCiAgICAgICAgICAgIGF0dHJpYnV0ZXM6IChfb3AkYXR0cmlidXRlczIgPSBvcC5hdHRyaWJ1dGVzKSAhPT0gbnVsbCAmJiBfb3AkYXR0cmlidXRlczIgIT09IHZvaWQgMCA/IF9vcCRhdHRyaWJ1dGVzMiA6IHt9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgaWYgKGN1cnJlbnRCbG9ja0RlbHRhLmxlbmd0aCgpKSB7CiAgICAgIHJlbmRlckJsb2Nrcy5wdXNoKHsKICAgICAgICB0eXBlOiAnYmxvY2snLAogICAgICAgIGRlbHRhOiBjdXJyZW50QmxvY2tEZWx0YSwKICAgICAgICBhdHRyaWJ1dGVzOiB7fQogICAgICB9KTsKICAgIH0KICAgIHJldHVybiByZW5kZXJCbG9ja3M7CiAgfQogIGNyZWF0ZUJsb2NrKGF0dHJpYnV0ZXMsIHJlZkJsb3QpIHsKICAgIGxldCBibG90TmFtZTsKICAgIGNvbnN0IGZvcm1hdHMgPSB7fTsKICAgIE9iamVjdC5lbnRyaWVzKGF0dHJpYnV0ZXMpLmZvckVhY2goX3JlZjMgPT4gewogICAgICBsZXQgW2tleSwgdmFsdWVdID0gX3JlZjM7CiAgICAgIGNvbnN0IGlzQmxvY2tCbG90ID0gdGhpcy5xdWVyeShrZXksIFNjb3BlLkJMT0NLICYgU2NvcGUuQkxPVCkgIT0gbnVsbDsKICAgICAgaWYgKGlzQmxvY2tCbG90KSB7CiAgICAgICAgYmxvdE5hbWUgPSBrZXk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9ybWF0c1trZXldID0gdmFsdWU7CiAgICAgIH0KICAgIH0pOwogICAgY29uc3QgYmxvY2sgPSB0aGlzLmNyZWF0ZShibG90TmFtZSB8fCB0aGlzLnN0YXRpY3MuZGVmYXVsdENoaWxkLmJsb3ROYW1lLCBibG90TmFtZSA/IGF0dHJpYnV0ZXNbYmxvdE5hbWVdIDogdW5kZWZpbmVkKTsKICAgIHRoaXMuaW5zZXJ0QmVmb3JlKGJsb2NrLCByZWZCbG90IHx8IHVuZGVmaW5lZCk7CiAgICBjb25zdCBsZW5ndGggPSBibG9jay5sZW5ndGgoKTsKICAgIE9iamVjdC5lbnRyaWVzKGZvcm1hdHMpLmZvckVhY2goX3JlZjQgPT4gewogICAgICBsZXQgW2tleSwgdmFsdWVdID0gX3JlZjQ7CiAgICAgIGJsb2NrLmZvcm1hdEF0KDAsIGxlbmd0aCwga2V5LCB2YWx1ZSk7CiAgICB9KTsKICAgIHJldHVybiBibG9jazsKICB9Cn0KX2RlZmluZVByb3BlcnR5KFNjcm9sbCwgImJsb3ROYW1lIiwgJ3Njcm9sbCcpOwpfZGVmaW5lUHJvcGVydHkoU2Nyb2xsLCAiY2xhc3NOYW1lIiwgJ3FsLWVkaXRvcicpOwpfZGVmaW5lUHJvcGVydHkoU2Nyb2xsLCAidGFnTmFtZSIsICdESVYnKTsKX2RlZmluZVByb3BlcnR5KFNjcm9sbCwgImRlZmF1bHRDaGlsZCIsIEJsb2NrKTsKX2RlZmluZVByb3BlcnR5KFNjcm9sbCwgImFsbG93ZWRDaGlsZHJlbiIsIFtCbG9jaywgQmxvY2tFbWJlZCwgQ29udGFpbmVyXSk7CmZ1bmN0aW9uIGluc2VydElubGluZUNvbnRlbnRzKHBhcmVudCwgaW5kZXgsIGlubGluZUNvbnRlbnRzKSB7CiAgaW5saW5lQ29udGVudHMucmVkdWNlKChpbmRleCwgb3ApID0+IHsKICAgIGNvbnN0IGxlbmd0aCA9IE9wLmxlbmd0aChvcCk7CiAgICBsZXQgYXR0cmlidXRlcyA9IG9wLmF0dHJpYnV0ZXMgfHwge307CiAgICBpZiAob3AuaW5zZXJ0ICE9IG51bGwpIHsKICAgICAgaWYgKHR5cGVvZiBvcC5pbnNlcnQgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgY29uc3QgdGV4dCA9IG9wLmluc2VydDsKICAgICAgICBwYXJlbnQuaW5zZXJ0QXQoaW5kZXgsIHRleHQpOwogICAgICAgIGNvbnN0IFtsZWFmXSA9IHBhcmVudC5kZXNjZW5kYW50KExlYWZCbG90LCBpbmRleCk7CiAgICAgICAgY29uc3QgZm9ybWF0cyA9IGJ1YmJsZUZvcm1hdHMobGVhZik7CiAgICAgICAgYXR0cmlidXRlcyA9IEF0dHJpYnV0ZU1hcC5kaWZmKGZvcm1hdHMsIGF0dHJpYnV0ZXMpIHx8IHt9OwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvcC5pbnNlcnQgPT09ICdvYmplY3QnKSB7CiAgICAgICAgY29uc3Qga2V5ID0gT2JqZWN0LmtleXMob3AuaW5zZXJ0KVswXTsgLy8gVGhlcmUgc2hvdWxkIG9ubHkgYmUgb25lIGtleQogICAgICAgIGlmIChrZXkgPT0gbnVsbCkgcmV0dXJuIGluZGV4OwogICAgICAgIHBhcmVudC5pbnNlcnRBdChpbmRleCwga2V5LCBvcC5pbnNlcnRba2V5XSk7CiAgICAgICAgY29uc3QgaXNJbmxpbmVFbWJlZCA9IHBhcmVudC5zY3JvbGwucXVlcnkoa2V5LCBTY29wZS5JTkxJTkUpICE9IG51bGw7CiAgICAgICAgaWYgKGlzSW5saW5lRW1iZWQpIHsKICAgICAgICAgIGNvbnN0IFtsZWFmXSA9IHBhcmVudC5kZXNjZW5kYW50KExlYWZCbG90LCBpbmRleCk7CiAgICAgICAgICBjb25zdCBmb3JtYXRzID0gYnViYmxlRm9ybWF0cyhsZWFmKTsKICAgICAgICAgIGF0dHJpYnV0ZXMgPSBBdHRyaWJ1dGVNYXAuZGlmZihmb3JtYXRzLCBhdHRyaWJ1dGVzKSB8fCB7fTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLmZvckVhY2goa2V5ID0+IHsKICAgICAgcGFyZW50LmZvcm1hdEF0KGluZGV4LCBsZW5ndGgsIGtleSwgYXR0cmlidXRlc1trZXldKTsKICAgIH0pOwogICAgcmV0dXJuIGluZGV4ICsgbGVuZ3RoOwogIH0sIGluZGV4KTsKfQpleHBvcnQgZGVmYXVsdCBTY3JvbGw7"},{"version":3,"names":["ContainerBlot","LeafBlot","Scope","ScrollBlot","Delta","AttributeMap","Op","Emitter","Block","BlockEmbed","bubbleFormats","Break","Container","isLine","blot","isUpdatable","updateContent","Scroll","constructor","registry","domNode","_ref","emitter","batch","optimize","enable","addEventListener","e","handleDragStart","batchStart","Array","isArray","batchEnd","mutations","update","emitMount","emit","events","SCROLL_BLOT_MOUNT","emitUnmount","SCROLL_BLOT_UNMOUNT","emitEmbedUpdate","change","SCROLL_EMBED_UPDATE","deleteAt","index","length","first","offset","line","last","ref","children","head","moveChildren","remove","enabled","arguments","undefined","setAttribute","formatAt","format","value","insertAt","def","scroll","query","BLOCK","create","statics","defaultChild","blotName","appendChild","endsWith","slice","embed","insertBefore","scope","INLINE_BLOT","wrapper","insertContents","delta","renderBlocks","deltaToRenderBlocks","concat","insert","pop","shift","shouldInsertNewlineChar","type","descendant","key","insertInlineContents","newlineCharLength","lineEndIndex","formats","attributes","diff","Object","keys","forEach","name","refBlot","refBlotOffset","find","split","renderBlock","block","createBlock","blockEmbed","isEnabled","getAttribute","leaf","path","lines","Number","MAX_VALUE","getLines","blotIndex","blotLength","lengthLeft","forEachAt","child","childIndex","childLength","push","context","SCROLL_OPTIMIZE","source","sources","USER","observer","takeRecords","filter","_ref2","target","SCROLL_BEFORE_UPDATE","SCROLL_UPDATE","updateEmbedAt","b","event","preventDefault","currentBlockDelta","op","splitted","text","_op$attributes","INLINE","_op$attributes2","entries","_ref3","isBlockBlot","BLOT","_ref4","_defineProperty","parent","inlineContents","reduce","isInlineEmbed"],"sources":["../../src/blots/scroll.ts"],"sourcesContent":["import { ContainerBlot, LeafBlot, Scope, ScrollBlot } from 'parchment';\nimport type { Blot, Parent, EmbedBlot, ParentBlot, Registry } from 'parchment';\nimport Delta, { AttributeMap, Op } from 'quill-delta';\nimport Emitter from '../core/emitter.js';\nimport type { EmitterSource } from '../core/emitter.js';\nimport Block, { BlockEmbed, bubbleFormats } from './block.js';\nimport Break from './break.js';\nimport Container from './container.js';\n\ntype RenderBlock =\n  | {\n      type: 'blockEmbed';\n      attributes: AttributeMap;\n      key: string;\n      value: unknown;\n    }\n  | { type: 'block'; attributes: AttributeMap; delta: Delta };\n\nfunction isLine(blot: unknown): blot is Block | BlockEmbed {\n  return blot instanceof Block || blot instanceof BlockEmbed;\n}\n\ninterface UpdatableEmbed {\n  updateContent(change: unknown): void;\n}\n\nfunction isUpdatable(blot: Blot): blot is Blot & UpdatableEmbed {\n  return typeof (blot as unknown as any).updateContent === 'function';\n}\n\nclass Scroll extends ScrollBlot {\n  static blotName = 'scroll';\n  static className = 'ql-editor';\n  static tagName = 'DIV';\n  static defaultChild = Block;\n  static allowedChildren = [Block, BlockEmbed, Container];\n\n  emitter: Emitter;\n  batch: false | MutationRecord[];\n\n  constructor(\n    registry: Registry,\n    domNode: HTMLDivElement,\n    { emitter }: { emitter: Emitter },\n  ) {\n    super(registry, domNode);\n    this.emitter = emitter;\n    this.batch = false;\n    this.optimize();\n    this.enable();\n    this.domNode.addEventListener('dragstart', (e) => this.handleDragStart(e));\n  }\n\n  batchStart() {\n    if (!Array.isArray(this.batch)) {\n      this.batch = [];\n    }\n  }\n\n  batchEnd() {\n    if (!this.batch) return;\n    const mutations = this.batch;\n    this.batch = false;\n    this.update(mutations);\n  }\n\n  emitMount(blot: Blot) {\n    this.emitter.emit(Emitter.events.SCROLL_BLOT_MOUNT, blot);\n  }\n\n  emitUnmount(blot: Blot) {\n    this.emitter.emit(Emitter.events.SCROLL_BLOT_UNMOUNT, blot);\n  }\n\n  emitEmbedUpdate(blot: Blot, change: unknown) {\n    this.emitter.emit(Emitter.events.SCROLL_EMBED_UPDATE, blot, change);\n  }\n\n  deleteAt(index: number, length: number) {\n    const [first, offset] = this.line(index);\n    const [last] = this.line(index + length);\n    super.deleteAt(index, length);\n    if (last != null && first !== last && offset > 0) {\n      if (first instanceof BlockEmbed || last instanceof BlockEmbed) {\n        this.optimize();\n        return;\n      }\n      const ref =\n        last.children.head instanceof Break ? null : last.children.head;\n      // @ts-expect-error\n      first.moveChildren(last, ref);\n      // @ts-expect-error\n      first.remove();\n    }\n    this.optimize();\n  }\n\n  enable(enabled = true) {\n    this.domNode.setAttribute('contenteditable', enabled ? 'true' : 'false');\n  }\n\n  formatAt(index: number, length: number, format: string, value: unknown) {\n    super.formatAt(index, length, format, value);\n    this.optimize();\n  }\n\n  insertAt(index: number, value: string, def?: unknown) {\n    if (index >= this.length()) {\n      if (def == null || this.scroll.query(value, Scope.BLOCK) == null) {\n        const blot = this.scroll.create(this.statics.defaultChild.blotName);\n        this.appendChild(blot);\n        if (def == null && value.endsWith('\\n')) {\n          blot.insertAt(0, value.slice(0, -1), def);\n        } else {\n          blot.insertAt(0, value, def);\n        }\n      } else {\n        const embed = this.scroll.create(value, def);\n        this.appendChild(embed);\n      }\n    } else {\n      super.insertAt(index, value, def);\n    }\n    this.optimize();\n  }\n\n  insertBefore(blot: Blot, ref?: Blot | null) {\n    if (blot.statics.scope === Scope.INLINE_BLOT) {\n      const wrapper = this.scroll.create(\n        this.statics.defaultChild.blotName,\n      ) as Parent;\n      wrapper.appendChild(blot);\n      super.insertBefore(wrapper, ref);\n    } else {\n      super.insertBefore(blot, ref);\n    }\n  }\n\n  insertContents(index: number, delta: Delta) {\n    const renderBlocks = this.deltaToRenderBlocks(\n      delta.concat(new Delta().insert('\\n')),\n    );\n    const last = renderBlocks.pop();\n    if (last == null) return;\n\n    this.batchStart();\n\n    const first = renderBlocks.shift();\n    if (first) {\n      const shouldInsertNewlineChar =\n        first.type === 'block' &&\n        (first.delta.length() === 0 ||\n          (!this.descendant(BlockEmbed, index)[0] && index < this.length()));\n      const delta =\n        first.type === 'block'\n          ? first.delta\n          : new Delta().insert({ [first.key]: first.value });\n      insertInlineContents(this, index, delta);\n      const newlineCharLength = first.type === 'block' ? 1 : 0;\n      const lineEndIndex = index + delta.length() + newlineCharLength;\n      if (shouldInsertNewlineChar) {\n        this.insertAt(lineEndIndex - 1, '\\n');\n      }\n\n      const formats = bubbleFormats(this.line(index)[0]);\n      const attributes = AttributeMap.diff(formats, first.attributes) || {};\n      Object.keys(attributes).forEach((name) => {\n        this.formatAt(lineEndIndex - 1, 1, name, attributes[name]);\n      });\n\n      index = lineEndIndex;\n    }\n\n    let [refBlot, refBlotOffset] = this.children.find(index);\n    if (renderBlocks.length) {\n      if (refBlot) {\n        refBlot = refBlot.split(refBlotOffset);\n        refBlotOffset = 0;\n      }\n\n      renderBlocks.forEach((renderBlock) => {\n        if (renderBlock.type === 'block') {\n          const block = this.createBlock(\n            renderBlock.attributes,\n            refBlot || undefined,\n          );\n          insertInlineContents(block, 0, renderBlock.delta);\n        } else {\n          const blockEmbed = this.create(\n            renderBlock.key,\n            renderBlock.value,\n          ) as EmbedBlot;\n          this.insertBefore(blockEmbed, refBlot || undefined);\n          Object.keys(renderBlock.attributes).forEach((name) => {\n            blockEmbed.format(name, renderBlock.attributes[name]);\n          });\n        }\n      });\n    }\n\n    if (last.type === 'block' && last.delta.length()) {\n      const offset = refBlot\n        ? refBlot.offset(refBlot.scroll) + refBlotOffset\n        : this.length();\n      insertInlineContents(this, offset, last.delta);\n    }\n\n    this.batchEnd();\n    this.optimize();\n  }\n\n  isEnabled() {\n    return this.domNode.getAttribute('contenteditable') === 'true';\n  }\n\n  leaf(index: number): [LeafBlot | null, number] {\n    const last = this.path(index).pop();\n    if (!last) {\n      return [null, -1];\n    }\n\n    const [blot, offset] = last;\n    return blot instanceof LeafBlot ? [blot, offset] : [null, -1];\n  }\n\n  line(index: number): [Block | BlockEmbed | null, number] {\n    if (index === this.length()) {\n      return this.line(index - 1);\n    }\n    // @ts-expect-error TODO: make descendant() generic\n    return this.descendant(isLine, index);\n  }\n\n  lines(index = 0, length = Number.MAX_VALUE): (Block | BlockEmbed)[] {\n    const getLines = (\n      blot: ParentBlot,\n      blotIndex: number,\n      blotLength: number,\n    ) => {\n      let lines: (Block | BlockEmbed)[] = [];\n      let lengthLeft = blotLength;\n      blot.children.forEachAt(\n        blotIndex,\n        blotLength,\n        (child, childIndex, childLength) => {\n          if (isLine(child)) {\n            lines.push(child);\n          } else if (child instanceof ContainerBlot) {\n            lines = lines.concat(getLines(child, childIndex, lengthLeft));\n          }\n          lengthLeft -= childLength;\n        },\n      );\n      return lines;\n    };\n    return getLines(this, index, length);\n  }\n\n  optimize(context?: { [key: string]: any }): void;\n  optimize(\n    mutations?: MutationRecord[],\n    context?: { [key: string]: any },\n  ): void;\n  optimize(mutations = [], context = {}) {\n    if (this.batch) return;\n    super.optimize(mutations, context);\n    if (mutations.length > 0) {\n      this.emitter.emit(Emitter.events.SCROLL_OPTIMIZE, mutations, context);\n    }\n  }\n\n  path(index: number) {\n    return super.path(index).slice(1); // Exclude self\n  }\n\n  remove() {\n    // Never remove self\n  }\n\n  update(source?: EmitterSource): void;\n  update(mutations?: MutationRecord[]): void;\n  update(mutations?: MutationRecord[] | EmitterSource): void {\n    if (this.batch) {\n      if (Array.isArray(mutations)) {\n        this.batch = this.batch.concat(mutations);\n      }\n      return;\n    }\n    let source: EmitterSource = Emitter.sources.USER;\n    if (typeof mutations === 'string') {\n      source = mutations;\n    }\n    if (!Array.isArray(mutations)) {\n      mutations = this.observer.takeRecords();\n    }\n    mutations = mutations.filter(({ target }) => {\n      const blot = this.find(target, true);\n      return blot && !isUpdatable(blot);\n    });\n    if (mutations.length > 0) {\n      this.emitter.emit(Emitter.events.SCROLL_BEFORE_UPDATE, source, mutations);\n    }\n    super.update(mutations.concat([])); // pass copy\n    if (mutations.length > 0) {\n      this.emitter.emit(Emitter.events.SCROLL_UPDATE, source, mutations);\n    }\n  }\n\n  updateEmbedAt(index: number, key: string, change: unknown) {\n    // Currently it only supports top-level embeds (BlockEmbed).\n    // We can update `ParentBlot` in parchment to support inline embeds.\n    const [blot] = this.descendant((b: Blot) => b instanceof BlockEmbed, index);\n    if (blot && blot.statics.blotName === key && isUpdatable(blot)) {\n      blot.updateContent(change);\n    }\n  }\n\n  protected handleDragStart(event: DragEvent) {\n    event.preventDefault();\n  }\n\n  private deltaToRenderBlocks(delta: Delta) {\n    const renderBlocks: RenderBlock[] = [];\n\n    let currentBlockDelta = new Delta();\n    delta.forEach((op) => {\n      const insert = op?.insert;\n      if (!insert) return;\n      if (typeof insert === 'string') {\n        const splitted = insert.split('\\n');\n        splitted.slice(0, -1).forEach((text) => {\n          currentBlockDelta.insert(text, op.attributes);\n          renderBlocks.push({\n            type: 'block',\n            delta: currentBlockDelta,\n            attributes: op.attributes ?? {},\n          });\n          currentBlockDelta = new Delta();\n        });\n        const last = splitted[splitted.length - 1];\n        if (last) {\n          currentBlockDelta.insert(last, op.attributes);\n        }\n      } else {\n        const key = Object.keys(insert)[0];\n        if (!key) return;\n        if (this.query(key, Scope.INLINE)) {\n          currentBlockDelta.push(op);\n        } else {\n          if (currentBlockDelta.length()) {\n            renderBlocks.push({\n              type: 'block',\n              delta: currentBlockDelta,\n              attributes: {},\n            });\n          }\n          currentBlockDelta = new Delta();\n          renderBlocks.push({\n            type: 'blockEmbed',\n            key,\n            value: insert[key],\n            attributes: op.attributes ?? {},\n          });\n        }\n      }\n    });\n\n    if (currentBlockDelta.length()) {\n      renderBlocks.push({\n        type: 'block',\n        delta: currentBlockDelta,\n        attributes: {},\n      });\n    }\n\n    return renderBlocks;\n  }\n\n  private createBlock(attributes: AttributeMap, refBlot?: Blot) {\n    let blotName: string | undefined;\n    const formats: AttributeMap = {};\n\n    Object.entries(attributes).forEach(([key, value]) => {\n      const isBlockBlot = this.query(key, Scope.BLOCK & Scope.BLOT) != null;\n      if (isBlockBlot) {\n        blotName = key;\n      } else {\n        formats[key] = value;\n      }\n    });\n\n    const block = this.create(\n      blotName || this.statics.defaultChild.blotName,\n      blotName ? attributes[blotName] : undefined,\n    ) as ParentBlot;\n\n    this.insertBefore(block, refBlot || undefined);\n\n    const length = block.length();\n    Object.entries(formats).forEach(([key, value]) => {\n      block.formatAt(0, length, key, value);\n    });\n\n    return block;\n  }\n}\n\nfunction insertInlineContents(\n  parent: ParentBlot,\n  index: number,\n  inlineContents: Delta,\n) {\n  inlineContents.reduce((index, op) => {\n    const length = Op.length(op);\n    let attributes = op.attributes || {};\n    if (op.insert != null) {\n      if (typeof op.insert === 'string') {\n        const text = op.insert;\n        parent.insertAt(index, text);\n        const [leaf] = parent.descendant(LeafBlot, index);\n        const formats = bubbleFormats(leaf);\n        attributes = AttributeMap.diff(formats, attributes) || {};\n      } else if (typeof op.insert === 'object') {\n        const key = Object.keys(op.insert)[0]; // There should only be one key\n        if (key == null) return index;\n        parent.insertAt(index, key, op.insert[key]);\n        const isInlineEmbed = parent.scroll.query(key, Scope.INLINE) != null;\n        if (isInlineEmbed) {\n          const [leaf] = parent.descendant(LeafBlot, index);\n          const formats = bubbleFormats(leaf);\n          attributes = AttributeMap.diff(formats, attributes) || {};\n        }\n      }\n    }\n    Object.keys(attributes).forEach((key) => {\n      parent.formatAt(index, length, key, attributes[key]);\n    });\n    return index + length;\n  }, index);\n}\n\nexport default Scroll;\n"],"mappings":"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","ignoreList":[]}]}