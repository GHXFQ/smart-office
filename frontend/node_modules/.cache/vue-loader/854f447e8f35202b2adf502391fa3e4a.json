{"remainingRequest":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\project\\components\\ReportsView.vue?vue&type=style&index=0&id=f395ea9e&scoped=true&lang=css","dependencies":[{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\project\\components\\ReportsView.vue","mtime":1748675746256},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\css-loader\\dist\\cjs.js","mtime":1746431217000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":1746431217000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1746431218000},{"path":"C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1746431218000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5tb2Rlcm4tcmVwb3J0IHsgYmFja2dyb3VuZDogdmFyKC0tYmctY29sb3IpOyBib3JkZXItcmFkaXVzOiAxMnB4OyBib3gtc2hhZG93OiAwIDJweCA4cHggcmdiYSgwLDAsMCwwLjA0KTsgcGFkZGluZzogMjRweDsgfQoubW9kZXJuLWNhcmQgeyBiYWNrZ3JvdW5kOiB2YXIoLS1iZy1jb2xvci1zZWNvbmRhcnkpOyBib3JkZXItcmFkaXVzOiAxMnB4OyBib3gtc2hhZG93OiAwIDJweCA4cHggcmdiYSgwLDAsMCwwLjA2KTsgcGFkZGluZzogMThweDsgbWFyZ2luLWJvdHRvbTogMThweDsgfQoubW9kZXJuLWVjaGFydCB7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDI2MHB4OyBtaW4taGVpZ2h0OiAxODBweDsgfQouY2hhcnQtY2VudGVyLXdyYXAgeyBwb3NpdGlvbjogcmVsYXRpdmU7IGRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBtaW4taGVpZ2h0OiAyMjBweDsgfQouY2hhcnQtZW1wdHkgeyBwb3NpdGlvbjogYWJzb2x1dGU7IGxlZnQ6IDA7IHJpZ2h0OiAwOyB0b3A6IDUwJTsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01MCUpOyB0ZXh0LWFsaWduOiBjZW50ZXI7IGNvbG9yOiAjYmJiOyBmb250LXNpemU6IDIwcHg7IGZvbnQtd2VpZ2h0OiA1MDA7IHotaW5kZXg6IDI7IH0KLm1haW4tdmFsdWUgeyBmb250LXNpemU6IDE4cHg7IGNvbG9yOiAjMjIyOyBmb250LXdlaWdodDogYm9sZDsgbWFyZ2luLXRvcDogMTBweDsgfQoubW9kdWxlLXRpdGxlIHsgZm9udC1zaXplOiAxLjJyZW07IGZvbnQtd2VpZ2h0OiA3MDA7IGNvbG9yOiB2YXIoLS10ZXh0LWNvbG9yKSAhaW1wb3J0YW50OyBtYXJnaW46IDA7IH0KLnRleHQtcHJpbWFyeSB7IGNvbG9yOiAjNEY4Q0ZGIWltcG9ydGFudDsgfQoudGV4dC1tdXRlZCB7IGNvbG9yOiAjYmJiIWltcG9ydGFudDsgfQoubWItNCB7IG1hcmdpbi1ib3R0b206IDI0cHg7IH0KLnJvdyB7IGRpc3BsYXk6IGZsZXg7IGZsZXgtd3JhcDogd3JhcDsgbWFyZ2luLWxlZnQ6IC0xMnB4OyBtYXJnaW4tcmlnaHQ6IC0xMnB4OyB9Ci5jb2wtbWQtNiB7IGZsZXg6IDAgMCA1MCU7IG1heC13aWR0aDogNTAlOyBwYWRkaW5nLWxlZnQ6IDEycHg7IHBhZGRpbmctcmlnaHQ6IDEycHg7IGJveC1zaXppbmc6IGJvcmRlci1ib3g7IH0KLmNvbC1tZC0xMiB7IGZsZXg6IDAgMCAxMDAlOyBtYXgtd2lkdGg6IDEwMCU7IHBhZGRpbmctbGVmdDogMTJweDsgcGFkZGluZy1yaWdodDogMTJweDsgYm94LXNpemluZzogYm9yZGVyLWJveDsgfQpAbWVkaWEgKG1heC13aWR0aDogOTAwcHgpIHsKICAuY29sLW1kLTYsIC5jb2wtbWQtMTIgeyBmbGV4OiAwIDAgMTAwJTsgbWF4LXdpZHRoOiAxMDAlOyB9Cn0K"},{"version":3,"sources":["C:\\Users\\18083\\Desktop\\CCIT\\office\\smart-office\\frontend\\src\\views\\project\\components\\ReportsView.vue"],"names":[],"mappings":";AA0VA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE;AAC1H,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE;AACvJ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;AAChE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;AACzH,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE;AAC7K,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE;AACjF,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE;AACrG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;AAC1C,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;AACrC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE;AAC7B,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;AAChF,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;AAC5G,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;AAC/G,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACxB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,EAAE;AAC3D","file":"C:/Users/18083/Desktop/CCIT/office/smart-office/frontend/src/views/project/components/ReportsView.vue","sourceRoot":"","sourcesContent":["<template>\n  <div class=\"module-card modern-report\">\n    <div class=\"module-header\">\n      <h5 class=\"module-title\">项目数据分析</h5>\n      <div class=\"btn-group\">\n        <el-button size=\"small\" plain icon=\"el-icon-magic-stick\" @click=\"downloadAiReport\">AI分析报告</el-button>\n      </div>\n    </div>\n    <div class=\"row mb-4\">\n      <div class=\"col-md-6\">\n        <div class=\"modern-card\">\n          <h6 class=\"text-primary\">文档上传趋势</h6>\n          <div class=\"chart-center-wrap\">\n            <div ref=\"docTrendChart\" class=\"modern-echart\" />\n            <div v-if=\"!docTrendHasData\" class=\"chart-empty\">暂无数据</div>\n          </div>\n        </div>\n      </div>\n      <div class=\"col-md-6\">\n        <div class=\"modern-card\">\n          <h6 class=\"text-primary\">需求优先级分布</h6>\n          <div class=\"chart-center-wrap\">\n            <div ref=\"reqChart\" class=\"modern-echart\" />\n            <div v-if=\"!reqTotal\" class=\"chart-empty\">暂无数据</div>\n          </div>\n          <div class=\"modern-summary main-value\" v-if=\"reqTotal\">共 {{ reqTotal }} 个需求</div>\n        </div>\n      </div>\n    </div>\n    <div class=\"row mb-4\">\n      <div class=\"col-md-6\">\n        <div class=\"modern-card\">\n          <h6 class=\"text-primary\">需求完成率</h6>\n          <div class=\"chart-center-wrap\">\n            <div ref=\"gaugeChart\" class=\"modern-echart\" />\n            <div v-if=\"!reqTotal\" class=\"chart-empty\">暂无数据</div>\n          </div>\n        </div>\n      </div>\n      <div class=\"col-md-6\">\n        <div class=\"modern-card\">\n          <h6 class=\"text-primary\">任务完成趋势</h6>\n          <div class=\"chart-center-wrap\">\n            <div ref=\"trendChart\" class=\"modern-echart\" />\n            <div v-if=\"!trendHasData\" class=\"chart-empty\">暂无数据</div>\n          </div>\n          <div class=\"modern-summary main-value\" v-if=\"taskTotal\">共 {{ taskTotal }} 个任务</div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n<script setup>\nimport { onMounted, ref, watch, onBeforeUnmount, nextTick, computed } from 'vue'\nimport * as echarts from 'echarts'\nimport { exportProjectAiReport } from '@/api/project'\n\nconst props = defineProps({\n  project: Object,\n  tasks: Array,\n  documents: Array,\n  requirements: Array\n})\n\nconst docTrendChart = ref(null)\nconst reqChart = ref(null)\nconst gaugeChart = ref(null)\nconst trendChart = ref(null)\n\nlet docTrendChartInstance = null\nlet reqChartInstance = null\nlet gaugeChartInstance = null\nlet trendChartInstance = null\n\n// 新增：标准化任务数据，兼容\"已完成\"状态和完成时间\nconst normalizedTasks = computed(() => {\n  if (!Array.isArray(props.tasks)) return []\n  return props.tasks.map(task => {\n    let status = task.status\n    if (status === '已完成') status = 'done'\n    // 可扩展更多映射\n    return {\n      ...task,\n      status,\n      due_date: task.due_date || task.updated_at || task.update_time || task.end_time || new Date().toISOString()\n    }\n  })\n})\n\n// 统计数据摘要\nconst reqTotal = computed(() => props.requirements?.length || 0)\nconst taskTotal = computed(() => normalizedTasks.value.length || 0)\n\n// 图表数据预处理\nconst docTrendHasData = computed(() => {\n  if (!Array.isArray(props.documents) || !props.documents.length) return false\n  return props.documents.some(doc => doc.uploaded_at || doc.created_at)\n})\n\nconst trendHasData = computed(() => {\n  if (!Array.isArray(normalizedTasks.value) || !normalizedTasks.value.length) return false\n  return normalizedTasks.value.some(task => task.completed_at || task.finish_time || task.status === 'done')\n})\n\nfunction renderCharts() {\n  // 销毁旧实例\n  if (docTrendChartInstance) docTrendChartInstance.dispose()\n  if (reqChartInstance) reqChartInstance.dispose()\n  if (gaugeChartInstance) gaugeChartInstance.dispose()\n  if (trendChartInstance) trendChartInstance.dispose()\n\n  // 文档上传趋势\n  if (docTrendChart.value) {\n    docTrendChartInstance = echarts.init(docTrendChart.value)\n    const docMonthMap = {}\n    props.documents?.forEach(doc => {\n      if (doc.uploaded_at) {\n        const month = (doc.uploaded_at + '').slice(0, 7)\n        docMonthMap[month] = (docMonthMap[month] || 0) + 1\n      }\n    })\n    const docMonths = Object.keys(docMonthMap).sort()\n    const docMonthData = docMonths.map(m => docMonthMap[m])\n    docTrendChartInstance.setOption({\n      tooltip: { trigger: 'axis' },\n      grid: { left: 40, right: 20, top: 30, bottom: 40 },\n      xAxis: {\n        type: 'category',\n        data: docMonths,\n        axisLabel: { color: '#888', fontSize: 13 },\n        name: docMonths.length ? '' : '暂无数据',\n      },\n      yAxis: {\n        type: 'value',\n        min: 0,\n        axisLabel: { color: '#888', fontSize: 13 }\n      },\n      series: [\n        {\n          name: '上传文档数', type: 'line', data: docMonthData, smooth: true,\n          itemStyle: { color: '#4F8CFF' },\n          areaStyle: { color: 'rgba(79,140,255,0.1)' },\n          symbolSize: 10\n        }\n      ]\n    })\n  }\n  // 需求优先级分布\n  if (reqChart.value) {\n    reqChartInstance = echarts.init(reqChart.value)\n    const reqPriorityMap = { 高: 0, 中: 0, 低: 0 }\n    if (Array.isArray(props.requirements)) {\n      props.requirements.forEach(req => {\n        let pri = req.priority\n        if (typeof pri === 'object' && pri !== null) pri = pri.value || pri.label || JSON.stringify(pri)\n        if (typeof pri !== 'string') pri = String(pri || '').trim()\n        if (['high', 'High', 'HIGH', '高', '1'].includes(pri)) {\n          pri = '高'\n        } else if (['medium', 'Medium', 'MEDIUM', '中', '2'].includes(pri)) {\n          pri = '中'\n        } else if (['low', 'Low', 'LOW', '低', '3'].includes(pri)) {\n          pri = '低'\n        } else {\n          // 不是高/中/低的全部跳过，不计入图表\n          return\n        }\n        reqPriorityMap[pri] = (reqPriorityMap[pri] || 0) + 1\n      })\n    }\n    reqChartInstance.setOption({\n      tooltip: { trigger: 'item' },\n      legend: { bottom: 0, textStyle: { color: '#666', fontSize: 13 } },\n      color: ['#4F8CFF', '#34C759', '#FF9500'],\n      series: [\n        {\n          name: '优先级分布', type: 'pie', radius: ['60%', '80%'],\n          data: Object.keys(reqPriorityMap).map(k => ({ value: reqPriorityMap[k], name: k })),\n          label: {\n            show: true,\n            position: 'outside',\n            fontSize: 14,\n            color: '#333',\n            formatter: '{b}: {d}%'\n          },\n          labelLine: { length: 18, length2: 10 },\n          avoidLabelOverlap: false,\n          emphasis: { itemStyle: { shadowBlur: 10, shadowOffsetX: 0, shadowColor: 'rgba(0,0,0,0.2)' } }\n        }\n      ]\n    })\n  }\n  // 需求完成率仪表盘\n  if (gaugeChart.value) {\n    gaugeChartInstance = echarts.init(gaugeChart.value)\n    let reqCompleted = 0\n    if (Array.isArray(props.requirements)) {\n      // 调试输出原始数据\n      console.log('需求原始数据:', props.requirements)\n      props.requirements.forEach(req => {\n        let status = req.status\n        if (typeof status === 'object' && status !== null) status = status.value || status.label || JSON.stringify(status)\n        if (typeof status !== 'string') status = String(status || '').trim().toLowerCase()\n        if ([\n          '已完成', '完成', 'completed', 'done', 'finished', '已关闭', 'closed', '已解决', 'resolved', '1', 'true', '是', 'success'\n        ].some(s => status.includes(s))) {\n          reqCompleted++\n        }\n      })\n    }\n    const percent = reqTotal.value ? Math.round(reqCompleted / reqTotal.value * 100) : 0\n    gaugeChartInstance.setOption({\n      series: [\n        {\n          type: 'gauge',\n          center: ['50%', '60%'],\n          radius: '90%',\n          min: 0,\n          max: 100,\n          progress: { show: true, width: 18 },\n          axisLine: { lineStyle: { width: 18, color: [[1, '#4F8CFF']] } },\n          pointer: { width: 6, length: '70%' },\n          detail: {\n            valueAnimation: true,\n            fontSize: 32,\n            color: '#4F8CFF',\n            fontWeight: 'bold',\n            offsetCenter: [0, '40%'],\n            formatter: '{value}%'\n          },\n          data: [{ value: percent, name: '完成率' }],\n          title: { fontSize: 16, color: '#888', offsetCenter: [0, '80%'] }\n        }\n      ]\n    })\n  }\n  // 任务完成趋势\n  if (trendChart.value) {\n    // 调试输出原始任务数据\n    console.log('任务原始数据:', normalizedTasks.value)\n    trendChartInstance = echarts.init(trendChart.value)\n    const monthMap = {}\n    let hasCompleted = false\n    if (Array.isArray(normalizedTasks.value)) {\n      normalizedTasks.value.forEach(task => {\n        // 仅根据 status 字段判断是否已完成\n        let status = (task.status || '').toLowerCase()\n        if ([\n          '已完成', '完成', 'done', 'finished', '已关闭', 'closed', 'success', 'true', '1'\n        ].some(s => status.includes(s))) {\n          hasCompleted = true\n          // 取 due_date 或 updated_at 作为完成时间\n          let finish = task.due_date || task.updated_at || task.update_time || task.end_time || ''\n          if (!finish) {\n            // 没有时间字段时，使用当前月\n            const now = new Date()\n            finish = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`\n          }\n          const month = (finish + '').slice(0, 7)\n          monthMap[month] = (monthMap[month] || 0) + 1\n        }\n      })\n    }\n    let months = Object.keys(monthMap).sort()\n    let monthData = months.map(m => monthMap[m])\n    // 如果有任务但都未完成，显示0\n    if (Array.isArray(normalizedTasks.value) && normalizedTasks.value.length > 0 && !hasCompleted) {\n      const now = new Date()\n      const thisMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`\n      months = [thisMonth]\n      monthData = [0]\n    }\n    trendChartInstance.setOption({\n      tooltip: { trigger: 'axis' },\n      grid: { left: 40, right: 20, top: 30, bottom: 40 },\n      xAxis: {\n        type: 'category',\n        data: months,\n        axisLabel: { color: '#888', fontSize: 13 },\n        name: months.length ? '' : '暂无数据',\n      },\n      yAxis: {\n        type: 'value',\n        min: 0,\n        axisLabel: { color: '#888', fontSize: 13 }\n      },\n      series: [\n        {\n          name: '完成任务数', type: 'bar', data: monthData,\n          itemStyle: { color: '#34C759' },\n          barWidth: 32,\n          label: { show: true, position: 'top', color: '#34C759', fontSize: 16, fontWeight: 'bold' }\n        }\n      ]\n    })\n  }\n}\n\nasync function downloadAiReport() {\n  if (!props.project?.id) return\n  // 导出四个ECharts图表为base64图片\n  const getBase64 = (chartInstance) => chartInstance ? chartInstance.getDataURL({ type: 'png', pixelRatio: 2, backgroundColor: '#fff' }) : ''\n  const docTrendImg = getBase64(docTrendChartInstance)\n  const reqChartImg = getBase64(reqChartInstance)\n  const gaugeChartImg = getBase64(gaugeChartInstance)\n  const trendChartImg = getBase64(trendChartInstance)\n  // 组装数据\n  const payload = {\n    doc_trend_img: docTrendImg,\n    req_chart_img: reqChartImg,\n    gauge_chart_img: gaugeChartImg,\n    trend_chart_img: trendChartImg,\n    project_name: props.project.name || '',\n    project_id: props.project.id\n  }\n  // POST给后端，返回PDF\n  exportProjectAiReport(props.project.id, payload).then(res => {\n    const blob = new Blob([res.data], { type: 'application/pdf' })\n    const url = window.URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.href = url\n    a.download = `${props.project.name || '项目'}_AI分析报告.pdf`\n    document.body.appendChild(a)\n    a.click()\n    document.body.removeChild(a)\n    window.URL.revokeObjectURL(url)\n  })\n}\n\nonMounted(() => {\n  nextTick(() => setTimeout(renderCharts, 300))\n})\nwatch(\n  () => [props.tasks, props.documents, props.requirements],\n  () => {\n    nextTick(() => setTimeout(renderCharts, 300))\n  },\n  { deep: true }\n)\nonBeforeUnmount(() => {\n  if (docTrendChartInstance) docTrendChartInstance.dispose()\n  if (reqChartInstance) reqChartInstance.dispose()\n  if (gaugeChartInstance) gaugeChartInstance.dispose()\n  if (trendChartInstance) trendChartInstance.dispose()\n})\n</script>\n<style scoped>\n.modern-report { background: var(--bg-color); border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); padding: 24px; }\n.modern-card { background: var(--bg-color-secondary); border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); padding: 18px; margin-bottom: 18px; }\n.modern-echart { width: 100%; height: 260px; min-height: 180px; }\n.chart-center-wrap { position: relative; display: flex; align-items: center; justify-content: center; min-height: 220px; }\n.chart-empty { position: absolute; left: 0; right: 0; top: 50%; transform: translateY(-50%); text-align: center; color: #bbb; font-size: 20px; font-weight: 500; z-index: 2; }\n.main-value { font-size: 18px; color: #222; font-weight: bold; margin-top: 10px; }\n.module-title { font-size: 1.2rem; font-weight: 700; color: var(--text-color) !important; margin: 0; }\n.text-primary { color: #4F8CFF!important; }\n.text-muted { color: #bbb!important; }\n.mb-4 { margin-bottom: 24px; }\n.row { display: flex; flex-wrap: wrap; margin-left: -12px; margin-right: -12px; }\n.col-md-6 { flex: 0 0 50%; max-width: 50%; padding-left: 12px; padding-right: 12px; box-sizing: border-box; }\n.col-md-12 { flex: 0 0 100%; max-width: 100%; padding-left: 12px; padding-right: 12px; box-sizing: border-box; }\n@media (max-width: 900px) {\n  .col-md-6, .col-md-12 { flex: 0 0 100%; max-width: 100%; }\n}\n</style> "]}]}